var O=Object.defineProperty;var s=(o,t)=>O(o,"name",{value:t,configurable:!0});import{r as m,j as e}from"./react-core-Djgtqrmb.js";import{e as T,c as $}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const C={name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0},M=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}],P=s(o=>{const[t,a]=m.useState([]),[n,d]=m.useState(!0),[j,g]=m.useState(!1),[v,c]=m.useState(null),[u,N]=m.useState(null),[f,y]=m.useState(C),h=s(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),"authHeaders");m.useEffect(()=>{R()},[o]);const R=s(async()=>{try{d(!0);const l=await fetch(`/api/roles/${o}/list/`,{headers:h()});if(l.ok){const r=await l.json();a(r.roles||[])}}catch{}finally{d(!1)}},"fetchRoles"),w=s(async()=>{if(f.name.trim())try{const l=await fetch(`/api/roles/${o}/create/`,{method:"POST",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify(f)});if(l.ok){const r=await l.json();a([...t,r.role]),g(!1),y(C)}}catch{}},"createRole"),S=s(async(l,r)=>{try{const i=await fetch(`/api/roles/${o}/${l}/update/`,{method:"PUT",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify(r)});if(i.ok){const b=await i.json();a(t.map(x=>x.id===l?b.role:x)),c(null)}}catch{}},"updateRole"),D=s(async l=>{if(await T("Are you sure you want to delete this role?"))try{(await fetch(`/api/roles/${o}/${l}/delete/`,{method:"DELETE",headers:h()})).ok&&a(t.filter(i=>i.id!==l))}catch{}},"deleteRole"),E=s(async l=>{try{await fetch(`/api/roles/${o}/reorder/`,{method:"POST",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify({order:l})}),R()}catch{}},"reorderRoles");return{roles:t,loading:n,showCreateModal:j,setShowCreateModal:g,editingRole:v,setEditingRole:c,draggedRole:u,newRole:f,setNewRole:y,createRole:w,updateRole:S,deleteRole:D,copyRole:s(async l=>{try{const r=await fetch(`/api/roles/${o}/${l}/copy/`,{method:"POST",headers:h()});if(r.ok){const i=await r.json();a([...t,i.role])}}catch{}},"copyRole"),handleDragStart:s((l,r)=>{N(r),l.dataTransfer.effectAllowed="move"},"handleDragStart"),handleDragOver:s(l=>{l.preventDefault(),l.dataTransfer.dropEffect="move"},"handleDragOver"),handleDrop:s((l,r)=>{if(l.preventDefault(),!u||u.id===r.id)return;const i=[...t],b=i.findIndex(p=>p.id===u.id),x=i.findIndex(p=>p.id===r.id);i.splice(b,1),i.splice(x,0,u),a(i),E(i.map(p=>p.id)),N(null)},"handleDrop")}},"useRolesManager"),k=s(({role:o,setRole:t,onSave:a,onCancel:n,title:d,saveLabel:j})=>{const{overlayProps:g,dialogProps:v}=$({onClose:n,label:"Rol Formu"});return e.jsx("div",{className:"role-modal-overlay",...g,children:e.jsxs("div",{className:"role-modal",...v,children:[e.jsx("h3",{children:d}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:o.name,onChange:s(c=>t({...o,name:c.target.value}),"onChange"),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[M.map(c=>e.jsx("button",{className:`color-preset ${o.color===c.value?"active":""}`,style:{backgroundColor:c.value},onClick:s(()=>t({...o,color:c.value}),"onClick"),title:c.name},c.value)),e.jsx("input",{type:"color",value:o.color,onChange:s(c=>t({...o,color:c.target.value}),"onChange"),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.hoist,onChange:s(c=>t({...o,hoist:c.target.checked}),"onChange")}),e.jsx("span",{children:"Display role members separately from online members"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.mentionable,onChange:s(c=>t({...o,mentionable:c.target.checked}),"onChange")}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:n,children:"Cancel"}),e.jsx("button",{className:d.includes("Edit")?"save-btn":"create-btn",onClick:a,children:j})]})]})})},"RoleFormModal"),Q=s(({serverId:o,onClose:t})=>{const a=P(o);return a.loading?e.jsx("div",{className:"roles-manager-overlay",children:e.jsx("div",{className:"roles-manager-modal",children:e.jsx("div",{className:"loading-spinner",children:"Loading roles..."})})}):e.jsx("div",{className:"roles-manager-overlay",onClick:t,children:e.jsxs("div",{className:"roles-manager-modal",onClick:s(n=>n.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"roles-manager-header",children:[e.jsxs("h2",{children:["ðŸŽ­"," Server Roles"]}),e.jsx("button",{className:"close-btn",onClick:t,children:"âœ•"})]}),e.jsxs("div",{className:"roles-manager-content",children:[e.jsxs("div",{className:"roles-actions",children:[e.jsxs("button",{className:"create-role-btn",onClick:s(()=>a.setShowCreateModal(!0),"onClick"),children:["âž•"," Create Role"]}),e.jsxs("div",{className:"roles-info",children:[e.jsxs("span",{children:[a.roles.length," roles"]}),e.jsxs("span",{className:"info-tip",children:["ðŸ’¡"," Drag to reorder hierarchy"]})]})]}),e.jsx("div",{className:"roles-list",children:a.roles.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ­"}),e.jsx("h3",{children:"No Roles Yet"}),e.jsx("p",{children:"Create roles to organize your server members"})]}):a.roles.map(n=>e.jsxs("div",{className:`role-card ${a.draggedRole?.id===n.id?"dragging":""}`,draggable:!0,onDragStart:s(d=>a.handleDragStart(d,n),"onDragStart"),onDragOver:a.handleDragOver,onDrop:s(d=>a.handleDrop(d,n),"onDrop"),children:[e.jsx("div",{className:"role-drag-handle",children:"â˜°"}),e.jsx("div",{className:"role-color-badge",style:{backgroundColor:n.color}}),e.jsxs("div",{className:"role-info",children:[e.jsx("div",{className:"role-name",style:{color:n.color},children:n.name}),e.jsxs("div",{className:"role-meta",children:[e.jsxs("span",{className:"role-members",children:["ðŸ‘¥"," ",n.member_count||0," members"]}),n.hoist&&e.jsxs("span",{className:"role-badge",children:["ðŸ“Œ"," Hoisted"]}),n.mentionable&&e.jsx("span",{className:"role-badge",children:"@ Mentionable"})]})]}),e.jsxs("div",{className:"role-actions",children:[e.jsx("button",{className:"role-action-btn edit",onClick:s(()=>a.setEditingRole(n),"onClick"),title:"Edit",children:"âœï¸"}),e.jsx("button",{className:"role-action-btn copy",onClick:s(()=>a.copyRole(n.id),"onClick"),title:"Copy",children:"ðŸ“‹"}),e.jsx("button",{className:"role-action-btn delete",onClick:s(()=>a.deleteRole(n.id),"onClick"),title:"Delete",children:"ðŸ—‘ï¸"})]})]},n.id))})]}),a.showCreateModal&&e.jsx(k,{role:a.newRole,setRole:a.setNewRole,onSave:a.createRole,onCancel:s(()=>a.setShowCreateModal(!1),"onCancel"),title:"Create New Role",saveLabel:"Create Role"}),a.editingRole&&e.jsx(k,{role:a.editingRole,setRole:a.setEditingRole,onSave:s(()=>a.updateRole(a.editingRole.id,a.editingRole),"onSave"),onCancel:s(()=>a.setEditingRole(null),"onCancel"),title:"Edit Role",saveLabel:"Save Changes"})]})})},"RolesManager");export{Q as default};
