var O=Object.defineProperty;var s=(o,r)=>O(o,"name",{value:r,configurable:!0});import{r as m,j as e}from"./react-core-Djgtqrmb.js";import{d as T}from"./index-D09YXCFH.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";import"./ui-vendor-IhB9Znpc.js";const R={name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0},$=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}],L=s(o=>{const[r,a]=m.useState([]),[n,d]=m.useState(!0),[x,t]=m.useState(!1),[k,f]=m.useState(null),[p,b]=m.useState(null),[j,N]=m.useState(R),h=s(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),"authHeaders");m.useEffect(()=>{y()},[o]);const y=s(async()=>{try{d(!0);const l=await fetch(`/api/roles/${o}/list/`,{headers:h()});if(l.ok){const i=await l.json();a(i.roles||[])}}catch{}finally{d(!1)}},"fetchRoles"),w=s(async()=>{if(j.name.trim())try{const l=await fetch(`/api/roles/${o}/create/`,{method:"POST",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify(j)});if(l.ok){const i=await l.json();a([...r,i.role]),t(!1),N(R)}}catch{}},"createRole"),S=s(async(l,i)=>{try{const c=await fetch(`/api/roles/${o}/${l}/update/`,{method:"PUT",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify(i)});if(c.ok){const v=await c.json();a(r.map(g=>g.id===l?v.role:g)),f(null)}}catch{}},"updateRole"),D=s(async l=>{if(await T("Are you sure you want to delete this role?"))try{(await fetch(`/api/roles/${o}/${l}/delete/`,{method:"DELETE",headers:h()})).ok&&a(r.filter(c=>c.id!==l))}catch{}},"deleteRole"),E=s(async l=>{try{await fetch(`/api/roles/${o}/reorder/`,{method:"POST",headers:{...h(),"Content-Type":"application/json"},body:JSON.stringify({order:l})}),y()}catch{}},"reorderRoles");return{roles:r,loading:n,showCreateModal:x,setShowCreateModal:t,editingRole:k,setEditingRole:f,draggedRole:p,newRole:j,setNewRole:N,createRole:w,updateRole:S,deleteRole:D,copyRole:s(async l=>{try{const i=await fetch(`/api/roles/${o}/${l}/copy/`,{method:"POST",headers:h()});if(i.ok){const c=await i.json();a([...r,c.role])}}catch{}},"copyRole"),handleDragStart:s((l,i)=>{b(i),l.dataTransfer.effectAllowed="move"},"handleDragStart"),handleDragOver:s(l=>{l.preventDefault(),l.dataTransfer.dropEffect="move"},"handleDragOver"),handleDrop:s((l,i)=>{if(l.preventDefault(),!p||p.id===i.id)return;const c=[...r],v=c.findIndex(u=>u.id===p.id),g=c.findIndex(u=>u.id===i.id);c.splice(v,1),c.splice(g,0,p),a(c),E(c.map(u=>u.id)),b(null)},"handleDrop")}},"useRolesManager"),C=s(({role:o,setRole:r,onSave:a,onCancel:n,title:d,saveLabel:x})=>e.jsx("div",{className:"role-modal-overlay",onClick:n,children:e.jsxs("div",{className:"role-modal",onClick:s(t=>t.stopPropagation(),"onClick"),children:[e.jsx("h3",{children:d}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:o.name,onChange:s(t=>r({...o,name:t.target.value}),"onChange"),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[$.map(t=>e.jsx("button",{className:`color-preset ${o.color===t.value?"active":""}`,style:{backgroundColor:t.value},onClick:s(()=>r({...o,color:t.value}),"onClick"),title:t.name},t.value)),e.jsx("input",{type:"color",value:o.color,onChange:s(t=>r({...o,color:t.target.value}),"onChange"),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.hoist,onChange:s(t=>r({...o,hoist:t.target.checked}),"onChange")}),e.jsx("span",{children:"Display role members separately from online members"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.mentionable,onChange:s(t=>r({...o,mentionable:t.target.checked}),"onChange")}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:n,children:"Cancel"}),e.jsx("button",{className:d.includes("Edit")?"save-btn":"create-btn",onClick:a,children:x})]})]})}),"RoleFormModal"),K=s(({serverId:o,onClose:r})=>{const a=L(o);return a.loading?e.jsx("div",{className:"roles-manager-overlay",children:e.jsx("div",{className:"roles-manager-modal",children:e.jsx("div",{className:"loading-spinner",children:"Loading roles..."})})}):e.jsx("div",{className:"roles-manager-overlay",onClick:r,children:e.jsxs("div",{className:"roles-manager-modal",onClick:s(n=>n.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"roles-manager-header",children:[e.jsxs("h2",{children:["ðŸŽ­"," Server Roles"]}),e.jsx("button",{className:"close-btn",onClick:r,children:"âœ•"})]}),e.jsxs("div",{className:"roles-manager-content",children:[e.jsxs("div",{className:"roles-actions",children:[e.jsxs("button",{className:"create-role-btn",onClick:s(()=>a.setShowCreateModal(!0),"onClick"),children:["âž•"," Create Role"]}),e.jsxs("div",{className:"roles-info",children:[e.jsxs("span",{children:[a.roles.length," roles"]}),e.jsxs("span",{className:"info-tip",children:["ðŸ’¡"," Drag to reorder hierarchy"]})]})]}),e.jsx("div",{className:"roles-list",children:a.roles.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ­"}),e.jsx("h3",{children:"No Roles Yet"}),e.jsx("p",{children:"Create roles to organize your server members"})]}):a.roles.map(n=>e.jsxs("div",{className:`role-card ${a.draggedRole?.id===n.id?"dragging":""}`,draggable:!0,onDragStart:s(d=>a.handleDragStart(d,n),"onDragStart"),onDragOver:a.handleDragOver,onDrop:s(d=>a.handleDrop(d,n),"onDrop"),children:[e.jsx("div",{className:"role-drag-handle",children:"â˜°"}),e.jsx("div",{className:"role-color-badge",style:{backgroundColor:n.color}}),e.jsxs("div",{className:"role-info",children:[e.jsx("div",{className:"role-name",style:{color:n.color},children:n.name}),e.jsxs("div",{className:"role-meta",children:[e.jsxs("span",{className:"role-members",children:["ðŸ‘¥"," ",n.member_count||0," members"]}),n.hoist&&e.jsxs("span",{className:"role-badge",children:["ðŸ“Œ"," Hoisted"]}),n.mentionable&&e.jsx("span",{className:"role-badge",children:"@ Mentionable"})]})]}),e.jsxs("div",{className:"role-actions",children:[e.jsx("button",{className:"role-action-btn edit",onClick:s(()=>a.setEditingRole(n),"onClick"),title:"Edit",children:"âœï¸"}),e.jsx("button",{className:"role-action-btn copy",onClick:s(()=>a.copyRole(n.id),"onClick"),title:"Copy",children:"ðŸ“‹"}),e.jsx("button",{className:"role-action-btn delete",onClick:s(()=>a.deleteRole(n.id),"onClick"),title:"Delete",children:"ðŸ—‘ï¸"})]})]},n.id))})]}),a.showCreateModal&&e.jsx(C,{role:a.newRole,setRole:a.setNewRole,onSave:a.createRole,onCancel:s(()=>a.setShowCreateModal(!1),"onCancel"),title:"Create New Role",saveLabel:"Create Role"}),a.editingRole&&e.jsx(C,{role:a.editingRole,setRole:a.setEditingRole,onSave:s(()=>a.updateRole(a.editingRole.id,a.editingRole),"onSave"),onCancel:s(()=>a.setEditingRole(null),"onCancel"),title:"Edit Role",saveLabel:"Save Changes"})]})})},"RolesManager");export{K as default};
