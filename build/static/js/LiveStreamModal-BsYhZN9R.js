import{r as c,N as m,l as _,ax as B,O as T,cG as z,L as N,a2 as L,K as j}from"./react-core-B6hadH-M.js";import{t as P}from"./index-D_6pZib5.js";const U=({onClose:p,roomSlug:x,ws:a,token:H,isMobile:r})=>{const[u,y]=c.useState(!1),[s,E]=c.useState(!1),[g,h]=c.useState("camera"),[S,v]=c.useState(0),[k,C]=c.useState([]),[f,R]=c.useState(""),d=c.useRef(null),i=c.useRef(null),b=c.useRef({}),w={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};c.useEffect(()=>{if(!a.current)return;const e=o=>{try{const n=JSON.parse(o.data);n.type==="stream_viewer_count"?v(n.count):n.type==="stream_chat"?C(l=>[...l,{id:Date.now(),user:n.username,message:n.message,timestamp:new Date().toLocaleTimeString()}]):n.type==="stream_viewer_join"&&W(n.viewerId)}catch(n){console.error("Stream WS error:",n)}};return a.current.addEventListener("message",e),()=>a.current?.removeEventListener("message",e)},[a]),c.useEffect(()=>{const e=o=>{o.key==="Escape"&&p()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p]);const I=async()=>{try{let e;g==="camera"?e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}):e=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0}),i.current=e,d.current&&(d.current.srcObject=e),y(!0),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_start",room_slug:x,stream_type:g}))}catch(e){console.error("Failed to start stream:",e),P.error("âŒ Failed to start stream. Please check permissions.")}},F=()=>{i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null),Object.values(b.current).forEach(e=>e.close()),b.current={},d.current&&(d.current.srcObject=null),y(!1),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_stop",room_slug:x}))},D=()=>{i.current&&(i.current.getAudioTracks().forEach(e=>{e.enabled=s}),E(!s))},O=e=>{e.preventDefault(),f.trim()&&(a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_chat",room_slug:x,message:f})),R(""))},W=async e=>{if(!i.current)return;const o=new RTCPeerConnection(w);b.current[e]=o,i.current.getTracks().forEach(l=>{o.addTrack(l,i.current)}),o.onicecandidate=l=>{l.candidate&&a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"ice_candidate",candidate:l.candidate,viewer_id:e}))};const n=await o.createOffer();await o.setLocalDescription(n),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_offer",sdp:o.localDescription,viewer_id:e}))},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:r?"0":"20px"},modal:{width:"100%",maxWidth:r?"100%":"1400px",height:r?"100%":"auto",maxHeight:"90vh",background:"linear-gradient(135deg, rgba(30, 31, 34, 0.98), rgba(35, 36, 40, 0.98))",borderRadius:r?"0":"16px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(218, 55, 60, 0.3)",border:r?"none":"1px solid rgba(218, 55, 60, 0.4)"},header:{padding:r?"12px 16px":"16px 24px",background:"linear-gradient(135deg, rgba(218, 55, 60, 0.15), rgba(240, 71, 71, 0.15))",borderBottom:"1px solid rgba(218, 55, 60, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:r?"18px":"22px",fontWeight:"700",color:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",gap:"10px"},liveIndicator:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",background:"rgba(218, 55, 60, 0.3)",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#da373c",border:"1px solid rgba(218, 55, 60, 0.5)"},liveD:{width:"8px",height:"8px",background:"#da373c",borderRadius:"50%",animation:"pulse 1.5s ease-in-out infinite"},closeBtn:{background:"rgba(218, 55, 60, 0.2)",border:"1px solid rgba(218, 55, 60, 0.4)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#da373c",fontSize:"18px"},content:{flex:1,display:"flex",flexDirection:r?"column":"row",overflow:"hidden"},streamSection:{flex:1,display:"flex",flexDirection:"column",background:"#000",position:"relative"},videoContainer:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",position:"relative"},video:{width:"100%",height:"100%",objectFit:"contain"},placeholder:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)"},viewerCount:{position:"absolute",top:"16px",right:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",borderRadius:"20px",fontSize:"14px",fontWeight:"600",color:"white"},controls:{padding:"16px",background:"rgba(0, 0, 0, 0.8)",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},controlBtn:e=>({padding:"12px 24px",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",minHeight:"44px",background:e?"rgba(218, 55, 60, 0.3)":"rgba(88, 101, 242, 0.2)",color:e?"#da373c":"rgba(255, 255, 255, 0.9)",border:`1px solid ${e?"rgba(218, 55, 60, 0.5)":"rgba(88, 101, 242, 0.4)"}`}),startBtn:{padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"linear-gradient(135deg, #da373c, #f04747)",color:"white",transition:"all 0.2s ease",minHeight:"48px"},chatSection:{width:r?"100%":"350px",maxHeight:r?"300px":"auto",background:"rgba(0, 0, 0, 0.3)",borderLeft:r?"none":"1px solid rgba(218, 55, 60, 0.2)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(218, 55, 60, 0.2)",fontSize:"16px",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)"},chatMessages:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px"},chatMessage:{padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"14px"},chatUsername:{fontWeight:"600",color:"#5865f2",marginBottom:"4px"},chatText:{color:"rgba(255, 255, 255, 0.8)"},chatInput:{padding:"12px",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"8px"},input:{flex:1,padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(218, 55, 60, 0.3)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.95)",fontSize:"14px",outline:"none"},sendBtn:{padding:"12px 20px",background:"linear-gradient(135deg, #da373c, #f04747)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:"pointer",minHeight:"44px"}};return React.createElement(React.Fragment,null,React.createElement("style",null,`
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
            `),React.createElement("div",{style:t.overlay,onClick:p},React.createElement("div",{style:t.modal,onClick:e=>e.stopPropagation()},React.createElement("div",{style:t.header},React.createElement("h2",{style:t.title},React.createElement(m,null),"Live Stream",u&&React.createElement("span",{style:t.liveIndicator},React.createElement("span",{style:t.liveDot}),"LIVE")),React.createElement("button",{onClick:p,style:t.closeBtn},React.createElement(_,null))),React.createElement("div",{style:t.content},React.createElement("div",{style:t.streamSection},React.createElement("div",{style:t.videoContainer},u?React.createElement(React.Fragment,null,React.createElement("video",{ref:d,autoPlay:!0,muted:!0,style:t.video}),React.createElement("div",{style:t.viewerCount},React.createElement(B,null),S," viewers")):React.createElement("div",{style:t.placeholder},React.createElement(m,{size:64}),React.createElement("p",{style:{marginTop:"16px",fontSize:"18px"}},'Click "Start Stream" to begin'))),React.createElement("div",{style:t.controls},u?React.createElement(React.Fragment,null,React.createElement("button",{onClick:D,style:t.controlBtn(s)},s?React.createElement(z,null):React.createElement(N,null),s?"Unmute":"Mute"),React.createElement("button",{onClick:F,style:{...t.startBtn,background:"linear-gradient(135deg, #da373c, #b83030)"}},React.createElement(L,null),"Stop Stream")):React.createElement(React.Fragment,null,React.createElement("button",{onClick:()=>h("camera"),style:t.controlBtn(g==="camera")},React.createElement(m,null),"Camera"),React.createElement("button",{onClick:()=>h("screen"),style:t.controlBtn(g==="screen")},React.createElement(T,null),"Screen"),React.createElement("button",{onClick:I,style:t.startBtn},React.createElement(m,null),"Start Stream")))),u&&React.createElement("div",{style:t.chatSection},React.createElement("div",{style:t.chatHeader},React.createElement(j,null)," Stream Chat"),React.createElement("div",{style:t.chatMessages},k.map(e=>React.createElement("div",{key:e.id,style:t.chatMessage},React.createElement("div",{style:t.chatUsername},e.user),React.createElement("div",{style:t.chatText},e.message)))),React.createElement("form",{onSubmit:O,style:t.chatInput},React.createElement("input",{type:"text",value:f,onChange:e=>R(e.target.value),placeholder:"Send a message...",style:t.input}),React.createElement("button",{type:"submit",style:t.sendBtn},"Send")))))))};export{U as default};
