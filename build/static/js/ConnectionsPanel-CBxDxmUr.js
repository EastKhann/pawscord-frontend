import{r as o,U as b,l as P,A as f,aW as v,cP as S,cQ as A,cR as B,cS as z,cT as x,cU as D,cV as G,bK as y,bR as L,V as H,cW as I}from"./react-core-B6hadH-M.js";import{a as U,g as X,t as r}from"./index-D_6pZib5.js";const M=({onClose:d})=>{const{token:p,user:g}=U(),[N,k]=o.useState({}),[C,w]=o.useState(!0),[F,s]=o.useState(null),n=o.useRef(null),l=o.useRef(null),m=X().replace("/api",""),R=[{id:"spotify",name:"Spotify",icon:S,color:"#1DB954",description:"Dinlediğin müziği profilinde göster",oauth:!0,features:["Now Playing","Rich Presence"]},{id:"steam",name:"Steam",icon:A,color:"#171A21",description:"Oynadığın oyunları profilinde göster",oauth:!0,features:["Game Activity","Rich Presence","Achievements"]},{id:"xbox",name:"Xbox",icon:B,color:"#107C10",description:"Xbox Live hesabını bağla",oauth:!0,features:["Gamertag","Game Activity","Achievements"]},{id:"twitch",name:"Twitch",icon:z,color:"#9146FF",description:"Twitch yayın durumunu göster",oauth:!0,features:["Stream Status","Rich Presence"]},{id:"github",name:"GitHub",icon:x,color:"#333333",description:"GitHub profilini bağla",oauth:!0,features:["Repositories","Contributions","Profile"]},{id:"youtube",name:"YouTube",icon:D,color:"#FF0000",description:"YouTube kanalını bağla",oauth:!0,features:["Channel","Subscribers","Videos"]},{id:"discord",name:"Discord",icon:G,color:"#5865F2",description:"Discord hesabını bağla (migration)",oauth:!0,features:["Profile","Friends Import"]}],u=o.useCallback(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),1e4);try{const a=await fetch(`${m}/api/connections/status/`,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},signal:e.signal});if(clearTimeout(t),a.ok){const c=await a.json();k(c.connections||{})}}catch(a){a.name==="AbortError"?(console.error("Connections loading timeout (10s)"),r.error("Bağlantılar yüklenemedi - zaman aşımı")):console.error("Failed to load connections:",a)}finally{w(!1)}},[p,m]);o.useEffect(()=>(u(),()=>{n.current&&clearInterval(n.current),l.current&&clearTimeout(l.current)}),[u]);const $=e=>{n.current&&clearInterval(n.current),l.current&&clearTimeout(l.current),s(e);const t=500,a=700,c=window.screenX+(window.outerWidth-t)/2,h=window.screenY+(window.outerHeight-a)/2,i=window.open(`${m}/api/auth/${e}/start/?username=${g?.username||"anonymous"}`,`${e}_oauth`,`width=${t},height=${a},left=${c},top=${h},toolbar=no,menubar=no`);if(!i){r.error("Popup blocker tarafından engellendi. Lütfen popup'lara izin verin."),s(null);return}n.current=setInterval(()=>{i.closed&&(clearInterval(n.current),n.current=null,s(null),u(),r.success(`${e} bağlantısı kontrol ediliyor...`))},500),l.current=setTimeout(()=>{n.current&&(clearInterval(n.current),n.current=null),i.closed||i.close(),s(null)},12e4)},T=async e=>{if(confirm(`${e} bağlantısını kesmek istediğinize emin misiniz?`)){s(e);try{(await fetch(`${m}/api/connections/${e}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}})).ok?(r.success(`${e} bağlantısı kesildi`),u()):r.error("Bağlantı kesilemedi")}catch(t){console.error("Disconnect error:",t),r.error("Bağlantı kesme hatası")}finally{s(null)}}},E=e=>{const t=N[e.id],a=t?.connected,c=F===e.id,h=e.icon;return React.createElement("div",{key:e.id,className:`connection-card ${a?"connected":""}`,style:{"--platform-color":e.color}},React.createElement("div",{className:"connection-header"},React.createElement("div",{className:"platform-icon",style:{backgroundColor:e.color}},React.createElement(h,null)),React.createElement("div",{className:"platform-info"},React.createElement("h3",null,e.name),React.createElement("p",null,e.description))),a&&t.username&&React.createElement("div",{className:"connection-details"},React.createElement("span",{className:"connected-as"},React.createElement(H,{className:"status-icon success"}),"Bağlı: ",React.createElement("strong",null,t.username)),t.data&&React.createElement("div",{className:"connection-data"},t.data.game&&React.createElement("span",{className:"activity"},React.createElement(v,null)," ",t.data.game),t.data.track&&React.createElement("span",{className:"activity"},React.createElement(y,null)," ",t.data.track))),React.createElement("div",{className:"connection-features"},e.features.map(i=>React.createElement("span",{key:i,className:"feature-tag"},i))),React.createElement("div",{className:"connection-actions"},a?React.createElement("button",{className:"disconnect-btn",onClick:()=>T(e.id),disabled:c},c?React.createElement(b,{className:"spin"}):React.createElement(I,null),"Bağlantıyı Kes"):React.createElement("button",{className:"connect-btn",onClick:()=>$(e.id),disabled:c,style:{backgroundColor:e.color}},c?React.createElement(b,{className:"spin"}):React.createElement(f,null),"Bağlan")))};return C?React.createElement("div",{className:"connections-modal-overlay",onClick:d},React.createElement("div",{className:"connections-modal",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"connections-panel loading"},React.createElement(b,{className:"spin large"}),React.createElement("p",null,"Bağlantılar yükleniyor...")))):React.createElement("div",{className:"connections-modal-overlay",onClick:d},React.createElement("div",{className:"connections-modal",onClick:e=>e.stopPropagation()},React.createElement("button",{className:"connections-close-btn",onClick:d},React.createElement(P,null)),React.createElement("div",{className:"connections-panel"},React.createElement("div",{className:"connections-header"},React.createElement("h2",null,React.createElement(f,null)," Bağlantılar"),React.createElement("p",null,"Hesaplarını bağlayarak profilini zenginleştir ve aktivitelerini göster")),React.createElement("div",{className:"connections-grid"},React.createElement("div",{className:"connection-section"},React.createElement("h3",{className:"section-title"},React.createElement(v,null)," Oyun Platformları"),React.createElement("div",{className:"platforms-grid"},R.filter(e=>["steam","epic","xbox","playstation","battlenet","riot"].includes(e.id)).map(E))),React.createElement("div",{className:"connection-section"},React.createElement("h3",{className:"section-title"},React.createElement(y,null)," Müzik & Streaming"),React.createElement("div",{className:"platforms-grid"},R.filter(e=>["spotify","twitch","youtube"].includes(e.id)).map(E))),React.createElement("div",{className:"connection-section"},React.createElement("h3",{className:"section-title"},React.createElement(f,null)," Sosyal Medya"),React.createElement("div",{className:"platforms-grid"},R.filter(e=>["discord","twitter","github"].includes(e.id)).map(E)))),React.createElement("div",{className:"connections-footer"},React.createElement("p",{className:"privacy-note"},React.createElement(L,null),"Bağlantılar sadece izin verdiğin bilgilere erişir. İstediğin zaman bağlantıyı kesebilirsin.")))))};export{M as default};
