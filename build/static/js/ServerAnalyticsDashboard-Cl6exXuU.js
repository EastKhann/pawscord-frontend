import{r as p,j as e,e as _}from"./react-core-D6cE4lil.js";import{aa as w,ab as R,O as T,a as z,u as C,ac as B,z as L,aF as D}from"./icons-vendor-fClA8qVL.js";const I=({serverId:o,fetchWithAuth:r,apiBaseUrl:i})=>{const[n,d]=p.useState(null),[x,s]=p.useState(null),[c,f]=p.useState(!0),[h,j]=p.useState("30d"),g=p.useCallback(async()=>{if(o){f(!0);try{const[m,a]=await Promise.all([r(`${i}/servers/${o}/analytics/?period=${h}`),r(`${i}/servers/${o}/analytics/compare/`)]);if(m.ok){const l=await m.json();d(l)}if(a.ok){const l=await a.json();s(l)}}catch{}finally{f(!1)}}},[o,h,r,i]);return{analytics:n,comparison:x,loading:c,period:h,setPeriod:j,fetchAnalytics:g}},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},modal:{width:"95%",maxWidth:"1200px",maxHeight:"90vh",backgroundColor:"#2f3136",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #202225"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerRight:{display:"flex",alignItems:"center",gap:"12px"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",margin:0},periodSelect:{padding:"8px 12px",backgroundColor:"#36393f",border:"1px solid #40444b",borderRadius:"4px",color:"#dcddde",fontSize:"14px",cursor:"pointer"},closeBtn:{background:"none",border:"none",color:"#72767d",fontSize:"20px",cursor:"pointer",padding:"4px"},content:{flex:1,overflowY:"auto",padding:"24px"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px",color:"#72767d",gap:"16px"},spinner:{width:"40px",height:"40px",border:"3px solid #36393f",borderTopColor:"#5865f2",borderRadius:"50%",animation:"spin 1s linear infinite"},errorState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px",color:"#dcddde",textAlign:"center"},statsRow:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},statCard:{display:"flex",alignItems:"center",gap:"16px",padding:"20px",backgroundColor:"#36393f",borderRadius:"8px"},statIcon:{width:"48px",height:"48px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px"},statInfo:{display:"flex",flexDirection:"column"},statLabel:{color:"#72767d",fontSize:"12px",marginBottom:"4px"},statValue:{color:"#fff",fontSize:"24px",fontWeight:"700"},statSubtext:{color:"#72767d",fontSize:"11px"},statChange:{fontSize:"12px",display:"flex",alignItems:"center",gap:"4px",marginTop:"4px"},chartsRow:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:"16px",marginBottom:"24px"},chartCard:{backgroundColor:"#36393f",borderRadius:"8px",padding:"20px"},chartTitle:{color:"#fff",fontSize:"14px",fontWeight:"600",marginBottom:"16px"},barChart:{display:"flex",alignItems:"flex-end",gap:"4px",height:"120px"},barContainer:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",height:"100%"},bar:{width:"100%",backgroundColor:"#5865f2",borderRadius:"4px 4px 0 0",transition:"height 0.3s",minHeight:"4px"},barLabel:{color:"#72767d",fontSize:"10px",marginTop:"4px"},hourlyChart:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:"4px"},hourBlock:{aspectRatio:"1",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"10px",cursor:"default"},listsRow:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px",marginBottom:"24px"},listCard:{backgroundColor:"#36393f",borderRadius:"8px",padding:"20px"},listTitle:{color:"#fff",fontSize:"14px",fontWeight:"600",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},list:{display:"flex",flexDirection:"column",gap:"8px"},listItem:{display:"flex",alignItems:"center",gap:"12px",padding:"8px 12px",backgroundColor:"#2f3136",borderRadius:"4px"},listRank:{color:"#5865f2",fontWeight:"600",width:"24px"},listName:{color:"#dcddde",flex:1},listValue:{color:"#72767d",fontSize:"12px"},emptyList:{color:"#72767d",textAlign:"center",padding:"20px"},pieChart:{display:"flex",flexDirection:"column",gap:"12px"},contentBarContainer:{display:"flex",flexDirection:"column",gap:"4px"},contentBarLabel:{display:"flex",justifyContent:"space-between",color:"#dcddde",fontSize:"12px"},contentBarTrack:{height:"8px",backgroundColor:"#202225",borderRadius:"4px",overflow:"hidden"},contentBarFill:{height:"100%",borderRadius:"4px",transition:"width 0.3s"},comparisonSection:{backgroundColor:"#36393f",borderRadius:"8px",padding:"20px"},sectionTitle:{color:"#fff",fontSize:"14px",fontWeight:"600",marginBottom:"16px"},comparisonGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},comparisonCard:{backgroundColor:"#2f3136",borderRadius:"8px",padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},comparisonLabel:{color:"#fff",fontWeight:"600"},comparisonValues:{display:"flex",gap:"24px"},comparisonValue:{display:"flex",flexDirection:"column"},comparisonPeriod:{color:"#72767d",fontSize:"11px"},comparisonNumber:{color:"#dcddde",fontSize:"18px",fontWeight:"600"},comparisonChange:{fontSize:"14px"}},y=({icon:o,label:r,value:i,subtext:n,change:d,color:x})=>e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:{...t.statIcon,backgroundColor:x},children:o}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("span",{style:t.statLabel,children:r}),e.jsx("span",{style:t.statValue,children:typeof i=="number"?i.toLocaleString():i}),n&&e.jsx("span",{style:t.statSubtext,children:n}),d!==void 0&&e.jsxs("span",{style:{...t.statChange,color:d>=0?"#43b581":"#f04747"},children:[d>=0?e.jsx(w,{}):e.jsx(R,{})," ",Math.abs(d),"%"]})]})]}),u=({label:o,value:r,total:i,color:n})=>{const d=i>0?Math.round(r/i*100):0;return e.jsxs("div",{style:t.contentBarContainer,children:[e.jsxs("div",{style:t.contentBarLabel,children:[e.jsx("span",{children:o}),e.jsxs("span",{children:[r," (",d,"%)"]})]}),e.jsx("div",{style:t.contentBarTrack,children:e.jsx("div",{style:{...t.contentBarFill,width:`${d}%`,backgroundColor:n}})})]})},k=({label:o,thisWeek:r,lastWeek:i,change:n})=>e.jsxs("div",{style:t.comparisonCard,children:[e.jsx("span",{style:t.comparisonLabel,children:o}),e.jsxs("div",{style:t.comparisonValues,children:[e.jsxs("div",{style:t.comparisonValue,children:[e.jsx("span",{style:t.comparisonPeriod,children:"Bu Hafta"}),e.jsx("span",{style:t.comparisonNumber,children:r?.toLocaleString()||0})]}),e.jsxs("div",{style:t.comparisonValue,children:[e.jsxs("span",{style:t.comparisonPeriod,children:["Ge","Ã§","en Hafta"]}),e.jsx("span",{style:t.comparisonNumber,children:i?.toLocaleString()||0})]})]}),n!==void 0&&e.jsxs("span",{style:{...t.comparisonChange,color:n>=0?"#43b581":"#f04747"},children:[n>=0?"ðŸ“ˆ":"ðŸ“‰"," ",n>=0?"+":"",n,"%"]})]}),F=({isOpen:o,onClose:r,serverId:i,serverName:n,fetchWithAuth:d,apiBaseUrl:x})=>{const{analytics:s,comparison:c,loading:f,period:h,setPeriod:j,fetchAnalytics:g}=I({serverId:i,fetchWithAuth:d,apiBaseUrl:x});if(p.useEffect(()=>{o&&i&&g()},[o,i,g]),!o)return null;const m=e.jsx("div",{style:t.overlay,onClick:r,children:e.jsxs("div",{style:t.modal,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(T,{style:{color:"#5865f2"}}),e.jsxs("h2",{style:t.title,children:[n||"Sunucu"," Analytics"]})]}),e.jsxs("div",{style:t.headerRight,children:[e.jsxs("select",{value:h,onChange:a=>j(a.target.value),style:t.periodSelect,children:[e.jsxs("option",{value:"7d",children:["Son 7 G","Ã¼","n"]}),e.jsxs("option",{value:"30d",children:["Son 30 G","Ã¼","n"]}),e.jsxs("option",{value:"90d",children:["Son 90 G","Ã¼","n"]})]}),e.jsx("button",{onClick:r,style:t.closeBtn,children:e.jsx(z,{})})]})]}),e.jsx("div",{style:t.content,children:f?e.jsxs("div",{style:t.loadingState,children:[e.jsx("div",{style:t.spinner}),e.jsxs("span",{children:["Veriler y","Ã¼","kleniyor..."]})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:t.statsRow,children:[e.jsx(y,{icon:e.jsx(C,{}),label:"Toplam Ãœye",value:s.member_growth?.total||0,change:c?.change?.active_users,color:"#5865f2"}),e.jsx(y,{icon:e.jsx(B,{}),label:"Toplam Mesaj",value:s.message_stats?.total||0,subtext:`GÃ¼nlÃ¼k ort: ${s.message_stats?.daily_average||0}`,change:c?.change?.messages,color:"#43b581"}),e.jsx(y,{icon:e.jsx(C,{}),label:"Aktif Ãœye",value:s.active_users?.total||0,subtext:`%${s.active_users?.activity_rate||0} aktivite`,color:"#faa61a"}),e.jsx(y,{icon:e.jsx(L,{}),label:"En YoÄŸun Saat",value:s.peak_hours?.peak_hour_label||"-",color:"#f04747"})]}),e.jsxs("div",{style:t.chartsRow,children:[e.jsxs("div",{style:t.chartCard,children:[e.jsxs("h3",{style:t.chartTitle,children:["ðŸ“ˆ"," Mesaj Aktivitesi"]}),e.jsx("div",{style:t.barChart,children:s.message_stats?.daily?.slice(-14).map((a,l)=>{const b=Math.max(...s.message_stats?.daily?.map(S=>S.count)||[1]),v=a.count/b*100;return e.jsxs("div",{style:t.barContainer,children:[e.jsx("div",{style:{...t.bar,height:`${Math.max(v,5)}%`},title:`${a.date}: ${a.count} mesaj`}),e.jsx("span",{style:t.barLabel,children:new Date(a.date).getDate()})]},l)})})]}),e.jsxs("div",{style:t.chartCard,children:[e.jsxs("h3",{style:t.chartTitle,children:["â°"," Saatlik Aktivite"]}),e.jsx("div",{style:t.hourlyChart,children:s.peak_hours?.hourly?.map((a,l)=>{const b=Math.max(...s.peak_hours?.hourly||[1]),v=a/b;return e.jsx("div",{style:{...t.hourBlock,backgroundColor:`rgba(88, 101, 242, ${Math.max(v,.1)})`},title:`${l}:00 - ${a} mesaj`,children:l},l)})})]})]}),e.jsxs("div",{style:t.listsRow,children:[e.jsxs("div",{style:t.listCard,children:[e.jsxs("h3",{style:t.listTitle,children:[e.jsx(D,{})," Pop","Ã¼","ler Kanallar"]}),e.jsxs("div",{style:t.list,children:[s.popular_channels?.slice(0,5).map((a,l)=>e.jsxs("div",{style:t.listItem,children:[e.jsxs("span",{style:t.listRank,children:["#",l+1]}),e.jsx("span",{style:t.listName,children:a.name}),e.jsxs("span",{style:t.listValue,children:[a.messages," mesaj"]})]},l)),(!s.popular_channels||s.popular_channels.length===0)&&e.jsx("div",{style:t.emptyList,children:"Veri yok"})]})]}),e.jsxs("div",{style:t.listCard,children:[e.jsxs("h3",{style:t.listTitle,children:[e.jsx(C,{})," En Aktif ","Ãœ","yeler"]}),e.jsxs("div",{style:t.list,children:[s.active_users?.top_users?.slice(0,5).map((a,l)=>e.jsxs("div",{style:t.listItem,children:[e.jsxs("span",{style:t.listRank,children:["#",l+1]}),e.jsx("span",{style:t.listName,children:a.username}),e.jsxs("span",{style:t.listValue,children:[a.messages," mesaj"]})]},l)),(!s.active_users?.top_users||s.active_users.top_users.length===0)&&e.jsx("div",{style:t.emptyList,children:"Veri yok"})]})]}),e.jsxs("div",{style:t.listCard,children:[e.jsxs("h3",{style:t.listTitle,children:["ðŸ“Š"," ","Ä°Ã§","erik Da","ÄŸÄ±","l","Ä±","m","Ä±"]}),e.jsx("div",{style:t.pieChart,children:s.content_breakdown&&e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Metin",value:s.content_breakdown.text_only,total:s.message_stats?.total||1,color:"#5865f2"}),e.jsx(u,{label:"Resimli",value:s.content_breakdown.with_images,total:s.message_stats?.total||1,color:"#43b581"}),e.jsx(u,{label:"DosyalÄ±",value:s.content_breakdown.with_files,total:s.message_stats?.total||1,color:"#faa61a"}),e.jsx(u,{label:"Ses",value:s.content_breakdown.voice_messages,total:s.message_stats?.total||1,color:"#f04747"})]})})]})]}),c&&e.jsxs("div",{style:t.comparisonSection,children:[e.jsxs("h3",{style:t.sectionTitle,children:["ðŸ“Š"," Haftal","Ä±","k Kar","ÅŸÄ±","la","ÅŸ","t","Ä±","rma"]}),e.jsxs("div",{style:t.comparisonGrid,children:[e.jsx(k,{label:"Mesajlar",thisWeek:c.this_week?.messages,lastWeek:c.last_week?.messages,change:c.change?.messages}),e.jsx(k,{label:"Aktif Ãœyeler",thisWeek:c.this_week?.active_users,lastWeek:c.last_week?.active_users,change:c.change?.active_users})]})]})]}):e.jsxs("div",{style:t.errorState,children:[e.jsx("span",{style:{fontSize:"48px"},children:"ðŸ“Š"}),e.jsxs("p",{children:["Analytics verileri y","Ã¼","klenemedi"]})]})})]})});return _.createPortal(m,document.body)};export{F as default};
