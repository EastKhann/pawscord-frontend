import{r as i,b as e}from"./react-core-9vc7GIjk.js";import{aT as S,a as k,aa as L}from"./icons-vendor-BHKL7tCa.js";import{t as f}from"./index-BgtTyGBp.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const $=({fetchWithAuth:g,apiBaseUrl:x,onClose:u,entityType:s,entityId:y})=>{const[n,h]=i.useState([]),[b,p]=i.useState(!1),[d,v]=i.useState("all");i.useEffect(()=>{E()},[]);const E=async()=>{p(!0);try{const l=await(await g(`${x}/api/audit/field-changes/?entity_type=${s}&entity_id=${y}`)).json();h(l.changes||[])}catch{f.error("Failed to load change history")}finally{p(!1)}},w=()=>{const a=[["Date","Field","Old Value","New Value","Changed By"],...c.map(o=>[new Date(o.changed_at).toLocaleString(),o.field_name,o.old_value||"",o.new_value||"",o.changed_by_username])].map(o=>o.map(_=>`"${_}"`).join(",")).join(`
`),l=new Blob([a],{type:"text/csv"}),m=window.URL.createObjectURL(l),r=document.createElement("a");r.href=m,r.download=`field_changes_${s}_${Date.now()}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(m),document.body.removeChild(r),f.success("Changes exported")},C=[...new Set(n.map(a=>a.field_name))],c=d==="all"?n:n.filter(a=>a.field_name===d);return e.createElement("div",{style:t.overlay},e.createElement("div",{style:t.modal},e.createElement("div",{style:t.header},e.createElement("div",{style:t.headerLeft},e.createElement(S,{style:{marginRight:"10px",color:"#5865f2"}}),e.createElement("h2",{style:t.title},"Field Change History")),e.createElement("button",{onClick:u,style:t.closeButton},e.createElement(k,null))),e.createElement("div",{style:t.toolbar},e.createElement("select",{value:d,onChange:a=>v(a.target.value),style:t.filterSelect},e.createElement("option",{value:"all"},"All Fields (",n.length,")"),C.map(a=>e.createElement("option",{key:a,value:a},a," (",n.filter(l=>l.field_name===a).length,")"))),e.createElement("button",{onClick:w,style:t.exportButton},e.createElement(L,{style:{marginRight:"6px"}}),"Export")),e.createElement("div",{style:t.content},b?e.createElement("div",{style:t.loading},"Loading changes..."):c.length===0?e.createElement("div",{style:t.empty},"No changes recorded"):e.createElement("div",{style:t.changesList},c.map((a,l)=>e.createElement("div",{key:l,style:t.changeCard},e.createElement("div",{style:t.changeField},a.field_name),e.createElement("div",{style:t.changeValues},e.createElement("div",{style:t.oldValue},e.createElement("div",{style:t.valueLabel},"Old:"),e.createElement("div",{style:t.value},a.old_value||e.createElement("em",{style:{color:"#99aab5"}},"empty"))),e.createElement("div",{style:t.arrow},"â†’"),e.createElement("div",{style:t.newValue},e.createElement("div",{style:t.valueLabel},"New:"),e.createElement("div",{style:t.value},a.new_value||e.createElement("em",{style:{color:"#99aab5"}},"empty")))),e.createElement("div",{style:t.changeMeta},"Changed by ",e.createElement("span",{style:t.username},a.changed_by_username)," on ",new Date(a.changed_at).toLocaleString())))))))},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},toolbar:{display:"flex",gap:"12px",padding:"15px 20px",borderBottom:"1px solid #2c2f33"},filterSelect:{flex:1,padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},exportButton:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"13px",display:"flex",alignItems:"center"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},changesList:{display:"flex",flexDirection:"column",gap:"16px"},changeCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},changeField:{fontSize:"16px",fontWeight:"600",color:"#5865f2",marginBottom:"12px"},changeValues:{display:"flex",gap:"16px",alignItems:"center",marginBottom:"12px",padding:"12px",backgroundColor:"#1e1e1e",borderRadius:"6px"},oldValue:{flex:1},newValue:{flex:1},arrow:{fontSize:"20px",color:"#5865f2"},valueLabel:{fontSize:"12px",color:"#99aab5",marginBottom:"4px"},value:{fontSize:"14px",color:"#ffffff",wordBreak:"break-word"},changeMeta:{fontSize:"12px",color:"#99aab5"},username:{color:"#5865f2",fontWeight:"500"}};export{$ as default};
