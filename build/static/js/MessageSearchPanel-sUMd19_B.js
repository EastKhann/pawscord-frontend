import{r as c,w as i,l as T,aq as A,a1 as L,cq as k}from"./react-core-B6hadH-M.js";import{t as o}from"./index-D_6pZib5.js";const _=({serverId:d,channelId:p,onClose:u,onSelectMessage:g})=>{const[t,f]=c.useState(""),[s,y]=c.useState([]),[m,v]=c.useState(!1),[a,r]=c.useState({author:"",dateFrom:"",dateTo:"",hasAttachment:!1,hasLink:!1}),[h,b]=c.useState(!1),n=c.useRef(null);c.useEffect(()=>(t.length>=3&&(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{N()},500)),()=>{n.current&&clearTimeout(n.current)}),[t,a]);const N=async()=>{if(!t.trim()){o.error("âŒ Arama terimi girin");return}v(!0);try{const e=new URLSearchParams({q:t,...d&&{server:d},...p&&{channel:p},...a.author&&{author:a.author},...a.dateFrom&&{date_from:a.dateFrom},...a.dateTo&&{date_to:a.dateTo},...a.hasAttachment&&{has_attachment:!0},...a.hasLink&&{has_link:!0}}),l=await fetch(`/api/messages/search/?${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(l.ok){const E=await l.json();y(E.results),E.results.length===0&&o.info("â„¹ï¸ SonuÃ§ bulunamadÄ±")}else o.error("âŒ Arama hatasÄ±")}catch(e){console.error("Search error:",e),o.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{v(!1)}},F=(e,l)=>l?e.split(new RegExp(`(${l})`,"gi")).map((R,w)=>R.toLowerCase()===l.toLowerCase()?React.createElement("mark",{key:w},R):R):e,C=e=>new Date(e).toLocaleString("tr-TR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),S=e=>{g&&g(e),u()};return React.createElement("div",{className:"message-search-panel-overlay",onClick:u},React.createElement("div",{className:"message-search-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"search-header"},React.createElement(i,{className:"header-icon"}),React.createElement("h2",null,"Mesaj Ara"),React.createElement("button",{className:"close-btn",onClick:u},"Ã—")),React.createElement("div",{className:"search-input-container"},React.createElement(i,{className:"search-icon"}),React.createElement("input",{type:"text",className:"search-input",placeholder:"Mesaj ara...",value:t,onChange:e=>f(e.target.value),onKeyPress:e=>e.key==="Enter"&&N(),autoFocus:!0}),t&&React.createElement("button",{className:"clear-btn",onClick:()=>f("")},React.createElement(T,null)),React.createElement("button",{className:`filter-toggle-btn ${h?"active":""}`,onClick:()=>b(!h),title:"Filtreler"},React.createElement(A,null))),h&&React.createElement("div",{className:"filters-section"},React.createElement("div",{className:"filter-row"},React.createElement("div",{className:"filter-group"},React.createElement("label",null,React.createElement(L,null)," KullanÄ±cÄ±"),React.createElement("input",{type:"text",placeholder:"@kullanÄ±cÄ±adÄ±",value:a.author,onChange:e=>r({...a,author:e.target.value})}))),React.createElement("div",{className:"filter-row"},React.createElement("div",{className:"filter-group"},React.createElement("label",null,React.createElement(k,null)," BaÅŸlangÄ±Ã§"),React.createElement("input",{type:"date",value:a.dateFrom,onChange:e=>r({...a,dateFrom:e.target.value})})),React.createElement("div",{className:"filter-group"},React.createElement("label",null,React.createElement(k,null)," BitiÅŸ"),React.createElement("input",{type:"date",value:a.dateTo,onChange:e=>r({...a,dateTo:e.target.value})}))),React.createElement("div",{className:"filter-row"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:a.hasAttachment,onChange:e=>r({...a,hasAttachment:e.target.checked})}),React.createElement("span",null,"Ekli dosya iÃ§eren")),React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:a.hasLink,onChange:e=>r({...a,hasLink:e.target.checked})}),React.createElement("span",null,"Link iÃ§eren")))),React.createElement("div",{className:"search-results"},m&&React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"AranÄ±yor...")),!m&&s.length===0&&t&&React.createElement("div",{className:"empty-state"},React.createElement(i,{size:48}),React.createElement("h3",null,"SonuÃ§ BulunamadÄ±"),React.createElement("p",null,'"',t,'" iÃ§in mesaj bulunamadÄ±')),!m&&s.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"results-count"},s.length," sonuÃ§ bulundu"),React.createElement("div",{className:"results-list"},s.map(e=>React.createElement("div",{key:e.id,className:"result-item",onClick:()=>S(e)},React.createElement("div",{className:"result-header"},React.createElement("img",{src:e.author.avatar||"/default-avatar.png",alt:e.author.username,className:"author-avatar"}),React.createElement("div",{className:"author-info"},React.createElement("span",{className:"author-name"},e.author.username),React.createElement("span",{className:"message-date"},C(e.created_at))),e.channel&&React.createElement("span",{className:"channel-tag"},"#",e.channel.name)),React.createElement("div",{className:"message-content"},F(e.content,t)),e.attachments&&e.attachments.length>0&&React.createElement("div",{className:"message-attachments"},"ğŸ“ ",e.attachments.length," dosya"))))),!m&&!t&&React.createElement("div",{className:"empty-state"},React.createElement(i,{size:48}),React.createElement("h3",null,"Mesaj Ara"),React.createElement("p",null,"Sunucudaki tÃ¼m mesajlarÄ± arayÄ±n"),React.createElement("ul",{className:"search-tips"},React.createElement("li",null,"En az 3 karakter girin"),React.createElement("li",null,"Filtreleri kullanarak sonuÃ§larÄ± daraltÄ±n"),React.createElement("li",null,"KullanÄ±cÄ±ya gÃ¶re filtreleyin"),React.createElement("li",null,"Tarih aralÄ±ÄŸÄ± belirleyin"))))))};export{_ as default};
