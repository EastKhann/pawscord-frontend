import{r as o,n as e}from"./react-core-BMiyQWF6.js";import{t}from"./index-CJOKRwJG.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./icons-vendor-T72gfvdf.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const G=({apiBaseUrl:h,roomSlug:u,onClose:x})=>{const[d,j]=o.useState([]),[N,f]=o.useState(!0),[g,m]=o.useState(!1),[n,l]=o.useState({content:"",scheduled_time:"",room_slug:u||""});o.useEffect(()=>{v()},[]);const v=async()=>{try{f(!0);const s=localStorage.getItem("access_token"),a=await fetch(`${h}/scheduled/list/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const c=await a.json();j(c.scheduled_messages||[])}else t.error("âŒ ZamanlanmÄ±ÅŸ mesajlar yÃ¼klenemedi")}catch{t.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{f(!1)}},k=async()=>{if(!n.content.trim()){t.error("âŒ Mesaj iÃ§eriÄŸi boÅŸ olamaz");return}if(!n.scheduled_time){t.error("âŒ Tarih ve saat seÃ§iniz");return}if(!n.room_slug){t.error("âŒ Kanal seÃ§iniz");return}try{const s=localStorage.getItem("access_token"),a=await fetch(`${h}/scheduled/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(a.ok){const c=await a.json();j([...d,c.scheduled_message]),m(!1),l({content:"",scheduled_time:"",room_slug:u||""}),t.success("âœ… Mesaj zamanlandÄ±")}else{const c=await a.json();t.error(`âŒ ${c.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z"}`)}}catch{t.error("âŒ BaÄŸlantÄ± hatasÄ±")}},w=async s=>{if(confirm("Bu zamanlanmÄ±ÅŸ mesajÄ± iptal etmek istediÄŸinize emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${h}/scheduled/cancel/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(j(d.filter(r=>r.id!==s)),t.success("âœ… ZamanlanmÄ±ÅŸ mesaj iptal edildi")):t.error("âŒ Ä°ptal baÅŸarÄ±sÄ±z")}catch{t.error("âŒ BaÄŸlantÄ± hatasÄ±")}},b=s=>{const a=new Date,r=new Date(s)-a;if(r<0)return"GÃ¶nderildi";const i=Math.floor(r/(1e3*60*60)),p=Math.floor(r%(1e3*60*60)/(1e3*60));return i>24?`${Math.floor(i/24)} gÃ¼n ${i%24} saat`:i>0?`${i} saat ${p} dakika`:`${p} dakika`},y=s=>new Date(s).toLocaleString("tr-TR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),M=s=>{const a=new Date,r=new Date(s)-a;return r<0?"status-sent":r<36e5?"status-imminent":r<864e5?"status-soon":"status-scheduled"},_=()=>{const s=new Date;return s.setMinutes(s.getMinutes()+1),s.toISOString().slice(0,16)};return e.jsx("div",{className:"scheduled-messages-overlay",onClick:x,children:e.jsxs("div",{className:"scheduled-messages-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"scheduled-messages-header",children:[e.jsx("h2",{children:"â° ZamanlanmÄ±ÅŸ Mesajlar"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"create-btn",onClick:()=>m(!g),children:g?"âœ• Ä°ptal":"+ Yeni Mesaj"}),e.jsx("button",{className:"close-btn",onClick:x,children:"âœ•"})]})]}),g&&e.jsxs("div",{className:"create-form",children:[e.jsx("h3",{children:"ğŸ“ Yeni ZamanlanmÄ±ÅŸ Mesaj"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mesaj Ä°Ã§eriÄŸi"}),e.jsx("textarea",{className:"message-textarea",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:n.content,onChange:s=>l({...n,content:s.target.value}),rows:4})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"room-slug",value:n.room_slug,onChange:s=>l({...n,room_slug:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"GÃ¶nderim ZamanÄ±"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:n.scheduled_time,min:_(),onChange:s=>l({...n,scheduled_time:s.target.value})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-form-btn",onClick:()=>{m(!1),l({content:"",scheduled_time:"",room_slug:u||""})},children:"Ä°ptal"}),e.jsx("button",{className:"submit-btn",onClick:k,children:"â° Zamanla"})]})]}),e.jsx("div",{className:"scheduled-messages-content",children:N?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"â°"}),e.jsx("h3",{children:"ZamanlanmÄ±ÅŸ mesaj yok"}),e.jsx("p",{children:"Gelecekte gÃ¶nderilmek Ã¼zere mesaj zamanlamadÄ±nÄ±z"}),e.jsx("button",{className:"create-first-btn",onClick:()=>m(!0),children:"+ Ä°lk MesajÄ± Zamanla"})]}):e.jsx("div",{className:"messages-list",children:d.map(s=>e.jsxs("div",{className:`scheduled-message-card ${M(s.scheduled_time)}`,children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"message-info",children:[e.jsxs("span",{className:"room-badge",children:["# ",s.room_slug]}),e.jsx("span",{className:"time-badge",children:y(s.scheduled_time)})]}),e.jsx("button",{className:"cancel-btn",onClick:()=>w(s.id),title:"Ä°ptal Et",children:"ğŸ—‘ï¸"})]}),e.jsx("div",{className:"message-content",children:s.content}),e.jsxs("div",{className:"message-footer",children:[e.jsxs("div",{className:"countdown",children:[e.jsx("span",{className:"countdown-icon",children:"â³"}),e.jsx("span",{className:"countdown-text",children:b(s.scheduled_time)})]}),s.sent&&e.jsx("div",{className:"sent-badge",children:"âœ… GÃ¶nderildi"})]})]},s.id))})})]})})};export{G as default};
