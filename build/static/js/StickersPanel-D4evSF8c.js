import{r as c,n as e}from"./react-core-zXIKm1Jm.js";import"./editor-vendor-DiU449Dh.js";const z=({serverId:r,onClose:h})=>{const[l,p]=c.useState([]),[u,C]=c.useState([]),[x,n]=c.useState(!0),[i,j]=c.useState("my-stickers"),[P,o]=c.useState(!1),[g,f]=c.useState(!1),[d,N]=c.useState(""),[k,S]=c.useState(null),[v,y]=c.useState("");c.useEffect(()=>{i==="my-stickers"?b():w()},[i,r]);const b=async()=>{try{n(!0);const s=localStorage.getItem("access_token"),t=await fetch(`/api/stickers/${r}/list/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const a=await t.json();p(a.stickers||[])}}catch(s){console.error("Error fetching stickers:",s)}finally{n(!1)}},w=async()=>{try{n(!0);const s=localStorage.getItem("access_token"),t=await fetch("/api/stickers/packs/",{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const a=await t.json();C(a.packs||[])}}catch(s){console.error("Error fetching sticker packs:",s)}finally{n(!1)}},$=async()=>{if(!d.trim()||!k){console.error("âŒ Please provide sticker name and file");return}const s=new FormData;s.append("name",d),s.append("sticker",k);try{f(!0);const t=localStorage.getItem("access_token"),a=await fetch(`/api/stickers/${r}/upload/`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(a.ok)console.log("âœ… Sticker uploaded"),o(!1),N(""),S(null),y(""),b();else{const m=await a.json();console.error("âŒ",m.error||"Failed to upload sticker")}}catch(t){console.error("Error uploading sticker:",t)}finally{f(!1)}},E=async s=>{if(window.confirm("Delete this sticker?"))try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${r}/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(console.log("âœ… Sticker deleted"),p(l.filter(m=>m.id!==s))):console.error("âŒ Failed to delete sticker")}catch(t){console.error("Error deleting sticker:",t)}},F=async s=>{try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${r}/install-pack/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({pack_id:s})})).ok?(console.log("âœ… Sticker pack installed"),w()):console.error("âŒ Failed to install pack")}catch(t){console.error("Error installing pack:",t)}},U=s=>{const t=s.target.files[0];if(t){if(!t.type.startsWith("image/")){console.error("âŒ Please select an image file");return}if(t.size>512*1024){console.error("âŒ File size must be less than 512KB");return}S(t),y(URL.createObjectURL(t))}};return e.jsx("div",{className:"stickers-panel-overlay",onClick:h,children:e.jsxs("div",{className:"stickers-panel-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"stickers-panel-header",children:[e.jsx("h2",{children:"ðŸŽ¨ Stickers"}),e.jsx("button",{className:"close-btn",onClick:h,children:"âœ•"})]}),e.jsxs("div",{className:"stickers-tabs",children:[e.jsx("button",{className:`tab-btn ${i==="my-stickers"?"active":""}`,onClick:()=>j("my-stickers"),children:"ðŸ“ My Stickers"}),e.jsx("button",{className:`tab-btn ${i==="packs"?"active":""}`,onClick:()=>j("packs"),children:"ðŸ“¦ Sticker Packs"})]}),e.jsxs("div",{className:"stickers-panel-content",children:[i==="my-stickers"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sticker-actions",children:[e.jsx("button",{className:"upload-sticker-btn",onClick:()=>o(!0),children:"âž• Upload Sticker"}),e.jsxs("p",{className:"sticker-count",children:[l.length," stickers"]})]}),x?e.jsx("div",{className:"loading-spinner",children:"Loading stickers..."}):l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ¨"}),e.jsx("h3",{children:"No Stickers Yet"}),e.jsx("p",{children:"Upload your first custom sticker"})]}):e.jsx("div",{className:"stickers-grid",children:l.map(s=>e.jsxs("div",{className:"sticker-card",children:[e.jsx("img",{src:s.url,alt:s.name,className:"sticker-image"}),e.jsx("div",{className:"sticker-name",children:s.name}),e.jsx("button",{className:"delete-sticker-btn",onClick:()=>E(s.id),title:"Delete",children:"ðŸ—‘ï¸"})]},s.id))})]}),i==="packs"&&e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"loading-spinner",children:"Loading packs..."}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“¦"}),e.jsx("h3",{children:"No Packs Available"}),e.jsx("p",{children:"Check back later for new sticker packs"})]}):e.jsx("div",{className:"packs-grid",children:u.map(s=>e.jsxs("div",{className:"pack-card",children:[e.jsx("div",{className:"pack-preview",children:s.preview_stickers?.slice(0,4).map((t,a)=>e.jsx("img",{src:t.url,alt:"",className:"pack-preview-img"},a))}),e.jsxs("div",{className:"pack-info",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{children:[s.sticker_count," stickers"]})]}),e.jsx("button",{className:`install-pack-btn ${s.installed?"installed":""}`,onClick:()=>!s.installed&&F(s.id),disabled:s.installed,children:s.installed?"âœ“ Installed":"âž• Install"})]},s.id))})})]}),P&&e.jsx("div",{className:"upload-modal-overlay",onClick:()=>o(!1),children:e.jsxs("div",{className:"upload-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"âž• Upload Sticker"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Name"}),e.jsx("input",{type:"text",value:d,onChange:s=>N(s.target.value),placeholder:"My Sticker",maxLength:32,className:"sticker-name-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Image"}),e.jsx("div",{className:"file-upload-area",onClick:()=>document.getElementById("sticker-file").click(),children:v?e.jsx("img",{src:v,alt:"Preview",className:"upload-preview"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-icon",children:"ðŸ“¤"}),e.jsx("p",{children:"Click to select image"}),e.jsx("p",{className:"upload-hint",children:"PNG, GIF â€¢ Max 512KB â€¢ 512x512px recommended"})]})}),e.jsx("input",{id:"sticker-file",type:"file",accept:"image/*",onChange:U,style:{display:"none"}})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>o(!1),children:"Cancel"}),e.jsx("button",{className:"upload-btn",onClick:$,disabled:g||!d||!k,children:g?"Uploading...":"Upload"})]})]})})]})})};export{z as default};
