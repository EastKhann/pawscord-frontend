var P=Object.defineProperty;var A=e=>{throw TypeError(e)};var $=(e,i,t)=>i in e?P(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var h=(e,i)=>P(e,"name",{value:i,configurable:!0});var S=(e,i,t)=>$(e,typeof i!="symbol"?i+"":i,t),M=(e,i,t)=>i.has(e)||A("Cannot "+t);var E=(e,i,t)=>(M(e,i,"read from private field"),t?t.call(e):i.get(e)),w=(e,i,t)=>i.has(e)?A("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,t),R=(e,i,t,u)=>(M(e,i,"write to private field"),u?u.call(e,t):i.set(e,t),t),I=(e,i,t)=>(M(e,i,"access private method"),t);import{a as j}from"./react-core-Djgtqrmb.js";import{M as z,C as G}from"./mixin-3xgmAQp_.js";import{H as m}from"./hls-BvDJDaNM.js";const V=h(e=>{var i,t,u,g,N,T,C;return i=class extends e{constructor(){super();w(this,g);w(this,t,null);w(this,u,null);w(this,T,h(()=>{var a,r,v;(a=this.nativeEl)!=null&&a.webkitCurrentPlaybackTargetIsWireless?(r=this.api)==null||r.stopLoad():(v=this.api)==null||v.startLoad()},"#toggleHlsLoad"));I(this,g,C).call(this,"config")}get config(){return E(this,u)}set config(a){R(this,u,a)}attributeChangedCallback(a,r,v){a!=="src"&&super.attributeChangedCallback(a,r,v),a==="src"&&r!=v&&this.load()}async load(){var a,r;const v=!this.api;if(I(this,g,N).call(this),!!this.src){if(v&&!E(this,u)&&R(this,u,JSON.parse(((a=this.shadowRoot.getElementById("config"))==null?void 0:a.textContent)||"{}")),m.isSupported()){switch(await Promise.resolve(),this.api=new m({liveDurationInfinity:!0,autoStartLoad:!1,...this.config}),this.api.loadSource(this.src),this.api.attachMedia(this.nativeEl),this.nativeEl.preload){case"none":{const d=h(()=>this.api.startLoad(),"loadSourceOnPlay");this.nativeEl.addEventListener("play",d,{once:!0}),this.api.on(m.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",d)});break}case"metadata":{const d=this.api.config.maxBufferLength,s=this.api.config.maxBufferSize;this.api.config.maxBufferLength=1,this.api.config.maxBufferSize=1;const l=h(()=>{this.api.config.maxBufferLength=d,this.api.config.maxBufferSize=s},"increaseBufferOnPlay");this.nativeEl.addEventListener("play",l,{once:!0}),this.api.on(m.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",l)}),this.api.startLoad();break}default:this.api.startLoad()}this.nativeEl.webkitCurrentPlaybackTargetIsWireless&&this.api.stopLoad(),this.nativeEl.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",E(this,T)),R(this,t,document.createElement("source")),E(this,t).setAttribute("type","application/x-mpegURL"),E(this,t).setAttribute("src",this.src),this.nativeEl.disableRemotePlayback=!1,this.nativeEl.append(E(this,t));const y=new WeakMap;this.api.on(m.Events.MANIFEST_PARSED,(d,s)=>{this.nativeEl.autoplay&&this.nativeEl.paused&&this.nativeEl.play().catch(o=>{}),k();let l=this.videoTracks.getTrackById("main");l||(l=this.addVideoTrack("main"),l.id="main",l.selected=!0);for(const[o,n]of s.levels.entries()){const c=l.addRendition(n.url[0],n.width,n.height,n.videoCodec,n.bitrate);y.set(n,`${o}`),c.id=`${o}`}for(let[o,n]of s.audioTracks.entries()){const c=n.default?"main":"alternative",p=this.addAudioTrack(c,n.name,n.lang);p.id=`${o}`,n.default&&(p.enabled=!0)}}),this.audioTracks.addEventListener("change",()=>{var d;const s=+((d=[...this.audioTracks].find(o=>o.enabled))==null?void 0:d.id),l=this.api.audioTracks.map(o=>o.id);s!=this.api.audioTrack&&l.includes(s)&&(this.api.audioTrack=s)}),this.api.on(m.Events.LEVELS_UPDATED,(d,s)=>{const l=this.videoTracks[this.videoTracks.selectedIndex??0];if(!l)return;const o=s.levels.map(n=>y.get(n));for(const n of this.videoRenditions)n.id&&!o.includes(n.id)&&l.removeRendition(n)});let f=null;this.api.on(m.Events.ERROR,(d,s)=>{s.type===m.ErrorTypes.NETWORK_ERROR&&s.details===m.ErrorDetails.FRAG_LOAD_ERROR&&(f=s.frag.level)}),this.api.on(m.Events.LEVEL_SWITCHED,(d,s)=>{const l=s.level;f!==null&&l<f&&(this.videoRenditions.selectedIndex=l,f=null)});const b=h(d=>{const s=d.target.selectedIndex;s!=this.api.nextLevel&&(this.api.nextLevel=s)},"switchRendition");(r=this.videoRenditions)==null||r.addEventListener("change",b);const k=h(()=>{for(const d of this.videoTracks)this.removeVideoTrack(d);for(const d of this.audioTracks)this.removeAudioTrack(d)},"removeAllMediaTracks");this.api.once(m.Events.DESTROYING,k);return}await Promise.resolve(),this.nativeEl.canPlayType("application/vnd.apple.mpegurl")&&(this.nativeEl.src=this.src)}}},t=new WeakMap,u=new WeakMap,g=new WeakSet,N=h(function(){var a,r;(a=E(this,t))==null||a.remove(),(r=this.nativeEl)==null||r.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",E(this,T)),this.api&&(this.api.detachMedia(),this.api.destroy(),this.api=null)},"#destroy"),T=new WeakMap,C=h(function(a){if(Object.prototype.hasOwnProperty.call(this,a)){const r=this[a];delete this[a],this[a]=r}},"#upgradeProperty"),h(i,"HlsVideo"),S(i,"shadowRootOptions",{...e.shadowRootOptions}),S(i,"getTemplateHTML",h((a,r={})=>{const{src:v,...y}=a;return`
        <script type="application/json" id="config">
          ${JSON.stringify(r.config||{})}
        <\/script>
        ${e.getTemplateHTML(y)}
      `},"getTemplateHTML")),i},"HlsVideoMixin"),D=V(z(G));globalThis.customElements&&!globalThis.customElements.get("hls-video")&&globalThis.customElements.define("hls-video",D);var Y=D,J=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),U={className:"class",htmlFor:"for"};function F(e){return e.toLowerCase()}h(F,"defaultToAttributeName");function x(e){if(typeof e=="boolean")return e?"":void 0;if(typeof e!="function"&&!(typeof e=="object"&&e!==null))return e}h(x,"defaultToAttributeValue");function q({react:e,tagName:i,elementClass:t,events:u,displayName:g,defaultProps:W,toAttributeName:T=F,toAttributeValue:B=x}){const O=Number.parseInt(e.version)>=19,_=e.forwardRef((a,r)=>{var v,y;const f=e.useRef(null),b=e.useRef(new Map),k={},d={},s={},l={};for(const[o,n]of Object.entries(a)){if(J.has(o)){s[o]=n;continue}const c=T(U[o]??o);if(t.prototype&&o in t.prototype&&!(o in(((v=globalThis.HTMLElement)==null?void 0:v.prototype)??{}))&&!((y=t.observedAttributes)!=null&&y.some(L=>L===c))){l[o]=n;continue}if(o.startsWith("on")){k[o]=n;continue}const p=B(n);if(c&&p!=null&&(d[c]=String(p),O||(s[c]=p)),c&&O){const L=x(n);p!==L?s[c]=p:s[c]=n}}if(typeof window<"u"){for(const o in k){const n=k[o],c=o.endsWith("Capture"),p=(u?.[o]??o.slice(2).toLowerCase()).slice(0,c?-7:void 0);e.useLayoutEffect(()=>{const L=f?.current;if(!(!L||typeof n!="function"))return L.addEventListener(p,n,c),()=>{L.removeEventListener(p,n,c)}},[f?.current,n])}e.useLayoutEffect(()=>{if(f.current===null)return;const o=new Map;for(const n in l)H(f.current,n,l[n]),b.current.delete(n),o.set(n,l[n]);for(const[n,c]of b.current)H(f.current,n,void 0);b.current=o})}if(typeof window>"u"&&t?.getTemplateHTML&&t?.shadowRootOptions){const{mode:o,delegatesFocus:n}=t.shadowRootOptions,c=e.createElement("template",{shadowrootmode:o,shadowrootdelegatesfocus:n,dangerouslySetInnerHTML:{__html:t.getTemplateHTML(d,a)},key:"ce-la-react-ssr-template-shadow-root"});s.children=[c,s.children]}return e.createElement(i,{...W,...s,ref:e.useCallback(o=>{f.current=o,typeof r=="function"?r(o):r!==null&&(r.current=o)},[r])},s.children)});return _.displayName=g??t.name,_}h(q,"createComponent");function H(e,i,t){var u;e[i]=t,t==null&&i in(((u=globalThis.HTMLElement)==null?void 0:u.prototype)??{})&&e.removeAttribute(i)}h(H,"setProperty");var ee=q({react:j,tagName:"hls-video",elementClass:Y,toAttributeName(e){return e==="muted"?"":e==="defaultMuted"?"muted":F(e)}});export{ee as default};
