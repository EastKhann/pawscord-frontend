var C=Object.defineProperty;var s=(i,m)=>C(i,"name",{value:m,configurable:!0});import{r as o,j as e}from"./react-core-Djgtqrmb.js";import{y as v}from"./ui-vendor-IhB9Znpc.js";import{g as O}from"./index-D_luy7FO.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const U=s(({serverId:i,onClose:m})=>{const[u,g]=o.useState([]),[l,c]=o.useState({action_type:"",user_id:"",target_user_id:"",channel_id:"",start_date:"",end_date:""}),[p,b]=o.useState(!0),[h,j]=o.useState(1),[y,N]=o.useState(!0),f=O();o.useEffect(()=>{i&&k()},[i,h]);const k=s(async()=>{b(!0);try{const a=localStorage.getItem("access_token"),n=new URLSearchParams({page:h,...Object.fromEntries(Object.entries(l).filter(([t,d])=>d!==""))}),r=await fetch(`${f}/audit-logs/server/${i}/?${n}`,{headers:{Authorization:`Bearer ${a}`}});if(r.ok){const t=await r.json();g(h===1?t.logs||[]:[...u,...t.logs||[]]),N(t.has_more||!1)}}catch{v.error("âŒ Audit loglarÄ± yÃ¼klenemedi")}finally{b(!1)}},"fetchLogs"),S=s(()=>{j(1),k()},"applyFilters"),w=s(()=>{c({action_type:"",user_id:"",target_user_id:"",channel_id:"",start_date:"",end_date:""}),j(1)},"clearFilters"),A=s(async()=>{try{const a=localStorage.getItem("access_token"),n=new URLSearchParams({...Object.fromEntries(Object.entries(l).filter(([t,d])=>d!==""))}),r=await fetch(`${f}/audit-logs/server/${i}/export/?${n}`,{headers:{Authorization:`Bearer ${a}`}});if(r.ok){const t=await r.blob(),d=window.URL.createObjectURL(t),_=document.createElement("a");_.href=d,_.download=`audit_logs_${i}.csv`,_.click(),v.success("âœ… Audit loglarÄ± dÄ±ÅŸa aktarÄ±ldÄ±")}}catch{v.error("âŒ DÄ±ÅŸa aktarma baÅŸarÄ±sÄ±z")}},"exportLogs"),$=s(a=>({message_delete:"ğŸ—‘ï¸",message_edit:"âœï¸",member_join:"ğŸ‘‹",member_leave:"ğŸ‘‹",member_kick:"ğŸš«",member_ban:"ğŸ”¨",member_unban:"âœ…",role_create:"ğŸ­",role_delete:"ğŸ—‘ï¸",role_update:"ğŸ¨",role_assign:"â­",role_remove:"â–",channel_create:"â•",channel_delete:"âŒ",channel_update:"ğŸ”§",server_update:"âš™ï¸",invite_create:"ğŸ”—",webhook_create:"ğŸ¤–",webhook_delete:"ğŸ—‘ï¸",emoji_create:"ğŸ˜€",emoji_delete:"ğŸ˜¢",pin_add:"ğŸ“Œ",pin_remove:"ğŸ“Œ",reaction_add:"â¤ï¸",reaction_remove:"ğŸ’”"})[a]||"ğŸ“","getActionIcon"),x=s(a=>a.includes("delete")||a.includes("remove")||a.includes("kick")||a.includes("ban")?"#ef4444":a.includes("create")||a.includes("add")||a.includes("join")?"#10b981":a.includes("edit")||a.includes("update")?"#f59e0b":"#6366f1","getActionColor"),L=s(a=>{const n=new Date(a),t=Math.floor((new Date-n)/1e3);return t<60?"Az Ã¶nce":t<3600?`${Math.floor(t/60)} dakika Ã¶nce`:t<86400?`${Math.floor(t/3600)} saat Ã¶nce`:t<604800?`${Math.floor(t/86400)} gÃ¼n Ã¶nce`:n.toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},"formatDate");return e.jsx("div",{className:"audit-logs-overlay",onClick:m,children:e.jsxs("div",{className:"audit-logs-panel",onClick:s(a=>a.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"audit-header",children:[e.jsx("h2",{children:"ğŸ“‹ Audit Logs"}),e.jsx("button",{className:"close-btn",onClick:m,children:"Ã—"})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filter-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Aksiyon TÃ¼rÃ¼"}),e.jsxs("select",{value:l.action_type,onChange:s(a=>c({...l,action_type:a.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"TÃ¼mÃ¼"}),e.jsxs("optgroup",{label:"Mesajlar",children:[e.jsx("option",{value:"message_delete",children:"Mesaj Silme"}),e.jsx("option",{value:"message_edit",children:"Mesaj DÃ¼zenleme"}),e.jsx("option",{value:"pin_add",children:"Pin Ekleme"}),e.jsx("option",{value:"pin_remove",children:"Pin KaldÄ±rma"})]}),e.jsxs("optgroup",{label:"Ãœyeler",children:[e.jsx("option",{value:"member_join",children:"Ãœye KatÄ±ldÄ±"}),e.jsx("option",{value:"member_leave",children:"Ãœye AyrÄ±ldÄ±"}),e.jsx("option",{value:"member_kick",children:"Ãœye AtÄ±ldÄ±"}),e.jsx("option",{value:"member_ban",children:"Ãœye BanlandÄ±"}),e.jsx("option",{value:"member_unban",children:"Ban KaldÄ±rÄ±ldÄ±"})]}),e.jsxs("optgroup",{label:"Roller",children:[e.jsx("option",{value:"role_create",children:"Rol OluÅŸturma"}),e.jsx("option",{value:"role_delete",children:"Rol Silme"}),e.jsx("option",{value:"role_update",children:"Rol GÃ¼ncelleme"}),e.jsx("option",{value:"role_assign",children:"Rol Atama"}),e.jsx("option",{value:"role_remove",children:"Rol KaldÄ±rma"})]}),e.jsxs("optgroup",{label:"Kanallar",children:[e.jsx("option",{value:"channel_create",children:"Kanal OluÅŸturma"}),e.jsx("option",{value:"channel_delete",children:"Kanal Silme"}),e.jsx("option",{value:"channel_update",children:"Kanal GÃ¼ncelleme"})]}),e.jsxs("optgroup",{label:"DiÄŸer",children:[e.jsx("option",{value:"server_update",children:"Sunucu GÃ¼ncelleme"}),e.jsx("option",{value:"invite_create",children:"Davet OluÅŸturma"}),e.jsx("option",{value:"webhook_create",children:"Webhook OluÅŸturma"}),e.jsx("option",{value:"webhook_delete",children:"Webhook Silme"}),e.jsx("option",{value:"emoji_create",children:"Emoji Ekleme"}),e.jsx("option",{value:"emoji_delete",children:"Emoji Silme"})]})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"BaÅŸlangÄ±Ã§ Tarihi"}),e.jsx("input",{type:"datetime-local",value:l.start_date,onChange:s(a=>c({...l,start_date:a.target.value}),"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"BitiÅŸ Tarihi"}),e.jsx("input",{type:"datetime-local",value:l.end_date,onChange:s(a=>c({...l,end_date:a.target.value}),"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"KullanÄ±cÄ± ID"}),e.jsx("input",{type:"text",placeholder:"Aksiyon yapan kullanÄ±cÄ±",value:l.user_id,onChange:s(a=>c({...l,user_id:a.target.value}),"onChange")})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"filter-btn apply-btn",onClick:S,children:"ğŸ” Filtrele"}),e.jsx("button",{className:"filter-btn clear-btn",onClick:w,children:"ğŸ—‘ï¸ Temizle"}),e.jsx("button",{className:"filter-btn export-btn",onClick:A,children:"ğŸ“¥ DÄ±ÅŸa Aktar"})]})]}),e.jsx("div",{className:"logs-content",children:p&&u.length===0?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loglar yÃ¼kleniyor..."})]}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ“‹"}),e.jsx("p",{children:"HenÃ¼z audit log yok"}),e.jsx("span",{children:"Sunucudaki aksiyonlar burada gÃ¶rÃ¼necek"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"logs-list",children:u.map(a=>e.jsxs("div",{className:"log-entry",style:{borderLeftColor:x(a.action_type)},children:[e.jsx("div",{className:"log-icon",style:{background:`${x(a.action_type)}20`},children:$(a.action_type)}),e.jsxs("div",{className:"log-details",children:[e.jsxs("div",{className:"log-header-row",children:[e.jsx("span",{className:"log-action",style:{color:x(a.action_type)},children:a.action_display||a.action_type}),e.jsx("span",{className:"log-time",children:L(a.created_at)})]}),e.jsx("div",{className:"log-description",children:a.description||"AÃ§Ä±klama yok"}),a.metadata&&Object.keys(a.metadata).length>0&&e.jsx("div",{className:"log-metadata",children:Object.entries(a.metadata).map(([n,r])=>e.jsxs("div",{className:"metadata-item",children:[e.jsxs("span",{className:"metadata-key",children:[n,":"]}),e.jsx("span",{className:"metadata-value",children:JSON.stringify(r)})]},n))}),e.jsxs("div",{className:"log-footer",children:[a.user&&e.jsxs("span",{className:"log-user",children:["ğŸ‘¤ ",a.user.username||`User#${a.user.id}`]}),a.channel&&e.jsxs("span",{className:"log-channel",children:["ğŸ“¢ ",a.channel.name]}),a.target_user&&e.jsxs("span",{className:"log-target",children:["ğŸ¯ ",a.target_user.username]})]})]})]},a.id))}),y&&e.jsx("button",{className:"load-more-btn",onClick:s(()=>j(h+1),"onClick"),disabled:p,children:p?"â³ YÃ¼kleniyor...":"ğŸ“„ Daha Fazla YÃ¼kle"})]})})]})})},"AuditLogsPanel");export{U as default};
