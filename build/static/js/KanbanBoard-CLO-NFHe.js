import{r as i,b as e}from"./react-core-9vc7GIjk.js";import{D as B,C as H,P as M}from"./ui-vendor-_iSLAufy.js";import{a as J,aF as G,aG as W,aH as Y,aI as q,m as j,Z as K}from"./icons-vendor-c3DBUQOi.js";import"./editor-vendor-DiU449Dh.js";const X=({card:x,onClose:d,onSave:s,onDelete:c,columnTitle:E})=>{const[D,I]=i.useState(x.content||""),[_,k]=i.useState(x.description||""),[w,A]=i.useState(x.due_date?x.due_date.substring(0,16):""),[f,v]=i.useState(x.labels||[]),[p,R]=i.useState(x.checklist||[]),[m,T]=i.useState(""),L=[{color:"#ef5350",name:"Red"},{color:"#ffa726",name:"Orange"},{color:"#ffee58",name:"Yellow"},{color:"#66bb6a",name:"Green"},{color:"#42a5f5",name:"Blue"},{color:"#ab47bc",name:"Purple"}],z=()=>{m.trim()&&(R([...p,{text:m,done:!1}]),T(""))},$=t=>{const a=[...p];a[t].done=!a[t].done,R(a)},N=t=>{const a=[...p];a.splice(t,1),R(a)},F=t=>{const a=f.find(n=>n.color===t);v(a?f.filter(n=>n.color!==t):[...f,{color:t,text:""}])};return e.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7)",zIndex:1e3,display:"flex",justifyContent:"center",alignItems:"center"},onClick:d},e.createElement("div",{style:{backgroundColor:"#313338",width:"600px",maxHeight:"90vh",borderRadius:"8px",overflowY:"auto",padding:"20px",color:"#dbdee1",display:"flex",flexDirection:"column",gap:"20px",position:"relative"},onClick:t=>t.stopPropagation()},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},e.createElement("div",{style:{flex:1}},e.createElement("input",{value:D,onChange:t=>I(t.target.value),style:{backgroundColor:"transparent",border:"none",color:"white",fontSize:"1.5em",fontWeight:"bold",width:"100%",outline:"none"}}),e.createElement("div",{style:{fontSize:"0.9em",color:"#949ba4",marginTop:"5px"}},"in list ",e.createElement("span",{style:{color:"#dbdee1",fontWeight:"bold"}},E))),e.createElement("button",{onClick:d,style:{background:"transparent",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"1.2em"}},e.createElement(J,null))),e.createElement("div",{style:{display:"flex",gap:"20px"}},e.createElement("div",{style:{flex:3,display:"flex",flexDirection:"column",gap:"20px"}},f.length>0&&e.createElement("div",null,e.createElement("h4",{style:{fontSize:"0.8em",color:"#949ba4",marginBottom:"8px"}},"LABELS"),e.createElement("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"}},f.map((t,a)=>e.createElement("div",{key:a,style:{backgroundColor:t.color,width:"40px",height:"20px",borderRadius:"4px"}})))),e.createElement("div",null,e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"}},e.createElement(G,null)," ",e.createElement("h3",{style:{margin:0,fontSize:"1em"}},"Description")),e.createElement("textarea",{value:_,onChange:t=>k(t.target.value),placeholder:"Add a more detailed description...",style:{width:"100%",minHeight:"100px",backgroundColor:"#383a40",border:"none",borderRadius:"4px",color:"#dbdee1",padding:"10px",resize:"vertical"}})),e.createElement("div",null,e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"}},e.createElement(W,null)," ",e.createElement("h3",{style:{margin:0,fontSize:"1em"}},"Checklist")),p.length>0&&e.createElement("div",{style:{marginBottom:"10px",display:"flex",alignItems:"center",gap:"10px"}},e.createElement("span",{style:{fontSize:"0.8em",color:"#949ba4"}},Math.round(p.filter(t=>t.done).length/p.length*100),"%"),e.createElement("div",{style:{flex:1,height:"6px",backgroundColor:"#383a40",borderRadius:"3px",overflow:"hidden"}},e.createElement("div",{style:{height:"100%",backgroundColor:"#5865f2",width:`${p.filter(t=>t.done).length/p.length*100}%`}}))),e.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"5px"}},p.map((t,a)=>e.createElement("div",{key:a,style:{display:"flex",alignItems:"center",gap:"8px"}},e.createElement("input",{type:"checkbox",checked:t.done,onChange:()=>$(a),style:{cursor:"pointer"}}),e.createElement("span",{style:{flex:1,textDecoration:t.done?"line-through":"none",color:t.done?"#949ba4":"#dbdee1"}},t.text),e.createElement("button",{onClick:()=>N(a),style:{background:"transparent",border:"none",color:"#fa777c",cursor:"pointer"}},e.createElement(J,null)))),e.createElement("div",{style:{display:"flex",gap:"5px",marginTop:"5px"}},e.createElement("input",{type:"text",value:m,onChange:t=>T(t.target.value),placeholder:"Add an item",onKeyDown:t=>t.key==="Enter"&&z(),style:{backgroundColor:"#383a40",border:"none",borderRadius:"4px",color:"white",padding:"8px",flex:1}}),e.createElement("button",{onClick:z,style:{backgroundColor:"#4752c4",color:"white",border:"none",borderRadius:"4px",padding:"0 15px",cursor:"pointer"}},"Add"))))),e.createElement("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"10px"}},e.createElement("h4",{style:{fontSize:"0.8em",color:"#949ba4",margin:"0 0 5px 0"}},"ADD TO CARD"),e.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"5px"}},e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#dbdee1",padding:"5px",backgroundColor:"#383a40",borderRadius:"3px"}},e.createElement(Y,null)," Labels"),e.createElement("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap",padding:"5px"}},L.map(t=>e.createElement("div",{key:t.color,onClick:()=>F(t.color),style:{width:"30px",height:"20px",backgroundColor:t.color,borderRadius:"3px",cursor:"pointer",border:f.find(a=>a.color===t.color)?"2px solid white":"none"},title:t.name})))),e.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"5px"}},e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#dbdee1",padding:"5px",backgroundColor:"#383a40",borderRadius:"3px"}},e.createElement(q,null)," Due Date"),e.createElement("input",{type:"datetime-local",value:w,onChange:t=>A(t.target.value),style:{backgroundColor:"#383a40",border:"none",borderRadius:"3px",color:"white",padding:"5px",width:"100%"}})),e.createElement("div",{style:{marginTop:"auto"}},e.createElement("h4",{style:{fontSize:"0.8em",color:"#949ba4",margin:"0 0 5px 0"}},"ACTIONS"),e.createElement("button",{onClick:c,style:{width:"100%",padding:"8px",backgroundColor:"#da373c",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"}},e.createElement(j,null)," Delete Card")))),e.createElement("div",{style:{marginTop:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"}},e.createElement("button",{onClick:s,style:{padding:"10px 20px",backgroundColor:"#23a559",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold"}},"Save Changes"))))},Z=({roomSlug:x,apiBaseUrl:d,fetchWithAuth:s})=>{const[c,E]=i.useState([]),[D,I]=i.useState(""),[_,k]=i.useState(null),[w,A]=i.useState(null),[f,v]=i.useState(!1),[p,R]=i.useState("");i.useEffect(()=>{m()},[x]);const m=async()=>{const n=await s(`${d}/kanban/${x}/`);if(n.ok){const o=await n.json();E(o.columns||[])}},T=async n=>{if(!D.trim()){k(null);return}(await s(`${d}/kanban/cards/create/`,{method:"POST",body:JSON.stringify({column_id:n,content:D})})).ok&&await m(),I(""),k(null)},L=async n=>{if(!n.destination)return;const{source:o,destination:g,draggableId:b,type:u}=n;if(u==="COLUMN"){const r=Array.from(c),[h]=r.splice(o.index,1);r.splice(g.index,0,h),E(r),await s(`${d}/kanban/columns/move/`,{method:"POST",body:JSON.stringify({column_id:b,new_index:g.index})});return}const O=c.findIndex(r=>r.id.toString()===o.droppableId),l=c.findIndex(r=>r.id.toString()===g.droppableId),P=c[O],y=c[l],C=Array.from(P.cards||[]),S=Array.from(y.cards||[]);if(o.droppableId===g.droppableId){const[r]=C.splice(o.index,1);C.splice(g.index,0,r);const h=[...c];h[O]={...P,cards:C},E(h)}else{const[r]=C.splice(o.index,1);S.splice(g.index,0,r);const h=[...c];h[O]={...P,cards:C},h[l]={...y,cards:S},E(h),await s(`${d}/kanban/cards/update/`,{method:"POST",body:JSON.stringify({card_id:b,column_id:y.id})})}},z=(n,o)=>{A(n),R(o),v(!0)},$=async n=>{const o=c.map(g=>({...g,cards:g.cards.map(b=>b.id===n.id?n:b)}));E(o),await s(`${d}/kanban/cards/update/`,{method:"POST",body:JSON.stringify({card_id:n.id,content:n.content,description:n.description,due_date:n.due_date,labels:n.labels,checklist:n.checklist})}),m()},N=async()=>{w&&window.confirm("Are you sure you want to delete this card?")&&(await s(`${d}/kanban/cards/${w.id}/delete/`,{method:"DELETE"}),v(!1),m())},F=async()=>{const n=prompt("New Column Title:");n&&(await s(`${d}/kanban/columns/create/`,{method:"POST",body:JSON.stringify({room_slug:x,title:n})}),m())},t=async n=>{window.confirm("Delete this column and all its cards?")&&(await s(`${d}/kanban/columns/${n}/delete/`,{method:"DELETE"}),m())},a=async n=>{const o=prompt("Rename Column:",n.title);o&&o!==n.title&&(await s(`${d}/kanban/columns/update/`,{method:"POST",body:JSON.stringify({column_id:n.id,title:o})}),m())};return e.createElement("div",{style:{display:"flex",height:"100%",overflowX:"auto",padding:"20px",gap:"15px",backgroundColor:"#313338"}},e.createElement(B,{onDragEnd:L},e.createElement(H,{droppableId:"board",type:"COLUMN",direction:"horizontal"},n=>e.createElement("div",{ref:n.innerRef,...n.droppableProps,style:{display:"flex",gap:"15px"}},c.map((o,g)=>e.createElement(M,{key:o.id,draggableId:o.id.toString(),index:g},b=>e.createElement("div",{ref:b.innerRef,...b.draggableProps,style:{...b.draggableProps.style,display:"flex",flexDirection:"column",minWidth:"280px",maxWidth:"280px"}},e.createElement("div",{style:{backgroundColor:"#2b2d31",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",maxHeight:"80vh"}},e.createElement("div",{...b.dragHandleProps,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px",padding:"0 5px",cursor:"grab"}},e.createElement("h3",{onClick:()=>a(o),style:{margin:0,color:"#f2f3f5",fontSize:"1em",fontWeight:"bold",cursor:"text"},title:"Click to rename"},o.title," ",e.createElement("span",{style:{color:"#949ba4",fontSize:"0.8em"}},"(",(o.cards||[]).length,")")),e.createElement("button",{onClick:()=>t(o.id),style:{background:"transparent",border:"none",color:"#b5bac1",cursor:"pointer"}},e.createElement(j,{size:12}))),e.createElement(H,{droppableId:o.id.toString(),type:"CARD"},(u,O)=>e.createElement("div",{ref:u.innerRef,...u.droppableProps,style:{flexGrow:1,minHeight:"50px",overflowY:"auto",backgroundColor:O.isDraggingOver?"rgba(255,255,255,0.05)":"transparent",transition:"background-color 0.2s",padding:"2px"}},(o.cards||[]).map((l,P)=>e.createElement(M,{key:l.id,draggableId:l.id.toString(),index:P},(y,C)=>e.createElement("div",{ref:y.innerRef,...y.draggableProps,...y.dragHandleProps,onClick:()=>z(l,o.title),style:{userSelect:"none",padding:"10px",marginBottom:"8px",backgroundColor:C.isDragging?"#40444b":"#2f3136",borderRadius:"4px",color:"#dcddde",boxShadow:"0 1px 0 rgba(0,0,0,0.25)",border:"1px solid #202225",cursor:"pointer",...y.draggableProps.style}},l.labels&&l.labels.length>0&&e.createElement("div",{style:{display:"flex",gap:"5px",marginBottom:"5px",flexWrap:"wrap"}},l.labels.map((S,r)=>e.createElement("div",{key:r,style:{backgroundColor:S.color,width:"30px",height:"6px",borderRadius:"3px"}}))),e.createElement("div",{style:{wordWrap:"break-word"}},l.content),(l.description||l.checklist&&l.checklist.length>0||l.due_date)&&e.createElement("div",{style:{display:"flex",gap:"10px",marginTop:"8px",fontSize:"0.8em",color:"#949ba4"}},l.description&&e.createElement("span",null,"ðŸ“"),l.checklist&&l.checklist.length>0&&e.createElement("span",null,"â˜‘ï¸ ",l.checklist.filter(S=>S.done).length,"/",l.checklist.length),l.due_date&&e.createElement("span",null,"ðŸ“…"))))),u.placeholder)),_===o.id?e.createElement("div",{style:{marginTop:10}},e.createElement("textarea",{autoFocus:!0,placeholder:"Enter a title...",value:D,onChange:u=>I(u.target.value),onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),T(o.id))},style:{width:"100%",padding:"8px",borderRadius:"4px",border:"none",backgroundColor:"#202225",color:"white",resize:"none",boxSizing:"border-box"}}),e.createElement("div",{style:{display:"flex",gap:"5px",marginTop:"5px"}},e.createElement("button",{onClick:()=>T(o.id),style:{backgroundColor:"#5865f2",color:"white",border:"none",padding:"5px 10px",borderRadius:"3px",cursor:"pointer"}},"Add"),e.createElement("button",{onClick:()=>k(null),style:{background:"transparent",color:"#bbb",border:"none",cursor:"pointer"}},"Cancel"))):e.createElement("button",{onClick:()=>{k(o.id),I("")},style:{width:"100%",padding:"8px",background:"transparent",border:"none",color:"#949ba4",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"5px",marginTop:"5px",borderRadius:"4px",":hover":{backgroundColor:"#35373c"}}},e.createElement(K,null)," Add Card"))))),n.placeholder,e.createElement("div",{style:{minWidth:"280px"}},e.createElement("button",{onClick:F,style:{width:"100%",padding:"12px",backgroundColor:"#ffffff10",color:"#f2f3f5",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"8px"}},e.createElement(K,null)," Add another list"))))),f&&w&&e.createElement(X,{card:w,columnTitle:p,onClose:()=>v(!1),onSave:$,onDelete:N}))},te=e.memo(Z);export{te as default};
