import{r as b,j as e}from"./react-core-D6cE4lil.js";import{ay as v,d as R,w as k,a1 as C,a0 as S,a as w,a5 as B}from"./icons-vendor-fClA8qVL.js";import{t as g}from"./index-DHLSv4f5.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0,0,0,0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},filters:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:"1px solid #2c2f33",flexWrap:"wrap"},filterButton:{padding:"8px 16px",backgroundColor:"#2c2f33",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",transition:"background-color 0.2s"},filterButtonActive:{backgroundColor:"#5865f2"},exportButton:{marginLeft:"auto",padding:"8px 16px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},resultsList:{display:"flex",flexDirection:"column",gap:"15px"},resultCard:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"15px"},resultHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},resultStatus:{display:"flex",alignItems:"center",fontSize:"14px"},timestamp:{fontSize:"12px",color:"#99aab5"},resultBody:{display:"flex",flexDirection:"column",gap:"15px"},resultInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"10px",fontSize:"14px",color:"#dcddde"},progressBar:{flex:1,height:"8px",backgroundColor:"#1e1e1e",borderRadius:"4px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s"},flags:{display:"flex",flexWrap:"wrap",gap:"5px"},flag:{padding:"4px 8px",backgroundColor:"#f04747",borderRadius:"4px",fontSize:"12px",color:"#ffffff"},actions:{display:"flex",gap:"10px",justifyContent:"flex-end"},actionButton:{padding:"8px 16px",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center"},approveButton:{backgroundColor:"#43b581"},blockButton:{backgroundColor:"#f04747"},ignoreButton:{backgroundColor:"#99aab5"}},F=(o,s,r)=>{const[i,a]=b.useState([]),[c,u]=b.useState(!1),[d,m]=b.useState("all"),y=async()=>{u(!0);try{const l=r?`${s}/messages/${r}/scan_results/`:`${s}/content_scanner/results/`,h=await(await o(l)).json();a(h.results||[])}catch{g.error("Failed to load scan results")}finally{u(!1)}};b.useEffect(()=>{y()},[r]);const j=async()=>{try{const x=await(await o(`${s}/content_scanner/export/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:d})})).blob(),h=window.URL.createObjectURL(x),f=document.createElement("a");f.href=h,f.download=`scan_results_${new Date().toISOString()}.csv`,document.body.appendChild(f),f.click(),f.remove(),g.success("Results exported successfully")}catch{g.error("Failed to export results")}},n=async(l,x)=>{try{await o(`${s}/content_scanner/results/${l}/review/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:x})}),g.success(`Content ${x}ed successfully`),y()}catch{g.error("Failed to review content")}},p=i.filter(l=>d==="all"||l.status===d);return{scanResults:i,filteredResults:p,loading:c,filter:d,setFilter:m,exportResults:j,reviewResult:n}},I={safe:{icon:k,color:"#43b581"},flagged:{icon:R,color:"#faa61a"},blocked:{icon:v,color:"#f04747"}},_=({result:o,onReview:s})=>{const r=I[o.status]||{icon:C,color:"#99aab5"},i=r.icon;return e.jsxs("div",{style:t.resultCard,children:[e.jsxs("div",{style:t.resultHeader,children:[e.jsxs("div",{style:t.resultStatus,children:[e.jsx(i,{style:{color:r.color}}),e.jsx("span",{style:{marginLeft:"8px",color:r.color,fontWeight:"600"},children:o.status.toUpperCase()})]}),e.jsx("div",{style:t.timestamp,children:new Date(o.scanned_at).toLocaleString()})]}),e.jsxs("div",{style:t.resultBody,children:[e.jsxs("div",{style:t.resultInfo,children:[e.jsxs("div",{style:t.infoRow,children:[e.jsx("strong",{children:"Type:"})," ",o.content_type]}),o.confidence_score&&e.jsxs("div",{style:t.infoRow,children:[e.jsx("strong",{children:"Confidence:"}),e.jsx("div",{style:t.progressBar,children:e.jsx("div",{style:{...t.progressFill,width:`${o.confidence_score}%`,backgroundColor:o.confidence_score>80?"#f04747":o.confidence_score>50?"#faa61a":"#43b581"}})}),e.jsxs("span",{children:[o.confidence_score,"%"]})]}),o.flags?.length>0&&e.jsxs("div",{style:t.infoRow,children:[e.jsx("strong",{children:"Flags:"}),e.jsx("div",{style:t.flags,children:o.flags.map((a,c)=>e.jsx("span",{style:t.flag,children:a},c))})]}),o.reason&&e.jsxs("div",{style:t.infoRow,children:[e.jsx("strong",{children:"Reason:"})," ",o.reason]})]}),o.status==="flagged"&&e.jsxs("div",{style:t.actions,children:[e.jsxs("button",{onClick:()=>s(o.id,"approve"),style:{...t.actionButton,...t.approveButton},children:[e.jsx(k,{style:{marginRight:"5px"}})," Approve"]}),e.jsxs("button",{onClick:()=>s(o.id,"block"),style:{...t.actionButton,...t.blockButton},children:[e.jsx(v,{style:{marginRight:"5px"}})," Block"]}),e.jsxs("button",{onClick:()=>s(o.id,"ignore"),style:{...t.actionButton,...t.ignoreButton},children:[e.jsx(S,{style:{marginRight:"5px"}})," Ignore"]})]})]})]})},L=[{key:"all",label:"All",icon:""},{key:"safe",label:"Safe",icon:"âœ… "},{key:"flagged",label:"Flagged",icon:"âš ï¸ "},{key:"blocked",label:"Blocked",icon:"ðŸš« "}],H=({fetchWithAuth:o,apiBaseUrl:s,onClose:r,messageId:i})=>{const{scanResults:a,filteredResults:c,loading:u,filter:d,setFilter:m,exportResults:y,reviewResult:j}=F(o,s,i);return e.jsx("div",{style:t.overlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(C,{style:{marginRight:"10px",color:"#5865f2"}}),e.jsx("h2",{style:t.title,children:"Content Scanner Results"})]}),e.jsx("button",{onClick:r,style:t.closeButton,children:e.jsx(w,{})})]}),e.jsxs("div",{style:t.filters,children:[L.map(n=>e.jsxs("button",{onClick:()=>m(n.key),style:{...t.filterButton,...d===n.key&&t.filterButtonActive},children:[n.icon,n.label," (",n.key==="all"?a.length:a.filter(p=>p.status===n.key).length,")"]},n.key)),e.jsxs("button",{onClick:y,style:t.exportButton,children:[e.jsx(B,{style:{marginRight:"5px"}})," Export"]})]}),e.jsx("div",{style:t.content,children:u?e.jsx("div",{style:t.loading,children:"Loading scan results..."}):c.length===0?e.jsx("div",{style:t.empty,children:"No scan results found"}):e.jsx("div",{style:t.resultsList,children:c.map((n,p)=>e.jsx(_,{result:n,onReview:j},p))})})]})})};export{H as default};
