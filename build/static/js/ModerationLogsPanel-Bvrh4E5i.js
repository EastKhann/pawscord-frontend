import{r as i,j as e}from"./react-core-D6cE4lil.js";import{a5 as S,a as Y,b2 as F,b6 as A,E as b,d as C,Z as K,cB as L,e as P,ao as G,ai as E,ab as Z,a8 as V,a4 as q,b4 as J,H as Q,g as W,b1 as X}from"./icons-vendor-DT2gd7vx.js";import{y as j}from"./ui-vendor-CZOhtEfS.js";import{h as I}from"./index-ClHcoIda.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-BYnay7oC.js";const ce=({serverId:o,onClose:f})=>{const[k,d]=i.useState([]),[x,y]=i.useState(!0),[a,m]=i.useState({action_type:"all",moderator:"",target_user:"",date_from:"",date_to:""}),[p,$]=i.useState(!1),[v,M]=i.useState(null),[l,g]=i.useState(null),[h,c]=i.useState(1),[T,B]=i.useState(!0),u=localStorage.getItem("access_token");i.useEffect(()=>{_(),D()},[o,a,h]);const _=async()=>{y(!0);try{const s=new URLSearchParams({page:h,...Object.fromEntries(Object.entries(a).filter(([t,r])=>r&&r!=="all"))}),n=await fetch(`/api/servers/${o}/moderation/logs/?${s}`,{headers:{Authorization:`Bearer ${u}`}});if(n.ok){const t=await n.json();d(h===1?t.logs||[]:r=>[...r,...t.logs||[]]),B(t.has_more??!0)}else d([])}catch{d([])}y(!1)},D=async()=>{try{const s=await fetch(`/api/servers/${o}/moderation/stats/`,{headers:{Authorization:`Bearer ${u}`}});s.ok?g(await s.json()||N):g(N)}catch{g(N)}},N={total_actions:0,this_week:0,bans:0,kicks:0,timeouts:0,warns:0,mutes:0,deletes:0,automod_actions:0,top_moderators:[]},U=s=>({ban:e.jsx(F,{className:"action-ban"}),kick:e.jsx(A,{className:"action-kick"}),timeout:e.jsx(b,{className:"action-timeout"}),mute:e.jsx(X,{className:"action-mute"}),warn:e.jsx(C,{className:"action-warn"}),delete_messages:e.jsx(W,{className:"action-delete"}),automod:e.jsx(Q,{className:"action-automod"})})[s]||e.jsx(J,{}),z=s=>({ban:"Yasaklama",kick:"Sunucudan Atma",timeout:"Zaman Aşımı",mute:"Susturma",warn:"Uyarı",delete_messages:"Mesaj Silme",automod:"AutoMod"})[s]||s,O=async s=>{if(await I("Bu moderasyon eylemini geri almak istediğinizden emin misiniz?"))try{(await fetch(`/api/servers/${o}/moderation/logs/${s}/revert/`,{method:"POST",headers:{Authorization:`Bearer ${u}`}})).ok&&(j.success("Eylem geri alındı"),_())}catch{d(k.map(t=>t.id===s?{...t,reverted:!0}:t)),j.success("Eylem geri alındı")}},R=async()=>{try{const s=await fetch(`/api/servers/${o}/moderation/logs/export/`,{headers:{Authorization:`Bearer ${u}`}});if(s.ok){const n=await s.blob(),t=window.URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=`moderation-logs-${new Date().toISOString().split("T")[0]}.csv`,r.click(),j.success("Loglar indirildi")}}catch{j.error("Dışa aktarma başarısız")}},H=s=>new Date(s).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),w=k;return e.jsx("div",{className:"moderation-logs-overlay",onClick:s=>s.target.className==="moderation-logs-overlay"&&f(),children:e.jsxs("div",{className:"moderation-logs-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(S,{})," Moderasyon Logları"]}),e.jsx("button",{className:"close-btn",onClick:f,children:e.jsx(Y,{})})]}),l&&e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:l.total_actions}),e.jsx("span",{className:"stat-label",children:"Toplam"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:l.this_week}),e.jsx("span",{className:"stat-label",children:"Bu Hafta"})]}),e.jsxs("div",{className:"stat-item ban",children:[e.jsx(F,{}),e.jsx("span",{children:l.bans})]}),e.jsxs("div",{className:"stat-item kick",children:[e.jsx(A,{}),e.jsx("span",{children:l.kicks})]}),e.jsxs("div",{className:"stat-item timeout",children:[e.jsx(b,{}),e.jsx("span",{children:l.timeouts})]}),e.jsxs("div",{className:"stat-item warn",children:[e.jsx(C,{}),e.jsx("span",{children:l.warns})]})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filters-header",children:[e.jsxs("button",{className:"filter-toggle",onClick:()=>$(!p),children:[e.jsx(K,{})," Filtreler",p?e.jsx(L,{}):e.jsx(P,{})]}),e.jsxs("button",{className:"export-btn",onClick:R,children:[e.jsx(G,{})," Dışa Aktar"]})]}),p&&e.jsxs("div",{className:"filters-content",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Eylem Türü"}),e.jsxs("select",{value:a.action_type,onChange:s=>{m({...a,action_type:s.target.value}),c(1)},children:[e.jsx("option",{value:"all",children:"Tümü"}),e.jsx("option",{value:"ban",children:"Yasaklama"}),e.jsx("option",{value:"kick",children:"Atma"}),e.jsx("option",{value:"timeout",children:"Zaman Aşımı"}),e.jsx("option",{value:"mute",children:"Susturma"}),e.jsx("option",{value:"warn",children:"Uyarı"}),e.jsx("option",{value:"delete_messages",children:"Mesaj Silme"}),e.jsx("option",{value:"automod",children:"AutoMod"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Moderatör"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:a.moderator,onChange:s=>{m({...a,moderator:s.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Hedef Kullanıcı"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:a.target_user,onChange:s=>{m({...a,target_user:s.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Başlangıç"}),e.jsx("input",{type:"date",value:a.date_from,onChange:s=>{m({...a,date_from:s.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Bitiş"}),e.jsx("input",{type:"date",value:a.date_to,onChange:s=>{m({...a,date_to:s.target.value}),c(1)}})]})]})]}),e.jsx("div",{className:"panel-content",children:x&&h===1?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):w.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(S,{}),e.jsx("p",{children:"Moderasyon logu bulunamadı"})]}):e.jsxs("div",{className:"logs-list",children:[w.map(s=>e.jsxs("div",{className:`log-item ${s.reverted?"reverted":""}`,children:[e.jsx("div",{className:"log-icon",children:U(s.action_type)}),e.jsxs("div",{className:"log-main",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("span",{className:`action-badge ${s.action_type}`,children:z(s.action_type)}),s.reverted&&e.jsxs("span",{className:"reverted-badge",children:[e.jsx(E,{})," Geri Alındı"]}),e.jsxs("span",{className:"log-time",children:[e.jsx(b,{})," ",H(s.created_at)]})]}),e.jsxs("div",{className:"log-users",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:s.moderator.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:s.moderator.username})]}),e.jsx("span",{className:"arrow",children:"→"}),e.jsxs("div",{className:"user-info target",children:[e.jsx("img",{src:s.target_user.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:s.target_user.username})]})]}),e.jsxs("div",{className:"log-reason",children:[e.jsx(Z,{})," ",s.reason]}),s.channel&&e.jsxs("div",{className:"log-channel",children:[e.jsx(V,{})," ",s.channel.name]}),v===s.id&&s.details&&Object.keys(s.details).length>0&&e.jsxs("div",{className:"log-details",children:[s.details.duration&&e.jsxs("span",{children:[e.jsx("strong",{children:"Süre:"})," ",s.details.duration]}),s.details.message_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Silinen Mesaj:"})," ",s.details.message_count]}),s.details.warning_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Toplam Uyarı:"})," ",s.details.warning_count]}),s.details.trigger&&e.jsxs("span",{children:[e.jsx("strong",{children:"Tetikleyici:"})," ",s.details.trigger]}),s.details.evidence&&e.jsxs("div",{className:"evidence",children:[e.jsx("strong",{children:"Kanıtlar:"}),e.jsx("ul",{children:s.details.evidence.map((n,t)=>e.jsx("li",{children:n},t))})]})]})]}),e.jsxs("div",{className:"log-actions",children:[Object.keys(s.details||{}).length>0&&e.jsx("button",{className:"detail-btn",onClick:()=>M(v===s.id?null:s.id),title:"Detaylar",children:v===s.id?e.jsx(L,{}):e.jsx(q,{})}),!s.reverted&&["ban","mute","timeout"].includes(s.action_type)&&e.jsx("button",{className:"revert-btn",onClick:()=>O(s.id),title:"Geri Al",children:e.jsx(E,{})})]})]},s.id)),T&&e.jsx("button",{className:"load-more-btn",onClick:()=>c(s=>s+1),disabled:x,children:x?"Yükleniyor...":"Daha Fazla Yükle"})]})})]})})};export{ce as default};
