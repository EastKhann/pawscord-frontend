var Q=Object.defineProperty;var o=(n,l)=>Q(n,"name",{value:l,configurable:!0});import{r as s,j as a}from"./react-core-Djgtqrmb.js";import{t as b}from"./index-CjRzheBN.js";import{Q as T}from"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const q=o(({onClose:n,fetchWithAuth:l,apiBaseUrl:j})=>{const[c,m]=s.useState(1),[w,y]=s.useState(""),[h,N]=s.useState(""),[k,g]=s.useState([]),[i,v]=s.useState(""),[p,r]=s.useState(""),[f,d]=s.useState(!1);s.useEffect(()=>{c===1&&C()},[c]);const C=o(async()=>{d(!0);try{const e=await l(`${j}/auth/2fa/setup/`,{method:"POST"});if(e.ok){const t=await e.json();N(t.secret);const u=await T.toDataURL(t.otpauth_url);y(u)}else{const t=await e.json();r(t.error||"QR kod oluÅŸturulamadÄ±")}}catch{r("BaÄŸlantÄ± hatasÄ±")}finally{d(!1)}},"generateQRCode"),R=o(async()=>{if(i.length!==6){r("6 haneli kod giriniz");return}d(!0),r("");try{const e=await l(`${j}/auth/2fa/verify/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i,secret:h})});if(e.ok){const t=await e.json();g(t.backup_codes),m(3)}else{const t=await e.json();r(t.error||"GeÃ§ersiz kod")}}catch{r("DoÄŸrulama hatasÄ±")}finally{d(!1)}},"handleVerify"),S=o(()=>{const e=k.join(`
`),t=new Blob([e],{type:"text/plain"}),u=URL.createObjectURL(t),x=document.createElement("a");x.href=u,x.download="pawscord-backup-codes.txt",x.click(),URL.revokeObjectURL(u)},"downloadBackupCodes"),D=o(()=>{b.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),n(),window.location.reload()},"handleComplete");return a.jsx("div",{className:"twofa-modal-overlay",onClick:n,children:a.jsxs("div",{className:"twofa-modal-content",onClick:o(e=>e.stopPropagation(),"onClick"),children:[a.jsx("button",{className:"twofa-close-btn",onClick:n,children:"Ã—"}),a.jsx("h2",{children:"ðŸ” Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama"}),c===1&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 1: QR Kodu Tara"}),a.jsx("p",{children:"Google Authenticator veya Authy uygulamasÄ±yla bu QR kodu tarayÄ±n:"}),f?a.jsx("div",{className:"twofa-loading",children:"QR kod oluÅŸturuluyor..."}):w?a.jsxs(a.Fragment,{children:[a.jsx("img",{src:w,alt:"QR Code",className:"twofa-qr-code"}),a.jsxs("div",{className:"twofa-secret",children:[a.jsx("p",{children:a.jsx("strong",{children:"Manuel Kod:"})}),a.jsx("code",{children:h}),a.jsx("button",{onClick:o(()=>{navigator.clipboard.writeText(h),b.success("âœ… Kod kopyalandÄ±!")},"onClick"),className:"twofa-copy-btn",children:"ðŸ“‹ Kopyala"})]}),a.jsx("button",{onClick:o(()=>m(2),"onClick"),className:"twofa-next-btn",children:"Ä°leri â†’"})]}):a.jsx("div",{className:"twofa-error",children:p})]}),c===2&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 2: DoÄŸrulama Kodu"}),a.jsx("p",{children:"Authenticator uygulamasÄ±ndaki 6 haneli kodu girin:"}),a.jsx("input",{type:"text",maxLength:"6",value:i,onChange:o(e=>v(e.target.value.replace(/\D/g,"")),"onChange"),placeholder:"000000",className:"twofa-code-input",autoFocus:!0}),p&&a.jsx("div",{className:"twofa-error",children:p}),a.jsxs("div",{className:"twofa-buttons",children:[a.jsx("button",{onClick:o(()=>m(1),"onClick"),className:"twofa-back-btn",children:"â† Geri"}),a.jsx("button",{onClick:R,disabled:f||i.length!==6,className:"twofa-verify-btn",children:f?"DoÄŸrulanÄ±yor...":"DoÄŸrula"})]})]}),c===3&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 3: Yedek Kodlar"}),a.jsx("p",{className:"twofa-warning",children:"âš ï¸ Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n! Telefonunuza eriÅŸemediÄŸinizde bu kodlarÄ± kullanabilirsiniz."}),a.jsx("div",{className:"twofa-backup-codes",children:k.map((e,t)=>a.jsx("div",{className:"twofa-backup-code",children:e},t))}),a.jsxs("div",{className:"twofa-buttons",children:[a.jsx("button",{onClick:S,className:"twofa-download-btn",children:"ðŸ’¾ Ä°ndir"}),a.jsx("button",{onClick:D,className:"twofa-complete-btn",children:"âœ… Tamamla"})]})]})]})})},"TwoFactorSetup");export{q as default};
