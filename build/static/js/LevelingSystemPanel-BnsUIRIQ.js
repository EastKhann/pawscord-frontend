var P=Object.defineProperty;var s=(l,i)=>P(l,"name",{value:i,configurable:!0});import{r as x,j as e}from"./react-core-Djgtqrmb.js";import{y as h}from"./ui-vendor-IhB9Znpc.js";import{e as X,g as A}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const E={enabled:!1,xp_per_message:15,xp_cooldown:60,level_up_message:"Tebrikler {user}! Seviye {level} oldun! ðŸŽ‰",announce_channel_id:"",stack_roles:!1,reset_on_leave:!1},z=s(l=>l===1?"#fbbf24":l===2?"#c0c0c0":l===3?"#cd7f32":"#6366f1","getRankColor"),H=s(l=>{const c=100-l;return Math.max(1,Math.floor((-50+Math.sqrt(2500-20*c))/10))},"getLevelForXP"),S=s(l=>5*l**2+50*l+100,"getXPForLevel"),T=s(l=>{const[i,a]=x.useState(E),[c,m]=x.useState([]),[d,t]=x.useState({level:1,role_id:""}),[u,p]=x.useState([]),[g,f]=x.useState([]),[j,b]=x.useState([]),[y,N]=x.useState(!0),n=A(),v=s(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),"headers"),_=s(()=>({...v(),"Content-Type":"application/json"}),"jsonHeaders"),w=s(async()=>{try{const r=await fetch(`${n}/leveling/server/${l}/config/`,{headers:v()});if(r.ok){const o=await r.json();o.config&&a(o.config)}}catch{}finally{N(!1)}},"fetchConfig"),k=s(async()=>{try{const r=await fetch(`${n}/leveling/server/${l}/roles/`,{headers:v()});if(r.ok){const o=await r.json();m(o.roles||[])}}catch{}},"fetchLevelRoles"),$=s(async()=>{try{const r=await fetch(`${n}/servers/${l}/roles/`,{headers:v()});if(r.ok){const o=await r.json();p(o.roles||[])}}catch{}},"fetchRoles"),L=s(async()=>{try{const r=await fetch(`${n}/servers/${l}/channels/`,{headers:v()});if(r.ok){const o=await r.json();f(o.channels||[])}}catch{}},"fetchChannels"),C=s(async()=>{try{const r=await fetch(`${n}/leveling/server/${l}/leaderboard/`,{headers:v()});if(r.ok){const o=await r.json();b(o.leaderboard||[])}}catch{}},"fetchLeaderboard");return x.useEffect(()=>{l&&(w(),k(),$(),L(),C())},[l]),{config:i,updateConfig:s((r,o)=>a({...i,[r]:o}),"updateConfig"),levelRoles:c,newRole:d,setNewRole:t,roles:u,channels:g,leaderboard:j,loading:y,saveConfig:s(async()=>{try{(await fetch(`${n}/leveling/server/${l}/config/update/`,{method:"POST",headers:_(),body:JSON.stringify(i)})).ok?h.success("âœ… Ayarlar kaydedildi"):h.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch{h.error("âŒ Hata oluÅŸtu")}},"saveConfig"),addLevelRole:s(async()=>{if(!d.role_id){h.error("âš ï¸ Rol seÃ§in");return}try{(await fetch(`${n}/leveling/server/${l}/roles/add/`,{method:"POST",headers:_(),body:JSON.stringify(d)})).ok&&(k(),t({level:1,role_id:""}),h.success("âœ… Rol eklendi"))}catch{h.error("âŒ Hata")}},"addLevelRole"),removeLevelRole:s(async r=>{try{(await fetch(`${n}/leveling/server/${l}/roles/${r}/delete/`,{method:"DELETE",headers:v()})).ok&&(k(),h.success("âœ… Rol kaldÄ±rÄ±ldÄ±"))}catch{h.error("âŒ Hata")}},"removeLevelRole"),resetUserXP:s(async r=>{if(await X("Bu kullanÄ±cÄ±nÄ±n XP'sini sÄ±fÄ±rlamak istediÄŸinize emin misiniz?"))try{(await fetch(`${n}/leveling/server/${l}/user/${r}/reset/`,{method:"POST",headers:v()})).ok&&(C(),h.success("âœ… XP sÄ±fÄ±rlandÄ±"))}catch{h.error("âŒ Hata")}},"resetUserXP")}},"useLevelingSystem"),M=s(({levelRoles:l,newRole:i,setNewRole:a,roles:c,addLevelRole:m,removeLevelRole:d})=>e.jsxs("div",{className:"level-roles-section",children:[e.jsxs("h3",{children:["ðŸŽ¯"," Seviye Rolleri"]}),e.jsxs("div",{className:"add-role-form",children:[e.jsx("input",{type:"number",min:"1",max:"100",value:i.level,onChange:s(t=>a({...i,level:parseInt(t.target.value)||1}),"onChange"),placeholder:"Seviye",className:"level-input"}),e.jsxs("select",{value:i.role_id,onChange:s(t=>a({...i,role_id:t.target.value}),"onChange"),className:"role-select",children:[e.jsxs("option",{value:"",children:["Rol se","Ã§","in"]}),c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("button",{className:"add-role-btn",onClick:m,children:["âž•"," Ekle"]})]}),l.length>0?e.jsx("div",{className:"level-roles-list",children:l.map(t=>e.jsxs("div",{className:"level-role-item",children:[e.jsxs("span",{className:"level-badge",children:["Lv. ",t.level]}),e.jsx("span",{className:"role-name",children:t.role_name||"Rol"}),e.jsx("button",{className:"remove-role-btn",onClick:s(()=>d(t.id),"onClick"),children:"âœ–"})]},t.id))}):e.jsxs("p",{className:"no-data",children:["Hen","Ã¼","z seviye rol","Ã¼"," yok"]})]}),"LevelRolesSection"),O=s(({leaderboard:l,resetUserXP:i})=>e.jsxs("div",{className:"leaderboard-section",children:[e.jsxs("h3",{children:["ðŸ†"," S","Ä±","ralama"]}),l.length>0?e.jsx("div",{className:"leaderboard-list",children:l.map((a,c)=>{const m=c+1,d=H(a.xp),t=S(d+1),u=S(d),p=(a.xp-u)/(t-u)*100;return e.jsxs("div",{className:"leaderboard-item",children:[e.jsx("span",{className:"rank",style:{color:z(m)},children:m}),e.jsx("img",{className:"user-avatar",src:a.avatar||`https://ui-avatars.com/api/?name=${a.username}`,alt:a.username}),e.jsxs("div",{className:"user-info",children:[e.jsx("span",{className:"username",children:a.username}),e.jsx("div",{className:"xp-bar-container",children:e.jsx("div",{className:"xp-bar",style:{width:`${Math.min(p,100)}%`,background:"linear-gradient(90deg, #5865f2, #7289da)"}})}),e.jsxs("span",{className:"xp-text",children:["Seviye ",d," ","â€¢"," ",a.xp," XP"]})]}),e.jsxs("button",{className:"reset-xp-btn",onClick:s(()=>i(a.user_id),"onClick"),children:["ðŸ”„"," S","Ä±","f","Ä±","rla"]})]},a.user_id)})}):e.jsxs("p",{className:"no-data",children:["Hen","Ã¼","z veri yok"]})]}),"LeaderboardSection"),ee=s(({serverId:l,onClose:i})=>{const{config:a,updateConfig:c,levelRoles:m,newRole:d,setNewRole:t,roles:u,channels:p,leaderboard:g,loading:f,saveConfig:j,addLevelRole:b,removeLevelRole:y,resetUserXP:N}=T(l);return f?e.jsx("div",{className:"leveling-overlay",children:e.jsx("div",{className:"leveling-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Seviye sistemi y","Ã¼","kleniyor..."]})]})})}):e.jsx("div",{className:"leveling-overlay",onClick:i,children:e.jsxs("div",{className:"leveling-panel",onClick:s(n=>n.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"leveling-header",children:[e.jsxs("h2",{children:["â­"," Seviye Sistemi"]}),e.jsx("button",{className:"close-btn",onClick:i,children:"Ã—"})]}),e.jsxs("div",{className:"leveling-content",children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:["âš™ï¸"," Genel Ayarlar"]}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:a.enabled,onChange:s(n=>c("enabled",n.target.checked),"onChange")}),e.jsx("span",{className:"slider"}),e.jsx("span",{className:"toggle-label",children:a.enabled?"Aktif":"Pasif"})]})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Mesaj Ba","ÅŸÄ±","na XP"]}),e.jsx("input",{type:"number",min:"1",max:"100",value:a.xp_per_message,onChange:s(n=>c("xp_per_message",parseInt(n.target.value)),"onChange"),disabled:!a.enabled})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"XP Cooldown (saniye)"}),e.jsx("input",{type:"number",min:"0",max:"300",value:a.xp_cooldown,onChange:s(n=>c("xp_cooldown",parseInt(n.target.value)),"onChange"),disabled:!a.enabled})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:["Duyuru Kanal","Ä±"]}),e.jsxs("select",{value:a.announce_channel_id,onChange:s(n=>c("announce_channel_id",n.target.value),"onChange"),disabled:!a.enabled,children:[e.jsxs("option",{value:"",children:["Se","Ã§","iniz (opsiyonel)"]}),p.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:["Seviye Atlama Mesaj","Ä±"]}),e.jsx("textarea",{value:a.level_up_message,onChange:s(n=>c("level_up_message",n.target.value),"onChange"),disabled:!a.enabled,rows:"2"}),e.jsxs("span",{className:"hint",children:["Kullan","Ä±","labilir: ","{user}",", ","{level}"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.stack_roles,onChange:s(n=>c("stack_roles",n.target.checked),"onChange"),disabled:!a.enabled}),e.jsxs("span",{children:["Rolleri biriktir (","Ã¶","nceki seviye rollerini kald","Ä±","rma)"]})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.reset_on_leave,onChange:s(n=>c("reset_on_leave",n.target.checked),"onChange"),disabled:!a.enabled}),e.jsxs("span",{children:["Sunucudan ayr","Ä±","l","Ä±","nca XP'yi s","Ä±","f","Ä±","rla"]})]})})]}),e.jsxs("button",{className:"save-btn",onClick:j,children:["ðŸ’¾"," Ayarlar","Ä±"," Kaydet"]})]}),e.jsx(M,{levelRoles:m,newRole:d,setNewRole:t,roles:u,addLevelRole:b,removeLevelRole:y}),e.jsx(O,{leaderboard:g,resetUserXP:N})]})]})})},"LevelingSystemPanel");export{ee as default};
