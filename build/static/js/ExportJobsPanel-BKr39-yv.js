import{r as a,n as e}from"./react-core-zXIKm1Jm.js";import{al as c,a as h,z as j,bc as B,D,aU as R,A as L}from"./icons-vendor-BBdoVeJd.js";import{t as n}from"./index-DzDUXmXs.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const H=({fetchWithAuth:r,apiBaseUrl:l,onClose:p,username:$})=>{const[x,b]=a.useState([]),[S,v]=a.useState(!0),[f,C]=a.useState("messages"),[g,u]=a.useState(!1),m=[{id:"messages",name:"Messages",description:"Export all your messages"},{id:"server",name:"Server Data",description:"Export server content"},{id:"dm",name:"Direct Messages",description:"Export DM history"},{id:"media",name:"Media Files",description:"Export uploaded media"},{id:"profile",name:"Profile Data",description:"Export your profile info"},{id:"analytics",name:"Analytics",description:"Export analytics data"}];a.useEffect(()=>{d();const t=setInterval(d,5e3);return()=>clearInterval(t)},[]);const d=async()=>{try{const s=await(await r(`${l}/exports/jobs/`)).json();b(s.jobs||[])}catch(t){console.error("Failed to load export jobs:",t)}finally{v(!1)}},w=async()=>{u(!0);try{const s=await(await r(`${l}/exports/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:f})})).json();s.success?(n.success("Export job created! Processing..."),d()):n.error(s.error||"Failed to create export")}catch(t){console.error("Export creation error:",t),n.error("Failed to create export")}finally{u(!1)}},E=async t=>{try{const T=await(await r(`${l}/exports/${t}/download/`)).blob(),y=window.URL.createObjectURL(T),i=document.createElement("a");i.href=y,i.download=`export_${t}.zip`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(y),n.success("Download started!")}catch(s){console.error("Download error:",s),n.error("Download failed")}},z=async t=>{if(window.confirm("Delete this export job?"))try{await r(`${l}/exports/${t}/delete/`,{method:"DELETE"}),n.success("Export job deleted"),d()}catch(s){console.error("Delete error:",s),n.error("Failed to delete job")}},k=t=>{switch(t){case"completed":return e.jsx(L,{style:{color:"#43b581"}});case"processing":return e.jsx(j,{style:{color:"#faa61a"},className:"fa-spin"});case"failed":return e.jsx(R,{style:{color:"#f04747"}});default:return e.jsx(D,{style:{color:"#99aab5"}})}},F=t=>{switch(t){case"completed":return"#43b581";case"processing":return"#faa61a";case"failed":return"#f04747";default:return"#99aab5"}};return e.jsx("div",{style:o.overlay,onClick:p,children:e.jsxs("div",{style:o.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:o.header,children:[e.jsxs("div",{style:o.headerLeft,children:[e.jsx(c,{style:{fontSize:"24px",color:"#5865f2"}}),e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"Export Jobs"})]}),e.jsx("button",{onClick:p,style:o.closeBtn,children:e.jsx(h,{})})]}),e.jsxs("div",{style:o.content,children:[e.jsxs("div",{style:o.createSection,children:[e.jsx("h3",{style:o.sectionTitle,children:"Create New Export"}),e.jsxs("div",{style:o.exportTypeSelector,children:[e.jsx("select",{value:f,onChange:t=>C(t.target.value),style:o.select,children:m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.description]},t.id))}),e.jsx("button",{onClick:w,disabled:g,style:o.createBtn,children:g?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"fa-spin"})," Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{})," Create Export"]})})]})]}),e.jsxs("div",{style:o.jobsSection,children:[e.jsx("h3",{style:o.sectionTitle,children:"Your Export Jobs"}),S?e.jsx("div",{style:o.loading,children:"Loading jobs..."}):x.length===0?e.jsxs("div",{style:o.empty,children:[e.jsx(B,{style:{fontSize:"48px",color:"#99aab5",marginBottom:"16px"}}),e.jsx("p",{children:"No export jobs yet"}),e.jsx("p",{style:{fontSize:"14px",color:"#99aab5"},children:"Create your first export to get started"})]}):e.jsx("div",{style:o.jobsList,children:x.map(t=>e.jsxs("div",{style:o.jobCard,children:[e.jsx("div",{style:o.jobIcon,children:k(t.status)}),e.jsxs("div",{style:o.jobDetails,children:[e.jsx("div",{style:o.jobTitle,children:m.find(s=>s.id===t.type)?.name||t.type}),e.jsxs("div",{style:o.jobMeta,children:[e.jsxs("span",{children:["Created: ",new Date(t.created_at).toLocaleString()]}),t.completed_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{margin:"0 8px"},children:"â€¢"}),e.jsxs("span",{children:["Completed: ",new Date(t.completed_at).toLocaleString()]})]})]}),t.status==="processing"&&t.progress&&e.jsxs("div",{style:o.progressBar,children:[e.jsx("div",{style:{...o.progressFill,width:`${t.progress}%`}}),e.jsxs("span",{style:o.progressText,children:[t.progress,"%"]})]}),t.file_size&&e.jsxs("div",{style:o.fileSize,children:["Size: ",I(t.file_size)]})]}),e.jsxs("div",{style:o.jobActions,children:[e.jsx("span",{style:{...o.statusBadge,backgroundColor:F(t.status)},children:t.status}),t.status==="completed"&&e.jsx("button",{onClick:()=>E(t.id),style:o.downloadBtn,title:"Download",children:e.jsx(c,{})}),e.jsx("button",{onClick:()=>z(t.id),style:o.deleteBtn,title:"Delete",children:e.jsx(h,{})})]})]},t.id))})]}),e.jsxs("div",{style:o.info,children:[e.jsx("p",{style:o.infoText,children:"ðŸ“¦ Exports are processed in the background and may take a few minutes"}),e.jsx("p",{style:o.infoText,children:"ðŸ’¾ Completed exports are available for 7 days before auto-deletion"})]})]})]})})},I=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(2)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(2)} MB`:`${(r/(1024*1024*1024)).toFixed(2)} GB`,o={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},createSection:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",marginBottom:"24px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},exportTypeSelector:{display:"flex",gap:"12px"},select:{flex:1,padding:"10px",backgroundColor:"#202225",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px"},createBtn:{padding:"10px 24px",backgroundColor:"#5865f2",border:"none",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},jobsSection:{marginBottom:"24px"},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},empty:{textAlign:"center",padding:"60px 20px",color:"#dcddde"},jobsList:{display:"flex",flexDirection:"column",gap:"12px"},jobCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center",gap:"16px"},jobIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},jobDetails:{flex:1},jobTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"4px"},jobMeta:{fontSize:"12px",color:"#99aab5",marginBottom:"8px"},progressBar:{position:"relative",height:"20px",backgroundColor:"#202225",borderRadius:"10px",overflow:"hidden",marginTop:"8px"},progressFill:{height:"100%",backgroundColor:"#5865f2",transition:"width 0.3s ease"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:"600",color:"#fff"},fileSize:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},jobActions:{display:"flex",alignItems:"center",gap:"8px"},statusBadge:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},downloadBtn:{padding:"8px 12px",backgroundColor:"#43b581",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},deleteBtn:{padding:"8px 12px",backgroundColor:"#f04747",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},info:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},infoText:{fontSize:"14px",color:"#dcddde",margin:"8px 0",lineHeight:"1.6"}};export{H as default};
