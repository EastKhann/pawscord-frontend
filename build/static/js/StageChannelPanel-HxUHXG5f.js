var C=Object.defineProperty;var a=(i,l)=>C(i,"name",{value:l,configurable:!0});import{r as d,j as e}from"./react-core-Djgtqrmb.js";import{t as c}from"./index-D0nbcjO7.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";import"./ui-vendor-IhB9Znpc.js";const R=a(({roomId:i,apiBaseUrl:l,onClose:p,currentUser:w})=>{const[g,j]=d.useState([]),[$,A]=d.useState(null),[k,v]=d.useState(!0),[x,h]=d.useState("list"),[n,o]=d.useState({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0});d.useEffect(()=>{m();const s=setInterval(m,5e3);return()=>clearInterval(s)},[i]);const m=a(async()=>{try{const s=localStorage.getItem("access_token"),t=i?`${l}/stages/active/`:`${l}/stages/active/`,r=await fetch(t,{headers:{Authorization:`Bearer ${s}`}});if(r.ok){const u=await r.json();j(Array.isArray(u)?u:u.stages||[])}}catch{}finally{v(!1)}},"fetchActiveStages"),N=a(async()=>{if(!n.topic.trim()){c.error("âš ï¸ Konu baÅŸlÄ±ÄŸÄ± gerekli");return}if(!i){c.error("âš ï¸ LÃ¼tfen bir ses kanalÄ±nda olun");return}try{const s=localStorage.getItem("access_token"),t=await fetch(`${l}/stages/create/${i}/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(t.ok){const r=await t.json();j([...g,r.stage]),o({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0}),h("list"),c.success("âœ… Stage oluÅŸturuldu!")}else{const r=await t.json();c.error(r.error||"âŒ Stage oluÅŸturulamadÄ±")}}catch{c.error("âŒ Hata oluÅŸtu")}},"handleCreateStage"),S=a(async s=>{try{const t=localStorage.getItem("access_token"),r=await fetch(`${l}/stages/${s}/join/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(r.ok)c.success("ðŸŽ™ï¸ Stage'e katÄ±ldÄ±n!"),m();else{const u=await r.json();c.error(u.error||"âŒ Stage'e katÄ±lamadÄ±n")}}catch{c.error("âŒ Hata oluÅŸtu")}},"handleJoinStage"),b=a(async s=>{try{const t=localStorage.getItem("access_token");(await fetch(`${l}/stages/${s}/leave/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&(c.success("ðŸ‘‹ Stage'den ayrÄ±ldÄ±n"),m())}catch{}},"handleLeaveStage"),f=a(async s=>{try{const t=localStorage.getItem("access_token");(await fetch(`${l}/stages/${s}/request-speak/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&c.success("âœ‹ KonuÅŸma talebi gÃ¶nderildi")}catch{}},"handleRequestToSpeak"),y=a(s=>({host:"ðŸ‘‘",moderator:"ðŸ›¡ï¸",speaker:"ðŸŽ™ï¸",listener:"ðŸ‘‚"})[s]||"ðŸ‘¤","getRoleIcon"),_=a(s=>({host:"#faa61a",moderator:"#8b5cf6",speaker:"#34c759",listener:"#6c6d7d"})[s]||"#6c6d7d","getRoleColor");return k?e.jsx("div",{className:"stage-overlay",onClick:p,children:e.jsx("div",{className:"stage-panel",onClick:a(s=>s.stopPropagation(),"onClick"),children:e.jsxs("div",{className:"stage-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"stage-overlay",onClick:p,children:e.jsxs("div",{className:"stage-panel",onClick:a(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"stage-header",children:[e.jsx("h2",{children:"ðŸŽ™ï¸ Stage KanallarÄ±"}),e.jsxs("div",{className:"header-actions",children:[i&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`view-toggle ${x==="list"?"active":""}`,onClick:a(()=>h("list"),"onClick"),children:"ðŸ“‹ Aktif Stage'ler"}),e.jsx("button",{className:`view-toggle ${x==="create"?"active":""}`,onClick:a(()=>h("create"),"onClick"),children:"âž• OluÅŸtur"})]}),e.jsx("button",{className:"close-btn",onClick:p,children:"âœ•"})]})]}),e.jsx("div",{className:"stage-content",children:x==="list"?e.jsx("div",{className:"stages-list",children:g.length>0?g.map(s=>e.jsxs("div",{className:"stage-card",children:[e.jsxs("div",{className:"stage-info",children:[e.jsx("div",{className:"stage-icon",children:"ðŸŽ™ï¸"}),e.jsxs("div",{className:"stage-details",children:[e.jsx("h3",{children:s.topic}),s.description&&e.jsx("p",{className:"stage-description",children:s.description}),e.jsxs("div",{className:"stage-meta",children:[e.jsxs("span",{children:["ðŸ‘‘ Host: ",s.host_username]}),e.jsxs("span",{children:["ðŸŽ™ï¸ ",s.speakers_count||0," konuÅŸmacÄ±"]}),e.jsxs("span",{children:["ðŸ‘‚ ",s.audience_count||0," dinleyici"]})]})]})]}),s.speakers&&s.speakers.length>0&&e.jsxs("div",{className:"speakers-list",children:[e.jsx("h4",{children:"KonuÅŸmacÄ±lar"}),e.jsxs("div",{className:"speakers-grid",children:[s.speakers.slice(0,6).map((t,r)=>e.jsxs("div",{className:"speaker-badge",children:[e.jsx("span",{className:"role-icon",style:{color:_(t.role)},children:y(t.role)}),e.jsx("span",{className:"speaker-name",children:t.username})]},r)),s.speakers.length>6&&e.jsxs("div",{className:"speaker-badge more",children:["+",s.speakers.length-6]})]})]}),e.jsx("div",{className:"stage-actions",children:s.is_member?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"leave-stage-btn",onClick:a(()=>b(s.id),"onClick"),children:"ðŸ‘‹ AyrÄ±l"}),s.user_role==="listener"&&e.jsx("button",{className:"request-speak-btn",onClick:a(()=>f(s.id),"onClick"),children:"âœ‹ KonuÅŸmak Ä°stiyorum"})]}):e.jsx("button",{className:"join-stage-btn",onClick:a(()=>S(s.id),"onClick"),children:"ðŸŽ§ Dinle"})})]},s.id)):e.jsxs("div",{className:"no-stages",children:[e.jsx("p",{children:"ðŸŽ™ï¸ Aktif stage yok"}),i&&e.jsx("button",{onClick:a(()=>h("create"),"onClick"),children:"Ä°lk stage'i oluÅŸtur"})]})}):e.jsxs("div",{className:"create-stage-form",children:[e.jsx("h3",{children:"ðŸŽ™ï¸ Yeni Stage OluÅŸtur"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Konu BaÅŸlÄ±ÄŸÄ± *"}),e.jsx("input",{type:"text",placeholder:"KonuÅŸma konusu...",value:n.topic,onChange:a(s=>o({...n,topic:s.target.value}),"onChange"),maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"AÃ§Ä±klama"}),e.jsx("textarea",{placeholder:"Stage hakkÄ±nda detaylar...",value:n.description,onChange:a(s=>o({...n,description:s.target.value}),"onChange"),rows:4})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Maks. KonuÅŸmacÄ± (1-10)"}),e.jsx("input",{type:"number",value:n.max_speakers,onChange:a(s=>o({...n,max_speakers:Math.min(10,Math.max(1,parseInt(s.target.value)||1))}),"onChange"),min:"1",max:"10"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Maks. Dinleyici"}),e.jsx("input",{type:"number",value:n.max_audience,onChange:a(s=>o({...n,max_audience:Math.min(1e3,Math.max(1,parseInt(s.target.value)||100))}),"onChange"),min:"1",max:"1000"})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:n.is_public,onChange:a(s=>o({...n,is_public:s.target.checked}),"onChange")}),e.jsx("span",{children:"ðŸŒ Herkese AÃ§Ä±k"})]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:N,children:"âœ¨ Stage OluÅŸtur"}),e.jsx("button",{className:"cancel-btn",onClick:a(()=>h("list"),"onClick"),children:"Ä°ptal"})]})]})})]})})},"StageChannelPanel");export{R as default};
