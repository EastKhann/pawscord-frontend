import{s as r}from"./index-DcErrD_T.js";import"./media-vendor-BsD1gqUZ.js";import"./react-core-Cj7FUMmY.js";import"./editor-vendor-D9c4a6XZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-DnRG7SaF.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";class I extends r{constructor(){super()}loadScript(){if(typeof document>"u")return;const e="gapi";if(document?.getElementById(e))return;const s=document.getElementsByTagName("head")[0],t=document.createElement("script");t.type="text/javascript",t.defer=!0,t.async=!0,t.id=e,t.onload=this.platformJsLoaded.bind(this),t.src="https://apis.google.com/js/platform.js",s.appendChild(t)}initialize(e={clientId:"",scopes:[],grantOfflineAccess:!1}){var n,s;if(typeof window>"u")return;const t=(n=document.getElementsByName("google-signin-client_id")[0])===null||n===void 0?void 0:n.content,i=e.clientId||t||"";return this.options={clientId:i,grantOfflineAccess:(s=e.grantOfflineAccess)!==null&&s!==void 0?s:!1,scopes:e.scopes||[]},this.gapiLoaded=new Promise(o=>{window.gapiResolve=o,this.loadScript()}),this.addUserChangeListener(),this.gapiLoaded}platformJsLoaded(){gapi.load("auth2",()=>{const e={client_id:this.options.clientId,plugin_name:"CodetrixStudioCapacitorGoogleAuth"};this.options.scopes.length&&(e.scope=this.options.scopes.join(" ")),gapi.auth2.init(e),window.gapiResolve()})}async signIn(){return new Promise(async(e,n)=>{var s;try{let t;const i=(s=this.options.grantOfflineAccess)!==null&&s!==void 0?s:!1;i?t=(await gapi.auth2.getAuthInstance().grantOfflineAccess()).code:await gapi.auth2.getAuthInstance().signIn();const o=gapi.auth2.getAuthInstance().currentUser.get();i&&await o.reloadAuthResponse();const a=this.getUserFrom(o);a.serverAuthCode=t,e(a)}catch(t){n(t)}})}async refresh(){const e=await gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();return{accessToken:e.access_token,idToken:e.id_token,refreshToken:""}}async signOut(){return gapi.auth2.getAuthInstance().signOut()}async addUserChangeListener(){await this.gapiLoaded,gapi.auth2.getAuthInstance().currentUser.listen(e=>{this.notifyListeners("userChange",e.isSignedIn()?this.getUserFrom(e):null)})}getUserFrom(e){const n={},s=e.getBasicProfile();n.email=s.getEmail(),n.familyName=s.getFamilyName(),n.givenName=s.getGivenName(),n.id=s.getId(),n.imageUrl=s.getImageUrl(),n.name=s.getName();const t=e.getAuthResponse(!0);return n.authentication={accessToken:t.access_token,idToken:t.id_token,refreshToken:""},n}}export{I as GoogleAuthWeb};
