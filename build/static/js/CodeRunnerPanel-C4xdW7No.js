import{r as n,n as e}from"./react-core-Cj7FUMmY.js";import{r as c,cq as Q,aB as U,a as H,b5 as K,aO as g,g as P,ag as V,E,aA as X,a$ as Y,J as Z,bu as ee,B as se,d as ae,cJ as ne}from"./icons-vendor-8IeoBGEh.js";import{y as i}from"./ui-vendor-EA4dxvko.js";import"./editor-vendor-D9c4a6XZ.js";const oe=({serverId:j,channelId:d,onClose:p})=>{const[t,h]=n.useState(""),[r,m]=n.useState("python"),[u,l]=n.useState(""),[A,y]=n.useState(!1),[S,k]=n.useState(null),[C,B]=n.useState([]),[w,N]=n.useState(!1),[F,O]=n.useState([]),[R,b]=n.useState(!1),[f,D]=n.useState(!1),o=localStorage.getItem("access_token"),T=[{id:"python",name:"Python",icon:e.jsx(ne,{}),template:`# Python Code
print("Hello, World!")`},{id:"cpp",name:"C++",icon:e.jsx(c,{}),template:`#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`},{id:"c",name:"C",icon:e.jsx(c,{}),template:`#include <stdio.h>

int main() {
    printf("Hello, World!\\n");
    return 0;
}`},{id:"ruby",name:"Ruby",icon:e.jsx(c,{}),template:`# Ruby Code
puts "Hello, World!"`},{id:"go",name:"Go",icon:e.jsx(c,{}),template:`package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}`},{id:"rust",name:"Rust",icon:e.jsx(c,{}),template:`fn main() {
    println!("Hello, World!");
}`}];n.useEffect(()=>{$(),v()},[]),n.useEffect(()=>{const s=T.find(a=>a.id===r);s&&!t&&h(s.template)},[r]);const $=async()=>{try{const s=await fetch("/api/code-runner/history/",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const a=await s.json();B(a.history||[])}}catch{}},v=async()=>{try{const s=await fetch("/api/code-runner/snippets/",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const a=await s.json();O(a.snippets||[])}}catch{}},W=async()=>{if(!t.trim()){i.warning("Kod boş olamaz");return}y(!0),l("Çalıştırılıyor...");const s=Date.now();try{const a=await fetch("/api/code-runner/execute/",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({code:t,language:r,channel_id:d})}),x=await a.json(),I=Date.now();k(I-s),a.ok?(l(x.output||"Çıktı yok"),x.error&&l(`Hata:
${x.error}`)):l(`Hata: ${x.message||"Kod çalıştırılamadı"}`),$()}catch{l("Bağlantı hatası")}y(!1)},J=async()=>{try{await fetch("/api/code-runner/stop/",{method:"POST",headers:{Authorization:`Bearer ${o}`}}),y(!1),l("Çalıştırma durduruldu")}catch{i.error("Durdurma başarısız")}},G=async s=>{try{(await fetch("/api/code-runner/snippets/",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({name:s,code:t,language:r})})).ok&&(i.success("Snippet kaydedildi"),v(),b(!1))}catch{i.error("Kaydetme başarısız")}},z=s=>{h(s.code),m(s.language),N(!1)},L=async s=>{try{await fetch(`/api/code-runner/snippets/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),i.success("Snippet silindi"),v()}catch{i.error("Silme başarısız")}},M=()=>{navigator.clipboard.writeText(u),i.success("Çıktı kopyalandı")},_=()=>{h(""),l(""),k(null)},q=async()=>{if(!d){i.warning("Paylaşım için kanal gerekli");return}try{(await fetch(`/api/channels/${d}/messages/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({content:`\`\`\`${r}
${t}
\`\`\`
**Çıktı:**
\`\`\`
${u}
\`\`\``})})).ok&&i.success("Kanala paylaşıldı")}catch{i.error("Paylaşım başarısız")}};return e.jsx("div",{className:`code-runner-overlay ${f?"fullscreen":""}`,onClick:s=>s.target.className.includes("code-runner-overlay")&&p(),children:e.jsxs("div",{className:"code-runner-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(c,{})," Kod Çalıştırıcı"]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"fullscreen-btn",onClick:()=>D(!f),children:f?e.jsx(Q,{}):e.jsx(U,{})}),e.jsx("button",{className:"close-btn",onClick:p,children:e.jsx(H,{})})]})]}),e.jsxs("div",{className:"toolbar",children:[e.jsx("div",{className:"language-selector",children:T.map(s=>e.jsxs("button",{className:`lang-btn ${r===s.id?"active":""}`,onClick:()=>m(s.id),title:s.name,children:[s.icon,e.jsx("span",{children:s.name})]},s.id))}),e.jsxs("div",{className:"toolbar-actions",children:[e.jsxs("button",{className:"action-btn",onClick:()=>N(!w),children:[e.jsx(K,{})," Geçmiş"]}),e.jsxs("button",{className:"action-btn",onClick:()=>b(!0),children:[e.jsx(g,{})," Kaydet"]}),e.jsxs("button",{className:"action-btn clear",onClick:_,children:[e.jsx(P,{})," Temizle"]})]})]}),e.jsxs("div",{className:"editor-container",children:[e.jsxs("div",{className:"code-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("span",{children:[e.jsx(c,{})," Kod"]}),e.jsxs("span",{className:"line-count",children:[t.split(`
`).length," satır"]})]}),e.jsx("textarea",{className:"code-editor",value:t,onChange:s=>h(s.target.value),placeholder:"Kodunuzu buraya yazın...",spellCheck:"false"})]}),e.jsxs("div",{className:"output-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("span",{children:[e.jsx(V,{})," Çıktı"]}),e.jsxs("div",{className:"output-actions",children:[S&&e.jsxs("span",{className:"exec-time",children:[e.jsx(E,{})," ",S,"ms"]}),e.jsx("button",{onClick:M,title:"Kopyala",children:e.jsx(X,{})})]})]}),e.jsx("pre",{className:`output-display ${u.includes("Hata")?"error":""}`,children:u||"Çıktı burada görünecek..."})]})]}),e.jsxs("div",{className:"run-bar",children:[A?e.jsxs("button",{className:"stop-btn",onClick:J,children:[e.jsx(Z,{})," Durdur"]}):e.jsxs("button",{className:"run-btn",onClick:W,children:[e.jsx(Y,{})," Çalıştır"]}),d&&e.jsxs("button",{className:"share-btn",onClick:q,children:[e.jsx(c,{})," Kanala Paylaş"]})]}),w&&e.jsxs("div",{className:"history-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("h3",{children:[e.jsx(K,{})," Geçmiş & Snippets"]}),e.jsx("button",{onClick:()=>N(!1),children:e.jsx(H,{})})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("h4",{children:[e.jsx(ee,{})," Kaydedilen Snippets"]}),F.length===0?e.jsx("p",{className:"empty-msg",children:"Henüz snippet yok"}):e.jsx("div",{className:"snippets-list",children:F.map(s=>e.jsxs("div",{className:"snippet-item",children:[e.jsxs("div",{className:"snippet-info",onClick:()=>z(s),children:[e.jsx("span",{className:"snippet-name",children:s.name}),e.jsx("span",{className:"snippet-lang",children:s.language})]}),e.jsx("button",{className:"delete-snippet",onClick:()=>L(s.id),children:e.jsx(P,{})})]},s.id))})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("h4",{children:[e.jsx(E,{})," Son Çalıştırmalar"]}),C.length===0?e.jsx("p",{className:"empty-msg",children:"Geçmiş yok"}):e.jsx("div",{className:"history-list",children:C.slice(0,10).map((s,a)=>e.jsxs("div",{className:"history-item",onClick:()=>z(s),children:[e.jsxs("div",{className:"history-info",children:[e.jsx("span",{className:"history-lang",children:s.language}),e.jsx("span",{className:`history-status ${s.success?"success":"error"}`,children:s.success?e.jsx(se,{}):e.jsx(ae,{})})]}),e.jsxs("code",{className:"history-preview",children:[s.code?.substring(0,50),"..."]}),e.jsxs("span",{className:"history-time",children:[s.exec_time,"ms"]})]},a))})]})]}),R&&e.jsx(te,{onClose:()=>b(!1),onSave:G,language:r})]})})},te=({onClose:j,onSave:d,language:p})=>{const[t,h]=n.useState(""),r=()=>{if(!t.trim()){i.warning("Snippet adı gerekli");return}d(t)};return e.jsx("div",{className:"modal-overlay",onClick:m=>m.target.className==="modal-overlay"&&j(),children:e.jsxs("div",{className:"save-modal",children:[e.jsxs("h3",{children:[e.jsx(g,{})," Snippet Kaydet"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Snippet Adı"}),e.jsx("input",{type:"text",value:t,onChange:m=>h(m.target.value),placeholder:"örn: Fibonacci Hesaplama"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dil"}),e.jsx("input",{type:"text",value:p,disabled:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:j,children:"İptal"}),e.jsxs("button",{className:"save-submit-btn",onClick:r,children:[e.jsx(g,{})," Kaydet"]})]})]})})};export{oe as default};
