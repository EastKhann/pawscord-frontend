import{r as a,H as K,K as P,bo as U,aT as H,bD as I,bT as V}from"./react-core-B6hadH-M.js";import{t as g}from"./index-D_6pZib5.js";const Q=({roomId:y,userId:E,username:W,apiBaseUrl:p,fetchWithAuth:m,websocket:s,onClose:Y})=>{const[l,C]=a.useState(`// Start coding...
`),[i,b]=a.useState("javascript"),[R,d]=a.useState(""),[h,x]=a.useState([]),[S,v]=a.useState(!1),[k,w]=a.useState(!1),j=a.useRef(null),f=a.useRef(null),u=a.useRef(new Map);a.useEffect(()=>(_(),L(),$(),()=>{J()}),[]);const _=async()=>{try{setMonacoLoaded(!1)}catch(e){console.error("❌ [CodeEditor] Editor init error:",e)}},L=()=>{s&&s.addEventListener("message",e=>{const t=JSON.parse(e.data);switch(t.type){case"code_update":B(t);break;case"cursor_update":D(t);break;case"collaborator_joined":T(t);break;case"collaborator_left":O(t);break}})},B=e=>{if(e.user_id===E)return;const t=window.monacoEditor;t&&t.setValue(e.code)},D=e=>{if(e.user_id===E)return;const t=window.monacoEditor,n=f.current;if(!t||!n)return;const r=u.current.get(e.user_id);r&&t.deltaDecorations(r,[]);const c=t.deltaDecorations([],[{range:new n.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);u.current.set(e.user_id,c)},T=e=>{x(t=>[...t,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}])},O=e=>{x(n=>n.filter(r=>r.id!==e.user_id));const t=u.current.get(e.user_id);t&&window.monacoEditor&&window.monacoEditor.deltaDecorations(t,[]),u.current.delete(e.user_id)},$=async()=>{try{const e=await m(`${p}/code-editor/load/?room_id=${y}`);if(e.ok){const t=await e.json();t.code&&(C(t.code),b(t.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(t.code),window.monacoEditor.setLanguage(t.language||"javascript")))}}catch(e){console.error("Failed to load code:",e)}},z=async()=>{v(!0);try{(await m(`${p}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:y,code:l,language:i})})).ok&&g.success("✅ Kod kaydedildi!")}catch(e){console.error("Save error:",e),g.error("❌ Kaydetme başarısız")}finally{v(!1)}},F=async()=>{w(!0),d("Çalıştırılıyor...");try{const e=await m(`${p}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:l,language:i})});if(e.ok){const t=await e.json();d(t.output||"No output")}else{const t=await e.json();d(`Error: ${t.error||"Execution failed"}`)}}catch(e){d(`Error: ${e.message}`)}finally{w(!1)}},M=()=>{navigator.clipboard.writeText(l),g.success("✅ Kod kopyalandı!")},N=()=>{const t={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"}[i]||"txt",n=new Blob([l],{type:"text/plain"}),r=URL.createObjectURL(n),c=document.createElement("a");c.href=r,c.download=`code.${t}`,c.click(),URL.revokeObjectURL(r)},J=()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),s&&s.close()};return React.createElement("div",{style:o.container},React.createElement("div",{style:o.header},React.createElement("div",{style:o.headerLeft},React.createElement(K,{style:o.headerIcon}),React.createElement("h2",{style:o.title},"Code Editor"),React.createElement("select",{value:i,onChange:e=>{b(e.target.value),window.monacoEditor&&f.current&&f.current.editor.setModelLanguage(window.monacoEditor.getModel(),e.target.value)},style:o.languageSelect},React.createElement("option",{value:"javascript"},"JavaScript"),React.createElement("option",{value:"typescript"},"TypeScript"),React.createElement("option",{value:"python"},"Python"),React.createElement("option",{value:"java"},"Java"),React.createElement("option",{value:"cpp"},"C++"),React.createElement("option",{value:"html"},"HTML"),React.createElement("option",{value:"css"},"CSS"))),React.createElement("div",{style:o.headerRight},React.createElement("div",{style:o.collaborators},React.createElement(P,{style:{marginRight:"6px"}}),React.createElement("span",null,h.length+1)),React.createElement("button",{onClick:M,style:o.actionButton,title:"Kopyala"},React.createElement(U,null)),React.createElement("button",{onClick:N,style:o.actionButton,title:"İndir"},React.createElement(H,null)),React.createElement("button",{onClick:z,disabled:S,style:{...o.actionButton,...o.saveButton},title:"Kaydet"},React.createElement(I,null)),React.createElement("button",{onClick:F,disabled:k,style:{...o.actionButton,...o.runButton},title:"Çalıştır"},React.createElement(V,null)))),React.createElement("div",{style:o.editorContainer},React.createElement("div",{ref:j,style:o.editor})),R&&React.createElement("div",{style:o.outputPanel},React.createElement("div",{style:o.outputHeader},React.createElement("span",null,"Output")),React.createElement("pre",{style:o.outputContent},R)))},o={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}};export{Q as default};
