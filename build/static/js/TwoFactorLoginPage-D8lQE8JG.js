import{r as n,b as e}from"./react-core-9vc7GIjk.js";import{b as E,c as C}from"./router-vendor-u6fxj6P4.js";import{y as A,W as v,X as z}from"./icons-vendor-C1zuqBwn.js";import{A as F}from"./index-BZ_tZYbH.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const j=({apiBaseUrl:B,onLogin:k})=>{const l=E(),[x]=C(),[p,y]=n.useState(""),[r,g]=n.useState(!1),[f,h]=n.useState(""),[b,i]=n.useState(""),[c,m]=n.useState(!1),s=x.get("temp_token");if(n.useEffect(()=>{s||(console.warn("üîê [2FA] No temp_token found, redirecting to login"),l("/login"))},[s,l]),!s)return null;const S=async a=>{a.preventDefault(),i(""),m(!0);const u=r?f:p;if(!u){i("Kod gerekli"),m(!1);return}try{console.log("üîê [2FA] Verifying code with temp_token...");const d=await fetch(`${F}/security/2fa/verify-login/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({temp_token:s,code:u})}),o=await d.json();d.ok&&o.verified?(console.log("‚úÖ [2FA] Verification successful, logging in..."),localStorage.setItem("access_token",o.access),localStorage.setItem("refresh_token",o.refresh),k(o.access,o.refresh,o.username),l("/")):(console.error("‚ùå [2FA] Verification failed:",o),i(o.error||"Ge√ßersiz kod"))}catch(d){console.error("‚ùå [2FA] Network error:",d),i("Baƒülantƒ± hatasƒ± olu≈ütu")}finally{m(!1)}};return e.createElement("div",{style:t.container},e.createElement("div",{style:t.card},e.createElement("button",{onClick:()=>l("/login"),style:t.backButton},e.createElement(A,null)," Geri"),e.createElement(v,{style:t.icon}),e.createElement("h2",{style:t.title},"ƒ∞ki Fakt√∂rl√º Doƒürulama"),e.createElement("p",{style:t.subtitle},r?"Yedek kodunuzu girin":"Authenticator uygulamanƒ±zdaki 6 haneli kodu girin"),e.createElement("form",{onSubmit:S,style:t.form},r?e.createElement(e.Fragment,null,e.createElement("input",{type:"text",placeholder:"Yedek kod",value:f,onChange:a=>h(a.target.value),style:t.backupInput,autoFocus:!0,disabled:c}),e.createElement("button",{type:"button",onClick:()=>g(!1),style:t.backupLink},"‚Üê Authenticator kodu kullan")):e.createElement(e.Fragment,null,e.createElement("input",{type:"text",maxLength:6,placeholder:"000000",value:p,onChange:a=>{const u=a.target.value.replace(/\D/g,"");y(u)},style:t.codeInput,autoFocus:!0,disabled:c}),e.createElement("button",{type:"button",onClick:()=>g(!0),style:t.backupLink},e.createElement(z,null)," Yedek kod kullan")),b&&e.createElement("div",{style:t.error},"‚ùå ",b),e.createElement("button",{type:"submit",style:t.submitButton,disabled:c||!r&&p.length!==6||r&&!f},c?"Doƒürulanƒ±yor...":"Giri≈ü Yap")),e.createElement("div",{style:t.info},e.createElement("p",{style:t.infoTitle},"üí° ƒ∞pu√ßlarƒ±:"),e.createElement("ul",{style:t.infoList},e.createElement("li",null,"Kod s√ºrekli deƒüi≈üir (30 saniyede bir)"),e.createElement("li",null,"Telefonunuzu kaybettiyseniz yedek kod kullanƒ±n"),e.createElement("li",null,"Her yedek kod sadece bir kere kullanƒ±labilir")))))},t={container:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1e1f22",padding:"20px"},card:{backgroundColor:"#2b2d31",borderRadius:"12px",padding:"40px",maxWidth:"500px",width:"100%",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",position:"relative"},backButton:{position:"absolute",top:"20px",left:"20px",background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",gap:"8px",transition:"color 0.2s"},icon:{fontSize:"64px",color:"#5865f2",display:"block",margin:"0 auto 20px"},title:{color:"#fff",fontSize:"28px",textAlign:"center",margin:"0 0 10px 0"},subtitle:{color:"#b9bbbe",fontSize:"16px",textAlign:"center",marginBottom:"30px"},form:{display:"flex",flexDirection:"column",gap:"15px"},codeInput:{backgroundColor:"#1e1f22",border:"2px solid #5865f2",borderRadius:"6px",padding:"16px",color:"#fff",fontSize:"32px",textAlign:"center",letterSpacing:"8px",fontFamily:"monospace",outline:"none"},backupInput:{backgroundColor:"#1e1f22",border:"1px solid #1e1f22",borderRadius:"6px",padding:"12px",color:"#fff",fontSize:"16px",textAlign:"center",fontFamily:"monospace",outline:"none"},backupLink:{background:"none",border:"none",color:"#5865f2",cursor:"pointer",fontSize:"14px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},error:{backgroundColor:"#da373c",color:"#fff",padding:"12px",borderRadius:"6px",fontSize:"14px",textAlign:"center"},submitButton:{backgroundColor:"#5865f2",color:"#fff",border:"none",borderRadius:"6px",padding:"12px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background-color 0.2s"},info:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"15px",marginTop:"20px"},infoTitle:{color:"#fff",fontSize:"14px",fontWeight:"bold",margin:"0 0 10px 0"},infoList:{color:"#b9bbbe",fontSize:"14px",margin:0,paddingLeft:"20px"}};export{j as default};
