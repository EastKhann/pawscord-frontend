var A=Object.defineProperty;var $=t=>{throw TypeError(t)};var U=(t,i,e)=>i in t?A(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var d=(t,i)=>A(t,"name",{value:i,configurable:!0});var I=(t,i,e)=>U(t,typeof i!="symbol"?i+"":i,e),C=(t,i,e)=>i.has(t)||$("Cannot "+e);var O=(t,i,e)=>(C(t,i,"read from private field"),e?e.call(t):i.get(t)),x=(t,i,e)=>i.has(t)?$("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e),B=(t,i,e,r)=>(C(t,i,"write to private field"),r?r.call(t,e):i.set(t,e),e);import{a as j}from"./react-core-Djgtqrmb.js";import{_ as K}from"./media-vendor-CxFPycob.js";import{M as q,C as N}from"./mixin-3xgmAQp_.js";var R;const M=class M extends q(N){constructor(){super(...arguments);x(this,R)}attributeChangedCallback(e,r,n){e!=="src"&&super.attributeChangedCallback(e,r,n),e==="src"&&r!=n&&this.load()}async _initThumbnails(e){const r=d(async(m,b)=>{const w=[],h=e.timescale||1,_=e.startNumber||1,S=e.presentationTimeOffset?e.presentationTimeOffset/h:0,f=e.segmentDuration;for(let y=0;y<m;y++){const g=Z({thIndex:y,thduration:b,ttiles:m,tduration:f,startNumber:_,pto:S}),k=g+b,p=new Promise((E,a)=>{this.api.provideThumbnail(g,({url:s,width:u,height:v,x:T,y:W})=>{try{const P=new VTTCue(g,k,`${s}#xywh=${T},${W},${u},${v}`);E(P)}catch(P){a(P)}})});w.push(p)}return await Promise.all(w).catch(y=>{})},"generateAllCues"),{totalThumbnails:n,thumbnailDuration:o}=z(e),l=await r(n,o);let c=this.nativeEl.querySelector('track[label="thumbnails"]');if(!c){c=G(),this.nativeEl.appendChild(c);const m=J(l);c.src=m,c.dispatchEvent(new Event("change"))}}async load(){if(O(this,R)){this.api.attachSource(this.src);return}B(this,R,!0);const e=await K(()=>import("./dash.all.min-CxBcPopD.js"),[]);this.api=e.MediaPlayer().create(),this.api.initialize(this.nativeEl,this.src,this.autoplay),this.api.on(e.MediaPlayer.events.STREAM_INITIALIZED,()=>{const r=this.api.getRepresentationsByType("video");let n=this.videoTracks.getTrackById("main");n||(n=this.addVideoTrack("main"),n.id="main",n.selected=!0),r.forEach(o=>{const l=o.bandwidth??o.bitrate??(Number.isFinite(o.bitrateInKbit)?o.bitrateInKbit*1e3:void 0),c=n.addRendition(o.id,o.width,o.height,o.mimeType??o.codec,l);c.id=o.id}),this.videoRenditions.addEventListener("change",()=>{const o=this.videoRenditions[this.videoRenditions.selectedIndex];o?.id?(this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),this.api.setRepresentationForTypeById("video",o.id,!0)):this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}})}),this.api.isDynamic()||this.api.getRepresentationsByType("image").forEach(async(l,c)=>{c>0||this._initThumbnails(l)})})}};R=new WeakMap,d(M,"DashVideoElement"),I(M,"shadowRootOptions",{...N.shadowRootOptions}),I(M,"getTemplateHTML",d(e=>{const{src:r,...n}=e;return N.getTemplateHTML(n)},"getTemplateHTML"));let L=M;function z(t){var i,e;const r=t.essentialProperties[0],[n,o]=r.value.split("x").map(Number),l=n*o,c=((e=(i=t.adaptation)==null?void 0:i.period)==null?void 0:e.duration)||null,m=t.segmentDuration,b=t.timescale||1,h=m/b/l;return{totalThumbnails:c!=null?Math.ceil(c/h):Math.ceil(m/h),thumbnailDuration:h}}d(z,"calculateThumbnailTimes");function Z({thIndex:t,tduration:i,thduration:e,ttiles:r,startNumber:n,pto:o}){const l=Math.floor(t/r)+n,c=t%r+1,m=(l-1)*i-o,b=(c-1)*e;return m+b}d(Z,"calculateThumbnailStartTime");function G(){const t=document.createElement("track");return t.kind="metadata",t.label="thumbnails",t.srclang="en",t.mode="hidden",t.default=!0,t}d(G,"createThumbnailTrack");function J(t){let i=`WEBVTT

`;for(const n of t)i+=`${r(n.startTime)} --> ${r(n.endTime)}
`,i+=`${n.text}

`;const e=new Blob([i],{type:"text/vtt"});return URL.createObjectURL(e);function r(n){const o=String(Math.floor(n/3600)).padStart(2,"0"),l=String(Math.floor(n%3600/60)).padStart(2,"0"),c=(n%60).toFixed(3).padStart(6,"0");return`${o}:${l}:${c}`}}d(J,"cuesToVttBlobUrl");globalThis.customElements&&!globalThis.customElements.get("dash-video")&&globalThis.customElements.define("dash-video",L);var Q=L,X=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),Y={className:"class",htmlFor:"for"};function F(t){return t.toLowerCase()}d(F,"defaultToAttributeName");function H(t){if(typeof t=="boolean")return t?"":void 0;if(typeof t!="function"&&!(typeof t=="object"&&t!==null))return t}d(H,"defaultToAttributeValue");function V({react:t,tagName:i,elementClass:e,events:r,displayName:n,defaultProps:o,toAttributeName:l=F,toAttributeValue:c=H}){const m=Number.parseInt(t.version)>=19,b=t.forwardRef((w,h)=>{var _,S;const f=t.useRef(null),y=t.useRef(new Map),g={},k={},p={},E={};for(const[a,s]of Object.entries(w)){if(X.has(a)){p[a]=s;continue}const u=l(Y[a]??a);if(e.prototype&&a in e.prototype&&!(a in(((_=globalThis.HTMLElement)==null?void 0:_.prototype)??{}))&&!((S=e.observedAttributes)!=null&&S.some(T=>T===u))){E[a]=s;continue}if(a.startsWith("on")){g[a]=s;continue}const v=c(s);if(u&&v!=null&&(k[u]=String(v),m||(p[u]=v)),u&&m){const T=H(s);v!==T?p[u]=v:p[u]=s}}if(typeof window<"u"){for(const a in g){const s=g[a],u=a.endsWith("Capture"),v=(r?.[a]??a.slice(2).toLowerCase()).slice(0,u?-7:void 0);t.useLayoutEffect(()=>{const T=f?.current;if(!(!T||typeof s!="function"))return T.addEventListener(v,s,u),()=>{T.removeEventListener(v,s,u)}},[f?.current,s])}t.useLayoutEffect(()=>{if(f.current===null)return;const a=new Map;for(const s in E)D(f.current,s,E[s]),y.current.delete(s),a.set(s,E[s]);for(const[s,u]of y.current)D(f.current,s,void 0);y.current=a})}if(typeof window>"u"&&e?.getTemplateHTML&&e?.shadowRootOptions){const{mode:a,delegatesFocus:s}=e.shadowRootOptions,u=t.createElement("template",{shadowrootmode:a,shadowrootdelegatesfocus:s,dangerouslySetInnerHTML:{__html:e.getTemplateHTML(k,w)},key:"ce-la-react-ssr-template-shadow-root"});p.children=[u,p.children]}return t.createElement(i,{...o,...p,ref:t.useCallback(a=>{f.current=a,typeof h=="function"?h(a):h!==null&&(h.current=a)},[h])},p.children)});return b.displayName=n??e.name,b}d(V,"createComponent");function D(t,i,e){var r;t[i]=e,e==null&&i in(((r=globalThis.HTMLElement)==null?void 0:r.prototype)??{})&&t.removeAttribute(i)}d(D,"setProperty");var ot=V({react:j,tagName:"dash-video",elementClass:Q,toAttributeName(t){return t==="muted"?"":t==="defaultMuted"?"muted":F(t)}});export{ot as default};
