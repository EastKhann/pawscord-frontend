var M=Object.defineProperty;var c=(e,i)=>M(e,"name",{value:i,configurable:!0});import{r as o,j as t}from"./react-core-Djgtqrmb.js";import{b as N,L}from"./router-vendor-gmJ9Mn-1.js";import{A as y,u as G}from"./index-DjBRFZUD.js";import"./media-vendor-CxFPycob.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";import"./ui-vendor-IhB9Znpc.js";const _=`${y}/auth/token/refresh/`,$=`${y}/eng-learn/words/`,U=`${y}/eng-learn/known-words/`,H=`${y}/eng-learn/mark-known/`,Y=c(()=>localStorage.getItem("access_token"),"getToken");function q(){const[e,i]=o.useState({}),[g,b]=o.useState({}),[w,A]=o.useState([]),[a,j]=o.useState(""),[m,C]=o.useState(null),[E,W]=o.useState(!1),[k,R]=o.useState(!0),[z,O]=o.useState(null),[D,B]=o.useState(!1),T=N(),f=o.useCallback(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),T("/")},[T]),x=o.useCallback(async(s,n={})=>{const d=c(async()=>{const p=Y(),l=n.headers||{};return p&&(l.Authorization=`Bearer ${p}`),n.body instanceof FormData||(l["Content-Type"]="application/json"),fetch(s,{...n,headers:l})},"originalFetch");let h=await d();if(h.status===401&&s!==_){const p=localStorage.getItem("refresh_token");if(!p)throw f(),new Error("Oturum sÃ¼resi doldu, giriÅŸ yapÄ±n.");try{const l=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:p})}),P=await l.json();if(!l.ok)throw f(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",P.access),h=await d()}catch(l){throw f(),l}}return h},[f]);o.useEffect(()=>{c(async()=>{try{const[n,d]=await Promise.all([x($),x(U)]);if(!n.ok)throw n.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!d.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const h=await n.json(),p=await d.json(),l=Object.keys(h||{}).sort();i(h),b(p||{}),A(l),l.length>0&&j(l[0])}catch(n){O(n.message)}finally{R(!1)}},"fetchInitialData")()},[x]);const u=o.useMemo(()=>{if(!a||!e[a])return[];const s=new Set(g[a]||[]);return e[a].filter(n=>!s.has(n.term))},[e,a,g]),I=o.useMemo(()=>{const s=e[a]?.length||0,n=g[a]?.length||0;return{totalWords:s,knownWords:n,progress:Math.round(s>0?n/s*100:0)}},[a,e,g]),K=o.useMemo(()=>{let s=0,n=0;return Object.values(e).forEach(d=>{s+=d.length}),Object.values(g).forEach(d=>{n+=d.length}),{totalWords:s,totalKnownWords:n,progress:Math.round(s>0?n/s*100:0)}},[e,g]),S=o.useCallback(()=>{if(W(!1),B(!1),u.length===0){C(null),a&&B(!0);return}C(u[Math.floor(Math.random()*u.length)])},[u,a]);o.useEffect(()=>{!k&&w.length>0&&S()},[a,k,w,u,S]);const F=o.useCallback(async()=>{if(m)try{const s=await x(H,{method:"POST",body:JSON.stringify({level:a,word:m.term})});if(!s.ok)throw new Error("Kelime kaydedilemedi");b(await s.json())}catch{}},[m,a,x]),{globalData:v}=G();return o.useEffect(()=>{v?.type==="user_profile_update"&&v.user_data?.known_words&&b(v.user_data.known_words)},[v]),{allData:e,availableLevels:w,currentLevel:a,setCurrentLevel:j,currentWord:m,showAnswer:E,setShowAnswer:W,isLoading:k,error:z,levelComplete:D,levelStats:I,totalStats:K,availableWordsForLevel:u,getNewWord:S,handleMarkAsKnown:F}}c(q,"useEnglishLearning");const r={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};function se(){const e=q();return e.isLoading?t.jsx("div",{style:r.pageContainer,children:"YÃ¼kleniyor..."}):e.error?t.jsxs("div",{style:r.pageContainer,children:[t.jsxs("h1",{style:r.errorText,children:["Hata: ",e.error]}),t.jsx(L,{to:"/",style:r.backButton,children:"Sohbete Geri DÃ¶n"})]}):t.jsxs("div",{style:r.pageContainer,children:[t.jsxs(L,{to:"/eng-learn",style:r.backButton,children:["â†"," Merkeze DÃ¶n"]}),t.jsxs("div",{style:r.quizContainer,children:[t.jsxs("h1",{style:r.pageTitle,children:["Ä°","ngilizce Kelime ","Ã–ÄŸren"]}),t.jsxs("div",{style:r.levelAndProgressContainer,children:[t.jsxs("div",{style:r.controls,children:[t.jsx("label",{htmlFor:"level-select",style:r.label,children:"Seviye:"}),t.jsx("select",{id:"level-select",value:e.currentLevel,onChange:c(i=>e.setCurrentLevel(i.target.value),"onChange"),style:r.select,children:e.availableLevels.map(i=>t.jsxs("option",{value:i,children:[i.toUpperCase()," (",e.allData[i]?.length||0," kelime)"]},i))})]}),t.jsxs("div",{style:r.progressStats,children:[t.jsxs("span",{children:["BildiÄŸiniz: ",t.jsx("strong",{children:e.levelStats.knownWords})]}),t.jsxs("span",{children:["Toplam: ",t.jsx("strong",{children:e.levelStats.totalWords})]})]})]}),t.jsxs("div",{style:{...r.progressBarBackground,marginBottom:"20px"},children:[t.jsx("div",{style:{...r.progressBarFill,width:`${e.levelStats.progress}%`},children:e.levelStats.progress>15&&t.jsxs("span",{children:[e.levelStats.progress,"%"]})}),e.levelStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.levelStats.progress,"%"]})]}),t.jsxs("div",{children:[t.jsxs("h4",{style:r.totalStatsHeader,children:["Genel Toplam ","Ä°","lerleme"]}),t.jsxs("div",{style:{...r.progressStats,marginBottom:"8px"},children:[t.jsxs("span",{children:["Toplam BildiÄŸiniz: ",t.jsx("strong",{children:e.totalStats.totalKnownWords})]}),t.jsxs("span",{children:["Toplam Kelime: ",t.jsx("strong",{children:e.totalStats.totalWords})]})]}),t.jsxs("div",{style:r.progressBarBackground,children:[t.jsx("div",{style:{...r.progressBarFill,...r.totalProgressBarFill,width:`${e.totalStats.progress}%`},children:e.totalStats.progress>15&&t.jsxs("span",{children:[e.totalStats.progress,"%"]})}),e.totalStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.totalStats.progress,"%"]})]})]}),t.jsx("div",{style:r.wordArea,children:e.levelComplete?t.jsxs("h2",{style:{...r.term,color:"var(--text-positive)"},children:["Tebrikler! ","ðŸŽ‰",t.jsx("br",{}),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."]}):e.currentWord?t.jsxs(t.Fragment,{children:[t.jsx("h2",{style:r.term,children:e.currentWord.term}),e.showAnswer&&t.jsx("p",{style:r.meanings,children:e.currentWord.meanings.join(" / ")})]}):t.jsx("p",{children:"Bu seviyede kelime bulunamadÄ±."})}),t.jsxs("div",{style:r.buttonGroup,children:[t.jsx("button",{style:r.actionButton,onClick:c(()=>e.setShowAnswer(!0),"onClick"),disabled:e.showAnswer||!e.currentWord||e.levelComplete,children:"CevabÄ± GÃ¶ster"}),t.jsx("button",{style:{...r.actionButton,...r.knownButton},onClick:e.handleMarkAsKnown,disabled:!e.currentWord||e.levelComplete,children:"Biliyorum (GeÃ§)"}),t.jsx("button",{style:{...r.actionButton,...r.primaryButton},onClick:e.getNewWord,disabled:e.levelComplete||e.availableWordsForLevel.length<=1,children:"Yeni Kelime"})]})]})]})}c(se,"EnglishLearningPage");export{se as default};
