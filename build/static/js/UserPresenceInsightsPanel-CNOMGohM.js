import{r as c,n as s}from"./react-core-BMiyQWF6.js";import{c as C,aX as w,a8 as u,a as A,D as p,c4 as S,u as N,t as M,U as $,R as y,aq as g,c5 as b,bR as T,S as P,T as U,aT as z}from"./icons-vendor-T72gfvdf.js";import{g as E}from"./index-BvQlif5M.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const q=({userId:m,username:h,onClose:r,fetchWithAuth:v})=>{const[e,l]=c.useState(null),[_,j]=c.useState(!0),[t,d]=c.useState("overview"),x=c.useCallback(async()=>{j(!0);try{const a=await v(`${E()}/users/${m}/presence-insights/`);if(a.ok){const i=await a.json();l(i)}else l({user:{username:h||"User",status:"online",joined:"2024-03-15",timezone:"UTC+3"},activity_summary:{total_online_hours:847,messages_sent:12453,voice_hours:234,servers_active:8,reactions_given:3421},active_hours:Array(24).fill(0).map((i,F)=>({hour:F,activity:Math.random()*100})),weekly_pattern:[{day:"Mon",activity:65},{day:"Tue",activity:72},{day:"Wed",activity:80},{day:"Thu",activity:75},{day:"Fri",activity:90},{day:"Sat",activity:100},{day:"Sun",activity:85}],status_distribution:{online:45,idle:25,dnd:15,offline:15},top_activities:[{name:"Gaming",hours:156,icon:"gaming"},{name:"Music",hours:89,icon:"music"},{name:"Voice Chat",hours:234,icon:"voice"},{name:"Streaming",hours:45,icon:"stream"}],engagement_score:87,peak_time:{start:20,end:23},preferred_timezone:"Evening (8PM - 11PM)"})}catch{l(null)}j(!1)},[m,h,v]);c.useEffect(()=>{x()},[x]);const n=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a?.toString()||"0",o=a=>{switch(a){case"online":return"#10b981";case"idle":return"#f59e0b";case"dnd":return"#ef4444";default:return"#6b7280"}},k=a=>{switch(a){case"gaming":return s.jsx(g,{});case"music":return s.jsx(z,{});case"voice":return s.jsx(N,{});case"stream":return s.jsx(y,{});default:return s.jsx(U,{})}},f=()=>e?.active_hours?Math.max(...e.active_hours.map(a=>a.activity),1):1;return _?s.jsx("div",{className:"presence-insights-overlay",onClick:r,children:s.jsx("div",{className:"presence-insights-panel",onClick:a=>a.stopPropagation(),children:s.jsxs("div",{className:"loading-state",children:[s.jsx(C,{className:"spin"}),s.jsx("span",{children:"Analyzing activity patterns..."})]})})}):s.jsx("div",{className:"presence-insights-overlay",onClick:r,children:s.jsxs("div",{className:"presence-insights-panel",onClick:a=>a.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"user-header",children:[s.jsxs("div",{className:"user-avatar-large",children:[s.jsx("span",{children:(e?.user?.username||"U").charAt(0).toUpperCase()}),s.jsx("div",{className:"status-indicator",style:{backgroundColor:o(e?.user?.status)}})]}),s.jsxs("div",{className:"user-info",children:[s.jsx("h2",{children:e?.user?.username||"User"}),s.jsxs("div",{className:"user-meta",children:[s.jsxs("span",{children:[s.jsx(w,{})," Joined ",e?.user?.joined||"N/A"]}),s.jsxs("span",{children:[s.jsx(u,{})," ",e?.user?.timezone||"Unknown"]})]})]})]}),s.jsxs("div",{className:"engagement-score",children:[s.jsx("div",{className:"score-circle",children:s.jsx("span",{className:"score-value",children:e?.engagement_score||0})}),s.jsx("span",{className:"score-label",children:"Engagement"})]}),s.jsx("button",{className:"close-btn",onClick:r,children:s.jsx(A,{})})]}),s.jsxs("div",{className:"stats-bar",children:[s.jsxs("div",{className:"stat",children:[s.jsx(p,{}),s.jsxs("span",{className:"stat-value",children:[n(e?.activity_summary?.total_online_hours),"h"]}),s.jsx("span",{className:"stat-label",children:"Online"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(S,{}),s.jsx("span",{className:"stat-value",children:n(e?.activity_summary?.messages_sent)}),s.jsx("span",{className:"stat-label",children:"Messages"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(N,{}),s.jsxs("span",{className:"stat-value",children:[n(e?.activity_summary?.voice_hours),"h"]}),s.jsx("span",{className:"stat-label",children:"Voice"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(M,{}),s.jsx("span",{className:"stat-value",children:e?.activity_summary?.servers_active||0}),s.jsx("span",{className:"stat-label",children:"Servers"})]}),s.jsxs("div",{className:"stat",children:[s.jsx($,{}),s.jsx("span",{className:"stat-value",children:n(e?.activity_summary?.reactions_given)}),s.jsx("span",{className:"stat-label",children:"Reactions"})]})]}),s.jsxs("div",{className:"tabs",children:[s.jsxs("button",{className:`tab ${t==="overview"?"active":""}`,onClick:()=>d("overview"),children:[s.jsx(y,{})," Overview"]}),s.jsxs("button",{className:`tab ${t==="schedule"?"active":""}`,onClick:()=>d("schedule"),children:[s.jsx(p,{})," Activity Schedule"]}),s.jsxs("button",{className:`tab ${t==="activities"?"active":""}`,onClick:()=>d("activities"),children:[s.jsx(g,{})," Activities"]})]}),s.jsxs("div",{className:"tab-content",children:[t==="overview"&&s.jsxs("div",{className:"overview-tab",children:[s.jsx("div",{className:"peak-info",children:s.jsxs("div",{className:"peak-card",children:[s.jsx(b,{className:"peak-icon day"}),s.jsxs("div",{className:"peak-content",children:[s.jsx("span",{className:"peak-label",children:"Peak Activity Time"}),s.jsx("span",{className:"peak-value",children:e?.preferred_timezone})]})]})}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Status Distribution"}),s.jsx("div",{className:"status-bars",children:Object.entries(e?.status_distribution||{}).map(([a,i])=>s.jsxs("div",{className:"status-bar-item",children:[s.jsxs("div",{className:"status-bar-header",children:[s.jsx("span",{className:"status-name",style:{color:o(a)},children:a.toUpperCase()}),s.jsxs("span",{className:"status-percent",children:[i,"%"]})]}),s.jsx("div",{className:"status-bar-track",children:s.jsx("div",{className:"status-bar-fill",style:{width:`${i}%`,backgroundColor:o(a)}})})]},a))})]}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Weekly Activity Pattern"}),s.jsx("div",{className:"weekly-chart",children:(e?.weekly_pattern||[]).map((a,i)=>s.jsxs("div",{className:"day-bar",children:[s.jsx("div",{className:"bar",style:{height:`${a.activity}%`}}),s.jsx("span",{className:"day-label",children:a.day})]},i))})]})]}),t==="schedule"&&s.jsxs("div",{className:"schedule-tab",children:[s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:[s.jsx(T,{})," ",s.jsx(b,{})," 24-Hour Activity Pattern"]}),s.jsx("div",{className:"hourly-chart",children:(e?.active_hours||[]).map((a,i)=>s.jsxs("div",{className:"hour-column",children:[s.jsx("div",{className:`hour-bar ${i>=(e?.peak_time?.start||0)&&i<=(e?.peak_time?.end||23)?"peak":""}`,style:{height:`${Math.max(a.activity/f()*100,5)}%`},title:`${a.hour}:00 - Activity: ${Math.round(a.activity)}%`}),s.jsx("span",{className:"hour-num",children:a.hour})]},i))}),s.jsxs("div",{className:"chart-legend",children:[s.jsxs("span",{children:[s.jsx("span",{className:"legend-dot peak"})," Peak hours"]}),s.jsxs("span",{children:[s.jsx("span",{className:"legend-dot"})," Regular activity"]})]})]}),s.jsxs("div",{className:"timezone-note",children:[s.jsx(u,{}),s.jsxs("span",{children:["Times shown in user's local timezone (",e?.user?.timezone,")"]})]})]}),t==="activities"&&s.jsx("div",{className:"activities-tab",children:s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:[s.jsx(P,{})," Top Activities"]}),s.jsxs("div",{className:"activities-list",children:[(e?.top_activities||[]).map((a,i)=>s.jsxs("div",{className:`activity-item rank-${i+1}`,children:[s.jsxs("span",{className:"activity-rank",children:["#",i+1]}),s.jsx("div",{className:"activity-icon",children:k(a.icon)}),s.jsxs("div",{className:"activity-info",children:[s.jsx("span",{className:"activity-name",children:a.name}),s.jsxs("span",{className:"activity-hours",children:[a.hours," hours total"]})]}),s.jsx("div",{className:"activity-bar",children:s.jsx("div",{className:"bar-fill",style:{width:`${a.hours/(e?.top_activities?.[0]?.hours||1)*100}%`}})})]},i)),(!e?.top_activities||e.top_activities.length===0)&&s.jsx("div",{className:"empty-state",children:"No activity data available"})]})]})})]})]})})};export{q as default};
