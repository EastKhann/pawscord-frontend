var X=Object.defineProperty;var n=(e,l)=>X(e,"name",{value:l,configurable:!0});import{r as o,j as s}from"./react-core-Djgtqrmb.js";import{aa as Z,ab as ss,c4 as es,u as _,a0 as as,ac as z,z as B,aT as is,aE as ls,by as ts,ax as ns,j as cs,O as rs,cL as os,a5 as ds,a as ms}from"./icons-vendor-BW7dxHkX.js";import{t as A}from"./index-GGLPABCW.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const hs={total_members:0,active_members:0,messages_count:0,voice_minutes:0,member_growth:0,message_growth:0},j=n(e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),"formatNumber"),U=n(e=>e>0?{icon:Z,color:"#23a559",text:`+${e}%`}:e<0?{icon:ss,color:"#da373c",text:`${e}%`}:{icon:es,color:"#72767d",text:"0%"},"getGrowthIndicator"),P=n((e,l="#5865f2",t=60)=>{if(!e||e.length===0)return null;const r=Math.max(...e.map(i=>i.value)),a=100/e.length;return s.jsx("div",{className:"simple-chart",style:{height:t},children:e.map((i,c)=>s.jsx("div",{className:"chart-bar",style:{width:`${a}%`,height:`${i.value/r*100}%`,background:l},title:`${i.label}: ${i.value}`},c))})},"renderSimpleChart"),js=n((e,l)=>{const[t,r]=o.useState("7d"),[a,i]=o.useState(!0),[c,m]=o.useState(!1),[h,x]=o.useState(hs),[u,b]=o.useState([]),[N,y]=o.useState([]),[p,f]=o.useState([]),[g,w]=o.useState([]),[d,H]=o.useState([]),[C,I]=o.useState([]),[K,q]=o.useState([]),[J,W]=o.useState([]),$=n(async()=>{i(!0);try{const R={Authorization:`Bearer ${localStorage.getItem("access_token")}`},k=`${l}/analytics/${e}`,v=["overview","member-activity","message-activity","top-channels","top-members","geo","reactions","link-clicks","peak-hours"],Y=await Promise.all(v.map(Q=>fetch(`${k}/${Q}/?range=${t}`,{headers:R}))),[F,E,L,M,T,D,G,V,O]=Y;F.ok&&x(await F.json()),E.ok&&b((await E.json()).data||[]),L.ok&&y((await L.json()).data||[]),M.ok&&f((await M.json()).channels||[]),T.ok&&w((await T.json()).members||[]),D.ok&&H((await D.json()).data||[]),G.ok&&I((await G.json()).reactions||[]),V.ok&&q((await V.json()).links||[]),O.ok&&W((await O.json()).hours||[])}catch{A.error("âŒ Analitik verileri yÃ¼klenemedi")}finally{i(!1)}},"fetchAllAnalytics");return o.useEffect(()=>{$()},[e,t]),{timeRange:t,setTimeRange:r,loading:a,refreshing:c,overview:h,memberActivity:u,messageActivity:N,topChannels:p,topMembers:g,geoData:d,reactionStats:C,linkClicks:K,peakHours:J,handleRefresh:n(async()=>{m(!0),await $(),m(!1),A.success("ðŸ”„ Veriler gÃ¼ncellendi")},"handleRefresh"),handleExport:n(()=>{const S={exported_at:new Date().toISOString(),time_range:t,overview:h,memberActivity:u,messageActivity:N,topChannels:p,topMembers:g,geoData:d,reactionStats:C},R=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),k=URL.createObjectURL(R),v=document.createElement("a");v.href=k,v.download=`analytics_${e}_${t}.json`,v.click(),URL.revokeObjectURL(k),A.success("ðŸ“¥ Analitik verileri indirildi")},"handleExport")}},"useAdvancedAnalytics"),xs=[{key:"total_members",icon:_,label:"Toplam Ãœye",cls:"members",growth:"member"},{key:"active_members",icon:as,label:"Aktif Ãœye",cls:"active"},{key:"messages_count",icon:z,label:"Mesaj",cls:"messages",growth:"message"},{key:"voice_minutes",icon:B,label:"Sesli Dakika",cls:"voice"}],vs=n(({overview:e})=>{const l=U(e.member_growth),t=U(e.message_growth),r={member:l,message:t};return s.jsx("div",{className:"overview-section",children:xs.map(a=>{const i=a.growth?r[a.growth]:null;return s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:`card-icon ${a.cls}`,children:s.jsx(a.icon,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:j(e[a.key])}),s.jsx("span",{className:"card-label",children:a.label}),i?s.jsxs("span",{className:"card-growth",style:{color:i.color},children:[s.jsx(i.icon,{})," ",i.text]}):a.key==="active_members"?s.jsxs("span",{className:"card-detail",children:[(e.active_members/e.total_members*100||0).toFixed(1),"% aktiflik"]}):s.jsxs("span",{className:"card-detail",children:[Math.round(e.voice_minutes/60)," saat"]})]})]},a.key)})})},"OverviewCards"),us=n(({memberActivity:e,messageActivity:l,peakHours:t})=>{const r=n(()=>{const a=Array(24).fill(0).map((c,m)=>{const h=t.find(x=>x.hour===m);return{hour:m,value:h?.value||0}}),i=Math.max(...a.map(c=>c.value));return s.jsx("div",{className:"peak-hours-chart",children:a.map((c,m)=>s.jsx("div",{className:"hour-bar",style:{height:`${i>0?c.value/i*100:0}%`,background:c.value>i*.8?"#23a559":c.value>i*.5?"#5865f2":"#3f4147"},title:`${c.hour}:00 - ${c.value} mesaj`,children:s.jsx("span",{className:"hour-label",children:c.hour})},m))})},"renderPeakHoursChart");return s.jsxs("div",{className:"charts-grid",children:[s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(_,{})," ","Ãœ","ye Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:e.length>0?P(e,"#5865f2",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(z,{})," Mesaj Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:l.length>0?P(l,"#23a559",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card wide",children:[s.jsxs("div",{className:"chart-header",children:[s.jsxs("h3",{children:[s.jsx(B,{})," Yo","ÄŸ","unluk Saatleri"]}),s.jsxs("span",{className:"chart-info",children:[s.jsx(is,{})," En yo","ÄŸ","un saatler ye","ÅŸ","il ile g","Ã¶","sterilir"]})]}),s.jsx("div",{className:"chart-body",children:t.length>0?r():s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]})},"ChartsSection"),Ns=n(({topChannels:e,topMembers:l,reactionStats:t,geoData:r})=>s.jsxs("div",{className:"lists-grid",children:[s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ls,{})," En Aktif Kanallar"]})}),s.jsx("div",{className:"list-body",children:e.length>0?e.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:i+1}),s.jsx("span",{className:"name",children:a.name}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar",style:{width:`${a.messages/e[0].messages*100}%`}})}),s.jsx("span",{className:"value",children:j(a.messages)})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(_,{})," En Aktif ","Ãœ","yeler"]})}),s.jsx("div",{className:"list-body",children:l.length>0?l.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:i+1}),s.jsx("img",{src:a.avatar||"/default-avatar.png",alt:a.username,className:"avatar"}),s.jsx("span",{className:"name",children:a.username}),s.jsxs("span",{className:"value",children:[j(a.messages)," mesaj"]})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ts,{})," En ","Ã‡","ok Kullan","Ä±","lan Reaksiyonlar"]})}),s.jsx("div",{className:"list-body",children:t.length>0?s.jsx("div",{className:"reactions-grid",children:t.map((a,i)=>s.jsxs("div",{className:"reaction-item",children:[s.jsx("span",{className:"emoji",children:a.emoji}),s.jsx("span",{className:"count",children:j(a.count)})]},i))}):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ns,{})," Co","ÄŸ","rafi Da","ÄŸÄ±","l","Ä±","m"]})}),s.jsx("div",{className:"list-body",children:r.length>0?r.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"flag",children:a.flag||"ðŸŒ"}),s.jsx("span",{className:"name",children:a.country}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar geo",style:{width:`${a.count/r[0].count*100}%`}})}),s.jsxs("span",{className:"value",children:[a.percentage,"%"]})]},i)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]}),"ListsSection"),ps=n(({linkClicks:e})=>e.length===0?null:s.jsxs("div",{className:"links-section",children:[s.jsxs("h3",{children:[s.jsx(cs,{})," Link T","Ä±","klamalar","Ä±"]}),s.jsxs("div",{className:"links-table",children:[s.jsxs("div",{className:"table-header",children:[s.jsx("span",{children:"URL"}),s.jsxs("span",{children:["T","Ä±","klama"]}),s.jsx("span",{children:"Benzersiz"})]}),e.map((l,t)=>s.jsxs("div",{className:"table-row",children:[s.jsx("span",{className:"link-url",title:l.url,children:l.url.length>50?l.url.substring(0,50)+"...":l.url}),s.jsx("span",{children:j(l.clicks)}),s.jsx("span",{children:j(l.unique_clicks)})]},t))]})]}),"LinkClicksSection"),gs=[{value:"24h",label:"24 Saat"},{value:"7d",label:"7 GÃ¼n"},{value:"30d",label:"30 GÃ¼n"},{value:"90d",label:"90 GÃ¼n"}],Fs=n(({serverId:e,apiBaseUrl:l,onClose:t})=>{const{timeRange:r,setTimeRange:a,loading:i,refreshing:c,overview:m,memberActivity:h,messageActivity:x,topChannels:u,topMembers:b,geoData:N,reactionStats:y,linkClicks:p,peakHours:f,handleRefresh:g,handleExport:w}=js(e,l);return i?s.jsx("div",{className:"analytics-overlay",onClick:t,children:s.jsx("div",{className:"analytics-panel",onClick:n(d=>d.stopPropagation(),"onClick"),children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsxs("p",{children:["Analitik verileri y","Ã¼","kleniyor..."]})]})})}):s.jsx("div",{className:"analytics-overlay",onClick:t,children:s.jsxs("div",{className:"analytics-panel",onClick:n(d=>d.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"analytics-header",children:[s.jsxs("h2",{children:[s.jsx(rs,{})," Geli","ÅŸ","mi","ÅŸ"," Analitik"]}),s.jsxs("div",{className:"header-controls",children:[s.jsx("div",{className:"time-range-selector",children:gs.map(d=>s.jsx("button",{className:`range-btn ${r===d.value?"active":""}`,onClick:n(()=>a(d.value),"onClick"),children:d.label},d.value))}),s.jsx("button",{className:"action-btn",onClick:g,disabled:c,children:s.jsx(os,{className:c?"spinning":""})}),s.jsx("button",{className:"action-btn",onClick:w,children:s.jsx(ds,{})})]}),s.jsx("button",{className:"close-btn",onClick:t,children:s.jsx(ms,{})})]}),s.jsxs("div",{className:"analytics-content",children:[s.jsx(vs,{overview:m}),s.jsx(us,{memberActivity:h,messageActivity:x,peakHours:f}),s.jsx(Ns,{topChannels:u,topMembers:b,reactionStats:y,geoData:N}),s.jsx(ps,{linkClicks:p})]})]})})},"AdvancedAnalyticsDashboard");export{Fs as default};
