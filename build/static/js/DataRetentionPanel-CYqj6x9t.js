import{r as d,b as e}from"./react-core-9vc7GIjk.js";import{z as S,a as k,aq as w,o as P}from"./icons-vendor-NoxEirJf.js";import{t as n}from"./index-DR3ngHaW.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const I=({fetchWithAuth:i,apiBaseUrl:r,onClose:u,serverId:m})=>{const[p,x]=d.useState([]),[b,f]=d.useState(!1),[a,y]=d.useState({content_type:"messages",retention_days:30,enabled:!0}),g=[{value:"messages",label:"Messages"},{value:"media",label:"Media Files"},{value:"voice_recordings",label:"Voice Recordings"},{value:"audit_logs",label:"Audit Logs"},{value:"deleted_messages",label:"Deleted Messages"}],v=[{days:7,label:"7 Days"},{days:30,label:"30 Days"},{days:90,label:"90 Days"},{days:180,label:"6 Months"},{days:365,label:"1 Year"},{days:730,label:"2 Years"},{days:-1,label:"Forever"}];d.useEffect(()=>{s()},[]);const s=async()=>{f(!0);try{const l=await(await i(`${r}/servers/${m}/retention/`)).json();x(l.policies||[])}catch{n.error("Failed to load retention policies")}finally{f(!1)}},E=async()=>{try{await i(`${r}/retention/policies/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,server_id:m})}),n.success("Retention policy created"),y({content_type:"messages",retention_days:30,enabled:!0}),s()}catch{n.error("Failed to create policy")}},h=async(o,l)=>{try{await i(`${r}/retention/policies/${o}/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:l})}),n.success(l?"Policy enabled":"Policy disabled"),s()}catch{n.error("Failed to toggle policy")}},C=async o=>{if(confirm("Delete this retention policy?"))try{await i(`${r}/retention/policies/${o}/delete/`,{method:"DELETE"}),n.success("Policy deleted"),s()}catch{n.error("Failed to delete policy")}};return e.createElement("div",{style:t.overlay},e.createElement("div",{style:t.modal},e.createElement("div",{style:t.header},e.createElement("div",{style:t.headerLeft},e.createElement(S,{style:{marginRight:"10px",color:"#5865f2"}}),e.createElement("h2",{style:t.title},"Data Retention Policies")),e.createElement("button",{onClick:u,style:t.closeButton},e.createElement(k,null))),e.createElement("div",{style:t.content},e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Create New Policy"),e.createElement("div",{style:t.form},e.createElement("div",{style:t.formRow},e.createElement("label",{style:t.label},"Content Type"),e.createElement("select",{value:a.content_type,onChange:o=>y({...a,content_type:o.target.value}),style:t.select},g.map(o=>e.createElement("option",{key:o.value,value:o.value},o.label)))),e.createElement("div",{style:t.formRow},e.createElement("label",{style:t.label},"Retention Period"),e.createElement("div",{style:t.presetButtons},v.map(o=>e.createElement("button",{key:o.days,onClick:()=>y({...a,retention_days:o.days}),style:{...t.presetButton,...a.retention_days===o.days&&t.presetButtonActive}},o.label)))),e.createElement("button",{onClick:E,style:t.saveButton},e.createElement(w,{style:{marginRight:"8px"}}),"Create Policy"))),e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Active Policies (",p.length,")"),b?e.createElement("div",{style:t.loading},"Loading..."):p.length===0?e.createElement("div",{style:t.empty},"No retention policies configured"):e.createElement("div",{style:t.policiesList},p.map((o,l)=>e.createElement("div",{key:l,style:t.policyCard},e.createElement("div",{style:t.policyInfo},e.createElement("div",{style:t.policyType},g.find(c=>c.value===o.content_type)?.label||o.content_type),e.createElement("div",{style:t.policyRetention},o.retention_days===-1?"Forever":`${o.retention_days} days`),e.createElement("div",{style:t.policyMeta},"Last run: ",o.last_run?new Date(o.last_run).toLocaleString():"Never"),o.items_deleted>0&&e.createElement("div",{style:t.policyMeta},"Items deleted: ",o.items_deleted.toLocaleString())),e.createElement("div",{style:t.policyActions},e.createElement("label",{style:t.toggleSwitch},e.createElement("input",{type:"checkbox",checked:o.enabled,onChange:c=>h(o.id,c.target.checked)}),e.createElement("span",{style:t.toggleSlider})),e.createElement("button",{onClick:()=>C(o.id),style:t.deleteButton,title:"Delete Policy"},e.createElement(P,null))))))))))},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},section:{marginBottom:"30px"},sectionTitle:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"16px"},form:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px"},formRow:{marginBottom:"20px"},label:{display:"block",fontSize:"14px",fontWeight:"600",color:"#dcddde",marginBottom:"8px"},select:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},presetButtons:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"8px"},presetButton:{padding:"8px 12px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#dcddde",cursor:"pointer",fontSize:"13px"},presetButtonActive:{backgroundColor:"#5865f2",borderColor:"#5865f2",color:"#ffffff"},saveButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center"},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},policiesList:{display:"flex",flexDirection:"column",gap:"12px"},policyCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},policyInfo:{flex:1},policyType:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},policyRetention:{fontSize:"14px",color:"#5865f2",marginBottom:"8px"},policyMeta:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},policyActions:{display:"flex",gap:"12px",alignItems:"center"},toggleSwitch:{position:"relative",display:"inline-block",width:"44px",height:"24px"},toggleSlider:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:"#2c2f33",transition:"0.3s",borderRadius:"24px"},deleteButton:{background:"none",border:"none",color:"#f04747",cursor:"pointer",fontSize:"16px",padding:"8px"}};export{I as default};
