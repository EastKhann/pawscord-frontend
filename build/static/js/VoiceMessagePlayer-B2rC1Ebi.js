import{d as t,r as n,bx as X,by as Y,aA as _}from"./react-core-GQV1VuAT.js";const G=({audioUrl:i,duration:F,onDownload:C,messageId:w,fetchWithAuth:P,apiBaseUrl:f})=>{const[x,T]=n.useState(!1),[R,S]=n.useState(0),[b,I]=n.useState(F||0),[L,$]=n.useState([]),[B,v]=n.useState(!1),[l,k]=n.useState(null),[m,M]=n.useState(!1),[a,V]=n.useState(i),[y,z]=n.useState(!1),u=n.useRef(null),h=n.useRef(null);n.useEffect(()=>{console.log("[VoicePlayer] ðŸŽ™ï¸ Yeni ses mesajÄ±:",{audioUrl:i,currentAudioUrl:a,triedProxy:y,apiBaseUrl:f||window.location.origin})},[i,a,y,f]),n.useEffect(()=>{i&&i!==a&&!y&&(console.log("[VoicePlayer] ðŸ”„ URL deÄŸiÅŸti, state sÄ±fÄ±rlanÄ±yor"),V(i),z(!1),v(!1))},[i]);const W=async()=>{if(!(m||l)){M(!0);try{const e=await P(`${f}/messages/${w}/transcribe/`,{method:"POST"});if(e.ok){const r=await e.json();k(r.transcription||"Ã‡eviri yapÄ±lamadÄ±")}else k("âŒ Ã‡eviri baÅŸarÄ±sÄ±z")}catch(e){console.error("Transcription error:",e),k("âŒ Hata oluÅŸtu")}finally{M(!1)}}};n.useEffect(()=>{const e=u.current;if(!e)return;const r=()=>{console.log("[VoicePlayer] âœ… Ses yÃ¼klendi:",i),I(e.duration),j(),v(!1)},o=d=>{const E=e.error,O=E?E.code:"unknown",q=E?E.message:"No error info";if(console.warn("[VoicePlayer] âŒ Ses dosyasÄ± yÃ¼klenemedi:",{url:a,errorCode:O,errorMessage:q,networkState:e.networkState,readyState:e.readyState}),!y&&a){console.log("[VoicePlayer] ðŸ”„ R2/CDN hatasÄ±, proxy denenecek...");let g=null;if(a.includes(".r2.dev/"))g=a.split(".r2.dev/")[1];else if(a.includes("r2.dev/")){const c=a.split("r2.dev/");g=c[c.length-1]}else if(a.includes("/attachments/")){const c=a.split("/attachments/");g="attachments/"+c[c.length-1]}if(g){const c=`${f||window.location.origin}/api/voice-proxy/${g}`;console.log("[VoicePlayer] ðŸ”„ Proxy URL:",c),V(c),z(!0),v(!1);return}}v(!0)},p=()=>{console.log("[VoicePlayer] ðŸŽµ Ses Ã§alÄ±nabilir:",a)};return e.addEventListener("loadedmetadata",r),e.addEventListener("error",o),e.addEventListener("canplay",p),()=>{e.removeEventListener("loadedmetadata",r),e.removeEventListener("error",o),e.removeEventListener("canplay",p)}},[a,y,f]);const j=n.useCallback(()=>{const r=[];for(let o=0;o<40;o++){const p=Math.random()*.5+.3,d=Math.sin(o/5)*.2;r.push(Math.max(.2,Math.min(1,p+d)))}$(r)},[]),H=n.useCallback(()=>{const e=u.current;e&&(x?(e.pause(),cancelAnimationFrame(h.current)):(e.play(),A()),T(!x))},[x]),A=n.useCallback(()=>{const e=u.current;e&&(S(e.currentTime),e.paused||(h.current=requestAnimationFrame(A)))},[]),N=n.useCallback(e=>{const r=u.current;if(!r)return;const o=e.currentTarget.getBoundingClientRect(),d=(e.clientX-o.left)/o.width;r.currentTime=d*b,S(r.currentTime)},[b]);n.useEffect(()=>{const e=u.current;if(!e)return;const r=()=>{T(!1),S(0),cancelAnimationFrame(h.current)};return e.addEventListener("ended",r),()=>{e.removeEventListener("ended",r),cancelAnimationFrame(h.current)}},[]);const D=e=>{const r=Math.floor(e/60),o=Math.floor(e%60);return`${r}:${o.toString().padStart(2,"0")}`};return t.createElement("div",{style:s.container},B?t.createElement("div",{style:s.errorContainer},t.createElement("div",{style:s.errorIcon},"ðŸ”‡"),t.createElement("div",{style:s.errorText},"Ses dosyasÄ± bulunamadÄ± (eski mesaj)"),t.createElement("div",{style:{fontSize:"10px",color:"#72767d",marginTop:"4px",wordBreak:"break-all"}},i?.substring(0,80),"...")):t.createElement(t.Fragment,null,t.createElement("audio",{ref:u,src:a,preload:"metadata",crossOrigin:"anonymous"}),t.createElement("button",{onClick:H,style:s.playButton},x?t.createElement(X,null):t.createElement(Y,{style:{marginLeft:"2px"}})),t.createElement("div",{style:s.waveformContainer,onClick:N},t.createElement("div",{style:s.waveform},L.map((e,r)=>{const o=R/b,d=r/L.length<=o;return t.createElement("div",{key:r,style:{...s.waveBar,height:`${e*100}%`,backgroundColor:d?"#5865f2":"#4f545c",opacity:d?1:.5}})})),t.createElement("div",{style:s.timeDisplay},t.createElement("span",null,D(R)),t.createElement("span",{style:{color:"#72767d"}}," / ",D(b)))),C&&t.createElement("button",{onClick:C,style:s.downloadButton,title:"Ä°ndir"},t.createElement(_,null)),w&&P&&t.createElement("button",{onClick:W,disabled:m||!!l,style:{...s.downloadButton,backgroundColor:l?"rgba(67, 181, 129, 0.1)":"transparent",color:m?"#faa61a":l?"#43b581":"#b9bbbe",cursor:m||l?"default":"pointer"},title:l?"Ã‡evrildi":"Metne Ã‡evir"},m?"â³":l?"âœ…":"ðŸ“")),l&&t.createElement("div",{style:s.transcriptionText},l))},s={container:{display:"flex",alignItems:"center",gap:"12px",backgroundColor:"rgba(88, 101, 242, 0.08)",border:"1px solid rgba(88, 101, 242, 0.2)",borderRadius:"12px",padding:"12px 16px",maxWidth:"400px",transition:"all 0.2s"},playButton:{width:"36px",height:"36px",borderRadius:"50%",border:"none",backgroundColor:"#5865f2",color:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"all 0.2s",flexShrink:0},waveformContainer:{flex:1,display:"flex",flexDirection:"column",gap:"6px",cursor:"pointer",minWidth:0},waveform:{display:"flex",alignItems:"center",gap:"2px",height:"32px"},waveBar:{flex:1,minWidth:"2px",borderRadius:"2px",transition:"all 0.15s ease-out"},timeDisplay:{fontSize:"11px",color:"#dcddde",fontWeight:"500"},downloadButton:{width:"32px",height:"32px",borderRadius:"50%",border:"none",backgroundColor:"transparent",color:"#b9bbbe",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"all 0.2s",flexShrink:0},errorContainer:{display:"flex",alignItems:"center",gap:"10px",padding:"4px",width:"100%"},errorIcon:{fontSize:"20px",opacity:.5},errorText:{fontSize:"12px",color:"#72767d",fontStyle:"italic"},transcriptionText:{marginTop:"8px",padding:"8px 12px",backgroundColor:"rgba(79, 84, 92, 0.3)",borderRadius:"8px",fontSize:"13px",color:"#dcddde",lineHeight:"1.4",fontStyle:"italic"}},K=t.memo(G);export{K as default};
