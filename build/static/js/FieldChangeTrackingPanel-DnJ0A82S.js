var L=Object.defineProperty;var r=(d,c)=>L(d,"name",{value:c,configurable:!0});import{r as i,j as e}from"./react-core-Djgtqrmb.js";import{aB as k,a as B,a5 as R}from"./icons-vendor-BW7dxHkX.js";import{t as u}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const U=r(({fetchWithAuth:d,apiBaseUrl:c,onClose:m,entityType:f,entityId:y})=>{const[n,b]=i.useState([]),[v,g]=i.useState(!1),[x,j]=i.useState("all");i.useEffect(()=>{w()},[]);const w=r(async()=>{g(!0);try{const l=await(await d(`${c}/audit/field-changes/?entity_type=${f}&entity_id=${y}`)).json();b(l.changes||[])}catch{u.error("Failed to load change history")}finally{g(!1)}},"fetchChanges"),C=r(()=>{const o=[["Date","Field","Old Value","New Value","Changed By"],...p.map(a=>[new Date(a.changed_at).toLocaleString(),a.field_name,a.old_value||"",a.new_value||"",a.changed_by_username])].map(a=>a.map(S=>`"${S}"`).join(",")).join(`
`),l=new Blob([o],{type:"text/csv"}),h=window.URL.createObjectURL(l),s=document.createElement("a");s.href=h,s.download=`field_changes_${f}_${Date.now()}.csv`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(h),document.body.removeChild(s),u.success("Changes exported")},"exportChanges"),_=[...new Set(n.map(o=>o.field_name))],p=x==="all"?n:n.filter(o=>o.field_name===x);return e.jsx("div",{style:t.overlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(k,{style:{marginRight:"10px",color:"#5865f2"}}),e.jsx("h2",{style:t.title,children:"Field Change History"})]}),e.jsx("button",{onClick:m,style:t.closeButton,children:e.jsx(B,{})})]}),e.jsxs("div",{style:t.toolbar,children:[e.jsxs("select",{value:x,onChange:r(o=>j(o.target.value),"onChange"),style:t.filterSelect,children:[e.jsxs("option",{value:"all",children:["All Fields (",n.length,")"]}),_.map(o=>e.jsxs("option",{value:o,children:[o," (",n.filter(l=>l.field_name===o).length,")"]},o))]}),e.jsxs("button",{onClick:C,style:t.exportButton,children:[e.jsx(R,{style:{marginRight:"6px"}}),"Export"]})]}),e.jsx("div",{style:t.content,children:v?e.jsx("div",{style:t.loading,children:"Loading changes..."}):p.length===0?e.jsx("div",{style:t.empty,children:"No changes recorded"}):e.jsx("div",{style:t.changesList,children:p.map((o,l)=>e.jsxs("div",{style:t.changeCard,children:[e.jsx("div",{style:t.changeField,children:o.field_name}),e.jsxs("div",{style:t.changeValues,children:[e.jsxs("div",{style:t.oldValue,children:[e.jsx("div",{style:t.valueLabel,children:"Old:"}),e.jsx("div",{style:t.value,children:o.old_value||e.jsx("em",{style:{color:"#99aab5"},children:"empty"})})]}),e.jsx("div",{style:t.arrow,children:"â†’"}),e.jsxs("div",{style:t.newValue,children:[e.jsx("div",{style:t.valueLabel,children:"New:"}),e.jsx("div",{style:t.value,children:o.new_value||e.jsx("em",{style:{color:"#99aab5"},children:"empty"})})]})]}),e.jsxs("div",{style:t.changeMeta,children:["Changed by ",e.jsx("span",{style:t.username,children:o.changed_by_username})," on ",new Date(o.changed_at).toLocaleString()]})]},l))})})]})})},"FieldChangeTrackingPanel"),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},toolbar:{display:"flex",gap:"12px",padding:"15px 20px",borderBottom:"1px solid #2c2f33"},filterSelect:{flex:1,padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},exportButton:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"13px",display:"flex",alignItems:"center"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},changesList:{display:"flex",flexDirection:"column",gap:"16px"},changeCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},changeField:{fontSize:"16px",fontWeight:"600",color:"#5865f2",marginBottom:"12px"},changeValues:{display:"flex",gap:"16px",alignItems:"center",marginBottom:"12px",padding:"12px",backgroundColor:"#1e1e1e",borderRadius:"6px"},oldValue:{flex:1},newValue:{flex:1},arrow:{fontSize:"20px",color:"#5865f2"},valueLabel:{fontSize:"12px",color:"#99aab5",marginBottom:"4px"},value:{fontSize:"14px",color:"#ffffff",wordBreak:"break-word"},changeMeta:{fontSize:"12px",color:"#99aab5"},username:{color:"#5865f2",fontWeight:"500"}};export{U as default};
