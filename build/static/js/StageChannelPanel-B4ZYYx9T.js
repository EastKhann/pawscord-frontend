import{r as i,d as e}from"./react-core-DrOm_csO.js";import{t as n}from"./index-BYhWpPLp.js";const K=({roomId:l,apiBaseUrl:c,onClose:g,currentUser:C})=>{const[p,E]=i.useState([]),[x,w]=i.useState(null),[h,v]=i.useState(!0),[k,m]=i.useState("list"),[s,o]=i.useState({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0});i.useEffect(()=>{d();const t=setInterval(d,5e3);return()=>clearInterval(t)},[l]);const d=async()=>{try{const t=localStorage.getItem("access_token"),a=l?`${c}/stages/active/`:`${c}/stages/active/`,r=await fetch(a,{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const u=await r.json();E(Array.isArray(u)?u:u.stages||[])}}catch(t){console.error("Stages fetch error:",t)}finally{v(!1)}},N=async()=>{if(!s.topic.trim()){n.error("âš ï¸ Konu baÅŸlÄ±ÄŸÄ± gerekli");return}if(!l){n.error("âš ï¸ LÃ¼tfen bir ses kanalÄ±nda olun");return}try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/stages/create/${l}/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const r=await a.json();E([...p,r.stage]),o({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0}),m("list"),n.success("âœ… Stage oluÅŸturuldu!")}else{const r=await a.json();n.error(r.error||"âŒ Stage oluÅŸturulamadÄ±")}}catch(t){console.error("Stage creation error:",t),n.error("âŒ Hata oluÅŸtu")}},S=async t=>{try{const a=localStorage.getItem("access_token"),r=await fetch(`${c}/stages/${t}/join/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(r.ok)n.success("ðŸŽ™ï¸ Stage'e katÄ±ldÄ±n!"),d();else{const u=await r.json();n.error(u.error||"âŒ Stage'e katÄ±lamadÄ±n")}}catch(a){console.error("Join stage error:",a),n.error("âŒ Hata oluÅŸtu")}},b=async t=>{try{const a=localStorage.getItem("access_token");(await fetch(`${c}/stages/${t}/leave/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(n.success("ðŸ‘‹ Stage'den ayrÄ±ldÄ±n"),d())}catch(a){console.error("Leave stage error:",a)}},f=async t=>{try{const a=localStorage.getItem("access_token");(await fetch(`${c}/stages/${t}/request-speak/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&n.success("âœ‹ KonuÅŸma talebi gÃ¶nderildi")}catch(a){console.error("Request speak error:",a)}},y=t=>({host:"ðŸ‘‘",moderator:"ðŸ›¡ï¸",speaker:"ðŸŽ™ï¸",listener:"ðŸ‘‚"})[t]||"ðŸ‘¤",_=t=>({host:"#faa61a",moderator:"#8b5cf6",speaker:"#34c759",listener:"#6c6d7d"})[t]||"#6c6d7d";return h?e.createElement("div",{className:"stage-overlay",onClick:g},e.createElement("div",{className:"stage-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"stage-loading"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"YÃ¼kleniyor...")))):e.createElement("div",{className:"stage-overlay",onClick:g},e.createElement("div",{className:"stage-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"stage-header"},e.createElement("h2",null,"ðŸŽ™ï¸ Stage KanallarÄ±"),e.createElement("div",{className:"header-actions"},l&&e.createElement(e.Fragment,null,e.createElement("button",{className:`view-toggle ${k==="list"?"active":""}`,onClick:()=>m("list")},"ðŸ“‹ Aktif Stage'ler"),e.createElement("button",{className:`view-toggle ${k==="create"?"active":""}`,onClick:()=>m("create")},"âž• OluÅŸtur")),e.createElement("button",{className:"close-btn",onClick:g},"âœ•"))),e.createElement("div",{className:"stage-content"},k==="list"?e.createElement("div",{className:"stages-list"},p.length>0?p.map(t=>e.createElement("div",{key:t.id,className:"stage-card"},e.createElement("div",{className:"stage-info"},e.createElement("div",{className:"stage-icon"},"ðŸŽ™ï¸"),e.createElement("div",{className:"stage-details"},e.createElement("h3",null,t.topic),t.description&&e.createElement("p",{className:"stage-description"},t.description),e.createElement("div",{className:"stage-meta"},e.createElement("span",null,"ðŸ‘‘ Host: ",t.host_username),e.createElement("span",null,"ðŸŽ™ï¸ ",t.speakers_count||0," konuÅŸmacÄ±"),e.createElement("span",null,"ðŸ‘‚ ",t.audience_count||0," dinleyici")))),t.speakers&&t.speakers.length>0&&e.createElement("div",{className:"speakers-list"},e.createElement("h4",null,"KonuÅŸmacÄ±lar"),e.createElement("div",{className:"speakers-grid"},t.speakers.slice(0,6).map((a,r)=>e.createElement("div",{key:r,className:"speaker-badge"},e.createElement("span",{className:"role-icon",style:{color:_(a.role)}},y(a.role)),e.createElement("span",{className:"speaker-name"},a.username))),t.speakers.length>6&&e.createElement("div",{className:"speaker-badge more"},"+",t.speakers.length-6))),e.createElement("div",{className:"stage-actions"},t.is_member?e.createElement(e.Fragment,null,e.createElement("button",{className:"leave-stage-btn",onClick:()=>b(t.id)},"ðŸ‘‹ AyrÄ±l"),t.user_role==="listener"&&e.createElement("button",{className:"request-speak-btn",onClick:()=>f(t.id)},"âœ‹ KonuÅŸmak Ä°stiyorum")):e.createElement("button",{className:"join-stage-btn",onClick:()=>S(t.id)},"ðŸŽ§ Dinle")))):e.createElement("div",{className:"no-stages"},e.createElement("p",null,"ðŸŽ™ï¸ Aktif stage yok"),l&&e.createElement("button",{onClick:()=>m("create")},"Ä°lk stage'i oluÅŸtur"))):e.createElement("div",{className:"create-stage-form"},e.createElement("h3",null,"ðŸŽ™ï¸ Yeni Stage OluÅŸtur"),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Konu BaÅŸlÄ±ÄŸÄ± *"),e.createElement("input",{type:"text",placeholder:"KonuÅŸma konusu...",value:s.topic,onChange:t=>o({...s,topic:t.target.value}),maxLength:100})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"AÃ§Ä±klama"),e.createElement("textarea",{placeholder:"Stage hakkÄ±nda detaylar...",value:s.description,onChange:t=>o({...s,description:t.target.value}),rows:4})),e.createElement("div",{className:"form-row"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"Maks. KonuÅŸmacÄ± (1-10)"),e.createElement("input",{type:"number",value:s.max_speakers,onChange:t=>o({...s,max_speakers:Math.min(10,Math.max(1,parseInt(t.target.value)||1))}),min:"1",max:"10"})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Maks. Dinleyici"),e.createElement("input",{type:"number",value:s.max_audience,onChange:t=>o({...s,max_audience:Math.min(1e3,Math.max(1,parseInt(t.target.value)||100))}),min:"1",max:"1000"}))),e.createElement("div",{className:"form-group checkbox-group"},e.createElement("label",null,e.createElement("input",{type:"checkbox",checked:s.is_public,onChange:t=>o({...s,is_public:t.target.checked})}),e.createElement("span",null,"ðŸŒ Herkese AÃ§Ä±k"))),e.createElement("div",{className:"form-actions"},e.createElement("button",{className:"submit-btn",onClick:N},"âœ¨ Stage OluÅŸtur"),e.createElement("button",{className:"cancel-btn",onClick:()=>m("list")},"Ä°ptal"))))))};export{K as default};
