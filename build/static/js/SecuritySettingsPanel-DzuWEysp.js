import{r as o,d as e,c9 as s}from"./react-core-DrOm_csO.js";import{g as W}from"./index-DmEhdEtw.js";const q=({onClose:b})=>{const[i,d]=o.useState(!1),[Y,C]=o.useState([]),[f,P]=o.useState([]),[N,F]=o.useState([]),[m,w]=o.useState([]),[u,A]=o.useState(""),[g,S]=o.useState(""),[p,$]=o.useState(""),[T,z]=o.useState(null),[c,h]=o.useState("2fa"),r=W(),n=localStorage.getItem("access_token");o.useEffect(()=>{k(),I(),E(),y()},[]);const k=async()=>{try{const a=await(await fetch(`${r}/security/status/`,{headers:{Authorization:`Bearer ${n}`}})).json();z(a),d(a.two_factor_enabled||!1)}catch(t){console.error("Error fetching security status:",t)}},I=async()=>{try{const a=await(await fetch(`${r}/2fa/methods/`,{headers:{Authorization:`Bearer ${n}`}})).json();C(a.methods||[])}catch(t){console.error("Error fetching 2FA methods:",t)}},E=async()=>{try{const a=await(await fetch(`${r}/security/sessions/`,{headers:{Authorization:`Bearer ${n}`}})).json();P(a.sessions||[])}catch(t){console.error("Error fetching sessions:",t)}},y=async()=>{try{const a=await(await fetch(`${r}/security/ip-whitelist/`,{headers:{Authorization:`Bearer ${n}`}})).json();F(a.whitelist||[])}catch(t){console.error("Error fetching IP whitelist:",t)}},B=async()=>{try{const t=await fetch(`${r}/security/2fa/enable/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await t.json();t.ok?(A(a.qr_code||""),w(a.backup_codes||[]),s.info("â„¹ï¸ QR kodu tarayÄ±n ve doÄŸrulama kodunu girin")):s.error(`âŒ ${a.error||"2FA etkinleÅŸtirilemedi"}`)}catch(t){console.error("Error enabling 2FA:",t),s.error("âŒ 2FA etkinleÅŸtirme hatasÄ±")}},j=async()=>{try{const t=await fetch(`${r}/security/2fa/verify-setup/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({code:g})}),a=await t.json();t.ok?(s.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),d(!0),A(""),S(""),k()):s.error(`âŒ ${a.error||"GeÃ§ersiz kod"}`)}catch(t){console.error("Error verifying 2FA:",t),s.error("âŒ DoÄŸrulama hatasÄ±")}},O=async()=>{if(window.confirm("2FA'yÄ± devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?"))try{const t=await fetch(`${r}/security/2fa/disable/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await t.json();t.ok?(s.info("â„¹ï¸ 2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±"),d(!1),k()):s.error(`âŒ ${a.error||"2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±lamadÄ±"}`)}catch(t){console.error("Error disabling 2FA:",t),s.error("âŒ 2FA devre dÄ±ÅŸÄ± bÄ±rakma hatasÄ±")}},_=async()=>{try{const t=await fetch(`${r}/security/2fa/backup-codes/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await t.json();t.ok?(w(a.backup_codes||[]),s.success("âœ… Yedek kodlar oluÅŸturuldu")):s.error(`âŒ ${a.error||"Yedek kodlar oluÅŸturulamadÄ±"}`)}catch(t){console.error("Error getting backup codes:",t),s.error("âŒ Yedek kod hatasÄ±")}},D=async t=>{try{const a=await fetch(`${r}/security/sessions/${t}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),l=await a.json();a.ok?(s.success("âœ… Oturum sonlandÄ±rÄ±ldÄ±"),E()):s.error(`âŒ ${l.error||"Oturum sonlandÄ±rÄ±lamadÄ±"}`)}catch(a){console.error("Error revoking session:",a),s.error("âŒ Oturum sonlandÄ±rma hatasÄ±")}},R=async()=>{if(window.confirm("TÃ¼m oturumlarÄ± sonlandÄ±rmak istediÄŸinizden emin misiniz?"))try{const t=await fetch(`${r}/security/sessions/revoke-all/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await t.json();t.ok?(s.success("âœ… TÃ¼m oturumlar sonlandÄ±rÄ±ldÄ±"),E()):s.error(`âŒ ${a.error||"Oturumlar sonlandÄ±rÄ±lamadÄ±"}`)}catch(t){console.error("Error revoking all sessions:",t),s.error("âŒ Toplu sonlandÄ±rma hatasÄ±")}},L=async()=>{if(!p.trim()){s.error("âŒ IP adresi gerekli");return}try{const t=await fetch(`${r}/security/ip-whitelist/add/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({ip_address:p})}),a=await t.json();t.ok?(s.success("âœ… IP beyaz listeye eklendi"),$(""),y()):s.error(`âŒ ${a.error||"IP eklenemedi"}`)}catch(t){console.error("Error adding IP:",t),s.error("âŒ IP ekleme hatasÄ±")}},x=async t=>{try{(await fetch(`${r}/security/ip-whitelist/${t}/`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok?(s.success("âœ… IP beyaz listeden kaldÄ±rÄ±ldÄ±"),y()):s.error("âŒ IP kaldÄ±rÄ±lamadÄ±")}catch(a){console.error("Error removing IP:",a),s.error("âŒ IP kaldÄ±rma hatasÄ±")}},K=()=>{const t=m.join(`
`),a=new Blob([t],{type:"text/plain"}),l=window.URL.createObjectURL(a),v=document.createElement("a");v.href=l,v.download=`pawscord_backup_codes_${new Date().toISOString()}.txt`,v.click(),window.URL.revokeObjectURL(l),s.success("âœ… Yedek kodlar indirildi")};return e.createElement("div",{className:"security-overlay",onClick:b},e.createElement("div",{className:"security-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"security-header"},e.createElement("h2",null,"ğŸ”’ GÃ¼venlik AyarlarÄ±"),e.createElement("button",{className:"close-btn",onClick:b},"âœ•")),T&&e.createElement("div",{className:"security-status"},e.createElement("div",{className:"status-item"},e.createElement("span",{className:"status-icon"},"ğŸ”"),e.createElement("span",{className:"status-label"},"2FA:"),e.createElement("span",{className:`status-value ${i?"active":"inactive"}`},i?"Aktif":"Pasif")),e.createElement("div",{className:"status-item"},e.createElement("span",{className:"status-icon"},"ğŸ’»"),e.createElement("span",{className:"status-label"},"Aktif Oturumlar:"),e.createElement("span",{className:"status-value"},f.length)),e.createElement("div",{className:"status-item"},e.createElement("span",{className:"status-icon"},"ğŸŒ"),e.createElement("span",{className:"status-label"},"IP Whitelist:"),e.createElement("span",{className:"status-value"},N.length))),e.createElement("div",{className:"security-tabs"},e.createElement("button",{className:`tab-btn ${c==="2fa"?"active":""}`,onClick:()=>h("2fa")},"ğŸ” 2FA"),e.createElement("button",{className:`tab-btn ${c==="sessions"?"active":""}`,onClick:()=>h("sessions")},"ğŸ’» Oturumlar"),e.createElement("button",{className:`tab-btn ${c==="ip"?"active":""}`,onClick:()=>h("ip")},"ğŸŒ IP Whitelist")),e.createElement("div",{className:"security-content"},c==="2fa"&&e.createElement("div",{className:"tab-content"},e.createElement("h3",null,"Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama (2FA)"),e.createElement("p",null,"HesabÄ±nÄ±zÄ± ekstra bir gÃ¼venlik katmanÄ±yla koruyun"),!i&&!u?e.createElement("div",{className:"enable-2fa"},e.createElement("button",{className:"enable-btn",onClick:B},"2FA'yÄ± EtkinleÅŸtir")):i?e.createElement("div",{className:"enabled-2fa"},e.createElement("div",{className:"success-message"},e.createElement("span",{className:"success-icon"},"âœ…"),e.createElement("span",null,"2FA aktif - HesabÄ±nÄ±z korunuyor")),e.createElement("button",{className:"disable-btn",onClick:O},"2FA'yÄ± Devre DÄ±ÅŸÄ± BÄ±rak"),e.createElement("button",{className:"backup-btn",onClick:_},"Yeni Yedek Kodlar OluÅŸtur")):e.createElement("div",{className:"setup-2fa"},e.createElement("div",{className:"qr-section"},e.createElement("h4",null,"1. QR Kodu TarayÄ±n"),u&&e.createElement("img",{src:u,alt:"2FA QR Code",className:"qr-code"}),e.createElement("p",null,"Authenticator uygulamanÄ±zla QR kodu tarayÄ±n")),e.createElement("div",{className:"verify-section"},e.createElement("h4",null,"2. DoÄŸrulama Kodunu Girin"),e.createElement("input",{type:"text",placeholder:"6 haneli kod",value:g,onChange:t=>S(t.target.value),maxLength:6,className:"verification-input"}),e.createElement("button",{className:"verify-btn",onClick:j},"DoÄŸrula ve EtkinleÅŸtir")),m.length>0&&e.createElement("div",{className:"backup-codes"},e.createElement("h4",null,"3. Yedek KodlarÄ±nÄ±z"),e.createElement("p",null,"Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n!"),e.createElement("div",{className:"codes-grid"},m.map((t,a)=>e.createElement("div",{key:a,className:"backup-code"},t))),e.createElement("button",{className:"download-btn",onClick:K},"ğŸ“¥ KodlarÄ± Ä°ndir")))),c==="sessions"&&e.createElement("div",{className:"tab-content"},e.createElement("div",{className:"sessions-header"},e.createElement("h3",null,"Aktif Oturumlar"),e.createElement("button",{className:"revoke-all-btn",onClick:R},"TÃ¼mÃ¼nÃ¼ SonlandÄ±r")),e.createElement("div",{className:"sessions-list"},f.map(t=>e.createElement("div",{key:t.id,className:"session-card"},e.createElement("div",{className:"session-info"},e.createElement("div",{className:"session-device"},e.createElement("span",{className:"device-icon"},t.device_type==="mobile"?"ğŸ“±":"ğŸ’»"),e.createElement("div",{className:"device-details"},e.createElement("span",{className:"device-name"},t.device_name||"Bilinmeyen Cihaz"),e.createElement("span",{className:"device-location"},t.location||"Bilinmeyen Konum"))),e.createElement("div",{className:"session-meta"},e.createElement("span",{className:"session-ip"},"IP: ",t.ip_address),e.createElement("span",{className:"session-time"},"Son Aktivite: ",new Date(t.last_activity).toLocaleString("tr-TR")))),t.is_current?e.createElement("span",{className:"current-badge"},"Mevcut Oturum"):e.createElement("button",{className:"revoke-btn",onClick:()=>D(t.id)},"SonlandÄ±r"))))),c==="ip"&&e.createElement("div",{className:"tab-content"},e.createElement("h3",null,"IP Adresi Beyaz Listesi"),e.createElement("p",null,"Sadece izin verilen IP adreslerinden giriÅŸ yapÄ±n"),e.createElement("div",{className:"add-ip"},e.createElement("input",{type:"text",placeholder:"IP Adresi (Ã¶rn: 192.168.1.1)",value:p,onChange:t=>$(t.target.value),className:"ip-input"}),e.createElement("button",{className:"add-btn",onClick:L},"+ Ekle")),e.createElement("div",{className:"ip-list"},N.map(t=>e.createElement("div",{key:t.id,className:"ip-card"},e.createElement("div",{className:"ip-info"},e.createElement("span",{className:"ip-address"},t.ip_address),e.createElement("span",{className:"ip-added"},"Eklendi: ",new Date(t.created_at).toLocaleDateString("tr-TR"))),e.createElement("button",{className:"remove-btn",onClick:()=>x(t.id)},"KaldÄ±r"))))))))};export{q as default};
