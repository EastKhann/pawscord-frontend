var k=Object.defineProperty;var i=(s,r)=>k(s,"name",{value:r,configurable:!0});import{r as p,j as e}from"./react-core-Djgtqrmb.js";import{z as w,a as P,aY as R,f as _}from"./icons-vendor-BW7dxHkX.js";import{t as n}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const E=i(({fetchWithAuth:s,apiBaseUrl:r,onClose:b,serverId:f})=>{const[y,h]=p.useState([]),[m,g]=p.useState(!1),[a,x]=p.useState({content_type:"messages",retention_days:30,enabled:!0}),u=[{value:"messages",label:"Messages"},{value:"media",label:"Media Files"},{value:"voice_recordings",label:"Voice Recordings"},{value:"audit_logs",label:"Audit Logs"},{value:"deleted_messages",label:"Deleted Messages"}],v=[{days:7,label:"7 Days"},{days:30,label:"30 Days"},{days:90,label:"90 Days"},{days:180,label:"6 Months"},{days:365,label:"1 Year"},{days:730,label:"2 Years"},{days:-1,label:"Forever"}];p.useEffect(()=>{d()},[]);const d=i(async()=>{g(!0);try{const l=await(await s(`${r}/servers/${f}/retention/`)).json();h(l.policies||[])}catch{n.error("Failed to load retention policies")}finally{g(!1)}},"fetchPolicies"),j=i(async()=>{try{await s(`${r}/retention/policies/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,server_id:f})}),n.success("Retention policy created"),x({content_type:"messages",retention_days:30,enabled:!0}),d()}catch{n.error("Failed to create policy")}},"savePolicy"),C=i(async(o,l)=>{try{await s(`${r}/retention/policies/${o}/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:l})}),n.success(l?"Policy enabled":"Policy disabled"),d()}catch{n.error("Failed to toggle policy")}},"togglePolicy"),S=i(async o=>{if(confirm("Delete this retention policy?"))try{await s(`${r}/retention/policies/${o}/delete/`,{method:"DELETE"}),n.success("Policy deleted"),d()}catch{n.error("Failed to delete policy")}},"deletePolicy");return e.jsx("div",{style:t.overlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(w,{style:{marginRight:"10px",color:"#5865f2"}}),e.jsx("h2",{style:t.title,children:"Data Retention Policies"})]}),e.jsx("button",{onClick:b,style:t.closeButton,children:e.jsx(P,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Create New Policy"}),e.jsxs("div",{style:t.form,children:[e.jsxs("div",{style:t.formRow,children:[e.jsx("label",{style:t.label,children:"Content Type"}),e.jsx("select",{value:a.content_type,onChange:i(o=>x({...a,content_type:o.target.value}),"onChange"),style:t.select,children:u.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{style:t.formRow,children:[e.jsx("label",{style:t.label,children:"Retention Period"}),e.jsx("div",{style:t.presetButtons,children:v.map(o=>e.jsx("button",{onClick:i(()=>x({...a,retention_days:o.days}),"onClick"),style:{...t.presetButton,...a.retention_days===o.days&&t.presetButtonActive},children:o.label},o.days))})]}),e.jsxs("button",{onClick:j,style:t.saveButton,children:[e.jsx(R,{style:{marginRight:"8px"}}),"Create Policy"]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsxs("h3",{style:t.sectionTitle,children:["Active Policies (",y.length,")"]}),m?e.jsx("div",{style:t.loading,children:"Loading..."}):y.length===0?e.jsx("div",{style:t.empty,children:"No retention policies configured"}):e.jsx("div",{style:t.policiesList,children:y.map((o,l)=>e.jsxs("div",{style:t.policyCard,children:[e.jsxs("div",{style:t.policyInfo,children:[e.jsx("div",{style:t.policyType,children:u.find(c=>c.value===o.content_type)?.label||o.content_type}),e.jsx("div",{style:t.policyRetention,children:o.retention_days===-1?"Forever":`${o.retention_days} days`}),e.jsxs("div",{style:t.policyMeta,children:["Last run: ",o.last_run?new Date(o.last_run).toLocaleString():"Never"]}),o.items_deleted>0&&e.jsxs("div",{style:t.policyMeta,children:["Items deleted: ",o.items_deleted.toLocaleString()]})]}),e.jsxs("div",{style:t.policyActions,children:[e.jsxs("label",{style:t.toggleSwitch,children:[e.jsx("input",{type:"checkbox",checked:o.enabled,onChange:i(c=>C(o.id,c.target.checked),"onChange")}),e.jsx("span",{style:t.toggleSlider})]}),e.jsx("button",{onClick:i(()=>S(o.id),"onClick"),style:t.deleteButton,title:"Delete Policy",children:e.jsx(_,{})})]})]},l))})]})]})]})})},"DataRetentionPanel"),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},section:{marginBottom:"30px"},sectionTitle:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"16px"},form:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px"},formRow:{marginBottom:"20px"},label:{display:"block",fontSize:"14px",fontWeight:"600",color:"#dcddde",marginBottom:"8px"},select:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},presetButtons:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"8px"},presetButton:{padding:"8px 12px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#dcddde",cursor:"pointer",fontSize:"13px"},presetButtonActive:{backgroundColor:"#5865f2",borderColor:"#5865f2",color:"#ffffff"},saveButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center"},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},policiesList:{display:"flex",flexDirection:"column",gap:"12px"},policyCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},policyInfo:{flex:1},policyType:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},policyRetention:{fontSize:"14px",color:"#5865f2",marginBottom:"8px"},policyMeta:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},policyActions:{display:"flex",gap:"12px",alignItems:"center"},toggleSwitch:{position:"relative",display:"inline-block",width:"44px",height:"24px"},toggleSlider:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:"#2c2f33",transition:"0.3s",borderRadius:"24px"},deleteButton:{background:"none",border:"none",color:"#f04747",cursor:"pointer",fontSize:"16px",padding:"8px"}};export{E as default};
