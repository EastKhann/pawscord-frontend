import{r as n,n as e}from"./react-core-Cj7FUMmY.js";import{y as t}from"./ui-vendor-EA4dxvko.js";import{g as Y,h as C}from"./index-BZ0XvVGG.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-By68PLJG.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-TGltgKsJ.js";import"./state-vendor-DGcbxrkI.js";import"./crypto-vendor-DK-7ILyQ.js";const ee=({onClose:v})=>{const[o,d]=n.useState(!1),[Q,g]=n.useState([]),[b,T]=n.useState([]),[f,z]=n.useState([]),[h,N]=n.useState([]),[u,w]=n.useState(""),[A,S]=n.useState(""),[m,$]=n.useState(""),[P,F]=n.useState(null),[c,p]=n.useState("2fa"),r=Y(),i=localStorage.getItem("access_token");n.useEffect(()=>{j(),B(),k(),x()},[]);const j=async()=>{try{const a=await(await fetch(`${r}/security/status/`,{headers:{Authorization:`Bearer ${i}`}})).json();F(a),d(a.two_factor_enabled||!1)}catch{}},B=async()=>{try{const a=await(await fetch(`${r}/2fa/methods/`,{headers:{Authorization:`Bearer ${i}`}})).json();g(a.methods||[])}catch{}},k=async()=>{try{const a=await(await fetch(`${r}/security/sessions/`,{headers:{Authorization:`Bearer ${i}`}})).json();T(a.sessions||[])}catch{}},x=async()=>{try{const a=await(await fetch(`${r}/security/ip-whitelist/`,{headers:{Authorization:`Bearer ${i}`}})).json();z(a.whitelist||[])}catch{}},I=async()=>{try{const s=await fetch(`${r}/security/2fa/enable/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(w(a.qr_code||""),N(a.backup_codes||[]),t.info("â„¹ï¸ QR kodu tarayÄ±n ve doÄŸrulama kodunu girin")):t.error(`âŒ ${a.error||"2FA etkinleÅŸtirilemedi"}`)}catch{t.error("âŒ 2FA etkinleÅŸtirme hatasÄ±")}},O=async()=>{try{const s=await fetch(`${r}/security/2fa/verify-setup/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({code:A})}),a=await s.json();s.ok?(t.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),d(!0),w(""),S(""),j()):t.error(`âŒ ${a.error||"GeÃ§ersiz kod"}`)}catch{t.error("âŒ DoÄŸrulama hatasÄ±")}},_=async()=>{if(await C("2FA'yÄ± devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${r}/security/2fa/disable/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(t.info("â„¹ï¸ 2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±"),d(!1),j()):t.error(`âŒ ${a.error||"2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±lamadÄ±"}`)}catch{t.error("âŒ 2FA devre dÄ±ÅŸÄ± bÄ±rakma hatasÄ±")}},E=async()=>{try{const s=await fetch(`${r}/security/2fa/backup-codes/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(N(a.backup_codes||[]),t.success("âœ… Yedek kodlar oluÅŸturuldu")):t.error(`âŒ ${a.error||"Yedek kodlar oluÅŸturulamadÄ±"}`)}catch{t.error("âŒ Yedek kod hatasÄ±")}},D=async s=>{try{const a=await fetch(`${r}/security/sessions/${s}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),l=await a.json();a.ok?(t.success("âœ… Oturum sonlandÄ±rÄ±ldÄ±"),k()):t.error(`âŒ ${l.error||"Oturum sonlandÄ±rÄ±lamadÄ±"}`)}catch{t.error("âŒ Oturum sonlandÄ±rma hatasÄ±")}},R=async()=>{if(await C("TÃ¼m oturumlarÄ± sonlandÄ±rmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${r}/security/sessions/revoke-all/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(t.success("âœ… TÃ¼m oturumlar sonlandÄ±rÄ±ldÄ±"),k()):t.error(`âŒ ${a.error||"Oturumlar sonlandÄ±rÄ±lamadÄ±"}`)}catch{t.error("âŒ Toplu sonlandÄ±rma hatasÄ±")}},L=async()=>{if(!m.trim()){t.error("âŒ IP adresi gerekli");return}try{const s=await fetch(`${r}/security/ip-whitelist/add/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({ip_address:m})}),a=await s.json();s.ok?(t.success("âœ… IP beyaz listeye eklendi"),$(""),x()):t.error(`âŒ ${a.error||"IP eklenemedi"}`)}catch{t.error("âŒ IP ekleme hatasÄ±")}},K=async s=>{try{(await fetch(`${r}/security/ip-whitelist/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).ok?(t.success("âœ… IP beyaz listeden kaldÄ±rÄ±ldÄ±"),x()):t.error("âŒ IP kaldÄ±rÄ±lamadÄ±")}catch{t.error("âŒ IP kaldÄ±rma hatasÄ±")}},W=()=>{const s=h.join(`
`),a=new Blob([s],{type:"text/plain"}),l=window.URL.createObjectURL(a),y=document.createElement("a");y.href=l,y.download=`pawscord_backup_codes_${new Date().toISOString()}.txt`,y.click(),window.URL.revokeObjectURL(l),t.success("âœ… Yedek kodlar indirildi")};return e.jsx("div",{className:"security-overlay",onClick:v,children:e.jsxs("div",{className:"security-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"security-header",children:[e.jsx("h2",{children:"ğŸ”’ GÃ¼venlik AyarlarÄ±"}),e.jsx("button",{className:"close-btn",onClick:v,children:"âœ•"})]}),P&&e.jsxs("div",{className:"security-status",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸ”"}),e.jsx("span",{className:"status-label",children:"2FA:"}),e.jsx("span",{className:`status-value ${o?"active":"inactive"}`,children:o?"Aktif":"Pasif"})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸ’»"}),e.jsx("span",{className:"status-label",children:"Aktif Oturumlar:"}),e.jsx("span",{className:"status-value",children:b.length})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸŒ"}),e.jsx("span",{className:"status-label",children:"IP Whitelist:"}),e.jsx("span",{className:"status-value",children:f.length})]})]}),e.jsxs("div",{className:"security-tabs",children:[e.jsx("button",{className:`tab-btn ${c==="2fa"?"active":""}`,onClick:()=>p("2fa"),children:"ğŸ” 2FA"}),e.jsx("button",{className:`tab-btn ${c==="sessions"?"active":""}`,onClick:()=>p("sessions"),children:"ğŸ’» Oturumlar"}),e.jsx("button",{className:`tab-btn ${c==="ip"?"active":""}`,onClick:()=>p("ip"),children:"ğŸŒ IP Whitelist"})]}),e.jsxs("div",{className:"security-content",children:[c==="2fa"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("h3",{children:"Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama (2FA)"}),e.jsx("p",{children:"HesabÄ±nÄ±zÄ± ekstra bir gÃ¼venlik katmanÄ±yla koruyun"}),!o&&!u?e.jsx("div",{className:"enable-2fa",children:e.jsx("button",{className:"enable-btn",onClick:I,children:"2FA'yÄ± EtkinleÅŸtir"})}):o?e.jsxs("div",{className:"enabled-2fa",children:[e.jsxs("div",{className:"success-message",children:[e.jsx("span",{className:"success-icon",children:"âœ…"}),e.jsx("span",{children:"2FA aktif - HesabÄ±nÄ±z korunuyor"})]}),e.jsx("button",{className:"disable-btn",onClick:_,children:"2FA'yÄ± Devre DÄ±ÅŸÄ± BÄ±rak"}),e.jsx("button",{className:"backup-btn",onClick:E,children:"Yeni Yedek Kodlar OluÅŸtur"})]}):e.jsxs("div",{className:"setup-2fa",children:[e.jsxs("div",{className:"qr-section",children:[e.jsx("h4",{children:"1. QR Kodu TarayÄ±n"}),u&&e.jsx("img",{src:u,alt:"2FA QR Code",className:"qr-code"}),e.jsx("p",{children:"Authenticator uygulamanÄ±zla QR kodu tarayÄ±n"})]}),e.jsxs("div",{className:"verify-section",children:[e.jsx("h4",{children:"2. DoÄŸrulama Kodunu Girin"}),e.jsx("input",{type:"text",placeholder:"6 haneli kod",value:A,onChange:s=>S(s.target.value),maxLength:6,className:"verification-input"}),e.jsx("button",{className:"verify-btn",onClick:O,children:"DoÄŸrula ve EtkinleÅŸtir"})]}),h.length>0&&e.jsxs("div",{className:"backup-codes",children:[e.jsx("h4",{children:"3. Yedek KodlarÄ±nÄ±z"}),e.jsx("p",{children:"Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n!"}),e.jsx("div",{className:"codes-grid",children:h.map((s,a)=>e.jsx("div",{className:"backup-code",children:s},a))}),e.jsx("button",{className:"download-btn",onClick:W,children:"ğŸ“¥ KodlarÄ± Ä°ndir"})]})]})]}),c==="sessions"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"sessions-header",children:[e.jsx("h3",{children:"Aktif Oturumlar"}),e.jsx("button",{className:"revoke-all-btn",onClick:R,children:"TÃ¼mÃ¼nÃ¼ SonlandÄ±r"})]}),e.jsx("div",{className:"sessions-list",children:b.map(s=>e.jsxs("div",{className:"session-card",children:[e.jsxs("div",{className:"session-info",children:[e.jsxs("div",{className:"session-device",children:[e.jsx("span",{className:"device-icon",children:s.device_type==="mobile"?"ğŸ“±":"ğŸ’»"}),e.jsxs("div",{className:"device-details",children:[e.jsx("span",{className:"device-name",children:s.device_name||"Bilinmeyen Cihaz"}),e.jsx("span",{className:"device-location",children:s.location||"Bilinmeyen Konum"})]})]}),e.jsxs("div",{className:"session-meta",children:[e.jsxs("span",{className:"session-ip",children:["IP: ",s.ip_address]}),e.jsxs("span",{className:"session-time",children:["Son Aktivite: ",new Date(s.last_activity).toLocaleString("tr-TR")]})]})]}),s.is_current?e.jsx("span",{className:"current-badge",children:"Mevcut Oturum"}):e.jsx("button",{className:"revoke-btn",onClick:()=>D(s.id),children:"SonlandÄ±r"})]},s.id))})]}),c==="ip"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("h3",{children:"IP Adresi Beyaz Listesi"}),e.jsx("p",{children:"Sadece izin verilen IP adreslerinden giriÅŸ yapÄ±n"}),e.jsxs("div",{className:"add-ip",children:[e.jsx("input",{type:"text",placeholder:"IP Adresi (Ã¶rn: 192.168.1.1)",value:m,onChange:s=>$(s.target.value),className:"ip-input"}),e.jsx("button",{className:"add-btn",onClick:L,children:"+ Ekle"})]}),e.jsx("div",{className:"ip-list",children:f.map(s=>e.jsxs("div",{className:"ip-card",children:[e.jsxs("div",{className:"ip-info",children:[e.jsx("span",{className:"ip-address",children:s.ip_address}),e.jsxs("span",{className:"ip-added",children:["Eklendi: ",new Date(s.created_at).toLocaleDateString("tr-TR")]})]}),e.jsx("button",{className:"remove-btn",onClick:()=>K(s.id),children:"KaldÄ±r"})]},s.id))})]})]})]})})};export{ee as default};
