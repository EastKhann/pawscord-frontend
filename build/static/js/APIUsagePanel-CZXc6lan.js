import{r as o,j as e}from"./react-vendor-D8Fi5F9E.js";import{L,a as I,j as R,u as f,x as k,az as y}from"./icons-vendor-CfNiWYc_.js";import{t as _}from"./index-DZYOpCY3.js";import"./media-vendor-Dp18sh1g.js";import"./router-vendor-CTPwQFnc.js";import"./crypto-vendor-Cz32ecGD.js";import"./state-vendor-De5qIGw3.js";const M=({fetchWithAuth:d,apiBaseUrl:c,onClose:x,username:r})=>{const[i,a]=o.useState(null),[p,u]=o.useState([]),[m,j]=o.useState([]),[v,g]=o.useState(!0),[h,b]=o.useState("24h"),[w,S]=o.useState(null);o.useEffect(()=>{C()},[h]);const C=async()=>{g(!0);try{const n=await(await d(`${c}/analytics/usage/?range=${h}`)).json();a(n.stats||{}),u(n.endpoints||[]),j(n.timeline||[])}catch(s){console.error("Failed to load API usage:",s),_.error("Failed to load analytics")}finally{g(!1)}},l=(()=>{if(!i||!i.rate_limit)return{color:"#43b581",text:"Normal"};const s=i.requests_made/i.rate_limit*100;return s>=90?{color:"#f04747",text:"Critical"}:s>=70?{color:"#faa61a",text:"Warning"}:{color:"#43b581",text:"Normal"}})();return e.jsx("div",{style:t.overlay,onClick:x,children:e.jsxs("div",{style:t.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(L,{style:{fontSize:"24px",color:"#5865f2"}}),e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"API Usage Analytics"})]}),e.jsxs("div",{style:t.headerRight,children:[e.jsxs("select",{value:h,onChange:s=>b(s.target.value),style:t.timeRangeSelect,children:[e.jsx("option",{value:"24h",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"})]}),e.jsx("button",{onClick:x,style:t.closeBtn,children:e.jsx(I,{})})]})]}),e.jsx("div",{style:t.content,children:v?e.jsx("div",{style:t.loading,children:"Loading analytics..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(R,{style:{color:"#5865f2"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.requests_made?.toLocaleString()||0}),e.jsx("div",{style:t.statLabel,children:"Total Requests"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(f,{style:{color:"#43b581"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.success_rate?`${i.success_rate.toFixed(1)}%`:"0%"}),e.jsx("div",{style:t.statLabel,children:"Success Rate"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(k,{style:{color:"#faa61a"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.avg_response_time?`${i.avg_response_time}ms`:"0ms"}),e.jsx("div",{style:t.statLabel,children:"Avg Response Time"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(y,{style:{color:"#f04747"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.errors||0}),e.jsx("div",{style:t.statLabel,children:"Errors"})]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Rate Limit Status"}),e.jsxs("div",{style:{...t.rateLimitCard,borderLeftColor:l.color},children:[e.jsxs("div",{style:t.rateLimitInfo,children:[e.jsxs("div",{style:t.rateLimitText,children:[i.requests_made||0," / ",i.rate_limit||1e3," requests used"]}),e.jsx("div",{style:{...t.rateLimitStatus,color:l.color},children:l.text})]}),e.jsx("div",{style:t.rateLimitBar,children:e.jsx("div",{style:{...t.rateLimitProgress,width:`${Math.min(i.requests_made/i.rate_limit*100,100)}%`,backgroundColor:l.color}})}),i.reset_at&&e.jsxs("div",{style:t.rateLimitReset,children:["Resets in: ",z(i.reset_at)]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Top Endpoints"}),e.jsx("div",{style:t.endpointsList,children:p.length===0?e.jsx("div",{style:t.empty,children:"No endpoint data"}):p.slice(0,10).map((s,n)=>e.jsxs("div",{style:t.endpointItem,onClick:()=>S(s),children:[e.jsxs("div",{style:t.endpointRank,children:["#",n+1]}),e.jsxs("div",{style:t.endpointDetails,children:[e.jsxs("div",{style:t.endpointPath,children:[e.jsx("span",{style:t.endpointMethod,children:s.method}),s.path]}),e.jsxs("div",{style:t.endpointStats,children:[e.jsxs("span",{children:[s.count," requests"]}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{children:[s.avg_time,"ms avg"]}),s.error_rate>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{style:{color:"#f04747"},children:[s.error_rate,"% errors"]})]})]})]}),e.jsx("div",{style:t.endpointBar,children:e.jsx("div",{style:{...t.endpointBarFill,width:`${s.count/p[0].count*100}%`,backgroundColor:s.error_rate>5?"#f04747":"#5865f2"}})})]},n))})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Recent Activity"}),e.jsx("div",{style:t.timeline,children:m.length===0?e.jsx("div",{style:t.empty,children:"No recent activity"}):m.slice(0,20).map((s,n)=>e.jsxs("div",{style:t.timelineItem,children:[e.jsx("div",{style:{...t.timelineIcon,backgroundColor:s.status>=400?"#f04747":"#43b581"},children:s.status>=400?e.jsx(y,{}):e.jsx(f,{})}),e.jsxs("div",{style:t.timelineContent,children:[e.jsxs("div",{style:t.timelinePath,children:[e.jsx("span",{style:t.timelineMethod,children:s.method}),s.path]}),e.jsxs("div",{style:t.timelineMeta,children:[e.jsx("span",{style:{color:s.status>=400?"#f04747":"#43b581"},children:s.status}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{children:[s.response_time,"ms"]}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString()})]})]})]},n))})]})]})})]})})},z=d=>{const c=new Date,r=new Date(d)-c;if(r<=0)return"Soon";const i=Math.floor(r/(1e3*60*60)),a=Math.floor(r%(1e3*60*60)/(1e3*60));return i>0?`${i}h ${a}m`:`${a}m`},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerRight:{display:"flex",alignItems:"center",gap:"12px"},timeRangeSelect:{padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px",cursor:"pointer"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},statCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",display:"flex",alignItems:"center",gap:"16px"},statIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},statInfo:{flex:1},statValue:{fontSize:"28px",fontWeight:"bold",marginBottom:"4px"},statLabel:{fontSize:"12px",color:"#99aab5",textTransform:"uppercase",letterSpacing:"1px"},section:{marginBottom:"32px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},rateLimitCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",borderLeft:"4px solid"},rateLimitInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},rateLimitText:{fontSize:"14px",fontWeight:"600"},rateLimitStatus:{fontSize:"14px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px"},rateLimitBar:{height:"8px",backgroundColor:"#202225",borderRadius:"4px",overflow:"hidden",marginBottom:"8px"},rateLimitProgress:{height:"100%",transition:"width 0.3s ease"},rateLimitReset:{fontSize:"12px",color:"#99aab5"},endpointsList:{display:"flex",flexDirection:"column",gap:"8px"},endpointItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},endpointRank:{fontSize:"20px",fontWeight:"bold",color:"#5865f2",minWidth:"40px"},endpointDetails:{flex:1},endpointPath:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",fontFamily:"monospace"},endpointMethod:{display:"inline-block",padding:"2px 8px",backgroundColor:"#5865f2",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",marginRight:"8px"},endpointStats:{fontSize:"12px",color:"#99aab5"},endpointBar:{width:"100px",height:"6px",backgroundColor:"#202225",borderRadius:"3px",overflow:"hidden"},endpointBarFill:{height:"100%",transition:"width 0.3s ease"},timeline:{display:"flex",flexDirection:"column",gap:"8px"},timelineItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px",display:"flex",alignItems:"center",gap:"12px"},timelineIcon:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},timelineContent:{flex:1},timelinePath:{fontSize:"14px",fontWeight:"600",fontFamily:"monospace",marginBottom:"4px"},timelineMethod:{display:"inline-block",padding:"2px 6px",backgroundColor:"#5865f2",borderRadius:"3px",fontSize:"10px",fontWeight:"bold",marginRight:"8px"},timelineMeta:{fontSize:"12px",color:"#99aab5"},empty:{textAlign:"center",padding:"40px",color:"#99aab5"}};export{M as default};
