import{r as c,b as e}from"./react-core-9vc7GIjk.js";import{y as l}from"./ui-vendor-_iSLAufy.js";import{g as R}from"./index-C8QEFqrd.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./icons-vendor-NoxEirJf.js";import"./state-vendor-0vlBuk0v.js";const F=({serverId:m,onClose:v})=>{const[i,d]=c.useState([]),[h,k]=c.useState(!1),[r,E]=c.useState({name:"",channel_id:"",avatar_url:""}),[g,y]=c.useState([]),[$,W]=c.useState(!0),[_,p]=c.useState(null),[N,w]=c.useState([]),[S,b]=c.useState(null),s=R();c.useEffect(()=>{m&&(C(),B())},[m]);const C=async()=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/webhooks/server/${m}/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const n=await a.json();d(n.webhooks||[])}}catch(t){console.error("Error fetching webhooks:",t)}finally{W(!1)}},B=async()=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/servers/${m}/channels/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const n=await a.json();y(n.channels||[])}}catch(t){console.error("Error fetching channels:",t)}},T=async()=>{if(!r.name||!r.channel_id){l.error("âŒ Webhook adÄ± ve kanal seÃ§imi zorunludur");return}try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/webhooks/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:m,...r})});if(a.ok){const n=await a.json();d([...i,n.webhook]),E({name:"",channel_id:"",avatar_url:""}),k(!1),l.success("âœ… Webhook baÅŸarÄ±yla oluÅŸturuldu")}else l.error("âŒ Webhook oluÅŸturulamadÄ±")}catch(t){console.error("Error creating webhook:",t),l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},z=async(t,a)=>{try{const n=localStorage.getItem("access_token"),o=await fetch(`${s}/webhooks/${t}/update/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(o.ok){const u=await o.json();d(i.map(f=>f.id===t?u.webhook:f)),p(null),l.success("âœ… Webhook gÃ¼ncellendi")}else l.error("âŒ Webhook gÃ¼ncellenemedi")}catch(n){console.error("Error updating webhook:",n),l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},L=async t=>{if(window.confirm("Bu webhook'u silmek istediÄŸinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${s}/webhooks/${t}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(d(i.filter(o=>o.id!==t)),l.success("âœ… Webhook silindi")):l.error("âŒ Webhook silinemedi")}catch(a){console.error("Error deleting webhook:",a),l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},A=async t=>{try{const a=localStorage.getItem("access_token");(await fetch(`${s}/webhooks/${t}/test/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok?l.success("âœ… Test mesajÄ± gÃ¶nderildi"):l.error("âŒ Test mesajÄ± gÃ¶nderilemedi")}catch(a){console.error("Error testing webhook:",a),l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},j=async t=>{if(window.confirm("Webhook tokenini yenilemek istediÄŸinizden emin misiniz? Eski token geÃ§ersiz hale gelecek."))try{const a=localStorage.getItem("access_token"),n=await fetch(`${s}/webhooks/${t}/regenerate-token/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(n.ok){const o=await n.json();d(i.map(u=>u.id===t?{...u,token:o.token}:u)),l.success("âœ… Token yenilendi")}else l.error("âŒ Token yenilenemedi")}catch(a){console.error("Error regenerating token:",a),l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},O=async t=>{try{const a=localStorage.getItem("access_token"),n=await fetch(`${s}/webhooks/${t}/logs/`,{headers:{Authorization:`Bearer ${a}`}});if(n.ok){const o=await n.json();w(o.logs||[]),b(t)}}catch(a){console.error("Error fetching logs:",a),l.error("âŒ Loglar yÃ¼klenemedi")}},x=t=>{const a=`${s}/webhooks/${t.id}/${t.token}`;navigator.clipboard.writeText(a),l.success("âœ… Webhook URL kopyalandÄ±")};return $?e.createElement("div",{className:"webhooks-overlay"},e.createElement("div",{className:"webhooks-panel"},e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"Webhooklar yÃ¼kleniyor...")))):e.createElement("div",{className:"webhooks-overlay",onClick:v},e.createElement("div",{className:"webhooks-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"webhooks-header"},e.createElement("h2",null,"ğŸ”— Webhook YÃ¶netimi"),e.createElement("button",{className:"close-btn",onClick:v},"Ã—")),e.createElement("div",{className:"webhooks-content"},!h&&e.createElement("button",{className:"create-webhook-btn",onClick:()=>k(!0)},"â• Yeni Webhook OluÅŸtur"),h&&e.createElement("div",{className:"create-webhook-form"},e.createElement("h3",null,"Yeni Webhook"),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Webhook AdÄ± *"),e.createElement("input",{type:"text",placeholder:"Ã–rn: GitHub Bot",value:r.name,onChange:t=>E({...r,name:t.target.value})})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Kanal *"),e.createElement("select",{value:r.channel_id,onChange:t=>E({...r,channel_id:t.target.value})},e.createElement("option",{value:""},"Kanal seÃ§in..."),g.map(t=>e.createElement("option",{key:t.id,value:t.id},"#",t.name)))),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Avatar URL (Opsiyonel)"),e.createElement("input",{type:"text",placeholder:"https://example.com/avatar.png",value:r.avatar_url,onChange:t=>E({...r,avatar_url:t.target.value})})),e.createElement("div",{className:"form-actions"},e.createElement("button",{className:"cancel-btn",onClick:()=>k(!1)},"Ä°ptal"),e.createElement("button",{className:"submit-btn",onClick:T},"OluÅŸtur"))),i.length>0?e.createElement("div",{className:"webhooks-list"},i.map(t=>e.createElement("div",{key:t.id,className:"webhook-card"},_===t.id?e.createElement("div",{className:"edit-webhook-form"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"Webhook AdÄ±"),e.createElement("input",{type:"text",defaultValue:t.name,id:`edit-name-${t.id}`})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Kanal"),e.createElement("select",{defaultValue:t.channel_id,id:`edit-channel-${t.id}`},g.map(a=>e.createElement("option",{key:a.id,value:a.id},"#",a.name)))),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Avatar URL"),e.createElement("input",{type:"text",defaultValue:t.avatar_url||"",id:`edit-avatar-${t.id}`})),e.createElement("div",{className:"form-actions"},e.createElement("button",{className:"cancel-btn",onClick:()=>p(null)},"Ä°ptal"),e.createElement("button",{className:"submit-btn",onClick:()=>{const a=document.getElementById(`edit-name-${t.id}`).value,n=document.getElementById(`edit-channel-${t.id}`).value,o=document.getElementById(`edit-avatar-${t.id}`).value;z(t.id,{name:a,channel_id:n,avatar_url:o})}},"Kaydet"))):e.createElement(e.Fragment,null,e.createElement("div",{className:"webhook-info"},e.createElement("div",{className:"webhook-avatar"},t.avatar_url?e.createElement("img",{src:t.avatar_url,alt:t.name}):e.createElement("div",{className:"default-avatar"},"ğŸ”—")),e.createElement("div",{className:"webhook-details"},e.createElement("h4",null,t.name),e.createElement("p",null,"#",g.find(a=>a.id===t.channel_id)?.name||"Bilinmeyen Kanal"),e.createElement("span",{className:"webhook-id"},"ID: ",t.id))),e.createElement("div",{className:"webhook-url"},e.createElement("label",null,"Webhook URL:"),e.createElement("div",{className:"url-display"},e.createElement("code",null,`${s}/webhooks/${t.id}/${t.token}`),e.createElement("button",{className:"copy-btn",onClick:()=>x(t),title:"URL'yi kopyala"},"ğŸ“‹"))),e.createElement("div",{className:"webhook-actions"},e.createElement("button",{className:"action-btn test-btn",onClick:()=>A(t.id),title:"Test mesajÄ± gÃ¶nder"},"ğŸ§ª Test"),e.createElement("button",{className:"action-btn logs-btn",onClick:()=>O(t.id),title:"LoglarÄ± gÃ¶rÃ¼ntÃ¼le"},"ğŸ“Š Loglar"),e.createElement("button",{className:"action-btn edit-btn",onClick:()=>p(t.id),title:"DÃ¼zenle"},"âœï¸"),e.createElement("button",{className:"action-btn regenerate-btn",onClick:()=>j(t.id),title:"Token yenile"},"ğŸ”„"),e.createElement("button",{className:"action-btn delete-btn",onClick:()=>L(t.id),title:"Sil"},"ğŸ—‘ï¸")),e.createElement("div",{className:"webhook-stats"},e.createElement("div",{className:"stat"},e.createElement("span",{className:"stat-label"},"Toplam Ã‡aÄŸrÄ±:"),e.createElement("span",{className:"stat-value"},t.total_calls||0)),e.createElement("div",{className:"stat"},e.createElement("span",{className:"stat-label"},"BaÅŸarÄ±lÄ±:"),e.createElement("span",{className:"stat-value success"},t.successful_calls||0)),e.createElement("div",{className:"stat"},e.createElement("span",{className:"stat-label"},"BaÅŸarÄ±sÄ±z:"),e.createElement("span",{className:"stat-value error"},t.failed_calls||0)),e.createElement("div",{className:"stat"},e.createElement("span",{className:"stat-label"},"Son Ã‡aÄŸrÄ±:"),e.createElement("span",{className:"stat-value"},t.last_call?new Date(t.last_call).toLocaleString("tr-TR"):"HiÃ§"))))))):!h&&e.createElement("div",{className:"empty-state"},e.createElement("div",{className:"empty-icon"},"ğŸ”—"),e.createElement("h3",null,"HenÃ¼z webhook yok"),e.createElement("p",null,"DÄ±ÅŸ uygulamalardan mesaj gÃ¶ndermek iÃ§in webhook oluÅŸturun")),S&&e.createElement("div",{className:"logs-modal",onClick:()=>b(null)},e.createElement("div",{className:"logs-content",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"logs-header"},e.createElement("h3",null,"ğŸ“Š Webhook LoglarÄ±"),e.createElement("button",{className:"close-btn",onClick:()=>b(null)},"Ã—")),e.createElement("div",{className:"logs-list"},N.length>0?N.map((t,a)=>e.createElement("div",{key:a,className:`log-item ${t.status}`},e.createElement("div",{className:"log-time"},new Date(t.timestamp).toLocaleString("tr-TR")),e.createElement("div",{className:"log-status"},t.status==="success"?"âœ…":"âŒ"," ",t.status),e.createElement("div",{className:"log-message"},t.message),t.error&&e.createElement("div",{className:"log-error"},"Hata: ",t.error))):e.createElement("p",{className:"empty-state"},"HenÃ¼z log kaydÄ± yok")))))))};export{F as default};
