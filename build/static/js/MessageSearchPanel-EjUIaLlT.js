import{r as l,n as e}from"./react-core-Cj7FUMmY.js";import{h as o,a as A,Z as L,I as E,bx as b}from"./icons-vendor-TGltgKsJ.js";import{t as d}from"./index-DsN-N-A2.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const D=({serverId:p,channelId:g,onClose:u,onSelectMessage:f})=>{const[t,v]=l.useState(""),[c,y]=l.useState([]),[h,N]=l.useState(!1),[s,n]=l.useState({author:"",dateFrom:"",dateTo:"",hasAttachment:!1,hasLink:!1}),[m,F]=l.useState(!1),i=l.useRef(null);l.useEffect(()=>(t.length>=3&&(i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{k()},500)),()=>{i.current&&clearTimeout(i.current)}),[t,s]);const k=async()=>{if(!t.trim()){d.error("âŒ Arama terimi girin");return}N(!0);try{const a=new URLSearchParams({q:t,...p&&{server:p},...g&&{channel:g},...s.author&&{author:s.author},...s.dateFrom&&{date_from:s.dateFrom},...s.dateTo&&{date_to:s.dateTo},...s.hasAttachment&&{has_attachment:!0},...s.hasLink&&{has_link:!0}}),r=await fetch(`/api/messages/search/?${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(r.ok){const x=await r.json();y(x.results),x.results.length===0&&d.info("â„¹ï¸ SonuÃ§ bulunamadÄ±")}else d.error("âŒ Arama hatasÄ±")}catch{d.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{N(!1)}},C=(a,r)=>r?a.split(new RegExp(`(${r})`,"gi")).map((j,w)=>j.toLowerCase()===r.toLowerCase()?e.jsx("mark",{children:j},w):j):a,S=a=>new Date(a).toLocaleString("tr-TR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),T=a=>{f&&f(a),u()};return e.jsx("div",{className:"message-search-panel-overlay",onClick:u,children:e.jsxs("div",{className:"message-search-panel",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"search-header",children:[e.jsx(o,{className:"header-icon"}),e.jsx("h2",{children:"Mesaj Ara"}),e.jsx("button",{className:"close-btn",onClick:u,children:"Ã—"})]}),e.jsxs("div",{className:"search-input-container",children:[e.jsx(o,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Mesaj ara...",value:t,onChange:a=>v(a.target.value),onKeyPress:a=>a.key==="Enter"&&k(),autoFocus:!0}),t&&e.jsx("button",{className:"clear-btn",onClick:()=>v(""),children:e.jsx(A,{})}),e.jsx("button",{className:`filter-toggle-btn ${m?"active":""}`,onClick:()=>F(!m),title:"Filtreler",children:e.jsx(L,{})})]}),m&&e.jsxs("div",{className:"filters-section",children:[e.jsx("div",{className:"filter-row",children:e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(E,{})," KullanÄ±cÄ±"]}),e.jsx("input",{type:"text",placeholder:"@kullanÄ±cÄ±adÄ±",value:s.author,onChange:a=>n({...s,author:a.target.value})})]})}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(b,{})," BaÅŸlangÄ±Ã§"]}),e.jsx("input",{type:"date",value:s.dateFrom,onChange:a=>n({...s,dateFrom:a.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(b,{})," BitiÅŸ"]}),e.jsx("input",{type:"date",value:s.dateTo,onChange:a=>n({...s,dateTo:a.target.value})})]})]}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasAttachment,onChange:a=>n({...s,hasAttachment:a.target.checked})}),e.jsx("span",{children:"Ekli dosya iÃ§eren"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasLink,onChange:a=>n({...s,hasLink:a.target.checked})}),e.jsx("span",{children:"Link iÃ§eren"})]})]})]}),e.jsxs("div",{className:"search-results",children:[h&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"AranÄ±yor..."})]}),!h&&c.length===0&&t&&e.jsxs("div",{className:"empty-state",children:[e.jsx(o,{size:48}),e.jsx("h3",{children:"SonuÃ§ BulunamadÄ±"}),e.jsxs("p",{children:['"',t,'" iÃ§in mesaj bulunamadÄ±']})]}),!h&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"results-count",children:[c.length," sonuÃ§ bulundu"]}),e.jsx("div",{className:"results-list",children:c.map(a=>e.jsxs("div",{className:"result-item",onClick:()=>T(a),children:[e.jsxs("div",{className:"result-header",children:[e.jsx("img",{src:a.author.avatar||"/default-avatar.png",alt:a.author.username,className:"author-avatar"}),e.jsxs("div",{className:"author-info",children:[e.jsx("span",{className:"author-name",children:a.author.username}),e.jsx("span",{className:"message-date",children:S(a.created_at)})]}),a.channel&&e.jsxs("span",{className:"channel-tag",children:["#",a.channel.name]})]}),e.jsx("div",{className:"message-content",children:C(a.content,t)}),a.attachments&&a.attachments.length>0&&e.jsxs("div",{className:"message-attachments",children:["ğŸ“ ",a.attachments.length," dosya"]})]},a.id))})]}),!h&&!t&&e.jsxs("div",{className:"empty-state",children:[e.jsx(o,{size:48}),e.jsx("h3",{children:"Mesaj Ara"}),e.jsx("p",{children:"Sunucudaki tÃ¼m mesajlarÄ± arayÄ±n"}),e.jsxs("ul",{className:"search-tips",children:[e.jsx("li",{children:"En az 3 karakter girin"}),e.jsx("li",{children:"Filtreleri kullanarak sonuÃ§larÄ± daraltÄ±n"}),e.jsx("li",{children:"KullanÄ±cÄ±ya gÃ¶re filtreleyin"}),e.jsx("li",{children:"Tarih aralÄ±ÄŸÄ± belirleyin"})]})]})]})]})})};export{D as default};
