import{r as n,d as e,a9 as w,bt as A,bC as N,i as M,M as y,cP as S,A as h,z as $,cb as P,a5 as g,aB as b,cQ as _,cz as z,a6 as T,aE as U,bn as j}from"./react-core-CecKX_Gm.js";import{g as x}from"./apiEndpoints-DTuZVK56.js";const O=({userId:u,username:v,onClose:r,fetchWithAuth:E})=>{const[t,i]=n.useState(null),[k,d]=n.useState(!0),[l,m]=n.useState("overview"),p=n.useCallback(async()=>{d(!0);try{const a=await E(`${x()}/users/${u}/presence-insights/`);if(a.ok){const s=await a.json();i(s)}else i({user:{username:v||"User",status:"online",joined:"2024-03-15",timezone:"UTC+3"},activity_summary:{total_online_hours:847,messages_sent:12453,voice_hours:234,servers_active:8,reactions_given:3421},active_hours:Array(24).fill(0).map((s,C)=>({hour:C,activity:Math.random()*100})),weekly_pattern:[{day:"Mon",activity:65},{day:"Tue",activity:72},{day:"Wed",activity:80},{day:"Thu",activity:75},{day:"Fri",activity:90},{day:"Sat",activity:100},{day:"Sun",activity:85}],status_distribution:{online:45,idle:25,dnd:15,offline:15},top_activities:[{name:"Gaming",hours:156,icon:"gaming"},{name:"Music",hours:89,icon:"music"},{name:"Voice Chat",hours:234,icon:"voice"},{name:"Streaming",hours:45,icon:"stream"}],engagement_score:87,peak_time:{start:20,end:23},preferred_timezone:"Evening (8PM - 11PM)"})}catch(a){console.error("Error loading insights:",a),i(null)}d(!1)},[u,v,E]);n.useEffect(()=>{p()},[p]);const c=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a?.toString()||"0",o=a=>{switch(a){case"online":return"#10b981";case"idle":return"#f59e0b";case"dnd":return"#ef4444";default:return"#6b7280"}},f=a=>{switch(a){case"gaming":return e.createElement(b,null);case"music":return e.createElement(j,null);case"voice":return e.createElement(h,null);case"stream":return e.createElement(g,null);default:return e.createElement(U,null)}},F=()=>t?.active_hours?Math.max(...t.active_hours.map(a=>a.activity),1):1;return k?e.createElement("div",{className:"presence-insights-overlay",onClick:r},e.createElement("div",{className:"presence-insights-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"loading-state"},e.createElement(w,{className:"spin"}),e.createElement("span",null,"Analyzing activity patterns...")))):e.createElement("div",{className:"presence-insights-overlay",onClick:r},e.createElement("div",{className:"presence-insights-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"panel-header"},e.createElement("div",{className:"user-header"},e.createElement("div",{className:"user-avatar-large"},e.createElement("span",null,(t?.user?.username||"U").charAt(0).toUpperCase()),e.createElement("div",{className:"status-indicator",style:{backgroundColor:o(t?.user?.status)}})),e.createElement("div",{className:"user-info"},e.createElement("h2",null,t?.user?.username||"User"),e.createElement("div",{className:"user-meta"},e.createElement("span",null,e.createElement(A,null)," Joined ",t?.user?.joined||"N/A"),e.createElement("span",null,e.createElement(N,null)," ",t?.user?.timezone||"Unknown")))),e.createElement("div",{className:"engagement-score"},e.createElement("div",{className:"score-circle"},e.createElement("span",{className:"score-value"},t?.engagement_score||0)),e.createElement("span",{className:"score-label"},"Engagement")),e.createElement("button",{className:"close-btn",onClick:r},e.createElement(M,null))),e.createElement("div",{className:"stats-bar"},e.createElement("div",{className:"stat"},e.createElement(y,null),e.createElement("span",{className:"stat-value"},c(t?.activity_summary?.total_online_hours),"h"),e.createElement("span",{className:"stat-label"},"Online")),e.createElement("div",{className:"stat"},e.createElement(S,null),e.createElement("span",{className:"stat-value"},c(t?.activity_summary?.messages_sent)),e.createElement("span",{className:"stat-label"},"Messages")),e.createElement("div",{className:"stat"},e.createElement(h,null),e.createElement("span",{className:"stat-value"},c(t?.activity_summary?.voice_hours),"h"),e.createElement("span",{className:"stat-label"},"Voice")),e.createElement("div",{className:"stat"},e.createElement($,null),e.createElement("span",{className:"stat-value"},t?.activity_summary?.servers_active||0),e.createElement("span",{className:"stat-label"},"Servers")),e.createElement("div",{className:"stat"},e.createElement(P,null),e.createElement("span",{className:"stat-value"},c(t?.activity_summary?.reactions_given)),e.createElement("span",{className:"stat-label"},"Reactions"))),e.createElement("div",{className:"tabs"},e.createElement("button",{className:`tab ${l==="overview"?"active":""}`,onClick:()=>m("overview")},e.createElement(g,null)," Overview"),e.createElement("button",{className:`tab ${l==="schedule"?"active":""}`,onClick:()=>m("schedule")},e.createElement(y,null)," Activity Schedule"),e.createElement("button",{className:`tab ${l==="activities"?"active":""}`,onClick:()=>m("activities")},e.createElement(b,null)," Activities")),e.createElement("div",{className:"tab-content"},l==="overview"&&e.createElement("div",{className:"overview-tab"},e.createElement("div",{className:"peak-info"},e.createElement("div",{className:"peak-card"},e.createElement(_,{className:"peak-icon day"}),e.createElement("div",{className:"peak-content"},e.createElement("span",{className:"peak-label"},"Peak Activity Time"),e.createElement("span",{className:"peak-value"},t?.preferred_timezone)))),e.createElement("div",{className:"section"},e.createElement("h3",null,"Status Distribution"),e.createElement("div",{className:"status-bars"},Object.entries(t?.status_distribution||{}).map(([a,s])=>e.createElement("div",{key:a,className:"status-bar-item"},e.createElement("div",{className:"status-bar-header"},e.createElement("span",{className:"status-name",style:{color:o(a)}},a.toUpperCase()),e.createElement("span",{className:"status-percent"},s,"%")),e.createElement("div",{className:"status-bar-track"},e.createElement("div",{className:"status-bar-fill",style:{width:`${s}%`,backgroundColor:o(a)}})))))),e.createElement("div",{className:"section"},e.createElement("h3",null,"Weekly Activity Pattern"),e.createElement("div",{className:"weekly-chart"},(t?.weekly_pattern||[]).map((a,s)=>e.createElement("div",{key:s,className:"day-bar"},e.createElement("div",{className:"bar",style:{height:`${a.activity}%`}}),e.createElement("span",{className:"day-label"},a.day)))))),l==="schedule"&&e.createElement("div",{className:"schedule-tab"},e.createElement("div",{className:"section"},e.createElement("h3",null,e.createElement(z,null)," ",e.createElement(_,null)," 24-Hour Activity Pattern"),e.createElement("div",{className:"hourly-chart"},(t?.active_hours||[]).map((a,s)=>e.createElement("div",{key:s,className:"hour-column"},e.createElement("div",{className:`hour-bar ${s>=(t?.peak_time?.start||0)&&s<=(t?.peak_time?.end||23)?"peak":""}`,style:{height:`${Math.max(a.activity/F()*100,5)}%`},title:`${a.hour}:00 - Activity: ${Math.round(a.activity)}%`}),e.createElement("span",{className:"hour-num"},a.hour)))),e.createElement("div",{className:"chart-legend"},e.createElement("span",null,e.createElement("span",{className:"legend-dot peak"})," Peak hours"),e.createElement("span",null,e.createElement("span",{className:"legend-dot"})," Regular activity"))),e.createElement("div",{className:"timezone-note"},e.createElement(N,null),e.createElement("span",null,"Times shown in user's local timezone (",t?.user?.timezone,")"))),l==="activities"&&e.createElement("div",{className:"activities-tab"},e.createElement("div",{className:"section"},e.createElement("h3",null,e.createElement(T,null)," Top Activities"),e.createElement("div",{className:"activities-list"},(t?.top_activities||[]).map((a,s)=>e.createElement("div",{key:s,className:`activity-item rank-${s+1}`},e.createElement("span",{className:"activity-rank"},"#",s+1),e.createElement("div",{className:"activity-icon"},f(a.icon)),e.createElement("div",{className:"activity-info"},e.createElement("span",{className:"activity-name"},a.name),e.createElement("span",{className:"activity-hours"},a.hours," hours total")),e.createElement("div",{className:"activity-bar"},e.createElement("div",{className:"bar-fill",style:{width:`${a.hours/(t?.top_activities?.[0]?.hours||1)*100}%`}})))),(!t?.top_activities||t.top_activities.length===0)&&e.createElement("div",{className:"empty-state"},"No activity data available")))))))};export{O as default};
