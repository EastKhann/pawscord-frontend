import{r,d as e,z as te,i as ne,cV as ae,bx as re,by as le,V as oe,bD as se,U as ie,aa as ce,bA as pe,cW as ue,cX as de}from"./react-core-GQV1VuAT.js";const xe=({roomId:c,currentUser:s,websocket:o,onClose:W,initialVideoUrl:D="",participants:I=[]})=>{const a=r.useRef(null),[N,me]=r.useState(D),[S,d]=r.useState(!1),[g,b]=r.useState(0),[f,k]=r.useState(0),[j,h]=r.useState(1),[E,R]=r.useState(!1),[L,T]=r.useState(!1),[J,z]=r.useState(1),[p,ge]=r.useState(!1),[q,B]=r.useState([]),[y,_]=r.useState(""),[H,V]=r.useState("auto"),[F,A]=r.useState(!1),[fe,v]=r.useState("synced"),[Q,x]=r.useState({}),u=r.useRef(null),$=r.useCallback(()=>{a.current&&(a.current.play(),d(!0),p&&o&&o.send(JSON.stringify({type:"watch_party_control",action:"play",roomId:c,currentTime:a.current.currentTime,sender:s})))},[p,o,c,s]),K=r.useCallback(()=>{a.current&&(a.current.pause(),d(!1),p&&o&&o.send(JSON.stringify({type:"watch_party_control",action:"pause",roomId:c,currentTime:a.current.currentTime,sender:s})))},[p,o,c,s]),C=r.useCallback(t=>{a.current&&(a.current.currentTime=t,b(t),p&&o&&o.send(JSON.stringify({type:"watch_party_control",action:"seek",roomId:c,currentTime:t,sender:s})))},[p,o,c,s]),M=r.useCallback(t=>{if(!a.current)return;const i=Math.max(0,Math.min(f,g+t));C(i)},[g,f,C]),X=r.useCallback(t=>{a.current&&(a.current.volume=t,h(t),R(t===0))},[]),Y=r.useCallback(()=>{if(!a.current)return;const t=!E;a.current.muted=t,R(t),h(t?0:a.current.volume||.5)},[E]),G=r.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen?.(),T(!1)):(a.current?.requestFullscreen?.(),T(!0))},[]),Z=r.useCallback(t=>{a.current&&(a.current.playbackRate=t,z(t),p&&o&&o.send(JSON.stringify({type:"watch_party_control",action:"playback_rate",roomId:c,playbackRate:t,sender:s})))},[p,o,c,s]),w=r.useCallback(()=>{if(!y.trim()||!o)return;const t={type:"watch_party_chat",roomId:c,sender:s,message:y,timestamp:Date.now()};o.send(JSON.stringify(t)),B(i=>[...i,{...t,isOwn:!0}]),_(""),setTimeout(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},100)},[y,o,c,s]),U=r.useCallback(t=>{o&&(o.send(JSON.stringify({type:"watch_party_reaction",roomId:c,sender:s,emoji:t,timestamp:Date.now()})),x(i=>({...i,[s]:{emoji:t,timestamp:Date.now()}})),setTimeout(()=>{x(i=>{const l={...i};return delete l[s],l})},3e3))},[o,c,s]),ee=r.useCallback(()=>{o&&(v("syncing"),o.send(JSON.stringify({type:"watch_party_sync_request",roomId:c,sender:s})))},[o,c,s]);r.useEffect(()=>{if(!o)return;const t=i=>{try{const l=JSON.parse(i.data);if(l.type==="watch_party_control"&&l.sender!==s){switch(l.action){case"play":a.current.currentTime=l.currentTime,a.current.play(),d(!0);break;case"pause":a.current.currentTime=l.currentTime,a.current.pause(),d(!1);break;case"seek":a.current.currentTime=l.currentTime,b(l.currentTime);break;case"playback_rate":a.current.playbackRate=l.playbackRate,z(l.playbackRate);break}v("synced")}l.type==="watch_party_chat"&&l.sender!==s&&(B(m=>[...m,{...l,isOwn:!1}]),u.current&&(u.current.scrollTop=u.current.scrollHeight)),l.type==="watch_party_reaction"&&l.sender!==s&&(x(m=>({...m,[l.sender]:{emoji:l.emoji,timestamp:l.timestamp}})),setTimeout(()=>{x(m=>{const P={...m};return delete P[l.sender],P})},3e3)),l.type==="watch_party_sync_response"&&l.sender!==s&&(a.current.currentTime=l.currentTime,l.isPlaying?(a.current.play(),d(!0)):(a.current.pause(),d(!1)),v("synced"))}catch(l){console.error("Watch Party WS error:",l)}};return o.addEventListener("message",t),()=>o.removeEventListener("message",t)},[o,s]),r.useEffect(()=>{if(!a.current)return;const t=setInterval(()=>{a.current&&(b(a.current.currentTime),k(a.current.duration||0))},100);return()=>clearInterval(t)},[]);const O=t=>{if(!t||isNaN(t))return"0:00";const i=Math.floor(t/60),l=Math.floor(t%60);return`${i}:${l.toString().padStart(2,"0")}`};return e.createElement("div",{style:n.container},e.createElement("div",{style:n.header},e.createElement("div",{style:n.headerLeft},e.createElement(te,{size:18,color:"#5865f2"}),e.createElement("span",{style:n.title},"Watch Party"),e.createElement("span",{style:n.participantCount},I.length," watching")),e.createElement("button",{onClick:W,style:n.closeButton},e.createElement(ne,{size:20}))),e.createElement("div",{style:n.mainContent},e.createElement("div",{style:n.videoSection},e.createElement("div",{style:n.videoContainer},e.createElement("video",{ref:a,src:N,style:n.video,onLoadedMetadata:()=>k(a.current.duration)}),e.createElement("div",{style:n.reactionsOverlay},Object.entries(Q).map(([t,{emoji:i}])=>e.createElement("div",{key:t,style:n.reaction},e.createElement("span",{style:n.reactionEmoji},i),e.createElement("span",{style:n.reactionUser},t)))),e.createElement("div",{style:n.controlsOverlay},e.createElement("div",{style:n.progressBarContainer},e.createElement("input",{type:"range",min:"0",max:f||100,value:g,onChange:t=>C(parseFloat(t.target.value)),style:n.progressBar,disabled:!p}),e.createElement("div",{style:n.timeDisplay},e.createElement("span",null,O(g)),e.createElement("span",null,O(f)))),e.createElement("div",{style:n.controls},e.createElement("div",{style:n.controlsLeft},p&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>M(-10),style:n.controlButton},e.createElement(ae,{size:16})),e.createElement("button",{onClick:S?K:$,style:n.controlButton},S?e.createElement(re,{size:20}):e.createElement(le,{size:20})),e.createElement("button",{onClick:()=>M(10),style:n.controlButton},e.createElement(oe,{size:16}))),e.createElement("button",{onClick:Y,style:n.controlButton},E?e.createElement(se,{size:18}):e.createElement(ie,{size:18})),e.createElement("input",{type:"range",min:"0",max:"1",step:"0.1",value:j,onChange:t=>X(parseFloat(t.target.value)),style:n.volumeSlider})),e.createElement("div",{style:n.controlsRight},!p&&e.createElement("button",{onClick:ee,style:n.syncButton},e.createElement(ce,{size:16}),e.createElement("span",null,"Sync")),e.createElement("button",{onClick:()=>A(!F),style:n.controlButton},e.createElement(pe,{size:18})),e.createElement("button",{onClick:G,style:n.controlButton},L?e.createElement(ue,{size:18}):e.createElement(de,{size:18})))))),e.createElement("div",{style:n.quickReactions},["ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ”¥","ðŸ˜®","ðŸ˜¢"].map(t=>e.createElement("button",{key:t,onClick:()=>U(t),style:n.reactionButton},t)))),e.createElement("div",{style:n.chatSection},e.createElement("div",{style:n.chatHeader},e.createElement("span",null,"Live Chat")),e.createElement("div",{ref:u,style:n.chatMessages},q.map((t,i)=>e.createElement("div",{key:i,style:t.isOwn?n.ownMessage:n.otherMessage},e.createElement("span",{style:n.messageSender},t.sender,":"),e.createElement("span",{style:n.messageText},t.message)))),e.createElement("div",{style:n.chatInput},e.createElement("input",{type:"text",value:y,onChange:t=>_(t.target.value),onKeyPress:t=>t.key==="Enter"&&w(),placeholder:"Type a message...",style:n.chatInputField}),e.createElement("button",{onClick:w,style:n.sendButton},"Send")))),F&&e.createElement("div",{style:n.settingsPanel},e.createElement("h3",{style:n.settingsTitle},"Settings"),e.createElement("div",{style:n.settingItem},e.createElement("label",null,"Playback Speed"),e.createElement("select",{value:J,onChange:t=>Z(parseFloat(t.target.value)),style:n.select,disabled:!p},e.createElement("option",{value:"0.5"},"0.5x"),e.createElement("option",{value:"0.75"},"0.75x"),e.createElement("option",{value:"1"},"1x"),e.createElement("option",{value:"1.25"},"1.25x"),e.createElement("option",{value:"1.5"},"1.5x"),e.createElement("option",{value:"2"},"2x"))),e.createElement("div",{style:n.settingItem},e.createElement("label",null,"Quality"),e.createElement("select",{value:H,onChange:t=>V(t.target.value),style:n.select},e.createElement("option",{value:"auto"},"Auto"),e.createElement("option",{value:"1080p"},"1080p"),e.createElement("option",{value:"720p"},"720p"),e.createElement("option",{value:"480p"},"480p"),e.createElement("option",{value:"360p"},"360p")))))},n={container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#1e1f22",zIndex:9999,display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",backgroundColor:"#2b2d31",borderBottom:"1px solid rgba(255,255,255,0.1)"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},title:{fontSize:"18px",fontWeight:"bold",color:"#ffffff"},participantCount:{fontSize:"13px",color:"#b9bbbe",backgroundColor:"rgba(88, 101, 242, 0.15)",padding:"4px 8px",borderRadius:"12px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"8px",borderRadius:"4px",transition:"all 0.2s"},mainContent:{display:"flex",flex:1,overflow:"hidden"},videoSection:{flex:1,display:"flex",flexDirection:"column",backgroundColor:"#000"},videoContainer:{position:"relative",flex:1,display:"flex",alignItems:"center",justifyContent:"center"},video:{width:"100%",height:"100%",objectFit:"contain"},reactionsOverlay:{position:"absolute",top:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"8px",pointerEvents:"none"},reaction:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"rgba(0,0,0,0.7)",padding:"8px 12px",borderRadius:"20px",animation:"slideIn 0.3s ease-out"},reactionEmoji:{fontSize:"24px"},reactionUser:{color:"#fff",fontSize:"12px"},controlsOverlay:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.8))",padding:"20px",opacity:1,transition:"opacity 0.3s"},progressBarContainer:{marginBottom:"16px"},progressBar:{width:"100%",height:"4px",borderRadius:"2px",appearance:"none",backgroundColor:"rgba(255,255,255,0.2)",outline:"none",cursor:"pointer"},timeDisplay:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"12px",color:"#fff"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between"},controlsLeft:{display:"flex",alignItems:"center",gap:"12px"},controlsRight:{display:"flex",alignItems:"center",gap:"12px"},controlButton:{background:"none",border:"none",color:"#fff",cursor:"pointer",padding:"8px",borderRadius:"4px",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},syncButton:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(88, 101, 242, 0.8)",border:"none",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"12px",fontWeight:"500"},volumeSlider:{width:"80px",height:"4px"},quickReactions:{display:"flex",gap:"8px",padding:"12px 20px",backgroundColor:"#2b2d31",borderTop:"1px solid rgba(255,255,255,0.1)",justifyContent:"center"},reactionButton:{background:"rgba(255,255,255,0.05)",border:"none",fontSize:"24px",padding:"8px 16px",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},chatSection:{width:"350px",backgroundColor:"#2b2d31",borderLeft:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",fontWeight:"bold",color:"#fff"},chatMessages:{flex:1,overflowY:"auto",padding:"12px"},ownMessage:{backgroundColor:"rgba(88, 101, 242, 0.15)",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",wordWrap:"break-word"},otherMessage:{backgroundColor:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",wordWrap:"break-word"},messageSender:{fontWeight:"bold",color:"#5865f2",marginRight:"6px",fontSize:"13px"},messageText:{color:"#dcddde",fontSize:"13px"},chatInput:{display:"flex",gap:"8px",padding:"12px",borderTop:"1px solid rgba(255,255,255,0.1)"},chatInputField:{flex:1,backgroundColor:"#383a40",border:"none",borderRadius:"4px",padding:"10px 12px",color:"#fff",fontSize:"14px",outline:"none"},sendButton:{backgroundColor:"#5865f2",border:"none",color:"#fff",padding:"10px 20px",borderRadius:"4px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},settingsPanel:{position:"absolute",bottom:"80px",right:"20px",backgroundColor:"#2b2d31",borderRadius:"8px",padding:"16px",minWidth:"200px",boxShadow:"0 8px 16px rgba(0,0,0,0.3)"},settingsTitle:{color:"#fff",fontSize:"14px",fontWeight:"bold",marginBottom:"12px"},settingItem:{marginBottom:"12px"},select:{width:"100%",backgroundColor:"#383a40",border:"none",color:"#fff",padding:"8px",borderRadius:"4px",fontSize:"13px",marginTop:"4px"}};export{xe as default};
