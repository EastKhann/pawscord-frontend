import{r as a,b as e}from"./react-core-9vc7GIjk.js";import{f as F,a as T,a3 as L,aZ as D,o as I,w as j,az as H,H as N}from"./icons-vendor-NoxEirJf.js";import{t as l}from"./index-DR3ngHaW.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const q=({fetchWithAuth:s,apiBaseUrl:i,onClose:v,roomSlug:d})=>{const[u,E]=a.useState([]),[b,k]=a.useState([]),[w,x]=a.useState(!1),[g,p]=a.useState(!1),[m,C]=a.useState(null),[n,c]=a.useState({name:"",url:"",events:[]}),S=["message.created","message.updated","message.deleted","member.joined","member.left","member.updated","channel.created","channel.updated","channel.deleted","role.created","role.updated","role.deleted"];a.useEffect(()=>{f()},[d]);const f=async()=>{x(!0);try{const r=await(await s(`${i}/rooms/${d}/webhooks/`)).json();E(r.webhooks||[])}catch{l.error("Failed to load webhooks")}finally{x(!1)}},h=async o=>{try{const y=await(await s(`${i}/webhooks/${o}/deliveries/`)).json();k(y.deliveries||[]),C(o)}catch{l.error("Failed to load delivery logs")}},B=async()=>{if(!n.name||!n.url){l.error("Name and URL are required");return}try{await s(`${i}/webhooks/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,room_slug:d})}),l.success("Webhook created successfully"),p(!1),c({name:"",url:"",events:[]}),f()}catch{l.error("Failed to create webhook")}},R=async o=>{if(confirm("Are you sure you want to delete this webhook?"))try{await s(`${i}/webhooks/${o}/delete/`,{method:"DELETE"}),l.success("Webhook deleted successfully"),f()}catch{l.error("Failed to delete webhook")}},W=async o=>{try{await s(`${i}/webhook/deliveries/retry/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({delivery_id:o})}),l.success("Delivery retried successfully"),m&&h(m)}catch{l.error("Failed to retry delivery")}},z=o=>{c(r=>({...r,events:r.events.includes(o)?r.events.filter(y=>y!==o):[...r.events,o]}))};return e.createElement("div",{style:t.overlay},e.createElement("div",{style:t.modal},e.createElement("div",{style:t.header},e.createElement("div",{style:t.headerLeft},e.createElement(F,{style:{marginRight:"10px",color:"#5865f2"}}),e.createElement("h2",{style:t.title},"Channel Webhooks")),e.createElement("button",{onClick:v,style:t.closeButton},e.createElement(T,null))),e.createElement("div",{style:t.content},w?e.createElement("div",{style:t.loading},"Loading webhooks..."):e.createElement(e.Fragment,null,e.createElement("div",{style:t.section},e.createElement("div",{style:t.sectionHeader},e.createElement("h3",{style:t.sectionTitle},"Webhooks"),e.createElement("button",{onClick:()=>p(!g),style:t.addButton},e.createElement(L,{style:{marginRight:"5px"}}),"Create Webhook")),g&&e.createElement("div",{style:t.createForm},e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Webhook Name"),e.createElement("input",{type:"text",value:n.name,onChange:o=>c({...n,name:o.target.value}),placeholder:"My Webhook",style:t.input})),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Payload URL"),e.createElement("input",{type:"url",value:n.url,onChange:o=>c({...n,url:o.target.value}),placeholder:"https://example.com/webhook",style:t.input})),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Events to Subscribe"),e.createElement("div",{style:t.eventsGrid},S.map(o=>e.createElement("label",{key:o,style:t.eventCheckbox},e.createElement("input",{type:"checkbox",checked:n.events.includes(o),onChange:()=>z(o)}),e.createElement("span",{style:t.eventLabel},o))))),e.createElement("div",{style:t.formActions},e.createElement("button",{onClick:B,style:t.createButton},"Create Webhook"),e.createElement("button",{onClick:()=>p(!1),style:t.cancelButton},"Cancel"))),e.createElement("div",{style:t.webhooksList},u.length===0?e.createElement("div",{style:t.empty},"No webhooks configured for this channel"):u.map(o=>e.createElement("div",{key:o.id,style:t.webhookCard},e.createElement("div",{style:t.webhookHeader},e.createElement("div",null,e.createElement("div",{style:t.webhookName},o.name),e.createElement("div",{style:t.webhookUrl},o.url),e.createElement("div",{style:t.webhookEvents},o.events?.join(", ")||"All events")),e.createElement("div",{style:t.webhookActions},e.createElement("button",{onClick:()=>h(o.id),style:t.iconButton,title:"View Deliveries"},e.createElement(D,null)),e.createElement("button",{onClick:()=>R(o.id),style:{...t.iconButton,color:"#f04747"},title:"Delete Webhook"},e.createElement(I,null)))))))),m&&e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Recent Deliveries"),e.createElement("div",{style:t.deliveriesList},b.length===0?e.createElement("div",{style:t.empty},"No deliveries yet"):b.map(o=>e.createElement("div",{key:o.id,style:t.deliveryCard},e.createElement("div",{style:t.deliveryHeader},e.createElement("div",{style:t.deliveryStatus},o.status==="success"?e.createElement(j,{style:{color:"#43b581"}}):e.createElement(H,{style:{color:"#f04747"}}),e.createElement("span",{style:t.deliveryStatusText},o.status==="success"?"Success":"Failed")),e.createElement("div",{style:t.deliveryTime},new Date(o.delivered_at).toLocaleString())),e.createElement("div",{style:t.deliveryBody},e.createElement("div",{style:t.deliveryInfo},e.createElement("strong",null,"Event:")," ",o.event_type),e.createElement("div",{style:t.deliveryInfo},e.createElement("strong",null,"Response Code:")," ",o.response_code||"N/A"),o.error&&e.createElement("div",{style:t.deliveryError},e.createElement("strong",null,"Error:")," ",o.error)),o.status==="failed"&&e.createElement("button",{onClick:()=>W(o.id),style:t.retryButton},e.createElement(N,{style:{marginRight:"5px"}}),"Retry")))))))))},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},section:{marginBottom:"24px"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},sectionTitle:{margin:0,fontSize:"16px",color:"#ffffff",fontWeight:"600"},addButton:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center"},createForm:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"20px",marginBottom:"16px"},formGroup:{marginBottom:"16px"},label:{display:"block",color:"#dcddde",fontSize:"14px",marginBottom:"8px",fontWeight:"500"},input:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},eventsGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},eventCheckbox:{display:"flex",alignItems:"center",gap:"8px",color:"#dcddde",fontSize:"14px",cursor:"pointer"},eventLabel:{userSelect:"none"},formActions:{display:"flex",gap:"10px",justifyContent:"flex-end"},createButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},cancelButton:{padding:"10px 20px",backgroundColor:"#4f545c",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px"},webhooksList:{display:"flex",flexDirection:"column",gap:"12px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},webhookCard:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px"},webhookHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},webhookName:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},webhookUrl:{fontSize:"13px",color:"#5865f2",marginBottom:"4px",wordBreak:"break-all"},webhookEvents:{fontSize:"12px",color:"#99aab5"},webhookActions:{display:"flex",gap:"8px"},iconButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"16px",padding:"5px"},deliveriesList:{display:"flex",flexDirection:"column",gap:"12px",maxHeight:"300px",overflowY:"auto"},deliveryCard:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px"},deliveryHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},deliveryStatus:{display:"flex",alignItems:"center",gap:"8px"},deliveryStatusText:{fontSize:"14px",fontWeight:"600",color:"#ffffff"},deliveryTime:{fontSize:"12px",color:"#99aab5"},deliveryBody:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"13px",color:"#dcddde"},deliveryInfo:{display:"flex",gap:"8px"},deliveryError:{color:"#f04747",marginTop:"4px"},retryButton:{marginTop:"12px",padding:"6px 12px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center"}};export{q as default};
