{"version":3,"file":"VoiceAudioController-BynloBmG.js","sources":["../../../src/VoiceAudioController.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport logger from './utils/logger';\r\nimport toast from './utils/toast';\r\n\r\nconst VoiceAudioController = ({ remoteStreams, remoteVolumes, mutedUsers }) => {\r\n    const [globalAudioEnabled, setGlobalAudioEnabled] = useState(() => {\r\n        const saved = localStorage.getItem('pawscord_audio_enabled');\r\n        return saved === 'true';\r\n    });\r\n\r\n    const enableAudioContext = useCallback(() => {\r\n        try {\r\n            const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n            const audioContext = new AudioContext();\r\n\r\n            if (audioContext.state === 'suspended') {\r\n                audioContext.resume().then(() => {\r\n                    logger.audio('AudioContext resumed successfully');\r\n                });\r\n            }\r\n\r\n            setGlobalAudioEnabled(true);\r\n            localStorage.setItem('pawscord_audio_enabled', 'true');\r\n            logger.audio('Global audio enabled');\r\n        } catch (err) {\r\n            logger.error('Failed to enable AudioContext:', err);\r\n            toast.error('âŒ Ses sistemi baÅŸlatÄ±lamadÄ±: ' + err.message);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        logger.audio(\"VoiceAudioController MOUNTED! RemoteStreams:\", Object.keys(remoteStreams));\r\n        return () => logger.audio(\"VoiceAudioController UNMOUNTED!\");\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {/* Ses baÅŸlatma butonu - sadece ilk kez gerekli */}\r\n            {!globalAudioEnabled && Object.keys(remoteStreams).length > 0 && (\r\n                <div style={{\r\n                    position: 'fixed',\r\n                    top: '50%',\r\n                    left: '50%',\r\n                    transform: 'translate(-50%, -50%)',\r\n                    zIndex: 999999,\r\n                    backgroundColor: 'rgba(0,0,0,0.9)',\r\n                    padding: '20px',\r\n                    borderRadius: '8px',\r\n                    boxShadow: '0 4px 20px rgba(0,0,0,0.5)'\r\n                }}>\r\n                    <button\r\n                        onClick={enableAudioContext}\r\n                        style={{\r\n                            padding: '12px 24px',\r\n                            backgroundColor: '#ff4757',\r\n                            color: 'white',\r\n                            fontWeight: 'bold',\r\n                            border: 'none',\r\n                            cursor: 'pointer',\r\n                            borderRadius: '6px',\r\n                            fontSize: '16px',\r\n                            transition: 'all 0.2s',\r\n                            boxShadow: '0 4px 6px rgba(0,0,0,0.3)'\r\n                        }}\r\n                        onMouseOver={(e) => e.target.style.backgroundColor = '#ee5a6f'}\r\n                        onMouseOut={(e) => e.target.style.backgroundColor = '#ff4757'}\r\n                    >\r\n                        ðŸš¨ SES SÄ°STEMÄ°NÄ° BAÅžLAT ðŸš¨\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Ses oynatÄ±cÄ±larÄ± - gizli (sadece arka planda Ã§alÄ±ÅŸÄ±r) */}\r\n            <div style={{ display: 'none' }}>\r\n                {Object.entries(remoteStreams).map(([username, stream]) => (\r\n                    <AudioPlayer\r\n                        key={`${username}-${stream.id}-${stream.getAudioTracks().length}`}\r\n                        username={username}\r\n                        stream={stream}\r\n                        volume={remoteVolumes[username] !== undefined ? remoteVolumes[username] : 100}\r\n                        isMuted={mutedUsers ? mutedUsers.has(username) : false}\r\n                        globalEnabled={globalAudioEnabled}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\nconst AudioPlayer = ({ username, stream, volume, isMuted, globalEnabled }) => {\r\n    const audioRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (stream) {\r\n            const audioTracks = stream.getAudioTracks();\r\n            logger.log(`[AudioPlayer] ${username} has ${audioTracks.length} audio tracks`);\r\n        }\r\n    }, [stream, username]);\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio || !stream) return;\r\n\r\n        logger.log(`[AudioPlayer] Setting stream for ${username}`);\r\n        audio.srcObject = stream;\r\n        audio.muted = false;\r\n\r\n        const attemptPlay = async () => {\r\n            if (!globalEnabled) {\r\n                logger.log(`[AudioPlayer] Global audio not enabled yet for ${username}`);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const audioTracks = stream.getAudioTracks();\r\n                if (audioTracks.length === 0) {\r\n                    logger.warn(`[AudioPlayer] No audio tracks for ${username}`);\r\n                    return;\r\n                }\r\n\r\n                await audio.play();\r\n                logger.log(`âœ… [AudioPlayer] Successfully playing ${username}`);\r\n            } catch (err) {\r\n                logger.warn(`[AudioPlayer] Autoplay blocked for ${username}:`, err);\r\n            }\r\n        };\r\n\r\n        attemptPlay();\r\n    }, [stream, username, globalEnabled]);\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n\r\n        const targetVolume = isMuted ? 0 : (volume / 100);\r\n        audio.volume = Math.max(0, Math.min(1, targetVolume));\r\n        logger.log(`[AudioPlayer] ${username} volume set to ${Math.round(targetVolume * 100)}%`);\r\n    }, [volume, isMuted, username]);\r\n\r\n    return (\r\n        <audio\r\n            ref={audioRef}\r\n            autoPlay\r\n            playsInline\r\n            style={{ display: 'none' }}\r\n        />\r\n    );\r\n};\r\n\r\nexport default React.memo(VoiceAudioController);\r\n\r\n\r\n\r\n"],"names":["useState","useCallback","useEffect","jsxs","Fragment","jsx","useRef"],"mappings":"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"}