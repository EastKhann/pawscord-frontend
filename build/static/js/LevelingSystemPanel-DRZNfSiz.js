import{r as i,d as a,c9 as s}from"./react-core-DrOm_csO.js";import{g as K}from"./index-DmEhdEtw.js";const D=({serverId:r,onClose:p})=>{const[l,c]=i.useState({enabled:!1,xp_per_message:15,xp_cooldown:60,level_up_message:"Tebrikler {user}! {level} seviyeye ulaÅŸtÄ±n! ğŸ‰",announce_channel_id:"",stack_roles:!1,reset_on_leave:!1}),[v,u]=i.useState([]),[m,g]=i.useState({level:1,role_id:""}),[y,k]=i.useState([]),[N,_]=i.useState([]),[E,S]=i.useState([]),[$,w]=i.useState(!0),o=K();i.useEffect(()=>{r&&(C(),x(),z(),P(),f())},[r]);const C=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/leveling/server/${r}/config/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();c(n.config||l)}}catch(e){console.error("Error fetching config:",e)}finally{w(!1)}},x=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/leveling/server/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();u(n.level_roles||[])}}catch(e){console.error("Error fetching level roles:",e)}},z=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/servers/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();k(n.roles||[])}}catch(e){console.error("Error fetching roles:",e)}},P=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/servers/${r}/channels/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();_(n.channels||[])}}catch(e){console.error("Error fetching channels:",e)}},f=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/leveling/server/${r}/leaderboard/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();S(n.leaderboard||[])}}catch(e){console.error("Error fetching leaderboard:",e)}},R=async()=>{try{const e=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(l)})).ok?s.success("âœ… Ayarlar kaydedildi"):s.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch(e){console.error("Error saving config:",e),s.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}},A=async()=>{if(!m.role_id||m.level<1){s.error("âŒ Rol ve seviye zorunludur");return}try{const e=localStorage.getItem("access_token"),t=await fetch(`${o}/leveling/server/${r}/roles/add/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(t.ok){const n=await t.json();u([...v,n.level_role]),g({level:1,role_id:""}),s.success("âœ… Seviye rolÃ¼ eklendi")}}catch(e){console.error("Error adding level role:",e),s.error("âŒ Ekleme baÅŸarÄ±sÄ±z")}},L=async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/roles/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok&&(u(v.filter(d=>d.id!==e)),s.success("âœ… Seviye rolÃ¼ kaldÄ±rÄ±ldÄ±"))}catch(t){console.error("Error removing level role:",t),s.error("âŒ KaldÄ±rma baÅŸarÄ±sÄ±z")}},B=async e=>{if(window.confirm("Bu kullanÄ±cÄ±nÄ±n XP'sini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?"))try{const t=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/user/${e}/reset/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&(s.success("âœ… XP sÄ±fÄ±rlandÄ±"),f())}catch(t){console.error("Error resetting XP:",t),s.error("âŒ SÄ±fÄ±rlama baÅŸarÄ±sÄ±z")}},X=e=>e===1?"#fbbf24":e===2?"#c0c0c0":e===3?"#cd7f32":"#6366f1",j=e=>{const d=100-e,h=Math.floor((-50+Math.sqrt(2500-20*d))/10);return Math.max(1,h)},b=e=>5*e**2+50*e+100;return $?a.createElement("div",{className:"leveling-overlay"},a.createElement("div",{className:"leveling-panel"},a.createElement("div",{className:"loading-state"},a.createElement("div",{className:"spinner"}),a.createElement("p",null,"Seviye sistemi yÃ¼kleniyor...")))):a.createElement("div",{className:"leveling-overlay",onClick:p},a.createElement("div",{className:"leveling-panel",onClick:e=>e.stopPropagation()},a.createElement("div",{className:"leveling-header"},a.createElement("h2",null,"â­ Seviye Sistemi"),a.createElement("button",{className:"close-btn",onClick:p},"Ã—")),a.createElement("div",{className:"leveling-content"},a.createElement("div",{className:"config-section"},a.createElement("div",{className:"section-header"},a.createElement("h3",null,"âš™ï¸ Genel Ayarlar"),a.createElement("label",{className:"toggle-switch"},a.createElement("input",{type:"checkbox",checked:l.enabled,onChange:e=>c({...l,enabled:e.target.checked})}),a.createElement("span",{className:"slider"}),a.createElement("span",{className:"toggle-label"},l.enabled?"Aktif":"Pasif"))),a.createElement("div",{className:"form-grid"},a.createElement("div",{className:"form-group"},a.createElement("label",null,"Mesaj BaÅŸÄ±na XP"),a.createElement("input",{type:"number",min:"1",max:"100",value:l.xp_per_message,onChange:e=>c({...l,xp_per_message:parseInt(e.target.value)}),disabled:!l.enabled})),a.createElement("div",{className:"form-group"},a.createElement("label",null,"XP Cooldown (saniye)"),a.createElement("input",{type:"number",min:"0",max:"300",value:l.xp_cooldown,onChange:e=>c({...l,xp_cooldown:parseInt(e.target.value)}),disabled:!l.enabled})),a.createElement("div",{className:"form-group full-width"},a.createElement("label",null,"Duyuru KanalÄ±"),a.createElement("select",{value:l.announce_channel_id,onChange:e=>c({...l,announce_channel_id:e.target.value}),disabled:!l.enabled},a.createElement("option",{value:""},"SeÃ§iniz (opsiyonel)"),N.map(e=>a.createElement("option",{key:e.id,value:e.id},"#",e.name)))),a.createElement("div",{className:"form-group full-width"},a.createElement("label",null,"Seviye Atlama MesajÄ±"),a.createElement("textarea",{value:l.level_up_message,onChange:e=>c({...l,level_up_message:e.target.value}),disabled:!l.enabled,rows:"2"}),a.createElement("span",{className:"hint"},"KullanÄ±labilir: ","{user}",", ","{level}")),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"checkbox-label"},a.createElement("input",{type:"checkbox",checked:l.stack_roles,onChange:e=>c({...l,stack_roles:e.target.checked}),disabled:!l.enabled}),a.createElement("span",null,"Rolleri biriktir (Ã¶nceki seviye rollerini kaldÄ±rma)"))),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"checkbox-label"},a.createElement("input",{type:"checkbox",checked:l.reset_on_leave,onChange:e=>c({...l,reset_on_leave:e.target.checked}),disabled:!l.enabled}),a.createElement("span",null,"Sunucudan ayrÄ±lÄ±nca XP'yi sÄ±fÄ±rla")))),a.createElement("button",{className:"save-btn",onClick:R},"ğŸ’¾ AyarlarÄ± Kaydet")),a.createElement("div",{className:"level-roles-section"},a.createElement("h3",null,"ğŸ­ Seviye Rolleri"),a.createElement("div",{className:"add-role-form"},a.createElement("input",{type:"number",placeholder:"Seviye",min:"1",value:m.level,onChange:e=>g({...m,level:parseInt(e.target.value)})}),a.createElement("select",{value:m.role_id,onChange:e=>g({...m,role_id:e.target.value})},a.createElement("option",{value:""},"Rol seÃ§in"),y.map(e=>a.createElement("option",{key:e.id,value:e.id},e.name))),a.createElement("button",{className:"add-btn",onClick:A},"â• Ekle")),a.createElement("div",{className:"level-roles-list"},v.length===0?a.createElement("div",{className:"empty-state"},a.createElement("span",null,"HenÃ¼z seviye rolÃ¼ eklenmedi")):v.sort((e,t)=>e.level-t.level).map(e=>a.createElement("div",{key:e.id,className:"level-role-item"},a.createElement("div",{className:"level-badge"},"Lv ",e.level),a.createElement("span",{className:"role-name"},e.role_name||`Role #${e.role_id}`),a.createElement("button",{className:"remove-btn",onClick:()=>L(e.id)},"Ã—"))))),a.createElement("div",{className:"leaderboard-section"},a.createElement("h3",null,"ğŸ† SÄ±ralama"),a.createElement("div",{className:"leaderboard-list"},E.length===0?a.createElement("div",{className:"empty-state"},a.createElement("span",null,"HenÃ¼z seviye kazanan Ã¼ye yok")):E.map((e,t)=>{const n=j(e.xp),d=b(n),h=b(n+1),T=(e.xp-d)/(h-d)*100;return a.createElement("div",{key:e.user_id,className:"leaderboard-item"},a.createElement("div",{className:"rank-badge",style:{background:X(t+1)}},"#",t+1),a.createElement("div",{className:"user-avatar"},e.avatar?a.createElement("img",{src:e.avatar,alt:e.username}):a.createElement("span",null,e.username[0])),a.createElement("div",{className:"user-info"},a.createElement("div",{className:"user-name"},e.username),a.createElement("div",{className:"level-progress"},a.createElement("div",{className:"progress-bar"},a.createElement("div",{className:"progress-fill",style:{width:`${T}%`}})),a.createElement("span",{className:"level-text"},"Level ",n," â€¢ ",e.xp," XP"))),a.createElement("button",{className:"reset-btn",onClick:()=>B(e.user_id)},"ğŸ”„"))}))))))};export{D as default};
