import{r as n,b as e}from"./react-core-9vc7GIjk.js";import{b as F,L as I}from"./router-vendor-u6fxj6P4.js";import"./grammarQuestions-BDmFtbiy.js";import{A as w,u as N}from"./index-BgtTyGBp.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./crypto-vendor-C1qXRpJv.js";import"./icons-vendor-BHKL7tCa.js";import"./state-vendor-0vlBuk0v.js";const A=`${w}/auth/token/refresh/`,G=`${w}/eng-learn/words/`,M=`${w}/eng-learn/known-words/`,$=`${w}/eng-learn/mark-known/`;IS_PRODUCTION;IS_PRODUCTION||`${MY_LOCAL_IP}${DJANGO_PORT}`;const U=()=>localStorage.getItem("access_token");function te(){const[c,L]=n.useState({}),[g,k]=n.useState({}),[v,z]=n.useState([]),[a,C]=n.useState(""),[d,B]=n.useState(null),[W,T]=n.useState(!1),[E,D]=n.useState(!0),[_,P]=n.useState(null),[h,R]=n.useState(!1),O=F();n.useRef(null);const x=n.useCallback(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),O("/")},[O]),y=n.useCallback(async(r,o={})=>{const s=async()=>{const u=U(),i=o.headers||{};return u&&(i.Authorization=`Bearer ${u}`),o.body instanceof FormData||(i["Content-Type"]="application/json"),fetch(r,{...o,headers:i})};let l=await s();if(l.status===401&&r!==A){console.warn("Token sÃ¼resi doldu, yenileniyor...");const u=localStorage.getItem("refresh_token");if(!u)throw x(),new Error("Oturum sÃ¼resi doldu, giriÅŸ yapÄ±n.");try{const i=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:u})}),K=await i.json();if(!i.ok)throw x(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",K.access),l=await s()}catch(i){throw x(),i}}return l},[x]);n.useEffect(()=>{(async()=>{try{const[o,s]=await Promise.all([y(G),y(M)]);if(!o.ok)throw o.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!s.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const l=await o.json(),u=await s.json(),i=Object.keys(l||{}).sort();L(l),k(u||{}),z(i),i.length>0&&C(i[0])}catch(o){P(o.message)}finally{D(!1)}})()},[y]);const f=n.useMemo(()=>{if(!a||!c[a])return[];const r=new Set(g[a]||[]);return c[a].filter(o=>!r.has(o.term))},[c,a,g]),p=n.useMemo(()=>{const r=c[a]?.length||0,o=g[a]?.length||0,s=r>0?o/r*100:0;return{totalWords:r,knownWords:o,progress:Math.round(s)}},[a,c,g]),m=n.useMemo(()=>{let r=0,o=0;Object.values(c).forEach(l=>{r+=l.length}),Object.values(g).forEach(l=>{o+=l.length});const s=r>0?o/r*100:0;return{totalWords:r,totalKnownWords:o,progress:Math.round(s)}},[c,g]),S=n.useCallback(()=>{if(T(!1),R(!1),f.length===0){B(null),a&&R(!0);return}const r=Math.floor(Math.random()*f.length);B(f[r])},[f,a]);n.useEffect(()=>{!E&&v.length>0&&S()},[a,E,v,f,S]);const j=n.useCallback(async()=>{if(!d)return;const{term:r}=d,o=a;try{const s=await y($,{method:"POST",body:JSON.stringify({level:o,word:r})});if(!s.ok)throw new Error("Kelime kaydedilemedi");const l=await s.json();k(l)}catch(s){console.error("Kelime kaydetme API hatasÄ±:",s)}},[d,a,y]),{globalData:b}=N();return n.useEffect(()=>{b?.type==="user_profile_update"&&(console.log("EnglishLearnPage: Global soketten gÃ¼ncelleme alÄ±ndÄ±."),b.user_data&&b.user_data.known_words&&k(b.user_data.known_words))},[b]),E?e.createElement("div",{style:t.pageContainer},"YÃ¼kleniyor..."):_?e.createElement("div",{style:t.pageContainer},e.createElement("h1",{style:t.errorText},"Hata: ",_),e.createElement(I,{to:"/",style:t.backButton},"Sohbete Geri DÃ¶n")):e.createElement("div",{style:t.pageContainer},e.createElement(I,{to:"/eng-learn",style:t.backButton},"â† Merkeze DÃ¶n"),e.createElement("div",{style:t.quizContainer},e.createElement("h1",{style:t.pageTitle},"Ä°ngilizce Kelime Ã–ÄŸren"),e.createElement("div",{style:t.levelAndProgressContainer},e.createElement("div",{style:t.controls},e.createElement("label",{htmlFor:"level-select",style:t.label},"Seviye:"),e.createElement("select",{id:"level-select",value:a,onChange:r=>C(r.target.value),style:t.select},v.map(r=>e.createElement("option",{key:r,value:r},r.toUpperCase()," (",c[r]?.length||0," kelime)")))),e.createElement("div",{style:t.progressStats},e.createElement("span",null,"BildiÄŸiniz: ",e.createElement("strong",null,p.knownWords)),e.createElement("span",null,"Toplam: ",e.createElement("strong",null,p.totalWords)))),e.createElement("div",{style:{...t.progressBarBackground,marginBottom:"20px"}},e.createElement("div",{style:{...t.progressBarFill,width:`${p.progress}%`}},p.progress>15&&e.createElement("span",null,p.progress,"%")),p.progress<=15&&e.createElement("span",{style:t.progressTextOutside},p.progress,"%")),e.createElement("div",null,e.createElement("h4",{style:t.totalStatsHeader},"Genel Toplam Ä°lerleme"),e.createElement("div",{style:{...t.progressStats,marginBottom:"8px"}},e.createElement("span",null,"Toplam BildiÄŸiniz: ",e.createElement("strong",null,m.totalKnownWords)),e.createElement("span",null,"Toplam Kelime: ",e.createElement("strong",null,m.totalWords))),e.createElement("div",{style:t.progressBarBackground},e.createElement("div",{style:{...t.progressBarFill,...t.totalProgressBarFill,width:`${m.progress}%`}},m.progress>15&&e.createElement("span",null,m.progress,"%")),m.progress<=15&&e.createElement("span",{style:t.progressTextOutside},m.progress,"%"))),e.createElement("div",{style:t.wordArea},h?e.createElement("h2",{style:{...t.term,color:"var(--text-positive)"}},"Tebrikler! ðŸŽ‰",e.createElement("br",null),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."):d?e.createElement(e.Fragment,null,e.createElement("h2",{style:t.term},d.term),W&&e.createElement("p",{style:t.meanings},d.meanings.join(" / "))):e.createElement("p",null,"Bu seviyede kelime bulunamadÄ±.")),e.createElement("div",{style:t.buttonGroup},e.createElement("button",{style:t.actionButton,onClick:()=>T(!0),disabled:W||!d||h},"CevabÄ± GÃ¶ster"),e.createElement("button",{style:{...t.actionButton,...t.knownButton},onClick:j,disabled:!d||h},"Biliyorum (GeÃ§)"),e.createElement("button",{style:{...t.actionButton,...t.primaryButton},onClick:S,disabled:h||f.length<=1},"Yeni Kelime"))))}const t={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};export{te as default};
