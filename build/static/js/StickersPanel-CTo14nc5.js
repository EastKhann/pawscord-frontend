var B=Object.defineProperty;var a=(l,r)=>B(l,"name",{value:r,configurable:!0});import{r as i,j as e}from"./react-core-Djgtqrmb.js";import{e as E}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const J=a(({serverId:l,onClose:r})=>{const[o,h]=i.useState([]),[x,P]=i.useState([]),[u,d]=i.useState(!0),[n,j]=i.useState("my-stickers"),[$,m]=i.useState(!1),[f,g]=i.useState(!1),[k,N]=i.useState(""),[p,v]=i.useState(null),[y,S]=i.useState("");i.useEffect(()=>{n==="my-stickers"?b():w()},[n,l]);const b=a(async()=>{try{d(!0);const s=localStorage.getItem("access_token"),t=await fetch(`/api/stickers/${l}/list/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const c=await t.json();h(c.stickers||[])}}catch{}finally{d(!1)}},"fetchStickers"),w=a(async()=>{try{d(!0);const s=localStorage.getItem("access_token"),t=await fetch("/api/stickers/packs/",{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const c=await t.json();P(c.packs||[])}}catch{}finally{d(!1)}},"fetchStickerPacks"),U=a(async()=>{if(!k.trim()||!p)return;const s=new FormData;s.append("name",k),s.append("sticker",p);try{g(!0);const t=localStorage.getItem("access_token"),c=await fetch(`/api/stickers/${l}/upload/`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(c.ok)m(!1),N(""),v(null),S(""),b();else{const C=await c.json()}}catch{}finally{g(!1)}},"uploadSticker"),F=a(async s=>{if(await E("Delete this sticker?"))try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok&&h(o.filter(C=>C.id!==s))}catch{}},"deleteSticker"),_=a(async s=>{try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/install-pack/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({pack_id:s})})).ok&&w()}catch{}},"installPack"),A=a(s=>{const t=s.target.files[0];t&&t.type.startsWith("image/")&&(t.size>512*1024||(v(t),S(URL.createObjectURL(t))))},"handleFileSelect");return e.jsx("div",{className:"stickers-panel-overlay",onClick:r,children:e.jsxs("div",{className:"stickers-panel-modal",onClick:a(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"stickers-panel-header",children:[e.jsx("h2",{children:"ðŸŽ¨ Stickers"}),e.jsx("button",{className:"close-btn",onClick:r,children:"âœ•"})]}),e.jsxs("div",{className:"stickers-tabs",children:[e.jsx("button",{className:`tab-btn ${n==="my-stickers"?"active":""}`,onClick:a(()=>j("my-stickers"),"onClick"),children:"ðŸ“ My Stickers"}),e.jsx("button",{className:`tab-btn ${n==="packs"?"active":""}`,onClick:a(()=>j("packs"),"onClick"),children:"ðŸ“¦ Sticker Packs"})]}),e.jsxs("div",{className:"stickers-panel-content",children:[n==="my-stickers"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sticker-actions",children:[e.jsx("button",{className:"upload-sticker-btn",onClick:a(()=>m(!0),"onClick"),children:"âž• Upload Sticker"}),e.jsxs("p",{className:"sticker-count",children:[o.length," stickers"]})]}),u?e.jsx("div",{className:"loading-spinner",children:"Loading stickers..."}):o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ¨"}),e.jsx("h3",{children:"No Stickers Yet"}),e.jsx("p",{children:"Upload your first custom sticker"})]}):e.jsx("div",{className:"stickers-grid",children:o.map(s=>e.jsxs("div",{className:"sticker-card",children:[e.jsx("img",{src:s.url,alt:s.name,className:"sticker-image"}),e.jsx("div",{className:"sticker-name",children:s.name}),e.jsx("button",{className:"delete-sticker-btn",onClick:a(()=>F(s.id),"onClick"),title:"Delete",children:"ðŸ—‘ï¸"})]},s.id))})]}),n==="packs"&&e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"loading-spinner",children:"Loading packs..."}):x.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“¦"}),e.jsx("h3",{children:"No Packs Available"}),e.jsx("p",{children:"Check back later for new sticker packs"})]}):e.jsx("div",{className:"packs-grid",children:x.map(s=>e.jsxs("div",{className:"pack-card",children:[e.jsx("div",{className:"pack-preview",children:s.preview_stickers?.slice(0,4).map((t,c)=>e.jsx("img",{src:t.url,alt:"",className:"pack-preview-img"},c))}),e.jsxs("div",{className:"pack-info",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{children:[s.sticker_count," stickers"]})]}),e.jsx("button",{className:`install-pack-btn ${s.installed?"installed":""}`,onClick:a(()=>!s.installed&&_(s.id),"onClick"),disabled:s.installed,children:s.installed?"âœ“ Installed":"âž• Install"})]},s.id))})})]}),$&&e.jsx("div",{className:"upload-modal-overlay",onClick:a(()=>m(!1),"onClick"),children:e.jsxs("div",{className:"upload-modal",onClick:a(s=>s.stopPropagation(),"onClick"),children:[e.jsx("h3",{children:"âž• Upload Sticker"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Name"}),e.jsx("input",{type:"text",value:k,onChange:a(s=>N(s.target.value),"onChange"),placeholder:"My Sticker",maxLength:32,className:"sticker-name-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Image"}),e.jsx("div",{className:"file-upload-area",onClick:a(()=>document.getElementById("sticker-file").click(),"onClick"),children:y?e.jsx("img",{src:y,alt:"Preview",className:"upload-preview"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-icon",children:"ðŸ“¤"}),e.jsx("p",{children:"Click to select image"}),e.jsx("p",{className:"upload-hint",children:"PNG, GIF â€¢ Max 512KB â€¢ 512x512px recommended"})]})}),e.jsx("input",{id:"sticker-file",type:"file",accept:"image/*",onChange:A,style:{display:"none"}})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:a(()=>m(!1),"onClick"),children:"Cancel"}),e.jsx("button",{className:"upload-btn",onClick:U,disabled:f||!k||!p,children:f?"Uploading...":"Upload"})]})]})})]})})},"StickersPanel");export{J as default};
