var Q=Object.defineProperty;var r=(h,i)=>Q(h,"name",{value:i,configurable:!0});import{r as a,j as e}from"./react-core-Djgtqrmb.js";import{t as l}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const W=r(({serverId:h,apiBaseUrl:i,onClose:x})=>{const[k,C]=a.useState([]),[d,b]=a.useState(null),[p,f]=a.useState([]),[o,j]=a.useState(null),[T,F]=a.useState(!0),[S,w]=a.useState(!1),[A,v]=a.useState(!1),[m,N]=a.useState({title:"",content:"",tags:[]}),[g,P]=a.useState("");a.useEffect(()=>{O()},[h]),a.useEffect(()=>{d&&Y(d.id)},[d]);const O=r(async()=>{try{const s=localStorage.getItem("access_token"),t=await fetch(`${i}/servers/${h}/forums/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const n=await t.json();C(Array.isArray(n)?n:n.forums||[])}}catch{}finally{F(!1)}},"fetchForums"),Y=r(async s=>{try{const t=localStorage.getItem("access_token"),n=await fetch(`${i}/forums/${s}/posts/`,{headers:{Authorization:`Bearer ${t}`}});if(n.ok){const c=await n.json();f(Array.isArray(c)?c:c.posts||[])}}catch{}},"fetchPosts"),$=r(async()=>{const s=prompt("Forum kanalÄ± adÄ±:");if(s)try{const t=localStorage.getItem("access_token"),n=await fetch(`${i}/servers/${h}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:s})});if(n.ok){const c=await n.json();C([...k,c.forum]),l.success("âœ… Forum oluÅŸturuldu!")}else l.error("âŒ Forum oluÅŸturulamadÄ±")}catch{l.error("âŒ Hata oluÅŸtu")}},"handleCreateForum"),G=r(async()=>{if(!m.title.trim()||!m.content.trim()){l.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}w(!0);try{const s=localStorage.getItem("access_token"),t=await fetch(`${i}/forums/${d.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(t.ok){const n=await t.json();f([n.post,...p]),N({title:"",content:"",tags:[]}),v(!1),l.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else l.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch{l.error("âŒ Hata oluÅŸtu")}finally{w(!1)}},"handleCreatePost"),_=r(async s=>{if(!g.trim()){l.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const t=localStorage.getItem("access_token"),n=await fetch(`${i}/forums/posts/${s}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({content:g})});if(n.ok){const c=await n.json();j({...o,replies:[...o.replies||[],c.reply]}),P(""),l.success("âœ… YanÄ±t gÃ¶nderildi!")}else l.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch{l.error("âŒ Hata oluÅŸtu")}},"handleReply"),u=r(async(s,t)=>{try{const n=localStorage.getItem("access_token"),c=await fetch(`${i}/forums/posts/${s}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:t})});if(c.ok){const q=await c.json();f(p.map(y=>y.id===s?{...y,votes:q.votes}:y)),l.success(t==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch{}},"handleVote"),R=r(async(s,t)=>{try{const n=localStorage.getItem("access_token");(await fetch(`${i}/forums/posts/${s}/solve/${t}/`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok&&(l.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),j({...o,solution_id:t}))}catch{}},"handleMarkSolution"),z=a.useCallback(s=>s.stopPropagation(),[]),D=a.useCallback(()=>b(null),[]),H=a.useCallback(()=>j(null),[]),L=a.useCallback(()=>v(s=>!s),[]),B=a.useCallback(()=>v(!1),[]),E=a.useCallback(s=>N(t=>({...t,title:s.target.value})),[]),J=a.useCallback(s=>N(t=>({...t,content:s.target.value})),[]),I=a.useCallback(s=>P(s.target.value),[]),K=a.useCallback(()=>u(o?.id,"up"),[u,o?.id]),M=a.useCallback(()=>u(o?.id,"down"),[u,o?.id]),V=a.useCallback(()=>_(o?.id),[_,o?.id]);return T?e.jsx("div",{className:"forum-panel-overlay",onClick:x,children:e.jsx("div",{className:"forum-panel",onClick:z,children:e.jsxs("div",{className:"forum-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"forum-panel-overlay",onClick:x,children:e.jsxs("div",{className:"forum-panel",onClick:z,children:[e.jsxs("div",{className:"forum-header",children:[e.jsx("h2",{children:"ğŸ’¬ Forum"}),e.jsx("button",{className:"close-btn",onClick:x,children:"âœ•"})]}),d?o?e.jsxs("div",{className:"post-detail",children:[e.jsx("div",{className:"detail-header",children:e.jsx("button",{className:"back-btn",onClick:H,children:"â† Geri"})}),e.jsxs("div",{className:"post-main",children:[e.jsxs("div",{className:"post-votes-vertical",children:[e.jsx("button",{onClick:K,children:"ğŸ‘"}),e.jsx("span",{children:o.votes||0}),e.jsx("button",{onClick:M,children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-body",children:[e.jsx("h2",{children:o.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",o.author," â€¢ â° ",new Date(o.created_at).toLocaleString("tr-TR")]}),e.jsx("div",{className:"post-text",children:o.content})]})]}),e.jsxs("div",{className:"replies-section",children:[e.jsxs("h3",{children:["ğŸ’¬ YanÄ±tlar (",o.replies?.length||0,")"]}),(o.replies||[]).map(s=>e.jsxs("div",{className:`reply-item ${s.id===o.solution_id?"solution":""}`,children:[e.jsxs("div",{className:"reply-header",children:[e.jsxs("span",{className:"reply-author",children:["ğŸ‘¤ ",s.author]}),e.jsx("span",{className:"reply-time",children:new Date(s.created_at).toLocaleString("tr-TR")}),s.id===o.solution_id&&e.jsx("span",{className:"solution-badge",children:"âœ… Ã‡Ã¶zÃ¼m"})]}),e.jsx("div",{className:"reply-content",children:s.content}),!o.solution_id&&e.jsx("button",{className:"mark-solution-btn",onClick:r(()=>R(o.id,s.id),"onClick"),children:"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"})]},s.id)),e.jsxs("div",{className:"reply-form",children:[e.jsx("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:g,onChange:I,rows:4}),e.jsx("button",{className:"reply-submit-btn",onClick:V,children:"ğŸ“¤ YanÄ±tla"})]})]})]}):e.jsxs("div",{className:"posts-view",children:[e.jsxs("div",{className:"posts-header",children:[e.jsx("button",{className:"back-btn",onClick:D,children:"â† Geri"}),e.jsx("h3",{children:d.name}),e.jsx("button",{className:"new-post-btn",onClick:L,children:"â• Yeni GÃ¶nderi"})]}),A&&e.jsxs("div",{className:"create-post-form",children:[e.jsx("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:m.title,onChange:E,maxLength:200}),e.jsx("textarea",{placeholder:"Ä°Ã§erik...",value:m.content,onChange:J,rows:6}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:G,disabled:S,children:S?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"}),e.jsx("button",{className:"cancel-btn",onClick:B,children:"Ä°ptal"})]})]}),e.jsxs("div",{className:"posts-list",children:[p.map(s=>e.jsxs("div",{className:"post-item",onClick:r(()=>j(s),"onClick"),children:[e.jsxs("div",{className:"post-votes",children:[e.jsx("button",{onClick:r(t=>{t.stopPropagation(),u(s.id,"up")},"onClick"),children:"ğŸ‘"}),e.jsx("span",{children:s.votes||0}),e.jsx("button",{onClick:r(t=>{t.stopPropagation(),u(s.id,"down")},"onClick"),children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-content",children:[e.jsx("h4",{children:s.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",s.author," â€¢ â° ",new Date(s.created_at).toLocaleDateString("tr-TR"),s.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"]}),e.jsxs("p",{className:"post-preview",children:[s.content?.substring(0,150),"..."]}),e.jsxs("div",{className:"post-stats",children:["ğŸ’¬ ",s.replies_count||0," yanÄ±t"]})]})]},s.id)),p.length===0&&e.jsx("div",{className:"no-posts",children:e.jsx("p",{children:"ğŸ“­ HenÃ¼z gÃ¶nderi yok"})})]})]}):e.jsxs("div",{className:"forum-list",children:[e.jsxs("div",{className:"forum-list-header",children:[e.jsx("h3",{children:"Forum KanallarÄ±"}),e.jsx("button",{className:"create-forum-btn",onClick:$,children:"â• Yeni Forum"})]}),k.length>0?e.jsx("div",{className:"forums-grid",children:k.map(s=>e.jsxs("div",{className:"forum-card",onClick:r(()=>b(s),"onClick"),children:[e.jsx("div",{className:"forum-icon",children:"ğŸ’¬"}),e.jsx("h4",{children:s.name}),e.jsxs("p",{className:"forum-stats",children:[s.posts_count||0," gÃ¶nderi â€¢ ",s.members_count||0," Ã¼ye"]})]},s.id))}):e.jsxs("div",{className:"no-forums",children:[e.jsx("p",{children:"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"}),e.jsx("button",{onClick:$,children:"Ä°lk forumu oluÅŸtur"})]})]})]})})},"ForumPanel"),re=a.memo(W);export{re as default};
