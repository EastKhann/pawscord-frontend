import{r as g,aR as C,a1 as U,av as O,y as z}from"./react-core-B6hadH-M.js";import{C as b,G as E,f as M,i as f,j as h,t as P,A as I}from"./index-D_6pZib5.js";import{u as D}from"./recaptcha-hW8GPJYe.js";const F=({onLogin:T,onRegister:L,error:y,setAuthError:t})=>{const[d,v]=g.useState(!0),[l,k]=g.useState({username:"",email:"",password:""}),[R,S]=g.useState(!1),{getToken:_}=D();g.useEffect(()=>{if(b.isNativePlatform())try{E.initialize({clientId:M,scopes:["profile","email"],grantOfflineAccess:!0})}catch(e){console.error("❌ [Google] Initialization failed:",e)}},[]),g.useEffect(()=>{if(f&&window.require){const{ipcRenderer:e}=window.require("electron"),o=(u,c)=>{try{const{access:a,refresh:n}=c;if(a&&n){const m=h(a);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",a),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch(a){console.error("❌ [Electron] Token error:",a),t("Token işleme hatası.")}},r=(u,c)=>{console.error("❌ [Electron] Auth error:",c),t(c.error||"Google girişi başarısız.")},i=(u,c)=>{try{const{access:a,refresh:n}=c;if(a&&n){const m=h(a);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",a),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch(a){console.error("❌ [Electron] OAuth token error:",a),t("Token işleme hatası.")}},s=(u,c)=>{try{const a=new URL(c),n=new URLSearchParams(a.search),m=n.get("access"),p=n.get("refresh");if(m&&p){const w=h(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",p),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(a){console.error("Deep link hatası:",a);try{if(c.includes("access=")&&c.includes("refresh=")){const n=c.split("access=");if(n.length>1){const m=n[1].split("&")[0],p=c.split("refresh=");if(p.length>1){const w=p[1],N=h(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",N.username),window.location.reload()}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}catch(n){console.error("Manual parsing error:",n),t("Giriş işlemi başarısız.")}}};return e.on("google-auth-success",o),e.on("google-auth-error",r),e.on("deep-link-auth",s),e.on("oauth-tokens",i),()=>{e.removeListener("google-auth-success",o),e.removeListener("google-auth-error",r),e.removeListener("deep-link-auth",s),e.removeListener("oauth-tokens",i)}}},[t]),g.useEffect(()=>{if(!f){const e=new URLSearchParams(window.location.search),o=e.get("access"),r=e.get("refresh"),i=e.get("error");if(i){console.error("❌ [Web] OAuth error from URL:",i),t(decodeURIComponent(i)),window.history.replaceState({},document.title,"/");return}if(o&&r)try{const s=h(o);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",o),localStorage.setItem("refresh_token",r),localStorage.setItem("chat_username",s.username),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(s){console.error("❌ [Web] LocalStorage error:",s),t("Tarayıcı depolama hatası. Lütfen gizli modda değilseniz kontrol edin.")}}},[]);const x=async()=>{try{if(b.isNativePlatform()){const e=await E.signIn(),o=`${I}/auth/google/native/`,r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})}),i=r.headers.get("content-type");if(!i||!i.includes("application/json")){const u=await r.text();console.error("❌ [Google] Backend HTML döndü:",u.substring(0,500)),t("Backend hatası: JSON yerine HTML yanıtı alındı. Sunucu ayarlarını kontrol edin.");return}const s=await r.json();r.ok?s.access&&s.refresh?(localStorage.setItem("access_token",s.access),localStorage.setItem("refresh_token",s.refresh),window.location.reload()):(console.error("❌ [Google] Tokens eksik:",s),t("Token bilgileri eksik.")):(console.error("❌ [Google] Login failed:",s),t(s.error||"Google girişi başarısız."))}else{const r=`${f?"https://api.pawscord.com/api":I}/auth/google/start/?source=${f?"electron":"web"}`;if(f&&window.require){const{ipcRenderer:i}=window.require("electron");i.send("start-google-login",r)}else window.location.href=r}}catch(e){console.error("❌ [Google] Unexpected error:",e),t("Google girişi sırasında bir hata oluştu: "+e.message)}},G=async e=>{e.preventDefault(),S(!0),t("");try{const o=await _(d?"login":"register");d?await T(l.username,l.password,o):await L(l.username,l.email,l.password,o)&&(P.success("Kayıt başarılı! Lütfen e-postanı kontrol et.",4e3),v(!0))}catch(o){console.error("❌ [Login] Beklenmeyen hata:",o),t("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.")}finally{S(!1)}};return React.createElement("div",{className:"login-container"},React.createElement("div",{className:"background-animate"}),React.createElement("div",{className:"login-card"},React.createElement("div",{className:"logo-header"},React.createElement("div",{className:"logo-circle"},React.createElement(C,{size:40,color:"white"})),React.createElement("h1",null,"Pawscord"),React.createElement("p",null,d?"Tekrar hoşgeldin!":"Aramıza katıl!")),y&&React.createElement("div",{className:"error-message"},y),React.createElement("form",{onSubmit:G},React.createElement("div",{className:"input-group"},React.createElement(U,{className:"input-icon"}),React.createElement("input",{type:"text",placeholder:"Kullanıcı Adı",value:l.username,onChange:e=>k({...l,username:e.target.value}),required:!0})),!d&&React.createElement("div",{className:"input-group slide-down"},React.createElement(O,{className:"input-icon"}),React.createElement("input",{type:"email",placeholder:"E-posta Adresi",value:l.email,onChange:e=>k({...l,email:e.target.value}),required:!0})),React.createElement("div",{className:"input-group"},React.createElement(z,{className:"input-icon"}),React.createElement("input",{type:"password",placeholder:"Şifre",value:l.password,onChange:e=>k({...l,password:e.target.value}),required:!0})),React.createElement("button",{type:"submit",className:"submit-btn",disabled:R},R?React.createElement("div",{className:"spinner"}):d?"Giriş Yap":"Kayıt Ol")),d&&React.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},React.createElement("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1"},"Şifremi Unuttum?")),React.createElement("div",{className:"divider"},React.createElement("span",null,"veya")),React.createElement("div",{className:"google-btn-wrapper"},React.createElement("button",{onClick:x,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5"},React.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),React.createElement("span",null,"Google ile Giriş Yap"))),React.createElement("div",{className:"toggle-mode"},d?"Hesabın yok mu? ":"Zaten üye misin? ",React.createElement("span",{onClick:()=>{v(!d),t("")}},d?"Kayıt Ol":"Giriş Yap"))))};export{F as default};
