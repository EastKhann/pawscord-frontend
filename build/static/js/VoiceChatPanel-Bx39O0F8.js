var Xe=Object.defineProperty;var o=(e,n)=>Xe(e,"name",{value:n,configurable:!0});import{j as t,a as W,r as x}from"./react-core-Djgtqrmb.js";import{t as O,P as ve,p as Je,a as Ze,q as Qe}from"./index-D_luy7FO.js";import Ue from"./UserContextMenu-BL04brC0.js";import et from"./VoiceSettingsPanel-D3TFjTPF.js";import{D as tt}from"./cjs-3Tj8aJ0i.js";import{S as nt}from"./crypto-vendor-D1XRGppi.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const Q=o(({icon:e,active:n,danger:i,onClick:r,title:p})=>t.jsx("button",{onClick:r,title:p,style:{background:n?"rgba(88, 101, 242, 0.8)":i?"rgba(237, 66, 69, 0.8)":"rgba(255, 255, 255, 0.15)",border:"none",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"16px",transition:"all 0.2s ease"},children:e}),"MiniButton"),at=o(e=>e?e.replace(/_100x100\./gi,".").replace(/_150x150\./gi,".").replace(/_50x50\./gi,".").replace(/\?.*$/,""):null,"getFullResolutionAvatar"),te=o((e,n=256)=>{if(!e)return`https://ui-avatars.com/api/?name=User&background=5865f2&color=fff&bold=true&size=${n}`;const i=nt.hash(e),r=parseInt(i.substring(0,8),16)%360;return`https://ui-avatars.com/api/?name=${encodeURIComponent(e)}&background=${r.toString(16).padStart(2,"0")}${((r+60)%360).toString(16).padStart(2,"0")}${((r+120)%360).toString(16).padStart(2,"0")}&color=fff&bold=true&size=${n}`},"getDeterministicAvatarFallback"),ke=W.memo(({roomName:e,userCount:n,combinedUsers:i,currentUser:r,onToggleMinimize:p,onContextMenu:f,getUserAvatar:a,isMuted:c,isCameraOn:s,isScreenSharing:u,toggleMute:h,toggleCamera:v,toggleScreenShare:d,leaveVoice:w})=>{const j=x.useRef(null);return t.jsx(tt,{nodeRef:j,handle:".mini-drag-handle",defaultPosition:{x:20,y:window.innerHeight-180},bounds:"parent",children:t.jsxs("div",{ref:j,style:{position:"fixed",zIndex:9999,background:"linear-gradient(135deg, #1e2124 0%, #2c2f33 50%, #23272a 100%)",borderRadius:"16px",padding:"16px",boxShadow:"0 12px 48px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(88, 101, 242, 0.15)",border:"1px solid rgba(88, 101, 242, 0.1)",minWidth:"320px",maxWidth:"400px",backdropFilter:"blur(12px)",animation:"slideIn 0.3s ease"},children:[t.jsxs("div",{className:"mini-drag-handle",style:{display:"flex",alignItems:"center",gap:"12px",cursor:"move",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#43b581",boxShadow:"0 0 12px #43b581",animation:"pulse 2s infinite"}}),t.jsxs("span",{style:{color:"#fff",fontSize:"14px",fontWeight:600,flex:1},children:["ðŸŽ¤ ",e]}),t.jsxs("div",{style:{background:"rgba(67, 181, 129, 0.2)",borderRadius:"12px",padding:"4px 10px",fontSize:"11px",color:"#43b581",fontWeight:600},children:["ðŸ‘¥ ",n]}),t.jsx("button",{onClick:p,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"8px",padding:"6px 10px",color:"#fff",cursor:"pointer",fontSize:"12px",transition:"all 0.2s"},onMouseEnter:o(l=>l.target.style.background="rgba(255, 255, 255, 0.2)","onMouseEnter"),onMouseLeave:o(l=>l.target.style.background="rgba(255, 255, 255, 0.1)","onMouseLeave"),children:"â¬†ï¸ AÃ§"})]}),t.jsxs("div",{style:{marginBottom:"12px",maxHeight:"120px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"6px"},children:[i.slice(0,3).map(l=>t.jsxs("div",{onContextMenu:o(m=>{m.preventDefault(),l.username!==r?.username&&f({user:l,position:{x:m.clientX,y:m.clientY}})},"onContextMenu"),onClick:o(m=>{l.username!==r?.username&&f({user:l,position:{x:m.clientX,y:m.clientY}})},"onClick"),style:{display:"flex",alignItems:"center",gap:"10px",padding:"8px",background:l.isTalking?"rgba(67, 181, 129, 0.15)":"rgba(255, 255, 255, 0.05)",borderRadius:"8px",border:l.isTalking?"1px solid rgba(67, 181, 129, 0.4)":"1px solid transparent",transition:"all 0.2s",cursor:l.username!==r?.username?"pointer":"default"},onMouseEnter:o(m=>{l.username!==r?.username&&(m.currentTarget.style.background="rgba(67, 181, 129, 0.2)")},"onMouseEnter"),onMouseLeave:o(m=>{m.currentTarget.style.background=l.isTalking?"rgba(67, 181, 129, 0.15)":"rgba(255, 255, 255, 0.05)"},"onMouseLeave"),children:[t.jsx("img",{src:a(l.username),alt:l.username,onError:o(m=>{m.target.onerror=null,m.target.src=te(l.username,64)},"onError"),style:{width:"32px",height:"32px",borderRadius:"50%",objectFit:"cover",border:l.isTalking?"2px solid #43b581":"2px solid rgba(255, 255, 255, 0.15)",boxShadow:l.isTalking?"0 0 10px rgba(67, 181, 129, 0.5)":"none",transition:"all 0.3s ease"}}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{color:"#fff",fontSize:"13px",fontWeight:600},children:[l.username," ",l.isLocal&&"(Siz)"]}),t.jsx("div",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"11px"},children:l.isMuted?"ðŸ”‡ Sessiz":l.isTalking?"ðŸ”Š KonuÅŸuyor":"ðŸŽ¤ Aktif"})]}),l.isCameraOn&&t.jsx("span",{style:{fontSize:"14px"},children:"ðŸ“¹"}),l.isScreenSharing&&t.jsx("span",{style:{fontSize:"14px"},children:"ðŸ–¥ï¸"})]},l.username)),n>3&&t.jsxs("div",{style:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)",fontSize:"11px",padding:"6px"},children:["+",n-3," daha..."]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:[t.jsx(Q,{icon:c?"ðŸ”‡":"ðŸŽ¤",active:!c,onClick:h,title:c?"Mikrofonu AÃ§":"Mikrofonu Kapat"}),t.jsx(Q,{icon:s?"ðŸ“¹":"ðŸ“·",active:s,onClick:v,title:s?"KamerayÄ± Kapat":"KamerayÄ± AÃ§"}),t.jsx(Q,{icon:"ðŸ–¥ï¸",active:u,onClick:d,title:u?"PaylaÅŸÄ±mÄ± Durdur":"Ekran PaylaÅŸ"}),t.jsx(Q,{icon:"âŒ",danger:!0,onClick:w,title:"AyrÄ±l"})]})]})})});ke.displayName="MinimizedView";function ot({isInVoice:e,localAudioStream:n,isMuted:i,startStatsMonitoring:r,stopStatsMonitoring:p,screenShareQuality:f,updateScreenQuality:a}){const[c,s]=x.useState({}),[u,h]=x.useState(!1),[v,d]=x.useState("good"),[w,j]=x.useState("unknown"),[l,m]=x.useState(!0),[g,T]=x.useState(!0),[S,I]=x.useState({}),[b,_]=x.useState({}),[K,D]=x.useState({}),[ne,q]=x.useState(null);return x.useEffect(()=>{if(!e)return;const E=o(async()=>{const z=window.__pawscord_peer_connections__||{};for(const[C,k]of Object.entries(z))if(k&&k.getStats)try{(await k.getStats()).forEach(y=>{y.type==="candidate-pair"&&y.state==="succeeded"&&s(M=>({...M,[C]:{rtt:Math.round((y.currentRoundTripTime||0)*1e3),packetLoss:y.packetsLost&&y.packetsSent?Math.round(y.packetsLost/y.packetsSent*100*10)/10:0,quality:(y.currentRoundTripTime||0)<.1?"excellent":(y.currentRoundTripTime||0)<.2?"good":"poor"}}))})}catch{}},"monitorConnections"),R=setInterval(E,3e3);return E(),()=>clearInterval(R)},[e]),x.useEffect(()=>(e&&r&&r(),()=>{p&&p()}),[e,r,p]),x.useEffect(()=>{if(!n||i||!e){h(!1);return}try{const E=window.AudioContext||window.webkitAudioContext,R=new E,z=R.createAnalyser();z.fftSize=2048,z.smoothingTimeConstant=.8;const C=R.createMediaStreamSource(n);C.connect(z);const k=new Uint8Array(z.frequencyBinCount);let A=0;const M=setInterval(o(()=>{z.getByteFrequencyData(k);const P=k.slice(80,160),L=Math.max(...P),B=P.reduce((V,Y)=>V+Y,0)/P.length,N=k.slice(10,40),H=N.reduce((V,Y)=>V+Y,0)/N.length;L>180&&B>100&&B>H*1.5?(A++,A>3&&h(!0)):(A=0,L<120&&h(!1))},"detectEcho"),1e3);return()=>{clearInterval(M),C.disconnect(),R.close()}}catch{}},[n,i,e]),x.useEffect(()=>{if(!e)return;const E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=o(()=>{if(!E){d("good"),j("unknown");return}const C=E.effectiveType||"unknown";j(C);const k=E.downlink||10,A=E.rtt||50;let y="good";C==="4g"&&k>=5&&A<100?y="excellent":C==="slow-2g"||k<1||A>300?y="poor":C==="2g"||C==="3g"||k<3||A>150?y="good":y="excellent",d(y),l&&a&&(y==="poor"&&f!=="720p"?a("720p"):y==="excellent"&&f==="720p"&&a("1080p"))},"updateNetworkQuality");R(),E&&E.addEventListener("change",R);const z=setInterval(R,1e4);return()=>{clearInterval(z),E&&E.removeEventListener("change",R)}},[e,l,f,a]),x.useEffect(()=>{if(!g||!e)return;const R=setInterval(o(()=>{const z=document.querySelectorAll("audio[data-username]"),C={},k={...b};z.forEach(A=>{const y=A.getAttribute("data-username");if(y)try{const M=new(window.AudioContext||window.webkitAudioContext),P=M.createMediaElementSource(A),L=M.createAnalyser();L.fftSize=256,P.connect(L),L.connect(M.destination);const B=new Uint8Array(L.frequencyBinCount);L.getByteFrequencyData(B);const N=B.reduce((H,V)=>H+V,0)/B.length;C[y]=N,N>0&&(N<50?k[y]=Math.min(1.5,(k[y]||1)*1.05):N>120&&(k[y]=Math.max(.7,(k[y]||1)*.95))),M.close()}catch{}}),I(C),_(k)},"monitorAudioLevels"),2e3);return()=>clearInterval(R)},[g,e,b]),x.useEffect(()=>{if(!e)return;const R=setInterval(o(()=>{const z={};let C=null,k=0;Object.entries(S).forEach(([A,y])=>{y>30?(z[A]=!0,y>k&&(k=y,C=A)):z[A]=!1}),D(z),C&&k>50?q(C):k===0&&q(null)},"detectTalking"),100);return()=>clearInterval(R)},[e,S]),{connectionQuality:c,setConnectionQuality:s,hasEchoRisk:u,setHasEchoRisk:h,networkQuality:v,setNetworkQuality:d,networkType:w,setNetworkType:j,autoQualityEnabled:l,setAutoQualityEnabled:m,volumeNormalization:g,setVolumeNormalization:T,userAudioLevels:S,setUserAudioLevels:I,normalizedGains:b,setNormalizedGains:_,talkingIndicators:K,setTalkingIndicators:D,activeSpeaker:ne,setActiveSpeaker:q}}o(ot,"useVoiceMonitoring");const it=o(({setContextMenu:e,setVolumeSettings:n})=>{const i=x.useCallback(async s=>{window.location.hash=`#/dm/${s.username}`},[]),r=x.useCallback(async s=>{try{(await fetch("/api/friends/send_request/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({username:s.username})})).ok?O.success(`âœ… ${s.username} kullanÄ±cÄ±sÄ±na arkadaÅŸlÄ±k isteÄŸi gÃ¶nderildi!`):O.error("âŒ ArkadaÅŸlÄ±k isteÄŸi gÃ¶nderilemedi")}catch{O.error("âŒ Bir hata oluÅŸtu")}},[]),p=x.useCallback(async s=>{try{(await fetch("/api/users/block/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({username:s.username})})).ok?O.success(`âœ… ${s.username} engellendi!`):O.error("âŒ Engelleme iÅŸlemi baÅŸarÄ±sÄ±z")}catch{O.error("âŒ Bir hata oluÅŸtu")}},[]),f=x.useCallback(s=>{e(null),window.openUserProfile?window.openUserProfile(s.username):window.location.hash=`#/profile/${s.username}`},[e]),a=x.useCallback(s=>{n(u=>({...u,[s.username]:{...u[s.username],isMuted:!u[s.username]?.isMuted}}))},[n]),c=x.useCallback((s,u)=>{const h=Math.max(0,Math.min(200,u));n(d=>({...d,[s.username]:{...d[s.username],volume:h}})),document.querySelectorAll(`audio[data-username="${s.username}"]`).forEach(d=>{if(h<=100){if(d.volume=h/100,d._gainNode)try{d._gainNode.gain.value=1}catch{}}else{d.volume=1;try{d._audioContext||(d._audioContext=new(window.AudioContext||window.webkitAudioContext),d._sourceNode=d._audioContext.createMediaElementSource(d),d._gainNode=d._audioContext.createGain(),d._sourceNode.connect(d._gainNode),d._gainNode.connect(d._audioContext.destination)),d._gainNode.gain.value=h/100}catch{}}})},[n]);return{handleSendMessage:i,handleAddFriend:r,handleBlock:p,handleViewProfile:f,handleMuteUser:a,handleAdjustVolume:c}},"useVoiceInteractions"),rt=o(({connectedUsers:e,currentUser:n,isMuted:i,isCameraOn:r,isScreenSharing:p,isTalking:f,currentUserProfile:a,getRealUserAvatar:c,allUsers:s,remoteStreams:u,localCameraStream:h,localScreenStream:v})=>{const d=x.useMemo(()=>{const l=[...e];if(n&&!l.some(m=>m.username===n.username))l.push({username:n.username,isMuted:i,isCameraOn:r,isScreenSharing:p,isTalking:f,isLocal:!0});else if(n){const m=l.findIndex(g=>g.username===n.username);m>=0&&(l[m]={...l[m],isMuted:i,isCameraOn:r,isScreenSharing:p,isTalking:f,isLocal:!0})}return l},[e,n,i,r,p]),w=x.useCallback(l=>{let m=null;if(a&&l===n?.username&&a.avatar&&typeof a.avatar=="string"&&(a.avatar.startsWith("http")||a.avatar.startsWith("blob:")?m=a.avatar:m=`${ve}${a.avatar.startsWith("/")?"":"/"}${a.avatar}`),!m&&c&&(m=c(l)),!m){const g=s.find(T=>T.username===l);g?.avatar&&typeof g.avatar=="string"&&(g.avatar.startsWith("http")||g.avatar.startsWith("blob:")?m=g.avatar:m=`${ve}${g.avatar.startsWith("/")?"":"/"}${g.avatar}`)}return m?at(m):te(l,256)},[a,n,c,s]),j=x.useMemo(()=>{const l={...u};return n?.username&&(h&&(l[`${n.username}_camera`]=h),v&&(l[`${n.username}_screen`]=v)),l},[u,n,h,v]);return{combinedUsers:d,getUserAvatar:w,allStreams:j}},"useVoiceChatState"),st=o(({stream:e,fullscreen:n})=>{const i=x.useRef(null);return x.useEffect(()=>{i.current&&e&&(i.current.srcObject=e)},[e]),t.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!1,style:{width:"100%",height:"100%",objectFit:n?"contain":"cover",background:"#000"}})},"VideoFeed"),F=o(({icon:e,active:n,danger:i,special:r,subtle:p,small:f,isLeave:a,onClick:c,title:s,label:u})=>{const h=o(()=>a?"linear-gradient(135deg, #ed4245 0%, #c03537 100%)":i&&n?"rgba(240, 71, 71, 0.4)":i?"rgba(240, 71, 71, 0.15)":r?"linear-gradient(135deg, #5865f2 0%, #4752c4 100%)":n?"rgba(67, 181, 129, 0.25)":p?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.1)","getBackground"),v=o(()=>a?"none":i&&n?"2px solid rgba(240, 71, 71, 0.6)":n?"2px solid rgba(67, 181, 129, 0.5)":r?"2px solid rgba(88, 101, 242, 0.5)":"2px solid transparent","getBorder");return t.jsxs("button",{onClick:c,title:s,style:{background:h(),border:v(),borderRadius:a?"50%":"12px",width:a?"48px":f?"40px":"48px",height:a?"48px":f?"40px":"48px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:f?"16px":"20px",color:"#fff",transition:"all 0.2s ease",boxShadow:a?"0 4px 15px rgba(237, 66, 69, 0.4)":n?"0 2px 10px rgba(67, 181, 129, 0.3)":"none",transform:"scale(1)"},onMouseEnter:o(d=>{d.currentTarget.style.transform="scale(1.1)",d.currentTarget.style.boxShadow=a?"0 6px 20px rgba(237, 66, 69, 0.6)":"0 4px 15px rgba(255, 255, 255, 0.2)"},"onMouseEnter"),onMouseLeave:o(d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.boxShadow=a?"0 4px 15px rgba(237, 66, 69, 0.4)":n?"0 2px 10px rgba(67, 181, 129, 0.3)":"none"},"onMouseLeave"),children:[t.jsx("span",{children:e}),u&&t.jsx("span",{style:{fontSize:"9px",marginTop:"2px",fontWeight:600},children:u})]})},"VoiceControlBtn"),lt=o(({isMuted:e,isDeafened:n,isCameraOn:i,isScreenSharing:r,isSpatialAudio:p,isRecording:f,recordingDuration:a,onToggleMute:c,onToggleDeafened:s,onToggleCamera:u,onToggleScreenShare:h,onToggleSpatialAudio:v,onStartRecording:d,onStopRecording:w,onDownloadRecording:j,onLeave:l,onSettings:m})=>{const g=o(T=>{const S=Math.floor(T/60).toString().padStart(2,"0"),I=Math.floor(T%60).toString().padStart(2,"0");return`${S}:${I}`},"formatDuration");return t.jsxs("div",{style:{background:"linear-gradient(180deg, rgba(32, 34, 37, 0.98) 0%, rgba(24, 25, 28, 1) 100%)",padding:"12px 20px",display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",borderTop:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.4)",flexShrink:0,minHeight:"70px",position:"relative",zIndex:100},children:[t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[t.jsx(F,{icon:e?"ðŸ”‡":"ðŸŽ¤",active:!e,danger:e,onClick:c,title:e?"Mikrofonu AÃ§":"Mikrofonu Kapat"}),t.jsx(F,{icon:n?"ðŸ”ˆ":"ðŸŽ§",active:!n,danger:n,onClick:s,title:n?"KulaklÄ±ÄŸÄ± AÃ§":"KulaklÄ±ÄŸÄ± Kapat"})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",padding:"0 16px",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",borderRight:"1px solid rgba(255, 255, 255, 0.1)"},children:[t.jsx(F,{icon:i?"ðŸ“¹":"ðŸ“·",active:i,onClick:u,title:i?"KamerayÄ± Kapat":"KamerayÄ± AÃ§"}),t.jsx(F,{icon:"ðŸ–¥ï¸",active:r,special:r,onClick:h,title:r?"PaylaÅŸÄ±mÄ± Durdur":"Ekran PaylaÅŸ"}),v&&t.jsx(F,{icon:"ðŸ”Š",active:p,onClick:v,title:p?"3D Ses (AÃ§Ä±k)":"3D Ses (KapalÄ±)",small:!0})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[d&&w&&t.jsx(F,{icon:f?"â¹ï¸":"âºï¸",active:f,danger:f,onClick:f?w:d,title:f?`KaydÄ± Durdur (${g(a)})`:"KayÄ±t BaÅŸlat",label:f?g(a):null}),m&&t.jsx(F,{icon:"âš™ï¸",onClick:m,title:"Ayarlar",subtle:!0})]}),t.jsx(F,{icon:"ðŸ“ž",danger:!0,onClick:l,title:"AyrÄ±l",isLeave:!0})]})},"ControlBar"),we=W.memo(({expandedUser:e,allStreams:n,onBack:i,isMuted:r,isDeafened:p,isCameraOn:f,isScreenSharing:a,isSpatialAudioEnabled:c,isRecording:s,recordingDuration:u,toggleMute:h,toggleDeafened:v,toggleCamera:d,toggleScreenShare:w,toggleSpatialAudio:j,startRecording:l,stopRecording:m,leaveVoice:g})=>{const T=e.streamType==="screen"?`${e.username}_screen`:`${e.username}_camera`,S=n[T]||n[e.username];return t.jsxs("div",{style:{width:"100%",height:"100%",background:"#000",display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",padding:"16px 24px",display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"8px",padding:"8px 16px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"â¬…ï¸ Geri"}),t.jsxs("h3",{style:{color:"#fff",margin:0,flex:1},children:["ðŸ‘¤ ",e.username," ",e.streamType==="screen"&&"ðŸ–¥ï¸ Ekran PaylaÅŸÄ±mÄ±"]})]}),t.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#1a1a1a"},children:t.jsx(st,{user:e,stream:S,fullscreen:!0})}),t.jsx(lt,{isMuted:r,isDeafened:p,isCameraOn:f,isScreenSharing:a,isSpatialAudio:c,isRecording:s,recordingDuration:u,onToggleMute:h,onToggleDeafened:v,onToggleCamera:d,onToggleScreenShare:w,onToggleSpatialAudio:j,onStartRecording:l,onStopRecording:m,onLeave:g})]})});we.displayName="FullscreenView";const ct=o((e,n)=>{const i=x.useRef(null),r=x.useRef(null);return x.useEffect(()=>{i.current&&e&&(i.current.srcObject=e)},[e]),x.useEffect(()=>{if(r.current&&e&&!n.isLocal){const p=e.getAudioTracks();if(p.length>0){r.current.srcObject=new MediaStream(p);const f=n.volume||100;if(f<=100)r.current.volume=Math.max(0,f/100);else{r.current.volume=1;try{const a=r.current;a._audioContext||(a._audioContext=new(window.AudioContext||window.webkitAudioContext),a._sourceNode=a._audioContext.createMediaElementSource(a),a._gainNode=a._audioContext.createGain(),a._sourceNode.connect(a._gainNode),a._gainNode.connect(a._audioContext.destination)),a._gainNode.gain.value=f/100}catch{}}}}},[e,n.isLocal,n.username,n.volume]),{videoRef:i,audioRef:r}},"useVideoAudio"),dt=o(({user:e,stream:n,videoRef:i,getUserAvatar:r,badge:p})=>{const f=n&&n.active&&n.getVideoTracks().length>0;return t.jsxs("div",{style:{width:"100%",height:"100%",background:"#1a1a1a",display:"flex",alignItems:"center",justifyContent:"center"},children:[p,f?t.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:e.isLocal===!0,style:{width:"100%",height:"100%",objectFit:e.streamType==="screen"?"contain":"cover",backgroundColor:e.streamType==="screen"?"#000":"#1a1a1a"}}):t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",background:"linear-gradient(135deg, #36393f 0%, #2f3136 50%, #202225 100%)",position:"relative"},children:[t.jsx("div",{style:{position:"relative",padding:"8px",borderRadius:"50%",background:e.isTalking?"linear-gradient(135deg, #43b581, #3ca374)":"transparent",boxShadow:e.isTalking?"0 0 20px rgba(67, 181, 129, 0.6), 0 0 40px rgba(67, 181, 129, 0.3)":"none",transition:"all 0.3s ease",animation:e.isTalking?"talkingPulse 1s ease-in-out infinite":"none"},children:t.jsx("img",{src:r(e.username),alt:e.username,onError:o(a=>{a.target.onerror=null,a.target.src=te(e.username,256)},"onError"),style:{width:"140px",height:"140px",borderRadius:"50%",objectFit:"cover",border:"5px solid #40444b",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",display:"block"},loading:"lazy"})}),t.jsx("div",{style:{color:"#fff",fontSize:"18px",fontWeight:700,textShadow:"0 2px 8px rgba(0, 0, 0, 0.7)",letterSpacing:"0.5px"},children:e.username}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 14px",background:e.isMuted?"rgba(240, 71, 71, 0.2)":"rgba(67, 181, 129, 0.2)",borderRadius:"16px",border:e.isMuted?"1px solid rgba(240, 71, 71, 0.4)":"1px solid rgba(67, 181, 129, 0.4)"},children:[t.jsx("span",{style:{fontSize:"16px"},children:e.isMuted?"ðŸ”‡":"ðŸŽ¤"}),t.jsx("span",{style:{color:e.isMuted?"#f04747":"#43b581",fontSize:"13px",fontWeight:600},children:e.isMuted?"Sessiz":e.isTalking?"KonuÅŸuyor...":"Dinliyor"})]})]})]})},"VideoDisplay"),pt=o(({user:e,isActive:n,connectionQuality:i})=>t.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent)",padding:"12px 16px",display:"flex",alignItems:"center",gap:"8px",zIndex:10},children:[e.isTalking&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"3px"},children:[t.jsx("div",{style:{width:"3px",height:"12px",background:"#43b581",borderRadius:"2px",animation:"wave1 0.6s ease-in-out infinite"}}),t.jsx("div",{style:{width:"3px",height:"16px",background:"#43b581",borderRadius:"2px",animation:"wave2 0.6s ease-in-out infinite 0.1s"}}),t.jsx("div",{style:{width:"3px",height:"12px",background:"#43b581",borderRadius:"2px",animation:"wave3 0.6s ease-in-out infinite 0.2s"}})]}),!e.isLocal&&i&&t.jsx("div",{title:`RTT: ${i.rtt}ms, Packet Loss: ${i.packetLoss}%`,style:{fontSize:"16px",filter:i.quality==="excellent"?"none":i.quality==="good"?"hue-rotate(30deg)":"hue-rotate(90deg) saturate(2)",opacity:.9},children:i.quality==="excellent"||i.quality==="good"?"ðŸ“¶":"âš ï¸"}),t.jsxs("span",{onClick:o(r=>{r.stopPropagation(),e.isLocal||(window.openUserProfile?window.openUserProfile(e.username):window.location.hash=`#/profile/${e.username}`)},"onClick"),style:{color:"#fff",fontSize:"14px",fontWeight:600,flex:1,cursor:e.isLocal?"default":"pointer",textDecoration:e.isLocal?"none":"underline",textDecorationColor:"rgba(255, 255, 255, 0.3)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.username," ",e.streamType==="screen"&&"ðŸ–¥ï¸ Ekran"]}),t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.isMuted&&t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ”‡"}),e.streamType==="camera"&&e.isCameraOn&&t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“¹"}),n&&t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ”Š"})]})]}),"UserOverlay"),ce=o(({icon:e,onClick:n,title:i,bgColor:r="rgba(0, 0, 0, 0.7)"})=>t.jsx("button",{onClick:n,title:i,style:{background:r,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",color:"#fff",fontWeight:"bold",transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},onMouseEnter:o(p=>{p.currentTarget.style.transform="scale(1.1)",p.currentTarget.style.boxShadow="0 4px 16px rgba(255, 255, 255, 0.3)"},"onMouseEnter"),onMouseLeave:o(p=>{p.currentTarget.style.transform="scale(1)",p.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)"},"onMouseLeave"),children:e}),"ActionButton"),xt=o(({user:e,isPinned:n,onPin:i,onExpand:r,showFullControls:p,videoRef:f})=>t.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:"6px",opacity:p?1:0,transition:"opacity 0.25s ease, transform 0.25s ease",transform:p?"translateY(0)":"translateY(-6px)",zIndex:20,pointerEvents:p?"auto":"none"},children:[t.jsx(ce,{icon:n?"ðŸ“Œ":"ðŸ“",onClick:o(a=>{a.stopPropagation(),i()},"onClick"),title:n?"Sabitlemeyi KaldÄ±r":"Sabitle",bgColor:"rgba(88, 101, 242, 0.9)"}),t.jsx(ce,{icon:"â›¶",onClick:o(a=>{a.stopPropagation(),r()},"onClick"),title:"Panelde GeniÅŸlet",bgColor:"rgba(67, 181, 129, 0.9)"}),t.jsx(ce,{icon:"ðŸ–¥ï¸",onClick:o(a=>{a.stopPropagation();const c=f.current;if(c){const u=c.parentElement?.parentElement||c;u.requestFullscreen?u.requestFullscreen():u.webkitRequestFullscreen?u.webkitRequestFullscreen():u.mozRequestFullScreen?u.mozRequestFullScreen():u.msRequestFullscreen&&u.msRequestFullscreen()}},"onClick"),title:"Tam Ekran Ä°zle",bgColor:"rgba(250, 166, 26, 0.9)"}),!e.isLocal&&p&&t.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.9)",borderRadius:"10px",padding:"6px 10px",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",backdropFilter:"blur(8px)",border:"1px solid rgba(255, 255, 255, 0.1)",animation:"fadeIn 0.2s ease"},children:[t.jsx("span",{style:{fontSize:"12px"},children:(e.volume||100)===0?"ðŸ”‡":(e.volume||100)>100?"ðŸ”Š":"ðŸ”‰"}),t.jsx("input",{type:"range",min:"0",max:"200",value:e.volume||100,onChange:o(a=>{a.stopPropagation(),e.onVolumeChange&&e.onVolumeChange(parseInt(a.target.value))},"onChange"),style:{flex:1,cursor:"pointer",height:"4px"},onClick:o(a=>a.stopPropagation(),"onClick")}),t.jsxs("span",{style:{fontSize:"10px",color:"#fff",minWidth:"30px",fontWeight:600},children:[e.volume||100,"%"]})]})]}),"HoverControls"),de=W.memo(({user:e,stream:n,isActive:i,isPinned:r,onExpand:p,onPin:f,onContextMenu:a,compact:c=!1,badge:s,connectionQuality:u,getUserAvatar:h})=>{const{videoRef:v,audioRef:d}=ct(n,e),[w,j]=x.useState(!1),l=x.useCallback(g=>{g.preventDefault(),a&&e.username!==e.isLocal&&a({user:e,position:{x:g.clientX,y:g.clientY}})},[a,e]),m=x.useCallback(g=>{!e.isLocal&&a&&a({user:e,position:{x:g.clientX,y:g.clientY}})},[e,a]);return t.jsxs("div",{onContextMenu:l,onClick:m,onMouseEnter:o(()=>j(!0),"onMouseEnter"),onMouseLeave:o(()=>j(!1),"onMouseLeave"),style:{background:"linear-gradient(135deg, #2c2f33 0%, #23272a 100%)",borderRadius:"16px",overflow:"hidden",position:"relative",border:i?"3px solid #43b581":r?"3px solid #5865f2":"1px solid rgba(255, 255, 255, 0.1)",boxShadow:i?"0 0 20px rgba(67, 181, 129, 0.5)":"0 4px 16px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",cursor:e.isLocal?"default":"pointer",width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[!e.isLocal&&n&&t.jsx("audio",{ref:d,autoPlay:!0,playsInline:!0,"data-username":e.username,style:{display:"none"}}),t.jsx(dt,{user:e,stream:n,videoRef:v,getUserAvatar:h,badge:s}),t.jsx(pt,{user:e,isActive:i,connectionQuality:u}),t.jsx(xt,{user:e,isPinned:r,onPin:f,onExpand:p,showFullControls:w,videoRef:v}),t.jsx("style",{children:`
                div:hover .hover-actions {
                    opacity: 1;
                }
            `})]})},(e,n)=>e.user.username===n.user.username&&e.stream===n.stream&&e.user.isCameraOn===n.user.isCameraOn&&e.user.isScreenSharing===n.user.isScreenSharing&&e.user.isMuted===n.user.isMuted&&e.isActive===n.isActive&&e.isPinned===n.isPinned&&e.compact===n.compact),U={padding:"4px 8px",borderRadius:"10px",fontSize:"12px",display:"inline-flex",alignItems:"center",gap:"6px"},je=W.memo(({isRecording:e,recordingDuration:n,isScreenSharing:i,screenShareQuality:r,screenShareFPS:p,includeSystemAudio:f,isPTTMode:a,pttKey:c,isPTTActive:s,isReconnecting:u})=>{const h=[];return e&&h.push(t.jsxs("span",{style:{...U,background:"rgba(237,66,69,0.2)",color:"#ed4245",border:"1px solid rgba(237,66,69,0.4)"},children:["âºï¸ KayÄ±tta (",Math.floor(n/60).toString().padStart(2,"0"),":",Math.floor(n%60).toString().padStart(2,"0"),")"]},"rec")),i&&h.push(t.jsxs("span",{style:{...U,background:"rgba(88,101,242,0.15)",color:"#8893ff",border:"1px solid rgba(88,101,242,0.35)"},children:["ðŸ–¥ï¸ PaylaÅŸÄ±lÄ±yor ",r," â€¢ ",p,"fps",f?" â€¢ ðŸ”Š Sistem":""]},"ss")),a&&h.push(t.jsxs("span",{style:{...U,background:"rgba(250,166,26,0.18)",color:"#faa61a",border:"1px solid rgba(250,166,26,0.35)"},children:["ðŸŽ™ï¸ PTT (",c,") ",s?"â€¢ Aktif":""]},"ptt")),u&&h.push(t.jsx("span",{style:{...U,background:"rgba(255,255,255,0.08)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)"},children:"ðŸ”„ Yeniden baÄŸlanÄ±yor"},"reconnect")),h.length?t.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:h}):null});je.displayName="StatusBadges";const ee=W.memo(({user:e})=>e.streamType==="screen"?t.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",background:"linear-gradient(135deg, #5865f2 0%, #7289da 100%)",color:"#fff",padding:"8px 16px",borderRadius:"12px",fontSize:"13px",fontWeight:700,boxShadow:"0 4px 16px rgba(88, 101, 242, 0.6), 0 0 0 2px rgba(255, 255, 255, 0.2)",zIndex:100,display:"flex",alignItems:"center",gap:"8px",animation:"badgePulse 2s infinite"},children:["ðŸ–¥ï¸ ",t.jsxs("span",{style:{textShadow:"0 2px 4px rgba(0, 0, 0, 0.5)"},children:[e.username," - Ekran PaylaÅŸÄ±yor"]})]}):e.streamType==="camera"?t.jsx("div",{style:{position:"absolute",top:"12px",left:"12px",background:"rgba(67, 181, 129, 0.85)",color:"#fff",padding:"6px 12px",borderRadius:"8px",fontSize:"11px",fontWeight:600,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",zIndex:100,display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“¹ Kamera"}):null);ee.displayName="StreamBadge";const ut=o((e,n)=>n?{cols:1,rows:e}:e<=1?{cols:1,rows:1}:e<=4?{cols:2,rows:2}:e<=6?{cols:3,rows:2}:e<=9?{cols:3,rows:3}:{cols:4,rows:Math.ceil(e/4)},"getGridLayout$1"),pe=W.memo(({combinedUsers:e,allStreams:n,screenShares:i=[],remoteVolumes:r,setRemoteVolume:p,talkingIndicators:f,activeSpeaker:a,pinnedUser:c,setPinnedUser:s,setExpandedUser:u,setContextMenu:h,connectionQuality:v,getUserAvatar:d,isMobile:w})=>{if(i.length>0){const g=[];i.forEach(b=>{const _=n[`${b.username}_screen`];_&&g.push({key:`${b.username}_screen`,username:b.username,type:"screen",component:t.jsx(de,{user:{...b,streamType:"screen"},stream:_,isActive:!1,isPinned:!1,onExpand:o(()=>u({...b,streamType:"screen"}),"onExpand"),onPin:o(()=>{},"onPin"),onContextMenu:o(K=>h(K),"onContextMenu"),badge:t.jsx(ee,{user:{...b,streamType:"screen"}}),connectionQuality:v[b.username],getUserAvatar:d},`${b.username}_screen`)})}),e.forEach(b=>{const _=n[`${b.username}_camera`]||n[b.username];(_&&_.active||b.isLocal)&&g.push({key:`${b.username}_camera`,username:b.username,type:"camera",component:t.jsx(de,{user:{...b,streamType:"camera",volume:r[b.username]||100,onVolumeChange:o(D=>p(b.username,D),"onVolumeChange"),isTalking:f[b.username]||!1},stream:_,isActive:a===b.username,isPinned:c===b.username,onExpand:o(()=>u({...b,streamType:"camera"}),"onExpand"),onPin:o(()=>s(c===b.username?null:b.username),"onPin"),onContextMenu:o(D=>h(D),"onContextMenu"),badge:t.jsx(ee,{user:b}),connectionQuality:v[b.username],getUserAvatar:d},`${b.username}_camera`)})});const T=g.length;let S,I;return T<=2?(S=T,I=1):T<=4?(S=2,I=2):T<=6?(S=3,I=2):(S=3,I=Math.ceil(T/3)),t.jsx("div",{style:{width:"100%",height:"100%",display:"grid",gridTemplateColumns:`repeat(${S}, 1fr)`,gridTemplateRows:`repeat(${I}, 1fr)`,gap:"16px",padding:"0",position:"relative"},children:g.map(b=>t.jsx("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",zIndex:1,isolation:"isolate"},children:b.component},b.key))})}const{cols:l,rows:m}=ut(e.length,w);return t.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:`repeat(${l}, 1fr)`,gridTemplateRows:`repeat(${m}, 1fr)`,gap:"16px",minHeight:"400px",height:"100%"},children:e.map(g=>{const T=n[`${g.username}_camera`]||(g.isLocal?null:n[g.username]);return t.jsx(de,{user:{...g,streamType:"camera",volume:r[g.username]||100,onVolumeChange:o(S=>p(g.username,S),"onVolumeChange")},stream:T,isActive:a===g.username,isPinned:c===g.username,onExpand:o(()=>u({...g,streamType:"camera"}),"onExpand"),onPin:o(()=>s(c===g.username?null:g.username),"onPin"),onContextMenu:o(S=>h(S),"onContextMenu"),badge:t.jsx(ee,{user:{...g,streamType:"camera"}}),connectionQuality:v[g.username],getUserAvatar:d},`${g.username}_camera`)})})});pe.displayName="GridView";const gt=o((e,n)=>n?{cols:1,rows:e}:e<=1?{cols:1,rows:1}:e<=4?{cols:2,rows:2}:e<=6?{cols:3,rows:2}:e<=9?{cols:3,rows:3}:{cols:4,rows:Math.ceil(e/4)},"getGridLayout"),Se=W.memo(({combinedUsers:e,activeSpeaker:n,getUserAvatar:i,setContextMenu:r,isMobile:p})=>{const{cols:f,rows:a}=gt(e.length,p);return t.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:`repeat(${Math.min(f,3)}, 1fr)`,gridTemplateRows:`repeat(${a}, 1fr)`,gap:"24px",padding:"40px",alignItems:"center",justifyContent:"center"},children:e.map(c=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"12px",padding:"32px",borderRadius:"16px",background:n===c.username?"linear-gradient(135deg, rgba(88, 101, 242, 0.25) 0%, rgba(114, 137, 218, 0.15) 100%)":"rgba(47, 49, 54, 0.5)",border:n===c.username?"2px solid rgba(88, 101, 242, 0.9)":"2px solid rgba(79, 84, 92, 0.3)",boxShadow:n===c.username?"0 8px 32px rgba(88, 101, 242, 0.4), 0 0 20px rgba(88, 101, 242, 0.3)":"0 4px 12px rgba(0, 0, 0, 0.2)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",position:"relative",transform:n===c.username?"scale(1.05)":"scale(1)",animation:"slideIn 0.4s ease forwards"},role:"button",tabIndex:0,"aria-label":`${c.username} profil kartÄ±`,onClick:o(()=>r({user:c,position:{x:window.innerWidth/2,y:window.innerHeight/2}}),"onClick"),onKeyDown:o(s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r({user:c,position:{x:window.innerWidth/2,y:window.innerHeight/2}}))},"onKeyDown"),children:[t.jsx("div",{style:{width:"140px",height:"140px",borderRadius:"50%",overflow:"hidden",border:`5px solid ${n===c.username?"#5865f2":"#40444b"}`,boxShadow:n===c.username?"0 8px 24px rgba(88, 101, 242, 0.6), inset 0 0 20px rgba(88, 101, 242, 0.2)":"0 4px 12px rgba(0, 0, 0, 0.4)",animation:n===c.username?"pulse 1.5s infinite":"none",position:"relative"},children:t.jsx("img",{src:i(c.username),alt:c.username,onError:o(s=>{s.target.onerror=null,s.target.src=te(c.username,256)},"onError"),style:{width:"100%",height:"100%",objectFit:"cover",filter:n===c.username?"brightness(1.1)":"brightness(0.95)"}})}),t.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:n===c.username?"#dee0fc":"#fff",textAlign:"center",textShadow:"0 2px 8px rgba(0, 0, 0, 0.7)",letterSpacing:"0.3px"},children:c.username}),t.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"22px",marginTop:"4px"},children:[c.isMuted&&t.jsx("span",{title:"Mikrofon KapalÄ±",style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5))"},children:"ðŸ”‡"}),c.isDeafened&&t.jsx("span",{title:"KulaklÄ±k KapalÄ±",style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5))"},children:"ðŸ”ˆ"})]})]},c.username))})});Se.displayName="ProfileCardGrid";const Ce=W.memo(({roomName:e,userCount:n,onToggleMinimize:i,isRecording:r,recordingDuration:p,isScreenSharing:f,screenShareQuality:a,screenShareFPS:c,includeSystemAudio:s,isPTTMode:u,pttKey:h,isPTTActive:v,isReconnecting:d,networkQuality:w,networkType:j})=>t.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"16px 24px",display:"flex",alignItems:"center",gap:"16px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#43b581",boxShadow:"0 0 12px #43b581",animation:"pulse 2s infinite"}}),t.jsxs("h2",{style:{color:"#fff",margin:0,fontSize:"17px",fontWeight:700,flex:1,display:"flex",alignItems:"center",gap:"12px",letterSpacing:"0.3px"},children:["ðŸŽ™ï¸ ",e,t.jsx(je,{isRecording:r,recordingDuration:p,isScreenSharing:f,screenShareQuality:a,screenShareFPS:c,includeSystemAudio:s,isPTTMode:u,pttKey:h,isPTTActive:v,isReconnecting:d}),w==="poor"&&t.jsx("div",{style:{background:"rgba(240, 71, 71, 0.2)",border:"1px solid #f04747",borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:"#f04747",fontWeight:"600",display:"flex",alignItems:"center",gap:"4px"},children:"âš ï¸ ZayÄ±f BaÄŸlantÄ±"}),w==="excellent"&&j!=="unknown"&&t.jsxs("div",{style:{background:"rgba(67, 181, 129, 0.2)",border:"1px solid #43b581",borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:"#43b581",fontWeight:"600",display:"flex",alignItems:"center",gap:"4px"},children:["ðŸ“¶ ",j.toUpperCase()]})]}),t.jsxs("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:["ðŸ‘¥ ",n," kiÅŸi"]}),t.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"8px",padding:"8px 16px",color:"#fff",cursor:"pointer",fontSize:"13px"},children:"â¬‡ï¸ KÃ¼Ã§Ã¼lt"})]}));Ce.displayName="VoiceHeader";const Te=W.memo(({onDismiss:e})=>t.jsxs("div",{style:{position:"absolute",bottom:"100px",left:"50%",transform:"translateX(-50%)",background:"linear-gradient(135deg, rgba(250, 166, 26, 0.95) 0%, rgba(237, 66, 69, 0.95) 100%)",color:"#fff",padding:"16px 24px",borderRadius:"12px",zIndex:1e3,display:"flex",alignItems:"center",gap:"12px",boxShadow:"0 8px 32px rgba(250, 166, 26, 0.6)",animation:"pulse 2s infinite",maxWidth:"90%"},children:[t.jsx("div",{style:{fontSize:"24px",animation:"pulse 1.5s infinite"},children:"âš ï¸"}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"15px"},children:"Echo Tespit Edildi!"}),t.jsx("div",{style:{fontSize:"13px",opacity:.9},children:"KulaklÄ±k kullanmanÄ±z Ã¶nerilir. HoparlÃ¶r kullanÄ±mÄ± echo'ya neden olur."})]}),t.jsx("button",{onClick:e,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"6px",color:"#fff",padding:"6px 12px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Kapat"})]}));Te.displayName="EchoWarning";function ft(){if(typeof document>"u"||document.head.querySelector("style#voice-fullscreen-styles"))return;const e=document.createElement("style");e.id="voice-fullscreen-styles",e.textContent=`
            /* Tam Ekran Video Stilleri */
            div:fullscreen video,
            div:-webkit-full-screen video,
            div:-moz-full-screen video,
            div:-ms-fullscreen video {
                width: 100% !important;
                height: 100% !important;
                object-fit: contain !important;
                background: #000 !important;
            }

            /* Tam Ekran Container */
            div:fullscreen,
            div:-webkit-full-screen,
            div:-moz-full-screen,
            div:-ms-fullscreen {
                background: #000 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }

            /* Tam Ekran Kontrolleri */
            div:fullscreen .hover-actions,
            div:-webkit-full-screen .hover-actions,
            div:-moz-full-screen .hover-actions,
            div:-ms-fullscreen .hover-actions {
                opacity: 1 !important;
                z-index: 9999 !important;
            }

            /* ðŸ”¥ YENÄ°: Badge AnimasyonlarÄ± */
            @keyframes badgePulse {
                0%, 100% {
                    transform: scale(1);
                    box-shadow: 0 4px 16px rgba(88, 101, 242, 0.6), 0 0 0 2px rgba(255, 255, 255, 0.2);
                }
                50% {
                    transform: scale(1.05);
                    box-shadow: 0 6px 20px rgba(88, 101, 242, 0.9), 0 0 0 3px rgba(255, 255, 255, 0.4);
                }
            }

            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                    transform: scale(1);
                }
                50% {
                    opacity: 0.7;
                    transform: scale(1.2);
                }
            }

            /* ðŸ”¥ YENÄ°: Talking Indicator Wave Animations */
            @keyframes wave1 {
                0%, 100% { height: 12px; }
                50% { height: 20px; }
            }
            @keyframes wave2 {
                0%, 100% { height: 16px; }
                50% { height: 24px; }
            }
            @keyframes wave3 {
                0%, 100% { height: 12px; }
                50% { height: 20px; }
            }

            /* ðŸ”¥ YENÄ°: Avatar Talking Pulse Animation */
            @keyframes talkingPulse {
                0%, 100% {
                    box-shadow: 0 0 0 0 rgba(67, 181, 129, 0.7);
                    transform: scale(1);
                }
                50% {
                    box-shadow: 0 0 0 15px rgba(67, 181, 129, 0);
                    transform: scale(1.02);
                }
            }

            @keyframes slideIn {
                from { opacity: 0; transform: translateY(10px) scale(0.95); }
                to { opacity: 1; transform: translateY(0) scale(1); }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes connectionGlow {
                0%, 100% { box-shadow: 0 0 12px rgba(67, 181, 129, 0.3); }
                50% { box-shadow: 0 0 20px rgba(67, 181, 129, 0.6); }
            }
            @keyframes screenShareGlow {
                0%, 100% { border-color: rgba(88, 101, 242, 0.5); }
                50% { border-color: rgba(88, 101, 242, 0.9); }
            }

            /* Smooth grid transitions */
            .voice-grid-item {
                animation: slideIn 0.3s ease forwards;
            }
            /* Video card hover effects */
            .voice-video-card:hover {
                transform: scale(1.01);
                z-index: 10;
            }
            /* Active speaker highlight */
            .voice-active-speaker {
                animation: connectionGlow 2s ease-in-out infinite;
            }
            /* Screen share border animation */
            .voice-screen-share {
                animation: screenShareGlow 2s ease-in-out infinite;
            }
    `,document.head.appendChild(e)}o(ft,"injectVoicePanelStyles");ft();const mt=o(({roomName:e,onClose:n,isMinimized:i,onToggleMinimize:r,showHeader:p=!0,getRealUserAvatar:f,allUsers:a=[],currentUserProfile:c})=>{const{isInVoice:s,isMuted:u,isDeafened:h,isVideoEnabled:v,isScreenSharing:d,isSpatialAudioEnabled:w,screenShareQuality:j,screenShareFPS:l,isRecording:m,recordingDuration:g,isPTTMode:T,isPTTActive:S,pttKey:I,includeSystemAudio:b,connectedUsers:_=[],isReconnecting:K=!1,startStatsMonitoring:D,stopStatsMonitoring:ne,toggleMute:q,toggleDeafened:E,toggleCamera:R,toggleScreenShare:z,toggleSpatialAudio:C,updateScreenQuality:k,startRecording:A,stopRecording:y,leaveVoiceRoom:M,localAudioStream:P,remoteStreams:L={},remoteVolumes:B={},setRemoteVolume:N,localCameraStream:H,localScreenStream:V,isTalking:Y=!1}=Je(),ae=v,{user:oe}=Ze(),{combinedUsers:G,getUserAvatar:ie,allStreams:X}=rt({connectedUsers:_,currentUser:oe,isMuted:u,isCameraOn:ae,isScreenSharing:d,isTalking:Y,currentUserProfile:c,getRealUserAvatar:f,allUsers:a,remoteStreams:L,localCameraStream:H,localScreenStream:V}),[re,xe]=x.useState(null),[Ee,ze]=x.useState(null),[Ae,ue]=x.useState(!1),[se,J]=x.useState(null),[ge,Re]=x.useState(()=>{try{const $=localStorage.getItem("pawscord_voice_volumes");return $?JSON.parse($):{}}catch{return{}}}),[Ie,Me]=x.useState(!0),{connectionQuality:_e,hasEchoRisk:$e,networkQuality:Le,networkType:We,talkingIndicators:Ne,activeSpeaker:fe}=ot({isInVoice:s,localAudioStream:P,isMuted:u,startStatsMonitoring:D,stopStatsMonitoring:ne,screenShareQuality:j,updateScreenQuality:k});x.useEffect(()=>{const $=o(()=>{ue(!0)},"handleOpenSettings");return window.addEventListener("openVoiceSettings",$),()=>window.removeEventListener("openVoiceSettings",$)},[]),x.useEffect(()=>{try{localStorage.setItem("pawscord_voice_volumes",JSON.stringify(ge))}catch{}},[ge]);const{isMobile:le}=Qe(),me=re?"fullscreen":i?"minimized":le?"mobile":"grid";x.useEffect(()=>{s||n()},[s,n]);const he=G.length,{handleSendMessage:De,handleAddFriend:Be,handleBlock:Fe,handleViewProfile:Pe,handleMuteUser:Ve,handleAdjustVolume:Ke}=it({setContextMenu:J,setVolumeSettings:Re}),qe=x.useCallback($=>J($),[]),Ge=x.useCallback(()=>xe(null),[]),Oe=x.useCallback(()=>Me(!1),[]),He=x.useCallback(()=>ue(!1),[]),Ye=x.useCallback(()=>J(null),[]);return me==="minimized"?t.jsx(ke,{roomName:e,userCount:he,combinedUsers:G,currentUser:oe,onToggleMinimize:r,onContextMenu:qe,getUserAvatar:ie,isMuted:u,isCameraOn:ae,isScreenSharing:d,toggleMute:q,toggleCamera:R,toggleScreenShare:z,leaveVoice:M}):me==="fullscreen"&&re?t.jsx(we,{expandedUser:re,allStreams:X,onBack:Ge,isMuted:u,isDeafened:h,isCameraOn:ae,isScreenSharing:d,isSpatialAudioEnabled:w,isRecording:m,recordingDuration:g,toggleMute:q,toggleDeafened:E,toggleCamera:R,toggleScreenShare:z,toggleSpatialAudio:C,startRecording:A,stopRecording:y,leaveVoice:M}):t.jsxs("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #1e1e1e 0%, #2c2c2c 100%)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[p&&t.jsx(Ce,{roomName:e,userCount:he,onToggleMinimize:r,isRecording:m,recordingDuration:g,isScreenSharing:d,screenShareQuality:j,screenShareFPS:l,includeSystemAudio:b,isPTTMode:T,pttKey:I,isPTTActive:S,isReconnecting:K,networkQuality:Le,networkType:We}),t.jsx("div",{style:{flex:1,padding:"20px",display:"flex",flexDirection:"column",overflow:"auto",position:"relative",minHeight:0},children:(()=>{const $={combinedUsers:G,allStreams:X,remoteVolumes:B,setRemoteVolume:N,talkingIndicators:Ne,activeSpeaker:fe,pinnedUser:Ee,setPinnedUser:ze,setExpandedUser:xe,setContextMenu:J,connectionQuality:_e,getUserAvatar:ie,isMobile:le},be=G.filter(Z=>Z.isScreenSharing&&X[`${Z.username}_screen`]);return be.length>0?t.jsx(pe,{...$,screenShares:be}):G.some(Z=>{const ye=X[`${Z.username}_camera`]||X[Z.username];return ye&&ye.active})?t.jsx(pe,{...$}):t.jsx(Se,{combinedUsers:G,activeSpeaker:fe,getUserAvatar:ie,setContextMenu:J,isMobile:le})})()}),$e&&Ie&&t.jsx(Te,{onDismiss:Oe}),Ae&&t.jsx(et,{onClose:He,channelId:e}),se&&t.jsx(Ue,{user:se.user,position:se.position,onClose:Ye,onSendMessage:De,onAddFriend:Be,onBlock:Fe,onViewProfile:Pe,onMuteUser:Ve,onAdjustVolume:Ke,currentUser:oe,isInVoiceChat:!0})]})},"VoiceChatPanel"),Rt=W.memo(mt);export{Rt as default};
