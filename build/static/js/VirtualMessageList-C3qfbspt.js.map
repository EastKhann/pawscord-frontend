{"version":3,"file":"VirtualMessageList-C3qfbspt.js","sources":["../../../src/components/VirtualMessageList.js"],"sourcesContent":["// frontend/src/components/VirtualMessageList.js\r\nimport React, { useRef, useEffect, useCallback, memo } from 'react';\r\nimport { VariableSizeList as List } from 'react-window';\r\nimport { AutoSizer } from 'react-virtualized-auto-sizer'; // âš¡ FIX: Named import destructured\r\n\r\n/**\r\n * ðŸš€ Virtual Message List - Performans iÃ§in virtual scrolling\r\n * Binlerce mesaj olsa bile sadece gÃ¶rÃ¼nÃ¼r olanlarÄ± render eder\r\n * Bellek kullanÄ±mÄ±nÄ± ve render sÃ¼resini %90 azaltÄ±r\r\n * \r\n * ðŸ”¥ OPTIMIZATION: React.memo ile gereksiz re-render'lar engellendi\r\n */\r\n\r\n// âš¡ OPTIMIZATION: Row component is now memoized to prevent unnecessary re-renders\r\nconst Row = memo(({ index, style, data }) => {\r\n    const { messages, renderMessage, setItemSize, getItemSize } = data;\r\n    const rowRef = useRef();\r\n\r\n    useEffect(() => {\r\n        if (rowRef.current) {\r\n            const height = rowRef.current.getBoundingClientRect().height;\r\n            if (height !== getItemSize(index)) {\r\n                setItemSize(index, height);\r\n            }\r\n        }\r\n    }, [index, getItemSize, setItemSize]);\r\n\r\n    const message = messages[index];\r\n    if (!message) return null;\r\n\r\n    return (\r\n        <div style={style} ref={rowRef}>\r\n            {renderMessage(message, index)}\r\n        </div>\r\n    );\r\n}, (prevProps, nextProps) => {\r\n    // Custom comparison: only re-render if message data or style changes\r\n    return (\r\n        prevProps.index === nextProps.index &&\r\n        prevProps.style.top === nextProps.style.top &&\r\n        prevProps.style.height === nextProps.style.height &&\r\n        prevProps.data.messages[prevProps.index]?.id === nextProps.data.messages[nextProps.index]?.id &&\r\n        prevProps.data.messages[prevProps.index]?.content === nextProps.data.messages[nextProps.index]?.content &&\r\n        prevProps.data.messages[prevProps.index]?.reactions?.length === nextProps.data.messages[nextProps.index]?.reactions?.length\r\n    );\r\n});\r\n\r\nRow.displayName = 'VirtualMessageRow';\r\n\r\nconst VirtualMessageList = memo(({\r\n    messages,\r\n    renderMessage,\r\n    scrollToBottom = false,\r\n    estimatedItemSize = 80\r\n}) => {\r\n    const listRef = useRef();\r\n    const sizeMap = useRef({});\r\n\r\n    // âš¡ OPTIMIZATION: Memoized callbacks to prevent re-renders\r\n    const getItemSize = useCallback((index) => {\r\n        return sizeMap.current[index] || estimatedItemSize;\r\n    }, [estimatedItemSize]);\r\n\r\n    const setItemSize = useCallback((index, size) => {\r\n        if (sizeMap.current[index] !== size) {\r\n            sizeMap.current[index] = size;\r\n            if (listRef.current) {\r\n                listRef.current.resetAfterIndex(index, false);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // En alta scroll et (yeni mesaj geldiÄŸinde)\r\n    useEffect(() => {\r\n        if (scrollToBottom && listRef.current && messages.length > 0) {\r\n            // âš¡ OPTIMIZATION: Use requestAnimationFrame for smoother scrolling\r\n            requestAnimationFrame(() => {\r\n                listRef.current?.scrollToItem(messages.length - 1, 'end');\r\n            });\r\n        }\r\n    }, [messages.length, scrollToBottom]);\r\n\r\n    // âš¡ OPTIMIZATION: Reset cache when messages change significantly\r\n    useEffect(() => {\r\n        if (messages.length === 0) {\r\n            sizeMap.current = {};\r\n        }\r\n    }, [messages.length]);\r\n\r\n    // âš¡ OPTIMIZATION: Memoized itemData to prevent Row re-renders\r\n    const itemData = React.useMemo(() => ({\r\n        messages,\r\n        renderMessage,\r\n        setItemSize,\r\n        getItemSize\r\n    }), [messages, renderMessage, setItemSize, getItemSize]);\r\n\r\n    if (!messages || messages.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <AutoSizer>\r\n            {({ height, width }) => (\r\n                <List\r\n                    ref={listRef}\r\n                    height={height}\r\n                    width={width}\r\n                    itemCount={messages.length}\r\n                    itemSize={getItemSize}\r\n                    itemData={itemData}\r\n                    overscanCount={3} // âš¡ OPTIMIZATION: Reduced from 5 to 3 for better performance\r\n                    useIsScrolling // âš¡ OPTIMIZATION: Enable isScrolling prop for performance\r\n                >\r\n                    {Row}\r\n                </List>\r\n            )}\r\n        </AutoSizer>\r\n    );\r\n});\r\n\r\nVirtualMessageList.displayName = 'VirtualMessageList';\r\n\r\nexport default VirtualMessageList;\r\n\r\n\r\n"],"names":["memo","useRef","useEffect","jsx","useCallback","AutoSizer","List"],"mappings":"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"}