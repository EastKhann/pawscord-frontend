import{r as o,n as e}from"./react-core-BMiyQWF6.js";import{t as n}from"./index-CAB0Mj32.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./icons-vendor-GUGjkvMm.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const I=({roomId:c,apiBaseUrl:i,onClose:m,currentUser:_})=>{const[p,x]=o.useState([]),[C,w]=o.useState(null),[j,k]=o.useState(!0),[g,d]=o.useState("list"),[r,l]=o.useState({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0});o.useEffect(()=>{u();const s=setInterval(u,5e3);return()=>clearInterval(s)},[c]);const u=async()=>{try{const s=localStorage.getItem("access_token"),a=c?`${i}/stages/active/`:`${i}/stages/active/`,t=await fetch(a,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const h=await t.json();x(Array.isArray(h)?h:h.stages||[])}}catch{}finally{k(!1)}},v=async()=>{if(!r.topic.trim()){n.error("âš ï¸ Konu baÅŸlÄ±ÄŸÄ± gerekli");return}if(!c){n.error("âš ï¸ LÃ¼tfen bir ses kanalÄ±nda olun");return}try{const s=localStorage.getItem("access_token"),a=await fetch(`${i}/stages/create/${c}/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const t=await a.json();x([...p,t.stage]),l({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0}),d("list"),n.success("âœ… Stage oluÅŸturuldu!")}else{const t=await a.json();n.error(t.error||"âŒ Stage oluÅŸturulamadÄ±")}}catch{n.error("âŒ Hata oluÅŸtu")}},N=async s=>{try{const a=localStorage.getItem("access_token"),t=await fetch(`${i}/stages/${s}/join/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(t.ok)n.success("ðŸŽ™ï¸ Stage'e katÄ±ldÄ±n!"),u();else{const h=await t.json();n.error(h.error||"âŒ Stage'e katÄ±lamadÄ±n")}}catch{n.error("âŒ Hata oluÅŸtu")}},S=async s=>{try{const a=localStorage.getItem("access_token");(await fetch(`${i}/stages/${s}/leave/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(n.success("ðŸ‘‹ Stage'den ayrÄ±ldÄ±n"),u())}catch{}},b=async s=>{try{const a=localStorage.getItem("access_token");(await fetch(`${i}/stages/${s}/request-speak/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&n.success("âœ‹ KonuÅŸma talebi gÃ¶nderildi")}catch{}},f=s=>({host:"ðŸ‘‘",moderator:"ðŸ›¡ï¸",speaker:"ðŸŽ™ï¸",listener:"ðŸ‘‚"})[s]||"ðŸ‘¤",y=s=>({host:"#faa61a",moderator:"#8b5cf6",speaker:"#34c759",listener:"#6c6d7d"})[s]||"#6c6d7d";return j?e.jsx("div",{className:"stage-overlay",onClick:m,children:e.jsx("div",{className:"stage-panel",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"stage-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"stage-overlay",onClick:m,children:e.jsxs("div",{className:"stage-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"stage-header",children:[e.jsx("h2",{children:"ðŸŽ™ï¸ Stage KanallarÄ±"}),e.jsxs("div",{className:"header-actions",children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`view-toggle ${g==="list"?"active":""}`,onClick:()=>d("list"),children:"ðŸ“‹ Aktif Stage'ler"}),e.jsx("button",{className:`view-toggle ${g==="create"?"active":""}`,onClick:()=>d("create"),children:"âž• OluÅŸtur"})]}),e.jsx("button",{className:"close-btn",onClick:m,children:"âœ•"})]})]}),e.jsx("div",{className:"stage-content",children:g==="list"?e.jsx("div",{className:"stages-list",children:p.length>0?p.map(s=>e.jsxs("div",{className:"stage-card",children:[e.jsxs("div",{className:"stage-info",children:[e.jsx("div",{className:"stage-icon",children:"ðŸŽ™ï¸"}),e.jsxs("div",{className:"stage-details",children:[e.jsx("h3",{children:s.topic}),s.description&&e.jsx("p",{className:"stage-description",children:s.description}),e.jsxs("div",{className:"stage-meta",children:[e.jsxs("span",{children:["ðŸ‘‘ Host: ",s.host_username]}),e.jsxs("span",{children:["ðŸŽ™ï¸ ",s.speakers_count||0," konuÅŸmacÄ±"]}),e.jsxs("span",{children:["ðŸ‘‚ ",s.audience_count||0," dinleyici"]})]})]})]}),s.speakers&&s.speakers.length>0&&e.jsxs("div",{className:"speakers-list",children:[e.jsx("h4",{children:"KonuÅŸmacÄ±lar"}),e.jsxs("div",{className:"speakers-grid",children:[s.speakers.slice(0,6).map((a,t)=>e.jsxs("div",{className:"speaker-badge",children:[e.jsx("span",{className:"role-icon",style:{color:y(a.role)},children:f(a.role)}),e.jsx("span",{className:"speaker-name",children:a.username})]},t)),s.speakers.length>6&&e.jsxs("div",{className:"speaker-badge more",children:["+",s.speakers.length-6]})]})]}),e.jsx("div",{className:"stage-actions",children:s.is_member?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"leave-stage-btn",onClick:()=>S(s.id),children:"ðŸ‘‹ AyrÄ±l"}),s.user_role==="listener"&&e.jsx("button",{className:"request-speak-btn",onClick:()=>b(s.id),children:"âœ‹ KonuÅŸmak Ä°stiyorum"})]}):e.jsx("button",{className:"join-stage-btn",onClick:()=>N(s.id),children:"ðŸŽ§ Dinle"})})]},s.id)):e.jsxs("div",{className:"no-stages",children:[e.jsx("p",{children:"ðŸŽ™ï¸ Aktif stage yok"}),c&&e.jsx("button",{onClick:()=>d("create"),children:"Ä°lk stage'i oluÅŸtur"})]})}):e.jsxs("div",{className:"create-stage-form",children:[e.jsx("h3",{children:"ðŸŽ™ï¸ Yeni Stage OluÅŸtur"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Konu BaÅŸlÄ±ÄŸÄ± *"}),e.jsx("input",{type:"text",placeholder:"KonuÅŸma konusu...",value:r.topic,onChange:s=>l({...r,topic:s.target.value}),maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"AÃ§Ä±klama"}),e.jsx("textarea",{placeholder:"Stage hakkÄ±nda detaylar...",value:r.description,onChange:s=>l({...r,description:s.target.value}),rows:4})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Maks. KonuÅŸmacÄ± (1-10)"}),e.jsx("input",{type:"number",value:r.max_speakers,onChange:s=>l({...r,max_speakers:Math.min(10,Math.max(1,parseInt(s.target.value)||1))}),min:"1",max:"10"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Maks. Dinleyici"}),e.jsx("input",{type:"number",value:r.max_audience,onChange:s=>l({...r,max_audience:Math.min(1e3,Math.max(1,parseInt(s.target.value)||100))}),min:"1",max:"1000"})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.is_public,onChange:s=>l({...r,is_public:s.target.checked})}),e.jsx("span",{children:"ðŸŒ Herkese AÃ§Ä±k"})]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:v,children:"âœ¨ Stage OluÅŸtur"}),e.jsx("button",{className:"cancel-btn",onClick:()=>d("list"),children:"Ä°ptal"})]})]})})]})})};export{I as default};
