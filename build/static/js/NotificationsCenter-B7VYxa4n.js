import{r as a,n as e}from"./react-core-zXIKm1Jm.js";import{g as f,aY as G,a as T,cA as K,$ as Q,W as V,k as X,ap as Z}from"./icons-vendor-BBdoVeJd.js";import{g as c}from"./index-C6RxTn2S.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const re=({userId:i,onClose:M})=>{const[l,h]=a.useState([]),[m,x]=a.useState(0),[d,j]=a.useState("all"),[I,P]=a.useState(null),[g,N]=a.useState(!1),[O,D]=a.useState(!0),[p,v]=a.useState(!0),[b,y]=a.useState(!0),[k,S]=a.useState(!1),[w,$]=a.useState(!1),[C,E]=a.useState(!0);a.useEffect(()=>{R(),B()},[i,d]);const o=async(s,t={})=>{const _=localStorage.getItem("access_token"),r=await fetch(s,{...t,headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json",...t.headers}});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()},R=async()=>{try{const s=await o(`${c()}/notifications/${i}/list/?filter=${d}`);h(s.notifications||[]),x(s.unread_count||0)}catch(s){console.error("Notifications fetch error:",s)}finally{D(!1)}},B=async()=>{try{const s=await o(`${c()}/notifications/${i}/settings/`);P(s),v(s.push_enabled),y(s.email_enabled),S(s.mentions_only),$(s.dnd_enabled),E(s.sound_enabled)}catch(s){console.error("Settings fetch error:",s)}},L=async s=>{try{await o(`${c()}/notifications/${i}/${s}/read/`,{method:"POST"}),h(l.map(t=>t.id===s?{...t,read:!0}:t)),x(Math.max(0,m-1))}catch(t){console.error("Mark as read error:",t)}},U=async()=>{try{await o(`${c()}/notifications/${i}/read-all/`,{method:"POST"}),h(l.map(s=>({...s,read:!0}))),x(0),n("All notifications marked as read!")}catch(s){console.error("Mark all as read error:",s),n("Failed to mark as read","error")}},z=async s=>{try{await o(`${c()}/notifications/${i}/${s}/delete/`,{method:"DELETE"}),h(l.filter(t=>t.id!==s)),n("Notification deleted!")}catch(t){console.error("Delete notification error:",t),n("Failed to delete notification","error")}},J=async()=>{if(window.confirm("Are you sure you want to clear all notifications?"))try{await o(`${c()}/notifications/${i}/clear/`,{method:"POST"}),h([]),x(0),n("All notifications cleared!")}catch(s){console.error("Clear all error:",s),n("Failed to clear notifications","error")}},W=async()=>{try{await o(`${c()}/notifications/${i}/settings/update/`,{method:"PUT",body:JSON.stringify({push_enabled:p,email_enabled:b,mentions_only:k,dnd_enabled:w,sound_enabled:C})}),n("Settings updated!"),N(!1)}catch(s){console.error("Settings update error:",s),n("Failed to update settings","error")}},Y=async()=>{try{await o(`${c()}/notifications/${i}/test/`,{method:"POST"}),n("Test notification sent!")}catch(s){console.error("Test notification error:",s),n("Failed to send test notification","error")}},H=s=>{switch(s){case"mention":return"ðŸ’¬";case"reply":return"â†©ï¸";case"like":return"â¤ï¸";case"follow":return"ðŸ‘¤";case"server_invite":return"ðŸ“§";case"role_update":return"ðŸ·ï¸";case"announcement":return"ðŸ“¢";default:return"ðŸ””"}},q=s=>{const t=new Date(s),r=new Date-t,u=Math.floor(r/6e4),A=Math.floor(r/36e5),F=Math.floor(r/864e5);return u<1?"Just now":u<60?`${u}m ago`:A<24?`${A}h ago`:F<7?`${F}d ago`:t.toLocaleDateString()},n=(s,t="success")=>{console.log(`[${t}] ${s}`)};return O?e.jsx("div",{className:"notifications-overlay",children:e.jsxs("div",{className:"notifications-panel loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading Notifications..."})]})}):e.jsx("div",{className:"notifications-overlay",children:e.jsxs("div",{className:"notifications-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[e.jsx(f,{})," Notifications"]}),m>0&&e.jsxs("span",{className:"unread-badge",children:[m," new"]})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:()=>N(!g),className:"btn-settings",children:e.jsx(G,{})}),e.jsx("button",{onClick:M,className:"btn-close",children:e.jsx(T,{})})]})]}),e.jsxs("div",{className:"filter-bar",children:[e.jsx("button",{className:d==="all"?"active":"",onClick:()=>j("all"),children:"All"}),e.jsx("button",{className:d==="unread"?"active":"",onClick:()=>j("unread"),children:"Unread"}),e.jsx("button",{className:d==="mentions"?"active":"",onClick:()=>j("mentions"),children:"Mentions"}),e.jsx("button",{className:d==="servers"?"active":"",onClick:()=>j("servers"),children:"Servers"})]}),g&&e.jsxs("div",{className:"settings-panel",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(K,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Push Notifications"}),e.jsx("p",{children:"Receive notifications on your device"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>v(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(Q,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Email Notifications"}),e.jsx("p",{children:"Receive notifications via email"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>y(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(f,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Sound Effects"}),e.jsx("p",{children:"Play sound when you receive notifications"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>E(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mentions Only"}),e.jsx("p",{children:"Only notify when you're mentioned"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>S(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(X,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Do Not Disturb"}),e.jsx("p",{children:"Mute all notifications temporarily"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>$(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{onClick:Y,className:"btn-test",children:"Test Notification"}),e.jsx("button",{onClick:W,className:"btn-save",children:"Save Settings"})]})]}),e.jsxs("div",{className:"panel-actions",children:[m>0&&e.jsxs("button",{onClick:U,className:"btn-mark-read",children:[e.jsx(Z,{})," Mark All as Read"]}),l.length>0&&e.jsx("button",{onClick:J,className:"btn-clear",children:"Clear All"})]}),e.jsx("div",{className:"notifications-content",children:l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(f,{size:64}),e.jsx("h3",{children:"No Notifications"}),e.jsx("p",{children:"You're all caught up!"})]}):e.jsx("div",{className:"notifications-list",children:l.map(s=>e.jsxs("div",{className:`notification-item ${s.read?"":"unread"}`,onClick:()=>!s.read&&L(s.id),children:[e.jsx("div",{className:"notification-icon",children:H(s.type)}),e.jsxs("div",{className:"notification-body",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:s.title}),e.jsx("span",{className:"notification-time",children:q(s.created_at)})]}),e.jsx("p",{className:"notification-message",children:s.message}),s.server_name&&e.jsxs("span",{className:"notification-server",children:["in ",s.server_name]})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),z(s.id)},className:"btn-delete-notification",children:e.jsx(T,{})}),!s.read&&e.jsx("div",{className:"unread-dot"})]},s.id))})})]})})};export{re as default};
