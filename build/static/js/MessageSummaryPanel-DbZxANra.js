import{r as l,d as e,X as k,i as G,dv as H,ax as w,U as f,aB as m,O as z,bU as A,aN as O,ci as P,cd as j}from"./react-core-DrOm_csO.js";import{p as I}from"./purify.es-HRjpPm7y.js";const U=({channelId:p,onClose:c,fetchWithAuth:o,apiBaseUrl:i})=>{const[_,v]=l.useState(!1),[n,u]=l.useState([]),[s,N]=l.useState(null),[h,S]=l.useState(!1),[d,F]=l.useState("24h"),[E,D]=l.useState(100),[g,L]=l.useState(p),[C,b]=l.useState([]);l.useEffect(()=>{$()},[p]);const $=async()=>{v(!0);try{const a=await o(`${i}/rooms/list/`);if(a.ok){const r=await a.json();b(r.rooms||r||[])}const t=await o(`${i}/messages/summaries/`);if(t.ok){const r=await t.json();u(r.summaries||r||[])}}catch(a){console.error("Error loading data:",a),b([]),u([])}v(!1)},x=async()=>{S(!0);try{const a=await o(`${i}/messages/summarize/`,{method:"POST",body:JSON.stringify({channel_id:g,time_range:d,message_count:E})});if(a.ok){const t=await a.json(),r={id:t.id||Date.now(),channel:C.find(T=>T.id===g)?.name||"general",created_at:new Date().toISOString(),time_range:d,message_count:t.message_count||E,summary:t.summary||"Özet oluşturulamadı.",keywords:t.keywords||[],participants:t.participants||0};N(r),u([r,...n])}else console.error("Summary generation failed")}catch(a){console.error("Error generating summary:",a)}S(!1)},y=a=>new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=a=>{navigator.clipboard.writeText(a)},R=a=>{const t=`# Message Summary - ${a.channel}

Generated: ${y(a.created_at)}
Messages Analyzed: ${a.message_count}
Time Range: ${a.time_range}

${a.summary}`;console.log("Exporting:",t)};return _?e.createElement("div",{className:"summary-overlay",onClick:c},e.createElement("div",{className:"summary-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"loading"},"Loading message summary..."))):e.createElement("div",{className:"summary-overlay",onClick:c},e.createElement("div",{className:"summary-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"panel-header"},e.createElement("div",{className:"header-info"},e.createElement("h2",null,e.createElement(k,null),"AI Message Summary"),e.createElement("span",{className:"subtitle"},"Summarize channel conversations with AI")),e.createElement("button",{className:"close-btn",onClick:c},e.createElement(G,null))),e.createElement("div",{className:"summary-content"},e.createElement("div",{className:"generator-section"},e.createElement("h3",null,e.createElement(H,null)," Generate Summary"),e.createElement("div",{className:"generator-controls"},e.createElement("div",{className:"control-group"},e.createElement("label",null,e.createElement(w,null)," Channel"),e.createElement("select",{value:g,onChange:a=>L(Number(a.target.value))},C.map(a=>e.createElement("option",{key:a.id,value:a.id},"#",a.name)))),e.createElement("div",{className:"control-group"},e.createElement("label",null,e.createElement(f,null)," Time Range"),e.createElement("select",{value:d,onChange:a=>F(a.target.value)},e.createElement("option",{value:"1h"},"Last Hour"),e.createElement("option",{value:"6h"},"Last 6 Hours"),e.createElement("option",{value:"24h"},"Last 24 Hours"),e.createElement("option",{value:"7d"},"Last 7 Days"),e.createElement("option",{value:"30d"},"Last 30 Days"))),e.createElement("div",{className:"control-group"},e.createElement("label",null,e.createElement(m,null)," Max Messages"),e.createElement("select",{value:E,onChange:a=>D(Number(a.target.value))},e.createElement("option",{value:50},"50 messages"),e.createElement("option",{value:100},"100 messages"),e.createElement("option",{value:250},"250 messages"),e.createElement("option",{value:500},"500 messages"))),e.createElement("button",{className:"generate-btn",onClick:x,disabled:h},h?e.createElement(e.Fragment,null,e.createElement(z,{className:"spinning"}),"Generating..."):e.createElement(e.Fragment,null,e.createElement(k,null),"Generate Summary")))),(s||n.length>0)&&e.createElement("div",{className:"summary-display"},e.createElement("div",{className:"summary-header"},e.createElement("h3",null,e.createElement(m,null),s?"Generated Summary":"Latest Summary"),e.createElement("div",{className:"summary-actions"},e.createElement("button",{className:"action-btn",onClick:()=>M((s||n[0]).summary)},e.createElement(A,null)," Copy"),e.createElement("button",{className:"action-btn",onClick:()=>R(s||n[0])},e.createElement(O,null)," Export"))),e.createElement("div",{className:"summary-meta"},e.createElement("span",{className:"meta-item"},e.createElement(w,null)," #",(s||n[0]).channel),e.createElement("span",{className:"meta-item"},e.createElement(f,null)," ",(s||n[0]).time_range),e.createElement("span",{className:"meta-item"},e.createElement(m,null)," ",(s||n[0]).message_count," messages"),e.createElement("span",{className:"meta-item"},e.createElement(P,null)," ",y((s||n[0]).created_at))),e.createElement("div",{className:"summary-body"},e.createElement("div",{className:"summary-text",dangerouslySetInnerHTML:{__html:I.sanitize((s||n[0]).summary.replace(/## /g,"<h4>").replace(/\n\n/g,`</h4>
`).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/- /g,"• ").replace(/\n/g,"<br/>"))}})),e.createElement("div",{className:"summary-keywords"},e.createElement("span",{className:"keywords-label"},"Keywords:"),(s||n[0]).keywords.map((a,t)=>e.createElement("span",{key:t,className:"keyword-chip"},a)))),e.createElement("div",{className:"history-section"},e.createElement("h3",null,e.createElement(j,null)," Summary History"),e.createElement("div",{className:"history-list"},n.map(a=>e.createElement("div",{key:a.id,className:`history-item ${s?.id===a.id?"active":""}`,onClick:()=>N(a)},e.createElement("div",{className:"history-icon"},e.createElement(m,null)),e.createElement("div",{className:"history-info"},e.createElement("span",{className:"history-channel"},"#",a.channel),e.createElement("span",{className:"history-meta"},a.message_count," messages • ",a.time_range)),e.createElement("div",{className:"history-date"},y(a.created_at)))))))))};export{U as default};
