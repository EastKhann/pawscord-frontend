import{r,aj as L,l as I,H as k,V as R,Y as _,o as x}from"./react-core-B6hadH-M.js";import{t as z}from"./index-D_6pZib5.js";const P=({fetchWithAuth:c,apiBaseUrl:d,onClose:m,username:i})=>{const[l,o]=r.useState(null),[p,y]=r.useState([]),[f,E]=r.useState([]),[h,u]=r.useState(!0),[g,v]=r.useState("24h"),[T,b]=r.useState(null);r.useEffect(()=>{S()},[g]);const S=async()=>{u(!0);try{const n=await(await c(`${d}/analytics/usage/?range=${g}`)).json();o(n.stats||{}),y(n.endpoints||[]),E(n.timeline||[])}catch(t){console.error("Failed to load API usage:",t),z.error("Failed to load analytics")}finally{u(!1)}},C=()=>{if(!l||!l.rate_limit)return{color:"#43b581",text:"Normal"};const n=(l.requests_made||0)/l.rate_limit*100;return n>=90?{color:"#f04747",text:"Critical"}:n>=70?{color:"#faa61a",text:"Warning"}:{color:"#43b581",text:"Normal"}},a=l||{requests_made:0,rate_limit:1e4,success_rate:0,avg_response_time:0,errors:0},s=C();return React.createElement("div",{style:e.overlay,onClick:m},React.createElement("div",{style:e.modal,onClick:t=>t.stopPropagation()},React.createElement("div",{style:e.header},React.createElement("div",{style:e.headerLeft},React.createElement(L,{style:{fontSize:"24px",color:"#5865f2"}}),React.createElement("h2",{style:{margin:0,fontSize:"20px"}},"API Usage Analytics")),React.createElement("div",{style:e.headerRight},React.createElement("select",{value:g,onChange:t=>v(t.target.value),style:e.timeRangeSelect},React.createElement("option",{value:"24h"},"Last 24 Hours"),React.createElement("option",{value:"7d"},"Last 7 Days"),React.createElement("option",{value:"30d"},"Last 30 Days")),React.createElement("button",{onClick:m,style:e.closeBtn},React.createElement(I,null)))),React.createElement("div",{style:e.content},h?React.createElement("div",{style:e.loading},"Loading analytics..."):React.createElement(React.Fragment,null,React.createElement("div",{style:e.statsGrid},React.createElement("div",{style:e.statCard},React.createElement("div",{style:e.statIcon},React.createElement(k,{style:{color:"#5865f2"}})),React.createElement("div",{style:e.statInfo},React.createElement("div",{style:e.statValue},(a.requests_made||0).toLocaleString()),React.createElement("div",{style:e.statLabel},"Total Requests"))),React.createElement("div",{style:e.statCard},React.createElement("div",{style:e.statIcon},React.createElement(R,{style:{color:"#43b581"}})),React.createElement("div",{style:e.statInfo},React.createElement("div",{style:e.statValue},a.success_rate?`${a.success_rate.toFixed(1)}%`:"0%"),React.createElement("div",{style:e.statLabel},"Success Rate"))),React.createElement("div",{style:e.statCard},React.createElement("div",{style:e.statIcon},React.createElement(_,{style:{color:"#faa61a"}})),React.createElement("div",{style:e.statInfo},React.createElement("div",{style:e.statValue},a.avg_response_time?`${a.avg_response_time}ms`:"0ms"),React.createElement("div",{style:e.statLabel},"Avg Response Time"))),React.createElement("div",{style:e.statCard},React.createElement("div",{style:e.statIcon},React.createElement(x,{style:{color:"#f04747"}})),React.createElement("div",{style:e.statInfo},React.createElement("div",{style:e.statValue},a.errors||0),React.createElement("div",{style:e.statLabel},"Errors")))),React.createElement("div",{style:e.section},React.createElement("h3",{style:e.sectionTitle},"Rate Limit Status"),React.createElement("div",{style:{...e.rateLimitCard,borderLeftColor:s.color}},React.createElement("div",{style:e.rateLimitInfo},React.createElement("div",{style:e.rateLimitText},a.requests_made||0," / ",a.rate_limit||1e4," requests used"),React.createElement("div",{style:{...e.rateLimitStatus,color:s.color}},s.text)),React.createElement("div",{style:e.rateLimitBar},React.createElement("div",{style:{...e.rateLimitProgress,width:`${Math.min((a.requests_made||0)/(a.rate_limit||1e4)*100,100)}%`,backgroundColor:s.color}})),a.reset_at&&React.createElement("div",{style:e.rateLimitReset},"Resets in: ",w(a.reset_at)))),React.createElement("div",{style:e.section},React.createElement("h3",{style:e.sectionTitle},"Top Endpoints"),React.createElement("div",{style:e.endpointsList},p.length===0?React.createElement("div",{style:e.empty},"No endpoint data"):p.slice(0,10).map((t,n)=>React.createElement("div",{key:n,style:e.endpointItem,onClick:()=>b(t)},React.createElement("div",{style:e.endpointRank},"#",n+1),React.createElement("div",{style:e.endpointDetails},React.createElement("div",{style:e.endpointPath},React.createElement("span",{style:e.endpointMethod},t.method),t.path),React.createElement("div",{style:e.endpointStats},React.createElement("span",null,t.count," requests"),React.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),React.createElement("span",null,t.avg_time,"ms avg"),t.error_rate>0&&React.createElement(React.Fragment,null,React.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),React.createElement("span",{style:{color:"#f04747"}},t.error_rate,"% errors")))),React.createElement("div",{style:e.endpointBar},React.createElement("div",{style:{...e.endpointBarFill,width:`${t.count/p[0].count*100}%`,backgroundColor:t.error_rate>5?"#f04747":"#5865f2"}})))))),React.createElement("div",{style:e.section},React.createElement("h3",{style:e.sectionTitle},"Recent Activity"),React.createElement("div",{style:e.timeline},f.length===0?React.createElement("div",{style:e.empty},"No recent activity"):f.slice(0,20).map((t,n)=>React.createElement("div",{key:n,style:e.timelineItem},React.createElement("div",{style:{...e.timelineIcon,backgroundColor:t.status>=400?"#f04747":"#43b581"}},t.status>=400?React.createElement(x,null):React.createElement(R,null)),React.createElement("div",{style:e.timelineContent},React.createElement("div",{style:e.timelinePath},React.createElement("span",{style:e.timelineMethod},t.method),t.path),React.createElement("div",{style:e.timelineMeta},React.createElement("span",{style:{color:t.status>=400?"#f04747":"#43b581"}},t.status),React.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),React.createElement("span",null,t.response_time,"ms"),React.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),React.createElement("span",null,new Date(t.timestamp).toLocaleTimeString())))))))))))},w=c=>{const d=new Date,i=new Date(c)-d;if(i<=0)return"Soon";const l=Math.floor(i/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60));return l>0?`${l}h ${o}m`:`${o}m`},e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerRight:{display:"flex",alignItems:"center",gap:"12px"},timeRangeSelect:{padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px",cursor:"pointer"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},statCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",display:"flex",alignItems:"center",gap:"16px"},statIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},statInfo:{flex:1},statValue:{fontSize:"28px",fontWeight:"bold",marginBottom:"4px"},statLabel:{fontSize:"12px",color:"#99aab5",textTransform:"uppercase",letterSpacing:"1px"},section:{marginBottom:"32px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},rateLimitCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",borderLeft:"4px solid"},rateLimitInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},rateLimitText:{fontSize:"14px",fontWeight:"600"},rateLimitStatus:{fontSize:"14px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px"},rateLimitBar:{height:"8px",backgroundColor:"#202225",borderRadius:"4px",overflow:"hidden",marginBottom:"8px"},rateLimitProgress:{height:"100%",transition:"width 0.3s ease"},rateLimitReset:{fontSize:"12px",color:"#99aab5"},endpointsList:{display:"flex",flexDirection:"column",gap:"8px"},endpointItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},endpointRank:{fontSize:"20px",fontWeight:"bold",color:"#5865f2",minWidth:"40px"},endpointDetails:{flex:1},endpointPath:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",fontFamily:"monospace"},endpointMethod:{display:"inline-block",padding:"2px 8px",backgroundColor:"#5865f2",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",marginRight:"8px"},endpointStats:{fontSize:"12px",color:"#99aab5"},endpointBar:{width:"100px",height:"6px",backgroundColor:"#202225",borderRadius:"3px",overflow:"hidden"},endpointBarFill:{height:"100%",transition:"width 0.3s ease"},timeline:{display:"flex",flexDirection:"column",gap:"8px"},timelineItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px",display:"flex",alignItems:"center",gap:"12px"},timelineIcon:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},timelineContent:{flex:1},timelinePath:{fontSize:"14px",fontWeight:"600",fontFamily:"monospace",marginBottom:"4px"},timelineMethod:{display:"inline-block",padding:"2px 6px",backgroundColor:"#5865f2",borderRadius:"3px",fontSize:"10px",fontWeight:"bold",marginRight:"8px"},timelineMeta:{fontSize:"12px",color:"#99aab5"},empty:{textAlign:"center",padding:"40px",color:"#99aab5"}};export{P as default};
