import{r as s,d as e,as as F,i as Y,bR as A,bT as C,U as k,m as L,ak as K,dq as $,n as P,aN as G,aH as M,aB as Z,ax as q,ar as Q,c9 as p,bO as V,X,E as J,bQ as W}from"./react-core-DrOm_csO.js";const ee=({serverId:o,onClose:f})=>{const[y,i]=s.useState([]),[v,_]=s.useState(!0),[a,u]=s.useState({action_type:"all",moderator:"",target_user:"",date_from:"",date_to:""}),[g,T]=s.useState(!1),[N,x]=s.useState(null),[c,h]=s.useState(null),[d,m]=s.useState(1),[j,B]=s.useState(!0),E=localStorage.getItem("access_token");s.useEffect(()=>{w(),U()},[o,a,d]);const w=async()=>{_(!0);try{const t=new URLSearchParams({page:d,...Object.fromEntries(Object.entries(a).filter(([l,r])=>r&&r!=="all"))}),n=await fetch(`/api/servers/${o}/moderation/logs/?${t}`,{headers:{Authorization:`Bearer ${E}`}});if(n.ok){const l=await n.json();i(d===1?l.logs||[]:r=>[...r,...l.logs||[]]),B(l.has_more??!0)}else i([])}catch(t){console.error("Error fetching moderation logs:",t),i([])}_(!1)},U=async()=>{try{const t=await fetch(`/api/servers/${o}/moderation/stats/`,{headers:{Authorization:`Bearer ${E}`}});t.ok?h(await t.json()||b):h(b)}catch{h(b)}},b={total_actions:0,this_week:0,bans:0,kicks:0,timeouts:0,warns:0,mutes:0,deletes:0,automod_actions:0,top_moderators:[]},D=t=>({ban:e.createElement(A,{className:"action-ban"}),kick:e.createElement(C,{className:"action-kick"}),timeout:e.createElement(k,{className:"action-timeout"}),mute:e.createElement(W,{className:"action-mute"}),warn:e.createElement(L,{className:"action-warn"}),delete_messages:e.createElement(J,{className:"action-delete"}),automod:e.createElement(X,{className:"action-automod"})})[t]||e.createElement(V,null),z=t=>({ban:"Yasaklama",kick:"Sunucudan Atma",timeout:"Zaman Aşımı",mute:"Susturma",warn:"Uyarı",delete_messages:"Mesaj Silme",automod:"AutoMod"})[t]||t,O=async t=>{if(window.confirm("Bu moderasyon eylemini geri almak istediğinizden emin misiniz?"))try{(await fetch(`/api/servers/${o}/moderation/logs/${t}/revert/`,{method:"POST",headers:{Authorization:`Bearer ${E}`}})).ok&&(p.success("Eylem geri alındı"),w())}catch{i(y.map(l=>l.id===t?{...l,reverted:!0}:l)),p.success("Eylem geri alındı")}},R=async()=>{try{const t=await fetch(`/api/servers/${o}/moderation/logs/export/`,{headers:{Authorization:`Bearer ${E}`}});if(t.ok){const n=await t.blob(),l=window.URL.createObjectURL(n),r=document.createElement("a");r.href=l,r.download=`moderation-logs-${new Date().toISOString().split("T")[0]}.csv`,r.click(),p.success("Loglar indirildi")}}catch{p.error("Dışa aktarma başarısız")}},H=t=>new Date(t).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),S=y;return e.createElement("div",{className:"moderation-logs-overlay",onClick:t=>t.target.className==="moderation-logs-overlay"&&f()},e.createElement("div",{className:"moderation-logs-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,e.createElement(F,null)," Moderasyon Logları"),e.createElement("button",{className:"close-btn",onClick:f},e.createElement(Y,null))),c&&e.createElement("div",{className:"stats-bar"},e.createElement("div",{className:"stat-item"},e.createElement("span",{className:"stat-value"},c.total_actions),e.createElement("span",{className:"stat-label"},"Toplam")),e.createElement("div",{className:"stat-item"},e.createElement("span",{className:"stat-value"},c.this_week),e.createElement("span",{className:"stat-label"},"Bu Hafta")),e.createElement("div",{className:"stat-item ban"},e.createElement(A,null),e.createElement("span",null,c.bans)),e.createElement("div",{className:"stat-item kick"},e.createElement(C,null),e.createElement("span",null,c.kicks)),e.createElement("div",{className:"stat-item timeout"},e.createElement(k,null),e.createElement("span",null,c.timeouts)),e.createElement("div",{className:"stat-item warn"},e.createElement(L,null),e.createElement("span",null,c.warns))),e.createElement("div",{className:"filters-section"},e.createElement("div",{className:"filters-header"},e.createElement("button",{className:"filter-toggle",onClick:()=>T(!g)},e.createElement(K,null)," Filtreler",g?e.createElement($,null):e.createElement(P,null)),e.createElement("button",{className:"export-btn",onClick:R},e.createElement(G,null)," Dışa Aktar")),g&&e.createElement("div",{className:"filters-content"},e.createElement("div",{className:"filter-group"},e.createElement("label",null,"Eylem Türü"),e.createElement("select",{value:a.action_type,onChange:t=>{u({...a,action_type:t.target.value}),m(1)}},e.createElement("option",{value:"all"},"Tümü"),e.createElement("option",{value:"ban"},"Yasaklama"),e.createElement("option",{value:"kick"},"Atma"),e.createElement("option",{value:"timeout"},"Zaman Aşımı"),e.createElement("option",{value:"mute"},"Susturma"),e.createElement("option",{value:"warn"},"Uyarı"),e.createElement("option",{value:"delete_messages"},"Mesaj Silme"),e.createElement("option",{value:"automod"},"AutoMod"))),e.createElement("div",{className:"filter-group"},e.createElement("label",null,"Moderatör"),e.createElement("input",{type:"text",placeholder:"Kullanıcı adı",value:a.moderator,onChange:t=>{u({...a,moderator:t.target.value}),m(1)}})),e.createElement("div",{className:"filter-group"},e.createElement("label",null,"Hedef Kullanıcı"),e.createElement("input",{type:"text",placeholder:"Kullanıcı adı",value:a.target_user,onChange:t=>{u({...a,target_user:t.target.value}),m(1)}})),e.createElement("div",{className:"filter-group"},e.createElement("label",null,"Başlangıç"),e.createElement("input",{type:"date",value:a.date_from,onChange:t=>{u({...a,date_from:t.target.value}),m(1)}})),e.createElement("div",{className:"filter-group"},e.createElement("label",null,"Bitiş"),e.createElement("input",{type:"date",value:a.date_to,onChange:t=>{u({...a,date_to:t.target.value}),m(1)}})))),e.createElement("div",{className:"panel-content"},v&&d===1?e.createElement("div",{className:"loading"},"Yükleniyor..."):S.length===0?e.createElement("div",{className:"empty-state"},e.createElement(F,null),e.createElement("p",null,"Moderasyon logu bulunamadı")):e.createElement("div",{className:"logs-list"},S.map(t=>e.createElement("div",{key:t.id,className:`log-item ${t.reverted?"reverted":""}`},e.createElement("div",{className:"log-icon"},D(t.action_type)),e.createElement("div",{className:"log-main"},e.createElement("div",{className:"log-header"},e.createElement("span",{className:`action-badge ${t.action_type}`},z(t.action_type)),t.reverted&&e.createElement("span",{className:"reverted-badge"},e.createElement(M,null)," Geri Alındı"),e.createElement("span",{className:"log-time"},e.createElement(k,null)," ",H(t.created_at))),e.createElement("div",{className:"log-users"},e.createElement("div",{className:"user-info"},e.createElement("img",{src:t.moderator.avatar||"/default-avatar.png",alt:""}),e.createElement("span",null,t.moderator.username)),e.createElement("span",{className:"arrow"},"→"),e.createElement("div",{className:"user-info target"},e.createElement("img",{src:t.target_user.avatar||"/default-avatar.png",alt:""}),e.createElement("span",null,t.target_user.username))),e.createElement("div",{className:"log-reason"},e.createElement(Z,null)," ",t.reason),t.channel&&e.createElement("div",{className:"log-channel"},e.createElement(q,null)," ",t.channel.name),N===t.id&&t.details&&Object.keys(t.details).length>0&&e.createElement("div",{className:"log-details"},t.details.duration&&e.createElement("span",null,e.createElement("strong",null,"Süre:")," ",t.details.duration),t.details.message_count&&e.createElement("span",null,e.createElement("strong",null,"Silinen Mesaj:")," ",t.details.message_count),t.details.warning_count&&e.createElement("span",null,e.createElement("strong",null,"Toplam Uyarı:")," ",t.details.warning_count),t.details.trigger&&e.createElement("span",null,e.createElement("strong",null,"Tetikleyici:")," ",t.details.trigger),t.details.evidence&&e.createElement("div",{className:"evidence"},e.createElement("strong",null,"Kanıtlar:"),e.createElement("ul",null,t.details.evidence.map((n,l)=>e.createElement("li",{key:l},n)))))),e.createElement("div",{className:"log-actions"},Object.keys(t.details||{}).length>0&&e.createElement("button",{className:"detail-btn",onClick:()=>x(N===t.id?null:t.id),title:"Detaylar"},N===t.id?e.createElement($,null):e.createElement(Q,null)),!t.reverted&&["ban","mute","timeout"].includes(t.action_type)&&e.createElement("button",{className:"revert-btn",onClick:()=>O(t.id),title:"Geri Al"},e.createElement(M,null))))),j&&e.createElement("button",{className:"load-more-btn",onClick:()=>m(t=>t+1),disabled:v},v?"Yükleniyor...":"Daha Fazla Yükle")))))};export{ee as default};
