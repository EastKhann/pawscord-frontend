import{r as i,n as e}from"./react-core-zXIKm1Jm.js";import{y as n}from"./ui-vendor-BGw4w3Ed.js";import{g as R}from"./index-DsM7Jk9S.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-DZdpmN99.js";import"./state-vendor-8NbFPBhQ.js";const F=({serverId:d,onClose:b})=>{const[c,h]=i.useState([]),[j,x]=i.useState(!1),[r,u]=i.useState({name:"",channel_id:"",avatar_url:""}),[k,f]=i.useState([]),[y,$]=i.useState(!0),[W,g]=i.useState(null),[v,_]=i.useState([]),[w,p]=i.useState(null),l=R();i.useEffect(()=>{d&&(S(),C())},[d]);const S=async()=>{try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/webhooks/server/${d}/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();h(t.webhooks||[])}}catch(s){console.error("Error fetching webhooks:",s)}finally{$(!1)}},C=async()=>{try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/servers/${d}/channels/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();f(t.channels||[])}}catch(s){console.error("Error fetching channels:",s)}},B=async()=>{if(!r.name||!r.channel_id){n.error("‚ùå Webhook adƒ± ve kanal se√ßimi zorunludur");return}try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/webhooks/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:d,...r})});if(a.ok){const t=await a.json();h([...c,t.webhook]),u({name:"",channel_id:"",avatar_url:""}),x(!1),n.success("‚úÖ Webhook ba≈üarƒ±yla olu≈üturuldu")}else n.error("‚ùå Webhook olu≈üturulamadƒ±")}catch(s){console.error("Error creating webhook:",s),n.error("‚ùå Baƒülantƒ± hatasƒ±")}},E=async(s,a)=>{try{const t=localStorage.getItem("access_token"),o=await fetch(`${l}/webhooks/${s}/update/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(o.ok){const m=await o.json();h(c.map(N=>N.id===s?m.webhook:N)),g(null),n.success("‚úÖ Webhook g√ºncellendi")}else n.error("‚ùå Webhook g√ºncellenemedi")}catch(t){console.error("Error updating webhook:",t),n.error("‚ùå Baƒülantƒ± hatasƒ±")}},T=async s=>{if(window.confirm("Bu webhook'u silmek istediƒüinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${l}/webhooks/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(h(c.filter(o=>o.id!==s)),n.success("‚úÖ Webhook silindi")):n.error("‚ùå Webhook silinemedi")}catch(a){console.error("Error deleting webhook:",a),n.error("‚ùå Baƒülantƒ± hatasƒ±")}},z=async s=>{try{const a=localStorage.getItem("access_token");(await fetch(`${l}/webhooks/${s}/test/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok?n.success("‚úÖ Test mesajƒ± g√∂nderildi"):n.error("‚ùå Test mesajƒ± g√∂nderilemedi")}catch(a){console.error("Error testing webhook:",a),n.error("‚ùå Baƒülantƒ± hatasƒ±")}},L=async s=>{if(window.confirm("Webhook tokenini yenilemek istediƒüinizden emin misiniz? Eski token ge√ßersiz hale gelecek."))try{const a=localStorage.getItem("access_token"),t=await fetch(`${l}/webhooks/${s}/regenerate-token/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(t.ok){const o=await t.json();h(c.map(m=>m.id===s?{...m,token:o.token}:m)),n.success("‚úÖ Token yenilendi")}else n.error("‚ùå Token yenilenemedi")}catch(a){console.error("Error regenerating token:",a),n.error("‚ùå Baƒülantƒ± hatasƒ±")}},A=async s=>{try{const a=localStorage.getItem("access_token"),t=await fetch(`${l}/webhooks/${s}/logs/`,{headers:{Authorization:`Bearer ${a}`}});if(t.ok){const o=await t.json();_(o.logs||[]),p(s)}}catch(a){console.error("Error fetching logs:",a),n.error("‚ùå Loglar y√ºklenemedi")}},O=s=>{const a=`${l}/webhooks/${s.id}/${s.token}`;navigator.clipboard.writeText(a),n.success("‚úÖ Webhook URL kopyalandƒ±")};return y?e.jsx("div",{className:"webhooks-overlay",children:e.jsx("div",{className:"webhooks-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Webhooklar y√ºkleniyor..."})]})})}):e.jsx("div",{className:"webhooks-overlay",onClick:b,children:e.jsxs("div",{className:"webhooks-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsx("h2",{children:"üîó Webhook Y√∂netimi"}),e.jsx("button",{className:"close-btn",onClick:b,children:"√ó"})]}),e.jsxs("div",{className:"webhooks-content",children:[!j&&e.jsx("button",{className:"create-webhook-btn",onClick:()=>x(!0),children:"‚ûï Yeni Webhook Olu≈ütur"}),j&&e.jsxs("div",{className:"create-webhook-form",children:[e.jsx("h3",{children:"Yeni Webhook"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ± *"}),e.jsx("input",{type:"text",placeholder:"√ñrn: GitHub Bot",value:r.name,onChange:s=>u({...r,name:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:r.channel_id,onChange:s=>u({...r,channel_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Kanal se√ßin..."}),k.map(s=>e.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL (Opsiyonel)"}),e.jsx("input",{type:"text",placeholder:"https://example.com/avatar.png",value:r.avatar_url,onChange:s=>u({...r,avatar_url:s.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>x(!1),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:B,children:"Olu≈ütur"})]})]}),c.length>0?e.jsx("div",{className:"webhooks-list",children:c.map(s=>e.jsx("div",{className:"webhook-card",children:W===s.id?e.jsxs("div",{className:"edit-webhook-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ±"}),e.jsx("input",{type:"text",defaultValue:s.name,id:`edit-name-${s.id}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("select",{defaultValue:s.channel_id,id:`edit-channel-${s.id}`,children:k.map(a=>e.jsxs("option",{value:a.id,children:["#",a.name]},a.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL"}),e.jsx("input",{type:"text",defaultValue:s.avatar_url||"",id:`edit-avatar-${s.id}`})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>g(null),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:()=>{const a=document.getElementById(`edit-name-${s.id}`).value,t=document.getElementById(`edit-channel-${s.id}`).value,o=document.getElementById(`edit-avatar-${s.id}`).value;E(s.id,{name:a,channel_id:t,avatar_url:o})},children:"Kaydet"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"webhook-info",children:[e.jsx("div",{className:"webhook-avatar",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name}):e.jsx("div",{className:"default-avatar",children:"üîó"})}),e.jsxs("div",{className:"webhook-details",children:[e.jsx("h4",{children:s.name}),e.jsxs("p",{children:["#",k.find(a=>a.id===s.channel_id)?.name||"Bilinmeyen Kanal"]}),e.jsxs("span",{className:"webhook-id",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"webhook-url",children:[e.jsx("label",{children:"Webhook URL:"}),e.jsxs("div",{className:"url-display",children:[e.jsx("code",{children:`${l}/webhooks/${s.id}/${s.token}`}),e.jsx("button",{className:"copy-btn",onClick:()=>O(s),title:"URL'yi kopyala",children:"üìã"})]})]}),e.jsxs("div",{className:"webhook-actions",children:[e.jsx("button",{className:"action-btn test-btn",onClick:()=>z(s.id),title:"Test mesajƒ± g√∂nder",children:"üß™ Test"}),e.jsx("button",{className:"action-btn logs-btn",onClick:()=>A(s.id),title:"Loglarƒ± g√∂r√ºnt√ºle",children:"üìä Loglar"}),e.jsx("button",{className:"action-btn edit-btn",onClick:()=>g(s.id),title:"D√ºzenle",children:"‚úèÔ∏è"}),e.jsx("button",{className:"action-btn regenerate-btn",onClick:()=>L(s.id),title:"Token yenile",children:"üîÑ"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>T(s.id),title:"Sil",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"webhook-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Toplam √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.total_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±lƒ±:"}),e.jsx("span",{className:"stat-value success",children:s.successful_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±sƒ±z:"}),e.jsx("span",{className:"stat-value error",children:s.failed_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Son √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.last_call?new Date(s.last_call).toLocaleString("tr-TR"):"Hi√ß"})]})]})]})},s.id))}):!j&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîó"}),e.jsx("h3",{children:"Hen√ºz webhook yok"}),e.jsx("p",{children:"Dƒ±≈ü uygulamalardan mesaj g√∂ndermek i√ßin webhook olu≈üturun"})]}),w&&e.jsx("div",{className:"logs-modal",onClick:()=>p(null),children:e.jsxs("div",{className:"logs-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"logs-header",children:[e.jsx("h3",{children:"üìä Webhook Loglarƒ±"}),e.jsx("button",{className:"close-btn",onClick:()=>p(null),children:"√ó"})]}),e.jsx("div",{className:"logs-list",children:v.length>0?v.map((s,a)=>e.jsxs("div",{className:`log-item ${s.status}`,children:[e.jsx("div",{className:"log-time",children:new Date(s.timestamp).toLocaleString("tr-TR")}),e.jsxs("div",{className:"log-status",children:[s.status==="success"?"‚úÖ":"‚ùå"," ",s.status]}),e.jsx("div",{className:"log-message",children:s.message}),s.error&&e.jsxs("div",{className:"log-error",children:["Hata: ",s.error]})]},a)):e.jsx("p",{className:"empty-state",children:"Hen√ºz log kaydƒ± yok"})})]})})]})]})})};export{F as default};
