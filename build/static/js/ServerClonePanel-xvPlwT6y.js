var U=Object.defineProperty;var n=(t,o)=>U(t,"name",{value:o,configurable:!0});import{r,j as s}from"./react-core-Djgtqrmb.js";import{aV as w,y as V,a as _,v as G,bs as k,a9 as h,aF as y,a1 as F,az as $,n as b,u as H,G as J,d as M}from"./icons-vendor-BW7dxHkX.js";import{g as P,t as g}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const es=n(({serverId:t,serverName:o,onClose:p,onClone:v})=>{const[E,N]=r.useState(!0),[T,A]=r.useState(!1),[i,x]=r.useState(null),[c,j]=r.useState(""),[a,O]=r.useState({channels:!0,roles:!0,emojis:!0,settings:!0,permissions:!0,categories:!0}),[u,f]=r.useState(0),[B,C]=r.useState(""),S=localStorage.getItem("access_token");r.useEffect(()=>{z()},[t]);const z=n(async()=>{N(!0);try{const e=await fetch(`${P()}/api/servers/${t}/clone-data/`,{headers:{Authorization:`Bearer ${S}`}});if(e.ok){const l=await e.json();x(l),j(`${l.name||o} (Copy)`)}else x({id:t,name:o,channels:[],categories:[],roles:[],emojis:[],settings:{}}),j(`${o} (Copy)`)}catch{x({id:t,name:o,channels:[],categories:[],roles:[],emojis:[],settings:{}}),j(`${o} (Copy)`)}N(!1)},"loadServerData"),d=n(e=>{O(l=>({...l,[e]:!l[e]}))},"handleOptionToggle"),D=n(async()=>{if(c.trim()){A(!0),f(0),C("Starting clone process...");try{const e=await fetch(`${P()}/api/servers/${t}/clone/`,{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"},body:JSON.stringify({name:c,options:a})}),l=[{progress:20,status:"Creating server..."},{progress:40,status:"Setting up channels..."},{progress:60,status:"Configuring roles..."},{progress:80,status:"Applying settings..."},{progress:100,status:"Complete!"}];for(const m of l)await new Promise(R=>setTimeout(R,300)),f(m.progress),C(m.status);if(e.ok){const m=await e.json();g.success(`Server "${c}" created successfully!`),v&&v({name:c,...a,newServerId:m.server_id})}else{const m=await e.json();g.error(m.error||"Failed to clone server")}}catch{g.error("Failed to clone server")}p()}},"handleClone"),L=n(()=>Object.values(a).filter(Boolean).length,"getSelectedCount");return E?s.jsx("div",{className:"serverclone-overlay",onClick:p,children:s.jsx("div",{className:"serverclone-panel",onClick:n(e=>e.stopPropagation(),"onClick"),children:s.jsx("div",{className:"loading",children:"Loading server data..."})})}):s.jsx("div",{className:"serverclone-overlay",onClick:p,children:s.jsxs("div",{className:"serverclone-panel",onClick:n(e=>e.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(w,{})," Clone Server"]}),s.jsxs("span",{className:"source-server",children:[s.jsx(V,{})," ",i?.name]})]}),s.jsx("button",{className:"close-btn",onClick:p,children:s.jsx(_,{})})]}),T?s.jsxs("div",{className:"cloning-progress",children:[s.jsx("div",{className:"progress-icon",children:s.jsx(G,{className:"spinning"})}),s.jsx("h3",{children:"Cloning Server..."}),s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${u}%`}})}),s.jsx("span",{className:"progress-status",children:B}),s.jsxs("span",{className:"progress-percent",children:[u,"%"]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"content",children:[s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"New Server Name"}),s.jsx("input",{type:"text",value:c,onChange:n(e=>j(e.target.value),"onChange"),placeholder:"Enter server name",maxLength:100})]}),s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:["What to Clone (",L(),"/6)"]}),s.jsxs("div",{className:"options-grid",children:[s.jsxs("div",{className:`option-card ${a.categories?"selected":""}`,onClick:n(()=>d("categories"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(k,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Categories"}),s.jsxs("span",{className:"option-count",children:[i?.categories?.length||0," categories"]})]}),a.categories&&s.jsx(h,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.channels?"selected":""}`,onClick:n(()=>d("channels"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(y,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Channels"}),s.jsxs("span",{className:"option-count",children:[i?.channels?.length||0," channels"]})]}),a.channels&&s.jsx(h,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.roles?"selected":""}`,onClick:n(()=>d("roles"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(F,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Roles"}),s.jsxs("span",{className:"option-count",children:[i?.roles?.length||0," roles"]})]}),a.roles&&s.jsx(h,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.permissions?"selected":""}`,onClick:n(()=>d("permissions"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx($,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Permissions"}),s.jsx("span",{className:"option-count",children:"Channel overrides"})]}),a.permissions&&s.jsx(h,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.emojis?"selected":""}`,onClick:n(()=>d("emojis"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(b,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Emojis"}),s.jsxs("span",{className:"option-count",children:[i?.emojis?.length||0," emojis"]})]}),a.emojis&&s.jsx(h,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.settings?"selected":""}`,onClick:n(()=>d("settings"),"onClick"),children:[s.jsx("div",{className:"option-icon",children:s.jsx($,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Settings"}),s.jsx("span",{className:"option-count",children:"Server config"})]}),a.settings&&s.jsx(h,{className:"check"})]})]})]}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Preview"}),s.jsxs("div",{className:"preview-card",children:[s.jsxs("div",{className:"preview-header",children:[s.jsx("div",{className:"preview-icon",children:c.charAt(0).toUpperCase()}),s.jsxs("div",{className:"preview-info",children:[s.jsx("span",{className:"preview-name",children:c||"New Server"}),s.jsxs("span",{className:"preview-meta",children:[s.jsx(H,{})," 1 member"]})]})]}),s.jsxs("div",{className:"preview-items",children:[a.categories&&s.jsxs("span",{className:"preview-item",children:[s.jsx(k,{})," ",i?.categories?.length," Categories"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(y,{})," ",i?.channels?.filter(e=>e.type==="text").length," Text"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(J,{})," ",i?.channels?.filter(e=>e.type==="voice").length," Voice"]}),a.roles&&s.jsxs("span",{className:"preview-item",children:[s.jsx(F,{})," ",i?.roles?.length," Roles"]}),a.emojis&&s.jsxs("span",{className:"preview-item",children:[s.jsx(b,{})," ",i?.emojis?.length," Emojis"]})]})]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(M,{}),s.jsxs("div",{children:[s.jsx("strong",{children:"Note:"})," Members, messages, and message history will not be cloned. Only server structure and settings will be copied."]})]})]}),s.jsxs("div",{className:"panel-footer",children:[s.jsx("button",{className:"cancel-btn",onClick:p,children:"Cancel"}),s.jsxs("button",{className:"clone-btn",onClick:D,disabled:!c.trim(),children:[s.jsx(w,{})," Clone Server"]})]})]})]})})},"ServerClonePanel");export{es as default};
