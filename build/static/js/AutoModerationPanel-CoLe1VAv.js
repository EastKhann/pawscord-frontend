var _=Object.defineProperty;var n=(c,u)=>_(c,"name",{value:u,configurable:!0});import{r as l,j as e}from"./react-core-Djgtqrmb.js";import{B as L,an as M,a1 as y,bo as H,bp as J,at as U,f as G,d as I,ay as q}from"./icons-vendor-BW7dxHkX.js";import{t as r}from"./index-GGLPABCW.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const te=l.memo(({serverId:c,onClose:u})=>{const[d,h]=l.useState([]),[g,p]=l.useState(!0),[b,m]=l.useState(!1),[Q,j]=l.useState(null),[i,o]=l.useState({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60});l.useEffect(()=>{f()},[c]);const f=n(async()=>{p(!0);try{const a=await fetch(`/api/moderation/auto-mod/rules/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const s=await a.json();h(s.rules||[])}}catch{r.error("âŒ Kurallar yÃ¼klenemedi")}finally{p(!1)}},"fetchRules"),N=n(async()=>{if(!i.name.trim()){r.error("âŒ Kural adÄ± girin");return}try{const a=await fetch(`/api/moderation/auto-mod/rules/${c}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const s=await a.json();h([...d,s.rule]),m(!1),S(),r.success("âœ… Kural oluÅŸturuldu")}else r.error("âŒ Kural oluÅŸturulamadÄ±")}catch{r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"createRule"),v=n(async(a,s)=>{try{const t=await fetch(`/api/moderation/auto-mod/rules/${c}/${a}/`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.ok){const Y=await t.json();h(d.map(k=>k.id===a?Y.rule:k)),j(null),r.success("âœ… Kural gÃ¼ncellendi")}}catch{r.error("âŒ GÃ¼ncelleme baÅŸarÄ±sÄ±z")}},"updateRule"),C=n(async a=>{if(confirm("Bu kuralÄ± silmek istediÄŸinizden emin misiniz?"))try{(await fetch(`/api/moderation/auto-mod/rules/${c}/${a}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(h(d.filter(t=>t.id!==a)),r.success("âœ… Kural silindi"))}catch{r.error("âŒ Silme baÅŸarÄ±sÄ±z")}},"deleteRule"),w=n(async(a,s)=>{await v(a,{enabled:s})},"toggleRule"),S=n(()=>{o({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60})},"resetNewRule"),x=l.useCallback(a=>{a.trim()&&o(s=>s.keywords.includes(a.trim())?s:{...s,keywords:[...s.keywords,a.trim()]})},[]),K=l.useCallback(a=>{o(s=>({...s,keywords:s.keywords.filter(t=>t!==a)}))},[]),R=n(a=>{switch(a){case"spam":return e.jsx(q,{});case"profanity":return e.jsx(I,{});case"caps":return"ðŸ”¤";case"links":return"ðŸ”—";case"mentions":return"@";default:return e.jsx(y,{})}},"getRuleIcon"),E=n(a=>{switch(a){case"warn":return"#faa61a";case"mute":return"#ff9500";case"kick":return"#ff3b30";case"ban":return"#ff0000";default:return"#8b5cf6"}},"getActionColor"),A=l.useCallback(a=>a.stopPropagation(),[]),T=l.useCallback(()=>m(!0),[]),$=l.useCallback(()=>m(!1),[]),z=l.useCallback(a=>o(s=>({...s,name:a.target.value})),[]),B=l.useCallback(a=>o(s=>({...s,type:a.target.value})),[]),F=l.useCallback(a=>o(s=>({...s,action:a.target.value})),[]),O=l.useCallback(a=>o(s=>({...s,threshold:parseInt(a.target.value)})),[]),P=l.useCallback(a=>o(s=>({...s,duration:parseInt(a.target.value)})),[]),D=l.useCallback(a=>{a.key==="Enter"&&(x(a.target.value),a.target.value="")},[x]);return e.jsx("div",{className:"auto-mod-panel-overlay",onClick:u,children:e.jsxs("div",{className:"auto-mod-panel",onClick:A,children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(L,{className:"header-icon"}),e.jsx("h2",{children:"Otomatik Moderasyon"}),e.jsx("button",{className:"close-btn",onClick:u,children:"Ã—"})]}),e.jsx("div",{className:"panel-actions",children:e.jsxs("button",{className:"btn-create",onClick:T,children:[e.jsx(M,{})," Yeni Kural"]})}),g?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):e.jsx("div",{className:"rules-list",children:d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(y,{size:48}),e.jsx("h3",{children:"Kural Yok"}),e.jsx("p",{children:"Otomatik moderasyon kurallarÄ± oluÅŸturun"})]}):d.map(a=>e.jsxs("div",{className:`rule-card ${a.enabled?"":"disabled"}`,children:[e.jsxs("div",{className:"rule-header",children:[e.jsx("div",{className:"rule-icon",children:R(a.type)}),e.jsxs("div",{className:"rule-info",children:[e.jsx("h3",{children:a.name}),e.jsx("span",{className:"rule-type",children:a.type})]}),e.jsxs("div",{className:"rule-actions",children:[e.jsx("button",{className:"action-btn toggle",onClick:n(()=>w(a.id,!a.enabled),"onClick"),title:a.enabled?"Devre DÄ±ÅŸÄ± BÄ±rak":"EtkinleÅŸtir",children:a.enabled?e.jsx(H,{}):e.jsx(J,{})}),e.jsx("button",{className:"action-btn edit",onClick:n(()=>j(a),"onClick"),title:"DÃ¼zenle",children:e.jsx(U,{})}),e.jsx("button",{className:"action-btn delete",onClick:n(()=>C(a.id),"onClick"),title:"Sil",children:e.jsx(G,{})})]})]}),e.jsxs("div",{className:"rule-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Aksiyon:"}),e.jsx("span",{className:"value action-badge",style:{backgroundColor:E(a.action)},children:a.action})]}),a.keywords&&a.keywords.length>0&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Anahtar Kelimeler:"}),e.jsx("div",{className:"keywords",children:a.keywords.map((s,t)=>e.jsx("span",{className:"keyword",children:s},t))})]}),a.threshold&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"EÅŸik:"}),e.jsx("span",{className:"value",children:a.threshold})]})]})]},a.id))}),b&&e.jsx("div",{className:"rule-editor-modal",children:e.jsxs("div",{className:"rule-editor",children:[e.jsx("h3",{children:"Yeni Kural OluÅŸtur"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural AdÄ±"}),e.jsx("input",{type:"text",value:i.name,onChange:z,placeholder:"Ã–rn: Spam Engelleme"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural Tipi"}),e.jsxs("select",{value:i.type,onChange:B,children:[e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"profanity",children:"KÃ¼fÃ¼r"}),e.jsx("option",{value:"caps",children:"BÃ¼yÃ¼k Harf"}),e.jsx("option",{value:"links",children:"Link"}),e.jsx("option",{value:"mentions",children:"Mention"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Aksiyon"}),e.jsxs("select",{value:i.action,onChange:F,children:[e.jsx("option",{value:"warn",children:"Uyar"}),e.jsx("option",{value:"mute",children:"Sustur"}),e.jsx("option",{value:"kick",children:"At"}),e.jsx("option",{value:"ban",children:"Yasakla"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Anahtar Kelimeler (Enter ile ekle)"}),e.jsx("input",{type:"text",placeholder:"Kelime girin ve Enter'a basÄ±n",onKeyPress:D}),e.jsx("div",{className:"keywords-list",children:i.keywords.map((a,s)=>e.jsxs("span",{className:"keyword-chip",children:[a,e.jsx("button",{onClick:n(()=>K(a),"onClick"),children:"Ã—"})]},s))})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"EÅŸik"}),e.jsx("input",{type:"number",value:i.threshold,onChange:O,min:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SÃ¼re (saniye)"}),e.jsx("input",{type:"number",value:i.duration,onChange:P,min:"1"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:$,children:"Ä°ptal"}),e.jsx("button",{className:"btn-save",onClick:N,children:"OluÅŸtur"})]})]})})]})})});export{te as default};
