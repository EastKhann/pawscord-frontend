import{r,b$ as C,l as _,aT as S}from"./react-core-B6hadH-M.js";import{t as f}from"./index-D_6pZib5.js";const B=({fetchWithAuth:m,apiBaseUrl:g,onClose:x,entityType:d,entityId:u})=>{const[n,y]=r.useState([]),[h,s]=r.useState(!1),[c,b]=r.useState("all");r.useEffect(()=>{v()},[]);const v=async()=>{s(!0);try{const a=await(await m(`${g}/audit/field-changes/?entity_type=${d}&entity_id=${u}`)).json();y(a.changes||[])}catch{f.error("Failed to load change history")}finally{s(!1)}},R=()=>{const t=[["Date","Field","Old Value","New Value","Changed By"],...i.map(l=>[new Date(l.changed_at).toLocaleString(),l.field_name,l.old_value||"",l.new_value||"",l.changed_by_username])].map(l=>l.map(w=>`"${w}"`).join(",")).join(`
`),a=new Blob([t],{type:"text/csv"}),p=window.URL.createObjectURL(a),o=document.createElement("a");o.href=p,o.download=`field_changes_${d}_${Date.now()}.csv`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(p),document.body.removeChild(o),f.success("Changes exported")},E=[...new Set(n.map(t=>t.field_name))],i=c==="all"?n:n.filter(t=>t.field_name===c);return React.createElement("div",{style:e.overlay},React.createElement("div",{style:e.modal},React.createElement("div",{style:e.header},React.createElement("div",{style:e.headerLeft},React.createElement(C,{style:{marginRight:"10px",color:"#5865f2"}}),React.createElement("h2",{style:e.title},"Field Change History")),React.createElement("button",{onClick:x,style:e.closeButton},React.createElement(_,null))),React.createElement("div",{style:e.toolbar},React.createElement("select",{value:c,onChange:t=>b(t.target.value),style:e.filterSelect},React.createElement("option",{value:"all"},"All Fields (",n.length,")"),E.map(t=>React.createElement("option",{key:t,value:t},t," (",n.filter(a=>a.field_name===t).length,")"))),React.createElement("button",{onClick:R,style:e.exportButton},React.createElement(S,{style:{marginRight:"6px"}}),"Export")),React.createElement("div",{style:e.content},h?React.createElement("div",{style:e.loading},"Loading changes..."):i.length===0?React.createElement("div",{style:e.empty},"No changes recorded"):React.createElement("div",{style:e.changesList},i.map((t,a)=>React.createElement("div",{key:a,style:e.changeCard},React.createElement("div",{style:e.changeField},t.field_name),React.createElement("div",{style:e.changeValues},React.createElement("div",{style:e.oldValue},React.createElement("div",{style:e.valueLabel},"Old:"),React.createElement("div",{style:e.value},t.old_value||React.createElement("em",{style:{color:"#99aab5"}},"empty"))),React.createElement("div",{style:e.arrow},"â†’"),React.createElement("div",{style:e.newValue},React.createElement("div",{style:e.valueLabel},"New:"),React.createElement("div",{style:e.value},t.new_value||React.createElement("em",{style:{color:"#99aab5"}},"empty")))),React.createElement("div",{style:e.changeMeta},"Changed by ",React.createElement("span",{style:e.username},t.changed_by_username)," on ",new Date(t.changed_at).toLocaleString())))))))},e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},toolbar:{display:"flex",gap:"12px",padding:"15px 20px",borderBottom:"1px solid #2c2f33"},filterSelect:{flex:1,padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},exportButton:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"13px",display:"flex",alignItems:"center"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},changesList:{display:"flex",flexDirection:"column",gap:"16px"},changeCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},changeField:{fontSize:"16px",fontWeight:"600",color:"#5865f2",marginBottom:"12px"},changeValues:{display:"flex",gap:"16px",alignItems:"center",marginBottom:"12px",padding:"12px",backgroundColor:"#1e1e1e",borderRadius:"6px"},oldValue:{flex:1},newValue:{flex:1},arrow:{fontSize:"20px",color:"#5865f2"},valueLabel:{fontSize:"12px",color:"#99aab5",marginBottom:"4px"},value:{fontSize:"14px",color:"#ffffff",wordBreak:"break-word"},changeMeta:{fontSize:"12px",color:"#99aab5"},username:{color:"#5865f2",fontWeight:"500"}};export{B as default};
