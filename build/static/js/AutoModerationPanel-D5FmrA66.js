import{r as i,n as e}from"./react-core-BMiyQWF6.js";import{G as A,ac as $,a4 as j,bl as z,bm as T,aC as B,s as F,d as O,b1 as P}from"./icons-vendor-GUGjkvMm.js";import{t as n}from"./index-DBXG7kfi.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const I=({serverId:o,onClose:m})=>{const[c,d]=i.useState([]),[y,h]=i.useState(!0),[k,u]=i.useState(!1),[Y,p]=i.useState(null),[s,l]=i.useState({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60});i.useEffect(()=>{f()},[o]);const f=async()=>{h(!0);try{const a=await fetch(`/api/moderation/auto-mod/rules/${o}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();d(t.rules||[])}}catch{n.error("âŒ Kurallar yÃ¼klenemedi")}finally{h(!1)}},v=async()=>{if(!s.name.trim()){n.error("âŒ Kural adÄ± girin");return}try{const a=await fetch(`/api/moderation/auto-mod/rules/${o}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const t=await a.json();d([...c,t.rule]),u(!1),w(),n.success("âœ… Kural oluÅŸturuldu")}else n.error("âŒ Kural oluÅŸturulamadÄ±")}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},g=async(a,t)=>{try{const r=await fetch(`/api/moderation/auto-mod/rules/${o}/${a}/`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(r.ok){const R=await r.json();d(c.map(x=>x.id===a?R.rule:x)),p(null),n.success("âœ… Kural gÃ¼ncellendi")}}catch{n.error("âŒ GÃ¼ncelleme baÅŸarÄ±sÄ±z")}},N=async a=>{if(confirm("Bu kuralÄ± silmek istediÄŸinizden emin misiniz?"))try{(await fetch(`/api/moderation/auto-mod/rules/${o}/${a}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(d(c.filter(r=>r.id!==a)),n.success("âœ… Kural silindi"))}catch{n.error("âŒ Silme baÅŸarÄ±sÄ±z")}},b=async(a,t)=>{await g(a,{enabled:t})},w=()=>{l({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60})},C=a=>{a.trim()&&!s.keywords.includes(a.trim())&&l({...s,keywords:[...s.keywords,a.trim()]})},S=a=>{l({...s,keywords:s.keywords.filter(t=>t!==a)})},K=a=>{switch(a){case"spam":return e.jsx(P,{});case"profanity":return e.jsx(O,{});case"caps":return"ðŸ”¤";case"links":return"ðŸ”—";case"mentions":return"@";default:return e.jsx(j,{})}},E=a=>{switch(a){case"warn":return"#faa61a";case"mute":return"#ff9500";case"kick":return"#ff3b30";case"ban":return"#ff0000";default:return"#8b5cf6"}};return e.jsx("div",{className:"auto-mod-panel-overlay",onClick:m,children:e.jsxs("div",{className:"auto-mod-panel",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(A,{className:"header-icon"}),e.jsx("h2",{children:"Otomatik Moderasyon"}),e.jsx("button",{className:"close-btn",onClick:m,children:"Ã—"})]}),e.jsx("div",{className:"panel-actions",children:e.jsxs("button",{className:"btn-create",onClick:()=>u(!0),children:[e.jsx($,{})," Yeni Kural"]})}),y?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):e.jsx("div",{className:"rules-list",children:c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(j,{size:48}),e.jsx("h3",{children:"Kural Yok"}),e.jsx("p",{children:"Otomatik moderasyon kurallarÄ± oluÅŸturun"})]}):c.map(a=>e.jsxs("div",{className:`rule-card ${a.enabled?"":"disabled"}`,children:[e.jsxs("div",{className:"rule-header",children:[e.jsx("div",{className:"rule-icon",children:K(a.type)}),e.jsxs("div",{className:"rule-info",children:[e.jsx("h3",{children:a.name}),e.jsx("span",{className:"rule-type",children:a.type})]}),e.jsxs("div",{className:"rule-actions",children:[e.jsx("button",{className:"action-btn toggle",onClick:()=>b(a.id,!a.enabled),title:a.enabled?"Devre DÄ±ÅŸÄ± BÄ±rak":"EtkinleÅŸtir",children:a.enabled?e.jsx(z,{}):e.jsx(T,{})}),e.jsx("button",{className:"action-btn edit",onClick:()=>p(a),title:"DÃ¼zenle",children:e.jsx(B,{})}),e.jsx("button",{className:"action-btn delete",onClick:()=>N(a.id),title:"Sil",children:e.jsx(F,{})})]})]}),e.jsxs("div",{className:"rule-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Aksiyon:"}),e.jsx("span",{className:"value action-badge",style:{backgroundColor:E(a.action)},children:a.action})]}),a.keywords&&a.keywords.length>0&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Anahtar Kelimeler:"}),e.jsx("div",{className:"keywords",children:a.keywords.map((t,r)=>e.jsx("span",{className:"keyword",children:t},r))})]}),a.threshold&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"EÅŸik:"}),e.jsx("span",{className:"value",children:a.threshold})]})]})]},a.id))}),k&&e.jsx("div",{className:"rule-editor-modal",children:e.jsxs("div",{className:"rule-editor",children:[e.jsx("h3",{children:"Yeni Kural OluÅŸtur"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural AdÄ±"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>l({...s,name:a.target.value}),placeholder:"Ã–rn: Spam Engelleme"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural Tipi"}),e.jsxs("select",{value:s.type,onChange:a=>l({...s,type:a.target.value}),children:[e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"profanity",children:"KÃ¼fÃ¼r"}),e.jsx("option",{value:"caps",children:"BÃ¼yÃ¼k Harf"}),e.jsx("option",{value:"links",children:"Link"}),e.jsx("option",{value:"mentions",children:"Mention"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Aksiyon"}),e.jsxs("select",{value:s.action,onChange:a=>l({...s,action:a.target.value}),children:[e.jsx("option",{value:"warn",children:"Uyar"}),e.jsx("option",{value:"mute",children:"Sustur"}),e.jsx("option",{value:"kick",children:"At"}),e.jsx("option",{value:"ban",children:"Yasakla"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Anahtar Kelimeler (Enter ile ekle)"}),e.jsx("input",{type:"text",placeholder:"Kelime girin ve Enter'a basÄ±n",onKeyPress:a=>{a.key==="Enter"&&(C(a.target.value),a.target.value="")}}),e.jsx("div",{className:"keywords-list",children:s.keywords.map((a,t)=>e.jsxs("span",{className:"keyword-chip",children:[a,e.jsx("button",{onClick:()=>S(a),children:"Ã—"})]},t))})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"EÅŸik"}),e.jsx("input",{type:"number",value:s.threshold,onChange:a=>l({...s,threshold:parseInt(a.target.value)}),min:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SÃ¼re (saniye)"}),e.jsx("input",{type:"number",value:s.duration,onChange:a=>l({...s,duration:parseInt(a.target.value)}),min:"1"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>u(!1),children:"Ä°ptal"}),e.jsx("button",{className:"btn-save",onClick:v,children:"OluÅŸtur"})]})]})})]})})};export{I as default};
