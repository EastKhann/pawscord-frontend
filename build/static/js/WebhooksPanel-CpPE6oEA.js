var S=Object.defineProperty;var t=(d,k)=>S(d,"name",{value:k,configurable:!0});import{r as h,j as e}from"./react-core-Djgtqrmb.js";import{y as l}from"./ui-vendor-IhB9Znpc.js";import{g as T,d as N}from"./index-DwVhiipM.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";function B(d){const[k,a]=h.useState([]),[s,r]=h.useState(!1),[j,x]=h.useState({name:"",channel_id:"",avatar_url:""}),[f,y]=h.useState([]),[W,$]=h.useState(!0),[w,g]=h.useState(null),[C,_]=h.useState([]),[L,p]=h.useState(null),c=T();h.useEffect(()=>{if(!d)return;const i={Authorization:`Bearer ${localStorage.getItem("access_token")}`};Promise.all([fetch(`${c}/webhooks/server/${d}/`,{headers:i}).then(o=>o.ok?o.json():null),fetch(`${c}/servers/${d}/channels/`,{headers:i}).then(o=>o.ok?o.json():null)]).then(([o,m])=>{o&&a(o.webhooks||[]),m&&y(m.channels||[])}).catch(o=>{}).finally(()=>$(!1))},[d,c]);const u=t(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}),"authHeaders");return{webhooks:k,creating:s,setCreating:r,newWebhook:j,setNewWebhook:x,channels:f,loading:W,editingWebhook:w,setEditingWebhook:g,logs:C,viewingLogs:L,setViewingLogs:p,apiBaseUrl:c,createWebhook:t(async()=>{if(!j.name||!j.channel_id){l.error("‚ùå Webhook adƒ± ve kanal se√ßimi zorunludur");return}try{const n=await fetch(`${c}/webhooks/create/`,{method:"POST",headers:u(),body:JSON.stringify({server_id:d,...j})});if(n.ok){const i=await n.json();a(o=>[...o,i.webhook]),x({name:"",channel_id:"",avatar_url:""}),r(!1),l.success("‚úÖ Webhook ba≈üarƒ±yla olu≈üturuldu")}else l.error("‚ùå Webhook olu≈üturulamadƒ±")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"createWebhook"),updateWebhook:t(async(n,i)=>{try{const o=await fetch(`${c}/webhooks/${n}/update/`,{method:"POST",headers:u(),body:JSON.stringify(i)});if(o.ok){const m=await o.json();a(b=>b.map(v=>v.id===n?m.webhook:v)),g(null),l.success("‚úÖ Webhook g√ºncellendi")}else l.error("‚ùå Webhook g√ºncellenemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"updateWebhook"),deleteWebhook:t(async n=>{if(await N("Bu webhook'u silmek istediƒüinizden emin misiniz?"))try{(await fetch(`${c}/webhooks/${n}/delete/`,{method:"DELETE",headers:u()})).ok?(a(o=>o.filter(m=>m.id!==n)),l.success("‚úÖ Webhook silindi")):l.error("‚ùå Webhook silinemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"deleteWebhook"),testWebhook:t(async n=>{try{(await fetch(`${c}/webhooks/${n}/test/`,{method:"POST",headers:u()})).ok?l.success("‚úÖ Test mesajƒ± g√∂nderildi"):l.error("‚ùå Test mesajƒ± g√∂nderilemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"testWebhook"),regenerateToken:t(async n=>{if(await N("Webhook tokenini yenilemek istediƒüinizden emin misiniz? Eski token ge√ßersiz hale gelecek."))try{const i=await fetch(`${c}/webhooks/${n}/regenerate-token/`,{method:"POST",headers:u()});if(i.ok){const o=await i.json();a(m=>m.map(b=>b.id===n?{...b,token:o.token}:b)),l.success("‚úÖ Token yenilendi")}else l.error("‚ùå Token yenilenemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"regenerateToken"),fetchWebhookLogs:t(async n=>{try{const i=await fetch(`${c}/webhooks/${n}/logs/`,{headers:u()});if(i.ok){const o=await i.json();_(o.logs||[]),p(n)}}catch{l.error("‚ùå Loglar y√ºklenemedi")}},"fetchWebhookLogs"),copyWebhookUrl:t(n=>{navigator.clipboard.writeText(`${c}/webhooks/${n.id}/${n.token}`),l.success("‚úÖ Webhook URL kopyalandƒ±")},"copyWebhookUrl")}}t(B,"useWebhooks");const M=t(({serverId:d,onClose:k})=>{const a=B(d);return a.loading?e.jsx("div",{className:"webhooks-overlay",children:e.jsx("div",{className:"webhooks-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Webhooklar y√ºkleniyor..."})]})})}):e.jsx("div",{className:"webhooks-overlay",onClick:k,children:e.jsxs("div",{className:"webhooks-panel",onClick:t(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsxs("h2",{children:["üîó"," Webhook Y√∂netimi"]}),e.jsx("button",{className:"close-btn",onClick:k,children:"√ó"})]}),e.jsxs("div",{className:"webhooks-content",children:[!a.creating&&e.jsxs("button",{className:"create-webhook-btn",onClick:t(()=>a.setCreating(!0),"onClick"),children:["‚ûï"," Yeni Webhook Olu≈ütur"]}),a.creating&&e.jsxs("div",{className:"create-webhook-form",children:[e.jsx("h3",{children:"Yeni Webhook"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ± *"}),e.jsx("input",{type:"text",placeholder:"√ñrn: GitHub Bot",value:a.newWebhook.name,onChange:t(s=>a.setNewWebhook({...a.newWebhook,name:s.target.value}),"onChange")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:a.newWebhook.channel_id,onChange:t(s=>a.setNewWebhook({...a.newWebhook,channel_id:s.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"Kanal se√ßin..."}),a.channels.map(s=>e.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL (Opsiyonel)"}),e.jsx("input",{type:"text",placeholder:"https://example.com/avatar.png",value:a.newWebhook.avatar_url,onChange:t(s=>a.setNewWebhook({...a.newWebhook,avatar_url:s.target.value}),"onChange")})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:t(()=>a.setCreating(!1),"onClick"),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:a.createWebhook,children:"Olu≈ütur"})]})]}),a.webhooks.length>0?e.jsx("div",{className:"webhooks-list",children:a.webhooks.map(s=>e.jsx("div",{className:"webhook-card",children:a.editingWebhook===s.id?e.jsxs("div",{className:"edit-webhook-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ±"}),e.jsx("input",{type:"text",defaultValue:s.name,id:`edit-name-${s.id}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("select",{defaultValue:s.channel_id,id:`edit-channel-${s.id}`,children:a.channels.map(r=>e.jsxs("option",{value:r.id,children:["#",r.name]},r.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL"}),e.jsx("input",{type:"text",defaultValue:s.avatar_url||"",id:`edit-avatar-${s.id}`})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:t(()=>a.setEditingWebhook(null),"onClick"),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:t(()=>a.updateWebhook(s.id,{name:document.getElementById(`edit-name-${s.id}`).value,channel_id:document.getElementById(`edit-channel-${s.id}`).value,avatar_url:document.getElementById(`edit-avatar-${s.id}`).value}),"onClick"),children:"Kaydet"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"webhook-info",children:[e.jsx("div",{className:"webhook-avatar",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name}):e.jsx("div",{className:"default-avatar",children:"üîó"})}),e.jsxs("div",{className:"webhook-details",children:[e.jsx("h4",{children:s.name}),e.jsxs("p",{children:["#",a.channels.find(r=>r.id===s.channel_id)?.name||"Bilinmeyen Kanal"]}),e.jsxs("span",{className:"webhook-id",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"webhook-url",children:[e.jsx("label",{children:"Webhook URL:"}),e.jsxs("div",{className:"url-display",children:[e.jsx("code",{children:`${a.apiBaseUrl}/webhooks/${s.id}/${s.token}`}),e.jsx("button",{className:"copy-btn",onClick:t(()=>a.copyWebhookUrl(s),"onClick"),title:"URL'yi kopyala",children:"üìã"})]})]}),e.jsxs("div",{className:"webhook-actions",children:[e.jsxs("button",{className:"action-btn test-btn",onClick:t(()=>a.testWebhook(s.id),"onClick"),title:"Test mesajƒ± g√∂nder",children:["üß™"," Test"]}),e.jsxs("button",{className:"action-btn logs-btn",onClick:t(()=>a.fetchWebhookLogs(s.id),"onClick"),title:"Loglarƒ± g√∂r√ºnt√ºle",children:["üìä"," Loglar"]}),e.jsx("button",{className:"action-btn edit-btn",onClick:t(()=>a.setEditingWebhook(s.id),"onClick"),title:"D√ºzenle",children:"‚úèÔ∏è"}),e.jsx("button",{className:"action-btn regenerate-btn",onClick:t(()=>a.regenerateToken(s.id),"onClick"),title:"Token yenile",children:"üîÑ"}),e.jsx("button",{className:"action-btn delete-btn",onClick:t(()=>a.deleteWebhook(s.id),"onClick"),title:"Sil",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"webhook-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Toplam √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.total_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±lƒ±:"}),e.jsx("span",{className:"stat-value success",children:s.successful_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±sƒ±z:"}),e.jsx("span",{className:"stat-value error",children:s.failed_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Son √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.last_call?new Date(s.last_call).toLocaleString("tr-TR"):"Hi√ß"})]})]})]})},s.id))}):!a.creating&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîó"}),e.jsx("h3",{children:"Hen√ºz webhook yok"}),e.jsx("p",{children:"Dƒ±≈ü uygulamalardan mesaj g√∂ndermek i√ßin webhook olu≈üturun"})]}),a.viewingLogs&&e.jsx("div",{className:"logs-modal",onClick:t(()=>a.setViewingLogs(null),"onClick"),children:e.jsxs("div",{className:"logs-content",onClick:t(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h3",{children:["üìä"," Webhook Loglarƒ±"]}),e.jsx("button",{className:"close-btn",onClick:t(()=>a.setViewingLogs(null),"onClick"),children:"√ó"})]}),e.jsx("div",{className:"logs-list",children:a.logs.length>0?a.logs.map((s,r)=>e.jsxs("div",{className:`log-item ${s.status}`,children:[e.jsx("div",{className:"log-time",children:new Date(s.timestamp).toLocaleString("tr-TR")}),e.jsxs("div",{className:"log-status",children:[s.status==="success"?"‚úÖ":"‚ùå"," ",s.status]}),e.jsx("div",{className:"log-message",children:s.message}),s.error&&e.jsxs("div",{className:"log-error",children:["Hata: ",s.error]})]},r)):e.jsx("p",{className:"empty-state",children:"Hen√ºz log kaydƒ± yok"})})]})})]})]})})},"WebhooksPanel");export{M as default};
