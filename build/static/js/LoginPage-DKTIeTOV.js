import{r as u,j as o}from"./react-vendor-D8Fi5F9E.js";import{a8 as C,A as O,S as z,d as D}from"./icons-vendor-CfNiWYc_.js";import{C as v,G as L,i as p,A as x,t as P}from"./index-DZYOpCY3.js";import{u as M}from"./recaptcha-BrFCBv3a.js";import{j as k}from"./crypto-vendor-Cz32ecGD.js";import"./media-vendor-Dp18sh1g.js";import"./router-vendor-CTPwQFnc.js";import"./state-vendor-De5qIGw3.js";const Y=({onLogin:T,onRegister:I,error:S,setAuthError:a})=>{const[m,b]=u.useState(!0),[i,y]=u.useState({username:"",email:"",password:""}),[G,j]=u.useState(!1),{getToken:_}=M();u.useEffect(()=>{if(v.isNativePlatform()){console.log("ğŸ“± [Google] Initializing Google Auth for mobile...");try{L.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}),console.log("âœ… [Google] Initialized successfully")}catch(e){console.error("âŒ [Google] Initialization failed:",e)}}},[]),u.useEffect(()=>{if(p&&window.require){const{ipcRenderer:e}=window.require("electron"),t=(h,l)=>{console.log("âœ… [Electron] Google auth success received");try{const{access:r,refresh:c}=l;if(r&&c){const g=k(r);console.log("ğŸ‘¤ [Electron] User:",g.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",g.username),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] Token error:",r),a("Token iÅŸleme hatasÄ±.")}},s=(h,l)=>{console.error("âŒ [Electron] Auth error:",l),a(l.error||"Google giriÅŸi baÅŸarÄ±sÄ±z.")},d=(h,l)=>{console.log("ğŸ”— [Electron] OAuth tokens received from main process");try{const{access:r,refresh:c}=l;if(r&&c){const g=k(r);console.log("ğŸ‘¤ [Electron] User from deep link:",g.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",g.username),console.log("âœ… [Electron] Tokens saved, reloading..."),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] OAuth token error:",r),a("Token iÅŸleme hatasÄ±.")}},n=(h,l)=>{console.log("ğŸš€ [DeepLink] URL YakalandÄ±:",l);try{const r=new URL(l),c=new URLSearchParams(r.search),g=c.get("access"),f=c.get("refresh");if(g&&f){console.log("âœ… [DeepLink] GiriÅŸ BaÅŸarÄ±lÄ±!");const w=k(g);console.log("ğŸ‘¤ [Electron] Decoded user from token:",w.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",f),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(r){console.error("Deep link hatasÄ±:",r);try{if(l.includes("access=")&&l.includes("refresh=")){const c=l.split("access=");if(c.length>1){const g=c[1].split("&")[0],f=l.split("refresh=");if(f.length>1){const w=f[1],R=k(g);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",R.username),window.location.reload()}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}catch(c){console.error("Manual parsing error:",c),a("GiriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z.")}}};return e.on("google-auth-success",t),e.on("google-auth-error",s),e.on("deep-link-auth",n),e.on("oauth-tokens",d),()=>{e.removeListener("google-auth-success",t),e.removeListener("google-auth-error",s),e.removeListener("deep-link-auth",n),e.removeListener("oauth-tokens",d)}}},[a]),u.useEffect(()=>{if(!p){const e=new URLSearchParams(window.location.search),t=e.get("access"),s=e.get("refresh"),d=e.get("error");if(d){console.error("âŒ [Web] OAuth error from URL:",d),a(decodeURIComponent(d)),window.history.replaceState({},document.title,"/");return}if(t&&s){console.log("ğŸŒ [Web] Tokenlar URL'den alÄ±ndÄ± (OAuth success)");try{const n=k(t);console.log("ğŸ‘¤ [Web] Decoded user from token:",n.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",s),localStorage.setItem("chat_username",n.username),console.log("âœ… [Web] Tokens and username saved to localStorage"),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(n){console.error("âŒ [Web] LocalStorage error:",n),a("TarayÄ±cÄ± depolama hatasÄ±. LÃ¼tfen gizli modda deÄŸilseniz kontrol edin.")}}}},[]);const N=async()=>{try{if(console.log("ğŸ”µ [Google] Login baÅŸlatÄ±lÄ±yor...",{isNative:v.isNativePlatform(),isElectron:p,apiUrl:x}),v.isNativePlatform()){console.log("ğŸ“± [Google] Mobile auth flow");const e=await L.signIn();console.log("âœ… [Google] User signed in:",e.email),console.log("ğŸ”‘ [Google] ID Token:",e.authentication.idToken);const t=`${x}/auth/google/native/`;console.log("ğŸ“¡ [Google] Sending to:",t);const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})});console.log("ğŸ” [Google] Response status:",s.status),console.log("ğŸ” [Google] Response headers:",s.headers);const d=s.headers.get("content-type");if(console.log("ğŸ” [Google] Content-Type:",d),!d||!d.includes("application/json")){const h=await s.text();console.error("âŒ [Google] Backend HTML dÃ¶ndÃ¼:",h.substring(0,500)),a("Backend hatasÄ±: JSON yerine HTML yanÄ±tÄ± alÄ±ndÄ±. Sunucu ayarlarÄ±nÄ± kontrol edin.");return}const n=await s.json();console.log("ğŸ“¦ [Google] Backend response data:",n),s.ok?(console.log("âœ… [Google] Login successful"),n.access&&n.refresh?(localStorage.setItem("access_token",n.access),localStorage.setItem("refresh_token",n.refresh),window.location.reload()):(console.error("âŒ [Google] Tokens eksik:",n),a("Token bilgileri eksik."))):(console.error("âŒ [Google] Login failed:",n),a(n.error||"Google giriÅŸi baÅŸarÄ±sÄ±z."))}else{console.log("ğŸŒ [Google] Web/Electron redirect flow");const s=`${p?"https://pawscord.com/api":x}/auth/google/start/?source=${p?"electron":"web"}`;if(console.log("ğŸ”€ [Google] Redirecting to:",s),p&&window.require){const{ipcRenderer:d}=window.require("electron");console.log("âœ… [Google] Opening in Electron popup:",s),d.send("start-google-login",s)}else window.location.href=s}}catch(e){console.error("âŒ [Google] Unexpected error:",e),a("Google giriÅŸi sÄ±rasÄ±nda bir hata oluÅŸtu: "+e.message)}},U=async e=>{e.preventDefault(),j(!0),a("");try{console.log("ğŸ”µ [Login] GiriÅŸ denemesi:",{username:i.username,mode:m?"login":"register"}),console.log("ğŸ”µ [Login] API URL:",x);const t=await _(m?"login":"register");console.log("âœ… [reCAPTCHA] Token alÄ±ndÄ±:",t?"OK":"FAIL"),m?await T(i.username,i.password,t):await I(i.username,i.email,i.password,t)&&(P.success("KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ± kontrol et.",4e3),b(!0))}catch(t){console.error("âŒ [Login] Beklenmeyen hata:",t),a("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{j(!1)}};return o.jsxs("div",{className:"login-container",children:[o.jsx("div",{className:"background-animate"}),o.jsxs("div",{className:"login-card",children:[o.jsxs("div",{className:"logo-header",children:[o.jsx("div",{className:"logo-circle",children:o.jsx(C,{size:40,color:"white"})}),o.jsx("h1",{children:"Pawscord"}),o.jsx("p",{children:m?"Tekrar hoÅŸgeldin!":"AramÄ±za katÄ±l!"})]}),S&&o.jsx("div",{className:"error-message",children:S}),o.jsxs("form",{onSubmit:U,children:[o.jsxs("div",{className:"input-group",children:[o.jsx(O,{className:"input-icon"}),o.jsx("input",{type:"text",placeholder:"KullanÄ±cÄ± AdÄ±",value:i.username,onChange:e=>y({...i,username:e.target.value}),required:!0})]}),!m&&o.jsxs("div",{className:"input-group slide-down",children:[o.jsx(z,{className:"input-icon"}),o.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:i.email,onChange:e=>y({...i,email:e.target.value}),required:!0})]}),o.jsxs("div",{className:"input-group",children:[o.jsx(D,{className:"input-icon"}),o.jsx("input",{type:"password",placeholder:"Åifre",value:i.password,onChange:e=>y({...i,password:e.target.value}),required:!0})]}),o.jsx("button",{type:"submit",className:"submit-btn",disabled:G,children:G?o.jsx("div",{className:"spinner"}):m?"GiriÅŸ Yap":"KayÄ±t Ol"})]}),m&&o.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:o.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1",children:"Åifremi Unuttum?"})}),o.jsx("div",{className:"divider",children:o.jsx("span",{children:"veya"})}),o.jsx("div",{className:"google-btn-wrapper",children:o.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5",children:[o.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),o.jsx("span",{children:"Google ile GiriÅŸ Yap"})]})}),o.jsxs("div",{className:"toggle-mode",children:[m?"HesabÄ±n yok mu? ":"Zaten Ã¼ye misin? ",o.jsx("span",{onClick:()=>{b(!m),a("")},children:m?"KayÄ±t Ol":"GiriÅŸ Yap"})]})]})]})};export{Y as default};
