import{r as i}from"./react-core-B6hadH-M.js";import{h as A}from"./index-D_6pZib5.js";const j=({serverId:m,onClose:E})=>{const[c,d]=i.useState([]),[N,h]=i.useState(!0),[k,g]=i.useState(!1),[l,r]=i.useState(null),[p,b]=i.useState(null),[o,u]=i.useState({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0}),v=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}];i.useEffect(()=>{f()},[m]);const f=async()=>{try{h(!0);const e=localStorage.getItem("access_token"),a=await fetch(`/api/roles/${m}/list/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const t=await a.json();d(t.roles||[])}else console.error("Failed to fetch roles")}catch(e){console.error("Error fetching roles:",e)}finally{h(!1)}},y=async()=>{if(o.name.trim())try{const e=localStorage.getItem("access_token"),a=await fetch(`/api/roles/${m}/create/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(a.ok){const t=await a.json();d([...c,t.role]),g(!1),u({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0})}else console.error("âŒ Failed to create role")}catch(e){console.error("Error creating role:",e)}},C=async(e,a)=>{try{const t=localStorage.getItem("access_token"),n=await fetch(`/api/roles/${m}/${e}/update/`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.ok){const R=await n.json();d(c.map(s=>s.id===e?R.role:s)),r(null)}else console.error("âŒ Failed to update role")}catch(t){console.error("Error updating role:",t)}},S=async e=>{if(await A("Are you sure you want to delete this role?"))try{const a=localStorage.getItem("access_token");(await fetch(`/api/roles/${m}/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?d(c.filter(n=>n.id!==e)):console.error("âŒ Failed to delete role")}catch(a){console.error("Error deleting role:",a)}},w=async e=>{try{const a=localStorage.getItem("access_token");(await fetch(`/api/roles/${m}/reorder/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({order:e})})).ok?f():console.error("âŒ Failed to reorder roles")}catch(a){console.error("Error reordering roles:",a)}},x=(e,a)=>{b(a),e.dataTransfer.effectAllowed="move"},$=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},D=(e,a)=>{if(e.preventDefault(),!p||p.id===a.id)return;const t=c.findIndex(s=>s.id===p.id),n=c.findIndex(s=>s.id===a.id),R=[...c];R.splice(t,1),R.splice(n,0,p),d(R),w(R.map(s=>s.id)),b(null)},T=async e=>{try{const a=localStorage.getItem("access_token"),t=await fetch(`/api/roles/${m}/${e}/copy/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(t.ok){const n=await t.json();d([...c,n.role])}else console.error("âŒ Failed to copy role")}catch(a){console.error("Error copying role:",a)}};return N?React.createElement("div",{className:"roles-manager-overlay"},React.createElement("div",{className:"roles-manager-modal"},React.createElement("div",{className:"loading-spinner"},"Loading roles..."))):React.createElement("div",{className:"roles-manager-overlay",onClick:E},React.createElement("div",{className:"roles-manager-modal",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"roles-manager-header"},React.createElement("h2",null,"ðŸŽ­ Server Roles"),React.createElement("button",{className:"close-btn",onClick:E},"âœ•")),React.createElement("div",{className:"roles-manager-content"},React.createElement("div",{className:"roles-actions"},React.createElement("button",{className:"create-role-btn",onClick:()=>g(!0)},"âž• Create Role"),React.createElement("div",{className:"roles-info"},React.createElement("span",null,c.length," roles"),React.createElement("span",{className:"info-tip"},"ðŸ’¡ Drag to reorder hierarchy"))),React.createElement("div",{className:"roles-list"},c.length===0?React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-icon"},"ðŸŽ­"),React.createElement("h3",null,"No Roles Yet"),React.createElement("p",null,"Create roles to organize your server members")):c.map(e=>React.createElement("div",{key:e.id,className:`role-card ${p?.id===e.id?"dragging":""}`,draggable:!0,onDragStart:a=>x(a,e),onDragOver:$,onDrop:a=>D(a,e)},React.createElement("div",{className:"role-drag-handle"},"â˜°"),React.createElement("div",{className:"role-color-badge",style:{backgroundColor:e.color}}),React.createElement("div",{className:"role-info"},React.createElement("div",{className:"role-name",style:{color:e.color}},e.name),React.createElement("div",{className:"role-meta"},React.createElement("span",{className:"role-members"},"ðŸ‘¥ ",e.member_count||0," members"),e.hoist&&React.createElement("span",{className:"role-badge"},"ðŸ“Œ Hoisted"),e.mentionable&&React.createElement("span",{className:"role-badge"},"@ Mentionable"))),React.createElement("div",{className:"role-actions"},React.createElement("button",{className:"role-action-btn edit",onClick:()=>r(e),title:"Edit"},"âœï¸"),React.createElement("button",{className:"role-action-btn copy",onClick:()=>T(e.id),title:"Copy"},"ðŸ“‹"),React.createElement("button",{className:"role-action-btn delete",onClick:()=>S(e.id),title:"Delete"},"ðŸ—‘ï¸")))))),k&&React.createElement("div",{className:"role-modal-overlay",onClick:()=>g(!1)},React.createElement("div",{className:"role-modal",onClick:e=>e.stopPropagation()},React.createElement("h3",null,"Create New Role"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Role Name"),React.createElement("input",{type:"text",value:o.name,onChange:e=>u({...o,name:e.target.value}),placeholder:"Enter role name...",maxLength:32})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Role Color"),React.createElement("div",{className:"color-picker"},v.map(e=>React.createElement("button",{key:e.value,className:`color-preset ${o.color===e.value?"active":""}`,style:{backgroundColor:e.value},onClick:()=>u({...o,color:e.value}),title:e.name})),React.createElement("input",{type:"color",value:o.color,onChange:e=>u({...o,color:e.target.value}),className:"color-input"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:o.hoist,onChange:e=>u({...o,hoist:e.target.checked})}),React.createElement("span",null,"Display role members separately from online members"))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:o.mentionable,onChange:e=>u({...o,mentionable:e.target.checked})}),React.createElement("span",null,"Allow anyone to @mention this role"))),React.createElement("div",{className:"modal-actions"},React.createElement("button",{className:"cancel-btn",onClick:()=>g(!1)},"Cancel"),React.createElement("button",{className:"create-btn",onClick:y},"Create Role")))),l&&React.createElement("div",{className:"role-modal-overlay",onClick:()=>r(null)},React.createElement("div",{className:"role-modal",onClick:e=>e.stopPropagation()},React.createElement("h3",null,"Edit Role"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Role Name"),React.createElement("input",{type:"text",value:l.name,onChange:e=>r({...l,name:e.target.value}),placeholder:"Enter role name...",maxLength:32})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Role Color"),React.createElement("div",{className:"color-picker"},v.map(e=>React.createElement("button",{key:e.value,className:`color-preset ${l.color===e.value?"active":""}`,style:{backgroundColor:e.value},onClick:()=>r({...l,color:e.value}),title:e.name})),React.createElement("input",{type:"color",value:l.color,onChange:e=>r({...l,color:e.target.value}),className:"color-input"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:l.hoist,onChange:e=>r({...l,hoist:e.target.checked})}),React.createElement("span",null,"Display role members separately"))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:l.mentionable,onChange:e=>r({...l,mentionable:e.target.checked})}),React.createElement("span",null,"Allow anyone to @mention this role"))),React.createElement("div",{className:"modal-actions"},React.createElement("button",{className:"cancel-btn",onClick:()=>r(null)},"Cancel"),React.createElement("button",{className:"save-btn",onClick:()=>C(l.id,l)},"Save Changes"))))))};export{j as default};
