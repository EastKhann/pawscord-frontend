var R=Object.defineProperty;var s=(p,e)=>R(p,"name",{value:e,configurable:!0});import{r as v,j as i}from"./react-core-Djgtqrmb.js";import{y as k}from"./ui-vendor-IhB9Znpc.js";import{p as _}from"./purify.es-CVaxJkcz.js";import{w as P,t as z,e as D}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const L=class L extends Error{constructor(e,t,a,h=null){super(e),this.name="ApiError",this.status=t,this.code=a,this.data=h,this.timestamp=new Date().toISOString()}toJSON(){return{name:this.name,message:this.message,status:this.status,code:this.code,data:this.data,timestamp:this.timestamp}}};s(L,"ApiError");let b=L;const q=class q{constructor(e=6,t=100){this.queue=[],this.running=0,this.maxConcurrent=e,this.rateLimit=t,this.requestTimes=[]}async add(e){return new Promise((t,a)=>{this.queue.push({fn:e,resolve:t,reject:a}),this.process()})}async process(){if(this.running>=this.maxConcurrent||this.queue.length===0)return;const e=Date.now();if(this.requestTimes=this.requestTimes.filter(n=>e-n<6e4),this.requestTimes.length>=this.rateLimit){setTimeout(()=>this.process(),1e3);return}const{fn:t,resolve:a,reject:h}=this.queue.shift();this.running++,this.requestTimes.push(e);try{const n=await t();a(n)}catch(n){h(n)}finally{this.running--,this.process()}}};s(q,"RequestQueue");let $=q;const E=class E{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||200,this.defaultTTL=e.defaultTTL||300*1e3,this.hits=0,this.misses=0}generateKey(e,t){const a=t?JSON.stringify(Object.keys(t).sort().reduce((h,n)=>(h[n]=t[n],h),{})):"";return`${e}:${a}`}get(e){const t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),this.misses++,null):(this.hits++,t.data):(this.misses++,null)}set(e,t,a=this.defaultTTL){if(this.cache.size>=this.maxSize){const h=this.cache.keys().next().value;this.cache.delete(h)}this.cache.set(e,{data:t,expiry:Date.now()+a,timestamp:Date.now()})}invalidate(e){if(typeof e=="string")for(const t of this.cache.keys())t.includes(e)&&this.cache.delete(t);else if(e instanceof RegExp)for(const t of this.cache.keys())e.test(t)&&this.cache.delete(t)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,maxSize:this.maxSize,hits:this.hits,misses:this.misses,hitRate:this.hits+this.misses>0?(this.hits/(this.hits+this.misses)*100).toFixed(2)+"%":"0%"}}};s(E,"SmartCache");let N=E;const C=class C{constructor(){this.users={getProfile:s(e=>this.get(`/api/users/${e}/`),"getProfile"),updateProfile:s((e,t)=>this.patch(`/api/users/${e}/`,t),"updateProfile"),getSettings:s(()=>this.get("/api/users/settings/"),"getSettings"),updateSettings:s(e=>this.patch("/api/users/settings/",e),"updateSettings"),getFriends:s(()=>this.get("/api/friends/",{cacheTTL:this.config.cacheTTL.short}),"getFriends"),sendFriendRequest:s(e=>this.post("/api/friends/send/",{user_id:e}),"sendFriendRequest"),getBlocked:s(()=>this.get("/api/blocked-users/"),"getBlocked"),blockUser:s(e=>this.post("/api/blocked-users/",{user_id:e}),"blockUser"),unblockUser:s(e=>this.delete(`/api/blocked-users/${e}/`),"unblockUser")},this.servers={list:s(()=>this.get("/api/servers/",{cacheTTL:this.config.cacheTTL.short}),"list"),get:s(e=>this.get(`/api/servers/${e}/`),"get"),create:s(e=>this.post("/api/servers/",e),"create"),update:s((e,t)=>this.patch(`/api/servers/${e}/`,t),"update"),delete:s(e=>this.delete(`/api/servers/${e}/`),"delete"),getMembers:s(e=>this.get(`/api/servers/${e}/members/`),"getMembers"),getRoles:s(e=>this.get(`/api/servers/${e}/roles/`),"getRoles"),getBoostStats:s(e=>this.get(`/api/servers/${e}/boost-stats/`),"getBoostStats")},this.rooms={list:s(e=>this.get(`/api/servers/${e}/rooms/`),"list"),get:s(e=>this.get(`/api/rooms/${e}/`),"get"),create:s((e,t)=>this.post(`/api/servers/${e}/rooms/`,t),"create"),update:s((e,t)=>this.patch(`/api/rooms/${e}/`,t),"update"),delete:s(e=>this.delete(`/api/rooms/${e}/`),"delete"),getMessages:s((e,t)=>this.get(`/api/rooms/${e}/messages/`,{params:t,cacheTTL:this.config.cacheTTL.short}),"getMessages")},this.messages={send:s((e,t)=>this.post(`/api/rooms/${e}/messages/`,t),"send"),edit:s((e,t)=>this.patch(`/api/messages/${e}/`,{content:t}),"edit"),delete:s(e=>this.delete(`/api/messages/${e}/`),"delete"),pin:s(e=>this.post(`/api/messages/${e}/pin/`),"pin"),unpin:s(e=>this.post(`/api/messages/${e}/unpin/`),"unpin"),react:s((e,t)=>this.post(`/api/messages/${e}/react/`,{emoji:t}),"react"),search:s(e=>this.get("/api/messages/search/",{params:e}),"search")},this.auth={login:s(e=>this.post("/api/auth/login/",e,{showError:!1}),"login"),register:s(e=>this.post("/api/auth/register/",e),"register"),logout:s(()=>this.post("/api/auth/logout/"),"logout"),refreshToken:s(()=>this.refreshToken(),"refreshToken"),verifyEmail:s(e=>this.post("/api/auth/verify-email/",{token:e}),"verifyEmail"),resetPassword:s(e=>this.post("/api/auth/reset-password/",{email:e}),"resetPassword"),enable2FA:s(()=>this.post("/api/auth/2fa/enable/"),"enable2FA"),verify2FA:s(e=>this.post("/api/auth/2fa/verify/",{code:e}),"verify2FA")},this.moderation={ban:s((e,t,a)=>this.post(`/api/servers/${e}/bans/`,{user_id:t,reason:a}),"ban"),unban:s((e,t)=>this.delete(`/api/servers/${e}/bans/${t}/`),"unban"),kick:s((e,t,a)=>this.post(`/api/servers/${e}/kicks/`,{user_id:t,reason:a}),"kick"),warn:s((e,t,a)=>this.post(`/api/servers/${e}/warnings/`,{user_id:t,reason:a}),"warn"),getAuditLogs:s((e,t)=>this.get(`/api/servers/${e}/audit-logs/`,{params:t}),"getAuditLogs")},this.premium={getPlans:s(()=>this.get("/api/premium/plans/",{cacheTTL:this.config.cacheTTL.long}),"getPlans"),subscribe:s((e,t)=>this.post("/api/premium/subscribe/",{plan_id:e,payment_method:t}),"subscribe"),cancelSubscription:s(()=>this.post("/api/premium/cancel/"),"cancelSubscription"),getStatus:s(()=>this.get("/api/premium/status/"),"getStatus")},this.analytics={getServerStats:s(e=>this.get(`/api/servers/${e}/analytics/`),"getServerStats"),getUserActivity:s(()=>this.get("/api/users/analytics/"),"getUserActivity"),trackEvent:s((e,t)=>this.post("/api/analytics/events/",{event:e,data:t},{showError:!1}),"trackEvent")},this.baseURL=P,this.cache=new N,this.queue=new $,this.pendingRequests=new Map,this.interceptors={request:[],response:[],error:[]},this.config={timeout:3e4,retryAttempts:3,retryDelay:1e3,retryMultiplier:2,cacheTTL:{short:30*1e3,medium:300*1e3,long:1800*1e3}},this.setupDefaultInterceptors()}setupDefaultInterceptors(){this.addRequestInterceptor(e=>{const t=localStorage.getItem("access_token");return t&&(e.headers={...e.headers,Authorization:`Bearer ${t}`}),e}),this.addErrorInterceptor(async e=>{if(e.status===401&&await this.refreshToken())return this.request(e.originalConfig);throw e})}addRequestInterceptor(e){this.interceptors.request.push(e)}addResponseInterceptor(e){this.interceptors.response.push(e)}addErrorInterceptor(e){this.interceptors.error.push(e)}buildURL(e,t){const a=new URL(e,this.baseURL);return t&&Object.entries(t).forEach(([h,n])=>{n!=null&&a.searchParams.append(h,n)}),a.toString()}async request(e,t={}){const{method:a="GET",headers:h={},body:n,params:m,cache:x=a==="GET",cacheTTL:g=this.config.cacheTTL.medium,retry:w=!0,deduplicate:d=!0,timeout:u=this.config.timeout,showError:c=!0,...l}=t,T=this.buildURL(e,m),o=this.cache.generateKey(T,m);if(x&&a==="GET"){const y=this.cache.get(o);if(y)return{data:y,fromCache:!0}}if(d&&a==="GET"){const y=this.pendingRequests.get(o);if(y)return y}let r={url:T,method:a,headers:{"Content-Type":"application/json",...h},body:n?JSON.stringify(n):void 0,...l};for(const y of this.interceptors.request)r=await y(r);const f=this.executeRequest(r,{retry:w,timeout:u,showError:c,cacheKey:o,cacheTTL:g,useCache:x,method:a});return d&&a==="GET"&&(this.pendingRequests.set(o,f),f.finally(()=>{this.pendingRequests.delete(o)})),f}async executeRequest(e,t){const{retry:a,timeout:h,showError:n,cacheKey:m,cacheTTL:x,useCache:g,method:w}=t;let d;for(let u=0;u<=(a?this.config.retryAttempts:0);u++)try{const c=await this.queue.add(()=>this.fetchWithTimeout(e.url,{method:e.method,headers:e.headers,body:e.body},h));if(!c.ok){const o=await c.json().catch(()=>({}));throw new b(o.message||o.error||`HTTP Error ${c.status}`,c.status,o.code||"HTTP_ERROR",o)}let l;c.headers.get("content-type")?.includes("application/json")?l=await c.json():l=await c.text();for(const o of this.interceptors.response)l=await o(l,c);return g&&w==="GET"&&this.cache.set(m,l,x),{data:l,fromCache:!1}}catch(c){if(d=c,c.status===401||c.status===403||c.status===404)break;if(u<this.config.retryAttempts){const l=this.config.retryDelay*Math.pow(this.config.retryMultiplier,u);await this.sleep(l)}}for(const u of this.interceptors.error)try{const c=await u({...d,originalConfig:e});if(c)return c}catch(c){d=c}throw n&&z.error(d.message||"Bir hata oluÅŸtu"),d}async fetchWithTimeout(e,t,a){const h=new AbortController,n=setTimeout(()=>h.abort(),a);try{return await fetch(e,{...t,signal:h.signal})}finally{clearTimeout(n)}}async refreshToken(){try{const e=await fetch(`${this.baseURL}/api/auth/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({})});if(e.ok){const t=await e.json();return localStorage.setItem("access_token",t.access),!0}}catch{}return localStorage.removeItem("access_token"),!1}sleep(e){return new Promise(t=>setTimeout(t,e))}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async post(e,t,a={}){const h=await this.request(e,{...a,method:"POST",body:t});return this.cache.invalidate(e.split("/")[0]),h}async put(e,t,a={}){const h=await this.request(e,{...a,method:"PUT",body:t});return this.cache.invalidate(e.split("/")[0]),h}async patch(e,t,a={}){const h=await this.request(e,{...a,method:"PATCH",body:t});return this.cache.invalidate(e.split("/")[0]),h}async delete(e,t={}){const a=await this.request(e,{...t,method:"DELETE"});return this.cache.invalidate(e.split("/")[0]),a}getCacheStats(){return this.cache.getStats()}clearCache(){this.cache.clear()}invalidateCache(e){this.cache.invalidate(e)}};s(C,"ApiService");let S=C;const j=new S,K=s(p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"escapeRegex"),W=s(({serverId:p,onClose:e})=>{const[t,a]=v.useState({enabled:!1,keywords:[],dm_notifications:!0,highlight_color:"#fbbf24"}),[h,n]=v.useState([]),[m,x]=v.useState(!0),[g,w]=v.useState("");v.useEffect(()=>{d(),u()},[p]);const d=s(async()=>{try{const r=await j.get(`/highlights/server/${p}/config/`);a(r)}catch{}finally{x(!1)}},"fetchConfig"),u=s(async()=>{try{const r=await j.get(`/highlights/server/${p}/messages/`);n(r)}catch{}},"fetchHighlights"),c=s(async()=>{try{await j.post(`/highlights/server/${p}/config/`,t),k.success("âœ… Highlight ayarlarÄ± kaydedildi")}catch{k.error("âŒ Kaydetme hatasÄ±")}},"saveConfig"),l=s(()=>{if(g.trim()){if(t.keywords.includes(g.toLowerCase())){k.warning("âš ï¸ Bu kelime zaten ekli");return}a({...t,keywords:[...t.keywords,g.toLowerCase()]}),w("")}},"addKeyword"),T=s(r=>{a({...t,keywords:t.keywords.filter(f=>f!==r)})},"removeKeyword"),o=s(async()=>{if(await D("TÃ¼m highlight geÃ§miÅŸini temizlemek istediÄŸinize emin misiniz?"))try{(await fetch(`${apiBaseUrl}/highlights/server/${p}/clear/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(k.success("âœ… GeÃ§miÅŸ temizlendi"),n([]))}catch{k.error("âŒ Temizleme hatasÄ±")}},"clearHighlights");return i.jsx("div",{className:"highlights-overlay",onClick:e,children:i.jsxs("div",{className:"highlights-panel",onClick:s(r=>r.stopPropagation(),"onClick"),children:[i.jsxs("div",{className:"highlights-header",children:[i.jsx("h2",{children:"âœ¨ Highlight Sistemi"}),i.jsx("button",{className:"close-btn",onClick:e,children:"Ã—"})]}),i.jsx("div",{className:"highlights-content",children:m?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"YÃ¼kleniyor..."})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"config-section",children:[i.jsxs("div",{className:"section-header",children:[i.jsx("h3",{children:"âš™ï¸ Ayarlar"}),i.jsxs("label",{className:"toggle-switch",children:[i.jsx("input",{type:"checkbox",checked:t.enabled,onChange:s(r=>a({...t,enabled:r.target.checked}),"onChange")}),i.jsx("span",{className:"toggle-slider"})]})]}),i.jsxs("div",{className:"keywords-section",children:[i.jsx("h4",{children:"ðŸ”‘ Anahtar Kelimeler"}),i.jsxs("div",{className:"keyword-input",children:[i.jsx("input",{type:"text",value:g,onChange:s(r=>w(r.target.value),"onChange"),onKeyPress:s(r=>r.key==="Enter"&&l(),"onKeyPress"),placeholder:"Kelime ekle..."}),i.jsx("button",{onClick:l,children:"âž•"})]}),t.keywords.length>0&&i.jsx("div",{className:"keywords-list",children:t.keywords.map((r,f)=>i.jsxs("div",{className:"keyword-tag",children:[i.jsx("span",{children:r}),i.jsx("button",{onClick:s(()=>T(r),"onClick"),children:"Ã—"})]},f))})]}),i.jsxs("div",{className:"config-options",children:[i.jsx("div",{className:"form-group",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:t.dm_notifications,onChange:s(r=>a({...t,dm_notifications:r.target.checked}),"onChange")}),i.jsx("span",{children:"DM bildirimleri gÃ¶nder"})]})}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Highlight Rengi"}),i.jsx("input",{type:"color",value:t.highlight_color,onChange:s(r=>a({...t,highlight_color:r.target.value}),"onChange")})]})]}),i.jsx("button",{className:"save-btn",onClick:c,children:"ðŸ’¾ Kaydet"})]}),i.jsxs("div",{className:"highlights-section",children:[i.jsxs("div",{className:"section-header",children:[i.jsxs("h3",{children:["ðŸ“ Highlight GeÃ§miÅŸi (",h.length,")"]}),h.length>0&&i.jsx("button",{className:"clear-btn",onClick:o,children:"ðŸ—‘ï¸ Temizle"})]}),h.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx("span",{className:"empty-icon",children:"âœ¨"}),i.jsx("p",{children:"HenÃ¼z highlight yok"})]}):i.jsx("div",{className:"highlights-list",children:h.map(r=>i.jsxs("div",{className:"highlight-card",children:[i.jsxs("div",{className:"highlight-header",children:[i.jsxs("div",{className:"highlight-author",children:[r.author_avatar?i.jsx("img",{src:r.author_avatar,alt:""}):i.jsx("div",{className:"default-avatar",children:"ðŸ‘¤"}),i.jsxs("div",{className:"author-info",children:[i.jsx("span",{className:"author-name",children:r.author_name}),i.jsx("span",{className:"channel-name",children:r.channel_name})]})]}),i.jsx("span",{className:"highlight-time",children:new Date(r.created_at).toLocaleString("tr-TR")})]}),i.jsx("div",{className:"highlight-content",children:i.jsx("p",{dangerouslySetInnerHTML:{__html:_.sanitize(t.keywords.length>0?r.content.replace(new RegExp(`(${t.keywords.map(K).join("|")})`,"gi"),`<mark style="background: ${t.highlight_color}; color: #000; padding: 2px 4px; border-radius: 4px;">$1</mark>`):r.content)}})})]},r.id))})]})]})})]})})},"HighlightsPanel");export{W as default};
