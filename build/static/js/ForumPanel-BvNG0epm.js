import{r as l,d as e}from"./react-core-DrOm_csO.js";import{t as n}from"./index-DmEhdEtw.js";const D=({serverId:E,apiBaseUrl:c,onClose:h})=>{const[f,b]=l.useState([]),[m,C]=l.useState(null),[u,k]=l.useState([]),[r,d]=l.useState(null),[z,F]=l.useState(!0),[S,w]=l.useState(!1),[$,v]=l.useState(!1),[i,N]=l.useState({title:"",content:"",tags:[]}),[y,P]=l.useState("");l.useEffect(()=>{A()},[E]),l.useEffect(()=>{m&&T(m.id)},[m]);const A=async()=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/servers/${E}/forums/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const o=await a.json();b(Array.isArray(o)?o:o.forums||[])}}catch(t){console.error("Forum fetch error:",t)}finally{F(!1)}},T=async t=>{try{const a=localStorage.getItem("access_token"),o=await fetch(`${c}/forums/${t}/posts/`,{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const s=await o.json();k(Array.isArray(s)?s:s.posts||[])}}catch(a){console.error("Posts fetch error:",a)}},_=async()=>{const t=prompt("Forum kanalÄ± adÄ±:");if(t)try{const a=localStorage.getItem("access_token"),o=await fetch(`${c}/servers/${E}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({name:t})});if(o.ok){const s=await o.json();b([...f,s.forum]),n.success("âœ… Forum oluÅŸturuldu!")}else n.error("âŒ Forum oluÅŸturulamadÄ±")}catch(a){console.error("Forum creation error:",a),n.error("âŒ Hata oluÅŸtu")}},j=async()=>{if(!i.title.trim()||!i.content.trim()){n.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}w(!0);try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/forums/${m.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const o=await a.json();k([o.post,...u]),N({title:"",content:"",tags:[]}),v(!1),n.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else n.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch(t){console.error("Post creation error:",t),n.error("âŒ Hata oluÅŸtu")}finally{w(!1)}},O=async t=>{if(!y.trim()){n.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const a=localStorage.getItem("access_token"),o=await fetch(`${c}/forums/posts/${t}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({content:y})});if(o.ok){const s=await o.json();d({...r,replies:[...r.replies||[],s.reply]}),P(""),n.success("âœ… YanÄ±t gÃ¶nderildi!")}else n.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch(a){console.error("Reply error:",a),n.error("âŒ Hata oluÅŸtu")}},p=async(t,a)=>{try{const o=localStorage.getItem("access_token"),s=await fetch(`${c}/forums/posts/${t}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:a})});if(s.ok){const G=await s.json();k(u.map(g=>g.id===t?{...g,votes:G.votes}:g)),n.success(a==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch(o){console.error("Vote error:",o)}},Y=async(t,a)=>{try{const o=localStorage.getItem("access_token");(await fetch(`${c}/forums/posts/${t}/solve/${a}/`,{method:"POST",headers:{Authorization:`Bearer ${o}`}})).ok&&(n.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),d({...r,solution_id:a}))}catch(o){console.error("Mark solution error:",o)}};return z?e.createElement("div",{className:"forum-panel-overlay",onClick:h},e.createElement("div",{className:"forum-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"forum-loading"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"YÃ¼kleniyor...")))):e.createElement("div",{className:"forum-panel-overlay",onClick:h},e.createElement("div",{className:"forum-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"forum-header"},e.createElement("h2",null,"ğŸ’¬ Forum"),e.createElement("button",{className:"close-btn",onClick:h},"âœ•")),m?r?e.createElement("div",{className:"post-detail"},e.createElement("div",{className:"detail-header"},e.createElement("button",{className:"back-btn",onClick:()=>d(null)},"â† Geri")),e.createElement("div",{className:"post-main"},e.createElement("div",{className:"post-votes-vertical"},e.createElement("button",{onClick:()=>p(r.id,"up")},"ğŸ‘"),e.createElement("span",null,r.votes||0),e.createElement("button",{onClick:()=>p(r.id,"down")},"ğŸ‘")),e.createElement("div",{className:"post-body"},e.createElement("h2",null,r.title),e.createElement("p",{className:"post-meta"},"ğŸ‘¤ ",r.author," â€¢ â° ",new Date(r.created_at).toLocaleString("tr-TR")),e.createElement("div",{className:"post-text"},r.content))),e.createElement("div",{className:"replies-section"},e.createElement("h3",null,"ğŸ’¬ YanÄ±tlar (",r.replies?.length||0,")"),(r.replies||[]).map(t=>e.createElement("div",{key:t.id,className:`reply-item ${t.id===r.solution_id?"solution":""}`},e.createElement("div",{className:"reply-header"},e.createElement("span",{className:"reply-author"},"ğŸ‘¤ ",t.author),e.createElement("span",{className:"reply-time"},new Date(t.created_at).toLocaleString("tr-TR")),t.id===r.solution_id&&e.createElement("span",{className:"solution-badge"},"âœ… Ã‡Ã¶zÃ¼m")),e.createElement("div",{className:"reply-content"},t.content),!r.solution_id&&e.createElement("button",{className:"mark-solution-btn",onClick:()=>Y(r.id,t.id)},"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"))),e.createElement("div",{className:"reply-form"},e.createElement("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:y,onChange:t=>P(t.target.value),rows:4}),e.createElement("button",{className:"reply-submit-btn",onClick:()=>O(r.id)},"ğŸ“¤ YanÄ±tla")))):e.createElement("div",{className:"posts-view"},e.createElement("div",{className:"posts-header"},e.createElement("button",{className:"back-btn",onClick:()=>C(null)},"â† Geri"),e.createElement("h3",null,"# ",m.name),e.createElement("button",{className:"new-post-btn",onClick:()=>v(!$)},"â• Yeni GÃ¶nderi")),$&&e.createElement("div",{className:"create-post-form"},e.createElement("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:i.title,onChange:t=>N({...i,title:t.target.value}),maxLength:200}),e.createElement("textarea",{placeholder:"Ä°Ã§erik...",value:i.content,onChange:t=>N({...i,content:t.target.value}),rows:6}),e.createElement("div",{className:"form-actions"},e.createElement("button",{className:"submit-btn",onClick:j,disabled:S},S?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"),e.createElement("button",{className:"cancel-btn",onClick:()=>v(!1)},"Ä°ptal"))),e.createElement("div",{className:"posts-list"},u.map(t=>e.createElement("div",{key:t.id,className:"post-item",onClick:()=>d(t)},e.createElement("div",{className:"post-votes"},e.createElement("button",{onClick:a=>{a.stopPropagation(),p(t.id,"up")}},"ğŸ‘"),e.createElement("span",null,t.votes||0),e.createElement("button",{onClick:a=>{a.stopPropagation(),p(t.id,"down")}},"ğŸ‘")),e.createElement("div",{className:"post-content"},e.createElement("h4",null,t.title),e.createElement("p",{className:"post-meta"},"ğŸ‘¤ ",t.author," â€¢ â° ",new Date(t.created_at).toLocaleDateString("tr-TR"),t.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"),e.createElement("p",{className:"post-preview"},t.content?.substring(0,150),"..."),e.createElement("div",{className:"post-stats"},"ğŸ’¬ ",t.replies_count||0," yanÄ±t")))),u.length===0&&e.createElement("div",{className:"no-posts"},e.createElement("p",null,"ğŸ“­ HenÃ¼z gÃ¶nderi yok")))):e.createElement("div",{className:"forum-list"},e.createElement("div",{className:"forum-list-header"},e.createElement("h3",null,"Forum KanallarÄ±"),e.createElement("button",{className:"create-forum-btn",onClick:_},"â• Yeni Forum")),f.length>0?e.createElement("div",{className:"forums-grid"},f.map(t=>e.createElement("div",{key:t.id,className:"forum-card",onClick:()=>C(t)},e.createElement("div",{className:"forum-icon"},"ğŸ’¬"),e.createElement("h4",null,t.name),e.createElement("p",{className:"forum-stats"},t.posts_count||0," gÃ¶nderi â€¢ ",t.members_count||0," Ã¼ye")))):e.createElement("div",{className:"no-forums"},e.createElement("p",null,"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"),e.createElement("button",{onClick:_},"Ä°lk forumu oluÅŸtur")))))};export{D as default};
