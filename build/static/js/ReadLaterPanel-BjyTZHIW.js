import{r,j as a}from"./react-vendor-D4QjtNWS.js";import{bg as S,Z as F,b as M,bf as Q,aH as x,a as E,m as H}from"./icons-vendor-BZYtSAMW.js";import"./vendor-Brv1On52.js";import"./state-vendor-T8XA44Ud.js";import"./perf-vendor-CmoV45_-.js";function V({apiBaseUrl:n,fetchWithAuth:l}){const[p,k]=r.useState([]),[m,u]=r.useState([]),[c,N]=r.useState([]),[i,L]=r.useState(""),[$,d]=r.useState(!1),[g,v]=r.useState(""),[f,b]=r.useState("#5865f2"),[_,y]=r.useState(!1),[T,t]=r.useState(""),O=["#5865f2","#43b581","#f04747","#faa61a","#9b59b6","#3498db","#e91e63","#00bcd4","#ff9800","#4caf50"];r.useEffect(()=>{h(),P()},[]);const h=async()=>{y(!0);try{const e=await l(`${n}/api/messages/readlater/list/`);if(e.ok){const o=await e.json();k(o.bookmarks||[])}}catch(e){t("Failed to load bookmarks: "+e.message)}finally{y(!1)}},P=async()=>{try{const e=await l(`${n}/api/bookmarks/tags/list/`);if(e.ok){const o=await e.json();u(o.tags||[])}}catch(e){console.error("Error loading tags:",e)}},C=async()=>{if(!g.trim()){t("Tag name cannot be empty");return}try{const e=await l(`${n}/api/bookmarks/tags/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g,color:f})});if(e.ok){const o=await e.json();u([...m,o.tag]),v(""),b("#5865f2"),d(!1),t("")}else{const o=await e.json();t(o.error||"Failed to create tag")}}catch(e){t("Network error: "+e.message)}},J=async e=>{try{(await l(`${n}/api/messages/readlater/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(k(p.filter(s=>s.message_id!==e)),t(""))}catch(o){t("Failed to remove bookmark: "+o.message)}},R=async(e,o)=>{try{(await l(`${n}/api/bookmarks/tags/${o}/add/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(h(),t(""))}catch(s){t("Failed to add tag: "+s.message)}},D=async(e,o)=>{try{(await l(`${n}/api/bookmarks/tags/${o}/remove/`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(h(),t(""))}catch(s){t("Failed to remove tag: "+s.message)}},B=e=>{c.includes(e)?N(c.filter(o=>o!==e)):N([...c,e])},w=p.filter(e=>{const o=i===""||e.content.toLowerCase().includes(i.toLowerCase())||e.author.toLowerCase().includes(i.toLowerCase()),s=c.length===0||e.tags?.some(j=>c.includes(j.id));return o&&s});return a.jsxs("div",{className:"readlater-panel",children:[a.jsxs("div",{className:"readlater-header",children:[a.jsxs("h2",{children:[a.jsx(S,{})," Read Later"]}),a.jsxs("button",{className:"create-tag-btn",onClick:()=>d(!0),children:[a.jsx(F,{})," New Tag"]})]}),T&&a.jsx("div",{className:"rl-error",children:T}),a.jsxs("div",{className:"readlater-controls",children:[a.jsxs("div",{className:"search-box",children:[a.jsx(M,{className:"search-icon"}),a.jsx("input",{type:"text",placeholder:"Search bookmarks...",value:i,onChange:e=>L(e.target.value),className:"search-input"})]}),a.jsxs("div",{className:"tag-filters",children:[a.jsx(Q,{className:"filter-icon"}),a.jsx("div",{className:"tag-filter-list",children:m.map(e=>a.jsxs("button",{className:`tag-filter ${c.includes(e.id)?"active":""}`,style:{borderColor:e.color},onClick:()=>B(e.id),children:[a.jsx(x,{style:{color:e.color}}),e.name]},e.id))})]})]}),a.jsx("div",{className:"bookmarks-list",children:_?a.jsx("div",{className:"rl-loading",children:"Loading bookmarks..."}):w.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx(S,{className:"empty-icon"}),a.jsx("p",{children:"No bookmarks found"}),a.jsx("span",{children:"Save messages with the bookmark button to read them later"})]}):w.map((e,o)=>a.jsxs("div",{className:"bookmark-item",children:[a.jsxs("div",{className:"bookmark-header",children:[a.jsxs("div",{className:"bookmark-author",children:[a.jsx("img",{src:e.author_avatar||"/default-avatar.png",alt:e.author,className:"author-avatar"}),a.jsx("span",{className:"author-name",children:e.author})]}),a.jsx("div",{className:"bookmark-date",children:new Date(e.saved_at).toLocaleDateString()})]}),a.jsx("div",{className:"bookmark-content",children:e.content}),a.jsxs("div",{className:"bookmark-footer",children:[a.jsxs("div",{className:"bookmark-tags",children:[e.tags?.map(s=>a.jsxs("span",{className:"bookmark-tag",style:{borderColor:s.color,color:s.color},children:[a.jsx(x,{}),s.name,a.jsx(E,{className:"remove-tag-icon",onClick:()=>D(e.message_id,s.id)})]},s.id)),a.jsxs("select",{className:"add-tag-select",onChange:s=>{s.target.value&&(R(e.message_id,parseInt(s.target.value)),s.target.value="")},children:[a.jsx("option",{value:"",children:"+ Add Tag"}),m.filter(s=>!e.tags?.find(j=>j.id===s.id)).map(s=>a.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a.jsxs("button",{className:"remove-bookmark-btn",onClick:()=>J(e.message_id),children:[a.jsx(H,{})," Remove"]})]})]},o))}),$&&a.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("h3",{children:[a.jsx(x,{})," Create New Tag"]}),a.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:a.jsx(E,{})})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tag Name"}),a.jsx("input",{type:"text",className:"tag-input",placeholder:"Enter tag name...",value:g,onChange:e=>v(e.target.value),onKeyPress:e=>e.key==="Enter"&&C()})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tag Color"}),a.jsx("div",{className:"color-picker",children:O.map(e=>a.jsx("button",{className:`color-option ${f===e?"selected":""}`,style:{backgroundColor:e},onClick:()=>b(e)},e))})]}),a.jsxs("button",{className:"create-tag-submit",onClick:C,children:[a.jsx(F,{})," Create Tag"]})]})]})})]})}export{V as default};
