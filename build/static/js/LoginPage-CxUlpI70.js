import{r as u,b as o}from"./react-core-9vc7GIjk.js";import{a8 as C,A as O,S as z,d as D}from"./icons-vendor-BHKL7tCa.js";import{C as b,G as T,i as p,A as y,t as P}from"./index-BIYh9lA9.js";import{u as M}from"./recaptcha-DCjcE_52.js";import{j as k}from"./crypto-vendor-C1qXRpJv.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./state-vendor-0vlBuk0v.js";const $=({onLogin:I,onRegister:x,error:S,setAuthError:a})=>{const[d,G]=u.useState(!0),[i,v]=u.useState({username:"",email:"",password:""}),[E,L]=u.useState(!1),{getToken:_}=M();u.useEffect(()=>{if(b.isNativePlatform()){console.log("ğŸ“± [Google] Initializing Google Auth for mobile...");try{T.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}),console.log("âœ… [Google] Initialized successfully")}catch(e){console.error("âŒ [Google] Initialization failed:",e)}}},[]),u.useEffect(()=>{if(p&&window.require){const{ipcRenderer:e}=window.require("electron"),n=(f,l)=>{console.log("âœ… [Electron] Google auth success received");try{const{access:s,refresh:c}=l;if(s&&c){const m=k(s);console.log("ğŸ‘¤ [Electron] User:",m.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch(s){console.error("âŒ [Electron] Token error:",s),a("Token iÅŸleme hatasÄ±.")}},t=(f,l)=>{console.error("âŒ [Electron] Auth error:",l),a(l.error||"Google giriÅŸi baÅŸarÄ±sÄ±z.")},g=(f,l)=>{console.log("ğŸ”— [Electron] OAuth tokens received from main process");try{const{access:s,refresh:c}=l;if(s&&c){const m=k(s);console.log("ğŸ‘¤ [Electron] User from deep link:",m.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",m.username),console.log("âœ… [Electron] Tokens saved, reloading..."),setTimeout(()=>window.location.reload(),500)}}catch(s){console.error("âŒ [Electron] OAuth token error:",s),a("Token iÅŸleme hatasÄ±.")}},r=(f,l)=>{console.log("ğŸš€ [DeepLink] URL YakalandÄ±:",l);try{const s=new URL(l),c=new URLSearchParams(s.search),m=c.get("access"),h=c.get("refresh");if(m&&h){console.log("âœ… [DeepLink] GiriÅŸ BaÅŸarÄ±lÄ±!");const w=k(m);console.log("ğŸ‘¤ [Electron] Decoded user from token:",w.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",h),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(s){console.error("Deep link hatasÄ±:",s);try{if(l.includes("access=")&&l.includes("refresh=")){const c=l.split("access=");if(c.length>1){const m=c[1].split("&")[0],h=l.split("refresh=");if(h.length>1){const w=h[1],R=k(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",R.username),window.location.reload()}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}catch(c){console.error("Manual parsing error:",c),a("GiriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z.")}}};return e.on("google-auth-success",n),e.on("google-auth-error",t),e.on("deep-link-auth",r),e.on("oauth-tokens",g),()=>{e.removeListener("google-auth-success",n),e.removeListener("google-auth-error",t),e.removeListener("deep-link-auth",r),e.removeListener("oauth-tokens",g)}}},[a]),u.useEffect(()=>{if(!p){const e=new URLSearchParams(window.location.search),n=e.get("access"),t=e.get("refresh"),g=e.get("error");if(g){console.error("âŒ [Web] OAuth error from URL:",g),a(decodeURIComponent(g)),window.history.replaceState({},document.title,"/");return}if(n&&t){console.log("ğŸŒ [Web] Tokenlar URL'den alÄ±ndÄ± (OAuth success)");try{const r=k(n);console.log("ğŸ‘¤ [Web] Decoded user from token:",r.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",t),localStorage.setItem("chat_username",r.username),console.log("âœ… [Web] Tokens and username saved to localStorage"),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(r){console.error("âŒ [Web] LocalStorage error:",r),a("TarayÄ±cÄ± depolama hatasÄ±. LÃ¼tfen gizli modda deÄŸilseniz kontrol edin.")}}}},[]);const N=async()=>{try{if(console.log("ğŸ”µ [Google] Login baÅŸlatÄ±lÄ±yor...",{isNative:b.isNativePlatform(),isElectron:p,apiUrl:y}),b.isNativePlatform()){console.log("ğŸ“± [Google] Mobile auth flow");const e=await T.signIn();console.log("âœ… [Google] User signed in:",e.email),console.log("ğŸ”‘ [Google] ID Token:",e.authentication.idToken);const n=`${y}/auth/google/native/`;console.log("ğŸ“¡ [Google] Sending to:",n);const t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})});console.log("ğŸ” [Google] Response status:",t.status),console.log("ğŸ” [Google] Response headers:",t.headers);const g=t.headers.get("content-type");if(console.log("ğŸ” [Google] Content-Type:",g),!g||!g.includes("application/json")){const f=await t.text();console.error("âŒ [Google] Backend HTML dÃ¶ndÃ¼:",f.substring(0,500)),a("Backend hatasÄ±: JSON yerine HTML yanÄ±tÄ± alÄ±ndÄ±. Sunucu ayarlarÄ±nÄ± kontrol edin.");return}const r=await t.json();console.log("ğŸ“¦ [Google] Backend response data:",r),t.ok?(console.log("âœ… [Google] Login successful"),r.access&&r.refresh?(localStorage.setItem("access_token",r.access),localStorage.setItem("refresh_token",r.refresh),window.location.reload()):(console.error("âŒ [Google] Tokens eksik:",r),a("Token bilgileri eksik."))):(console.error("âŒ [Google] Login failed:",r),a(r.error||"Google giriÅŸi baÅŸarÄ±sÄ±z."))}else{console.log("ğŸŒ [Google] Web/Electron redirect flow");const t=`${p?"https://api.pawscord.com/api":y}/auth/google/start/?source=${p?"electron":"web"}`;if(console.log("ğŸ”€ [Google] Redirecting to:",t),p&&window.require){const{ipcRenderer:g}=window.require("electron");console.log("âœ… [Google] Opening in Electron popup:",t),g.send("start-google-login",t)}else window.location.href=t}}catch(e){console.error("âŒ [Google] Unexpected error:",e),a("Google giriÅŸi sÄ±rasÄ±nda bir hata oluÅŸtu: "+e.message)}},U=async e=>{e.preventDefault(),L(!0),a("");try{console.log("ğŸ”µ [Login] GiriÅŸ denemesi:",{username:i.username,mode:d?"login":"register"}),console.log("ğŸ”µ [Login] API URL:",y);const n=await _(d?"login":"register");console.log("âœ… [reCAPTCHA] Token alÄ±ndÄ±:",n?"OK":"FAIL"),d?await I(i.username,i.password,n):await x(i.username,i.email,i.password,n)&&(P.success("KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ± kontrol et.",4e3),G(!0))}catch(n){console.error("âŒ [Login] Beklenmeyen hata:",n),a("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{L(!1)}};return o.createElement("div",{className:"login-container"},o.createElement("div",{className:"background-animate"}),o.createElement("div",{className:"login-card"},o.createElement("div",{className:"logo-header"},o.createElement("div",{className:"logo-circle"},o.createElement(C,{size:40,color:"white"})),o.createElement("h1",null,"Pawscord"),o.createElement("p",null,d?"Tekrar hoÅŸgeldin!":"AramÄ±za katÄ±l!")),S&&o.createElement("div",{className:"error-message"},S),o.createElement("form",{onSubmit:U},o.createElement("div",{className:"input-group"},o.createElement(O,{className:"input-icon"}),o.createElement("input",{type:"text",placeholder:"KullanÄ±cÄ± AdÄ±",value:i.username,onChange:e=>v({...i,username:e.target.value}),required:!0})),!d&&o.createElement("div",{className:"input-group slide-down"},o.createElement(z,{className:"input-icon"}),o.createElement("input",{type:"email",placeholder:"E-posta Adresi",value:i.email,onChange:e=>v({...i,email:e.target.value}),required:!0})),o.createElement("div",{className:"input-group"},o.createElement(D,{className:"input-icon"}),o.createElement("input",{type:"password",placeholder:"Åifre",value:i.password,onChange:e=>v({...i,password:e.target.value}),required:!0})),o.createElement("button",{type:"submit",className:"submit-btn",disabled:E},E?o.createElement("div",{className:"spinner"}):d?"GiriÅŸ Yap":"KayÄ±t Ol")),d&&o.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},o.createElement("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1"},"Åifremi Unuttum?")),o.createElement("div",{className:"divider"},o.createElement("span",null,"veya")),o.createElement("div",{className:"google-btn-wrapper"},o.createElement("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5"},o.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),o.createElement("span",null,"Google ile GiriÅŸ Yap"))),o.createElement("div",{className:"toggle-mode"},d?"HesabÄ±n yok mu? ":"Zaten Ã¼ye misin? ",o.createElement("span",{onClick:()=>{G(!d),a("")}},d?"KayÄ±t Ol":"GiriÅŸ Yap"))))};export{$ as default};
