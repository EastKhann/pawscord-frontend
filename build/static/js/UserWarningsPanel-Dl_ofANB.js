var W=Object.defineProperty;var l=(a,i)=>W(a,"name",{value:i,configurable:!0});import{r as c,a as T,j as e}from"./react-core-Djgtqrmb.js";import{a as B,an as L,d as C,aB as A,ay as z,t as D,C as F,f as E}from"./icons-vendor-BW7dxHkX.js";import{t as S,e as R}from"./index-B9TNnJpS.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},$=l((a,i,r)=>{const[m,b]=c.useState([]),[d,y]=c.useState([]),[h,o]=c.useState(!0),[_,k]=c.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0}),p=c.useCallback(async()=>{o(!0);try{const s=await i(`${r}/moderation/warnings/${a}/`);if(s.ok){const t=await s.json();b(t.results||t)}}catch{}o(!1)},[a,i,r]),v=c.useCallback(async()=>{try{const s=await i(`${r}/servers/${a}/members/`);s.ok&&y(await s.json())}catch{}},[a,i,r]),f=c.useCallback(async()=>{try{const s=await i(`${r}/moderation/warnings/stats/${a}/`);s.ok&&k(await s.json())}catch{}},[a,i,r]);c.useEffect(()=>{p(),v(),f()},[p,v,f]);const j=c.useCallback(async(s,t)=>{try{(await i(`${r}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:a,user:s,reason:t})})).ok&&(S.success("âœ… User banned successfully"),p(),f())}catch{}},[a,i,r,p,f]),w=c.useCallback(async s=>{if(!s.user_id||!s.reason)return S.error("âŒ Please select a user and provide a reason"),!1;try{const t=await i(`${r}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:a,user:s.user_id,reason:s.reason,severity:s.severity,expires_at:new Date(Date.now()+s.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(t.ok){const u=await t.json();return u.total_warnings>=s.auto_ban_on&&await R(`User has ${u.total_warnings} warnings. Auto-ban now?`)&&await j(s.user_id,`Auto-ban: ${s.auto_ban_on} warnings reached`),p(),f(),!0}else S.error("âŒ Failed to add warning")}catch{}return!1},[a,i,r,j,p,f]),g=c.useCallback(async s=>{if(await R("Remove this warning?"))try{(await i(`${r}/moderation/warnings/${s}/`,{method:"DELETE"})).ok?(p(),f()):S.error("âŒ Failed to remove warning")}catch{}},[i,r,p,f]);return{warnings:m,users:d,loading:h,stats:_,addWarning:w,removeWarning:g,banUser:j}},"useWarnings"),G={user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3},N=l(({users:a,onAdd:i,onClose:r})=>{const{overlayProps:m,dialogProps:b}=useModalA11y({onClose:r,label:"UyarÄ± Ekle"}),[d,y]=c.useState(G),h=l(async()=>{await i(d)&&r()},"handleAdd");return e.jsx("div",{style:n.modalOverlay,...m,children:e.jsxs("div",{style:n.modal,...b,children:[e.jsxs("div",{style:n.modalHeader,children:[e.jsx("h3",{style:n.modalTitle,children:"Add Warning"}),e.jsx("button",{onClick:r,style:n.modalClose,children:e.jsx(B,{})})]}),e.jsxs("div",{style:n.modalContent,children:[e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"User"}),e.jsxs("select",{value:d.user_id,onChange:l(o=>y({...d,user_id:o.target.value}),"onChange"),style:n.select,children:[e.jsx("option",{value:"",children:"Select user..."}),a.map(o=>e.jsx("option",{value:o.id,children:o.username},o.id))]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Reason"}),e.jsx("textarea",{value:d.reason,onChange:l(o=>y({...d,reason:o.target.value}),"onChange"),placeholder:"Why is this warning being issued?",style:n.textarea,rows:"3"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Severity"}),e.jsxs("select",{value:d.severity,onChange:l(o=>y({...d,severity:o.target.value}),"onChange"),style:n.select,children:[e.jsxs("option",{value:"low",children:["ðŸŸ¢"," Low"]}),e.jsxs("option",{value:"medium",children:["ðŸŸ¡"," Medium"]}),e.jsxs("option",{value:"high",children:["ðŸ”´"," High"]})]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:d.expires_in_days,onChange:l(o=>y({...d,expires_in_days:parseInt(o.target.value)}),"onChange"),style:n.input,min:"1",max:"365"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Auto-ban Threshold"}),e.jsx("input",{type:"number",value:d.auto_ban_on,onChange:l(o=>y({...d,auto_ban_on:parseInt(o.target.value)}),"onChange"),style:n.input,min:"2",max:"10"}),e.jsxs("div",{style:n.hint,children:["User will be auto-banned after reaching ",d.auto_ban_on," active warnings"]})]})]}),e.jsxs("div",{style:n.modalActions,children:[e.jsx("button",{onClick:r,style:n.cancelBtn,children:"Cancel"}),e.jsxs("button",{onClick:h,style:n.submitBtn,children:[e.jsx(L,{})," Add Warning"]})]})]})})},"AddWarningModal"),O=T.memo(N),P=l(a=>{switch(a){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},"getSeverityColor"),Q=l(({serverId:a,fetchWithAuth:i,apiBaseUrl:r,onClose:m})=>{const[b,d]=c.useState(""),[y,h]=c.useState(!1),{warnings:o,users:_,loading:k,stats:p,addWarning:v,removeWarning:f,banUser:j}=$(a,i,r),w=c.useMemo(()=>o.filter(s=>!b||s.user_username?.toLowerCase().includes(b.toLowerCase())||s.reason?.toLowerCase().includes(b.toLowerCase())).reduce((s,t)=>(s[t.user]||(s[t.user]={user_id:t.user,username:t.user_username,warnings:[]}),s[t.user].warnings.push(t),s),{}),[o,b]);return e.jsx("div",{style:n.overlay,onClick:m,children:e.jsxs("div",{style:n.panel,onClick:l(g=>g.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{style:n.headerLeft,children:[e.jsx(C,{style:n.headerIcon}),e.jsx("h2",{style:n.title,children:"User Warnings"})]}),e.jsxs("div",{style:n.headerRight,children:[e.jsxs("button",{onClick:l(()=>h(!0),"onClick"),style:n.addBtn,children:[e.jsx(L,{})," Add Warning"]}),e.jsx("button",{onClick:m,style:n.closeButton,children:e.jsx(B,{})})]})]}),e.jsx("div",{style:n.statsGrid,children:[{icon:C,color:"#f0b132",value:p.total_warnings,label:"Total Warnings"},{icon:C,color:"#43b581",value:p.active_warnings,label:"Active"},{icon:A,color:"#72767d",value:p.expired_warnings,label:"Expired"},{icon:z,color:"#ed4245",value:p.auto_banned_users,label:"Auto-Banned"}].map(({icon:g,color:s,value:t,label:u})=>e.jsxs("div",{style:n.statCard,children:[e.jsx(g,{style:{...n.statIcon,color:s}}),e.jsx("div",{style:n.statValue,children:t}),e.jsx("div",{style:n.statLabel,children:u})]},u))}),e.jsxs("div",{style:n.searchBar,children:[e.jsx(D,{style:n.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by username or reason...",value:b,onChange:l(g=>d(g.target.value),"onChange"),style:n.searchInput})]}),e.jsx("div",{style:n.warningsList,children:k?e.jsx("div",{style:n.loading,children:"Loading warnings..."}):Object.keys(w).length===0?e.jsxs("div",{style:n.empty,children:[e.jsx(C,{style:n.emptyIcon}),e.jsx("p",{children:"No warnings found"})]}):Object.values(w).map(({user_id:g,username:s,warnings:t})=>{const u=t.filter(x=>x.is_active),I=u.length>=2;return e.jsxs("div",{style:n.userCard,children:[e.jsxs("div",{style:n.userHeader,children:[e.jsxs("div",{style:n.userInfo,children:[e.jsx(F,{style:n.userIcon}),e.jsx("div",{style:n.userName,children:s}),e.jsxs("span",{style:{...n.badge,backgroundColor:I?"#ed4245":"#f0b132"},children:[u.length," Active Warning",u.length!==1?"s":""]}),I&&e.jsxs("span",{style:n.riskBadge,children:["âš ï¸"," AT RISK"]})]}),u.length>=3&&e.jsxs("button",{onClick:l(()=>j(g,"Auto-ban: 3 warnings"),"onClick"),style:n.banBtn,children:[e.jsx(z,{})," Ban User"]})]}),e.jsx("div",{style:n.userWarnings,children:t.map(x=>e.jsxs("div",{style:{...n.warningItem,opacity:x.is_active?1:.5},children:[e.jsxs("div",{style:n.warningLeft,children:[e.jsx("div",{style:{...n.severityDot,backgroundColor:P(x.severity)}}),e.jsxs("div",{style:n.warningContent,children:[e.jsx("div",{style:n.warningReason,children:x.reason}),e.jsxs("div",{style:n.warningMeta,children:[e.jsx("span",{children:x.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(x.created_at).toLocaleString()}),x.expires_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Expires: ",new Date(x.expires_at).toLocaleDateString()]})]}),!x.is_active&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{style:{color:"#72767d"},children:"EXPIRED"})]})]})]})]}),x.is_active&&!x.is_auto&&e.jsx("button",{onClick:l(()=>f(x.id),"onClick"),style:n.removeBtn,title:"Remove warning",children:e.jsx(E,{})})]},x.id))})]},g)})}),y&&e.jsx(O,{users:_,onAdd:v,onClose:l(()=>h(!1),"onClose")})]})})},"UserWarningsPanel");export{Q as default};
