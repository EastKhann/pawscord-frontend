{"version":3,"file":"VoiceMessage-D4-GrYKo.js","sources":["../../../src/components/VoiceMessage.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\nimport './VoiceMessage.css';\r\nimport toast from '../utils/toast';\r\n\r\n/**\r\n * Voice Message Recorder Component with Hold-to-Record and Swipe-to-Lock\r\n */\r\nconst VoiceMessage = ({ onSend, onCancel }) => {\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [isLocked, setIsLocked] = useState(false);\r\n    const [recordingTime, setRecordingTime] = useState(0);\r\n    const [audioBlob, setAudioBlob] = useState(null);\r\n    const [mediaRecorder, setMediaRecorder] = useState(null);\r\n    const [waveformData, setWaveformData] = useState([]);\r\n\r\n    // Touch/Mouse tracking for swipe-to-lock\r\n    const [startY, setStartY] = useState(0);\r\n    const [currentY, setCurrentY] = useState(0);\r\n    const [swipeDistance, setSwipeDistance] = useState(0);\r\n    const recordButtonRef = useRef(null);\r\n\r\n    const SWIPE_LOCK_THRESHOLD = -80; // 80px yukarÄ± kaydÄ±rÄ±nca kilitle\r\n\r\n    useEffect(() => {\r\n        let interval;\r\n        if (isRecording) {\r\n            interval = setInterval(() => {\r\n                setRecordingTime(prev => prev + 1);\r\n            }, 1000);\r\n        }\r\n        return () => clearInterval(interval);\r\n    }, [isRecording]);\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            const recorder = new MediaRecorder(stream);\r\n            const chunks = [];\r\n\r\n            recorder.ondataavailable = (e) => {\r\n                chunks.push(e.data);\r\n                // Generate waveform visualization\r\n                updateWaveform();\r\n            };\r\n\r\n            recorder.onstop = () => {\r\n                const blob = new Blob(chunks, { type: 'audio/webm' });\r\n                setAudioBlob(blob);\r\n                stream.getTracks().forEach(track => track.stop());\r\n            };\r\n\r\n            recorder.start(100); // Collect data every 100ms\r\n            setMediaRecorder(recorder);\r\n            setIsRecording(true);\r\n            setIsLocked(false);\r\n            setRecordingTime(0);\r\n        } catch (error) {\r\n            console.error('Microphone access error:', error);\r\n            toast.error('âŒ Mikrofon eriÅŸimi reddedildi');\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorder && isRecording) {\r\n            mediaRecorder.stop();\r\n            setIsRecording(false);\r\n            setIsLocked(false);\r\n        }\r\n    };\r\n\r\n    const cancelRecording = () => {\r\n        if (mediaRecorder && isRecording) {\r\n            mediaRecorder.stop();\r\n        }\r\n        setIsRecording(false);\r\n        setIsLocked(false);\r\n        setAudioBlob(null);\r\n        setRecordingTime(0);\r\n        setWaveformData([]);\r\n        setSwipeDistance(0);\r\n        onCancel?.();\r\n    };\r\n\r\n    // ðŸŽ¯ MOUSE/TOUCH EVENT HANDLERS\r\n    const handleRecordStart = (e) => {\r\n        e.preventDefault();\r\n        const clientY = e.touches ? e.touches[0].clientY : e.clientY;\r\n        setStartY(clientY);\r\n        setCurrentY(clientY);\r\n        setSwipeDistance(0);\r\n        startRecording();\r\n    };\r\n\r\n    const handleRecordMove = (e) => {\r\n        if (!isRecording || isLocked) return;\r\n\r\n        const clientY = e.touches ? e.touches[0].clientY : e.clientY;\r\n        setCurrentY(clientY);\r\n        const distance = clientY - startY;\r\n        setSwipeDistance(distance);\r\n\r\n        // YukarÄ± kaydÄ±rma mesafesi threshold'u geÃ§ti mi?\r\n        if (distance < SWIPE_LOCK_THRESHOLD) {\r\n            setIsLocked(true);\r\n            toast.success('ðŸ”’ KayÄ±t kilitlendi');\r\n        }\r\n    };\r\n\r\n    const handleRecordEnd = (e) => {\r\n        e.preventDefault();\r\n\r\n        // EÄŸer kilitli deÄŸilse, kaydÄ± durdur (iptal et)\r\n        if (!isLocked && isRecording) {\r\n            cancelRecording();\r\n            toast.info('KayÄ±t iptal edildi');\r\n        }\r\n\r\n        setSwipeDistance(0);\r\n    };\r\n\r\n    const sendVoiceMessage = () => {\r\n        if (audioBlob) {\r\n            onSend?.(audioBlob, recordingTime);\r\n            setAudioBlob(null);\r\n            setRecordingTime(0);\r\n            setWaveformData([]);\r\n        }\r\n    };\r\n\r\n    const updateWaveform = () => {\r\n        // Simple random waveform visualization\r\n        setWaveformData(prev => {\r\n            const newData = [...prev, Math.random() * 100];\r\n            return newData.slice(-50); // Keep last 50 samples\r\n        });\r\n    };\r\n\r\n    const formatTime = (seconds) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"voice-message-container\">\r\n            {!isRecording && !audioBlob && (\r\n                <button\r\n                    ref={recordButtonRef}\r\n                    className=\"btn-start-recording\"\r\n                    onMouseDown={handleRecordStart}\r\n                    onMouseMove={handleRecordMove}\r\n                    onMouseUp={handleRecordEnd}\r\n                    onMouseLeave={handleRecordEnd}\r\n                    onTouchStart={handleRecordStart}\r\n                    onTouchMove={handleRecordMove}\r\n                    onTouchEnd={handleRecordEnd}\r\n                    style={{\r\n                        cursor: 'pointer',\r\n                        userSelect: 'none',\r\n                        WebkitUserSelect: 'none',\r\n                        touchAction: 'none'\r\n                    }}\r\n                >\r\n                    <span className=\"mic-icon\">ðŸŽ¤</span>\r\n                    <span>BasÄ±lÄ± Tut</span>\r\n                </button>\r\n            )}\r\n\r\n            {isRecording && (\r\n                <div className=\"recording-ui\">\r\n                    {/* Swipe-to-Lock Indicator */}\r\n                    {!isLocked && (\r\n                        <div\r\n                            className=\"swipe-indicator\"\r\n                            style={{\r\n                                opacity: Math.max(0, Math.min(1, -swipeDistance / 80)),\r\n                                transform: `translateY(${Math.max(swipeDistance, -100)}px)`\r\n                            }}\r\n                        >\r\n                            <div className=\"lock-icon\">ðŸ”’</div>\r\n                            <div className=\"swipe-text\">YukarÄ± kaydÄ±r</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isLocked && (\r\n                        <div className=\"locked-indicator\">\r\n                            <span className=\"lock-icon\">ðŸ”’</span>\r\n                            <span>Kilitli</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"waveform\">\r\n                        {waveformData.map((value, index) => (\r\n                            <div\r\n                                key={index}\r\n                                className=\"waveform-bar\"\r\n                                style={{ height: `${value}%` }}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className=\"recording-info\">\r\n                        <span className=\"recording-indicator\">ðŸ”´</span>\r\n                        <span className=\"recording-time\">{formatTime(recordingTime)}</span>\r\n                    </div>\r\n\r\n                    <div className=\"recording-controls\">\r\n                        <button\r\n                            className=\"btn-cancel\"\r\n                            onClick={cancelRecording}\r\n                        >\r\n                            Ä°ptal\r\n                        </button>\r\n                        {isLocked && (\r\n                            <button\r\n                                className=\"btn-stop\"\r\n                                onClick={stopRecording}\r\n                            >\r\n                                Durdur\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {audioBlob && !isRecording && (\r\n                <div className=\"preview-ui\">\r\n                    <audio controls src={URL.createObjectURL(audioBlob)} />\r\n                    <div className=\"preview-info\">\r\n                        <span>Sesli mesaj â€¢ {formatTime(recordingTime)}</span>\r\n                    </div>\r\n                    <div className=\"preview-controls\">\r\n                        <button\r\n                            className=\"btn-cancel\"\r\n                            onClick={cancelRecording}\r\n                        >\r\n                            Sil\r\n                        </button>\r\n                        <button\r\n                            className=\"btn-send\"\r\n                            onClick={sendVoiceMessage}\r\n                        >\r\n                            GÃ¶nder ðŸ“¤\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VoiceMessage;\r\n\r\n\r\n"],"names":["useState","useRef","useEffect","jsxs","jsx"],"mappings":"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"}