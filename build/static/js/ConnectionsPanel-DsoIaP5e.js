var B=Object.defineProperty;var t=(u,m)=>B(u,"name",{value:m,configurable:!0});import{r,j as e}from"./react-core-Djgtqrmb.js";import{v,a as A,j as y,a8 as g,bU as z,bV as R,bW as G,bX as D,bY as L,bZ as E,b_ as X,aK as N,aL as Y,w as H,b$ as I}from"./icons-vendor-BW7dxHkX.js";import{a as M,g as O,t as d}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const ee=t(({onClose:u})=>{const{token:m,user:k}=M(),[w,C]=r.useState({}),[F,$]=r.useState(!0),[T,l]=r.useState(null),a=r.useRef(null),h=r.useRef(null),p=O().replace("/api",""),j=[{id:"spotify",name:"Spotify",icon:z,color:"#1DB954",description:"Dinlediğin müziği profilinde göster",oauth:!0,features:["Now Playing","Rich Presence"]},{id:"steam",name:"Steam",icon:R,color:"#171A21",description:"Oynadığın oyunları profilinde göster",oauth:!0,features:["Game Activity","Rich Presence","Achievements"]},{id:"xbox",name:"Xbox",icon:G,color:"#107C10",description:"Xbox Live hesabını bağla",oauth:!0,features:["Gamertag","Game Activity","Achievements"]},{id:"twitch",name:"Twitch",icon:D,color:"#9146FF",description:"Twitch yayın durumunu göster",oauth:!0,features:["Stream Status","Rich Presence"]},{id:"github",name:"GitHub",icon:L,color:"#333333",description:"GitHub profilini bağla",oauth:!0,features:["Repositories","Contributions","Profile"]},{id:"youtube",name:"YouTube",icon:E,color:"#FF0000",description:"YouTube kanalını bağla",oauth:!0,features:["Channel","Subscribers","Videos"]},{id:"discord",name:"Discord",icon:X,color:"#5865F2",description:"Discord hesabını bağla (migration)",oauth:!0,features:["Profile","Friends Import"]}],x=r.useCallback(async()=>{const n=new AbortController,s=setTimeout(()=>n.abort(),1e4);try{const i=await fetch(`${p}/api/connections/status/`,{headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(s),i.ok){const c=await i.json();C(c.connections||{})}}catch(i){i.name==="AbortError"&&d.error("Bağlantılar yüklenemedi - zaman aşımı")}finally{$(!1)}},[m,p]);r.useEffect(()=>(x(),()=>{a.current&&clearInterval(a.current),h.current&&clearTimeout(h.current)}),[x]);const P=t(n=>{a.current&&clearInterval(a.current),h.current&&clearTimeout(h.current),l(n);const s=500,i=700,c=window.screenX+(window.outerWidth-s)/2,f=window.screenY+(window.outerHeight-i)/2,o=window.open(`${p}/api/auth/${n}/start/?username=${k?.username||"anonymous"}`,`${n}_oauth`,`width=${s},height=${i},left=${c},top=${f},toolbar=no,menubar=no`);if(!o){d.error("Popup blocker tarafından engellendi. Lütfen popup'lara izin verin."),l(null);return}a.current=setInterval(()=>{o.closed&&(clearInterval(a.current),a.current=null,l(null),x(),d.success(`${n} bağlantısı kontrol ediliyor...`))},500),h.current=setTimeout(()=>{a.current&&(clearInterval(a.current),a.current=null),o.closed||o.close(),l(null)},12e4)},"handleConnect"),S=t(async n=>{if(confirm(`${n} bağlantısını kesmek istediğinize emin misiniz?`)){l(n);try{(await fetch(`${p}/api/connections/${n}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}})).ok?(d.success(`${n} bağlantısı kesildi`),x()):d.error("Bağlantı kesilemedi")}catch{d.error("Bağlantı kesme hatası")}finally{l(null)}}},"handleDisconnect"),b=t(n=>{const s=w[n.id],i=s?.connected,c=T===n.id,f=n.icon;return e.jsxs("div",{className:`connection-card ${i?"connected":""}`,style:{"--platform-color":n.color},children:[e.jsxs("div",{className:"connection-header",children:[e.jsx("div",{className:"platform-icon",style:{backgroundColor:n.color},children:e.jsx(f,{})}),e.jsxs("div",{className:"platform-info",children:[e.jsx("h3",{children:n.name}),e.jsx("p",{children:n.description})]})]}),i&&s.username&&e.jsxs("div",{className:"connection-details",children:[e.jsxs("span",{className:"connected-as",children:[e.jsx(H,{className:"status-icon success"}),"Bağlı: ",e.jsx("strong",{children:s.username})]}),s.data&&e.jsxs("div",{className:"connection-data",children:[s.data.game&&e.jsxs("span",{className:"activity",children:[e.jsx(g,{})," ",s.data.game]}),s.data.track&&e.jsxs("span",{className:"activity",children:[e.jsx(N,{})," ",s.data.track]})]})]}),e.jsx("div",{className:"connection-features",children:n.features.map(o=>e.jsx("span",{className:"feature-tag",children:o},o))}),e.jsx("div",{className:"connection-actions",children:i?e.jsxs("button",{className:"disconnect-btn",onClick:t(()=>S(n.id),"onClick"),disabled:c,children:[c?e.jsx(v,{className:"spin"}):e.jsx(I,{}),"Bağlantıyı Kes"]}):e.jsxs("button",{className:"connect-btn",onClick:t(()=>P(n.id),"onClick"),disabled:c,style:{backgroundColor:n.color},children:[c?e.jsx(v,{className:"spin"}):e.jsx(y,{}),"Bağlan"]})})]},n.id)},"renderPlatform");return F?e.jsx("div",{className:"connections-modal-overlay",onClick:u,children:e.jsx("div",{className:"connections-modal",onClick:t(n=>n.stopPropagation(),"onClick"),children:e.jsxs("div",{className:"connections-panel loading",children:[e.jsx(v,{className:"spin large"}),e.jsx("p",{children:"Bağlantılar yükleniyor..."})]})})}):e.jsx("div",{className:"connections-modal-overlay",onClick:u,children:e.jsxs("div",{className:"connections-modal",onClick:t(n=>n.stopPropagation(),"onClick"),children:[e.jsx("button",{className:"connections-close-btn",onClick:u,children:e.jsx(A,{})}),e.jsxs("div",{className:"connections-panel",children:[e.jsxs("div",{className:"connections-header",children:[e.jsxs("h2",{children:[e.jsx(y,{})," Bağlantılar"]}),e.jsx("p",{children:"Hesaplarını bağlayarak profilini zenginleştir ve aktivitelerini göster"})]}),e.jsxs("div",{className:"connections-grid",children:[e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(g,{})," Oyun Platformları"]}),e.jsx("div",{className:"platforms-grid",children:j.filter(n=>["steam","epic","xbox","playstation","battlenet","riot"].includes(n.id)).map(b)})]}),e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(N,{})," Müzik & Streaming"]}),e.jsx("div",{className:"platforms-grid",children:j.filter(n=>["spotify","twitch","youtube"].includes(n.id)).map(b)})]}),e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(y,{})," Sosyal Medya"]}),e.jsx("div",{className:"platforms-grid",children:j.filter(n=>["discord","twitter","github"].includes(n.id)).map(b)})]})]}),e.jsx("div",{className:"connections-footer",children:e.jsxs("p",{className:"privacy-note",children:[e.jsx(Y,{}),"Bağlantılar sadece izin verdiğin bilgilere erişir. İstediğin zaman bağlantıyı kesebilirsin."]})})]})]})})},"ConnectionsPanel");export{ee as default};
