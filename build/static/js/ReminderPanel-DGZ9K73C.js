import{r as c,d as e,c9 as r}from"./react-core-DrOm_csO.js";import{g as S}from"./index-BYhWpPLp.js";const z=({serverId:i,onClose:d})=>{const s=S(),[u,h]=c.useState([]),[g,o]=c.useState(!1),[a,l]=c.useState({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""}),[p,k]=c.useState([]),[f,v]=c.useState(!0);c.useEffect(()=>{m(),y()},[i]);const m=async()=>{try{const t=await fetch(`${s}/reminders/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const n=await t.json();h(n)}}catch(t){console.error("Error:",t)}finally{v(!1)}},y=async()=>{try{const t=await fetch(`${s}/channels/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const n=await t.json();k(n.filter(w=>w.type==="text"))}}catch(t){console.error("Error:",t)}},N=async()=>{if(!a.title||!a.remind_at||!a.channel_id){r.error("âŒ LÃ¼tfen gerekli alanlarÄ± doldurun");return}try{(await fetch(`${s}/reminders/create/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:i,...a})})).ok?(r.success("âœ… HatÄ±rlatÄ±cÄ± oluÅŸturuldu"),o(!1),m(),l({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""})):r.error("âŒ OluÅŸturma hatasÄ±")}catch{r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},b=async t=>{if(window.confirm("HatÄ±rlatÄ±cÄ±yÄ± silmek istediÄŸinize emin misiniz?"))try{(await fetch(`${s}/reminders/${t}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(r.success("âœ… HatÄ±rlatÄ±cÄ± silindi"),m())}catch{r.error("âŒ Silme hatasÄ±")}},_=async t=>{try{(await fetch(`${s}/reminders/${t}/trigger/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&r.success("âœ… HatÄ±rlatÄ±cÄ± tetiklendi")}catch{r.error("âŒ Tetikleme hatasÄ±")}},C=t=>new Date(t).toLocaleString("tr-TR"),E=t=>{const n={once:{text:"Bir kez",color:"#6b7280"},daily:{text:"GÃ¼nlÃ¼k",color:"#3b82f6"},weekly:{text:"HaftalÄ±k",color:"#8b5cf6"},monthly:{text:"AylÄ±k",color:"#ec4899"}};return n[t]||n.once};return e.createElement("div",{className:"reminder-overlay",onClick:d},e.createElement("div",{className:"reminder-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"reminder-header"},e.createElement("h2",null,"â° HatÄ±rlatÄ±cÄ±lar"),e.createElement("button",{className:"close-btn",onClick:d},"Ã—")),e.createElement("div",{className:"reminder-content"},e.createElement("button",{className:"create-reminder-btn",onClick:()=>o(!0)},"+ Yeni HatÄ±rlatÄ±cÄ±"),f?e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"YÃ¼kleniyor...")):u.length===0?e.createElement("div",{className:"empty-state"},e.createElement("span",{className:"empty-icon"},"â°"),e.createElement("p",null,"HenÃ¼z hatÄ±rlatÄ±cÄ± yok")):e.createElement("div",{className:"reminders-list"},u.map(t=>e.createElement("div",{key:t.id,className:"reminder-card"},e.createElement("div",{className:"reminder-main"},e.createElement("h3",null,t.title),t.description&&e.createElement("p",null,t.description),e.createElement("div",{className:"reminder-meta"},e.createElement("span",null,"â° ",C(t.remind_at)),e.createElement("span",null,"ğŸ“ # ",p.find(n=>n.id===t.channel_id)?.name),e.createElement("span",{className:"repeat-badge",style:{background:E(t.repeat).color}},"ğŸ”„ ",E(t.repeat).text))),e.createElement("div",{className:"reminder-actions"},e.createElement("button",{className:"trigger-btn",onClick:()=>_(t.id)},"â–¶ï¸ Tetikle"),e.createElement("button",{className:"delete-btn",onClick:()=>b(t.id)},"ğŸ—‘ï¸")))))),g&&e.createElement("div",{className:"create-modal-overlay",onClick:()=>o(!1)},e.createElement("div",{className:"create-modal",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"modal-header"},e.createElement("h3",null,"Yeni HatÄ±rlatÄ±cÄ±"),e.createElement("button",{className:"close-btn",onClick:()=>o(!1)},"Ã—")),e.createElement("div",{className:"modal-body"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"BaÅŸlÄ±k *"),e.createElement("input",{value:a.title,onChange:t=>l({...a,title:t.target.value})})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"AÃ§Ä±klama"),e.createElement("textarea",{value:a.description,onChange:t=>l({...a,description:t.target.value}),rows:"3"})),e.createElement("div",{className:"form-row"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"Tarih/Saat *"),e.createElement("input",{type:"datetime-local",value:a.remind_at,onChange:t=>l({...a,remind_at:t.target.value})})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Tekrar"),e.createElement("select",{value:a.repeat,onChange:t=>l({...a,repeat:t.target.value})},e.createElement("option",{value:"once"},"Bir kez"),e.createElement("option",{value:"daily"},"GÃ¼nlÃ¼k"),e.createElement("option",{value:"weekly"},"HaftalÄ±k"),e.createElement("option",{value:"monthly"},"AylÄ±k")))),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Kanal *"),e.createElement("select",{value:a.channel_id,onChange:t=>l({...a,channel_id:t.target.value})},e.createElement("option",{value:""},"SeÃ§in"),p.map(t=>e.createElement("option",{key:t.id,value:t.id},"# ",t.name))))),e.createElement("div",{className:"modal-footer"},e.createElement("button",{className:"cancel-btn",onClick:()=>o(!1)},"Ä°ptal"),e.createElement("button",{className:"submit-btn",onClick:N},"â° OluÅŸtur"))))))};export{z as default};
