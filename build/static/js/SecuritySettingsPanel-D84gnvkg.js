import{r as l,j as e}from"./react-core-D6cE4lil.js";import{y as t}from"./ui-vendor-CZOhtEfS.js";import{h as C,g as Q}from"./index-ClHcoIda.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./icons-vendor-DT2gd7vx.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-BYnay7oC.js";const U=()=>{const[o,r]=l.useState(!1),[c,i]=l.useState([]),[h,d]=l.useState([]),[y,b]=l.useState([]),[p,k]=l.useState([]),[j,x]=l.useState(""),[A,g]=l.useState(""),[f,T]=l.useState(""),[P,$]=l.useState(null),[I,O]=l.useState("2fa"),n=Q(),m={Authorization:`Bearer ${localStorage.getItem("access_token")}`},u={...m,"Content-Type":"application/json"},N=async()=>{try{const a=await(await fetch(`${n}/security/status/`,{headers:m})).json();$(a),r(a.two_factor_enabled||!1)}catch{}},_=async()=>{try{const a=await(await fetch(`${n}/2fa/methods/`,{headers:m})).json();i(a.methods||[])}catch{}},w=async()=>{try{const a=await(await fetch(`${n}/security/sessions/`,{headers:m})).json();d(a.sessions||[])}catch{}},F=async()=>{try{const a=await(await fetch(`${n}/security/ip-whitelist/`,{headers:m})).json();b(a.whitelist||[])}catch{}},z=async()=>{try{const s=await fetch(`${n}/security/2fa/enable/`,{method:"POST",headers:u}),a=await s.json();s.ok?(x(a.qr_code||""),k(a.backup_codes||[]),t.info("â„¹ï¸ QR kodu tarayÄ±n ve doÄŸrulama kodunu girin")):t.error(`âŒ ${a.error||"2FA etkinleÅŸtirilemedi"}`)}catch{t.error("âŒ 2FA etkinleÅŸtirme hatasÄ±")}},E=async()=>{try{const s=await fetch(`${n}/security/2fa/verify-setup/`,{method:"POST",headers:u,body:JSON.stringify({code:A})}),a=await s.json();s.ok?(t.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),r(!0),x(""),g(""),N()):t.error(`âŒ ${a.error||"GeÃ§ersiz kod"}`)}catch{t.error("âŒ DoÄŸrulama hatasÄ±")}},B=async()=>{if(await C("2FA'yÄ± devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${n}/security/2fa/disable/`,{method:"POST",headers:u}),a=await s.json();s.ok?(t.info("â„¹ï¸ 2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±"),r(!1),N()):t.error(`âŒ ${a.error||"2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±lamadÄ±"}`)}catch{t.error("âŒ 2FA devre dÄ±ÅŸÄ± bÄ±rakma hatasÄ±")}},D=async()=>{try{const s=await fetch(`${n}/security/2fa/backup-codes/`,{method:"POST",headers:u}),a=await s.json();s.ok?(k(a.backup_codes||[]),t.success("âœ… Yedek kodlar oluÅŸturuldu")):t.error(`âŒ ${a.error||"Yedek kodlar oluÅŸturulamadÄ±"}`)}catch{t.error("âŒ Yedek kod hatasÄ±")}},R=async s=>{try{const a=await fetch(`${n}/security/sessions/${s}/revoke/`,{method:"POST",headers:u}),v=await a.json();a.ok?(t.success("âœ… Oturum sonlandÄ±rÄ±ldÄ±"),w()):t.error(`âŒ ${v.error||"Oturum sonlandÄ±rÄ±lamadÄ±"}`)}catch{t.error("âŒ Oturum sonlandÄ±rma hatasÄ±")}},L=async()=>{if(await C("TÃ¼m oturumlarÄ± sonlandÄ±rmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${n}/security/sessions/revoke-all/`,{method:"POST",headers:u}),a=await s.json();s.ok?(t.success("âœ… TÃ¼m oturumlar sonlandÄ±rÄ±ldÄ±"),w()):t.error(`âŒ ${a.error||"Oturumlar sonlandÄ±rÄ±lamadÄ±"}`)}catch{t.error("âŒ Toplu sonlandÄ±rma hatasÄ±")}},W=async()=>{if(!f.trim()){t.error("âŒ IP adresi gerekli");return}try{const s=await fetch(`${n}/security/ip-whitelist/add/`,{method:"POST",headers:u,body:JSON.stringify({ip_address:f})}),a=await s.json();s.ok?(t.success("âœ… IP beyaz listeye eklendi"),T(""),F()):t.error(`âŒ ${a.error||"IP eklenemedi"}`)}catch{t.error("âŒ IP ekleme hatasÄ±")}},K=async s=>{try{(await fetch(`${n}/security/ip-whitelist/${s}/`,{method:"DELETE",headers:m})).ok?(t.success("âœ… IP beyaz listeden kaldÄ±rÄ±ldÄ±"),F()):t.error("âŒ IP kaldÄ±rÄ±lamadÄ±")}catch{t.error("âŒ IP kaldÄ±rma hatasÄ±")}},Y=()=>{const s=p.join(`
`),a=new Blob([s],{type:"text/plain"}),v=window.URL.createObjectURL(a),S=document.createElement("a");S.href=v,S.download=`pawscord_backup_codes_${new Date().toISOString()}.txt`,S.click(),window.URL.revokeObjectURL(v),t.success("âœ… Yedek kodlar indirildi")};return l.useEffect(()=>{N(),_(),w(),F()},[]),{twoFactorEnabled:o,twoFactorMethods:c,sessions:h,ipWhitelist:y,backupCodes:p,qrCode:j,verificationCode:A,setVerificationCode:g,newIp:f,setNewIp:T,securityStatus:P,activeTab:I,setActiveTab:O,enable2FA:z,verify2FASetup:E,disable2FA:B,getBackupCodes:D,downloadBackupCodes:Y,revokeSession:R,revokeAllSessions:L,addIPToWhitelist:W,removeIPFromWhitelist:K}},M=({twoFactorEnabled:o,qrCode:r,verificationCode:c,setVerificationCode:i,backupCodes:h,enable2FA:d,verify2FASetup:y,disable2FA:b,getBackupCodes:p,downloadBackupCodes:k})=>e.jsxs("div",{className:"tab-content",children:[e.jsxs("h3",{children:["Ä°","ki Fakt\\u00F6rl\\u00FC Kimlik Do\\u011Frulama (2FA)"]}),e.jsx("p",{children:"Hesab\\u0131n\\u0131z\\u0131 ekstra bir g\\u00FCvenlik katman\\u0131yla koruyun"}),!o&&!r?e.jsx("div",{className:"enable-2fa",children:e.jsx("button",{className:"enable-btn",onClick:d,children:"2FA'y\\u0131 Etkinle\\u015Ftir"})}):o?e.jsxs("div",{className:"enabled-2fa",children:[e.jsxs("div",{className:"success-message",children:[e.jsx("span",{className:"success-icon",children:"âœ…"}),e.jsx("span",{children:"2FA aktif - Hesab\\u0131n\\u0131z korunuyor"})]}),e.jsx("button",{className:"disable-btn",onClick:b,children:"2FA'y\\u0131 Devre D\\u0131\\u015F\\u0131 B\\u0131rak"}),e.jsx("button",{className:"backup-btn",onClick:p,children:"Yeni Yedek Kodlar Olu\\u015Ftur"})]}):e.jsxs("div",{className:"setup-2fa",children:[e.jsxs("div",{className:"qr-section",children:[e.jsx("h4",{children:"1. QR Kodu Taray\\u0131n"}),r&&e.jsx("img",{src:r,alt:"2FA QR Code",className:"qr-code"}),e.jsx("p",{children:"Authenticator uygulaman\\u0131zla QR kodu taray\\u0131n"})]}),e.jsxs("div",{className:"verify-section",children:[e.jsx("h4",{children:"2. Do\\u011Frulama Kodunu Girin"}),e.jsx("input",{type:"text",placeholder:"6 haneli kod",value:c,onChange:j=>i(j.target.value),maxLength:6,className:"verification-input"}),e.jsx("button",{className:"verify-btn",onClick:y,children:"Do\\u011Frula ve Etkinle\\u015Ftir"})]}),h.length>0&&e.jsxs("div",{className:"backup-codes",children:[e.jsx("h4",{children:"3. Yedek Kodlar\\u0131n\\u0131z"}),e.jsx("p",{children:"Bu kodlar\\u0131 g\\u00FCvenli bir yerde saklay\\u0131n!"}),e.jsx("div",{className:"codes-grid",children:h.map((j,x)=>e.jsx("div",{className:"backup-code",children:j},x))}),e.jsxs("button",{className:"download-btn",onClick:k,children:["ðŸ“¥"," Kodlar\\u0131 ","Ä°","ndir"]})]})]})]}),G=({sessions:o,revokeSession:r,revokeAllSessions:c})=>e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"sessions-header",children:[e.jsx("h3",{children:"Aktif Oturumlar"}),e.jsx("button",{className:"revoke-all-btn",onClick:c,children:"T\\u00FCm\\u00FCn\\u00FC Sonland\\u0131r"})]}),e.jsx("div",{className:"sessions-list",children:o.map(i=>e.jsxs("div",{className:"session-card",children:[e.jsxs("div",{className:"session-info",children:[e.jsxs("div",{className:"session-device",children:[e.jsx("span",{className:"device-icon",children:i.device_type==="mobile"?"ðŸ“±":"ðŸ’»"}),e.jsxs("div",{className:"device-details",children:[e.jsx("span",{className:"device-name",children:i.device_name||"Bilinmeyen Cihaz"}),e.jsx("span",{className:"device-location",children:i.location||"Bilinmeyen Konum"})]})]}),e.jsxs("div",{className:"session-meta",children:[e.jsxs("span",{className:"session-ip",children:["IP: ",i.ip_address]}),e.jsxs("span",{className:"session-time",children:["Son Aktivite: ",new Date(i.last_activity).toLocaleString("tr-TR")]})]})]}),i.is_current?e.jsx("span",{className:"current-badge",children:"Mevcut Oturum"}):e.jsx("button",{className:"revoke-btn",onClick:()=>r(i.id),children:"Sonland\\u0131r"})]},i.id))})]}),H=({ipWhitelist:o,newIp:r,setNewIp:c,addIPToWhitelist:i,removeIPFromWhitelist:h})=>e.jsxs("div",{className:"tab-content",children:[e.jsx("h3",{children:"IP Adresi Beyaz Listesi"}),e.jsx("p",{children:"Sadece izin verilen IP adreslerinden giri\\u015F yap\\u0131n"}),e.jsxs("div",{className:"add-ip",children:[e.jsx("input",{type:"text",placeholder:"IP Adresi (\\u00F6rn: 192.168.1.1)",value:r,onChange:d=>c(d.target.value),className:"ip-input"}),e.jsx("button",{className:"add-btn",onClick:i,children:"+ Ekle"})]}),e.jsx("div",{className:"ip-list",children:o.map(d=>e.jsxs("div",{className:"ip-card",children:[e.jsxs("div",{className:"ip-info",children:[e.jsx("span",{className:"ip-address",children:d.ip_address}),e.jsxs("span",{className:"ip-added",children:["Eklendi: ",new Date(d.created_at).toLocaleDateString("tr-TR")]})]}),e.jsx("button",{className:"remove-btn",onClick:()=>h(d.id),children:"Kald\\u0131r"})]},d.id))})]}),re=({onClose:o})=>{const r=U();return e.jsx("div",{className:"security-overlay",onClick:o,children:e.jsxs("div",{className:"security-panel",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"security-header",children:[e.jsxs("h2",{children:["ðŸ”’"," G\\u00FCvenlik Ayarlar\\u0131"]}),e.jsx("button",{className:"close-btn",onClick:o,children:"âœ•"})]}),r.securityStatus&&e.jsxs("div",{className:"security-status",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ðŸ”"}),e.jsx("span",{className:"status-label",children:"2FA:"}),e.jsx("span",{className:`status-value ${r.twoFactorEnabled?"active":"inactive"}`,children:r.twoFactorEnabled?"Aktif":"Pasif"})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ðŸ’»"}),e.jsx("span",{className:"status-label",children:"Aktif Oturumlar:"}),e.jsx("span",{className:"status-value",children:r.sessions.length})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ðŸŒ"}),e.jsx("span",{className:"status-label",children:"IP Whitelist:"}),e.jsx("span",{className:"status-value",children:r.ipWhitelist.length})]})]}),e.jsx("div",{className:"security-tabs",children:[["2fa","ðŸ” 2FA"],["sessions","ðŸ’» Oturumlar"],["ip","ðŸŒ IP Whitelist"]].map(([c,i])=>e.jsx("button",{className:`tab-btn ${r.activeTab===c?"active":""}`,onClick:()=>r.setActiveTab(c),children:i},c))}),e.jsxs("div",{className:"security-content",children:[r.activeTab==="2fa"&&e.jsx(M,{...r}),r.activeTab==="sessions"&&e.jsx(G,{...r}),r.activeTab==="ip"&&e.jsx(H,{...r})]})]})})};export{re as default};
