import{r as o,j as e}from"./react-core-D6cE4lil.js";import{bb as h,a as E,a0 as R,af as I,bL as T,E as D,D as F,u as _}from"./icons-vendor-fClA8qVL.js";import{t as M}from"./index-DHLSv4f5.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const O={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},W=({roomSlug:s,ws:n,onClose:x})=>{const[b,u]=o.useState(!1),[t,a]=o.useState(!1),[i,S]=o.useState("camera"),[v,j]=o.useState(0),[k,C]=o.useState([]),[m,y]=o.useState(""),g=o.useRef(null),l=o.useRef(null),f=o.useRef({}),w=async r=>{if(!l.current)return;const d=new RTCPeerConnection(O);f.current[r]=d,l.current.getTracks().forEach(p=>{d.addTrack(p,l.current)}),d.onicecandidate=p=>{p.candidate&&n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"ice_candidate",candidate:p.candidate,viewer_id:r}))};const c=await d.createOffer();await d.setLocalDescription(c),n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"stream_offer",sdp:d.localDescription,viewer_id:r}))};return o.useEffect(()=>{if(!n.current)return;const r=d=>{try{const c=JSON.parse(d.data);c.type==="stream_viewer_count"?j(c.count):c.type==="stream_chat"?C(p=>[...p,{id:Date.now(),user:c.username,message:c.message,timestamp:new Date().toLocaleTimeString()}]):c.type==="stream_viewer_join"&&w(c.viewerId)}catch{}};return n.current.addEventListener("message",r),()=>n.current?.removeEventListener("message",r)},[n]),o.useEffect(()=>{const r=d=>{d.key==="Escape"&&x()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[x]),{isStreaming:b,isMuted:t,streamType:i,setStreamType:S,viewers:v,chatMessages:k,chatInput:m,setChatInput:y,videoRef:g,startStream:async()=>{try{let r;i==="camera"?r=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}):r=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0}),l.current=r,g.current&&(g.current.srcObject=r),u(!0),n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"stream_start",room_slug:s,stream_type:i}))}catch{M.error("âŒ Failed to start stream. Please check permissions.")}},stopStream:()=>{l.current&&(l.current.getTracks().forEach(r=>r.stop()),l.current=null),Object.values(f.current).forEach(r=>r.close()),f.current={},g.current&&(g.current.srcObject=null),u(!1),n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"stream_stop",room_slug:s}))},toggleMute:()=>{l.current&&(l.current.getAudioTracks().forEach(r=>{r.enabled=t}),a(!t))},sendChatMessage:r=>{r.preventDefault(),m.trim()&&(n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"stream_chat",room_slug:s,message:m})),y(""))}}},B=s=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:s?"0":"20px"},modal:{width:"100%",maxWidth:s?"100%":"1400px",height:s?"100%":"auto",maxHeight:"90vh",background:"linear-gradient(135deg, rgba(30, 31, 34, 0.98), rgba(35, 36, 40, 0.98))",borderRadius:s?"0":"16px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(218, 55, 60, 0.3)",border:s?"none":"1px solid rgba(218, 55, 60, 0.4)"},header:{padding:s?"12px 16px":"16px 24px",background:"linear-gradient(135deg, rgba(218, 55, 60, 0.15), rgba(240, 71, 71, 0.15))",borderBottom:"1px solid rgba(218, 55, 60, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:s?"18px":"22px",fontWeight:"700",color:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",gap:"10px"},liveIndicator:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",background:"rgba(218, 55, 60, 0.3)",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#da373c",border:"1px solid rgba(218, 55, 60, 0.5)"},liveDot:{width:"8px",height:"8px",background:"#da373c",borderRadius:"50%",animation:"pulse 1.5s ease-in-out infinite"},closeBtn:{background:"rgba(218, 55, 60, 0.2)",border:"1px solid rgba(218, 55, 60, 0.4)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#da373c",fontSize:"18px"},content:{flex:1,display:"flex",flexDirection:s?"column":"row",overflow:"hidden"},streamSection:{flex:1,display:"flex",flexDirection:"column",background:"#000",position:"relative"},videoContainer:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",position:"relative"},video:{width:"100%",height:"100%",objectFit:"contain"},placeholder:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)"},viewerCount:{position:"absolute",top:"16px",right:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",borderRadius:"20px",fontSize:"14px",fontWeight:"600",color:"white"},controls:{padding:"16px",background:"rgba(0, 0, 0, 0.8)",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},controlBtn:n=>({padding:"12px 24px",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",minHeight:"44px",background:n?"rgba(218, 55, 60, 0.3)":"rgba(88, 101, 242, 0.2)",color:n?"#da373c":"rgba(255, 255, 255, 0.9)",border:`1px solid ${n?"rgba(218, 55, 60, 0.5)":"rgba(88, 101, 242, 0.4)"}`}),startBtn:{padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"linear-gradient(135deg, #da373c, #f04747)",color:"white",transition:"all 0.2s ease",minHeight:"48px"},chatSection:{width:s?"100%":"350px",maxHeight:s?"300px":"auto",background:"rgba(0, 0, 0, 0.3)",borderLeft:s?"none":"1px solid rgba(218, 55, 60, 0.2)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(218, 55, 60, 0.2)",fontSize:"16px",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)"},chatMessages:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px"},chatMessage:{padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"14px"},chatUsername:{fontWeight:"600",color:"#5865f2",marginBottom:"4px"},chatText:{color:"rgba(255, 255, 255, 0.8)"},chatInputArea:{padding:"12px",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"8px"},input:{flex:1,padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(218, 55, 60, 0.3)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.95)",fontSize:"14px",outline:"none"},sendBtn:{padding:"12px 20px",background:"linear-gradient(135deg, #da373c, #f04747)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:"pointer",minHeight:"44px"}}),G=({onClose:s,roomSlug:n,ws:x,token:b,isMobile:u})=>{const t=B(u),a=W({roomSlug:n,ws:x,onClose:s});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }"}),e.jsx("div",{style:t.overlay,onClick:s,children:e.jsxs("div",{style:t.modal,onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("h2",{style:t.title,children:[e.jsx(h,{})," Live Stream",a.isStreaming&&e.jsxs("span",{style:t.liveIndicator,children:[e.jsx("span",{style:t.liveDot}),"LIVE"]})]}),e.jsx("button",{onClick:s,style:t.closeBtn,children:e.jsx(E,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.streamSection,children:[e.jsx("div",{style:t.videoContainer,children:a.isStreaming?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:a.videoRef,autoPlay:!0,muted:!0,style:t.video}),e.jsxs("div",{style:t.viewerCount,children:[e.jsx(R,{})," ",a.viewers," viewers"]})]}):e.jsxs("div",{style:t.placeholder,children:[e.jsx(h,{size:64}),e.jsx("p",{style:{marginTop:"16px",fontSize:"18px"},children:'Click "Start Stream" to begin'})]})}),e.jsx("div",{style:t.controls,children:a.isStreaming?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a.toggleMute,style:t.controlBtn(a.isMuted),children:[a.isMuted?e.jsx(T,{}):e.jsx(D,{}),a.isMuted?"Unmute":"Mute"]}),e.jsxs("button",{onClick:a.stopStream,style:{...t.startBtn,background:"linear-gradient(135deg, #da373c, #b83030)"},children:[e.jsx(F,{})," Stop Stream"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>a.setStreamType("camera"),style:t.controlBtn(a.streamType==="camera"),children:[e.jsx(h,{})," Camera"]}),e.jsxs("button",{onClick:()=>a.setStreamType("screen"),style:t.controlBtn(a.streamType==="screen"),children:[e.jsx(I,{})," Screen"]}),e.jsxs("button",{onClick:a.startStream,style:t.startBtn,children:[e.jsx(h,{})," Start Stream"]})]})})]}),a.isStreaming&&e.jsxs("div",{style:t.chatSection,children:[e.jsxs("div",{style:t.chatHeader,children:[e.jsx(_,{})," Stream Chat"]}),e.jsx("div",{style:t.chatMessages,children:a.chatMessages.map(i=>e.jsxs("div",{style:t.chatMessage,children:[e.jsx("div",{style:t.chatUsername,children:i.user}),e.jsx("div",{style:t.chatText,children:i.message})]},i.id))}),e.jsxs("form",{onSubmit:a.sendChatMessage,style:t.chatInputArea,children:[e.jsx("input",{type:"text",value:a.chatInput,onChange:i=>a.setChatInput(i.target.value),placeholder:"Send a message...",style:t.input}),e.jsx("button",{type:"submit",style:t.sendBtn,children:"Send"})]})]})]})]})})]})};export{G as default};
