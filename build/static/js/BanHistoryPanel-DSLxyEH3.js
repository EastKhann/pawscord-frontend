import{r,n as e}from"./react-core-Cj7FUMmY.js";import{b4 as b,a as U,h as L,ao as R,b8 as Y,I as O,d as H,bx as M,cB as P,e as Q,ai as q,cC as G,E as I}from"./icons-vendor-TGltgKsJ.js";import{y as f}from"./ui-vendor-EA4dxvko.js";import"./editor-vendor-D9c4a6XZ.js";const Z=({serverId:u,serverName:k,onClose:y})=>{const[x,d]=r.useState([]),[m,C]=r.useState([]),[_,S]=r.useState(!0),[o,D]=r.useState(""),[i,c]=r.useState("all"),[h,F]=r.useState("newest"),[j,E]=r.useState(null),[p,v]=r.useState({total:0,active:0,expired:0,appealed:0}),w=localStorage.getItem("access_token");r.useEffect(()=>{B()},[u]),r.useEffect(()=>{z()},[x,o,i,h]);const B=async()=>{S(!0);try{const a=await fetch(`/api/servers/${u}/bans/`,{headers:{Authorization:`Bearer ${w}`}});if(a.ok){const s=await a.json();d(s.bans||[]),v(s.stats||N([]))}else d([]),v(N([]))}catch{d([]),v(N([]))}S(!1)},N=a=>({total:a.length,active:a.filter(s=>s.status==="active").length,expired:a.filter(s=>s.status==="expired").length,appealed:a.filter(s=>s.status==="appealed"||s.appeal_status==="approved").length}),z=()=>{let a=[...x];if(o){const s=o.toLowerCase();a=a.filter(t=>t.user.username.toLowerCase().includes(s)||t.reason.toLowerCase().includes(s)||t.moderator.username.toLowerCase().includes(s))}i!=="all"&&(a=a.filter(s=>i==="appealed"?s.appeal_status==="approved"||s.status==="appealed":s.status===i)),a.sort((s,t)=>{const n=new Date(s.banned_at),l=new Date(t.banned_at);return h==="newest"?l-n:n-l}),C(a)},T=async a=>{try{const s=await fetch(`/api/servers/${u}/bans/${a.id}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${w}`}});f.success(`${a.user.username} yasaklaması kaldırıldı`),B()}catch{f.success(`${a.user.username} yasaklaması kaldırıldı`),d(x.map(t=>t.id===a.id?{...t,status:"expired",unbanned_at:new Date().toISOString()}:t))}},$=()=>{const a=[["Kullanıcı","Moderatör","Sebep","Durum","Tarih","Bitiş","İtiraz"].join(","),...m.map(l=>[l.user.username,l.moderator.username,`"${l.reason}"`,l.status,new Date(l.banned_at).toLocaleDateString("tr-TR"),l.expires_at?new Date(l.expires_at).toLocaleDateString("tr-TR"):"Süresiz",l.appeal_status||"Yok"].join(","))].join(`
`),s=new Blob([a],{type:"text/csv"}),t=URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download=`ban_history_${k}.csv`,n.click(),f.success("Ban geçmişi dışa aktarıldı")},g=a=>new Date(a).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),A=(a,s)=>{if(s==="approved"||a==="appealed")return e.jsxs("span",{className:"status-badge appealed",children:[e.jsx(G,{})," İtiraz Kabul"]});switch(a){case"active":return e.jsxs("span",{className:"status-badge active",children:[e.jsx(b,{})," Aktif Ban"]});case"expired":return e.jsxs("span",{className:"status-badge expired",children:[e.jsx(I,{})," Süresi Doldu"]});default:return e.jsx("span",{className:"status-badge",children:a})}},K=a=>a?{pending:e.jsx("span",{className:"appeal-badge pending",children:"İtiraz Bekliyor"}),approved:e.jsx("span",{className:"appeal-badge approved",children:"İtiraz Kabul"}),denied:e.jsx("span",{className:"appeal-badge denied",children:"İtiraz Reddedildi"})}[a]:null;return e.jsx("div",{className:"banhistory-overlay",onClick:a=>a.target.className==="banhistory-overlay"&&y(),children:e.jsxs("div",{className:"banhistory-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(b,{})," Ban Geçmişi"]}),e.jsx("span",{className:"server-name",children:k}),e.jsx("button",{className:"close-btn",onClick:y,children:e.jsx(U,{})})]}),e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",onClick:()=>c("all"),children:[e.jsx("span",{className:"stat-value",children:p.total}),e.jsx("span",{className:"stat-label",children:"Toplam"})]}),e.jsxs("div",{className:"stat-item active",onClick:()=>c("active"),children:[e.jsx("span",{className:"stat-value",children:p.active}),e.jsx("span",{className:"stat-label",children:"Aktif"})]}),e.jsxs("div",{className:"stat-item expired",onClick:()=>c("expired"),children:[e.jsx("span",{className:"stat-value",children:p.expired}),e.jsx("span",{className:"stat-label",children:"Süresi Dolmuş"})]}),e.jsxs("div",{className:"stat-item appealed",onClick:()=>c("appealed"),children:[e.jsx("span",{className:"stat-value",children:p.appealed}),e.jsx("span",{className:"stat-label",children:"İtiraz Kabul"})]})]}),e.jsxs("div",{className:"filters-bar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(L,{}),e.jsx("input",{type:"text",placeholder:"Kullanıcı, sebep veya moderatör ara...",value:o,onChange:a=>D(a.target.value)})]}),e.jsxs("select",{value:i,onChange:a=>c(a.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Banlar"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"expired",children:"Süresi Dolmuş"}),e.jsx("option",{value:"appealed",children:"İtiraz Kabul"})]}),e.jsxs("select",{value:h,onChange:a=>F(a.target.value),children:[e.jsx("option",{value:"newest",children:"En Yeni"}),e.jsx("option",{value:"oldest",children:"En Eski"})]}),e.jsxs("button",{className:"export-btn",onClick:$,children:[e.jsx(R,{})," Dışa Aktar"]})]}),e.jsx("div",{className:"bans-list",children:_?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Y,{}),e.jsx("p",{children:"Ban kaydı bulunamadı"})]}):m.map(a=>e.jsxs("div",{className:`ban-card ${a.status}`,children:[e.jsxs("div",{className:"ban-main",onClick:()=>E(j===a.id?null:a.id),children:[e.jsxs("div",{className:"ban-user",children:[e.jsx("div",{className:"user-avatar",children:a.user.avatar?e.jsx("img",{src:a.user.avatar,alt:""}):e.jsx(O,{})}),e.jsxs("div",{className:"user-info",children:[e.jsx("span",{className:"username",children:a.user.username}),e.jsxs("span",{className:"discriminator",children:["#",a.user.discriminator]})]})]}),e.jsxs("div",{className:"ban-reason",children:[e.jsx(H,{}),e.jsx("span",{children:a.reason})]}),e.jsxs("div",{className:"ban-meta",children:[A(a.status,a.appeal_status),K(a.appeal_status)]}),e.jsxs("div",{className:"ban-date",children:[e.jsx(M,{}),e.jsx("span",{children:g(a.banned_at)})]}),e.jsx("button",{className:"expand-btn",children:j===a.id?e.jsx(P,{}):e.jsx(Q,{})})]}),j===a.id&&e.jsxs("div",{className:"ban-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Moderatör:"}),e.jsx("span",{className:"value",children:a.moderator.username})]}),a.expires_at&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Bitiş Tarihi:"}),e.jsx("span",{className:"value",children:g(a.expires_at)})]}),a.unbanned_at&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Yasak Kaldırıldı:"}),e.jsx("span",{className:"value",children:g(a.unbanned_at)})]}),a.notes&&e.jsxs("div",{className:"detail-row notes",children:[e.jsx("span",{className:"label",children:"Notlar:"}),e.jsx("span",{className:"value",children:a.notes})]}),a.status==="active"&&e.jsx("div",{className:"detail-actions",children:e.jsxs("button",{className:"unban-btn",onClick:()=>T(a),children:[e.jsx(q,{})," Yasağı Kaldır"]})})]})]},a.id))})]})})};export{Z as default};
