import{r as s,b as e}from"./react-core-9vc7GIjk.js";import{t as v,a as B,f as y,ad as g,bM as A,bN as z,bO as R,bP as x,bQ as D,bR as G,bS as L,aE as N,aJ as H,u as I,bT as M}from"./icons-vendor-c3DBUQOi.js";import{a as O,g as X,t as l}from"./index-JO48dClR.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const W=({onClose:p})=>{const{token:E,user:k}=O(),[C,w]=s.useState({}),[F,$]=s.useState(!0),[T,r]=s.useState(null),c=s.useRef(null),m=s.useRef(null),u=X().replace("/api",""),b=[{id:"spotify",name:"Spotify",icon:A,color:"#1DB954",description:"Dinlediğin müziği profilinde göster",oauth:!0,features:["Now Playing","Rich Presence"]},{id:"steam",name:"Steam",icon:z,color:"#171A21",description:"Oynadığın oyunları profilinde göster",oauth:!0,features:["Game Activity","Rich Presence","Achievements"]},{id:"xbox",name:"Xbox",icon:R,color:"#107C10",description:"Xbox Live hesabını bağla",oauth:!0,features:["Gamertag","Game Activity","Achievements"]},{id:"twitch",name:"Twitch",icon:x,color:"#9146FF",description:"Twitch yayın durumunu göster",oauth:!0,features:["Stream Status","Rich Presence"]},{id:"github",name:"GitHub",icon:D,color:"#333333",description:"GitHub profilini bağla",oauth:!0,features:["Repositories","Contributions","Profile"]},{id:"youtube",name:"YouTube",icon:G,color:"#FF0000",description:"YouTube kanalını bağla",oauth:!0,features:["Channel","Subscribers","Videos"]},{id:"discord",name:"Discord",icon:L,color:"#5865F2",description:"Discord hesabını bağla (migration)",oauth:!0,features:["Profile","Friends Import"]}],d=s.useCallback(async()=>{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const a=await fetch(`${u}/api/connections/status/`,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},signal:t.signal});if(clearTimeout(n),a.ok){const i=await a.json();w(i.connections||{})}}catch(a){a.name==="AbortError"?(console.error("Connections loading timeout (10s)"),l.error("Bağlantılar yüklenemedi - zaman aşımı")):console.error("Failed to load connections:",a)}finally{$(!1)}},[E,u]);s.useEffect(()=>(d(),()=>{c.current&&clearInterval(c.current),m.current&&clearTimeout(m.current)}),[d]);const P=t=>{c.current&&clearInterval(c.current),m.current&&clearTimeout(m.current),r(t);const n=500,a=700,i=window.screenX+(window.outerWidth-n)/2,f=window.screenY+(window.outerHeight-a)/2,o=window.open(`${u}/api/auth/${t}/start/?username=${k?.username||"anonymous"}`,`${t}_oauth`,`width=${n},height=${a},left=${i},top=${f},toolbar=no,menubar=no`);if(!o){l.error("Popup blocker tarafından engellendi. Lütfen popup'lara izin verin."),r(null);return}c.current=setInterval(()=>{o.closed&&(clearInterval(c.current),c.current=null,r(null),d(),l.success(`${t} bağlantısı kontrol ediliyor...`))},500),m.current=setTimeout(()=>{c.current&&(clearInterval(c.current),c.current=null),o.closed||o.close(),r(null)},12e4)},S=async t=>{if(confirm(`${t} bağlantısını kesmek istediğinize emin misiniz?`)){r(t);try{(await fetch(`${u}/api/connections/${t}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}})).ok?(l.success(`${t} bağlantısı kesildi`),d()):l.error("Bağlantı kesilemedi")}catch(n){console.error("Disconnect error:",n),l.error("Bağlantı kesme hatası")}finally{r(null)}}},h=t=>{const n=C[t.id],a=n?.connected,i=T===t.id,f=t.icon;return e.createElement("div",{key:t.id,className:`connection-card ${a?"connected":""}`,style:{"--platform-color":t.color}},e.createElement("div",{className:"connection-header"},e.createElement("div",{className:"platform-icon",style:{backgroundColor:t.color}},e.createElement(f,null)),e.createElement("div",{className:"platform-info"},e.createElement("h3",null,t.name),e.createElement("p",null,t.description))),a&&n.username&&e.createElement("div",{className:"connection-details"},e.createElement("span",{className:"connected-as"},e.createElement(I,{className:"status-icon success"}),"Bağlı: ",e.createElement("strong",null,n.username)),n.data&&e.createElement("div",{className:"connection-data"},n.data.game&&e.createElement("span",{className:"activity"},e.createElement(g,null)," ",n.data.game),n.data.track&&e.createElement("span",{className:"activity"},e.createElement(N,null)," ",n.data.track))),e.createElement("div",{className:"connection-features"},t.features.map(o=>e.createElement("span",{key:o,className:"feature-tag"},o))),e.createElement("div",{className:"connection-actions"},a?e.createElement("button",{className:"disconnect-btn",onClick:()=>S(t.id),disabled:i},i?e.createElement(v,{className:"spin"}):e.createElement(M,null),"Bağlantıyı Kes"):e.createElement("button",{className:"connect-btn",onClick:()=>P(t.id),disabled:i,style:{backgroundColor:t.color}},i?e.createElement(v,{className:"spin"}):e.createElement(y,null),"Bağlan")))};return F?e.createElement("div",{className:"connections-modal-overlay",onClick:p},e.createElement("div",{className:"connections-modal",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"connections-panel loading"},e.createElement(v,{className:"spin large"}),e.createElement("p",null,"Bağlantılar yükleniyor...")))):e.createElement("div",{className:"connections-modal-overlay",onClick:p},e.createElement("div",{className:"connections-modal",onClick:t=>t.stopPropagation()},e.createElement("button",{className:"connections-close-btn",onClick:p},e.createElement(B,null)),e.createElement("div",{className:"connections-panel"},e.createElement("div",{className:"connections-header"},e.createElement("h2",null,e.createElement(y,null)," Bağlantılar"),e.createElement("p",null,"Hesaplarını bağlayarak profilini zenginleştir ve aktivitelerini göster")),e.createElement("div",{className:"connections-grid"},e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(g,null)," Oyun Platformları"),e.createElement("div",{className:"platforms-grid"},b.filter(t=>["steam","epic","xbox","playstation","battlenet","riot"].includes(t.id)).map(h))),e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(N,null)," Müzik & Streaming"),e.createElement("div",{className:"platforms-grid"},b.filter(t=>["spotify","twitch","youtube"].includes(t.id)).map(h))),e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(y,null)," Sosyal Medya"),e.createElement("div",{className:"platforms-grid"},b.filter(t=>["discord","twitter","github"].includes(t.id)).map(h)))),e.createElement("div",{className:"connections-footer"},e.createElement("p",{className:"privacy-note"},e.createElement(H,null),"Bağlantılar sadece izin verdiğin bilgilere erişir. İstediğin zaman bağlantıyı kesebilirsin.")))))};export{W as default};
