var le=Object.defineProperty;var c=(h,i)=>le(h,"name",{value:i,configurable:!0});import{r,j as e}from"./react-core-Djgtqrmb.js";import{an as ie,u as oe,a as ue,aM as de,aN as he,au as me,G as ye,cq as pe,b2 as fe}from"./icons-vendor-BW7dxHkX.js";import{t as d,W as je,s as xe,A as w}from"./index-GGLPABCW.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const we=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸ‘","ðŸŽ‰"],ge=c(h=>{const i=h.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return i?i[1]:""},"extractYouTubeId");function ve(h,i){const[t,n]=r.useState(null),[g,j]=r.useState(!1),[J,P]=r.useState(!1),[v,U]=r.useState(""),[z,b]=r.useState([]),[H,D]=r.useState([]),[N,M]=r.useState(""),[m,R]=r.useState(!1),[S,x]=r.useState(!1),[y,k]=r.useState(0),[q,Y]=r.useState(!1),[G,O]=r.useState(!1),[K,Z]=r.useState(!0),[Q,$]=r.useState([]),o=r.useRef(null),f=r.useRef(null),C=r.useRef(null),T=r.useRef(null),_=r.useRef(null),p=localStorage.getItem("access_token"),W=r.useCallback(s=>{(s.by_user==="system"||!m)&&(k(s.current_time),x(s.status==="playing"),f.current&&(f.current.seekTo(s.current_time),s.status==="playing"?f.current.play():f.current.pause()))},[m]),F=r.useCallback(s=>{const a=Date.now()+Math.random();$(l=>[...l,{...s,id:a}]),setTimeout(()=>$(l=>l.filter(u=>u.id!==a)),3e3)},[]),I=r.useCallback(s=>{D(a=>[...a,s]),setTimeout(()=>T.current?.scrollIntoView({behavior:"smooth"}),100)},[]),E=r.useCallback(s=>{d.success(`${s.username} katÄ±ldÄ±!`),b(a=>a.find(l=>l.username===s.username)?a:[...a,{username:s.username,id:s.user_id}])},[]),A=r.useCallback(s=>{b(a=>a.filter(l=>l.username!==s.username))},[]),V=r.useCallback(()=>{d.info("Watch Party sona erdi"),n(null),i?.()},[i]),L=r.useCallback(s=>{n(a=>({...a,video_url:s.video_url,video_title:s.video_title,embed_url:s.embed_url})),k(0),x(!1)},[]),B=r.useCallback(s=>{o.current&&o.current.close();const a=new WebSocket(`${je}://${xe}/ws/watch-party/${s}/?token=${p}`);a.onopen=()=>a.send(JSON.stringify({type:"request_sync"})),a.onmessage=l=>{const u=JSON.parse(l.data);({sync_playback:W,reaction:F,chat_message:I,viewer_joined:E,viewer_left:A,party_ended:V,video_changed:L})[u.type]?.(u)},a.onerror=l=>{},o.current=a,_.current=setInterval(()=>{a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"heartbeat",local_time:y,is_buffering:!1}))},5e3)},[p,y,W,F,I,E,A,V,L]),X=c(async()=>{if(!v.trim()){d.error("Video URL gerekli");return}j(!0);try{const s=await fetch(`${w}/rooms/${h}/watch-party/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({video_url:v,allow_control:!1})});if(s.ok){const a=await s.json();n(a),R(!0),P(!1),B(a.id),d.success("Watch Party oluÅŸturuldu! ðŸŽ‰")}else{const a=await s.json();d.error(a.error||"Watch Party oluÅŸturulamadÄ±")}}catch{d.error("BaÄŸlantÄ± hatasÄ±")}finally{j(!1)}},"createWatchParty"),ee=c(async s=>{j(!0);try{const a=await fetch(`${w}/watch-party/${s}/join/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}});if(a.ok){const u=await(await fetch(`${w}/watch-party/${s}/`,{headers:{Authorization:`Bearer ${p}`}})).json();n(u),R(u.is_host),b(u.viewers||[]),k(u.current_time),x(u.status==="playing"),B(s),d.success("Watch Party'ye katÄ±ldÄ±n! ðŸŽ¬")}else{const l=await a.json();d.error(l.error||"KatÄ±lÄ±namadÄ±")}}catch{d.error("BaÄŸlantÄ± hatasÄ±")}finally{j(!1)}},"joinWatchParty"),te=c(s=>{!m||!o.current||o.current.send(JSON.stringify({type:"sync",action:s,current_time:y,playback_rate:1}))},"sendSync"),se=c(s=>{o.current&&o.current.send(JSON.stringify({type:"reaction",emoji:s,video_time:y}))},"sendReaction"),ae=c(()=>{!N.trim()||!o.current||(o.current.send(JSON.stringify({type:"message",content:N,video_time:y})),M(""))},"sendMessage"),re=c(async()=>{if(!(!t||!m))try{await fetch(`${w}/watch-party/${t.id}/end/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}})}catch{}},"endParty"),ne=c(()=>{m&&te(S?"pause":"play"),x(!S)},"togglePlay"),ce=c(()=>{C.current&&(document.fullscreenElement?(document.exitFullscreen(),O(!1)):(C.current.requestFullscreen(),O(!0)))},"toggleFullscreen");return r.useEffect(()=>()=>{o.current?.close(),_.current&&clearInterval(_.current)},[]),{party:t,isLoading:g,showCreateModal:J,setShowCreateModal:P,videoUrl:v,setVideoUrl:U,viewers:z,messages:H,newMessage:N,setNewMessage:M,isHost:m,isPlaying:S,currentTime:y,isMuted:q,setIsMuted:Y,isFullscreen:G,showChat:K,setShowChat:Z,reactions:Q,playerRef:f,containerRef:C,chatEndRef:T,createWatchParty:X,joinWatchParty:ee,sendReaction:se,sendMessage:ae,endParty:re,togglePlay:ne,toggleFullscreen:ce}}c(ve,"useWatchParty");const $e=c(({roomId:h,onClose:i})=>{const t=ve(h,i);return t.party?e.jsxs("div",{className:"watch-together-container",ref:t.containerRef,children:[e.jsxs("div",{className:"watch-header",children:[e.jsxs("div",{className:"watch-title",children:[e.jsx("span",{className:"live-badge",children:"CANLI"}),e.jsx("h3",{children:t.party.video_title||"Watch Party"})]}),e.jsxs("div",{className:"watch-viewers",children:[e.jsx(oe,{}),e.jsxs("span",{children:[t.viewers.length," izleyici"]})]}),e.jsx("button",{className:"close-btn",onClick:i,children:e.jsx(ue,{})})]}),e.jsxs("div",{className:"watch-player",children:[t.party.video_source==="youtube"&&e.jsx("iframe",{ref:t.playerRef,src:`https://www.youtube.com/embed/${ge(t.party.video_url)}?autoplay=${t.isPlaying?1:0}&start=${Math.floor(t.currentTime)}&enablejsapi=1`,title:"Watch Party",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),t.party.video_source==="direct"&&e.jsx("video",{ref:t.playerRef,src:t.party.video_url,autoPlay:t.isPlaying,muted:t.isMuted}),e.jsx("div",{className:"reaction-overlay",children:t.reactions.map(n=>e.jsx("div",{className:"floating-reaction",style:{left:`${Math.random()*80+10}%`},children:n.emoji},n.id))})]}),e.jsxs("div",{className:"watch-controls",children:[e.jsxs("div",{className:"control-left",children:[t.isHost&&e.jsx("button",{onClick:t.togglePlay,children:t.isPlaying?e.jsx(de,{}):e.jsx(he,{})}),e.jsx("button",{onClick:c(()=>t.setIsMuted(!t.isMuted),"onClick"),children:t.isMuted?e.jsx(me,{}):e.jsx(ye,{})})]}),e.jsx("div",{className:"reactions-bar",children:we.map(n=>e.jsx("button",{className:"reaction-btn",onClick:c(()=>t.sendReaction(n),"onClick"),children:n},n))}),e.jsxs("div",{className:"control-right",children:[e.jsx("button",{onClick:c(()=>t.setShowChat(!t.showChat),"onClick"),children:"ðŸ’¬"}),e.jsx("button",{onClick:t.toggleFullscreen,children:t.isFullscreen?e.jsx(pe,{}):e.jsx(fe,{})}),t.isHost&&e.jsx("button",{className:"end-btn",onClick:t.endParty,children:"Bitir"})]})]}),t.showChat&&e.jsxs("div",{className:"watch-chat",children:[e.jsxs("div",{className:"chat-messages",children:[t.messages.map((n,g)=>e.jsxs("div",{className:"chat-message",children:[e.jsx("img",{src:n.avatar||"/default-avatar.png",alt:n.user,className:"chat-avatar"}),e.jsxs("div",{className:"chat-content",children:[e.jsx("span",{className:"chat-user",children:n.user}),e.jsx("span",{className:"chat-text",children:n.content})]})]},g)),e.jsx("div",{ref:t.chatEndRef})]}),e.jsxs("div",{className:"chat-input",children:[e.jsx("input",{type:"text",placeholder:"Mesaj yaz...",value:t.newMessage,onChange:c(n=>t.setNewMessage(n.target.value),"onChange"),onKeyPress:c(n=>n.key==="Enter"&&t.sendMessage(),"onKeyPress")}),e.jsx("button",{onClick:t.sendMessage,children:"GÃ¶nder"})]})]})]}):e.jsxs("div",{className:"watch-together-container",children:[e.jsxs("div",{className:"watch-together-empty",children:[e.jsxs("h2",{children:["ðŸ“º"," Watch Together"]}),e.jsx("p",{children:"ArkadaÅŸlarÄ±nla birlikte video izle!"}),e.jsxs("button",{className:"create-party-btn",onClick:c(()=>t.setShowCreateModal(!0),"onClick"),children:[e.jsx(ie,{})," Yeni Watch Party OluÅŸtur"]}),e.jsxs("div",{className:"supported-platforms",children:[e.jsx("span",{children:"Desteklenen platformlar:"}),e.jsxs("div",{className:"platforms",children:[e.jsx("span",{children:"YouTube"}),e.jsx("span",{children:"Twitch"}),e.jsx("span",{children:"Vimeo"}),e.jsx("span",{children:"Dailymotion"})]})]})]}),t.showCreateModal&&e.jsx("div",{className:"watch-modal-overlay",onClick:c(()=>t.setShowCreateModal(!1),"onClick"),children:e.jsxs("div",{className:"watch-modal",onClick:c(n=>n.stopPropagation(),"onClick"),children:[e.jsxs("h3",{children:["ðŸŽ¬"," Watch Party OluÅŸtur"]}),e.jsx("input",{type:"url",placeholder:"Video URL'sini yapÄ±ÅŸtÄ±r...",value:t.videoUrl,onChange:c(n=>t.setVideoUrl(n.target.value),"onChange"),autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:c(()=>t.setShowCreateModal(!1),"onClick"),children:"Ä°ptal"}),e.jsx("button",{className:"create-btn",onClick:t.createWatchParty,disabled:t.isLoading,children:t.isLoading?"OluÅŸturuluyor...":"OluÅŸtur"})]})]})})]})},"WatchTogether");export{$e as default};
