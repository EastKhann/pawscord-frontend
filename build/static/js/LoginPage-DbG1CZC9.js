import{r as u,j as a}from"./react-core-D6cE4lil.js";import{am as U,I as z,a2 as O,j as P}from"./icons-vendor-DT2gd7vx.js";import{C as b,G as I,f as D,i as h,t as M,A as _}from"./index-BvqjkDq7.js";import{u as q}from"./recaptcha-BhRBhq81.js";import{j as f}from"./crypto-vendor-BYnay7oC.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./ui-vendor-CZOhtEfS.js";const Z=({onLogin:T,onRegister:L,error:y,setAuthError:t})=>{const[g,v]=u.useState(!0),[i,x]=u.useState({username:"",email:"",password:""}),[S,j]=u.useState(!1),{getToken:N}=q();u.useEffect(()=>{if(b.isNativePlatform())try{I.initialize({clientId:D,scopes:["profile","email"],grantOfflineAccess:!0})}catch{}},[]),u.useEffect(()=>{if(h&&window.require){const{ipcRenderer:e}=window.require("electron"),s=(w,l)=>{try{const{access:r,refresh:n}=l;if(r&&n){const m=f(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch{t("Token işleme hatası.")}},o=(w,l)=>{t(l.error||"Google girişi başarısız.")},d=(w,l)=>{try{const{access:r,refresh:n}=l;if(r&&n){const m=f(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch{t("Token işleme hatası.")}},c=(w,l)=>{try{const r=new URL(l),n=new URLSearchParams(r.search),m=n.get("access"),p=n.get("refresh");if(m&&p){const k=f(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",p),localStorage.setItem("chat_username",k.username),window.location.reload()}}catch{try{if(l.includes("access=")&&l.includes("refresh=")){const n=l.split("access=");if(n.length>1){const m=n[1].split("&")[0],p=l.split("refresh=");if(p.length>1){const k=p[1],R=f(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",k),localStorage.setItem("chat_username",R.username),window.location.reload()}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}catch{t("Giriş işlemi başarısız.")}}};return e.on("google-auth-success",s),e.on("google-auth-error",o),e.on("deep-link-auth",c),e.on("oauth-tokens",d),()=>{e.removeListener("google-auth-success",s),e.removeListener("google-auth-error",o),e.removeListener("deep-link-auth",c),e.removeListener("oauth-tokens",d)}}},[t]),u.useEffect(()=>{if(!h){const e=new URLSearchParams(window.location.search),s=e.get("access"),o=e.get("refresh"),d=e.get("error");if(d){t(decodeURIComponent(d)),window.history.replaceState({},document.title,"/");return}if(s&&o)try{const c=f(s);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",o),localStorage.setItem("chat_username",c.username),window.history.replaceState({},document.title,"/"),window.location.reload()}catch{t("Tarayıcı depolama hatası. Lütfen gizli modda değilseniz kontrol edin.")}}},[]);const G=async()=>{try{if(b.isNativePlatform()){const e=await I.signIn(),s=`${_}/auth/google/native/`,o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})}),d=o.headers.get("content-type");if(!d||!d.includes("application/json")){const w=await o.text();t("Backend hatası: JSON yerine HTML yanıtı alındı. Sunucu ayarlarını kontrol edin.");return}const c=await o.json();o.ok?c.access&&c.refresh?(localStorage.setItem("access_token",c.access),localStorage.setItem("refresh_token",c.refresh),window.location.reload()):t("Token bilgileri eksik."):t(c.error||"Google girişi başarısız.")}else{const o=`${h?"https://api.pawscord.com/api":_}/auth/google/start/?source=${h?"electron":"web"}`;if(h&&window.require){const{ipcRenderer:d}=window.require("electron");d.send("start-google-login",o)}else window.location.href=o}}catch(e){t("Google girişi sırasında bir hata oluştu: "+e.message)}},C=async e=>{e.preventDefault(),j(!0),t("");try{const s=await N(g?"login":"register");g?await T(i.username,i.password,s):await L(i.username,i.email,i.password,s)&&(M.success("Kayıt başarılı! Lütfen e-postanı kontrol et.",4e3),v(!0))}catch{t("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.")}finally{j(!1)}};return a.jsxs("div",{className:"login-container",children:[a.jsx("div",{className:"background-animate"}),a.jsxs("div",{className:"login-card",children:[a.jsxs("div",{className:"logo-header",children:[a.jsx("div",{className:"logo-circle",children:a.jsx(U,{size:40,color:"white"})}),a.jsx("h1",{children:"Pawscord"}),a.jsx("p",{children:g?"Tekrar hoşgeldin!":"Aramıza katıl!"})]}),y&&a.jsx("div",{className:"error-message",children:y}),a.jsxs("form",{onSubmit:C,children:[a.jsxs("div",{className:"input-group",children:[a.jsx(z,{className:"input-icon"}),a.jsx("input",{type:"text",placeholder:"Kullanıcı Adı",value:i.username,onChange:e=>x({...i,username:e.target.value}),required:!0})]}),!g&&a.jsxs("div",{className:"input-group slide-down",children:[a.jsx(O,{className:"input-icon"}),a.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:i.email,onChange:e=>x({...i,email:e.target.value}),required:!0})]}),a.jsxs("div",{className:"input-group",children:[a.jsx(P,{className:"input-icon"}),a.jsx("input",{type:"password",placeholder:"Şifre",value:i.password,onChange:e=>x({...i,password:e.target.value}),required:!0})]}),a.jsx("button",{type:"submit",className:"submit-btn",disabled:S,children:S?a.jsx("div",{className:"spinner"}):g?"Giriş Yap":"Kayıt Ol"})]}),g&&a.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:a.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1",children:"Şifremi Unuttum?"})}),a.jsx("div",{className:"divider",children:a.jsx("span",{children:"veya"})}),a.jsx("div",{className:"google-btn-wrapper",children:a.jsxs("button",{onClick:G,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5",children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),a.jsx("span",{children:"Google ile Giriş Yap"})]})}),a.jsxs("div",{className:"toggle-mode",children:[g?"Hesabın yok mu? ":"Zaten üye misin? ",a.jsx("span",{onClick:()=>{v(!g),t("")},children:g?"Kayıt Ol":"Giriş Yap"})]})]})]})};export{Z as default};
