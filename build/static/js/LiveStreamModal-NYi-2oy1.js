import{r as i,d as e,J as x,i as B,ar as T,K as z,cy as N,H as j,Z as L,G as P}from"./react-core-DrOm_csO.js";import{t as H}from"./index-DmEhdEtw.js";const V=({onClose:u,roomSlug:f,ws:a,token:J,isMobile:n})=>{const[g,h]=i.useState(!1),[d,v]=i.useState(!1),[m,E]=i.useState("camera"),[k,C]=i.useState(0),[w,R]=i.useState([]),[y,S]=i.useState(""),p=i.useRef(null),l=i.useRef(null),b=i.useRef({}),I={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};i.useEffect(()=>{if(!a.current)return;const t=c=>{try{const o=JSON.parse(c.data);o.type==="stream_viewer_count"?C(o.count):o.type==="stream_chat"?R(s=>[...s,{id:Date.now(),user:o.username,message:o.message,timestamp:new Date().toLocaleTimeString()}]):o.type==="stream_viewer_join"&&O(o.viewerId)}catch(o){console.error("Stream WS error:",o)}};return a.current.addEventListener("message",t),()=>a.current?.removeEventListener("message",t)},[a]),i.useEffect(()=>{const t=c=>{c.key==="Escape"&&u()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[u]);const F=async()=>{try{let t;m==="camera"?t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}):t=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0}),l.current=t,p.current&&(p.current.srcObject=t),h(!0),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_start",room_slug:f,stream_type:m}))}catch(t){console.error("Failed to start stream:",t),H.error("âŒ Failed to start stream. Please check permissions.")}},D=()=>{l.current&&(l.current.getTracks().forEach(t=>t.stop()),l.current=null),Object.values(b.current).forEach(t=>t.close()),b.current={},p.current&&(p.current.srcObject=null),h(!1),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_stop",room_slug:f}))},W=()=>{l.current&&(l.current.getAudioTracks().forEach(t=>{t.enabled=d}),v(!d))},_=t=>{t.preventDefault(),y.trim()&&(a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_chat",room_slug:f,message:y})),S(""))},O=async t=>{if(!l.current)return;const c=new RTCPeerConnection(I);b.current[t]=c,l.current.getTracks().forEach(s=>{c.addTrack(s,l.current)}),c.onicecandidate=s=>{s.candidate&&a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"ice_candidate",candidate:s.candidate,viewer_id:t}))};const o=await c.createOffer();await c.setLocalDescription(o),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_offer",sdp:c.localDescription,viewer_id:t}))},r={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:n?"0":"20px"},modal:{width:"100%",maxWidth:n?"100%":"1400px",height:n?"100%":"auto",maxHeight:"90vh",background:"linear-gradient(135deg, rgba(30, 31, 34, 0.98), rgba(35, 36, 40, 0.98))",borderRadius:n?"0":"16px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(218, 55, 60, 0.3)",border:n?"none":"1px solid rgba(218, 55, 60, 0.4)"},header:{padding:n?"12px 16px":"16px 24px",background:"linear-gradient(135deg, rgba(218, 55, 60, 0.15), rgba(240, 71, 71, 0.15))",borderBottom:"1px solid rgba(218, 55, 60, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:n?"18px":"22px",fontWeight:"700",color:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",gap:"10px"},liveIndicator:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",background:"rgba(218, 55, 60, 0.3)",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#da373c",border:"1px solid rgba(218, 55, 60, 0.5)"},liveD:{width:"8px",height:"8px",background:"#da373c",borderRadius:"50%",animation:"pulse 1.5s ease-in-out infinite"},closeBtn:{background:"rgba(218, 55, 60, 0.2)",border:"1px solid rgba(218, 55, 60, 0.4)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#da373c",fontSize:"18px"},content:{flex:1,display:"flex",flexDirection:n?"column":"row",overflow:"hidden"},streamSection:{flex:1,display:"flex",flexDirection:"column",background:"#000",position:"relative"},videoContainer:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",position:"relative"},video:{width:"100%",height:"100%",objectFit:"contain"},placeholder:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)"},viewerCount:{position:"absolute",top:"16px",right:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",borderRadius:"20px",fontSize:"14px",fontWeight:"600",color:"white"},controls:{padding:"16px",background:"rgba(0, 0, 0, 0.8)",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},controlBtn:t=>({padding:"12px 24px",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",minHeight:"44px",background:t?"rgba(218, 55, 60, 0.3)":"rgba(88, 101, 242, 0.2)",color:t?"#da373c":"rgba(255, 255, 255, 0.9)",border:`1px solid ${t?"rgba(218, 55, 60, 0.5)":"rgba(88, 101, 242, 0.4)"}`}),startBtn:{padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"linear-gradient(135deg, #da373c, #f04747)",color:"white",transition:"all 0.2s ease",minHeight:"48px"},chatSection:{width:n?"100%":"350px",maxHeight:n?"300px":"auto",background:"rgba(0, 0, 0, 0.3)",borderLeft:n?"none":"1px solid rgba(218, 55, 60, 0.2)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(218, 55, 60, 0.2)",fontSize:"16px",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)"},chatMessages:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px"},chatMessage:{padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"14px"},chatUsername:{fontWeight:"600",color:"#5865f2",marginBottom:"4px"},chatText:{color:"rgba(255, 255, 255, 0.8)"},chatInput:{padding:"12px",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"8px"},input:{flex:1,padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(218, 55, 60, 0.3)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.95)",fontSize:"14px",outline:"none"},sendBtn:{padding:"12px 20px",background:"linear-gradient(135deg, #da373c, #f04747)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:"pointer",minHeight:"44px"}};return e.createElement(e.Fragment,null,e.createElement("style",null,`
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
            `),e.createElement("div",{style:r.overlay,onClick:u},e.createElement("div",{style:r.modal,onClick:t=>t.stopPropagation()},e.createElement("div",{style:r.header},e.createElement("h2",{style:r.title},e.createElement(x,null),"Live Stream",g&&e.createElement("span",{style:r.liveIndicator},e.createElement("span",{style:r.liveDot}),"LIVE")),e.createElement("button",{onClick:u,style:r.closeBtn},e.createElement(B,null))),e.createElement("div",{style:r.content},e.createElement("div",{style:r.streamSection},e.createElement("div",{style:r.videoContainer},g?e.createElement(e.Fragment,null,e.createElement("video",{ref:p,autoPlay:!0,muted:!0,style:r.video}),e.createElement("div",{style:r.viewerCount},e.createElement(T,null),k," viewers")):e.createElement("div",{style:r.placeholder},e.createElement(x,{size:64}),e.createElement("p",{style:{marginTop:"16px",fontSize:"18px"}},'Click "Start Stream" to begin'))),e.createElement("div",{style:r.controls},g?e.createElement(e.Fragment,null,e.createElement("button",{onClick:W,style:r.controlBtn(d)},d?e.createElement(N,null):e.createElement(j,null),d?"Unmute":"Mute"),e.createElement("button",{onClick:D,style:{...r.startBtn,background:"linear-gradient(135deg, #da373c, #b83030)"}},e.createElement(L,null),"Stop Stream")):e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>E("camera"),style:r.controlBtn(m==="camera")},e.createElement(x,null),"Camera"),e.createElement("button",{onClick:()=>E("screen"),style:r.controlBtn(m==="screen")},e.createElement(z,null),"Screen"),e.createElement("button",{onClick:F,style:r.startBtn},e.createElement(x,null),"Start Stream")))),g&&e.createElement("div",{style:r.chatSection},e.createElement("div",{style:r.chatHeader},e.createElement(P,null)," Stream Chat"),e.createElement("div",{style:r.chatMessages},w.map(t=>e.createElement("div",{key:t.id,style:r.chatMessage},e.createElement("div",{style:r.chatUsername},t.user),e.createElement("div",{style:r.chatText},t.message)))),e.createElement("form",{onSubmit:_,style:r.chatInput},e.createElement("input",{type:"text",value:y,onChange:t=>S(t.target.value),placeholder:"Send a message...",style:r.input}),e.createElement("button",{type:"submit",style:r.sendBtn},"Send")))))))};export{V as default};
