import{r as c,cP as y,aX as o,cW as S,bK as N,bT as w,bS as b}from"./react-core-B6hadH-M.js";function F({apiBaseUrl:n,fetchWithAuth:s}){const[i,u]=c.useState(!1),[t,d]=c.useState(null),[m,E]=c.useState(!0),[p,r]=c.useState(!1),[R,l]=c.useState("");c.useEffect(()=>{if(g(),i){f();const e=setInterval(f,3e4);return()=>clearInterval(e)}},[i]);const g=async()=>{try{const e=await s(`${n}/auth/spotify/status/`);if(e.ok){const a=await e.json();u(a.connected),E(a.show_activity)}}catch(e){console.error("Error checking Spotify connection:",e)}},v=async()=>{r(!0);try{const e=await s(`${n}/auth/spotify/start/`);if(e.ok){const a=await e.json();window.location.href=a.url||a.auth_url}}catch(e){l("Failed to connect: "+e.message)}finally{r(!1)}},k=async()=>{r(!0);try{(await s(`${n}/auth/spotify/disconnect/`,{method:"POST"})).ok&&(u(!1),d(null),l(""))}catch(e){l("Failed to disconnect: "+e.message)}finally{r(!1)}},f=async()=>{try{const e=await s(`${n}/spotify/current-track/`);if(e.ok){const a=await e.json();d(a.track)}}catch(e){console.error("Error fetching current track:",e)}},h=async()=>{try{(await s(`${n}/spotify/toggle-activity/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({show_activity:!m})})).ok&&E(!m)}catch(e){l("Failed to toggle activity: "+e.message)}};return React.createElement("div",{className:"spotify-panel"},React.createElement("div",{className:"spotify-header"},React.createElement("h2",null,React.createElement(y,{className:"spotify-icon"})," Spotify Integration")),R&&React.createElement("div",{className:"spotify-error"},R),i?React.createElement("div",{className:"spotify-connected"},React.createElement("div",{className:"connection-status"},React.createElement(o,{className:"status-icon"}),React.createElement("span",null,"Connected to Spotify"),React.createElement("button",{className:"disconnect-btn",onClick:k,disabled:p},React.createElement(S,null)," Disconnect")),React.createElement("div",{className:"activity-toggle"},React.createElement("label",{className:"toggle-label"},React.createElement("input",{type:"checkbox",checked:m,onChange:h}),React.createElement("span",{className:"toggle-slider"}),React.createElement("span",{className:"toggle-text"},"Show listening activity"))),t?React.createElement("div",{className:"current-track"},React.createElement("div",{className:"track-header"},React.createElement(N,{className:"music-icon"}),React.createElement("h3",null,"Now Playing")),React.createElement("div",{className:"track-info"},t.album_art&&React.createElement("img",{src:t.album_art,alt:"Album art",className:"album-art"}),React.createElement("div",{className:"track-details"},React.createElement("div",{className:"track-name"},t.name),React.createElement("div",{className:"track-artist"},t.artist),React.createElement("div",{className:"track-album"},t.album)),React.createElement("div",{className:"track-status"},t.is_playing?React.createElement(w,{className:"playing-icon"}):React.createElement(b,{className:"paused-icon"}))),React.createElement("div",{className:"track-progress"},React.createElement("div",{className:"progress-bar",style:{width:`${t.progress_percent||0}%`}}))):React.createElement("div",{className:"no-track"},React.createElement(N,{className:"no-track-icon"}),React.createElement("p",null,"Not playing anything right now"))):React.createElement("div",{className:"spotify-connect"},React.createElement("div",{className:"spotify-logo-container"},React.createElement(y,{className:"spotify-logo"})),React.createElement("h3",null,"Connect Your Spotify"),React.createElement("p",null,"Share what you're listening to with your friends!"),React.createElement("button",{className:"connect-btn",onClick:v,disabled:p},React.createElement(y,null)," Connect Spotify"),React.createElement("div",{className:"spotify-features"},React.createElement("div",{className:"feature-item"},React.createElement(o,{className:"check-icon"}),React.createElement("span",null,"Show currently playing track")),React.createElement("div",{className:"feature-item"},React.createElement(o,{className:"check-icon"}),React.createElement("span",null,"Display in your status")),React.createElement("div",{className:"feature-item"},React.createElement(o,{className:"check-icon"}),React.createElement("span",null,"Privacy controls")))))}export{F as default};
