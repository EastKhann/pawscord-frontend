import{r as n,d as e,cH as u,aR as i,cO as b,bB as v,bK as C,bJ as F}from"./react-core-DrOm_csO.js";function _({apiBaseUrl:s,fetchWithAuth:r}){const[m,d]=n.useState(!1),[a,E]=n.useState(null),[y,p]=n.useState(!0),[f,l]=n.useState(!1),[N,o]=n.useState("");n.useEffect(()=>{if(k(),m){g();const t=setInterval(g,3e4);return()=>clearInterval(t)}},[m]);const k=async()=>{try{const t=await r(`${s}/auth/spotify/status/`);if(t.ok){const c=await t.json();d(c.connected),p(c.show_activity)}}catch(t){console.error("Error checking Spotify connection:",t)}},h=async()=>{l(!0);try{const t=await r(`${s}/auth/spotify/start/`);if(t.ok){const c=await t.json();window.location.href=c.url||c.auth_url}}catch(t){o("Failed to connect: "+t.message)}finally{l(!1)}},S=async()=>{l(!0);try{(await r(`${s}/auth/spotify/disconnect/`,{method:"POST"})).ok&&(d(!1),E(null),o(""))}catch(t){o("Failed to disconnect: "+t.message)}finally{l(!1)}},g=async()=>{try{const t=await r(`${s}/spotify/current-track/`);if(t.ok){const c=await t.json();E(c.track)}}catch(t){console.error("Error fetching current track:",t)}},w=async()=>{try{(await r(`${s}/spotify/toggle-activity/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({show_activity:!y})})).ok&&p(!y)}catch(t){o("Failed to toggle activity: "+t.message)}};return e.createElement("div",{className:"spotify-panel"},e.createElement("div",{className:"spotify-header"},e.createElement("h2",null,e.createElement(u,{className:"spotify-icon"})," Spotify Integration")),N&&e.createElement("div",{className:"spotify-error"},N),m?e.createElement("div",{className:"spotify-connected"},e.createElement("div",{className:"connection-status"},e.createElement(i,{className:"status-icon"}),e.createElement("span",null,"Connected to Spotify"),e.createElement("button",{className:"disconnect-btn",onClick:S,disabled:f},e.createElement(b,null)," Disconnect")),e.createElement("div",{className:"activity-toggle"},e.createElement("label",{className:"toggle-label"},e.createElement("input",{type:"checkbox",checked:y,onChange:w}),e.createElement("span",{className:"toggle-slider"}),e.createElement("span",{className:"toggle-text"},"Show listening activity"))),a?e.createElement("div",{className:"current-track"},e.createElement("div",{className:"track-header"},e.createElement(v,{className:"music-icon"}),e.createElement("h3",null,"Now Playing")),e.createElement("div",{className:"track-info"},a.album_art&&e.createElement("img",{src:a.album_art,alt:"Album art",className:"album-art"}),e.createElement("div",{className:"track-details"},e.createElement("div",{className:"track-name"},a.name),e.createElement("div",{className:"track-artist"},a.artist),e.createElement("div",{className:"track-album"},a.album)),e.createElement("div",{className:"track-status"},a.is_playing?e.createElement(C,{className:"playing-icon"}):e.createElement(F,{className:"paused-icon"}))),e.createElement("div",{className:"track-progress"},e.createElement("div",{className:"progress-bar",style:{width:`${a.progress_percent||0}%`}}))):e.createElement("div",{className:"no-track"},e.createElement(v,{className:"no-track-icon"}),e.createElement("p",null,"Not playing anything right now"))):e.createElement("div",{className:"spotify-connect"},e.createElement("div",{className:"spotify-logo-container"},e.createElement(u,{className:"spotify-logo"})),e.createElement("h3",null,"Connect Your Spotify"),e.createElement("p",null,"Share what you're listening to with your friends!"),e.createElement("button",{className:"connect-btn",onClick:h,disabled:f},e.createElement(u,null)," Connect Spotify"),e.createElement("div",{className:"spotify-features"},e.createElement("div",{className:"feature-item"},e.createElement(i,{className:"check-icon"}),e.createElement("span",null,"Show currently playing track")),e.createElement("div",{className:"feature-item"},e.createElement(i,{className:"check-icon"}),e.createElement("span",null,"Display in your status")),e.createElement("div",{className:"feature-item"},e.createElement(i,{className:"check-icon"}),e.createElement("span",null,"Privacy controls")))))}export{_ as default};
