import{r,n as e}from"./react-core-DA61mcWm.js";import{y as o}from"./ui-vendor-BrUQ4r0A.js";import{g as L,h as v}from"./index-wBOWb2zj.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-tDmQW26m.js";import"./router-vendor-2etVlp2q.js";import"./icons-vendor-l2qVv93x.js";import"./state-vendor-CjqIs3K2.js";import"./crypto-vendor-DiGIAuUm.js";function S(h){const[k,a]=r.useState([]),[s,c]=r.useState(!1),[b,j]=r.useState({name:"",channel_id:"",avatar_url:""}),[f,N]=r.useState([]),[y,W]=r.useState(!0),[$,x]=r.useState(null),[w,C]=r.useState([]),[_,g]=r.useState(null),i=L();r.useEffect(()=>{if(!h)return;const l={Authorization:`Bearer ${localStorage.getItem("access_token")}`};Promise.all([fetch(`${i}/webhooks/server/${h}/`,{headers:l}).then(n=>n.ok?n.json():null),fetch(`${i}/servers/${h}/channels/`,{headers:l}).then(n=>n.ok?n.json():null)]).then(([n,d])=>{n&&a(n.webhooks||[]),d&&N(d.channels||[])}).catch(n=>{}).finally(()=>W(!1))},[h,i]);const u=()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"});return{webhooks:k,creating:s,setCreating:c,newWebhook:b,setNewWebhook:j,channels:f,loading:y,editingWebhook:$,setEditingWebhook:x,logs:w,viewingLogs:_,setViewingLogs:g,apiBaseUrl:i,createWebhook:async()=>{if(!b.name||!b.channel_id){o.error("‚ùå Webhook adƒ± ve kanal se√ßimi zorunludur");return}try{const t=await fetch(`${i}/webhooks/create/`,{method:"POST",headers:u(),body:JSON.stringify({server_id:h,...b})});if(t.ok){const l=await t.json();a(n=>[...n,l.webhook]),j({name:"",channel_id:"",avatar_url:""}),c(!1),o.success("‚úÖ Webhook ba≈üarƒ±yla olu≈üturuldu")}else o.error("‚ùå Webhook olu≈üturulamadƒ±")}catch{o.error("‚ùå Baƒülantƒ± hatasƒ±")}},updateWebhook:async(t,l)=>{try{const n=await fetch(`${i}/webhooks/${t}/update/`,{method:"POST",headers:u(),body:JSON.stringify(l)});if(n.ok){const d=await n.json();a(m=>m.map(p=>p.id===t?d.webhook:p)),x(null),o.success("‚úÖ Webhook g√ºncellendi")}else o.error("‚ùå Webhook g√ºncellenemedi")}catch{o.error("‚ùå Baƒülantƒ± hatasƒ±")}},deleteWebhook:async t=>{if(await v("Bu webhook'u silmek istediƒüinizden emin misiniz?"))try{(await fetch(`${i}/webhooks/${t}/delete/`,{method:"DELETE",headers:u()})).ok?(a(n=>n.filter(d=>d.id!==t)),o.success("‚úÖ Webhook silindi")):o.error("‚ùå Webhook silinemedi")}catch{o.error("‚ùå Baƒülantƒ± hatasƒ±")}},testWebhook:async t=>{try{(await fetch(`${i}/webhooks/${t}/test/`,{method:"POST",headers:u()})).ok?o.success("‚úÖ Test mesajƒ± g√∂nderildi"):o.error("‚ùå Test mesajƒ± g√∂nderilemedi")}catch{o.error("‚ùå Baƒülantƒ± hatasƒ±")}},regenerateToken:async t=>{if(await v("Webhook tokenini yenilemek istediƒüinizden emin misiniz? Eski token ge√ßersiz hale gelecek."))try{const l=await fetch(`${i}/webhooks/${t}/regenerate-token/`,{method:"POST",headers:u()});if(l.ok){const n=await l.json();a(d=>d.map(m=>m.id===t?{...m,token:n.token}:m)),o.success("‚úÖ Token yenilendi")}else o.error("‚ùå Token yenilenemedi")}catch{o.error("‚ùå Baƒülantƒ± hatasƒ±")}},fetchWebhookLogs:async t=>{try{const l=await fetch(`${i}/webhooks/${t}/logs/`,{headers:u()});if(l.ok){const n=await l.json();C(n.logs||[]),g(t)}}catch{o.error("‚ùå Loglar y√ºklenemedi")}},copyWebhookUrl:t=>{navigator.clipboard.writeText(`${i}/webhooks/${t.id}/${t.token}`),o.success("‚úÖ Webhook URL kopyalandƒ±")}}}const G=({serverId:h,onClose:k})=>{const a=S(h);return a.loading?e.jsx("div",{className:"webhooks-overlay",children:e.jsx("div",{className:"webhooks-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Webhooklar y\\u00fckleniyor..."})]})})}):e.jsx("div",{className:"webhooks-overlay",onClick:k,children:e.jsxs("div",{className:"webhooks-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsxs("h2",{children:["üîó"," Webhook Y\\u00f6netimi"]}),e.jsx("button",{className:"close-btn",onClick:k,children:"\\u00d7"})]}),e.jsxs("div",{className:"webhooks-content",children:[!a.creating&&e.jsxs("button",{className:"create-webhook-btn",onClick:()=>a.setCreating(!0),children:["‚ûï"," Yeni Webhook Olu\\u015ftur"]}),a.creating&&e.jsxs("div",{className:"create-webhook-form",children:[e.jsx("h3",{children:"Yeni Webhook"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Ad\\u0131 *"}),e.jsx("input",{type:"text",placeholder:"\\u00d6rn: GitHub Bot",value:a.newWebhook.name,onChange:s=>a.setNewWebhook({...a.newWebhook,name:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:a.newWebhook.channel_id,onChange:s=>a.setNewWebhook({...a.newWebhook,channel_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Kanal se\\u00e7in..."}),a.channels.map(s=>e.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL (Opsiyonel)"}),e.jsx("input",{type:"text",placeholder:"https://example.com/avatar.png",value:a.newWebhook.avatar_url,onChange:s=>a.setNewWebhook({...a.newWebhook,avatar_url:s.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>a.setCreating(!1),children:"\\u0130ptal"}),e.jsx("button",{className:"submit-btn",onClick:a.createWebhook,children:"Olu\\u015ftur"})]})]}),a.webhooks.length>0?e.jsx("div",{className:"webhooks-list",children:a.webhooks.map(s=>e.jsx("div",{className:"webhook-card",children:a.editingWebhook===s.id?e.jsxs("div",{className:"edit-webhook-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Ad\\u0131"}),e.jsx("input",{type:"text",defaultValue:s.name,id:`edit-name-${s.id}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("select",{defaultValue:s.channel_id,id:`edit-channel-${s.id}`,children:a.channels.map(c=>e.jsxs("option",{value:c.id,children:["#",c.name]},c.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL"}),e.jsx("input",{type:"text",defaultValue:s.avatar_url||"",id:`edit-avatar-${s.id}`})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>a.setEditingWebhook(null),children:"\\u0130ptal"}),e.jsx("button",{className:"submit-btn",onClick:()=>a.updateWebhook(s.id,{name:document.getElementById(`edit-name-${s.id}`).value,channel_id:document.getElementById(`edit-channel-${s.id}`).value,avatar_url:document.getElementById(`edit-avatar-${s.id}`).value}),children:"Kaydet"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"webhook-info",children:[e.jsx("div",{className:"webhook-avatar",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name}):e.jsx("div",{className:"default-avatar",children:"üîó"})}),e.jsxs("div",{className:"webhook-details",children:[e.jsx("h4",{children:s.name}),e.jsxs("p",{children:["#",a.channels.find(c=>c.id===s.channel_id)?.name||"Bilinmeyen Kanal"]}),e.jsxs("span",{className:"webhook-id",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"webhook-url",children:[e.jsx("label",{children:"Webhook URL:"}),e.jsxs("div",{className:"url-display",children:[e.jsx("code",{children:`${a.apiBaseUrl}/webhooks/${s.id}/${s.token}`}),e.jsx("button",{className:"copy-btn",onClick:()=>a.copyWebhookUrl(s),title:"URL'yi kopyala",children:"üìã"})]})]}),e.jsxs("div",{className:"webhook-actions",children:[e.jsxs("button",{className:"action-btn test-btn",onClick:()=>a.testWebhook(s.id),title:"Test mesaj\\u0131 g\\u00f6nder",children:["üß™"," Test"]}),e.jsxs("button",{className:"action-btn logs-btn",onClick:()=>a.fetchWebhookLogs(s.id),title:"Loglar\\u0131 g\\u00f6r\\u00fcnt\\u00fcle",children:["üìä"," Loglar"]}),e.jsx("button",{className:"action-btn edit-btn",onClick:()=>a.setEditingWebhook(s.id),title:"D\\u00fczenle",children:"‚úèÔ∏è"}),e.jsx("button",{className:"action-btn regenerate-btn",onClick:()=>a.regenerateToken(s.id),title:"Token yenile",children:"üîÑ"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>a.deleteWebhook(s.id),title:"Sil",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"webhook-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Toplam \\u00c7a\\u011fr\\u0131:"}),e.jsx("span",{className:"stat-value",children:s.total_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba\\u015far\\u0131l\\u0131:"}),e.jsx("span",{className:"stat-value success",children:s.successful_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba\\u015far\\u0131s\\u0131z:"}),e.jsx("span",{className:"stat-value error",children:s.failed_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Son \\u00c7a\\u011fr\\u0131:"}),e.jsx("span",{className:"stat-value",children:s.last_call?new Date(s.last_call).toLocaleString("tr-TR"):"Hi√ß"})]})]})]})},s.id))}):!a.creating&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîó"}),e.jsx("h3",{children:"Hen\\u00fcz webhook yok"}),e.jsx("p",{children:"D\\u0131\\u015f uygulamalardan mesaj g\\u00f6ndermek i\\u00e7in webhook olu\\u015fturun"})]}),a.viewingLogs&&e.jsx("div",{className:"logs-modal",onClick:()=>a.setViewingLogs(null),children:e.jsxs("div",{className:"logs-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h3",{children:["üìä"," Webhook Loglar\\u0131"]}),e.jsx("button",{className:"close-btn",onClick:()=>a.setViewingLogs(null),children:"\\u00d7"})]}),e.jsx("div",{className:"logs-list",children:a.logs.length>0?a.logs.map((s,c)=>e.jsxs("div",{className:`log-item ${s.status}`,children:[e.jsx("div",{className:"log-time",children:new Date(s.timestamp).toLocaleString("tr-TR")}),e.jsxs("div",{className:"log-status",children:[s.status==="success"?"‚úÖ":"‚ùå"," ",s.status]}),e.jsx("div",{className:"log-message",children:s.message}),s.error&&e.jsxs("div",{className:"log-error",children:["Hata: ",s.error]})]},c)):e.jsx("p",{className:"empty-state",children:"Hen\\u00fcz log kayd\\u0131 yok"})})]})})]})]})})};export{G as default};
