import{r,n as s}from"./react-core-Cj7FUMmY.js";import{br as S,ad as F,h as M,Z as Q,aX as x,a as L,g as K}from"./icons-vendor-Mc8int3h.js";import"./editor-vendor-D9c4a6XZ.js";function z({apiBaseUrl:n,fetchWithAuth:l}){const[k,u]=r.useState([]),[m,p]=r.useState([]),[c,N]=r.useState([]),[i,$]=r.useState(""),[E,d]=r.useState(!1),[g,v]=r.useState(""),[f,y]=r.useState("#5865f2"),[_,b]=r.useState(!1),[T,o]=r.useState(""),O=["#5865f2","#43b581","#f04747","#faa61a","#9b59b6","#3498db","#e91e63","#00bcd4","#ff9800","#4caf50"];r.useEffect(()=>{h(),P()},[]);const h=async()=>{b(!0);try{const e=await l(`${n}/messages/readlater/list/`);if(e.ok){const t=await e.json();u(t.bookmarks||[])}}catch(e){o("Failed to load bookmarks: "+e.message)}finally{b(!1)}},P=async()=>{try{const e=await l(`${n}/bookmarks/tags/list/`);if(e.ok){const t=await e.json();p(t.tags||[])}}catch{}},C=async()=>{if(!g.trim()){o("Tag name cannot be empty");return}try{const e=await l(`${n}/bookmarks/tags/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g,color:f})});if(e.ok){const t=await e.json();p([...m,t.tag]),v(""),y("#5865f2"),d(!1),o("")}else{const t=await e.json();o(t.error||"Failed to create tag")}}catch(e){o("Network error: "+e.message)}},J=async e=>{try{(await l(`${n}/messages/readlater/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(u(k.filter(a=>a.message_id!==e)),o(""))}catch(t){o("Failed to remove bookmark: "+t.message)}},R=async(e,t)=>{try{(await l(`${n}/bookmarks/tags/${t}/add/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(h(),o(""))}catch(a){o("Failed to add tag: "+a.message)}},D=async(e,t)=>{try{(await l(`${n}/bookmarks/tags/${t}/remove/`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(h(),o(""))}catch(a){o("Failed to remove tag: "+a.message)}},B=e=>{c.includes(e)?N(c.filter(t=>t!==e)):N([...c,e])},w=k.filter(e=>{const t=i===""||e.content.toLowerCase().includes(i.toLowerCase())||e.author.toLowerCase().includes(i.toLowerCase()),a=c.length===0||e.tags?.some(j=>c.includes(j.id));return t&&a});return s.jsxs("div",{className:"readlater-panel",children:[s.jsxs("div",{className:"readlater-header",children:[s.jsxs("h2",{children:[s.jsx(S,{})," Read Later"]}),s.jsxs("button",{className:"create-tag-btn",onClick:()=>d(!0),children:[s.jsx(F,{})," New Tag"]})]}),T&&s.jsx("div",{className:"rl-error",children:T}),s.jsxs("div",{className:"readlater-controls",children:[s.jsxs("div",{className:"search-box",children:[s.jsx(M,{className:"search-icon"}),s.jsx("input",{type:"text",placeholder:"Search bookmarks...",value:i,onChange:e=>$(e.target.value),className:"search-input"})]}),s.jsxs("div",{className:"tag-filters",children:[s.jsx(Q,{className:"filter-icon"}),s.jsx("div",{className:"tag-filter-list",children:m.map(e=>s.jsxs("button",{className:`tag-filter ${c.includes(e.id)?"active":""}`,style:{borderColor:e.color},onClick:()=>B(e.id),children:[s.jsx(x,{style:{color:e.color}}),e.name]},e.id))})]})]}),s.jsx("div",{className:"bookmarks-list",children:_?s.jsx("div",{className:"rl-loading",children:"Loading bookmarks..."}):w.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx(S,{className:"empty-icon"}),s.jsx("p",{children:"No bookmarks found"}),s.jsx("span",{children:"Save messages with the bookmark button to read them later"})]}):w.map((e,t)=>s.jsxs("div",{className:"bookmark-item",children:[s.jsxs("div",{className:"bookmark-header",children:[s.jsxs("div",{className:"bookmark-author",children:[s.jsx("img",{src:e.author_avatar||"/default-avatar.png",alt:e.author,className:"author-avatar"}),s.jsx("span",{className:"author-name",children:e.author})]}),s.jsx("div",{className:"bookmark-date",children:new Date(e.saved_at).toLocaleDateString()})]}),s.jsx("div",{className:"bookmark-content",children:e.content}),s.jsxs("div",{className:"bookmark-footer",children:[s.jsxs("div",{className:"bookmark-tags",children:[e.tags?.map(a=>s.jsxs("span",{className:"bookmark-tag",style:{borderColor:a.color,color:a.color},children:[s.jsx(x,{}),a.name,s.jsx(L,{className:"remove-tag-icon",onClick:()=>D(e.message_id,a.id)})]},a.id)),s.jsxs("select",{className:"add-tag-select",onChange:a=>{a.target.value&&(R(e.message_id,parseInt(a.target.value)),a.target.value="")},children:[s.jsx("option",{value:"",children:"+ Add Tag"}),m.filter(a=>!e.tags?.find(j=>j.id===a.id)).map(a=>s.jsx("option",{value:a.id,children:a.name},a.id))]})]}),s.jsxs("button",{className:"remove-bookmark-btn",onClick:()=>J(e.message_id),children:[s.jsx(K,{})," Remove"]})]})]},t))}),E&&s.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h3",{children:[s.jsx(x,{})," Create New Tag"]}),s.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:s.jsx(L,{})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Tag Name"}),s.jsx("input",{type:"text",className:"tag-input",placeholder:"Enter tag name...",value:g,onChange:e=>v(e.target.value),onKeyPress:e=>e.key==="Enter"&&C()})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Tag Color"}),s.jsx("div",{className:"color-picker",children:O.map(e=>s.jsx("button",{className:`color-option ${f===e?"selected":""}`,style:{backgroundColor:e},onClick:()=>y(e)},e))})]}),s.jsxs("button",{className:"create-tag-submit",onClick:C,children:[s.jsx(F,{})," Create Tag"]})]})]})})]})}export{z as default};
