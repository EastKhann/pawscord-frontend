import{r as n,n as s}from"./react-core-Cj7FUMmY.js";import{S as I,cK as ss,ao as as,a as es,u as f,a4 as cs,aF as V,E as T,aK as is,br as ls,bz as ns,a9 as ts,l as rs,b9 as ds,ba as os,c3 as hs}from"./icons-vendor-DnRG7SaF.js";import{t as w}from"./index-DcErrD_T.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const ks=({serverId:t,apiBaseUrl:o,onClose:N})=>{const[i,K]=n.useState("7d"),[O,$]=n.useState(!0),[S,A]=n.useState(!1),[r,P]=n.useState({total_members:0,active_members:0,messages_count:0,voice_minutes:0,member_growth:0,message_growth:0}),[u,z]=n.useState([]),[p,H]=n.useState([]),[j,q]=n.useState([]),[g,J]=n.useState([]),[x,Y]=n.useState([]),[k,Q]=n.useState([]),[_,W]=n.useState([]),[R,X]=n.useState([]);n.useEffect(()=>{F()},[t,i]);const F=async()=>{$(!0);try{const e={Authorization:`Bearer ${localStorage.getItem("access_token")}`},[c,l,m,d,v,M,L,D,G]=await Promise.all([fetch(`${o}/analytics/${t}/overview/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/member-activity/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/message-activity/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/top-channels/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/top-members/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/geo/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/reactions/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/link-clicks/?range=${i}`,{headers:e}),fetch(`${o}/analytics/${t}/peak-hours/?range=${i}`,{headers:e})]);c.ok&&P(await c.json()),l.ok&&z((await l.json()).data||[]),m.ok&&H((await m.json()).data||[]),d.ok&&q((await d.json()).channels||[]),v.ok&&J((await v.json()).members||[]),M.ok&&Y((await M.json()).data||[]),L.ok&&Q((await L.json()).reactions||[]),D.ok&&W((await D.json()).links||[]),G.ok&&X((await G.json()).hours||[])}catch{w.error("âŒ Analitik verileri yÃ¼klenemedi")}finally{$(!1)}},Z=async()=>{A(!0),await F(),A(!1),w.success("ðŸ”„ Veriler gÃ¼ncellendi")},U=()=>{const a={exported_at:new Date().toISOString(),time_range:i,overview:r,memberActivity:u,messageActivity:p,topChannels:j,topMembers:g,geoData:x,reactionStats:k},e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=URL.createObjectURL(e),l=document.createElement("a");l.href=c,l.download=`analytics_${t}_${i}.json`,l.click(),URL.revokeObjectURL(c),w.success("ðŸ“¥ Analitik verileri indirildi")},h=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString(),C=a=>a>0?{icon:ds,color:"#23a559",text:`+${a}%`}:a<0?{icon:os,color:"#da373c",text:`${a}%`}:{icon:hs,color:"#72767d",text:"0%"},E=(a,e="#5865f2",c=60)=>{if(!a||a.length===0)return null;const l=Math.max(...a.map(d=>d.value)),m=100/a.length;return s.jsx("div",{className:"simple-chart",style:{height:c},children:a.map((d,v)=>s.jsx("div",{className:"chart-bar",style:{width:`${m}%`,height:`${d.value/l*100}%`,background:e},title:`${d.label}: ${d.value}`},v))})},B=()=>{const a=Array(24).fill(0).map((c,l)=>{const m=R.find(d=>d.hour===l);return{hour:l,value:m?.value||0}}),e=Math.max(...a.map(c=>c.value));return s.jsx("div",{className:"peak-hours-chart",children:a.map((c,l)=>s.jsx("div",{className:"hour-bar",style:{height:`${e>0?c.value/e*100:0}%`,background:c.value>e*.8?"#23a559":c.value>e*.5?"#5865f2":"#3f4147"},title:`${c.hour}:00 - ${c.value} mesaj`,children:s.jsx("span",{className:"hour-label",children:c.hour})},l))})};if(O)return s.jsx("div",{className:"analytics-overlay",onClick:N,children:s.jsx("div",{className:"analytics-panel",onClick:a=>a.stopPropagation(),children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Analitik verileri yÃ¼kleniyor..."})]})})});const y=C(r.member_growth),b=C(r.message_growth);return s.jsx("div",{className:"analytics-overlay",onClick:N,children:s.jsxs("div",{className:"analytics-panel",onClick:a=>a.stopPropagation(),children:[s.jsxs("div",{className:"analytics-header",children:[s.jsxs("h2",{children:[s.jsx(I,{})," GeliÅŸmiÅŸ Analitik"]}),s.jsxs("div",{className:"header-controls",children:[s.jsx("div",{className:"time-range-selector",children:["24h","7d","30d","90d"].map(a=>s.jsx("button",{className:`range-btn ${i===a?"active":""}`,onClick:()=>K(a),children:a==="24h"?"24 Saat":a==="7d"?"7 GÃ¼n":a==="30d"?"30 GÃ¼n":"90 GÃ¼n"},a))}),s.jsx("button",{className:"action-btn",onClick:Z,disabled:S,children:s.jsx(ss,{className:S?"spinning":""})}),s.jsx("button",{className:"action-btn",onClick:U,children:s.jsx(as,{})})]}),s.jsx("button",{className:"close-btn",onClick:N,children:s.jsx(es,{})})]}),s.jsxs("div",{className:"analytics-content",children:[s.jsxs("div",{className:"overview-section",children:[s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:"card-icon members",children:s.jsx(f,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:h(r.total_members)}),s.jsx("span",{className:"card-label",children:"Toplam Ãœye"}),s.jsxs("span",{className:"card-growth",style:{color:y.color},children:[s.jsx(y.icon,{})," ",y.text]})]})]}),s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:"card-icon active",children:s.jsx(cs,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:h(r.active_members)}),s.jsx("span",{className:"card-label",children:"Aktif Ãœye"}),s.jsxs("span",{className:"card-detail",children:[(r.active_members/r.total_members*100||0).toFixed(1),"% aktiflik"]})]})]}),s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:"card-icon messages",children:s.jsx(V,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:h(r.messages_count)}),s.jsx("span",{className:"card-label",children:"Mesaj"}),s.jsxs("span",{className:"card-growth",style:{color:b.color},children:[s.jsx(b.icon,{})," ",b.text]})]})]}),s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:"card-icon voice",children:s.jsx(T,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:h(r.voice_minutes)}),s.jsx("span",{className:"card-label",children:"Sesli Dakika"}),s.jsxs("span",{className:"card-detail",children:[Math.round(r.voice_minutes/60)," saat"]})]})]})]}),s.jsxs("div",{className:"charts-grid",children:[s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(f,{})," Ãœye Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:u.length>0?E(u,"#5865f2",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(V,{})," Mesaj Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:p.length>0?E(p,"#23a559",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card wide",children:[s.jsxs("div",{className:"chart-header",children:[s.jsxs("h3",{children:[s.jsx(T,{})," YoÄŸunluk Saatleri"]}),s.jsxs("span",{className:"chart-info",children:[s.jsx(is,{})," En yoÄŸun saatler yeÅŸil ile gÃ¶sterilir"]})]}),s.jsx("div",{className:"chart-body",children:R.length>0?B():s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]}),s.jsxs("div",{className:"lists-grid",children:[s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ls,{})," En Aktif Kanallar"]})}),s.jsx("div",{className:"list-body",children:j.length>0?j.map((a,e)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:e+1}),s.jsxs("span",{className:"name",children:["# ",a.name]}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar",style:{width:`${a.messages/j[0].messages*100}%`}})}),s.jsx("span",{className:"value",children:h(a.messages)})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(f,{})," En Aktif Ãœyeler"]})}),s.jsx("div",{className:"list-body",children:g.length>0?g.map((a,e)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:e+1}),s.jsx("img",{src:a.avatar||"/default-avatar.png",alt:a.username,className:"avatar"}),s.jsx("span",{className:"name",children:a.username}),s.jsxs("span",{className:"value",children:[h(a.messages)," mesaj"]})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ns,{})," En Ã‡ok KullanÄ±lan Reaksiyonlar"]})}),s.jsx("div",{className:"list-body",children:k.length>0?s.jsx("div",{className:"reactions-grid",children:k.map((a,e)=>s.jsxs("div",{className:"reaction-item",children:[s.jsx("span",{className:"emoji",children:a.emoji}),s.jsx("span",{className:"count",children:h(a.count)})]},e))}):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ts,{})," CoÄŸrafi DaÄŸÄ±lÄ±m"]})}),s.jsx("div",{className:"list-body",children:x.length>0?x.map((a,e)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"flag",children:a.flag||"ðŸŒ"}),s.jsx("span",{className:"name",children:a.country}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar geo",style:{width:`${a.count/x[0].count*100}%`}})}),s.jsxs("span",{className:"value",children:[a.percentage,"%"]})]},e)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]}),_.length>0&&s.jsxs("div",{className:"links-section",children:[s.jsxs("h3",{children:[s.jsx(rs,{})," Link TÄ±klamalarÄ±"]}),s.jsxs("div",{className:"links-table",children:[s.jsxs("div",{className:"table-header",children:[s.jsx("span",{children:"URL"}),s.jsx("span",{children:"TÄ±klama"}),s.jsx("span",{children:"Benzersiz"})]}),_.map((a,e)=>s.jsxs("div",{className:"table-row",children:[s.jsx("span",{className:"link-url",title:a.url,children:a.url.length>50?a.url.substring(0,50)+"...":a.url}),s.jsx("span",{children:h(a.clicks)}),s.jsx("span",{children:h(a.unique_clicks)})]},e))]})]})]})]})})};export{ks as default};
