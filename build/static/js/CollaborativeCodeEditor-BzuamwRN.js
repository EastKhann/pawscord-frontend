import{r as n,n as e}from"./react-core-zXIKm1Jm.js";import{p as U,t as K,b3 as I,al as H,aJ as V,aW as W}from"./icons-vendor-BBdoVeJd.js";import{t as h}from"./index-CiRJFVVz.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const ro=({roomId:m,userId:y,username:Y,apiBaseUrl:x,fetchWithAuth:f,websocket:c,onClose:q})=>{const[d,S]=n.useState(`// Start coding...
`),[l,b]=n.useState("javascript"),[j,u]=n.useState(""),[k,v]=n.useState([]),[E,w]=n.useState(!1),[R,C]=n.useState(!1),_=n.useRef(null),g=n.useRef(null),p=n.useRef(new Map);n.useEffect(()=>(L(),B(),F(),()=>{P()}),[]);const L=async()=>{try{setMonacoLoaded(!1),console.log("✅ [CodeEditor] Using textarea fallback (monaco-editor not installed)")}catch(o){console.error("❌ [CodeEditor] Editor init error:",o)}},B=()=>{c&&c.addEventListener("message",o=>{const t=JSON.parse(o.data);switch(t.type){case"code_update":D(t);break;case"cursor_update":O(t);break;case"collaborator_joined":$(t);break;case"collaborator_left":z(t);break}})},D=o=>{if(o.user_id===y)return;const t=window.monacoEditor;t&&t.setValue(o.code)},O=o=>{if(o.user_id===y)return;const t=window.monacoEditor,s=g.current;if(!t||!s)return;const a=p.current.get(o.user_id);a&&t.deltaDecorations(a,[]);const i=t.deltaDecorations([],[{range:new s.Range(o.position.lineNumber,o.position.column,o.position.lineNumber,o.position.column),options:{className:`remote-cursor remote-cursor-${o.user_id}`,hoverMessage:{value:`**${o.username}**`}}}]);p.current.set(o.user_id,i)},$=o=>{v(t=>[...t,{id:o.user_id,username:o.username,color:o.color||"#5865f2"}])},z=o=>{v(s=>s.filter(a=>a.id!==o.user_id));const t=p.current.get(o.user_id);t&&window.monacoEditor&&window.monacoEditor.deltaDecorations(t,[]),p.current.delete(o.user_id)},F=async()=>{try{const o=await f(`${x}/code-editor/load/?room_id=${m}`);if(o.ok){const t=await o.json();t.code&&(S(t.code),b(t.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(t.code),window.monacoEditor.setLanguage(t.language||"javascript")))}}catch(o){console.error("Failed to load code:",o)}},M=async()=>{w(!0);try{(await f(`${x}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:m,code:d,language:l})})).ok&&h.success("✅ Kod kaydedildi!")}catch(o){console.error("Save error:",o),h.error("❌ Kaydetme başarısız")}finally{w(!1)}},N=async()=>{C(!0),u("Çalıştırılıyor...");try{const o=await f(`${x}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,language:l})});if(o.ok){const t=await o.json();u(t.output||"No output")}else{const t=await o.json();u(`Error: ${t.error||"Execution failed"}`)}}catch(o){u(`Error: ${o.message}`)}finally{C(!1)}},T=()=>{navigator.clipboard.writeText(d),h.success("✅ Kod kopyalandı!")},J=()=>{const t={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"}[l]||"txt",s=new Blob([d],{type:"text/plain"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=`code.${t}`,i.click(),URL.revokeObjectURL(a)},P=()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),c&&c.close()};return e.jsxs("div",{style:r.container,children:[e.jsxs("div",{style:r.header,children:[e.jsxs("div",{style:r.headerLeft,children:[e.jsx(U,{style:r.headerIcon}),e.jsx("h2",{style:r.title,children:"Code Editor"}),e.jsxs("select",{value:l,onChange:o=>{b(o.target.value),window.monacoEditor&&g.current&&g.current.editor.setModelLanguage(window.monacoEditor.getModel(),o.target.value)},style:r.languageSelect,children:[e.jsx("option",{value:"javascript",children:"JavaScript"}),e.jsx("option",{value:"typescript",children:"TypeScript"}),e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"html",children:"HTML"}),e.jsx("option",{value:"css",children:"CSS"})]})]}),e.jsxs("div",{style:r.headerRight,children:[e.jsxs("div",{style:r.collaborators,children:[e.jsx(K,{style:{marginRight:"6px"}}),e.jsx("span",{children:k.length+1})]}),e.jsx("button",{onClick:T,style:r.actionButton,title:"Kopyala",children:e.jsx(I,{})}),e.jsx("button",{onClick:J,style:r.actionButton,title:"İndir",children:e.jsx(H,{})}),e.jsx("button",{onClick:M,disabled:E,style:{...r.actionButton,...r.saveButton},title:"Kaydet",children:e.jsx(V,{})}),e.jsx("button",{onClick:N,disabled:R,style:{...r.actionButton,...r.runButton},title:"Çalıştır",children:e.jsx(W,{})})]})]}),e.jsx("div",{style:r.editorContainer,children:e.jsx("div",{ref:_,style:r.editor})}),j&&e.jsxs("div",{style:r.outputPanel,children:[e.jsx("div",{style:r.outputHeader,children:e.jsx("span",{children:"Output"})}),e.jsx("pre",{style:r.outputContent,children:j})]})]})},r={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}};export{ro as default};
