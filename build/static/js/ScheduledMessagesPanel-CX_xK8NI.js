import{r as o}from"./react-core-B6hadH-M.js";import{t as a}from"./index-D_6pZib5.js";const S=({apiBaseUrl:d,roomSlug:u,onClose:f})=>{const[m,h]=o.useState([]),[p,E]=o.useState(!0),[g,i]=o.useState(!1),[s,r]=o.useState({content:"",scheduled_time:"",room_slug:u||""});o.useEffect(()=>{N()},[]);const N=async()=>{try{E(!0);const e=localStorage.getItem("access_token"),t=await fetch(`${d}/scheduled/list/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const c=await t.json();h(c.scheduled_messages||[])}else a.error("âŒ ZamanlanmÄ±ÅŸ mesajlar yÃ¼klenemedi")}catch(e){console.error("Fetch scheduled messages error:",e),a.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{E(!1)}},v=async()=>{if(!s.content.trim()){a.error("âŒ Mesaj iÃ§eriÄŸi boÅŸ olamaz");return}if(!s.scheduled_time){a.error("âŒ Tarih ve saat seÃ§iniz");return}if(!s.room_slug){a.error("âŒ Kanal seÃ§iniz");return}try{const e=localStorage.getItem("access_token"),t=await fetch(`${d}/scheduled/create/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.ok){const c=await t.json();h([...m,c.scheduled_message]),i(!1),r({content:"",scheduled_time:"",room_slug:u||""}),a.success("âœ… Mesaj zamanlandÄ±")}else{const c=await t.json();a.error(`âŒ ${c.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z"}`)}}catch(e){console.error("Create scheduled message error:",e),a.error("âŒ BaÄŸlantÄ± hatasÄ±")}},k=async e=>{if(confirm("Bu zamanlanmÄ±ÅŸ mesajÄ± iptal etmek istediÄŸinize emin misiniz?"))try{const t=localStorage.getItem("access_token");(await fetch(`${d}/scheduled/cancel/${e}/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(h(m.filter(n=>n.id!==e)),a.success("âœ… ZamanlanmÄ±ÅŸ mesaj iptal edildi")):a.error("âŒ Ä°ptal baÅŸarÄ±sÄ±z")}catch(t){console.error("Cancel scheduled message error:",t),a.error("âŒ BaÄŸlantÄ± hatasÄ±")}},w=e=>{const t=new Date,n=new Date(e)-t;if(n<0)return"GÃ¶nderildi";const l=Math.floor(n/(1e3*60*60)),R=Math.floor(n%(1e3*60*60)/(1e3*60));return l>24?`${Math.floor(l/24)} gÃ¼n ${l%24} saat`:l>0?`${l} saat ${R} dakika`:`${R} dakika`},y=e=>new Date(e).toLocaleString("tr-TR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),b=e=>{const t=new Date,n=new Date(e)-t;return n<0?"status-sent":n<36e5?"status-imminent":n<864e5?"status-soon":"status-scheduled"},M=()=>{const e=new Date;return e.setMinutes(e.getMinutes()+1),e.toISOString().slice(0,16)};return React.createElement("div",{className:"scheduled-messages-overlay",onClick:f},React.createElement("div",{className:"scheduled-messages-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"scheduled-messages-header"},React.createElement("h2",null,"â° ZamanlanmÄ±ÅŸ Mesajlar"),React.createElement("div",{className:"header-actions"},React.createElement("button",{className:"create-btn",onClick:()=>i(!g)},g?"âœ• Ä°ptal":"+ Yeni Mesaj"),React.createElement("button",{className:"close-btn",onClick:f},"âœ•"))),g&&React.createElement("div",{className:"create-form"},React.createElement("h3",null,"ğŸ“ Yeni ZamanlanmÄ±ÅŸ Mesaj"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Mesaj Ä°Ã§eriÄŸi"),React.createElement("textarea",{className:"message-textarea",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:s.content,onChange:e=>r({...s,content:e.target.value}),rows:4})),React.createElement("div",{className:"form-row"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Kanal"),React.createElement("input",{type:"text",className:"form-input",placeholder:"room-slug",value:s.room_slug,onChange:e=>r({...s,room_slug:e.target.value})})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"GÃ¶nderim ZamanÄ±"),React.createElement("input",{type:"datetime-local",className:"form-input",value:s.scheduled_time,min:M(),onChange:e=>r({...s,scheduled_time:e.target.value})}))),React.createElement("div",{className:"form-actions"},React.createElement("button",{className:"cancel-form-btn",onClick:()=>{i(!1),r({content:"",scheduled_time:"",room_slug:u||""})}},"Ä°ptal"),React.createElement("button",{className:"submit-btn",onClick:v},"â° Zamanla"))),React.createElement("div",{className:"scheduled-messages-content"},p?React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"YÃ¼kleniyor...")):m.length===0?React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-icon"},"â°"),React.createElement("h3",null,"ZamanlanmÄ±ÅŸ mesaj yok"),React.createElement("p",null,"Gelecekte gÃ¶nderilmek Ã¼zere mesaj zamanlamadÄ±nÄ±z"),React.createElement("button",{className:"create-first-btn",onClick:()=>i(!0)},"+ Ä°lk MesajÄ± Zamanla")):React.createElement("div",{className:"messages-list"},m.map(e=>React.createElement("div",{key:e.id,className:`scheduled-message-card ${b(e.scheduled_time)}`},React.createElement("div",{className:"message-header"},React.createElement("div",{className:"message-info"},React.createElement("span",{className:"room-badge"},"# ",e.room_slug),React.createElement("span",{className:"time-badge"},y(e.scheduled_time))),React.createElement("button",{className:"cancel-btn",onClick:()=>k(e.id),title:"Ä°ptal Et"},"ğŸ—‘ï¸")),React.createElement("div",{className:"message-content"},e.content),React.createElement("div",{className:"message-footer"},React.createElement("div",{className:"countdown"},React.createElement("span",{className:"countdown-icon"},"â³"),React.createElement("span",{className:"countdown-text"},w(e.scheduled_time))),e.sent&&React.createElement("div",{className:"sent-badge"},"âœ… GÃ¶nderildi"))))))))};export{S as default};
