import{r as n}from"./react-core-B6hadH-M.js";import{t as r}from"./index-D_6pZib5.js";const x=({serverId:p,apiBaseUrl:s,onClose:R})=>{const[E,y]=n.useState([]),[i,g]=n.useState(null),[m,h]=n.useState([]),[o,u]=n.useState(null),[P,_]=n.useState(!0),[b,C]=n.useState(!1),[S,f]=n.useState(!1),[l,k]=n.useState({title:"",content:"",tags:[]}),[v,w]=n.useState("");n.useEffect(()=>{z()},[p]),n.useEffect(()=>{i&&F(i.id)},[i]);const z=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${s}/servers/${p}/forums/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const a=await t.json();y(Array.isArray(a)?a:a.forums||[])}}catch(e){console.error("Forum fetch error:",e)}finally{_(!1)}},F=async e=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/forums/${e}/posts/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const c=await a.json();h(Array.isArray(c)?c:c.posts||[])}}catch(t){console.error("Posts fetch error:",t)}},$=async()=>{const e=prompt("Forum kanalÄ± adÄ±:");if(e)try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/servers/${p}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(a.ok){const c=await a.json();y([...E,c.forum]),r.success("âœ… Forum oluÅŸturuldu!")}else r.error("âŒ Forum oluÅŸturulamadÄ±")}catch(t){console.error("Forum creation error:",t),r.error("âŒ Hata oluÅŸtu")}},A=async()=>{if(!l.title.trim()||!l.content.trim()){r.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}C(!0);try{const e=localStorage.getItem("access_token"),t=await fetch(`${s}/forums/${i.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(t.ok){const a=await t.json();h([a.post,...m]),k({title:"",content:"",tags:[]}),f(!1),r.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else r.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch(e){console.error("Post creation error:",e),r.error("âŒ Hata oluÅŸtu")}finally{C(!1)}},T=async e=>{if(!v.trim()){r.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const t=localStorage.getItem("access_token"),a=await fetch(`${s}/forums/posts/${e}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({content:v})});if(a.ok){const c=await a.json();u({...o,replies:[...o.replies||[],c.reply]}),w(""),r.success("âœ… YanÄ±t gÃ¶nderildi!")}else r.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch(t){console.error("Reply error:",t),r.error("âŒ Hata oluÅŸtu")}},d=async(e,t)=>{try{const a=localStorage.getItem("access_token"),c=await fetch(`${s}/forums/posts/${e}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:t})});if(c.ok){const O=await c.json();h(m.map(N=>N.id===e?{...N,votes:O.votes}:N)),r.success(t==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch(a){console.error("Vote error:",a)}},j=async(e,t)=>{try{const a=localStorage.getItem("access_token");(await fetch(`${s}/forums/posts/${e}/solve/${t}/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(r.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),u({...o,solution_id:t}))}catch(a){console.error("Mark solution error:",a)}};return P?React.createElement("div",{className:"forum-panel-overlay",onClick:R},React.createElement("div",{className:"forum-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"forum-loading"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"YÃ¼kleniyor...")))):React.createElement("div",{className:"forum-panel-overlay",onClick:R},React.createElement("div",{className:"forum-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"forum-header"},React.createElement("h2",null,"ğŸ’¬ Forum"),React.createElement("button",{className:"close-btn",onClick:R},"âœ•")),i?o?React.createElement("div",{className:"post-detail"},React.createElement("div",{className:"detail-header"},React.createElement("button",{className:"back-btn",onClick:()=>u(null)},"â† Geri")),React.createElement("div",{className:"post-main"},React.createElement("div",{className:"post-votes-vertical"},React.createElement("button",{onClick:()=>d(o.id,"up")},"ğŸ‘"),React.createElement("span",null,o.votes||0),React.createElement("button",{onClick:()=>d(o.id,"down")},"ğŸ‘")),React.createElement("div",{className:"post-body"},React.createElement("h2",null,o.title),React.createElement("p",{className:"post-meta"},"ğŸ‘¤ ",o.author," â€¢ â° ",new Date(o.created_at).toLocaleString("tr-TR")),React.createElement("div",{className:"post-text"},o.content))),React.createElement("div",{className:"replies-section"},React.createElement("h3",null,"ğŸ’¬ YanÄ±tlar (",o.replies?.length||0,")"),(o.replies||[]).map(e=>React.createElement("div",{key:e.id,className:`reply-item ${e.id===o.solution_id?"solution":""}`},React.createElement("div",{className:"reply-header"},React.createElement("span",{className:"reply-author"},"ğŸ‘¤ ",e.author),React.createElement("span",{className:"reply-time"},new Date(e.created_at).toLocaleString("tr-TR")),e.id===o.solution_id&&React.createElement("span",{className:"solution-badge"},"âœ… Ã‡Ã¶zÃ¼m")),React.createElement("div",{className:"reply-content"},e.content),!o.solution_id&&React.createElement("button",{className:"mark-solution-btn",onClick:()=>j(o.id,e.id)},"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"))),React.createElement("div",{className:"reply-form"},React.createElement("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:v,onChange:e=>w(e.target.value),rows:4}),React.createElement("button",{className:"reply-submit-btn",onClick:()=>T(o.id)},"ğŸ“¤ YanÄ±tla")))):React.createElement("div",{className:"posts-view"},React.createElement("div",{className:"posts-header"},React.createElement("button",{className:"back-btn",onClick:()=>g(null)},"â† Geri"),React.createElement("h3",null,"# ",i.name),React.createElement("button",{className:"new-post-btn",onClick:()=>f(!S)},"â• Yeni GÃ¶nderi")),S&&React.createElement("div",{className:"create-post-form"},React.createElement("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:l.title,onChange:e=>k({...l,title:e.target.value}),maxLength:200}),React.createElement("textarea",{placeholder:"Ä°Ã§erik...",value:l.content,onChange:e=>k({...l,content:e.target.value}),rows:6}),React.createElement("div",{className:"form-actions"},React.createElement("button",{className:"submit-btn",onClick:A,disabled:b},b?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"),React.createElement("button",{className:"cancel-btn",onClick:()=>f(!1)},"Ä°ptal"))),React.createElement("div",{className:"posts-list"},m.map(e=>React.createElement("div",{key:e.id,className:"post-item",onClick:()=>u(e)},React.createElement("div",{className:"post-votes"},React.createElement("button",{onClick:t=>{t.stopPropagation(),d(e.id,"up")}},"ğŸ‘"),React.createElement("span",null,e.votes||0),React.createElement("button",{onClick:t=>{t.stopPropagation(),d(e.id,"down")}},"ğŸ‘")),React.createElement("div",{className:"post-content"},React.createElement("h4",null,e.title),React.createElement("p",{className:"post-meta"},"ğŸ‘¤ ",e.author," â€¢ â° ",new Date(e.created_at).toLocaleDateString("tr-TR"),e.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"),React.createElement("p",{className:"post-preview"},e.content?.substring(0,150),"..."),React.createElement("div",{className:"post-stats"},"ğŸ’¬ ",e.replies_count||0," yanÄ±t")))),m.length===0&&React.createElement("div",{className:"no-posts"},React.createElement("p",null,"ğŸ“­ HenÃ¼z gÃ¶nderi yok")))):React.createElement("div",{className:"forum-list"},React.createElement("div",{className:"forum-list-header"},React.createElement("h3",null,"Forum KanallarÄ±"),React.createElement("button",{className:"create-forum-btn",onClick:$},"â• Yeni Forum")),E.length>0?React.createElement("div",{className:"forums-grid"},E.map(e=>React.createElement("div",{key:e.id,className:"forum-card",onClick:()=>g(e)},React.createElement("div",{className:"forum-icon"},"ğŸ’¬"),React.createElement("h4",null,e.name),React.createElement("p",{className:"forum-stats"},e.posts_count||0," gÃ¶nderi â€¢ ",e.members_count||0," Ã¼ye")))):React.createElement("div",{className:"no-forums"},React.createElement("p",null,"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"),React.createElement("button",{onClick:$},"Ä°lk forumu oluÅŸtur")))))};export{x as default};
