var z=Object.defineProperty;var t=(k,y)=>z(k,"name",{value:y,configurable:!0});import{r as p,j as a}from"./react-core-Djgtqrmb.js";import{a3 as O,C as P,_ as D,h as M}from"./icons-vendor-BW7dxHkX.js";import{C as T,G as L,d as q,i as f,t as F,A as N}from"./index-CjRzheBN.js";import{u as B}from"./recaptcha-D67gYgdo.js";import{j as w}from"./crypto-vendor-D1XRGppi.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./ui-vendor-IhB9Znpc.js";const X=t(({onLogin:k,onRegister:y,error:b,setAuthError:o})=>{const[m,v]=p.useState(!0),[c,S]=p.useState({username:"",email:"",password:""}),[I,_]=p.useState(!1),{getToken:G}=B();p.useEffect(()=>{if(T.isNativePlatform())try{L.initialize({clientId:q,scopes:["profile","email"],grantOfflineAccess:!0})}catch{}},[]),p.useEffect(()=>{if(f&&window.require){const{ipcRenderer:e}=window.require("electron"),r=t((x,d)=>{try{const{access:n,refresh:i}=d;if(n&&i){const u=w(n);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",i),localStorage.setItem("chat_username",u.username),setTimeout(()=>window.location.reload(),500)}}catch{o("Token işleme hatası.")}},"handleAuthSuccess"),s=t((x,d)=>{o(d.error||"Google girişi başarısız.")},"handleAuthError"),g=t((x,d)=>{try{const{access:n,refresh:i}=d;if(n&&i){const u=w(n);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",i),localStorage.setItem("chat_username",u.username),setTimeout(()=>window.location.reload(),500)}}catch{o("Token işleme hatası.")}},"handleOAuthTokens"),l=t((x,d)=>{try{const n=new URL(d),i=new URLSearchParams(n.search),u=i.get("access"),h=i.get("refresh");if(u&&h){const j=w(u);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",u),localStorage.setItem("refresh_token",h),localStorage.setItem("chat_username",j.username),window.location.reload()}}catch{try{if(d.includes("access=")&&d.includes("refresh=")){const i=d.split("access=");if(i.length>1){const u=i[1].split("&")[0],h=d.split("refresh=");if(h.length>1){const j=h[1],U=w(u);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",u),localStorage.setItem("refresh_token",j),localStorage.setItem("chat_username",U.username),window.location.reload()}else o("Giriş verisi okunamadı.")}else o("Giriş verisi okunamadı.")}else o("Giriş verisi okunamadı.")}catch{o("Giriş işlemi başarısız.")}}},"handleDeepLink");return e.on("google-auth-success",r),e.on("google-auth-error",s),e.on("deep-link-auth",l),e.on("oauth-tokens",g),()=>{e.removeListener("google-auth-success",r),e.removeListener("google-auth-error",s),e.removeListener("deep-link-auth",l),e.removeListener("oauth-tokens",g)}}},[o]),p.useEffect(()=>{if(!f){const e=new URLSearchParams(window.location.search),r=e.get("access"),s=e.get("refresh"),g=e.get("error");if(g){o(decodeURIComponent(g)),window.history.replaceState({},document.title,"/");return}if(r&&s)try{const l=w(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",s),localStorage.setItem("chat_username",l.username),window.history.replaceState({},document.title,"/"),window.location.reload()}catch{o("Tarayıcı depolama hatası. Lütfen gizli modda değilseniz kontrol edin.")}}},[]);const C=t(async()=>{try{if(T.isNativePlatform()){const e=await L.signIn(),r=`${N}/auth/google/native/`,s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})}),g=s.headers.get("content-type");if(!g||!g.includes("application/json")){const x=await s.text();o("Backend hatası: JSON yerine HTML yanıtı alındı. Sunucu ayarlarını kontrol edin.");return}const l=await s.json();s.ok?l.access&&l.refresh?(localStorage.setItem("access_token",l.access),localStorage.setItem("refresh_token",l.refresh),window.location.reload()):o("Token bilgileri eksik."):o(l.error||"Google girişi başarısız.")}else{const s=`${f?"https://api.pawscord.com/api":N}/auth/google/start/?source=${f?"electron":"web"}`;if(f&&window.require){const{ipcRenderer:g}=window.require("electron");g.send("start-google-login",s)}else window.location.href=s}}catch(e){o("Google girişi sırasında bir hata oluştu: "+e.message)}},"handleGoogleLogin"),R=t(async e=>{e.preventDefault(),_(!0),o("");try{const r=await G(m?"login":"register");m?await k(c.username,c.password,r):await y(c.username,c.email,c.password,r)&&(F.success("Kayıt başarılı! Lütfen e-postanı kontrol et.",4e3),v(!0))}catch{o("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.")}finally{_(!1)}},"handleSubmit");return a.jsxs("div",{className:"login-container",children:[a.jsx("div",{className:"background-animate"}),a.jsxs("div",{className:"login-card",children:[a.jsxs("div",{className:"logo-header",children:[a.jsx("div",{className:"logo-circle",children:a.jsx(O,{size:40,color:"white"})}),a.jsx("h1",{children:"Pawscord"}),a.jsx("p",{children:m?"Tekrar hoşgeldin!":"Aramıza katıl!"})]}),b&&a.jsx("div",{className:"error-message",children:b}),a.jsxs("form",{onSubmit:R,children:[a.jsxs("div",{className:"input-group",children:[a.jsx(P,{className:"input-icon"}),a.jsx("input",{type:"text",placeholder:"Kullanıcı Adı",value:c.username,onChange:t(e=>S({...c,username:e.target.value}),"onChange"),required:!0})]}),!m&&a.jsxs("div",{className:"input-group slide-down",children:[a.jsx(D,{className:"input-icon"}),a.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:c.email,onChange:t(e=>S({...c,email:e.target.value}),"onChange"),required:!0})]}),a.jsxs("div",{className:"input-group",children:[a.jsx(M,{className:"input-icon"}),a.jsx("input",{type:"password",placeholder:"Şifre",value:c.password,onChange:t(e=>S({...c,password:e.target.value}),"onChange"),required:!0})]}),a.jsx("button",{type:"submit",className:"submit-btn",disabled:I,children:I?a.jsx("div",{className:"spinner"}):m?"Giriş Yap":"Kayıt Ol"})]}),m&&a.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:a.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:t(e=>e.target.style.opacity="0.8","onMouseEnter"),onMouseLeave:t(e=>e.target.style.opacity="1","onMouseLeave"),children:"Şifremi Unuttum?"})}),a.jsx("div",{className:"divider",children:a.jsx("span",{children:"veya"})}),a.jsx("div",{className:"google-btn-wrapper",children:a.jsxs("button",{onClick:C,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:t(e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},"onMouseEnter"),onMouseLeave:t(e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},"onMouseLeave"),onMouseDown:t(e=>e.currentTarget.style.backgroundColor="#eff2f5","onMouseDown"),children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),a.jsx("span",{children:"Google ile Giriş Yap"})]})}),a.jsxs("div",{className:"toggle-mode",children:[m?"Hesabın yok mu? ":"Zaten üye misin? ",a.jsx("span",{role:"button",tabIndex:0,onClick:t(()=>{v(!m),o("")},"onClick"),onKeyDown:t(e=>{e.key==="Enter"&&(v(!m),o(""))},"onKeyDown"),style:{cursor:"pointer"},children:m?"Kayıt Ol":"Giriş Yap"})]})]})]})},"LoginPage");export{X as default};
