import{r as u,d as o,ax as C,S as O,ad as z,m as D}from"./react-core-DMT_QkRe.js";import{C as S,G as T,i as p,j as k,A as y,t as P}from"./index-DuRbhGVU.js";import{u as M}from"./recaptcha-BRfr3xY1.js";const A=({onLogin:I,onRegister:x,error:b,setAuthError:t})=>{const[m,G]=u.useState(!0),[i,v]=u.useState({username:"",email:"",password:""}),[E,L]=u.useState(!1),{getToken:_}=M();u.useEffect(()=>{if(S.isNativePlatform()){console.log("ğŸ“± [Google] Initializing Google Auth for mobile...");try{T.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}),console.log("âœ… [Google] Initialized successfully")}catch(e){console.error("âŒ [Google] Initialization failed:",e)}}},[]),u.useEffect(()=>{if(p&&window.require){const{ipcRenderer:e}=window.require("electron"),n=(f,l)=>{console.log("âœ… [Electron] Google auth success received");try{const{access:r,refresh:c}=l;if(r&&c){const d=k(r);console.log("ğŸ‘¤ [Electron] User:",d.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",d.username),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] Token error:",r),t("Token iÅŸleme hatasÄ±.")}},a=(f,l)=>{console.error("âŒ [Electron] Auth error:",l),t(l.error||"Google giriÅŸi baÅŸarÄ±sÄ±z.")},g=(f,l)=>{console.log("ğŸ”— [Electron] OAuth tokens received from main process");try{const{access:r,refresh:c}=l;if(r&&c){const d=k(r);console.log("ğŸ‘¤ [Electron] User from deep link:",d.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",d.username),console.log("âœ… [Electron] Tokens saved, reloading..."),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] OAuth token error:",r),t("Token iÅŸleme hatasÄ±.")}},s=(f,l)=>{console.log("ğŸš€ [DeepLink] URL YakalandÄ±:",l);try{const r=new URL(l),c=new URLSearchParams(r.search),d=c.get("access"),h=c.get("refresh");if(d&&h){console.log("âœ… [DeepLink] GiriÅŸ BaÅŸarÄ±lÄ±!");const w=k(d);console.log("ğŸ‘¤ [Electron] Decoded user from token:",w.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",d),localStorage.setItem("refresh_token",h),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(r){console.error("Deep link hatasÄ±:",r);try{if(l.includes("access=")&&l.includes("refresh=")){const c=l.split("access=");if(c.length>1){const d=c[1].split("&")[0],h=l.split("refresh=");if(h.length>1){const w=h[1],R=k(d);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",d),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",R.username),window.location.reload()}else t("GiriÅŸ verisi okunamadÄ±.")}else t("GiriÅŸ verisi okunamadÄ±.")}else t("GiriÅŸ verisi okunamadÄ±.")}catch(c){console.error("Manual parsing error:",c),t("GiriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z.")}}};return e.on("google-auth-success",n),e.on("google-auth-error",a),e.on("deep-link-auth",s),e.on("oauth-tokens",g),()=>{e.removeListener("google-auth-success",n),e.removeListener("google-auth-error",a),e.removeListener("deep-link-auth",s),e.removeListener("oauth-tokens",g)}}},[t]),u.useEffect(()=>{if(!p){const e=new URLSearchParams(window.location.search),n=e.get("access"),a=e.get("refresh"),g=e.get("error");if(g){console.error("âŒ [Web] OAuth error from URL:",g),t(decodeURIComponent(g)),window.history.replaceState({},document.title,"/");return}if(n&&a){console.log("ğŸŒ [Web] Tokenlar URL'den alÄ±ndÄ± (OAuth success)");try{const s=k(n);console.log("ğŸ‘¤ [Web] Decoded user from token:",s.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",a),localStorage.setItem("chat_username",s.username),console.log("âœ… [Web] Tokens and username saved to localStorage"),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(s){console.error("âŒ [Web] LocalStorage error:",s),t("TarayÄ±cÄ± depolama hatasÄ±. LÃ¼tfen gizli modda deÄŸilseniz kontrol edin.")}}}},[]);const N=async()=>{try{if(console.log("ğŸ”µ [Google] Login baÅŸlatÄ±lÄ±yor...",{isNative:S.isNativePlatform(),isElectron:p,apiUrl:y}),S.isNativePlatform()){console.log("ğŸ“± [Google] Mobile auth flow");const e=await T.signIn();console.log("âœ… [Google] User signed in:",e.email),console.log("ğŸ”‘ [Google] ID Token:",e.authentication.idToken);const n=`${y}/auth/google/native/`;console.log("ğŸ“¡ [Google] Sending to:",n);const a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})});console.log("ğŸ” [Google] Response status:",a.status),console.log("ğŸ” [Google] Response headers:",a.headers);const g=a.headers.get("content-type");if(console.log("ğŸ” [Google] Content-Type:",g),!g||!g.includes("application/json")){const f=await a.text();console.error("âŒ [Google] Backend HTML dÃ¶ndÃ¼:",f.substring(0,500)),t("Backend hatasÄ±: JSON yerine HTML yanÄ±tÄ± alÄ±ndÄ±. Sunucu ayarlarÄ±nÄ± kontrol edin.");return}const s=await a.json();console.log("ğŸ“¦ [Google] Backend response data:",s),a.ok?(console.log("âœ… [Google] Login successful"),s.access&&s.refresh?(localStorage.setItem("access_token",s.access),localStorage.setItem("refresh_token",s.refresh),window.location.reload()):(console.error("âŒ [Google] Tokens eksik:",s),t("Token bilgileri eksik."))):(console.error("âŒ [Google] Login failed:",s),t(s.error||"Google giriÅŸi baÅŸarÄ±sÄ±z."))}else{console.log("ğŸŒ [Google] Web/Electron redirect flow");const a=`${p?"https://api.pawscord.com/api":y}/auth/google/start/?source=${p?"electron":"web"}`;if(console.log("ğŸ”€ [Google] Redirecting to:",a),p&&window.require){const{ipcRenderer:g}=window.require("electron");console.log("âœ… [Google] Opening in Electron popup:",a),g.send("start-google-login",a)}else window.location.href=a}}catch(e){console.error("âŒ [Google] Unexpected error:",e),t("Google giriÅŸi sÄ±rasÄ±nda bir hata oluÅŸtu: "+e.message)}},U=async e=>{e.preventDefault(),L(!0),t("");try{console.log("ğŸ”µ [Login] GiriÅŸ denemesi:",{username:i.username,mode:m?"login":"register"}),console.log("ğŸ”µ [Login] API URL:",y);const n=await _(m?"login":"register");console.log("âœ… [reCAPTCHA] Token alÄ±ndÄ±:",n?"OK":"FAIL"),m?await I(i.username,i.password,n):await x(i.username,i.email,i.password,n)&&(P.success("KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ± kontrol et.",4e3),G(!0))}catch(n){console.error("âŒ [Login] Beklenmeyen hata:",n),t("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{L(!1)}};return o.createElement("div",{className:"login-container"},o.createElement("div",{className:"background-animate"}),o.createElement("div",{className:"login-card"},o.createElement("div",{className:"logo-header"},o.createElement("div",{className:"logo-circle"},o.createElement(C,{size:40,color:"white"})),o.createElement("h1",null,"Pawscord"),o.createElement("p",null,m?"Tekrar hoÅŸgeldin!":"AramÄ±za katÄ±l!")),b&&o.createElement("div",{className:"error-message"},b),o.createElement("form",{onSubmit:U},o.createElement("div",{className:"input-group"},o.createElement(O,{className:"input-icon"}),o.createElement("input",{type:"text",placeholder:"KullanÄ±cÄ± AdÄ±",value:i.username,onChange:e=>v({...i,username:e.target.value}),required:!0})),!m&&o.createElement("div",{className:"input-group slide-down"},o.createElement(z,{className:"input-icon"}),o.createElement("input",{type:"email",placeholder:"E-posta Adresi",value:i.email,onChange:e=>v({...i,email:e.target.value}),required:!0})),o.createElement("div",{className:"input-group"},o.createElement(D,{className:"input-icon"}),o.createElement("input",{type:"password",placeholder:"Åifre",value:i.password,onChange:e=>v({...i,password:e.target.value}),required:!0})),o.createElement("button",{type:"submit",className:"submit-btn",disabled:E},E?o.createElement("div",{className:"spinner"}):m?"GiriÅŸ Yap":"KayÄ±t Ol")),m&&o.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},o.createElement("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1"},"Åifremi Unuttum?")),o.createElement("div",{className:"divider"},o.createElement("span",null,"veya")),o.createElement("div",{className:"google-btn-wrapper"},o.createElement("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5"},o.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),o.createElement("span",null,"Google ile GiriÅŸ Yap"))),o.createElement("div",{className:"toggle-mode"},m?"HesabÄ±n yok mu? ":"Zaten Ã¼ye misin? ",o.createElement("span",{onClick:()=>{G(!m),t("")}},m?"KayÄ±t Ol":"GiriÅŸ Yap"))))};export{A as default};
