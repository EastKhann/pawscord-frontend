var R=Object.defineProperty;var i=(s,a)=>R(s,"name",{value:a,configurable:!0});import{r as d,j as e}from"./react-core-Djgtqrmb.js";import{bb as m,a as I,a0 as T,af as D,bL as F,E as _,D as M,u as O}from"./icons-vendor-BMXAt4pj.js";import{t as W}from"./index-DjBRFZUD.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const B={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},z=i(({roomSlug:s,ws:a,onClose:u})=>{const[y,h]=d.useState(!1),[t,n]=d.useState(!1),[o,v]=d.useState("camera"),[j,k]=d.useState(0),[C,w]=d.useState([]),[f,S]=d.useState(""),x=d.useRef(null),p=d.useRef(null),b=d.useRef({}),E=i(async r=>{if(!p.current)return;const c=new RTCPeerConnection(B);b.current[r]=c,p.current.getTracks().forEach(g=>{c.addTrack(g,p.current)}),c.onicecandidate=g=>{g.candidate&&a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"ice_candidate",candidate:g.candidate,viewer_id:r}))};const l=await c.createOffer();await c.setLocalDescription(l),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_offer",sdp:c.localDescription,viewer_id:r}))},"createPeerConnection");return d.useEffect(()=>{if(!a.current)return;const r=i(c=>{try{const l=JSON.parse(c.data);l.type==="stream_viewer_count"?k(l.count):l.type==="stream_chat"?w(g=>[...g,{id:Date.now(),user:l.username,message:l.message,timestamp:new Date().toLocaleTimeString()}]):l.type==="stream_viewer_join"&&E(l.viewerId)}catch{}},"handleMessage");return a.current.addEventListener("message",r),()=>a.current?.removeEventListener("message",r)},[a]),d.useEffect(()=>{const r=i(c=>{c.key==="Escape"&&u()},"handleEsc");return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[u]),{isStreaming:y,isMuted:t,streamType:o,setStreamType:v,viewers:j,chatMessages:C,chatInput:f,setChatInput:S,videoRef:x,startStream:i(async()=>{try{let r;o==="camera"?r=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}):r=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0}),p.current=r,x.current&&(x.current.srcObject=r),h(!0),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_start",room_slug:s,stream_type:o}))}catch{W.error("âŒ Failed to start stream. Please check permissions.")}},"startStream"),stopStream:i(()=>{p.current&&(p.current.getTracks().forEach(r=>r.stop()),p.current=null),Object.values(b.current).forEach(r=>r.close()),b.current={},x.current&&(x.current.srcObject=null),h(!1),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_stop",room_slug:s}))},"stopStream"),toggleMute:i(()=>{p.current&&(p.current.getAudioTracks().forEach(r=>{r.enabled=t}),n(!t))},"toggleMute"),sendChatMessage:i(r=>{r.preventDefault(),f.trim()&&(a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_chat",room_slug:s,message:f})),S(""))},"sendChatMessage")}},"useLiveStream"),L=i(s=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:s?"0":"20px"},modal:{width:"100%",maxWidth:s?"100%":"1400px",height:s?"100%":"auto",maxHeight:"90vh",background:"linear-gradient(135deg, rgba(30, 31, 34, 0.98), rgba(35, 36, 40, 0.98))",borderRadius:s?"0":"16px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(218, 55, 60, 0.3)",border:s?"none":"1px solid rgba(218, 55, 60, 0.4)"},header:{padding:s?"12px 16px":"16px 24px",background:"linear-gradient(135deg, rgba(218, 55, 60, 0.15), rgba(240, 71, 71, 0.15))",borderBottom:"1px solid rgba(218, 55, 60, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:s?"18px":"22px",fontWeight:"700",color:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",gap:"10px"},liveIndicator:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",background:"rgba(218, 55, 60, 0.3)",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#da373c",border:"1px solid rgba(218, 55, 60, 0.5)"},liveDot:{width:"8px",height:"8px",background:"#da373c",borderRadius:"50%",animation:"pulse 1.5s ease-in-out infinite"},closeBtn:{background:"rgba(218, 55, 60, 0.2)",border:"1px solid rgba(218, 55, 60, 0.4)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#da373c",fontSize:"18px"},content:{flex:1,display:"flex",flexDirection:s?"column":"row",overflow:"hidden"},streamSection:{flex:1,display:"flex",flexDirection:"column",background:"#000",position:"relative"},videoContainer:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",position:"relative"},video:{width:"100%",height:"100%",objectFit:"contain"},placeholder:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)"},viewerCount:{position:"absolute",top:"16px",right:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",borderRadius:"20px",fontSize:"14px",fontWeight:"600",color:"white"},controls:{padding:"16px",background:"rgba(0, 0, 0, 0.8)",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},controlBtn:i(a=>({padding:"12px 24px",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",minHeight:"44px",background:a?"rgba(218, 55, 60, 0.3)":"rgba(88, 101, 242, 0.2)",color:a?"#da373c":"rgba(255, 255, 255, 0.9)",border:`1px solid ${a?"rgba(218, 55, 60, 0.5)":"rgba(88, 101, 242, 0.4)"}`}),"controlBtn"),startBtn:{padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"linear-gradient(135deg, #da373c, #f04747)",color:"white",transition:"all 0.2s ease",minHeight:"48px"},chatSection:{width:s?"100%":"350px",maxHeight:s?"300px":"auto",background:"rgba(0, 0, 0, 0.3)",borderLeft:s?"none":"1px solid rgba(218, 55, 60, 0.2)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(218, 55, 60, 0.2)",fontSize:"16px",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)"},chatMessages:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px"},chatMessage:{padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"14px"},chatUsername:{fontWeight:"600",color:"#5865f2",marginBottom:"4px"},chatText:{color:"rgba(255, 255, 255, 0.8)"},chatInputArea:{padding:"12px",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"8px"},input:{flex:1,padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(218, 55, 60, 0.3)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.95)",fontSize:"14px",outline:"none"},sendBtn:{padding:"12px 20px",background:"linear-gradient(135deg, #da373c, #f04747)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:"pointer",minHeight:"44px"}}),"getStyles"),X=i(({onClose:s,roomSlug:a,ws:u,token:y,isMobile:h})=>{const t=L(h),n=z({roomSlug:a,ws:u,onClose:s});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }"}),e.jsx("div",{style:t.overlay,onClick:s,children:e.jsxs("div",{style:t.modal,onClick:i(o=>o.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("h2",{style:t.title,children:[e.jsx(m,{})," Live Stream",n.isStreaming&&e.jsxs("span",{style:t.liveIndicator,children:[e.jsx("span",{style:t.liveDot}),"LIVE"]})]}),e.jsx("button",{onClick:s,style:t.closeBtn,children:e.jsx(I,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.streamSection,children:[e.jsx("div",{style:t.videoContainer,children:n.isStreaming?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:n.videoRef,autoPlay:!0,muted:!0,style:t.video}),e.jsxs("div",{style:t.viewerCount,children:[e.jsx(T,{})," ",n.viewers," viewers"]})]}):e.jsxs("div",{style:t.placeholder,children:[e.jsx(m,{size:64}),e.jsx("p",{style:{marginTop:"16px",fontSize:"18px"},children:'Click "Start Stream" to begin'})]})}),e.jsx("div",{style:t.controls,children:n.isStreaming?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n.toggleMute,style:t.controlBtn(n.isMuted),children:[n.isMuted?e.jsx(F,{}):e.jsx(_,{}),n.isMuted?"Unmute":"Mute"]}),e.jsxs("button",{onClick:n.stopStream,style:{...t.startBtn,background:"linear-gradient(135deg, #da373c, #b83030)"},children:[e.jsx(M,{})," Stop Stream"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:i(()=>n.setStreamType("camera"),"onClick"),style:t.controlBtn(n.streamType==="camera"),children:[e.jsx(m,{})," Camera"]}),e.jsxs("button",{onClick:i(()=>n.setStreamType("screen"),"onClick"),style:t.controlBtn(n.streamType==="screen"),children:[e.jsx(D,{})," Screen"]}),e.jsxs("button",{onClick:n.startStream,style:t.startBtn,children:[e.jsx(m,{})," Start Stream"]})]})})]}),n.isStreaming&&e.jsxs("div",{style:t.chatSection,children:[e.jsxs("div",{style:t.chatHeader,children:[e.jsx(O,{})," Stream Chat"]}),e.jsx("div",{style:t.chatMessages,children:n.chatMessages.map(o=>e.jsxs("div",{style:t.chatMessage,children:[e.jsx("div",{style:t.chatUsername,children:o.user}),e.jsx("div",{style:t.chatText,children:o.message})]},o.id))}),e.jsxs("form",{onSubmit:n.sendChatMessage,style:t.chatInputArea,children:[e.jsx("input",{type:"text",value:n.chatInput,onChange:i(o=>n.setChatInput(o.target.value),"onChange"),placeholder:"Send a message...",style:t.input}),e.jsx("button",{type:"submit",style:t.sendBtn,children:"Send"})]})]})]})]})})]})},"LiveStreamModal");export{X as default};
