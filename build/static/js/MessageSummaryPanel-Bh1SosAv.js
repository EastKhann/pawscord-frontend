import{r as t,n as s}from"./react-core-zXIKm1Jm.js";import{G as C,a as E,cB as G,a5 as w,D as f,a9 as l,z,b3 as H,al as A,bs as P,bn as I}from"./icons-vendor-BBdoVeJd.js";import{p as O}from"./purify.es-HRjpPm7y.js";import"./editor-vendor-DiU449Dh.js";const Q=({channelId:g,onClose:c,fetchWithAuth:o,apiBaseUrl:m})=>{const[k,p]=t.useState(!1),[n,d]=t.useState([]),[r,y]=t.useState(null),[v,N]=t.useState(!1),[h,_]=t.useState("24h"),[u,F]=t.useState(100),[x,D]=t.useState(g),[S,b]=t.useState([]);t.useEffect(()=>{L()},[g]);const L=async()=>{p(!0);try{const e=await o(`${m}/rooms/list/`);if(e.ok){const i=await e.json();b(i.rooms||i||[])}const a=await o(`${m}/messages/summaries/`);if(a.ok){const i=await a.json();d(i.summaries||i||[])}}catch(e){console.error("Error loading data:",e),b([]),d([])}p(!1)},$=async()=>{N(!0);try{const e=await o(`${m}/messages/summarize/`,{method:"POST",body:JSON.stringify({channel_id:x,time_range:h,message_count:u})});if(e.ok){const a=await e.json(),i={id:a.id||Date.now(),channel:S.find(T=>T.id===x)?.name||"general",created_at:new Date().toISOString(),time_range:h,message_count:a.message_count||u,summary:a.summary||"Özet oluşturulamadı.",keywords:a.keywords||[],participants:a.participants||0};y(i),d([i,...n])}else console.error("Summary generation failed")}catch(e){console.error("Error generating summary:",e)}N(!1)},j=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=e=>{navigator.clipboard.writeText(e)},R=e=>{const a=`# Message Summary - ${e.channel}

Generated: ${j(e.created_at)}
Messages Analyzed: ${e.message_count}
Time Range: ${e.time_range}

${e.summary}`;console.log("Exporting:",a)};return k?s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsx("div",{className:"summary-panel",onClick:e=>e.stopPropagation(),children:s.jsx("div",{className:"loading",children:"Loading message summary..."})})}):s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsxs("div",{className:"summary-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(C,{}),"AI Message Summary"]}),s.jsx("span",{className:"subtitle",children:"Summarize channel conversations with AI"})]}),s.jsx("button",{className:"close-btn",onClick:c,children:s.jsx(E,{})})]}),s.jsxs("div",{className:"summary-content",children:[s.jsxs("div",{className:"generator-section",children:[s.jsxs("h3",{children:[s.jsx(G,{})," Generate Summary"]}),s.jsxs("div",{className:"generator-controls",children:[s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(w,{})," Channel"]}),s.jsx("select",{value:x,onChange:e=>D(Number(e.target.value)),children:S.map(e=>s.jsxs("option",{value:e.id,children:["#",e.name]},e.id))})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(f,{})," Time Range"]}),s.jsxs("select",{value:h,onChange:e=>_(e.target.value),children:[s.jsx("option",{value:"1h",children:"Last Hour"}),s.jsx("option",{value:"6h",children:"Last 6 Hours"}),s.jsx("option",{value:"24h",children:"Last 24 Hours"}),s.jsx("option",{value:"7d",children:"Last 7 Days"}),s.jsx("option",{value:"30d",children:"Last 30 Days"})]})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(l,{})," Max Messages"]}),s.jsxs("select",{value:u,onChange:e=>F(Number(e.target.value)),children:[s.jsx("option",{value:50,children:"50 messages"}),s.jsx("option",{value:100,children:"100 messages"}),s.jsx("option",{value:250,children:"250 messages"}),s.jsx("option",{value:500,children:"500 messages"})]})]}),s.jsx("button",{className:"generate-btn",onClick:$,disabled:v,children:v?s.jsxs(s.Fragment,{children:[s.jsx(z,{className:"spinning"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{}),"Generate Summary"]})})]})]}),(r||n.length>0)&&s.jsxs("div",{className:"summary-display",children:[s.jsxs("div",{className:"summary-header",children:[s.jsxs("h3",{children:[s.jsx(l,{}),r?"Generated Summary":"Latest Summary"]}),s.jsxs("div",{className:"summary-actions",children:[s.jsxs("button",{className:"action-btn",onClick:()=>M((r||n[0]).summary),children:[s.jsx(H,{})," Copy"]}),s.jsxs("button",{className:"action-btn",onClick:()=>R(r||n[0]),children:[s.jsx(A,{})," Export"]})]})]}),s.jsxs("div",{className:"summary-meta",children:[s.jsxs("span",{className:"meta-item",children:[s.jsx(w,{})," #",(r||n[0]).channel]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(f,{})," ",(r||n[0]).time_range]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(l,{})," ",(r||n[0]).message_count," messages"]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(P,{})," ",j((r||n[0]).created_at)]})]}),s.jsx("div",{className:"summary-body",children:s.jsx("div",{className:"summary-text",dangerouslySetInnerHTML:{__html:O.sanitize((r||n[0]).summary.replace(/## /g,"<h4>").replace(/\n\n/g,`</h4>
`).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/- /g,"• ").replace(/\n/g,"<br/>"))}})}),s.jsxs("div",{className:"summary-keywords",children:[s.jsx("span",{className:"keywords-label",children:"Keywords:"}),(r||n[0]).keywords.map((e,a)=>s.jsx("span",{className:"keyword-chip",children:e},a))]})]}),s.jsxs("div",{className:"history-section",children:[s.jsxs("h3",{children:[s.jsx(I,{})," Summary History"]}),s.jsx("div",{className:"history-list",children:n.map(e=>s.jsxs("div",{className:`history-item ${r?.id===e.id?"active":""}`,onClick:()=>y(e),children:[s.jsx("div",{className:"history-icon",children:s.jsx(l,{})}),s.jsxs("div",{className:"history-info",children:[s.jsxs("span",{className:"history-channel",children:["#",e.channel]}),s.jsxs("span",{className:"history-meta",children:[e.message_count," messages • ",e.time_range]})]}),s.jsx("div",{className:"history-date",children:j(e.created_at)})]},e.id))})]})]})]})})};export{Q as default};
