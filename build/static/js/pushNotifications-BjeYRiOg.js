const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/index-CvR5GXbp.js","static/js/index-CTFF7TqV.js","static/js/media-vendor-BuSyE8vR.js","static/js/react-core-BMiyQWF6.js","static/js/editor-vendor-D9c4a6XZ.js","static/js/router-vendor-B86Z1mIL.js","static/js/icons-vendor-GUGjkvMm.js","static/js/state-vendor-CAyNnPM4.js","static/js/crypto-vendor-1Q6e4ZD-.js","static/css/index-BBwoCi19.css"])))=>i.map(i=>d[i]);
import{_ as o}from"./media-vendor-BuSyE8vR.js";import"./react-core-BMiyQWF6.js";import"./editor-vendor-D9c4a6XZ.js";class n{constructor(){this.isSupported="PushManager"in window,this.permission="default",this.deviceToken=null,this.listeners=new Map}async init(i,e){this.apiBaseUrl=i,this.fetchWithAuth=e,window.Capacitor?.isNativePlatform()?await this.initCapacitor():await this.initWeb()}async initCapacitor(){try{const{PushNotifications:i}=await o(async()=>{const{PushNotifications:t}=await import("./index-CvR5GXbp.js");return{PushNotifications:t}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));(await i.requestPermissions()).receive==="granted"&&(this.permission="granted",await i.register(),await i.addListener("registration",async t=>{this.deviceToken=t.value,await this.registerDevice(t.value)}),await i.addListener("registrationError",t=>{}),await i.addListener("pushNotificationReceived",t=>{this.handleNotification(t)}),await i.addListener("pushNotificationActionPerformed",t=>{this.handleNotificationAction(t)}))}catch{}}async initWeb(){if(!this.isSupported)return;const i=await Notification.requestPermission();this.permission=i}async registerDevice(i){try{(await this.fetchWithAuth(`${this.apiBaseUrl}/devices/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({registration_id:i,type:"android",active:!0})})).ok}catch{}}handleNotification(i){const{title:e,body:t,data:a}=i;this.listeners.forEach(s=>{s({type:"notification",title:e,body:t,data:a})}),document.hidden&&this.permission==="granted"&&new Notification(e,{body:t,icon:"/logo192.png",badge:"/badge.png",tag:a?.messageId||"default",data:a})}handleNotificationAction(i){const{notification:e,actionId:t}=i;this.listeners.forEach(a=>{a({type:"action",actionId:t,notification:e})}),e.data?.roomId?window.location.href=`/#/room/${e.data.roomId}`:e.data?.conversationId&&(window.location.href=`/#/dm/${e.data.conversationId}`)}on(i,e){const t=Math.random().toString(36).substr(2,9);return this.listeners.set(t,e),()=>this.listeners.delete(t)}async sendTestNotification(){try{await this.fetchWithAuth(`${this.apiBaseUrl}/push/test/`,{method:"POST"})}catch{}}async unregister(){if(this.deviceToken)try{await this.fetchWithAuth(`${this.apiBaseUrl}/devices/${this.deviceToken}/`,{method:"DELETE"})}catch{}}}const p=new n;export{p as pushNotificationManager};
