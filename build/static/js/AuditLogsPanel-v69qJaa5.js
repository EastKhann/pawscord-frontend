import{r,n as e}from"./react-core-Cj7FUMmY.js";import{y as x}from"./ui-vendor-EA4dxvko.js";import{g as L}from"./index-DrIBbDZv.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-TGltgKsJ.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const P=({serverId:i,onClose:_})=>{const[d,v]=r.useState([]),[s,o]=r.useState({action_type:"",user_id:"",target_user_id:"",channel_id:"",start_date:"",end_date:""}),[u,g]=r.useState(!0),[m,h]=r.useState(1),[k,y]=r.useState(!0),b=L();r.useEffect(()=>{i&&f()},[i,m]);const f=async()=>{g(!0);try{const a=localStorage.getItem("access_token"),l=new URLSearchParams({page:m,...Object.fromEntries(Object.entries(s).filter(([t,c])=>c!==""))}),n=await fetch(`${b}/audit-logs/server/${i}/?${l}`,{headers:{Authorization:`Bearer ${a}`}});if(n.ok){const t=await n.json();v(m===1?t.logs||[]:[...d,...t.logs||[]]),y(t.has_more||!1)}}catch{x.error("âŒ Audit loglarÄ± yÃ¼klenemedi")}finally{g(!1)}},N=()=>{h(1),f()},S=()=>{o({action_type:"",user_id:"",target_user_id:"",channel_id:"",start_date:"",end_date:""}),h(1)},w=async()=>{try{const a=localStorage.getItem("access_token"),l=new URLSearchParams({...Object.fromEntries(Object.entries(s).filter(([t,c])=>c!==""))}),n=await fetch(`${b}/audit-logs/server/${i}/export/?${l}`,{headers:{Authorization:`Bearer ${a}`}});if(n.ok){const t=await n.blob(),c=window.URL.createObjectURL(t),j=document.createElement("a");j.href=c,j.download=`audit_logs_${i}.csv`,j.click(),x.success("âœ… Audit loglarÄ± dÄ±ÅŸa aktarÄ±ldÄ±")}}catch{x.error("âŒ DÄ±ÅŸa aktarma baÅŸarÄ±sÄ±z")}},A=a=>({message_delete:"ğŸ—‘ï¸",message_edit:"âœï¸",member_join:"ğŸ‘‹",member_leave:"ğŸ‘‹",member_kick:"ğŸš«",member_ban:"ğŸ”¨",member_unban:"âœ…",role_create:"ğŸ­",role_delete:"ğŸ—‘ï¸",role_update:"ğŸ¨",role_assign:"â­",role_remove:"â–",channel_create:"â•",channel_delete:"âŒ",channel_update:"ğŸ”§",server_update:"âš™ï¸",invite_create:"ğŸ”—",webhook_create:"ğŸ¤–",webhook_delete:"ğŸ—‘ï¸",emoji_create:"ğŸ˜€",emoji_delete:"ğŸ˜¢",pin_add:"ğŸ“Œ",pin_remove:"ğŸ“Œ",reaction_add:"â¤ï¸",reaction_remove:"ğŸ’”"})[a]||"ğŸ“",p=a=>a.includes("delete")||a.includes("remove")||a.includes("kick")||a.includes("ban")?"#ef4444":a.includes("create")||a.includes("add")||a.includes("join")?"#10b981":a.includes("edit")||a.includes("update")?"#f59e0b":"#6366f1",$=a=>{const l=new Date(a),t=Math.floor((new Date-l)/1e3);return t<60?"Az Ã¶nce":t<3600?`${Math.floor(t/60)} dakika Ã¶nce`:t<86400?`${Math.floor(t/3600)} saat Ã¶nce`:t<604800?`${Math.floor(t/86400)} gÃ¼n Ã¶nce`:l.toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return e.jsx("div",{className:"audit-logs-overlay",onClick:_,children:e.jsxs("div",{className:"audit-logs-panel",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"audit-header",children:[e.jsx("h2",{children:"ğŸ“‹ Audit Logs"}),e.jsx("button",{className:"close-btn",onClick:_,children:"Ã—"})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filter-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Aksiyon TÃ¼rÃ¼"}),e.jsxs("select",{value:s.action_type,onChange:a=>o({...s,action_type:a.target.value}),children:[e.jsx("option",{value:"",children:"TÃ¼mÃ¼"}),e.jsxs("optgroup",{label:"Mesajlar",children:[e.jsx("option",{value:"message_delete",children:"Mesaj Silme"}),e.jsx("option",{value:"message_edit",children:"Mesaj DÃ¼zenleme"}),e.jsx("option",{value:"pin_add",children:"Pin Ekleme"}),e.jsx("option",{value:"pin_remove",children:"Pin KaldÄ±rma"})]}),e.jsxs("optgroup",{label:"Ãœyeler",children:[e.jsx("option",{value:"member_join",children:"Ãœye KatÄ±ldÄ±"}),e.jsx("option",{value:"member_leave",children:"Ãœye AyrÄ±ldÄ±"}),e.jsx("option",{value:"member_kick",children:"Ãœye AtÄ±ldÄ±"}),e.jsx("option",{value:"member_ban",children:"Ãœye BanlandÄ±"}),e.jsx("option",{value:"member_unban",children:"Ban KaldÄ±rÄ±ldÄ±"})]}),e.jsxs("optgroup",{label:"Roller",children:[e.jsx("option",{value:"role_create",children:"Rol OluÅŸturma"}),e.jsx("option",{value:"role_delete",children:"Rol Silme"}),e.jsx("option",{value:"role_update",children:"Rol GÃ¼ncelleme"}),e.jsx("option",{value:"role_assign",children:"Rol Atama"}),e.jsx("option",{value:"role_remove",children:"Rol KaldÄ±rma"})]}),e.jsxs("optgroup",{label:"Kanallar",children:[e.jsx("option",{value:"channel_create",children:"Kanal OluÅŸturma"}),e.jsx("option",{value:"channel_delete",children:"Kanal Silme"}),e.jsx("option",{value:"channel_update",children:"Kanal GÃ¼ncelleme"})]}),e.jsxs("optgroup",{label:"DiÄŸer",children:[e.jsx("option",{value:"server_update",children:"Sunucu GÃ¼ncelleme"}),e.jsx("option",{value:"invite_create",children:"Davet OluÅŸturma"}),e.jsx("option",{value:"webhook_create",children:"Webhook OluÅŸturma"}),e.jsx("option",{value:"webhook_delete",children:"Webhook Silme"}),e.jsx("option",{value:"emoji_create",children:"Emoji Ekleme"}),e.jsx("option",{value:"emoji_delete",children:"Emoji Silme"})]})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"BaÅŸlangÄ±Ã§ Tarihi"}),e.jsx("input",{type:"datetime-local",value:s.start_date,onChange:a=>o({...s,start_date:a.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"BitiÅŸ Tarihi"}),e.jsx("input",{type:"datetime-local",value:s.end_date,onChange:a=>o({...s,end_date:a.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"KullanÄ±cÄ± ID"}),e.jsx("input",{type:"text",placeholder:"Aksiyon yapan kullanÄ±cÄ±",value:s.user_id,onChange:a=>o({...s,user_id:a.target.value})})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"filter-btn apply-btn",onClick:N,children:"ğŸ” Filtrele"}),e.jsx("button",{className:"filter-btn clear-btn",onClick:S,children:"ğŸ—‘ï¸ Temizle"}),e.jsx("button",{className:"filter-btn export-btn",onClick:w,children:"ğŸ“¥ DÄ±ÅŸa Aktar"})]})]}),e.jsx("div",{className:"logs-content",children:u&&d.length===0?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loglar yÃ¼kleniyor..."})]}):d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ“‹"}),e.jsx("p",{children:"HenÃ¼z audit log yok"}),e.jsx("span",{children:"Sunucudaki aksiyonlar burada gÃ¶rÃ¼necek"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"logs-list",children:d.map(a=>e.jsxs("div",{className:"log-entry",style:{borderLeftColor:p(a.action_type)},children:[e.jsx("div",{className:"log-icon",style:{background:`${p(a.action_type)}20`},children:A(a.action_type)}),e.jsxs("div",{className:"log-details",children:[e.jsxs("div",{className:"log-header-row",children:[e.jsx("span",{className:"log-action",style:{color:p(a.action_type)},children:a.action_display||a.action_type}),e.jsx("span",{className:"log-time",children:$(a.created_at)})]}),e.jsx("div",{className:"log-description",children:a.description||"AÃ§Ä±klama yok"}),a.metadata&&Object.keys(a.metadata).length>0&&e.jsx("div",{className:"log-metadata",children:Object.entries(a.metadata).map(([l,n])=>e.jsxs("div",{className:"metadata-item",children:[e.jsxs("span",{className:"metadata-key",children:[l,":"]}),e.jsx("span",{className:"metadata-value",children:JSON.stringify(n)})]},l))}),e.jsxs("div",{className:"log-footer",children:[a.user&&e.jsxs("span",{className:"log-user",children:["ğŸ‘¤ ",a.user.username||`User#${a.user.id}`]}),a.channel&&e.jsxs("span",{className:"log-channel",children:["ğŸ“¢ #",a.channel.name]}),a.target_user&&e.jsxs("span",{className:"log-target",children:["ğŸ¯ ",a.target_user.username]})]})]})]},a.id))}),k&&e.jsx("button",{className:"load-more-btn",onClick:()=>h(m+1),disabled:u,children:u?"â³ YÃ¼kleniyor...":"ğŸ“„ Daha Fazla YÃ¼kle"})]})})]})})};export{P as default};
