import{r,j as s}from"./react-core-D6cE4lil.js";import{aa as Q,ab as X,c4 as Z,u as A,a0 as ss,ac as P,z,aT as es,aE as as,by as is,ax as ls,j as ts,O as ns,cL as cs,a5 as rs,a as os}from"./icons-vendor-fClA8qVL.js";import{t as R}from"./index-B3eDbSm-.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const ds={total_members:0,active_members:0,messages_count:0,voice_minutes:0,member_growth:0,message_growth:0},h=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),O=e=>e>0?{icon:Q,color:"#23a559",text:`+${e}%`}:e<0?{icon:X,color:"#da373c",text:`${e}%`}:{icon:Z,color:"#72767d",text:"0%"},U=(e,t="#5865f2",l=60)=>{if(!e||e.length===0)return null;const c=Math.max(...e.map(i=>i.value)),a=100/e.length;return s.jsx("div",{className:"simple-chart",style:{height:l},children:e.map((i,n)=>s.jsx("div",{className:"chart-bar",style:{width:`${a}%`,height:`${i.value/c*100}%`,background:t},title:`${i.label}: ${i.value}`},n))})},ms=(e,t)=>{const[l,c]=r.useState("7d"),[a,i]=r.useState(!0),[n,d]=r.useState(!1),[m,j]=r.useState(ds),[v,k]=r.useState([]),[u,b]=r.useState([]),[N,y]=r.useState([]),[p,f]=r.useState([]),[o,B]=r.useState([]),[_,H]=r.useState([]),[I,K]=r.useState([]),[q,J]=r.useState([]),C=async()=>{i(!0);try{const S={Authorization:`Bearer ${localStorage.getItem("access_token")}`},g=`${t}/analytics/${e}`,x=["overview","member-activity","message-activity","top-channels","top-members","geo","reactions","link-clicks","peak-hours"],W=await Promise.all(x.map(Y=>fetch(`${g}/${Y}/?range=${l}`,{headers:S}))),[$,F,E,L,M,T,D,G,V]=W;$.ok&&j(await $.json()),F.ok&&k((await F.json()).data||[]),E.ok&&b((await E.json()).data||[]),L.ok&&y((await L.json()).channels||[]),M.ok&&f((await M.json()).members||[]),T.ok&&B((await T.json()).data||[]),D.ok&&H((await D.json()).reactions||[]),G.ok&&K((await G.json()).links||[]),V.ok&&J((await V.json()).hours||[])}catch{R.error("âŒ Analitik verileri yÃ¼klenemedi")}finally{i(!1)}};return r.useEffect(()=>{C()},[e,l]),{timeRange:l,setTimeRange:c,loading:a,refreshing:n,overview:m,memberActivity:v,messageActivity:u,topChannels:N,topMembers:p,geoData:o,reactionStats:_,linkClicks:I,peakHours:q,handleRefresh:async()=>{d(!0),await C(),d(!1),R.success("ðŸ”„ Veriler gÃ¼ncellendi")},handleExport:()=>{const w={exported_at:new Date().toISOString(),time_range:l,overview:m,memberActivity:v,messageActivity:u,topChannels:N,topMembers:p,geoData:o,reactionStats:_},S=new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),g=URL.createObjectURL(S),x=document.createElement("a");x.href=g,x.download=`analytics_${e}_${l}.json`,x.click(),URL.revokeObjectURL(g),R.success("ðŸ“¥ Analitik verileri indirildi")}}},hs=[{key:"total_members",icon:A,label:"Toplam Ãœye",cls:"members",growth:"member"},{key:"active_members",icon:ss,label:"Aktif Ãœye",cls:"active"},{key:"messages_count",icon:P,label:"Mesaj",cls:"messages",growth:"message"},{key:"voice_minutes",icon:z,label:"Sesli Dakika",cls:"voice"}],js=({overview:e})=>{const t=O(e.member_growth),l=O(e.message_growth),c={member:t,message:l};return s.jsx("div",{className:"overview-section",children:hs.map(a=>{const i=a.growth?c[a.growth]:null;return s.jsxs("div",{className:"overview-card",children:[s.jsx("div",{className:`card-icon ${a.cls}`,children:s.jsx(a.icon,{})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-value",children:h(e[a.key])}),s.jsx("span",{className:"card-label",children:a.label}),i?s.jsxs("span",{className:"card-growth",style:{color:i.color},children:[s.jsx(i.icon,{})," ",i.text]}):a.key==="active_members"?s.jsxs("span",{className:"card-detail",children:[(e.active_members/e.total_members*100||0).toFixed(1),"% aktiflik"]}):s.jsxs("span",{className:"card-detail",children:[Math.round(e.voice_minutes/60)," saat"]})]})]},a.key)})})},xs=({memberActivity:e,messageActivity:t,peakHours:l})=>{const c=()=>{const a=Array(24).fill(0).map((n,d)=>{const m=l.find(j=>j.hour===d);return{hour:d,value:m?.value||0}}),i=Math.max(...a.map(n=>n.value));return s.jsx("div",{className:"peak-hours-chart",children:a.map((n,d)=>s.jsx("div",{className:"hour-bar",style:{height:`${i>0?n.value/i*100:0}%`,background:n.value>i*.8?"#23a559":n.value>i*.5?"#5865f2":"#3f4147"},title:`${n.hour}:00 - ${n.value} mesaj`,children:s.jsx("span",{className:"hour-label",children:n.hour})},d))})};return s.jsxs("div",{className:"charts-grid",children:[s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(A,{})," ","Ãœ","ye Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:e.length>0?U(e,"#5865f2",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card",children:[s.jsx("div",{className:"chart-header",children:s.jsxs("h3",{children:[s.jsx(P,{})," Mesaj Aktivitesi"]})}),s.jsx("div",{className:"chart-body",children:t.length>0?U(t,"#23a559",120):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"chart-card wide",children:[s.jsxs("div",{className:"chart-header",children:[s.jsxs("h3",{children:[s.jsx(z,{})," Yo","ÄŸ","unluk Saatleri"]}),s.jsxs("span",{className:"chart-info",children:[s.jsx(es,{})," En yo","ÄŸ","un saatler ye","ÅŸ","il ile g","Ã¶","sterilir"]})]}),s.jsx("div",{className:"chart-body",children:l.length>0?c():s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]})},vs=({topChannels:e,topMembers:t,reactionStats:l,geoData:c})=>s.jsxs("div",{className:"lists-grid",children:[s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(as,{})," En Aktif Kanallar"]})}),s.jsx("div",{className:"list-body",children:e.length>0?e.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:i+1}),s.jsxs("span",{className:"name",children:["# ",a.name]}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar",style:{width:`${a.messages/e[0].messages*100}%`}})}),s.jsx("span",{className:"value",children:h(a.messages)})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(A,{})," En Aktif ","Ãœ","yeler"]})}),s.jsx("div",{className:"list-body",children:t.length>0?t.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"rank",children:i+1}),s.jsx("img",{src:a.avatar||"/default-avatar.png",alt:a.username,className:"avatar"}),s.jsx("span",{className:"name",children:a.username}),s.jsxs("span",{className:"value",children:[h(a.messages)," mesaj"]})]},a.id)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(is,{})," En ","Ã‡","ok Kullan","Ä±","lan Reaksiyonlar"]})}),s.jsx("div",{className:"list-body",children:l.length>0?s.jsx("div",{className:"reactions-grid",children:l.map((a,i)=>s.jsxs("div",{className:"reaction-item",children:[s.jsx("span",{className:"emoji",children:a.emoji}),s.jsx("span",{className:"count",children:h(a.count)})]},i))}):s.jsx("div",{className:"no-data",children:"Veri yok"})})]}),s.jsxs("div",{className:"list-card",children:[s.jsx("div",{className:"list-header",children:s.jsxs("h3",{children:[s.jsx(ls,{})," Co","ÄŸ","rafi Da","ÄŸÄ±","l","Ä±","m"]})}),s.jsx("div",{className:"list-body",children:c.length>0?c.map((a,i)=>s.jsxs("div",{className:"list-item",children:[s.jsx("span",{className:"flag",children:a.flag||"ðŸŒ"}),s.jsx("span",{className:"name",children:a.country}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar geo",style:{width:`${a.count/c[0].count*100}%`}})}),s.jsxs("span",{className:"value",children:[a.percentage,"%"]})]},i)):s.jsx("div",{className:"no-data",children:"Veri yok"})})]})]}),us=({linkClicks:e})=>e.length===0?null:s.jsxs("div",{className:"links-section",children:[s.jsxs("h3",{children:[s.jsx(ts,{})," Link T","Ä±","klamalar","Ä±"]}),s.jsxs("div",{className:"links-table",children:[s.jsxs("div",{className:"table-header",children:[s.jsx("span",{children:"URL"}),s.jsxs("span",{children:["T","Ä±","klama"]}),s.jsx("span",{children:"Benzersiz"})]}),e.map((t,l)=>s.jsxs("div",{className:"table-row",children:[s.jsx("span",{className:"link-url",title:t.url,children:t.url.length>50?t.url.substring(0,50)+"...":t.url}),s.jsx("span",{children:h(t.clicks)}),s.jsx("span",{children:h(t.unique_clicks)})]},l))]})]}),Ns=[{value:"24h",label:"24 Saat"},{value:"7d",label:"7 GÃ¼n"},{value:"30d",label:"30 GÃ¼n"},{value:"90d",label:"90 GÃ¼n"}],_s=({serverId:e,apiBaseUrl:t,onClose:l})=>{const{timeRange:c,setTimeRange:a,loading:i,refreshing:n,overview:d,memberActivity:m,messageActivity:j,topChannels:v,topMembers:k,geoData:u,reactionStats:b,linkClicks:N,peakHours:y,handleRefresh:p,handleExport:f}=ms(e,t);return i?s.jsx("div",{className:"analytics-overlay",onClick:l,children:s.jsx("div",{className:"analytics-panel",onClick:o=>o.stopPropagation(),children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsxs("p",{children:["Analitik verileri y","Ã¼","kleniyor..."]})]})})}):s.jsx("div",{className:"analytics-overlay",onClick:l,children:s.jsxs("div",{className:"analytics-panel",onClick:o=>o.stopPropagation(),children:[s.jsxs("div",{className:"analytics-header",children:[s.jsxs("h2",{children:[s.jsx(ns,{})," Geli","ÅŸ","mi","ÅŸ"," Analitik"]}),s.jsxs("div",{className:"header-controls",children:[s.jsx("div",{className:"time-range-selector",children:Ns.map(o=>s.jsx("button",{className:`range-btn ${c===o.value?"active":""}`,onClick:()=>a(o.value),children:o.label},o.value))}),s.jsx("button",{className:"action-btn",onClick:p,disabled:n,children:s.jsx(cs,{className:n?"spinning":""})}),s.jsx("button",{className:"action-btn",onClick:f,children:s.jsx(rs,{})})]}),s.jsx("button",{className:"close-btn",onClick:l,children:s.jsx(os,{})})]}),s.jsxs("div",{className:"analytics-content",children:[s.jsx(js,{overview:d}),s.jsx(xs,{memberActivity:m,messageActivity:j,peakHours:y}),s.jsx(vs,{topChannels:v,topMembers:k,reactionStats:b,geoData:u}),s.jsx(us,{linkClicks:N})]})]})})};export{_s as default};
