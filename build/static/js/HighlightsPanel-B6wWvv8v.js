var R=Object.defineProperty;var P=(l,e,t)=>e in l?R(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e)=>R(l,"name",{value:e,configurable:!0});var g=(l,e,t)=>P(l,typeof e!="symbol"?e+"":e,t);import{r as k,j as i}from"./react-core-Djgtqrmb.js";import{y as j}from"./ui-vendor-IhB9Znpc.js";import{p as z}from"./purify.es-CVaxJkcz.js";import{v as D,t as I,d as K}from"./index-DwVhiipM.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";const q=class q extends Error{constructor(e,t,r,h=null){super(e),this.name="ApiError",this.status=t,this.code=r,this.data=h,this.timestamp=new Date().toISOString()}toJSON(){return{name:this.name,message:this.message,status:this.status,code:this.code,data:this.data,timestamp:this.timestamp}}};s(q,"ApiError");let $=q;const E=class E{constructor(e=6,t=100){this.queue=[],this.running=0,this.maxConcurrent=e,this.rateLimit=t,this.requestTimes=[]}async add(e){return new Promise((t,r)=>{this.queue.push({fn:e,resolve:t,reject:r}),this.process()})}async process(){if(this.running>=this.maxConcurrent||this.queue.length===0)return;const e=Date.now();if(this.requestTimes=this.requestTimes.filter(n=>e-n<6e4),this.requestTimes.length>=this.rateLimit){setTimeout(()=>this.process(),1e3);return}const{fn:t,resolve:r,reject:h}=this.queue.shift();this.running++,this.requestTimes.push(e);try{const n=await t();r(n)}catch(n){h(n)}finally{this.running--,this.process()}}};s(E,"RequestQueue");let N=E;const C=class C{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||200,this.defaultTTL=e.defaultTTL||300*1e3,this.hits=0,this.misses=0}generateKey(e,t){const r=t?JSON.stringify(Object.keys(t).sort().reduce((h,n)=>(h[n]=t[n],h),{})):"";return`${e}:${r}`}get(e){const t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),this.misses++,null):(this.hits++,t.data):(this.misses++,null)}set(e,t,r=this.defaultTTL){if(this.cache.size>=this.maxSize){const h=this.cache.keys().next().value;this.cache.delete(h)}this.cache.set(e,{data:t,expiry:Date.now()+r,timestamp:Date.now()})}invalidate(e){if(typeof e=="string")for(const t of this.cache.keys())t.includes(e)&&this.cache.delete(t);else if(e instanceof RegExp)for(const t of this.cache.keys())e.test(t)&&this.cache.delete(t)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,maxSize:this.maxSize,hits:this.hits,misses:this.misses,hitRate:this.hits+this.misses>0?(this.hits/(this.hits+this.misses)*100).toFixed(2)+"%":"0%"}}};s(C,"SmartCache");let S=C;const _=class _{constructor(){g(this,"users",{getProfile:s(e=>this.get(`/api/users/${e}/`),"getProfile"),updateProfile:s((e,t)=>this.patch(`/api/users/${e}/`,t),"updateProfile"),getSettings:s(()=>this.get("/api/users/settings/"),"getSettings"),updateSettings:s(e=>this.patch("/api/users/settings/",e),"updateSettings"),getFriends:s(()=>this.get("/api/friends/",{cacheTTL:this.config.cacheTTL.short}),"getFriends"),sendFriendRequest:s(e=>this.post("/api/friends/send/",{user_id:e}),"sendFriendRequest"),getBlocked:s(()=>this.get("/api/blocked-users/"),"getBlocked"),blockUser:s(e=>this.post("/api/blocked-users/",{user_id:e}),"blockUser"),unblockUser:s(e=>this.delete(`/api/blocked-users/${e}/`),"unblockUser")});g(this,"servers",{list:s(()=>this.get("/api/servers/",{cacheTTL:this.config.cacheTTL.short}),"list"),get:s(e=>this.get(`/api/servers/${e}/`),"get"),create:s(e=>this.post("/api/servers/",e),"create"),update:s((e,t)=>this.patch(`/api/servers/${e}/`,t),"update"),delete:s(e=>this.delete(`/api/servers/${e}/`),"delete"),getMembers:s(e=>this.get(`/api/servers/${e}/members/`),"getMembers"),getRoles:s(e=>this.get(`/api/servers/${e}/roles/`),"getRoles"),getBoostStats:s(e=>this.get(`/api/servers/${e}/boost-stats/`),"getBoostStats")});g(this,"rooms",{list:s(e=>this.get(`/api/servers/${e}/rooms/`),"list"),get:s(e=>this.get(`/api/rooms/${e}/`),"get"),create:s((e,t)=>this.post(`/api/servers/${e}/rooms/`,t),"create"),update:s((e,t)=>this.patch(`/api/rooms/${e}/`,t),"update"),delete:s(e=>this.delete(`/api/rooms/${e}/`),"delete"),getMessages:s((e,t)=>this.get(`/api/rooms/${e}/messages/`,{params:t,cacheTTL:this.config.cacheTTL.short}),"getMessages")});g(this,"messages",{send:s((e,t)=>this.post(`/api/rooms/${e}/messages/`,t),"send"),edit:s((e,t)=>this.patch(`/api/messages/${e}/`,{content:t}),"edit"),delete:s(e=>this.delete(`/api/messages/${e}/`),"delete"),pin:s(e=>this.post(`/api/messages/${e}/pin/`),"pin"),unpin:s(e=>this.post(`/api/messages/${e}/unpin/`),"unpin"),react:s((e,t)=>this.post(`/api/messages/${e}/react/`,{emoji:t}),"react"),search:s(e=>this.get("/api/messages/search/",{params:e}),"search")});g(this,"auth",{login:s(e=>this.post("/api/auth/login/",e,{showError:!1}),"login"),register:s(e=>this.post("/api/auth/register/",e),"register"),logout:s(()=>this.post("/api/auth/logout/"),"logout"),refreshToken:s(()=>this.refreshToken(),"refreshToken"),verifyEmail:s(e=>this.post("/api/auth/verify-email/",{token:e}),"verifyEmail"),resetPassword:s(e=>this.post("/api/auth/reset-password/",{email:e}),"resetPassword"),enable2FA:s(()=>this.post("/api/auth/2fa/enable/"),"enable2FA"),verify2FA:s(e=>this.post("/api/auth/2fa/verify/",{code:e}),"verify2FA")});g(this,"moderation",{ban:s((e,t,r)=>this.post(`/api/servers/${e}/bans/`,{user_id:t,reason:r}),"ban"),unban:s((e,t)=>this.delete(`/api/servers/${e}/bans/${t}/`),"unban"),kick:s((e,t,r)=>this.post(`/api/servers/${e}/kicks/`,{user_id:t,reason:r}),"kick"),warn:s((e,t,r)=>this.post(`/api/servers/${e}/warnings/`,{user_id:t,reason:r}),"warn"),getAuditLogs:s((e,t)=>this.get(`/api/servers/${e}/audit-logs/`,{params:t}),"getAuditLogs")});g(this,"premium",{getPlans:s(()=>this.get("/api/premium/plans/",{cacheTTL:this.config.cacheTTL.long}),"getPlans"),subscribe:s((e,t)=>this.post("/api/premium/subscribe/",{plan_id:e,payment_method:t}),"subscribe"),cancelSubscription:s(()=>this.post("/api/premium/cancel/"),"cancelSubscription"),getStatus:s(()=>this.get("/api/premium/status/"),"getStatus")});g(this,"analytics",{getServerStats:s(e=>this.get(`/api/servers/${e}/analytics/`),"getServerStats"),getUserActivity:s(()=>this.get("/api/users/analytics/"),"getUserActivity"),trackEvent:s((e,t)=>this.post("/api/analytics/events/",{event:e,data:t},{showError:!1}),"trackEvent")});this.baseURL=D,this.cache=new S,this.queue=new N,this.pendingRequests=new Map,this.interceptors={request:[],response:[],error:[]},this.config={timeout:3e4,retryAttempts:3,retryDelay:1e3,retryMultiplier:2,cacheTTL:{short:30*1e3,medium:300*1e3,long:1800*1e3}},this.setupDefaultInterceptors()}setupDefaultInterceptors(){this.addRequestInterceptor(e=>{const t=localStorage.getItem("access_token");return t&&(e.headers={...e.headers,Authorization:`Bearer ${t}`}),e}),this.addErrorInterceptor(async e=>{if(e.status===401&&await this.refreshToken())return this.request(e.originalConfig);throw e})}addRequestInterceptor(e){this.interceptors.request.push(e)}addResponseInterceptor(e){this.interceptors.response.push(e)}addErrorInterceptor(e){this.interceptors.error.push(e)}buildURL(e,t){const r=new URL(e,this.baseURL);return t&&Object.entries(t).forEach(([h,n])=>{n!=null&&r.searchParams.append(h,n)}),r.toString()}async request(e,t={}){const{method:r="GET",headers:h={},body:n,params:f,cache:w=r==="GET",cacheTTL:m=this.config.cacheTTL.medium,retry:T=!0,deduplicate:u=!0,timeout:p=this.config.timeout,showError:o=!0,...d}=t,v=this.buildURL(e,f),c=this.cache.generateKey(v,f);if(w&&r==="GET"){const x=this.cache.get(c);if(x)return{data:x,fromCache:!0}}if(u&&r==="GET"){const x=this.pendingRequests.get(c);if(x)return x}let a={url:v,method:r,headers:{"Content-Type":"application/json",...h},body:n?JSON.stringify(n):void 0,...d};for(const x of this.interceptors.request)a=await x(a);const y=this.executeRequest(a,{retry:T,timeout:p,showError:o,cacheKey:c,cacheTTL:m,useCache:w,method:r});return u&&r==="GET"&&(this.pendingRequests.set(c,y),y.finally(()=>{this.pendingRequests.delete(c)})),y}async executeRequest(e,t){const{retry:r,timeout:h,showError:n,cacheKey:f,cacheTTL:w,useCache:m,method:T}=t;let u;for(let p=0;p<=(r?this.config.retryAttempts:0);p++)try{const o=await this.queue.add(()=>this.fetchWithTimeout(e.url,{method:e.method,headers:e.headers,body:e.body},h));if(!o.ok){const c=await o.json().catch(()=>({}));throw new $(c.message||c.error||`HTTP Error ${o.status}`,o.status,c.code||"HTTP_ERROR",c)}let d;o.headers.get("content-type")?.includes("application/json")?d=await o.json():d=await o.text();for(const c of this.interceptors.response)d=await c(d,o);return m&&T==="GET"&&this.cache.set(f,d,w),{data:d,fromCache:!1}}catch(o){if(u=o,o.status===401||o.status===403||o.status===404)break;if(p<this.config.retryAttempts){const d=this.config.retryDelay*Math.pow(this.config.retryMultiplier,p);await this.sleep(d)}}for(const p of this.interceptors.error)try{const o=await p({...u,originalConfig:e});if(o)return o}catch(o){u=o}throw n&&I.error(u.message||"Bir hata oluÅŸtu"),u}async fetchWithTimeout(e,t,r){const h=new AbortController,n=setTimeout(()=>h.abort(),r);try{return await fetch(e,{...t,signal:h.signal})}finally{clearTimeout(n)}}async refreshToken(){const e=localStorage.getItem("refresh_token");if(!e)return!1;try{const t=await fetch(`${this.baseURL}/api/auth/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})});if(t.ok){const r=await t.json();return localStorage.setItem("access_token",r.access),!0}}catch{}return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),!1}sleep(e){return new Promise(t=>setTimeout(t,e))}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async post(e,t,r={}){const h=await this.request(e,{...r,method:"POST",body:t});return this.cache.invalidate(e.split("/")[0]),h}async put(e,t,r={}){const h=await this.request(e,{...r,method:"PUT",body:t});return this.cache.invalidate(e.split("/")[0]),h}async patch(e,t,r={}){const h=await this.request(e,{...r,method:"PATCH",body:t});return this.cache.invalidate(e.split("/")[0]),h}async delete(e,t={}){const r=await this.request(e,{...t,method:"DELETE"});return this.cache.invalidate(e.split("/")[0]),r}getCacheStats(){return this.cache.getStats()}clearCache(){this.cache.clear()}invalidateCache(e){this.cache.invalidate(e)}};s(_,"ApiService");let L=_;const b=new L,Y=s(({serverId:l,onClose:e})=>{const[t,r]=k.useState({enabled:!1,keywords:[],dm_notifications:!0,highlight_color:"#fbbf24"}),[h,n]=k.useState([]),[f,w]=k.useState(!0),[m,T]=k.useState("");k.useEffect(()=>{u(),p()},[l]);const u=s(async()=>{try{const a=await b.get(`/highlights/server/${l}/config/`);r(a)}catch{}finally{w(!1)}},"fetchConfig"),p=s(async()=>{try{const a=await b.get(`/highlights/server/${l}/messages/`);n(a)}catch{}},"fetchHighlights"),o=s(async()=>{try{await b.post(`/highlights/server/${l}/config/`,t),j.success("âœ… Highlight ayarlarÄ± kaydedildi")}catch{j.error("âŒ Kaydetme hatasÄ±")}},"saveConfig"),d=s(()=>{if(m.trim()){if(t.keywords.includes(m.toLowerCase())){j.warning("âš ï¸ Bu kelime zaten ekli");return}r({...t,keywords:[...t.keywords,m.toLowerCase()]}),T("")}},"addKeyword"),v=s(a=>{r({...t,keywords:t.keywords.filter(y=>y!==a)})},"removeKeyword"),c=s(async()=>{if(await K("TÃ¼m highlight geÃ§miÅŸini temizlemek istediÄŸinize emin misiniz?"))try{(await fetch(`${apiBaseUrl}/highlights/server/${l}/clear/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(j.success("âœ… GeÃ§miÅŸ temizlendi"),n([]))}catch{j.error("âŒ Temizleme hatasÄ±")}},"clearHighlights");return i.jsx("div",{className:"highlights-overlay",onClick:e,children:i.jsxs("div",{className:"highlights-panel",onClick:s(a=>a.stopPropagation(),"onClick"),children:[i.jsxs("div",{className:"highlights-header",children:[i.jsx("h2",{children:"âœ¨ Highlight Sistemi"}),i.jsx("button",{className:"close-btn",onClick:e,children:"Ã—"})]}),i.jsx("div",{className:"highlights-content",children:f?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"YÃ¼kleniyor..."})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"config-section",children:[i.jsxs("div",{className:"section-header",children:[i.jsx("h3",{children:"âš™ï¸ Ayarlar"}),i.jsxs("label",{className:"toggle-switch",children:[i.jsx("input",{type:"checkbox",checked:t.enabled,onChange:s(a=>r({...t,enabled:a.target.checked}),"onChange")}),i.jsx("span",{className:"toggle-slider"})]})]}),i.jsxs("div",{className:"keywords-section",children:[i.jsx("h4",{children:"ðŸ”‘ Anahtar Kelimeler"}),i.jsxs("div",{className:"keyword-input",children:[i.jsx("input",{type:"text",value:m,onChange:s(a=>T(a.target.value),"onChange"),onKeyPress:s(a=>a.key==="Enter"&&d(),"onKeyPress"),placeholder:"Kelime ekle..."}),i.jsx("button",{onClick:d,children:"âž•"})]}),t.keywords.length>0&&i.jsx("div",{className:"keywords-list",children:t.keywords.map((a,y)=>i.jsxs("div",{className:"keyword-tag",children:[i.jsx("span",{children:a}),i.jsx("button",{onClick:s(()=>v(a),"onClick"),children:"Ã—"})]},y))})]}),i.jsxs("div",{className:"config-options",children:[i.jsx("div",{className:"form-group",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:t.dm_notifications,onChange:s(a=>r({...t,dm_notifications:a.target.checked}),"onChange")}),i.jsx("span",{children:"DM bildirimleri gÃ¶nder"})]})}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Highlight Rengi"}),i.jsx("input",{type:"color",value:t.highlight_color,onChange:s(a=>r({...t,highlight_color:a.target.value}),"onChange")})]})]}),i.jsx("button",{className:"save-btn",onClick:o,children:"ðŸ’¾ Kaydet"})]}),i.jsxs("div",{className:"highlights-section",children:[i.jsxs("div",{className:"section-header",children:[i.jsxs("h3",{children:["ðŸ“ Highlight GeÃ§miÅŸi (",h.length,")"]}),h.length>0&&i.jsx("button",{className:"clear-btn",onClick:c,children:"ðŸ—‘ï¸ Temizle"})]}),h.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx("span",{className:"empty-icon",children:"âœ¨"}),i.jsx("p",{children:"HenÃ¼z highlight yok"})]}):i.jsx("div",{className:"highlights-list",children:h.map(a=>i.jsxs("div",{className:"highlight-card",children:[i.jsxs("div",{className:"highlight-header",children:[i.jsxs("div",{className:"highlight-author",children:[a.author_avatar?i.jsx("img",{src:a.author_avatar,alt:""}):i.jsx("div",{className:"default-avatar",children:"ðŸ‘¤"}),i.jsxs("div",{className:"author-info",children:[i.jsx("span",{className:"author-name",children:a.author_name}),i.jsxs("span",{className:"channel-name",children:["# ",a.channel_name]})]})]}),i.jsx("span",{className:"highlight-time",children:new Date(a.created_at).toLocaleString("tr-TR")})]}),i.jsx("div",{className:"highlight-content",children:i.jsx("p",{dangerouslySetInnerHTML:{__html:z.sanitize(a.content.replace(new RegExp(`(${t.keywords.join("|")})`,"gi"),`<mark style="background: ${t.highlight_color}; color: #000; padding: 2px 4px; border-radius: 4px;">$1</mark>`))}})})]},a.id))})]})]})})]})})},"HighlightsPanel");export{Y as default};
