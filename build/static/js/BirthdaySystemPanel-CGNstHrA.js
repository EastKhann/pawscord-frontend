import{r as n,ch as o}from"./react-core-B6hadH-M.js";import{g as B}from"./index-D_6pZib5.js";const A=({serverId:c,onClose:i})=>{const l=B(),[t,r]=n.useState({enabled:!1,announcement_channel_id:"",birthday_role_id:"",message_template:"ðŸŽ‰ BugÃ¼n @{user}'un doÄŸum gÃ¼nÃ¼! Mutlu yÄ±llar! ðŸŽ‚",give_role:!0,remove_role_after_day:!0}),[m,h]=n.useState([]),[d,g]=n.useState([]),[y,E]=n.useState([]),[R,p]=n.useState([]),[f,v]=n.useState(!0);n.useEffect(()=>{b(),_(),k(),N()},[c]);const b=async()=>{try{const e=await fetch(`${l}/birthday-system/server/${c}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();r(a)}}catch(e){console.error("Error:",e)}finally{v(!1)}},_=async()=>{try{const e=await fetch(`${l}/birthday-system/server/${c}/birthdays/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();h(a.all_birthdays),g(a.upcoming)}}catch(e){console.error("Error:",e)}},k=async()=>{try{const e=await fetch(`${l}/channels/server/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();E(a.filter(s=>s.type==="text"))}}catch(e){console.error("Error:",e)}},N=async()=>{try{const e=await fetch(`${l}/roles/server/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();p(a)}}catch(e){console.error("Error:",e)}},S=async()=>{try{(await fetch(`${l}/birthday-system/server/${c}/config/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?o.success("âœ… Ayarlar kaydedildi"):o.error("âŒ Kaydetme hatasÄ±")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},$=async()=>{try{(await fetch(`${l}/birthday-system/server/${c}/test/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&o.success("âœ… Test mesajÄ± gÃ¶nderildi")}catch{o.error("âŒ GÃ¶nderim hatasÄ±")}},u=e=>new Date(e).toLocaleDateString("tr-TR",{day:"numeric",month:"long"}),w=e=>{const a=new Date,s=new Date(e);return s.setFullYear(a.getFullYear()),s<a&&s.setFullYear(a.getFullYear()+1),Math.ceil((s-a)/(1e3*60*60*24))};return React.createElement("div",{className:"birthday-overlay",onClick:i},React.createElement("div",{className:"birthday-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"birthday-header"},React.createElement("h2",null,"ðŸŽ‚ DoÄŸum GÃ¼nÃ¼ Sistemi"),React.createElement("button",{className:"close-btn",onClick:i},"Ã—")),React.createElement("div",{className:"birthday-content"},f?React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"YÃ¼kleniyor...")):React.createElement(React.Fragment,null,React.createElement("div",{className:"config-section"},React.createElement("div",{className:"section-header"},React.createElement("h3",null,"âš™ï¸ Ayarlar"),React.createElement("label",{className:"toggle-switch"},React.createElement("input",{type:"checkbox",checked:t.enabled,onChange:e=>r({...t,enabled:e.target.checked})}),React.createElement("span",{className:"toggle-slider"}))),React.createElement("div",{className:"config-grid"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"ðŸ“¢ Duyuru KanalÄ±"),React.createElement("select",{value:t.announcement_channel_id,onChange:e=>r({...t,announcement_channel_id:e.target.value})},React.createElement("option",{value:""},"SeÃ§in"),y.map(e=>React.createElement("option",{key:e.id,value:e.id},"# ",e.name)))),React.createElement("div",{className:"form-group"},React.createElement("label",null,"ðŸŽ­ DoÄŸum GÃ¼nÃ¼ RolÃ¼"),React.createElement("select",{value:t.birthday_role_id,onChange:e=>r({...t,birthday_role_id:e.target.value})},React.createElement("option",{value:""},"Yok"),R.map(e=>React.createElement("option",{key:e.id,value:e.id},"@",e.name)))),React.createElement("div",{className:"form-group full-width"},React.createElement("label",null,"ðŸ’¬ Mesaj Åžablonu"),React.createElement("textarea",{value:t.message_template,onChange:e=>r({...t,message_template:e.target.value}),rows:"2"}),React.createElement("small",null,"KullanÄ±labilir: ","{user}",", ","{age}",", ","{server}")),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:t.give_role,onChange:e=>r({...t,give_role:e.target.checked})}),React.createElement("span",null,"DoÄŸum gÃ¼nÃ¼ rolÃ¼ ver"))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:t.remove_role_after_day,onChange:e=>r({...t,remove_role_after_day:e.target.checked})}),React.createElement("span",null,"Bir gÃ¼n sonra rolÃ¼ kaldÄ±r")))),React.createElement("div",{className:"config-actions"},React.createElement("button",{className:"save-btn",onClick:S},"ðŸ’¾ Kaydet"),React.createElement("button",{className:"test-btn",onClick:$},"âœ‰ï¸ Test MesajÄ±"))),React.createElement("div",{className:"upcoming-section"},React.createElement("h3",null,"ðŸ“… YaklaÅŸan DoÄŸum GÃ¼nleri"),d.length===0?React.createElement("div",{className:"empty-state-small"},React.createElement("p",null,"YaklaÅŸan doÄŸum gÃ¼nÃ¼ yok")):React.createElement("div",{className:"upcoming-list"},d.map(e=>React.createElement("div",{key:e.user_id,className:"upcoming-card"},React.createElement("div",{className:"upcoming-avatar"},e.user_avatar?React.createElement("img",{src:e.user_avatar,alt:""}):React.createElement("div",{className:"default-avatar"},"ðŸ‘¤")),React.createElement("div",{className:"upcoming-info"},React.createElement("h4",null,e.user_name),React.createElement("p",null,u(e.birthday))),React.createElement("div",{className:"upcoming-days"},React.createElement("span",{className:"days-badge"},w(e.birthday)," gÃ¼n")))))),React.createElement("div",{className:"all-birthdays-section"},React.createElement("h3",null,"ðŸ“‹ TÃ¼m DoÄŸum GÃ¼nleri (",m.length,")"),React.createElement("div",{className:"birthdays-grid"},m.map(e=>React.createElement("div",{key:e.user_id,className:"birthday-item"},React.createElement("span",{className:"user-name"},e.user_name),React.createElement("span",{className:"birthday-date"},u(e.birthday))))))))))};export{A as default};
