import{r as l,b_ as x,l as K,w as U,aT as L,c0 as Y,a1 as j,o as O,cq as q,dx as H,p as M,aN as P,ch as h,dy as Q,Y as G}from"./react-core-B6hadH-M.js";const J=({serverId:d,serverName:k,onClose:y})=>{const[u,m]=l.useState([]),[p,B]=l.useState([]),[b,f]=l.useState(!0),[i,C]=l.useState(""),[n,r]=l.useState("all"),[E,_]=l.useState("newest"),[R,D]=l.useState(null),[o,v]=l.useState({total:0,active:0,expired:0,appealed:0}),S=localStorage.getItem("access_token");l.useEffect(()=>{w()},[d]),l.useEffect(()=>{F()},[u,i,n,E]);const w=async()=>{f(!0);try{const e=await fetch(`/api/servers/${d}/bans/`,{headers:{Authorization:`Bearer ${S}`}});if(e.ok){const a=await e.json();m(a.bans||[]),v(a.stats||N([]))}else m([]),v(N([]))}catch{m([]),v(N([]))}f(!1)},N=e=>({total:e.length,active:e.filter(a=>a.status==="active").length,expired:e.filter(a=>a.status==="expired").length,appealed:e.filter(a=>a.status==="appealed"||a.appeal_status==="approved").length}),F=()=>{let e=[...u];if(i){const a=i.toLowerCase();e=e.filter(t=>t.user.username.toLowerCase().includes(a)||t.reason.toLowerCase().includes(a)||t.moderator.username.toLowerCase().includes(a))}n!=="all"&&(e=e.filter(a=>n==="appealed"?a.appeal_status==="approved"||a.status==="appealed":a.status===n)),e.sort((a,t)=>{const c=new Date(a.banned_at),s=new Date(t.banned_at);return E==="newest"?s-c:c-s}),B(e)},T=async e=>{try{const a=await fetch(`/api/servers/${d}/bans/${e.id}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${S}`}});h.success(`${e.user.username} yasaklaması kaldırıldı`),w()}catch{h.success(`${e.user.username} yasaklaması kaldırıldı`),m(u.map(t=>t.id===e.id?{...t,status:"expired",unbanned_at:new Date().toISOString()}:t))}},z=()=>{const e=[["Kullanıcı","Moderatör","Sebep","Durum","Tarih","Bitiş","İtiraz"].join(","),...p.map(s=>[s.user.username,s.moderator.username,`"${s.reason}"`,s.status,new Date(s.banned_at).toLocaleDateString("tr-TR"),s.expires_at?new Date(s.expires_at).toLocaleDateString("tr-TR"):"Süresiz",s.appeal_status||"Yok"].join(","))].join(`
`),a=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(a),c=document.createElement("a");c.href=t,c.download=`ban_history_${k}.csv`,c.click(),h.success("Ban geçmişi dışa aktarıldı")},g=e=>new Date(e).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),$=(e,a)=>{if(a==="approved"||e==="appealed")return React.createElement("span",{className:"status-badge appealed"},React.createElement(Q,null)," İtiraz Kabul");switch(e){case"active":return React.createElement("span",{className:"status-badge active"},React.createElement(x,null)," Aktif Ban");case"expired":return React.createElement("span",{className:"status-badge expired"},React.createElement(G,null)," Süresi Doldu");default:return React.createElement("span",{className:"status-badge"},e)}},A=e=>e?{pending:React.createElement("span",{className:"appeal-badge pending"},"İtiraz Bekliyor"),approved:React.createElement("span",{className:"appeal-badge approved"},"İtiraz Kabul"),denied:React.createElement("span",{className:"appeal-badge denied"},"İtiraz Reddedildi")}[e]:null;return React.createElement("div",{className:"banhistory-overlay",onClick:e=>e.target.className==="banhistory-overlay"&&y()},React.createElement("div",{className:"banhistory-panel"},React.createElement("div",{className:"panel-header"},React.createElement("h2",null,React.createElement(x,null)," Ban Geçmişi"),React.createElement("span",{className:"server-name"},k),React.createElement("button",{className:"close-btn",onClick:y},React.createElement(K,null))),React.createElement("div",{className:"stats-bar"},React.createElement("div",{className:"stat-item",onClick:()=>r("all")},React.createElement("span",{className:"stat-value"},o.total),React.createElement("span",{className:"stat-label"},"Toplam")),React.createElement("div",{className:"stat-item active",onClick:()=>r("active")},React.createElement("span",{className:"stat-value"},o.active),React.createElement("span",{className:"stat-label"},"Aktif")),React.createElement("div",{className:"stat-item expired",onClick:()=>r("expired")},React.createElement("span",{className:"stat-value"},o.expired),React.createElement("span",{className:"stat-label"},"Süresi Dolmuş")),React.createElement("div",{className:"stat-item appealed",onClick:()=>r("appealed")},React.createElement("span",{className:"stat-value"},o.appealed),React.createElement("span",{className:"stat-label"},"İtiraz Kabul"))),React.createElement("div",{className:"filters-bar"},React.createElement("div",{className:"search-box"},React.createElement(U,null),React.createElement("input",{type:"text",placeholder:"Kullanıcı, sebep veya moderatör ara...",value:i,onChange:e=>C(e.target.value)})),React.createElement("select",{value:n,onChange:e=>r(e.target.value)},React.createElement("option",{value:"all"},"Tüm Banlar"),React.createElement("option",{value:"active"},"Aktif"),React.createElement("option",{value:"expired"},"Süresi Dolmuş"),React.createElement("option",{value:"appealed"},"İtiraz Kabul")),React.createElement("select",{value:E,onChange:e=>_(e.target.value)},React.createElement("option",{value:"newest"},"En Yeni"),React.createElement("option",{value:"oldest"},"En Eski")),React.createElement("button",{className:"export-btn",onClick:z},React.createElement(L,null)," Dışa Aktar")),React.createElement("div",{className:"bans-list"},b?React.createElement("div",{className:"loading"},"Yükleniyor..."):p.length===0?React.createElement("div",{className:"empty-state"},React.createElement(Y,null),React.createElement("p",null,"Ban kaydı bulunamadı")):p.map(e=>React.createElement("div",{key:e.id,className:`ban-card ${e.status}`},React.createElement("div",{className:"ban-main",onClick:()=>D(R===e.id?null:e.id)},React.createElement("div",{className:"ban-user"},React.createElement("div",{className:"user-avatar"},e.user.avatar?React.createElement("img",{src:e.user.avatar,alt:""}):React.createElement(j,null)),React.createElement("div",{className:"user-info"},React.createElement("span",{className:"username"},e.user.username),React.createElement("span",{className:"discriminator"},"#",e.user.discriminator))),React.createElement("div",{className:"ban-reason"},React.createElement(O,null),React.createElement("span",null,e.reason)),React.createElement("div",{className:"ban-meta"},$(e.status,e.appeal_status),A(e.appeal_status)),React.createElement("div",{className:"ban-date"},React.createElement(q,null),React.createElement("span",null,g(e.banned_at))),React.createElement("button",{className:"expand-btn"},R===e.id?React.createElement(H,null):React.createElement(M,null))),R===e.id&&React.createElement("div",{className:"ban-details"},React.createElement("div",{className:"detail-row"},React.createElement("span",{className:"label"},"Moderatör:"),React.createElement("span",{className:"value"},e.moderator.username)),e.expires_at&&React.createElement("div",{className:"detail-row"},React.createElement("span",{className:"label"},"Bitiş Tarihi:"),React.createElement("span",{className:"value"},g(e.expires_at))),e.unbanned_at&&React.createElement("div",{className:"detail-row"},React.createElement("span",{className:"label"},"Yasak Kaldırıldı:"),React.createElement("span",{className:"value"},g(e.unbanned_at))),e.notes&&React.createElement("div",{className:"detail-row notes"},React.createElement("span",{className:"label"},"Notlar:"),React.createElement("span",{className:"value"},e.notes)),e.status==="active"&&React.createElement("div",{className:"detail-actions"},React.createElement("button",{className:"unban-btn",onClick:()=>T(e)},React.createElement(P,null)," Yasağı Kaldır"))))))))};export{J as default};
