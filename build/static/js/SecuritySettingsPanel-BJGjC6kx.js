import{r as i,n as e}from"./react-core-zXIKm1Jm.js";import{y as r}from"./ui-vendor-BGw4w3Ed.js";import{g as W}from"./index-3G_5S7Np.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-BBdoVeJd.js";import"./state-vendor-8NbFPBhQ.js";const Z=({onClose:v})=>{const[c,d]=i.useState(!1),[Y,$]=i.useState([]),[b,C]=i.useState([]),[f,P]=i.useState([]),[h,N]=i.useState([]),[u,w]=i.useState(""),[A,g]=i.useState(""),[m,S]=i.useState(""),[F,T]=i.useState(null),[o,p]=i.useState("2fa"),t=W(),n=localStorage.getItem("access_token");i.useEffect(()=>{j(),z(),k(),y()},[]);const j=async()=>{try{const a=await(await fetch(`${t}/security/status/`,{headers:{Authorization:`Bearer ${n}`}})).json();T(a),d(a.two_factor_enabled||!1)}catch(s){console.error("Error fetching security status:",s)}},z=async()=>{try{const a=await(await fetch(`${t}/2fa/methods/`,{headers:{Authorization:`Bearer ${n}`}})).json();$(a.methods||[])}catch(s){console.error("Error fetching 2FA methods:",s)}},k=async()=>{try{const a=await(await fetch(`${t}/security/sessions/`,{headers:{Authorization:`Bearer ${n}`}})).json();C(a.sessions||[])}catch(s){console.error("Error fetching sessions:",s)}},y=async()=>{try{const a=await(await fetch(`${t}/security/ip-whitelist/`,{headers:{Authorization:`Bearer ${n}`}})).json();P(a.whitelist||[])}catch(s){console.error("Error fetching IP whitelist:",s)}},E=async()=>{try{const s=await fetch(`${t}/security/2fa/enable/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(w(a.qr_code||""),N(a.backup_codes||[]),r.info("â„¹ï¸ QR kodu tarayÄ±n ve doÄŸrulama kodunu girin")):r.error(`âŒ ${a.error||"2FA etkinleÅŸtirilemedi"}`)}catch(s){console.error("Error enabling 2FA:",s),r.error("âŒ 2FA etkinleÅŸtirme hatasÄ±")}},I=async()=>{try{const s=await fetch(`${t}/security/2fa/verify-setup/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({code:A})}),a=await s.json();s.ok?(r.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),d(!0),w(""),g(""),j()):r.error(`âŒ ${a.error||"GeÃ§ersiz kod"}`)}catch(s){console.error("Error verifying 2FA:",s),r.error("âŒ DoÄŸrulama hatasÄ±")}},B=async()=>{if(window.confirm("2FA'yÄ± devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${t}/security/2fa/disable/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(r.info("â„¹ï¸ 2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±"),d(!1),j()):r.error(`âŒ ${a.error||"2FA devre dÄ±ÅŸÄ± bÄ±rakÄ±lamadÄ±"}`)}catch(s){console.error("Error disabling 2FA:",s),r.error("âŒ 2FA devre dÄ±ÅŸÄ± bÄ±rakma hatasÄ±")}},O=async()=>{try{const s=await fetch(`${t}/security/2fa/backup-codes/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(N(a.backup_codes||[]),r.success("âœ… Yedek kodlar oluÅŸturuldu")):r.error(`âŒ ${a.error||"Yedek kodlar oluÅŸturulamadÄ±"}`)}catch(s){console.error("Error getting backup codes:",s),r.error("âŒ Yedek kod hatasÄ±")}},_=async s=>{try{const a=await fetch(`${t}/security/sessions/${s}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),l=await a.json();a.ok?(r.success("âœ… Oturum sonlandÄ±rÄ±ldÄ±"),k()):r.error(`âŒ ${l.error||"Oturum sonlandÄ±rÄ±lamadÄ±"}`)}catch(a){console.error("Error revoking session:",a),r.error("âŒ Oturum sonlandÄ±rma hatasÄ±")}},D=async()=>{if(window.confirm("TÃ¼m oturumlarÄ± sonlandÄ±rmak istediÄŸinizden emin misiniz?"))try{const s=await fetch(`${t}/security/sessions/revoke-all/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?(r.success("âœ… TÃ¼m oturumlar sonlandÄ±rÄ±ldÄ±"),k()):r.error(`âŒ ${a.error||"Oturumlar sonlandÄ±rÄ±lamadÄ±"}`)}catch(s){console.error("Error revoking all sessions:",s),r.error("âŒ Toplu sonlandÄ±rma hatasÄ±")}},R=async()=>{if(!m.trim()){r.error("âŒ IP adresi gerekli");return}try{const s=await fetch(`${t}/security/ip-whitelist/add/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({ip_address:m})}),a=await s.json();s.ok?(r.success("âœ… IP beyaz listeye eklendi"),S(""),y()):r.error(`âŒ ${a.error||"IP eklenemedi"}`)}catch(s){console.error("Error adding IP:",s),r.error("âŒ IP ekleme hatasÄ±")}},L=async s=>{try{(await fetch(`${t}/security/ip-whitelist/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok?(r.success("âœ… IP beyaz listeden kaldÄ±rÄ±ldÄ±"),y()):r.error("âŒ IP kaldÄ±rÄ±lamadÄ±")}catch(a){console.error("Error removing IP:",a),r.error("âŒ IP kaldÄ±rma hatasÄ±")}},K=()=>{const s=h.join(`
`),a=new Blob([s],{type:"text/plain"}),l=window.URL.createObjectURL(a),x=document.createElement("a");x.href=l,x.download=`pawscord_backup_codes_${new Date().toISOString()}.txt`,x.click(),window.URL.revokeObjectURL(l),r.success("âœ… Yedek kodlar indirildi")};return e.jsx("div",{className:"security-overlay",onClick:v,children:e.jsxs("div",{className:"security-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"security-header",children:[e.jsx("h2",{children:"ğŸ”’ GÃ¼venlik AyarlarÄ±"}),e.jsx("button",{className:"close-btn",onClick:v,children:"âœ•"})]}),F&&e.jsxs("div",{className:"security-status",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸ”"}),e.jsx("span",{className:"status-label",children:"2FA:"}),e.jsx("span",{className:`status-value ${c?"active":"inactive"}`,children:c?"Aktif":"Pasif"})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸ’»"}),e.jsx("span",{className:"status-label",children:"Aktif Oturumlar:"}),e.jsx("span",{className:"status-value",children:b.length})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-icon",children:"ğŸŒ"}),e.jsx("span",{className:"status-label",children:"IP Whitelist:"}),e.jsx("span",{className:"status-value",children:f.length})]})]}),e.jsxs("div",{className:"security-tabs",children:[e.jsx("button",{className:`tab-btn ${o==="2fa"?"active":""}`,onClick:()=>p("2fa"),children:"ğŸ” 2FA"}),e.jsx("button",{className:`tab-btn ${o==="sessions"?"active":""}`,onClick:()=>p("sessions"),children:"ğŸ’» Oturumlar"}),e.jsx("button",{className:`tab-btn ${o==="ip"?"active":""}`,onClick:()=>p("ip"),children:"ğŸŒ IP Whitelist"})]}),e.jsxs("div",{className:"security-content",children:[o==="2fa"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("h3",{children:"Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama (2FA)"}),e.jsx("p",{children:"HesabÄ±nÄ±zÄ± ekstra bir gÃ¼venlik katmanÄ±yla koruyun"}),!c&&!u?e.jsx("div",{className:"enable-2fa",children:e.jsx("button",{className:"enable-btn",onClick:E,children:"2FA'yÄ± EtkinleÅŸtir"})}):c?e.jsxs("div",{className:"enabled-2fa",children:[e.jsxs("div",{className:"success-message",children:[e.jsx("span",{className:"success-icon",children:"âœ…"}),e.jsx("span",{children:"2FA aktif - HesabÄ±nÄ±z korunuyor"})]}),e.jsx("button",{className:"disable-btn",onClick:B,children:"2FA'yÄ± Devre DÄ±ÅŸÄ± BÄ±rak"}),e.jsx("button",{className:"backup-btn",onClick:O,children:"Yeni Yedek Kodlar OluÅŸtur"})]}):e.jsxs("div",{className:"setup-2fa",children:[e.jsxs("div",{className:"qr-section",children:[e.jsx("h4",{children:"1. QR Kodu TarayÄ±n"}),u&&e.jsx("img",{src:u,alt:"2FA QR Code",className:"qr-code"}),e.jsx("p",{children:"Authenticator uygulamanÄ±zla QR kodu tarayÄ±n"})]}),e.jsxs("div",{className:"verify-section",children:[e.jsx("h4",{children:"2. DoÄŸrulama Kodunu Girin"}),e.jsx("input",{type:"text",placeholder:"6 haneli kod",value:A,onChange:s=>g(s.target.value),maxLength:6,className:"verification-input"}),e.jsx("button",{className:"verify-btn",onClick:I,children:"DoÄŸrula ve EtkinleÅŸtir"})]}),h.length>0&&e.jsxs("div",{className:"backup-codes",children:[e.jsx("h4",{children:"3. Yedek KodlarÄ±nÄ±z"}),e.jsx("p",{children:"Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n!"}),e.jsx("div",{className:"codes-grid",children:h.map((s,a)=>e.jsx("div",{className:"backup-code",children:s},a))}),e.jsx("button",{className:"download-btn",onClick:K,children:"ğŸ“¥ KodlarÄ± Ä°ndir"})]})]})]}),o==="sessions"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"sessions-header",children:[e.jsx("h3",{children:"Aktif Oturumlar"}),e.jsx("button",{className:"revoke-all-btn",onClick:D,children:"TÃ¼mÃ¼nÃ¼ SonlandÄ±r"})]}),e.jsx("div",{className:"sessions-list",children:b.map(s=>e.jsxs("div",{className:"session-card",children:[e.jsxs("div",{className:"session-info",children:[e.jsxs("div",{className:"session-device",children:[e.jsx("span",{className:"device-icon",children:s.device_type==="mobile"?"ğŸ“±":"ğŸ’»"}),e.jsxs("div",{className:"device-details",children:[e.jsx("span",{className:"device-name",children:s.device_name||"Bilinmeyen Cihaz"}),e.jsx("span",{className:"device-location",children:s.location||"Bilinmeyen Konum"})]})]}),e.jsxs("div",{className:"session-meta",children:[e.jsxs("span",{className:"session-ip",children:["IP: ",s.ip_address]}),e.jsxs("span",{className:"session-time",children:["Son Aktivite: ",new Date(s.last_activity).toLocaleString("tr-TR")]})]})]}),s.is_current?e.jsx("span",{className:"current-badge",children:"Mevcut Oturum"}):e.jsx("button",{className:"revoke-btn",onClick:()=>_(s.id),children:"SonlandÄ±r"})]},s.id))})]}),o==="ip"&&e.jsxs("div",{className:"tab-content",children:[e.jsx("h3",{children:"IP Adresi Beyaz Listesi"}),e.jsx("p",{children:"Sadece izin verilen IP adreslerinden giriÅŸ yapÄ±n"}),e.jsxs("div",{className:"add-ip",children:[e.jsx("input",{type:"text",placeholder:"IP Adresi (Ã¶rn: 192.168.1.1)",value:m,onChange:s=>S(s.target.value),className:"ip-input"}),e.jsx("button",{className:"add-btn",onClick:R,children:"+ Ekle"})]}),e.jsx("div",{className:"ip-list",children:f.map(s=>e.jsxs("div",{className:"ip-card",children:[e.jsxs("div",{className:"ip-info",children:[e.jsx("span",{className:"ip-address",children:s.ip_address}),e.jsxs("span",{className:"ip-added",children:["Eklendi: ",new Date(s.created_at).toLocaleDateString("tr-TR")]})]}),e.jsx("button",{className:"remove-btn",onClick:()=>L(s.id),children:"KaldÄ±r"})]},s.id))})]})]})]})})};export{Z as default};
