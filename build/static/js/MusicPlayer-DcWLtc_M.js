import{r as t,n as e}from"./react-core-Cj7FUMmY.js";import{bZ as Q,bU as D,ca as K,cs as V,a_ as J,a$ as Y,ct as G,M as Z,cu as H,ad as W,b7 as X,K as ee,a as _}from"./icons-vendor-DsJCxoAK.js";import{s as i,t as r}from"./index-BZo1bI5x.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-By68PLJG.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-DGcbxrkI.js";import"./crypto-vendor-DK-7ILyQ.js";const le=({channelId:n})=>{const[l,y]=t.useState(!1),[c,m]=t.useState(null),[o,h]=t.useState([]),[x,N]=t.useState(70),[d,q]=t.useState(!1),[v,A]=t.useState(!1),[S,B]=t.useState(!1),[b,g]=t.useState(!1),[$,p]=t.useState(!1),[j,T]=t.useState(""),[C,P]=t.useState(0),[k,E]=t.useState(0),u=t.useRef(null);t.useEffect(()=>{z();const s=setInterval(()=>{l&&u.current&&(P(u.current.currentTime),E(u.current.duration))},1e3);return()=>clearInterval(s)},[l]);const z=async()=>{try{const s=await fetch(`${i}/music/${n}/status/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();m(a.current_track),h(a.queue||[]),y(a.is_playing),N(a.volume||70)}}catch{}},R=async()=>{try{(await fetch(`${i}/music/${n}/${l?"pause":"play"}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(y(!l),r.success(l?"⏸️ Durakladı":"▶️ Çalıyor"))}catch{r.error("❌ İşlem başarısız")}},U=async()=>{try{const s=await fetch(`${i}/music/${n}/skip/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();m(a.current_track),r.success("⏭️ Sonraki şarkı")}}catch{r.error("❌ Atlama başarısız")}},M=async()=>{try{const s=await fetch(`${i}/music/${n}/previous/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();m(a.current_track),r.success("⏮️ Önceki şarkı")}}catch{r.error("❌ Geri alma başarısız")}},O=async s=>{N(s);try{await fetch(`${i}/music/${n}/volume/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({volume:s})})}catch{}},w=async()=>{if(!j.trim()){r.error("❌ URL girin");return}try{const s=await fetch(`${i}/music/${n}/add/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({url:j})});if(s.ok){const a=await s.json();h([...o,a.track]),T(""),p(!1),r.success("✅ Sıraya eklendi")}else r.error("❌ Eklenemedi")}catch{r.error("❌ Bağlantı hatası")}},I=async s=>{try{(await fetch(`${i}/music/${n}/remove/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(h(o.filter(f=>f.id!==s)),r.success("✅ Sıradan çıkarıldı"))}catch{r.error("❌ İşlem başarısız")}},F=s=>{if(!s||isNaN(s))return"0:00";const a=Math.floor(s/60),f=Math.floor(s%60);return`${a}:${f.toString().padStart(2,"0")}`},L=s=>{const a=s.target.value/100*k;P(a),u.current&&(u.current.currentTime=a)};return e.jsxs("div",{className:"music-player",children:[e.jsx("audio",{ref:u,src:c?.audio_url}),e.jsxs("div",{className:"player-main",children:[e.jsx("div",{className:"track-info",children:c?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:c.thumbnail||"/default-music.png",alt:c.title,className:"track-thumbnail"}),e.jsxs("div",{className:"track-details",children:[e.jsx("div",{className:"track-title",children:c.title}),e.jsx("div",{className:"track-artist",children:c.artist||"Bilinmeyen Sanatçı"})]}),e.jsxs("div",{className:"track-source",children:[c.source==="youtube"&&e.jsx(Q,{className:"source-icon youtube"}),c.source==="spotify"&&e.jsx(D,{className:"source-icon spotify"})]})]}):e.jsx("div",{className:"no-track",children:e.jsx("span",{children:"Şarkı seçilmedi"})})}),e.jsxs("div",{className:"player-controls",children:[e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:`control-btn ${v?"active":""}`,onClick:()=>A(!v),title:"Karıştır",children:e.jsx(K,{})}),e.jsx("button",{className:"control-btn",onClick:M,title:"Önceki",children:e.jsx(V,{})}),e.jsx("button",{className:"control-btn play-btn",onClick:R,children:l?e.jsx(J,{}):e.jsx(Y,{})}),e.jsx("button",{className:"control-btn",onClick:U,title:"Sonraki",children:e.jsx(G,{})}),e.jsx("button",{className:`control-btn ${S?"active":""}`,onClick:()=>B(!S),title:"Tekrarla",children:e.jsx(Z,{})})]}),e.jsxs("div",{className:"progress-container",children:[e.jsx("span",{className:"time-display",children:F(C)}),e.jsx("input",{type:"range",className:"progress-bar",min:"0",max:"100",value:C/k*100||0,onChange:L}),e.jsx("span",{className:"time-display",children:F(k)})]})]}),e.jsxs("div",{className:"player-extras",children:[e.jsxs("button",{className:"extra-btn",onClick:()=>g(!b),title:"Sıra",children:[e.jsx(H,{}),o.length>0&&e.jsx("span",{className:"queue-count",children:o.length})]}),e.jsx("button",{className:"extra-btn",onClick:()=>p(!$),title:"Şarkı Ekle",children:e.jsx(W,{})}),e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{className:"extra-btn",onClick:()=>q(!d),children:d||x===0?e.jsx(X,{}):e.jsx(ee,{})}),e.jsx("input",{type:"range",className:"volume-slider",min:"0",max:"100",value:d?0:x,onChange:s=>O(parseInt(s.target.value))}),e.jsxs("span",{className:"volume-display",children:[d?0:x,"%"]})]})]})]}),b&&e.jsxs("div",{className:"queue-panel",children:[e.jsxs("div",{className:"queue-header",children:[e.jsxs("h3",{children:["Sıra (",o.length,")"]}),e.jsx("button",{className:"close-btn",onClick:()=>g(!1),children:e.jsx(_,{})})]}),e.jsx("div",{className:"queue-list",children:o.length===0?e.jsx("div",{className:"queue-empty",children:"Sıra boş"}):o.map((s,a)=>e.jsxs("div",{className:"queue-item",children:[e.jsx("span",{className:"queue-index",children:a+1}),e.jsx("img",{src:s.thumbnail,alt:s.title,className:"queue-thumbnail"}),e.jsxs("div",{className:"queue-track-info",children:[e.jsx("div",{className:"queue-track-title",children:s.title}),e.jsx("div",{className:"queue-track-artist",children:s.artist||"Bilinmeyen"})]}),e.jsx("button",{className:"remove-btn",onClick:()=>I(s.id),title:"Sıradan Çıkar",children:e.jsx(_,{})})]},s.id))})]}),$&&e.jsx("div",{className:"add-track-modal",children:e.jsxs("div",{className:"add-track-content",children:[e.jsx("h3",{children:"Şarkı Ekle"}),e.jsx("input",{type:"text",className:"track-url-input",placeholder:"YouTube veya Spotify URL'si girin...",value:j,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&w()}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>p(!1),children:"İptal"}),e.jsx("button",{className:"btn-add",onClick:w,children:"Ekle"})]})]})})]})};export{le as default};
