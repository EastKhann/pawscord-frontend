var L=Object.defineProperty;var l=(a,i)=>L(a,"name",{value:i,configurable:!0});import{r as d,j as s}from"./react-core-Djgtqrmb.js";import{d as $,c as B,a as S,t as O,a1 as T,z as K,ax as P,C as R,w as f,a0 as G,k as Y,R as q}from"./icons-vendor-BW7dxHkX.js";import{t as I}from"./index-B9TNnJpS.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const as=l(({serverId:a,apiBaseUrl:i,onClose:j})=>{const[m,h]=d.useState([]),[o,x]=d.useState(!0),[n,v]=d.useState("all"),[c,p]=d.useState(""),[y,N]=d.useState(null),[u,D]=d.useState({total:0,unresolved:0,critical:0,resolved_today:0}),_={critical:{label:"Kritik",color:"#ef4444",icon:s.jsx(q,{})},high:{label:"Yüksek",color:"#f97316",icon:s.jsx($,{})},medium:{label:"Orta",color:"#f59e0b",icon:s.jsx(Y,{})},low:{label:"Düşük",color:"#3b82f6",icon:s.jsx(T,{})}},C={brute_force:"Brute Force Saldırısı",suspicious_login:"Şüpheli Giriş",unusual_activity:"Olağandışı Aktivite",permission_abuse:"Yetki Suistimali",spam_detected:"Spam Algılandı",raid_attempt:"Raid Girişimi",api_abuse:"API Suistimali",unauthorized_access:"Yetkisiz Erişim Denemesi"};d.useEffect(()=>{k(),z();const e=setInterval(k,3e4);return()=>clearInterval(e)},[a]);const k=l(async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${i}/security/alerts/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const r=await t.json();h(r.alerts||[])}}catch{}finally{x(!1)}},"fetchAlerts"),z=l(async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${i}/security/alerts/stats/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const r=await t.json();D(r)}}catch{}},"fetchStats"),w=l(async(e,t)=>{try{const r=localStorage.getItem("access_token");(await fetch(`${i}/security/alerts/${e}/resolve/`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({resolution:t})})).ok&&(I.success("✅ Uyarı çözümlendi"),h(b=>b.map(g=>g.id===e?{...g,resolved:!0,resolution:t}:g)),N(null),z())}catch{}},"resolveAlert"),E=l(async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${i}/security/alerts/${e}/dismiss/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&(I.success("Uyarı yok sayıldı"),h(F=>F.filter(b=>b.id!==e)))}catch{}},"dismissAlert"),A=m.filter(e=>{const t=e.message?.toLowerCase().includes(c.toLowerCase())||e.source_ip?.includes(c)||e.user_info?.username?.toLowerCase().includes(c.toLowerCase()),r=n==="all"||n==="unresolved"&&!e.resolved||n==="resolved"&&e.resolved||n==="critical"&&e.severity==="critical";return t&&r});return s.jsx("div",{className:"security-alerts-overlay",onClick:j,children:s.jsxs("div",{className:"security-alerts-panel",onClick:l(e=>e.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("h2",{children:[s.jsx($,{})," Güvenlik Uyarıları"]}),s.jsxs("div",{className:"header-actions",children:[s.jsx("button",{className:"refresh-btn",onClick:k,children:s.jsx(B,{})}),s.jsx("button",{className:"close-btn",onClick:j,children:s.jsx(S,{})})]})]}),s.jsxs("div",{className:"stats-bar",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-value",children:u.total}),s.jsx("span",{className:"stat-label",children:"Toplam"})]}),s.jsxs("div",{className:"stat-item danger",children:[s.jsx("span",{className:"stat-value",children:u.unresolved}),s.jsx("span",{className:"stat-label",children:"Bekleyen"})]}),s.jsxs("div",{className:"stat-item critical",children:[s.jsx("span",{className:"stat-value",children:u.critical}),s.jsx("span",{className:"stat-label",children:"Kritik"})]}),s.jsxs("div",{className:"stat-item success",children:[s.jsx("span",{className:"stat-value",children:u.resolved_today}),s.jsx("span",{className:"stat-label",children:"Bugün Çözülen"})]})]}),s.jsxs("div",{className:"toolbar",children:[s.jsxs("div",{className:"search-box",children:[s.jsx(O,{}),s.jsx("input",{type:"text",placeholder:"Uyarı, IP veya kullanıcı ara...",value:c,onChange:l(e=>p(e.target.value),"onChange")})]}),s.jsx("div",{className:"filter-buttons",children:["all","unresolved","resolved","critical"].map(e=>s.jsxs("button",{className:`filter-btn ${n===e?"active":""}`,onClick:l(()=>v(e),"onClick"),children:[e==="all"&&"Tümü",e==="unresolved"&&"Bekleyen",e==="resolved"&&"Çözülen",e==="critical"&&"Kritik"]},e))})]}),s.jsx("div",{className:"panel-content",children:o?s.jsx("div",{className:"loading",children:"Yükleniyor..."}):A.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx(T,{}),s.jsx("p",{children:"Güvenlik uyarısı bulunmuyor"}),s.jsx("span",{children:"Sisteminiz güvende görünüyor"})]}):s.jsx("div",{className:"alerts-list",children:A.map(e=>s.jsx(V,{alert:e,severityLevels:_,alertTypes:C,onView:l(()=>N(e),"onView"),onDismiss:l(()=>E(e.id),"onDismiss"),onResolve:l(t=>w(e.id,t),"onResolve")},e.id))})}),y&&s.jsx(H,{alert:y,severityLevels:_,alertTypes:C,onClose:l(()=>N(null),"onClose"),onResolve:l(e=>w(y.id,e),"onResolve")})]})})},"SecurityAlertsPanel"),V=l(({alert:a,severityLevels:i,alertTypes:j,onView:m,onDismiss:h,onResolve:o})=>{const x=i[a.severity]||i.low;return s.jsxs("div",{className:`alert-card ${a.severity} ${a.resolved?"resolved":""}`,children:[s.jsx("div",{className:"alert-severity",style:{background:x.color},children:x.icon}),s.jsxs("div",{className:"alert-content",children:[s.jsxs("div",{className:"alert-header",children:[s.jsx("span",{className:"alert-type",children:j[a.type]||a.type}),s.jsxs("span",{className:"alert-time",children:[s.jsx(K,{})," ",new Date(a.created_at).toLocaleString("tr-TR")]})]}),s.jsx("p",{className:"alert-message",children:a.message}),s.jsxs("div",{className:"alert-meta",children:[a.source_ip&&s.jsxs("span",{children:[s.jsx(P,{})," ",a.source_ip]}),a.user_info&&s.jsxs("span",{children:[s.jsx(R,{})," ",a.user_info.username]}),a.resolved&&s.jsxs("span",{className:"resolved-badge",children:[s.jsx(f,{})," Çözümlendi"]})]})]}),s.jsxs("div",{className:"alert-actions",children:[s.jsx("button",{className:"view-btn",onClick:m,children:s.jsx(G,{})}),!a.resolved&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"resolve-btn",onClick:l(()=>o("Hızlı çözüm"),"onClick"),children:s.jsx(f,{})}),s.jsx("button",{className:"dismiss-btn",onClick:h,children:s.jsx(S,{})})]})]})]})},"AlertCard"),H=l(({alert:a,severityLevels:i,alertTypes:j,onClose:m,onResolve:h})=>{const[o,x]=d.useState(""),n=i[a.severity]||i.low,v=["False positive - Normal aktivite","Kullanıcı uyarıldı","IP engellendi","Hesap askıya alındı","İncelendi - Aksiyon gerekmiyor"];return s.jsx("div",{className:"modal-overlay",onClick:m,children:s.jsxs("div",{className:"alert-detail-modal",onClick:l(c=>c.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"modal-header",style:{borderLeftColor:n.color},children:[s.jsxs("div",{className:"severity-badge",style:{background:n.color},children:[n.icon," ",n.label]}),s.jsx("button",{className:"close-modal",onClick:m,children:s.jsx(S,{})})]}),s.jsxs("div",{className:"modal-content",children:[s.jsx("h3",{children:j[a.type]||a.type}),s.jsx("p",{className:"detail-message",children:a.message}),s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Detaylar"}),s.jsxs("div",{className:"detail-grid",children:[s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(K,{})," Zaman"]}),s.jsx("span",{children:new Date(a.created_at).toLocaleString("tr-TR")})]}),a.source_ip&&s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(P,{})," Kaynak IP"]}),s.jsx("span",{className:"mono",children:a.source_ip})]}),a.user_info&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(R,{})," Kullanıcı"]}),s.jsx("span",{children:a.user_info.username})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:"Kullanıcı ID"}),s.jsx("span",{className:"mono",children:a.user_info.id})]})]}),a.location&&s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:"Konum"}),s.jsx("span",{children:a.location})]})]})]}),a.additional_data&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Ek Veriler"}),s.jsx("pre",{className:"json-data",children:JSON.stringify(a.additional_data,null,2)})]}),!a.resolved&&s.jsxs("div",{className:"resolution-section",children:[s.jsx("h4",{children:"Çözüm"}),s.jsx("div",{className:"quick-resolutions",children:v.map((c,p)=>s.jsx("button",{className:`quick-res-btn ${o===c?"active":""}`,onClick:l(()=>x(c),"onClick"),children:c},p))}),s.jsx("textarea",{value:o,onChange:l(c=>x(c.target.value),"onChange"),placeholder:"Veya özel bir çözüm notu yazın...",rows:"3"})]})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"cancel-btn",onClick:m,children:"Kapat"}),!a.resolved&&s.jsxs("button",{className:"resolve-btn",onClick:l(()=>h(o||"Çözümlendi"),"onClick"),disabled:!o,children:[s.jsx(f,{})," Çözümle"]})]})]})})},"AlertDetailModal");export{as as default};
