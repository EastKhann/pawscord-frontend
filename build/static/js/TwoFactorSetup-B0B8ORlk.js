import{r as o,n as a}from"./react-core-DA61mcWm.js";import{t as k}from"./index-1Alyfdkn.js";import{Q as D}from"./media-vendor-tDmQW26m.js";import"./ui-vendor-BrUQ4r0A.js";import"./editor-vendor-D9c4a6XZ.js";import"./router-vendor-2etVlp2q.js";import"./icons-vendor-DRtjID0N.js";import"./state-vendor-CjqIs3K2.js";import"./crypto-vendor-DiGIAuUm.js";const U=({onClose:i,fetchWithAuth:f,apiBaseUrl:x})=>{const[r,d]=o.useState(1),[j,b]=o.useState(""),[u,y]=o.useState(""),[w,N]=o.useState([]),[n,g]=o.useState(""),[m,s]=o.useState(""),[h,c]=o.useState(!1);o.useEffect(()=>{r===1&&v()},[r]);const v=async()=>{c(!0);try{const e=await f(`${x}/auth/2fa/setup/`,{method:"POST"});if(e.ok){const t=await e.json();y(t.secret);const l=await D.toDataURL(t.otpauth_url);b(l)}else{const t=await e.json();s(t.error||"QR kod oluÅŸturulamadÄ±")}}catch{s("BaÄŸlantÄ± hatasÄ±")}finally{c(!1)}},C=async()=>{if(n.length!==6){s("6 haneli kod giriniz");return}c(!0),s("");try{const e=await f(`${x}/auth/2fa/verify/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,secret:u})});if(e.ok){const t=await e.json();N(t.backup_codes),d(3)}else{const t=await e.json();s(t.error||"GeÃ§ersiz kod")}}catch{s("DoÄŸrulama hatasÄ±")}finally{c(!1)}},R=()=>{const e=w.join(`
`),t=new Blob([e],{type:"text/plain"}),l=URL.createObjectURL(t),p=document.createElement("a");p.href=l,p.download="pawscord-backup-codes.txt",p.click(),URL.revokeObjectURL(l)},S=()=>{k.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),i(),window.location.reload()};return a.jsx("div",{className:"twofa-modal-overlay",onClick:i,children:a.jsxs("div",{className:"twofa-modal-content",onClick:e=>e.stopPropagation(),children:[a.jsx("button",{className:"twofa-close-btn",onClick:i,children:"Ã—"}),a.jsx("h2",{children:"ðŸ” Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama"}),r===1&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 1: QR Kodu Tara"}),a.jsx("p",{children:"Google Authenticator veya Authy uygulamasÄ±yla bu QR kodu tarayÄ±n:"}),h?a.jsx("div",{className:"twofa-loading",children:"QR kod oluÅŸturuluyor..."}):j?a.jsxs(a.Fragment,{children:[a.jsx("img",{src:j,alt:"QR Code",className:"twofa-qr-code"}),a.jsxs("div",{className:"twofa-secret",children:[a.jsx("p",{children:a.jsx("strong",{children:"Manuel Kod:"})}),a.jsx("code",{children:u}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(u),k.success("âœ… Kod kopyalandÄ±!")},className:"twofa-copy-btn",children:"ðŸ“‹ Kopyala"})]}),a.jsx("button",{onClick:()=>d(2),className:"twofa-next-btn",children:"Ä°leri â†’"})]}):a.jsx("div",{className:"twofa-error",children:m})]}),r===2&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 2: DoÄŸrulama Kodu"}),a.jsx("p",{children:"Authenticator uygulamasÄ±ndaki 6 haneli kodu girin:"}),a.jsx("input",{type:"text",maxLength:"6",value:n,onChange:e=>g(e.target.value.replace(/\D/g,"")),placeholder:"000000",className:"twofa-code-input",autoFocus:!0}),m&&a.jsx("div",{className:"twofa-error",children:m}),a.jsxs("div",{className:"twofa-buttons",children:[a.jsx("button",{onClick:()=>d(1),className:"twofa-back-btn",children:"â† Geri"}),a.jsx("button",{onClick:C,disabled:h||n.length!==6,className:"twofa-verify-btn",children:h?"DoÄŸrulanÄ±yor...":"DoÄŸrula"})]})]}),r===3&&a.jsxs("div",{className:"twofa-step",children:[a.jsx("h3",{children:"AdÄ±m 3: Yedek Kodlar"}),a.jsx("p",{className:"twofa-warning",children:"âš ï¸ Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n! Telefonunuza eriÅŸemediÄŸinizde bu kodlarÄ± kullanabilirsiniz."}),a.jsx("div",{className:"twofa-backup-codes",children:w.map((e,t)=>a.jsx("div",{className:"twofa-backup-code",children:e},t))}),a.jsxs("div",{className:"twofa-buttons",children:[a.jsx("button",{onClick:R,className:"twofa-download-btn",children:"ðŸ’¾ Ä°ndir"}),a.jsx("button",{onClick:S,className:"twofa-complete-btn",children:"âœ… Tamamla"})]})]})]})})};export{U as default};
