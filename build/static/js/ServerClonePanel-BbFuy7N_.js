import{r,n as s}from"./react-core-zXIKm1Jm.js";import{b3 as C,C as L,a as R,z as U,bp as S,ap as l,a5 as w,a2 as k,aY as y,m as b,t as J,J as V,d as _}from"./icons-vendor-BBdoVeJd.js";import{g as F}from"./index-CiRJFVVz.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const X=({serverId:d,serverName:m,onClose:p,onClone:x})=>{const[$,g]=r.useState(!0),[E,P]=r.useState(!1),[n,j]=r.useState(null),[i,h]=r.useState(""),[a,T]=r.useState({channels:!0,roles:!0,emojis:!0,settings:!0,permissions:!0,categories:!0}),[v,N]=r.useState(0),[A,u]=r.useState(""),f=localStorage.getItem("access_token");r.useEffect(()=>{O()},[d]);const O=async()=>{g(!0);try{const e=await fetch(`${F()}/api/servers/${d}/clone-data/`,{headers:{Authorization:`Bearer ${f}`}});if(e.ok){const c=await e.json();j(c),h(`${c.name||m} (Copy)`)}else j({id:d,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),h(`${m} (Copy)`)}catch(e){console.error("Error loading server data:",e),j({id:d,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),h(`${m} (Copy)`)}g(!1)},o=e=>{T(c=>({...c,[e]:!c[e]}))},B=async()=>{if(i.trim()){P(!0),N(0),u("Starting clone process...");try{const e=await fetch(`${F()}/api/servers/${d}/clone/`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({name:i,options:a})}),c=[{progress:20,status:"Creating server..."},{progress:40,status:"Setting up channels..."},{progress:60,status:"Configuring roles..."},{progress:80,status:"Applying settings..."},{progress:100,status:"Complete!"}];for(const t of c)await new Promise(D=>setTimeout(D,300)),N(t.progress),u(t.status);if(e.ok){const t=await e.json();alert(`Server "${i}" created successfully!`),x&&x({name:i,...a,newServerId:t.server_id})}else{const t=await e.json();alert(t.error||"Failed to clone server")}}catch(e){console.error("Error cloning server:",e),alert("Failed to clone server")}p()}},z=()=>Object.values(a).filter(Boolean).length;return $?s.jsx("div",{className:"serverclone-overlay",onClick:p,children:s.jsx("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation(),children:s.jsx("div",{className:"loading",children:"Loading server data..."})})}):s.jsx("div",{className:"serverclone-overlay",onClick:p,children:s.jsxs("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(C,{})," Clone Server"]}),s.jsxs("span",{className:"source-server",children:[s.jsx(L,{})," ",n?.name]})]}),s.jsx("button",{className:"close-btn",onClick:p,children:s.jsx(R,{})})]}),E?s.jsxs("div",{className:"cloning-progress",children:[s.jsx("div",{className:"progress-icon",children:s.jsx(U,{className:"spinning"})}),s.jsx("h3",{children:"Cloning Server..."}),s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${v}%`}})}),s.jsx("span",{className:"progress-status",children:A}),s.jsxs("span",{className:"progress-percent",children:[v,"%"]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"content",children:[s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"New Server Name"}),s.jsx("input",{type:"text",value:i,onChange:e=>h(e.target.value),placeholder:"Enter server name",maxLength:100})]}),s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:["What to Clone (",z(),"/6)"]}),s.jsxs("div",{className:"options-grid",children:[s.jsxs("div",{className:`option-card ${a.categories?"selected":""}`,onClick:()=>o("categories"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(S,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Categories"}),s.jsxs("span",{className:"option-count",children:[n?.categories?.length||0," categories"]})]}),a.categories&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.channels?"selected":""}`,onClick:()=>o("channels"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(w,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Channels"}),s.jsxs("span",{className:"option-count",children:[n?.channels?.length||0," channels"]})]}),a.channels&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.roles?"selected":""}`,onClick:()=>o("roles"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(k,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Roles"}),s.jsxs("span",{className:"option-count",children:[n?.roles?.length||0," roles"]})]}),a.roles&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.permissions?"selected":""}`,onClick:()=>o("permissions"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(y,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Permissions"}),s.jsx("span",{className:"option-count",children:"Channel overrides"})]}),a.permissions&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.emojis?"selected":""}`,onClick:()=>o("emojis"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(b,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Emojis"}),s.jsxs("span",{className:"option-count",children:[n?.emojis?.length||0," emojis"]})]}),a.emojis&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.settings?"selected":""}`,onClick:()=>o("settings"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(y,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Settings"}),s.jsx("span",{className:"option-count",children:"Server config"})]}),a.settings&&s.jsx(l,{className:"check"})]})]})]}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Preview"}),s.jsxs("div",{className:"preview-card",children:[s.jsxs("div",{className:"preview-header",children:[s.jsx("div",{className:"preview-icon",children:i.charAt(0).toUpperCase()}),s.jsxs("div",{className:"preview-info",children:[s.jsx("span",{className:"preview-name",children:i||"New Server"}),s.jsxs("span",{className:"preview-meta",children:[s.jsx(J,{})," 1 member"]})]})]}),s.jsxs("div",{className:"preview-items",children:[a.categories&&s.jsxs("span",{className:"preview-item",children:[s.jsx(S,{})," ",n?.categories?.length," Categories"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(w,{})," ",n?.channels?.filter(e=>e.type==="text").length," Text"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(V,{})," ",n?.channels?.filter(e=>e.type==="voice").length," Voice"]}),a.roles&&s.jsxs("span",{className:"preview-item",children:[s.jsx(k,{})," ",n?.roles?.length," Roles"]}),a.emojis&&s.jsxs("span",{className:"preview-item",children:[s.jsx(b,{})," ",n?.emojis?.length," Emojis"]})]})]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(_,{}),s.jsxs("div",{children:[s.jsx("strong",{children:"Note:"})," Members, messages, and message history will not be cloned. Only server structure and settings will be copied."]})]})]}),s.jsxs("div",{className:"panel-footer",children:[s.jsx("button",{className:"cancel-btn",onClick:p,children:"Cancel"}),s.jsxs("button",{className:"clone-btn",onClick:B,disabled:!i.trim(),children:[s.jsx(C,{})," Clone Server"]})]})]})]})})};export{X as default};
