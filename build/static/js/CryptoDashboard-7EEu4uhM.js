import{r as s,j as e}from"./react-vendor-D8Fi5F9E.js";import{L as Q}from"./router-vendor-CTPwQFnc.js";import{y as q,G as ee,O as te,P as ne,Q as oe,R as re,a as N}from"./icons-vendor-CKPm393i.js";import{a as se,t as E,g as ae,b as ie}from"./index-DMOkrgup.js";import"./media-vendor-Dp18sh1g.js";import"./crypto-vendor-Cz32ecGD.js";import"./state-vendor-De5qIGw3.js";const le=()=>{const[t,a]=s.useState(window.innerWidth<=768);return s.useEffect(()=>{const d=()=>a(window.innerWidth<=768);return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),t},T=t=>t==null?"-":typeof t=="object"?JSON.stringify(t):String(t),P=t=>!t||t==="YÃ¼kleniyor..."||t==="Fiyat Bekleniyor..."?t:parseFloat(t).toString(),H=ae(),de=ie(),ce=`${H}/trading/dashboard/`,pe=t=>{if(!t)return"{}";let a=t;if(a=a.replace(/:\s*None/g,": null"),a=a.replace(/:\s*True/g,": true"),a=a.replace(/:\s*False/g,": false"),a=a.replace(/:\s*Infinity/g,": 0"),a=a.replace(/:\s*NaN/g,": 0"),a.includes("'"))try{a=a.replace(/'/g,'"')}catch{}return a},_=({price:t})=>{const[a,d]=s.useState(t),[p,S]=s.useState("");s.useEffect(()=>{if(!t||t==="YÃ¼kleniyor..."||t==="Fiyat Bekleniyor...")return;const u=parseFloat(t),g=parseFloat(a);u>g?S("flash-green"):u<g&&S("flash-red"),d(t);const f=setTimeout(()=>S(""),1e3);return()=>clearTimeout(f)},[t]);const k=P(t);return e.jsx("span",{className:p,style:{fontSize:"1em",fontWeight:"bold",color:t==="YÃ¼kleniyor..."||t==="Fiyat Bekleniyor..."?"#999":p==="flash-green"?"#23a559":p==="flash-red"?"#da373c":"#23a559",transition:"color 0.5s ease",display:"block",marginTop:2},children:t!=="YÃ¼kleniyor..."&&t!=="Fiyat Bekleniyor..."?`$${k}`:t})},xe=({coin:t,initialPrice:a,livePrices:d,portfolio:p,onClose:S,onTrade:k})=>{const[u,g]=s.useState(""),[f,y]=s.useState(""),[c,I]=s.useState("BUY"),O=Object.keys(d).find(i=>i===t||i===`${t}USDT`)||t,W=d[O]||a,B=parseFloat(String(W).replace(/,/g,"").replace("$","")),z=parseFloat(p?.balance||0),F=(()=>{if(!p?.holdings)return 0;const m=Object.keys(p.holdings).find(v=>v.includes(t));return m?parseFloat(p.holdings[m]):0})();s.useEffect(()=>{if(u&&!isNaN(parseFloat(u))){const i=(parseFloat(u)*B).toFixed(2);y(i)}},[B]);const A=i=>{if(g(i),!i||isNaN(parseFloat(i))){y("");return}const m=(parseFloat(i)*B).toFixed(2);y(m)},L=i=>{if(y(i),!i||isNaN(parseFloat(i))){g("");return}const m=(parseFloat(i)/B).toFixed(6);g(parseFloat(m).toString())},C=()=>{c==="BUY"?L(z.toString()):A(F.toString())};return e.jsx("div",{style:n.modalOverlay,children:e.jsxs("div",{style:n.modalContent,children:[e.jsxs("div",{style:n.modalHeader,children:[e.jsxs("h3",{children:[c==="BUY"?"ðŸŸ¢ AlÄ±ÅŸ":"ðŸ”´ SatÄ±ÅŸ",": ",t]}),e.jsx("button",{onClick:S,style:n.closeBtn,children:e.jsx(N,{})})]}),e.jsxs("div",{style:{backgroundColor:"#2b2d31",padding:10,borderRadius:8,marginBottom:15,textAlign:"center"},children:[e.jsx("span",{style:{color:"#999",fontSize:"0.9em"},children:"CanlÄ± Piyasa FiyatÄ±"}),e.jsx("div",{style:{fontSize:"1.4em",fontWeight:"bold"},children:e.jsx(_,{price:W})})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15},children:[e.jsx("button",{onClick:()=>{I("BUY"),g(""),y("")},style:{...n.modeBtn,backgroundColor:c==="BUY"?"#23a559":"#2b2d31",opacity:c==="BUY"?1:.5},children:"AL (Buy)"}),e.jsx("button",{onClick:()=>{I("SELL"),g(""),y("")},style:{...n.modeBtn,backgroundColor:c==="SELL"?"#da373c":"#2b2d31",opacity:c==="SELL"?1:.5},children:"SAT (Sell)"})]}),e.jsxs("div",{style:{marginBottom:10,fontSize:"0.85em",color:"#dbdee1",display:"flex",justifyContent:"space-between",padding:"0 5px"},children:[e.jsxs("span",{children:["ðŸ’° Bakiye: ",e.jsxs("span",{style:{color:"#23a559"},children:["$",z.toFixed(2)]})]}),e.jsxs("span",{children:["ðŸª™ VarlÄ±k: ",e.jsxs("span",{style:{color:"#f0b232"},children:[P(F)," ",t]})]})]}),e.jsxs("div",{style:n.inputWrapper,children:[e.jsxs("label",{children:["Miktar (",t,")"]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("input",{type:"number",value:u,onChange:i=>A(i.target.value),style:n.input,placeholder:"0"}),c==="SELL"&&e.jsx("button",{onClick:C,style:n.maxBtn,children:"MAX"})]})]}),e.jsxs("div",{style:n.inputWrapper,children:[e.jsx("label",{children:"Toplam (USDT)"}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("input",{type:"number",value:f,onChange:i=>L(i.target.value),style:n.input,placeholder:"0"}),c==="BUY"&&e.jsx("button",{onClick:C,style:n.maxBtn,children:"MAX"})]})]}),e.jsx("button",{onClick:()=>k(c,t,u,B),style:{...n.confirmBtn,backgroundColor:c==="BUY"?"#23a559":"#da373c"},disabled:!u||parseFloat(u)<=0,children:c==="BUY"?"SATIN AL":"SATIÅž YAP"})]})})},ue=({portfolio:t,onClose:a})=>t?e.jsx("div",{style:n.modalOverlay,onClick:a,children:e.jsxs("div",{style:n.modalContent,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{style:n.modalHeader,children:[e.jsx("h2",{children:"ðŸ’¼ CÃ¼zdanÄ±m"}),e.jsx("button",{onClick:a,style:n.closeBtn,children:e.jsx(N,{})})]}),e.jsxs("div",{style:n.balanceCard,children:[e.jsx("span",{children:"Toplam Bakiye (USDT)"}),e.jsxs("h1",{style:{color:"#23a559",margin:"5px 0"},children:["$",P(t.balance)]})]}),e.jsx("h4",{style:{borderBottom:"1px solid #444",paddingBottom:5,marginBottom:10},children:"VarlÄ±klarÄ±m"}),e.jsx("div",{style:n.holdingsList,children:!t.holdings||Object.keys(t.holdings).length===0?e.jsx("p",{style:{color:"#999",textAlign:"center"},children:"HenÃ¼z coin almadÄ±nÄ±z."}):Object.entries(t.holdings).map(([d,p])=>e.jsxs("div",{style:n.holdingItem,children:[e.jsx("strong",{style:{color:"#fff",fontSize:"1.1em"},children:d.replace("USDT","")}),e.jsxs("span",{style:{color:"#f0b232"},children:[P(p)," Adet"]})]},d))})]})}):null,Se=()=>{const[t,a]=s.useState(null),[d,p]=s.useState(!0),[S,k]=s.useState(null),[u,g]=s.useState(""),[f,y]=s.useState(""),[c,I]=s.useState("balance"),[O,W]=s.useState({}),[B,z]=s.useState(!1),[R,F]=s.useState(null),[A,L]=s.useState(null),[C,i]=s.useState({}),m=s.useRef(f),v=s.useRef(t),{token:w}=se(),J=le(),D=async()=>{v.current||p(!0),k(null);try{const r=await(await fetch(ce)).text();if(!r||r.length<50){v.current||k("Veri dosyasÄ± boÅŸ. Bot Ã§alÄ±ÅŸÄ±yor mu?"),p(!1);return}const l=pe(r);try{let h=l.replace(/:\s*NaN/g,": null").replace(/:\s*Infinity/g,": null").replace(/:\s*-Infinity/g,": null");const x=JSON.parse(h);a(x);const b=Object.keys(x);b.length>0&&!m.current&&y(b[0])}catch(h){console.error("JSON HatasÄ±:",h,l),v.current||(g("JSON Parse HatasÄ±: "+h.message+`

Veri Ã–zeti: `+l.substring(0,100)),k("Veri formatÄ± bozuk."))}}catch(o){console.error("Fetch HatasÄ±:",o),v.current||k("Sunucuya baÄŸlanÄ±lamadÄ±.")}finally{p(!1)}},G=async()=>{if(w)try{const o=await fetch(`${H}/portfolio/my/`,{headers:{Authorization:`Bearer ${w}`}});o.ok&&L(await o.json())}catch(o){console.debug("[CryptoDashboard] Portfolio fetch skipped:",o.message)}},Y=async()=>{if(w)try{const o=`${de}/crypto_prices.json?t=${Date.now()}`,r=await fetch(o,{headers:{Authorization:`Bearer ${w}`}});if(r.ok){const l=await r.json();i(l)}}catch(o){console.error("Fiyat Okuma HatasÄ±:",o)}};s.useEffect(()=>{D(),G(),Y();const o=setInterval(Y,1500),r=setInterval(D,1e4);return()=>{clearInterval(o),clearInterval(r)}},[w]);const $=o=>{if(!o)return null;const r=o.toUpperCase(),l=r.match(/([A-Z0-9]+USDT)/);return l&&l[0]?l[0]:r.split(" ")[0].replace(/[^A-Z0-9]/g,"")},X=o=>{const r=$(o);if(r&&C[r])return C[r];const l=r?.replace("USDT","");return l&&C[l]?C[l]:null},K=async(o,r,l,h)=>{if(!w)return E.error("âŒ GiriÅŸ yapmalÄ±sÄ±nÄ±z!");let x=r.toUpperCase();x.endsWith("USDT")||(x+="USDT");try{const b=await fetch(`${H}/portfolio/trade/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify({symbol:x,action:o,amount:l,price:h})}),U=await b.json();b.ok?(E.success("âœ… Ä°ÅŸlem BaÅŸarÄ±lÄ±!"),L(U),F(null)):E.error(`âŒ Hata: ${U.error}`)}catch{E.error("âŒ Sunucu hatasÄ±.")}},Z=s.useMemo(()=>!t||!f||!t[f]?[]:Object.entries(t[f]).sort((r,l)=>{const h=r[1][0]||{},x=l[1][0]||{};return c==="balance"?parseFloat(x.balance||0)-parseFloat(h.balance||0):c==="win_rate"?parseFloat(x.win_rate||0)-parseFloat(h.win_rate||0):parseInt(x.trade_count||0)-parseInt(h.trade_count||0)}),[t,f,c]);return s.useEffect(()=>{m.current=f},[f]),s.useEffect(()=>{v.current=t},[t]),e.jsxs("div",{style:{...n.pageContainer,paddingTop:J?"max(10px, env(safe-area-inset-top))":"20px"},children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{style:n.headerLeft,children:[e.jsxs(Q,{to:"/",style:n.backButton,children:[e.jsx(q,{})," Ana MenÃ¼"]}),e.jsxs("h1",{style:n.title,children:[e.jsx(ee,{style:{color:"#f0b232",marginRight:"10px"}})," Crypto AI Dashboard"]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("button",{onClick:()=>z(!0),style:n.portfolioBtn,children:[e.jsx(te,{})," CÃ¼zdan ($",P(A?.balance||"0"),")"]}),e.jsxs("button",{onClick:D,style:n.refreshButton,children:[e.jsx(ne,{className:d?"spin":""})," ",d?"":"Yenile"]})]})]}),d&&!t?e.jsx("div",{style:n.loader,children:"Veriler YÃ¼kleniyor..."}):S?e.jsxs("div",{style:{textAlign:"center",marginTop:50},children:[e.jsxs("h3",{style:{color:"#da373c"},children:["âš ï¸ ",S]}),u&&e.jsxs("div",{style:{backgroundColor:"#2b2d31",padding:10,margin:"20px auto",maxWidth:600,borderRadius:8,textAlign:"left"},children:[e.jsxs("strong",{style:{color:"#f0b232"},children:[e.jsx(oe,{})," Hata Verisi:"]}),e.jsx("pre",{style:{color:"#dbdee1",fontSize:"0.8em",whiteSpace:"pre-wrap"},children:u})]}),e.jsx("button",{onClick:D,style:n.confirmBtn,children:"Tekrar Dene"})]}):e.jsxs("div",{style:n.content,children:[e.jsxs("div",{style:n.controlsContainer,children:[e.jsx("div",{style:n.tabs,children:t&&Object.keys(t).map(o=>e.jsx("button",{onClick:()=>y(o),style:{...n.tabButton,...f===o?n.activeTab:{}},children:String(o).trim()||o},o))}),e.jsxs("div",{style:n.sortContainer,children:[e.jsx("button",{onClick:()=>I("balance"),style:{...n.sortButton,...c==="balance"?n.activeSort:{}},children:"PNL"}),e.jsx("button",{onClick:()=>I("win_rate"),style:{...n.sortButton,...c==="win_rate"?n.activeSort:{}},children:"WR"})]})]}),e.jsx("div",{style:n.grid,children:Z.map(([o,r])=>{const l=!!O[o],h=l?r:r.slice(0,5),x=r[0]||{},b=X(o),U=$(o)?.replace("USDT","")||"UNK";return e.jsxs("div",{style:n.coinCard,children:[e.jsxs("div",{style:n.cardHeader,children:[e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("h3",{style:n.coinTitle,title:o,children:o}),e.jsx(_,{price:b||"Fiyat Bekleniyor..."})]}),e.jsxs("button",{onClick:()=>F({coin:U,price:b}),style:{...n.tradeBtn,opacity:b?1:.5,cursor:b?"pointer":"not-allowed"},disabled:!b,children:[e.jsx(re,{})," Ä°ÅŸlem"]})]}),e.jsxs("div",{style:n.statsSummary,children:[e.jsxs("div",{style:n.statItem,children:[e.jsx("span",{style:n.statLabel,children:"PNL"}),e.jsx("span",{style:{color:"#f0b232"},children:T(x.balance)})]}),e.jsxs("div",{style:n.statItem,children:[e.jsx("span",{style:n.statLabel,children:"WR"}),e.jsxs("span",{style:{color:x.win_rate>50?"#23a559":"#da373c"},children:["%",T(x.win_rate)]})]})]}),e.jsx("div",{style:n.tableWrapper,children:e.jsxs("table",{style:n.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PNL"}),e.jsx("th",{children:"WR%"}),e.jsx("th",{children:"Ä°ÅŸlem"}),e.jsx("th",{children:"TP/SL"})]})}),e.jsx("tbody",{children:h.map((j,M)=>e.jsxs("tr",{style:{backgroundColor:M===0?"rgba(240,178,50,0.08)":"transparent"},children:[e.jsx("td",{style:{color:"#f0b232"},children:T(j.balance)}),e.jsxs("td",{style:{color:j.win_rate>50?"#23a559":"#da373c"},children:["%",T(j.win_rate)]}),e.jsx("td",{children:T(j.trade_count)}),e.jsxs("td",{children:[T(j.tp),"/",T(j.sl)]})]},M))})]})}),r.length>5&&e.jsx("button",{onClick:()=>W(j=>({...j,[o]:!j[o]})),style:n.expandButton,children:l?"Kapat":`+${r.length-5} Daha`})]},o)})})]}),B&&e.jsx(ue,{portfolio:A,onClose:()=>z(!1)}),R&&e.jsx(xe,{coin:R.coin,initialPrice:R.price,livePrices:C,portfolio:A,onClose:()=>F(null),onTrade:K})]})},n={pageContainer:{minHeight:"100%",backgroundColor:"#1e1f22",color:"#dbdee1",padding:"20px",boxSizing:"border-box"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid #2b2d31"},headerLeft:{display:"flex",flexDirection:"column",gap:"5px"},title:{margin:0,fontSize:"1.4em",display:"flex",alignItems:"center",fontWeight:"700",color:"#fff"},backButton:{textDecoration:"none",color:"#949ba4",fontSize:"0.9em",display:"flex",alignItems:"center",gap:"5px"},refreshButton:{backgroundColor:"#5865f2",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontWeight:"600"},portfolioBtn:{backgroundColor:"#2b2d31",border:"1px solid #f0b232",color:"#f0b232",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",display:"flex",alignItems:"center",gap:"5px"},controlsContainer:{display:"flex",flexWrap:"wrap",gap:"15px",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},tabs:{display:"flex",gap:"8px",overflowX:"auto",paddingBottom:"5px"},tabButton:{backgroundColor:"#2b2d31",border:"1px solid #40444b",color:"#949ba4",padding:"6px 12px",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"0.9em"},activeTab:{backgroundColor:"#f0b232",color:"#000",borderColor:"#f0b232",fontWeight:"700"},sortContainer:{display:"flex",alignItems:"center",gap:"8px"},sortButton:{backgroundColor:"transparent",border:"1px solid #40444b",color:"#dcddde",padding:"4px 10px",borderRadius:"15px",cursor:"pointer",fontSize:"0.8em"},activeSort:{backgroundColor:"#5865f2",borderColor:"#5865f2",color:"white"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"15px",paddingBottom:"50px"},coinCard:{backgroundColor:"#2b2d31",borderRadius:"10px",overflow:"hidden",border:"1px solid #1f2023",boxShadow:"0 4px 6px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},cardHeader:{backgroundColor:"#202225",padding:"12px 15px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #2f3136"},coinTitle:{margin:0,color:"#fff",fontSize:"1em",fontWeight:"700",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},tradeBtn:{backgroundColor:"#23a559",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer",fontSize:"0.85em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"5px",flexShrink:0},statsSummary:{display:"flex",gap:"15px",padding:"10px 15px"},statItem:{display:"flex",flexDirection:"column"},statLabel:{fontSize:"0.7em",color:"#949ba4"},tableWrapper:{overflowX:"auto"},table:{width:"100%",borderCollapse:"collapse",fontSize:"0.85em"},expandButton:{width:"100%",padding:"8px",backgroundColor:"#232428",border:"none",borderTop:"1px solid #2f3136",color:"#949ba4",cursor:"pointer"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalContent:{backgroundColor:"#313338",padding:"25px",borderRadius:"12px",width:"90%",maxWidth:"400px",border:"1px solid #40444b",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,color:"white",borderBottom:"1px solid #444",paddingBottom:10},closeBtn:{background:"none",border:"none",color:"#bbb",fontSize:"1.2em",cursor:"pointer"},modeBtn:{flex:1,padding:"12px",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",fontSize:"1em"},inputWrapper:{marginBottom:15},input:{flex:1,padding:"12px",borderRadius:"6px 0 0 6px",border:"1px solid #40444b",backgroundColor:"#202225",color:"white",fontSize:"1.1em",outline:"none",width:"100%"},maxBtn:{padding:"0 15px",backgroundColor:"#40444b",border:"1px solid #40444b",borderRadius:"0 6px 6px 0",color:"#f0b232",fontWeight:"bold",cursor:"pointer"},confirmBtn:{width:"100%",padding:"15px",border:"none",borderRadius:"6px",color:"white",fontWeight:"bold",fontSize:"1.1em",cursor:"pointer",marginTop:10},balanceCard:{backgroundColor:"#202225",padding:"15px",borderRadius:"8px",textAlign:"center",marginBottom:"20px",border:"1px solid #f0b232"},holdingsList:{maxHeight:"250px",overflowY:"auto",margin:"10px 0"},holdingItem:{display:"flex",justifyContent:"space-between",padding:"10px",borderBottom:"1px solid #40444b",alignItems:"center"}},V=document.createElement("style");V.innerText=`
  @keyframes flashGreen { 0% { color: #fff; background: rgba(35, 165, 89, 0.5); } 100% { color: #23a559; background: transparent; } }
  @keyframes flashRed { 0% { color: #fff; background: rgba(218, 55, 60, 0.5); } 100% { color: #da373c; background: transparent; } }
  .flash-green { animation: flashGreen 1s ease-out; }
  .flash-red { animation: flashRed 1s ease-out; }
  .spin { animation: spin 1s linear infinite; } 
  @keyframes spin { 100% { transform: rotate(360deg); } } 
  td, th { padding: 8px 10px; text-align: center; border-bottom: 1px solid #2f3136; } 
  th { color: '#949ba4'; font-weight: 600; font-size: 0.8em; } 
  input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
`;document.head.appendChild(V);export{Se as default};
