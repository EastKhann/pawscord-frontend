import{r as s,aj as B,dH as I,aT as ee,l as ae,K as b,ax as te,bt as G,Y as T,bz as ce,cl as le,ct as se,aE as ne,A as re,c2 as me,c3 as ie,c$ as oe}from"./react-core-B6hadH-M.js";import{t as f}from"./index-D_6pZib5.js";const Ee=({serverId:n,apiBaseUrl:i,onClose:v})=>{const[c,V]=s.useState("7d"),[H,$]=s.useState(!0),[w,S]=s.useState(!1),[r,O]=s.useState({total_members:0,active_members:0,messages_count:0,voice_minutes:0,member_growth:0,message_growth:0}),[N,P]=s.useState([]),[h,z]=s.useState([]),[R,K]=s.useState([]),[k,Y]=s.useState([]),[E,q]=s.useState([]),[y,J]=s.useState([]),[A,Q]=s.useState([]),[_,W]=s.useState([]);s.useEffect(()=>{j()},[n,c]);const j=async()=>{$(!0);try{const a={Authorization:`Bearer ${localStorage.getItem("access_token")}`},[t,l,d,m,u,C,M,L,D]=await Promise.all([fetch(`${i}/analytics/${n}/overview/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/member-activity/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/message-activity/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/top-channels/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/top-members/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/geo/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/reactions/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/link-clicks/?range=${c}`,{headers:a}),fetch(`${i}/analytics/${n}/peak-hours/?range=${c}`,{headers:a})]);t.ok&&O(await t.json()),l.ok&&P((await l.json()).data||[]),d.ok&&z((await d.json()).data||[]),m.ok&&K((await m.json()).channels||[]),u.ok&&Y((await u.json()).members||[]),C.ok&&q((await C.json()).data||[]),M.ok&&J((await M.json()).reactions||[]),L.ok&&Q((await L.json()).links||[]),D.ok&&W((await D.json()).hours||[])}catch(e){console.error("Fetch analytics error:",e),f.error("âŒ Analitik verileri yÃ¼klenemedi")}finally{$(!1)}},X=async()=>{S(!0),await j(),S(!1),f.success("ðŸ”„ Veriler gÃ¼ncellendi")},Z=()=>{const e={exported_at:new Date().toISOString(),time_range:c,overview:r,memberActivity:N,messageActivity:h,topChannels:R,topMembers:k,geoData:E,reactionStats:y},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`analytics_${n}_${c}.json`,l.click(),URL.revokeObjectURL(t),f.success("ðŸ“¥ Analitik verileri indirildi")},o=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),F=e=>e>0?{icon:me,color:"#23a559",text:`+${e}%`}:e<0?{icon:ie,color:"#da373c",text:`${e}%`}:{icon:oe,color:"#72767d",text:"0%"},x=(e,a="#5865f2",t=60)=>{if(!e||e.length===0)return null;const l=Math.max(...e.map(m=>m.value)),d=100/e.length;return React.createElement("div",{className:"simple-chart",style:{height:t}},e.map((m,u)=>React.createElement("div",{key:u,className:"chart-bar",style:{width:`${d}%`,height:`${m.value/l*100}%`,background:a},title:`${m.label}: ${m.value}`})))},U=()=>{const e=Array(24).fill(0).map((t,l)=>{const d=_.find(m=>m.hour===l);return{hour:l,value:d?.value||0}}),a=Math.max(...e.map(t=>t.value));return React.createElement("div",{className:"peak-hours-chart"},e.map((t,l)=>React.createElement("div",{key:l,className:"hour-bar",style:{height:`${a>0?t.value/a*100:0}%`,background:t.value>a*.8?"#23a559":t.value>a*.5?"#5865f2":"#3f4147"},title:`${t.hour}:00 - ${t.value} mesaj`},React.createElement("span",{className:"hour-label"},t.hour))))};if(H)return React.createElement("div",{className:"analytics-overlay",onClick:v},React.createElement("div",{className:"analytics-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"Analitik verileri yÃ¼kleniyor..."))));const g=F(r.member_growth),p=F(r.message_growth);return React.createElement("div",{className:"analytics-overlay",onClick:v},React.createElement("div",{className:"analytics-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"analytics-header"},React.createElement("h2",null,React.createElement(B,null)," GeliÅŸmiÅŸ Analitik"),React.createElement("div",{className:"header-controls"},React.createElement("div",{className:"time-range-selector"},["24h","7d","30d","90d"].map(e=>React.createElement("button",{key:e,className:`range-btn ${c===e?"active":""}`,onClick:()=>V(e)},e==="24h"?"24 Saat":e==="7d"?"7 GÃ¼n":e==="30d"?"30 GÃ¼n":"90 GÃ¼n"))),React.createElement("button",{className:"action-btn",onClick:X,disabled:w},React.createElement(I,{className:w?"spinning":""})),React.createElement("button",{className:"action-btn",onClick:Z},React.createElement(ee,null))),React.createElement("button",{className:"close-btn",onClick:v},React.createElement(ae,null))),React.createElement("div",{className:"analytics-content"},React.createElement("div",{className:"overview-section"},React.createElement("div",{className:"overview-card"},React.createElement("div",{className:"card-icon members"},React.createElement(b,null)),React.createElement("div",{className:"card-content"},React.createElement("span",{className:"card-value"},o(r.total_members)),React.createElement("span",{className:"card-label"},"Toplam Ãœye"),React.createElement("span",{className:"card-growth",style:{color:g.color}},React.createElement(g.icon,null)," ",g.text))),React.createElement("div",{className:"overview-card"},React.createElement("div",{className:"card-icon active"},React.createElement(te,null)),React.createElement("div",{className:"card-content"},React.createElement("span",{className:"card-value"},o(r.active_members)),React.createElement("span",{className:"card-label"},"Aktif Ãœye"),React.createElement("span",{className:"card-detail"},(r.active_members/r.total_members*100||0).toFixed(1),"% aktiflik"))),React.createElement("div",{className:"overview-card"},React.createElement("div",{className:"card-icon messages"},React.createElement(G,null)),React.createElement("div",{className:"card-content"},React.createElement("span",{className:"card-value"},o(r.messages_count)),React.createElement("span",{className:"card-label"},"Mesaj"),React.createElement("span",{className:"card-growth",style:{color:p.color}},React.createElement(p.icon,null)," ",p.text))),React.createElement("div",{className:"overview-card"},React.createElement("div",{className:"card-icon voice"},React.createElement(T,null)),React.createElement("div",{className:"card-content"},React.createElement("span",{className:"card-value"},o(r.voice_minutes)),React.createElement("span",{className:"card-label"},"Sesli Dakika"),React.createElement("span",{className:"card-detail"},Math.round(r.voice_minutes/60)," saat")))),React.createElement("div",{className:"charts-grid"},React.createElement("div",{className:"chart-card"},React.createElement("div",{className:"chart-header"},React.createElement("h3",null,React.createElement(b,null)," Ãœye Aktivitesi")),React.createElement("div",{className:"chart-body"},N.length>0?x(N,"#5865f2",120):React.createElement("div",{className:"no-data"},"Veri yok"))),React.createElement("div",{className:"chart-card"},React.createElement("div",{className:"chart-header"},React.createElement("h3",null,React.createElement(G,null)," Mesaj Aktivitesi")),React.createElement("div",{className:"chart-body"},h.length>0?x(h,"#23a559",120):React.createElement("div",{className:"no-data"},"Veri yok"))),React.createElement("div",{className:"chart-card wide"},React.createElement("div",{className:"chart-header"},React.createElement("h3",null,React.createElement(T,null)," YoÄŸunluk Saatleri"),React.createElement("span",{className:"chart-info"},React.createElement(ce,null)," En yoÄŸun saatler yeÅŸil ile gÃ¶sterilir")),React.createElement("div",{className:"chart-body"},_.length>0?U():React.createElement("div",{className:"no-data"},"Veri yok")))),React.createElement("div",{className:"lists-grid"},React.createElement("div",{className:"list-card"},React.createElement("div",{className:"list-header"},React.createElement("h3",null,React.createElement(le,null)," En Aktif Kanallar")),React.createElement("div",{className:"list-body"},R.length>0?R.map((e,a)=>React.createElement("div",{key:e.id,className:"list-item"},React.createElement("span",{className:"rank"},a+1),React.createElement("span",{className:"name"},"# ",e.name),React.createElement("div",{className:"bar-container"},React.createElement("div",{className:"bar",style:{width:`${e.messages/R[0].messages*100}%`}})),React.createElement("span",{className:"value"},o(e.messages)))):React.createElement("div",{className:"no-data"},"Veri yok"))),React.createElement("div",{className:"list-card"},React.createElement("div",{className:"list-header"},React.createElement("h3",null,React.createElement(b,null)," En Aktif Ãœyeler")),React.createElement("div",{className:"list-body"},k.length>0?k.map((e,a)=>React.createElement("div",{key:e.id,className:"list-item"},React.createElement("span",{className:"rank"},a+1),React.createElement("img",{src:e.avatar||"/default-avatar.png",alt:e.username,className:"avatar"}),React.createElement("span",{className:"name"},e.username),React.createElement("span",{className:"value"},o(e.messages)," mesaj"))):React.createElement("div",{className:"no-data"},"Veri yok"))),React.createElement("div",{className:"list-card"},React.createElement("div",{className:"list-header"},React.createElement("h3",null,React.createElement(se,null)," En Ã‡ok KullanÄ±lan Reaksiyonlar")),React.createElement("div",{className:"list-body"},y.length>0?React.createElement("div",{className:"reactions-grid"},y.map((e,a)=>React.createElement("div",{key:a,className:"reaction-item"},React.createElement("span",{className:"emoji"},e.emoji),React.createElement("span",{className:"count"},o(e.count))))):React.createElement("div",{className:"no-data"},"Veri yok"))),React.createElement("div",{className:"list-card"},React.createElement("div",{className:"list-header"},React.createElement("h3",null,React.createElement(ne,null)," CoÄŸrafi DaÄŸÄ±lÄ±m")),React.createElement("div",{className:"list-body"},E.length>0?E.map((e,a)=>React.createElement("div",{key:a,className:"list-item"},React.createElement("span",{className:"flag"},e.flag||"ðŸŒ"),React.createElement("span",{className:"name"},e.country),React.createElement("div",{className:"bar-container"},React.createElement("div",{className:"bar geo",style:{width:`${e.count/E[0].count*100}%`}})),React.createElement("span",{className:"value"},e.percentage,"%"))):React.createElement("div",{className:"no-data"},"Veri yok")))),A.length>0&&React.createElement("div",{className:"links-section"},React.createElement("h3",null,React.createElement(re,null)," Link TÄ±klamalarÄ±"),React.createElement("div",{className:"links-table"},React.createElement("div",{className:"table-header"},React.createElement("span",null,"URL"),React.createElement("span",null,"TÄ±klama"),React.createElement("span",null,"Benzersiz")),A.map((e,a)=>React.createElement("div",{key:a,className:"table-row"},React.createElement("span",{className:"link-url",title:e.url},e.url.length>50?e.url.substring(0,50)+"...":e.url),React.createElement("span",null,o(e.clicks)),React.createElement("span",null,o(e.unique_clicks)))))))))};export{Ee as default};
