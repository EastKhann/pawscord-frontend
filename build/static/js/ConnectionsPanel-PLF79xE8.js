import{r as o,n as e}from"./react-core-Cj7FUMmY.js";import{A as f,a as P,l as v,ar as y,bU as S,bV as A,bW as z,bX as R,bY as G,bZ as D,b_ as E,aU as g,aZ as L,B as X,b$ as Y}from"./icons-vendor-TGltgKsJ.js";import{a as H,g as I,t as l}from"./index-DrIBbDZv.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const q=({onClose:h})=>{const{token:p,user:N}=H(),[k,C]=o.useState({}),[w,F]=o.useState(!0),[$,r]=o.useState(null),a=o.useRef(null),d=o.useRef(null),u=I().replace("/api",""),x=[{id:"spotify",name:"Spotify",icon:S,color:"#1DB954",description:"Dinlediğin müziği profilinde göster",oauth:!0,features:["Now Playing","Rich Presence"]},{id:"steam",name:"Steam",icon:A,color:"#171A21",description:"Oynadığın oyunları profilinde göster",oauth:!0,features:["Game Activity","Rich Presence","Achievements"]},{id:"xbox",name:"Xbox",icon:z,color:"#107C10",description:"Xbox Live hesabını bağla",oauth:!0,features:["Gamertag","Game Activity","Achievements"]},{id:"twitch",name:"Twitch",icon:R,color:"#9146FF",description:"Twitch yayın durumunu göster",oauth:!0,features:["Stream Status","Rich Presence"]},{id:"github",name:"GitHub",icon:G,color:"#333333",description:"GitHub profilini bağla",oauth:!0,features:["Repositories","Contributions","Profile"]},{id:"youtube",name:"YouTube",icon:D,color:"#FF0000",description:"YouTube kanalını bağla",oauth:!0,features:["Channel","Subscribers","Videos"]},{id:"discord",name:"Discord",icon:E,color:"#5865F2",description:"Discord hesabını bağla (migration)",oauth:!0,features:["Profile","Friends Import"]}],m=o.useCallback(async()=>{const n=new AbortController,s=setTimeout(()=>n.abort(),1e4);try{const i=await fetch(`${u}/api/connections/status/`,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(s),i.ok){const t=await i.json();C(t.connections||{})}}catch(i){i.name==="AbortError"&&l.error("Bağlantılar yüklenemedi - zaman aşımı")}finally{F(!1)}},[p,u]);o.useEffect(()=>(m(),()=>{a.current&&clearInterval(a.current),d.current&&clearTimeout(d.current)}),[m]);const T=n=>{a.current&&clearInterval(a.current),d.current&&clearTimeout(d.current),r(n);const s=500,i=700,t=window.screenX+(window.outerWidth-s)/2,b=window.screenY+(window.outerHeight-i)/2,c=window.open(`${u}/api/auth/${n}/start/?username=${N?.username||"anonymous"}`,`${n}_oauth`,`width=${s},height=${i},left=${t},top=${b},toolbar=no,menubar=no`);if(!c){l.error("Popup blocker tarafından engellendi. Lütfen popup'lara izin verin."),r(null);return}a.current=setInterval(()=>{c.closed&&(clearInterval(a.current),a.current=null,r(null),m(),l.success(`${n} bağlantısı kontrol ediliyor...`))},500),d.current=setTimeout(()=>{a.current&&(clearInterval(a.current),a.current=null),c.closed||c.close(),r(null)},12e4)},B=async n=>{if(confirm(`${n} bağlantısını kesmek istediğinize emin misiniz?`)){r(n);try{(await fetch(`${u}/api/connections/${n}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}})).ok?(l.success(`${n} bağlantısı kesildi`),m()):l.error("Bağlantı kesilemedi")}catch{l.error("Bağlantı kesme hatası")}finally{r(null)}}},j=n=>{const s=k[n.id],i=s?.connected,t=$===n.id,b=n.icon;return e.jsxs("div",{className:`connection-card ${i?"connected":""}`,style:{"--platform-color":n.color},children:[e.jsxs("div",{className:"connection-header",children:[e.jsx("div",{className:"platform-icon",style:{backgroundColor:n.color},children:e.jsx(b,{})}),e.jsxs("div",{className:"platform-info",children:[e.jsx("h3",{children:n.name}),e.jsx("p",{children:n.description})]})]}),i&&s.username&&e.jsxs("div",{className:"connection-details",children:[e.jsxs("span",{className:"connected-as",children:[e.jsx(X,{className:"status-icon success"}),"Bağlı: ",e.jsx("strong",{children:s.username})]}),s.data&&e.jsxs("div",{className:"connection-data",children:[s.data.game&&e.jsxs("span",{className:"activity",children:[e.jsx(y,{})," ",s.data.game]}),s.data.track&&e.jsxs("span",{className:"activity",children:[e.jsx(g,{})," ",s.data.track]})]})]}),e.jsx("div",{className:"connection-features",children:n.features.map(c=>e.jsx("span",{className:"feature-tag",children:c},c))}),e.jsx("div",{className:"connection-actions",children:i?e.jsxs("button",{className:"disconnect-btn",onClick:()=>B(n.id),disabled:t,children:[t?e.jsx(f,{className:"spin"}):e.jsx(Y,{}),"Bağlantıyı Kes"]}):e.jsxs("button",{className:"connect-btn",onClick:()=>T(n.id),disabled:t,style:{backgroundColor:n.color},children:[t?e.jsx(f,{className:"spin"}):e.jsx(v,{}),"Bağlan"]})})]},n.id)};return w?e.jsx("div",{className:"connections-modal-overlay",onClick:h,children:e.jsx("div",{className:"connections-modal",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"connections-panel loading",children:[e.jsx(f,{className:"spin large"}),e.jsx("p",{children:"Bağlantılar yükleniyor..."})]})})}):e.jsx("div",{className:"connections-modal-overlay",onClick:h,children:e.jsxs("div",{className:"connections-modal",onClick:n=>n.stopPropagation(),children:[e.jsx("button",{className:"connections-close-btn",onClick:h,children:e.jsx(P,{})}),e.jsxs("div",{className:"connections-panel",children:[e.jsxs("div",{className:"connections-header",children:[e.jsxs("h2",{children:[e.jsx(v,{})," Bağlantılar"]}),e.jsx("p",{children:"Hesaplarını bağlayarak profilini zenginleştir ve aktivitelerini göster"})]}),e.jsxs("div",{className:"connections-grid",children:[e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(y,{})," Oyun Platformları"]}),e.jsx("div",{className:"platforms-grid",children:x.filter(n=>["steam","epic","xbox","playstation","battlenet","riot"].includes(n.id)).map(j)})]}),e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(g,{})," Müzik & Streaming"]}),e.jsx("div",{className:"platforms-grid",children:x.filter(n=>["spotify","twitch","youtube"].includes(n.id)).map(j)})]}),e.jsxs("div",{className:"connection-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(v,{})," Sosyal Medya"]}),e.jsx("div",{className:"platforms-grid",children:x.filter(n=>["discord","twitter","github"].includes(n.id)).map(j)})]})]}),e.jsx("div",{className:"connections-footer",children:e.jsxs("p",{className:"privacy-note",children:[e.jsx(L,{}),"Bağlantılar sadece izin verdiğin bilgilere erişir. İstediğin zaman bağlantıyı kesebilirsin."]})})]})]})})};export{q as default};
