var H=Object.defineProperty;var I=t=>{throw TypeError(t)};var F=(t,i,e)=>i in t?H(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var L=(t,i,e)=>F(t,typeof i!="symbol"?i+"":i,e),N=(t,i,e)=>i.has(t)||I("Cannot "+e);var A=(t,i,e)=>(N(t,i,"read from private field"),e?e.call(t):i.get(t)),$=(t,i,e)=>i.has(t)?I("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e),C=(t,i,e,r)=>(N(t,i,"write to private field"),r?r.call(t,e):i.set(t,e),e);import{a as W}from"./react-core-Cj7FUMmY.js";import{_ as U}from"./media-vendor-BsD1gqUZ.js";import{M as j,C as P}from"./mixin-DrjftxH2.js";import"./editor-vendor-D9c4a6XZ.js";var _;class S extends j(P){constructor(){super(...arguments);$(this,_)}attributeChangedCallback(e,r,n){e!=="src"&&super.attributeChangedCallback(e,r,n),e==="src"&&r!=n&&this.load()}async _initThumbnails(e){const r=async(d,v)=>{const g=[],m=e.timescale||1,w=e.startNumber||1,M=e.presentationTimeOffset?e.presentationTimeOffset/m:0,h=e.segmentDuration;for(let T=0;T<d;T++){const y=q({thIndex:T,thduration:v,ttiles:d,tduration:h,startNumber:w,pto:M}),R=y+v,f=new Promise((E,a)=>{this.api.provideThumbnail(y,({url:s,width:l,height:p,x:b,y:D})=>{try{const k=new VTTCue(y,R,`${s}#xywh=${b},${D},${l},${p}`);E(k)}catch(k){a(k)}})});g.push(f)}return await Promise.all(g).catch(T=>{})},{totalThumbnails:n,thumbnailDuration:o}=K(e),u=await r(n,o);let c=this.nativeEl.querySelector('track[label="thumbnails"]');if(!c){c=z(),this.nativeEl.appendChild(c);const d=V(u);c.src=d,c.dispatchEvent(new Event("change"))}}async load(){if(A(this,_)){this.api.attachSource(this.src);return}C(this,_,!0);const e=await U(()=>import("./dash.all.min-CcpGWOU8.js"),[]);this.api=e.MediaPlayer().create(),this.api.initialize(this.nativeEl,this.src,this.autoplay),this.api.on(e.MediaPlayer.events.STREAM_INITIALIZED,()=>{const r=this.api.getRepresentationsByType("video");let n=this.videoTracks.getTrackById("main");n||(n=this.addVideoTrack("main"),n.id="main",n.selected=!0),r.forEach(o=>{const u=o.bandwidth??o.bitrate??(Number.isFinite(o.bitrateInKbit)?o.bitrateInKbit*1e3:void 0),c=n.addRendition(o.id,o.width,o.height,o.mimeType??o.codec,u);c.id=o.id}),this.videoRenditions.addEventListener("change",()=>{const o=this.videoRenditions[this.videoRenditions.selectedIndex];o?.id?(this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),this.api.setRepresentationForTypeById("video",o.id,!0)):this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}})}),this.api.isDynamic()||this.api.getRepresentationsByType("image").forEach(async(u,c)=>{c>0||this._initThumbnails(u)})})}}_=new WeakMap,L(S,"shadowRootOptions",{...P.shadowRootOptions}),L(S,"getTemplateHTML",e=>{const{src:r,...n}=e;return P.getTemplateHTML(n)});function K(t){var i,e;const r=t.essentialProperties[0],[n,o]=r.value.split("x").map(Number),u=n*o,c=((e=(i=t.adaptation)==null?void 0:i.period)==null?void 0:e.duration)||null,d=t.segmentDuration,v=t.timescale||1,m=d/v/u;return{totalThumbnails:c!=null?Math.ceil(c/m):Math.ceil(d/m),thumbnailDuration:m}}function q({thIndex:t,tduration:i,thduration:e,ttiles:r,startNumber:n,pto:o}){const u=Math.floor(t/r)+n,c=t%r+1,d=(u-1)*i-o,v=(c-1)*e;return d+v}function z(){const t=document.createElement("track");return t.kind="metadata",t.label="thumbnails",t.srclang="en",t.mode="hidden",t.default=!0,t}function V(t){let i=`WEBVTT

`;for(const n of t)i+=`${r(n.startTime)} --> ${r(n.endTime)}
`,i+=`${n.text}

`;const e=new Blob([i],{type:"text/vtt"});return URL.createObjectURL(e);function r(n){const o=String(Math.floor(n/3600)).padStart(2,"0"),u=String(Math.floor(n%3600/60)).padStart(2,"0"),c=(n%60).toFixed(3).padStart(6,"0");return`${o}:${u}:${c}`}}globalThis.customElements&&!globalThis.customElements.get("dash-video")&&globalThis.customElements.define("dash-video",S);var Z=S,G=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),J={className:"class",htmlFor:"for"};function B(t){return t.toLowerCase()}function O(t){if(typeof t=="boolean")return t?"":void 0;if(typeof t!="function"&&!(typeof t=="object"&&t!==null))return t}function Q({react:t,tagName:i,elementClass:e,events:r,displayName:n,defaultProps:o,toAttributeName:u=B,toAttributeValue:c=O}){const d=Number.parseInt(t.version)>=19,v=t.forwardRef((g,m)=>{var w,M;const h=t.useRef(null),T=t.useRef(new Map),y={},R={},f={},E={};for(const[a,s]of Object.entries(g)){if(G.has(a)){f[a]=s;continue}const l=u(J[a]??a);if(e.prototype&&a in e.prototype&&!(a in(((w=globalThis.HTMLElement)==null?void 0:w.prototype)??{}))&&!((M=e.observedAttributes)!=null&&M.some(b=>b===l))){E[a]=s;continue}if(a.startsWith("on")){y[a]=s;continue}const p=c(s);if(l&&p!=null&&(R[l]=String(p),d||(f[l]=p)),l&&d){const b=O(s);p!==b?f[l]=p:f[l]=s}}if(typeof window<"u"){for(const a in y){const s=y[a],l=a.endsWith("Capture"),p=(r?.[a]??a.slice(2).toLowerCase()).slice(0,l?-7:void 0);t.useLayoutEffect(()=>{const b=h?.current;if(!(!b||typeof s!="function"))return b.addEventListener(p,s,l),()=>{b.removeEventListener(p,s,l)}},[h?.current,s])}t.useLayoutEffect(()=>{if(h.current===null)return;const a=new Map;for(const s in E)x(h.current,s,E[s]),T.current.delete(s),a.set(s,E[s]);for(const[s,l]of T.current)x(h.current,s,void 0);T.current=a})}if(typeof window>"u"&&e?.getTemplateHTML&&e?.shadowRootOptions){const{mode:a,delegatesFocus:s}=e.shadowRootOptions,l=t.createElement("template",{shadowrootmode:a,shadowrootdelegatesfocus:s,dangerouslySetInnerHTML:{__html:e.getTemplateHTML(R,g)},key:"ce-la-react-ssr-template-shadow-root"});f.children=[l,f.children]}return t.createElement(i,{...o,...f,ref:t.useCallback(a=>{h.current=a,typeof m=="function"?m(a):m!==null&&(m.current=a)},[m])},f.children)});return v.displayName=n??e.name,v}function x(t,i,e){var r;t[i]=e,e==null&&i in(((r=globalThis.HTMLElement)==null?void 0:r.prototype)??{})&&t.removeAttribute(i)}var nt=Q({react:W,tagName:"dash-video",elementClass:Z,toAttributeName(t){return t==="muted"?"":t==="defaultMuted"?"muted":B(t)}});export{nt as default};
