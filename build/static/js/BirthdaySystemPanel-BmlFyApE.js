import{r as s,d as e,c9 as i}from"./react-core-DrOm_csO.js";import{g as D}from"./index-BYhWpPLp.js";const Y=({serverId:n,onClose:m})=>{const c=D(),[r,l]=s.useState({enabled:!1,announcement_channel_id:"",birthday_role_id:"",message_template:"ðŸŽ‰ BugÃ¼n @{user}'un doÄŸum gÃ¼nÃ¼! Mutlu yÄ±llar! ðŸŽ‚",give_role:!0,remove_role_after_day:!0}),[d,g]=s.useState([]),[u,y]=s.useState([]),[E,p]=s.useState([]),[f,v]=s.useState([]),[b,_]=s.useState(!0);s.useEffect(()=>{k(),N(),S(),$()},[n]);const k=async()=>{try{const a=await fetch(`${c}/birthday-system/server/${n}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();l(t)}}catch(a){console.error("Error:",a)}finally{_(!1)}},N=async()=>{try{const a=await fetch(`${c}/birthday-system/server/${n}/birthdays/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();g(t.all_birthdays),y(t.upcoming)}}catch(a){console.error("Error:",a)}},S=async()=>{try{const a=await fetch(`${c}/channels/server/${n}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();p(t.filter(o=>o.type==="text"))}}catch(a){console.error("Error:",a)}},$=async()=>{try{const a=await fetch(`${c}/roles/server/${n}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();v(t)}}catch(a){console.error("Error:",a)}},w=async()=>{try{(await fetch(`${c}/birthday-system/server/${n}/config/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).ok?i.success("âœ… Ayarlar kaydedildi"):i.error("âŒ Kaydetme hatasÄ±")}catch{i.error("âŒ BaÄŸlantÄ± hatasÄ±")}},B=async()=>{try{(await fetch(`${c}/birthday-system/server/${n}/test/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&i.success("âœ… Test mesajÄ± gÃ¶nderildi")}catch{i.error("âŒ GÃ¶nderim hatasÄ±")}},h=a=>new Date(a).toLocaleDateString("tr-TR",{day:"numeric",month:"long"}),C=a=>{const t=new Date,o=new Date(a);return o.setFullYear(t.getFullYear()),o<t&&o.setFullYear(t.getFullYear()+1),Math.ceil((o-t)/(1e3*60*60*24))};return e.createElement("div",{className:"birthday-overlay",onClick:m},e.createElement("div",{className:"birthday-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"birthday-header"},e.createElement("h2",null,"ðŸŽ‚ DoÄŸum GÃ¼nÃ¼ Sistemi"),e.createElement("button",{className:"close-btn",onClick:m},"Ã—")),e.createElement("div",{className:"birthday-content"},b?e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"YÃ¼kleniyor...")):e.createElement(e.Fragment,null,e.createElement("div",{className:"config-section"},e.createElement("div",{className:"section-header"},e.createElement("h3",null,"âš™ï¸ Ayarlar"),e.createElement("label",{className:"toggle-switch"},e.createElement("input",{type:"checkbox",checked:r.enabled,onChange:a=>l({...r,enabled:a.target.checked})}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"config-grid"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"ðŸ“¢ Duyuru KanalÄ±"),e.createElement("select",{value:r.announcement_channel_id,onChange:a=>l({...r,announcement_channel_id:a.target.value})},e.createElement("option",{value:""},"SeÃ§in"),E.map(a=>e.createElement("option",{key:a.id,value:a.id},"# ",a.name)))),e.createElement("div",{className:"form-group"},e.createElement("label",null,"ðŸŽ­ DoÄŸum GÃ¼nÃ¼ RolÃ¼"),e.createElement("select",{value:r.birthday_role_id,onChange:a=>l({...r,birthday_role_id:a.target.value})},e.createElement("option",{value:""},"Yok"),f.map(a=>e.createElement("option",{key:a.id,value:a.id},"@",a.name)))),e.createElement("div",{className:"form-group full-width"},e.createElement("label",null,"ðŸ’¬ Mesaj Åžablonu"),e.createElement("textarea",{value:r.message_template,onChange:a=>l({...r,message_template:a.target.value}),rows:"2"}),e.createElement("small",null,"KullanÄ±labilir: ","{user}",", ","{age}",", ","{server}")),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:r.give_role,onChange:a=>l({...r,give_role:a.target.checked})}),e.createElement("span",null,"DoÄŸum gÃ¼nÃ¼ rolÃ¼ ver"))),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:r.remove_role_after_day,onChange:a=>l({...r,remove_role_after_day:a.target.checked})}),e.createElement("span",null,"Bir gÃ¼n sonra rolÃ¼ kaldÄ±r")))),e.createElement("div",{className:"config-actions"},e.createElement("button",{className:"save-btn",onClick:w},"ðŸ’¾ Kaydet"),e.createElement("button",{className:"test-btn",onClick:B},"âœ‰ï¸ Test MesajÄ±"))),e.createElement("div",{className:"upcoming-section"},e.createElement("h3",null,"ðŸ“… YaklaÅŸan DoÄŸum GÃ¼nleri"),u.length===0?e.createElement("div",{className:"empty-state-small"},e.createElement("p",null,"YaklaÅŸan doÄŸum gÃ¼nÃ¼ yok")):e.createElement("div",{className:"upcoming-list"},u.map(a=>e.createElement("div",{key:a.user_id,className:"upcoming-card"},e.createElement("div",{className:"upcoming-avatar"},a.user_avatar?e.createElement("img",{src:a.user_avatar,alt:""}):e.createElement("div",{className:"default-avatar"},"ðŸ‘¤")),e.createElement("div",{className:"upcoming-info"},e.createElement("h4",null,a.user_name),e.createElement("p",null,h(a.birthday))),e.createElement("div",{className:"upcoming-days"},e.createElement("span",{className:"days-badge"},C(a.birthday)," gÃ¼n")))))),e.createElement("div",{className:"all-birthdays-section"},e.createElement("h3",null,"ðŸ“‹ TÃ¼m DoÄŸum GÃ¼nleri (",d.length,")"),e.createElement("div",{className:"birthdays-grid"},d.map(a=>e.createElement("div",{key:a.user_id,className:"birthday-item"},e.createElement("span",{className:"user-name"},a.user_name),e.createElement("span",{className:"birthday-date"},h(a.birthday))))))))))};export{Y as default};
