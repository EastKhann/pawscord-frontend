import{a as Q,_ as X}from"./media-vendor-BSOZ7IB3.js";import{r as l,n as e}from"./react-core-zXIKm1Jm.js";import{t as f}from"./index-tS2FZNgN.js";import{a2 as O,a as M,cj as Z,ap as B,h as H,d as N,A as ee,D as te,c as $,s as re}from"./icons-vendor-BBdoVeJd.js";import"./editor-vendor-DiU449Dh.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";async function ne(){const t=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]);return{publicKey:await D(t.publicKey),privateKey:await A(t.privateKey)}}async function ae(t,r){const n=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),a=await oe(n.publicKey),s=await ce(a);return{keyId:t,publicKey:await D(n.publicKey),privateKey:await A(n.privateKey),signature:v(s)}}async function ie(t=100){const r=[];for(let n=0;n<t;n++){const a=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]);r.push({keyId:n,publicKey:await D(a.publicKey),privateKey:await A(a.privateKey)})}return r}async function D(t){const r=await crypto.subtle.exportKey("jwk",t);return JSON.stringify(r)}async function A(t){const r=await crypto.subtle.exportKey("jwk",t);return JSON.stringify(r)}async function oe(t){return await crypto.subtle.exportKey("raw",t)}async function se(t){const r=JSON.parse(t);return await crypto.subtle.importKey("jwk",r,{name:"ECDH",namedCurve:"P-256"},!0,[])}async function le(t){const r=JSON.parse(t);return await crypto.subtle.importKey("jwk",r,{name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"])}async function ce(t,r){const n=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"]);return await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n.privateKey,t)}async function de(t,r){const n=await G(r),a=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,be(t));return{ciphertext:v(s),iv:v(a)}}async function ye(t,r,n){const a=await G(n),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:k(r)},a,k(t));return he(s)}async function ue(t,r){const n=await le(t),a=await se(r),s=await crypto.subtle.deriveBits({name:"ECDH",public:a},n,256);return v(s)}async function G(t){const r=k(t),n=await crypto.subtle.importKey("raw",r,"HKDF",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}function pe(t,r,n){return{rootKey:n,sendingChainKey:null,receivingChainKey:null,sendCounter:0,receiveCounter:0,myRatchetPrivateKey:t,theirRatchetPublicKey:r}}async function fe(t,r){if(r==="send"){t.sendCounter++;const n=await I(t.sendingChainKey||t.rootKey);t.sendingChainKey=n}else{t.receiveCounter++;const n=await I(t.receivingChainKey||t.rootKey);t.receivingChainKey=n}return t}async function xe(t,r){const n=t+r,a=await I(n);return ve(a).split("").map(x=>parseInt(x,16).toString()).join("").substring(0,60).match(/.{1,5}/g).join(" ")}async function ge(t){const r=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=await t.arrayBuffer(),a=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},r,n),d=await crypto.subtle.exportKey("jwk",r);return{encryptedFile:new Blob([s],{type:"application/octet-stream"}),fileKey:JSON.stringify(d),iv:v(a),originalFilename:t.name,originalMimeType:t.type}}async function me(t,r,n,a,s){const d=JSON.parse(r),x=await crypto.subtle.importKey("jwk",d,{name:"AES-GCM",length:256},!1,["decrypt"]),p=await t.arrayBuffer(),g=await crypto.subtle.decrypt({name:"AES-GCM",iv:k(n)},x,p);return new File([g],a,{type:s})}function be(t){return new TextEncoder().encode(t)}function he(t){return new TextDecoder().decode(t)}function v(t){const r=new Uint8Array(t);let n="";for(let a=0;a<r.byteLength;a++)n+=String.fromCharCode(r[a]);return btoa(n)}function k(t){const r=atob(t),n=new Uint8Array(r.length);for(let a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return n.buffer}function ve(t){const r=new Uint8Array(t);return Array.from(r).map(n=>n.toString(16).padStart(2,"0")).join("")}async function I(t){const r=new TextEncoder,n=typeof t=="string"?r.encode(t):t;return await crypto.subtle.digest("SHA-256",n)}async function je(t,r,n){try{return localStorage.setItem(`e2ee_identity_private_${t}`,r),localStorage.setItem(`e2ee_signed_pre_key_private_${t}`,n),localStorage.setItem(`e2ee_keys_timestamp_${t}`,Date.now().toString()),console.log("âœ… Private keys stored locally"),!0}catch(a){throw console.error("âŒ Failed to store private keys:",a),a}}async function we(t){try{const r=localStorage.getItem(`e2ee_identity_private_${t}`),n=localStorage.getItem(`e2ee_signed_pre_key_private_${t}`),a=localStorage.getItem(`e2ee_keys_timestamp_${t}`);return!r||!n?null:{username:t,identityPrivateKey:r,signedPreKeyPrivateKey:n,timestamp:parseInt(a)}}catch(r){return console.error("âŒ Failed to retrieve private keys:",r),null}}async function Ke(t,r,n){try{const a=await n(`${t}/e2ee/pre-key-bundle/${r}/`);if(!a.ok)throw new Error(`Failed to fetch public keys: ${a.status}`);return await a.json()}catch(a){throw console.error("âŒ Failed to fetch user public keys:",a),a}}console.log("âœ… E2EE Crypto Utils loaded");const Se=Object.freeze(Object.defineProperty({__proto__:null,decryptFile:me,decryptMessage:ye,deriveSharedSecret:ue,encryptFile:ge,encryptMessage:de,fetchUserPublicKeys:Ke,generateIdentityKeyPair:ne,generateOneTimePreKeys:ie,generateSafetyNumber:xe,generateSignedPreKeyPair:ae,getPrivateKeys:we,initializeRatchet:pe,ratchetForward:fe,storePrivateKeys:je},Symbol.toStringTag,{value:"Module"})),ke=({username:t,targetUser:r,apiBaseUrl:n,fetchWithAuth:a,onClose:s})=>{const[d,x]=l.useState(null),[p,g]=l.useState(!1),[h,m]=l.useState(!1),[R,C]=l.useState(!0),[E,j]=l.useState(!1);l.useEffect(()=>{P()},[r]);const P=async()=>{try{const y=await(await a(`${n}/e2ee/safety-number/${r}/`)).json();x(y.safetyNumber),g(y.verified),m(y.verifiedByMe),C(!1)}catch(c){console.error("Failed to fetch safety number:",c),C(!1)}},T=async()=>{try{const y=await(await a(`${n}/e2ee/verify-safety-number/${r}/`,{method:"POST"})).json();m(!0),g(y.bothVerified),f.success(`âœ… Safety number doÄŸrulandÄ±!${y.bothVerified?`

Her iki taraf da doÄŸruladÄ±! ðŸŽ‰`:""}`)}catch(c){console.error("Failed to verify safety number:",c),f.error("âŒ DoÄŸrulama baÅŸarÄ±sÄ±z!")}};return R?e.jsx("div",{style:i.overlay,onClick:s,children:e.jsx("div",{style:i.modal,onClick:c=>c.stopPropagation(),children:e.jsx("p",{style:i.loading,children:"YÃ¼kleniyor..."})})}):e.jsx("div",{style:i.overlay,onClick:s,children:e.jsxs("div",{style:i.modal,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{style:i.header,children:[e.jsx(O,{size:32,color:p?"#43b581":"#faa61a"}),e.jsx("h2",{style:i.title,children:"Safety Number"}),e.jsx("button",{onClick:s,style:i.closeButton,children:e.jsx(M,{})})]}),e.jsx("div",{style:i.user,children:r}),E?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:i.qrContainer,children:e.jsx(Q,{value:d||"",size:200})}),e.jsx("button",{onClick:()=>j(!1),style:i.qrButton,children:"NumarayÄ± GÃ¶ster"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:i.numberContainer,children:d?.split(" ").map((c,y)=>e.jsx("div",{style:i.numberGroup,children:c},y))}),e.jsxs("button",{onClick:()=>j(!0),style:i.qrButton,children:[e.jsx(Z,{})," QR Kodu GÃ¶ster"]})]}),e.jsx("div",{style:i.statusContainer,children:p?e.jsxs("div",{style:i.statusVerified,children:[e.jsx(B,{size:20}),e.jsx("span",{children:"Her iki taraf da doÄŸruladÄ±! âœ…"})]}):h?e.jsxs("div",{style:i.statusPartial,children:[e.jsx(B,{size:20}),e.jsxs("span",{children:["Siz doÄŸruladÄ±nÄ±z. ",r," henÃ¼z doÄŸrulamadÄ±."]})]}):e.jsxs("div",{style:i.statusUnverified,children:[e.jsx(M,{size:20}),e.jsx("span",{children:"HenÃ¼z doÄŸrulanmadÄ±"})]})}),e.jsxs("div",{style:i.info,children:[e.jsx("h3",{children:"Safety Number Nedir?"}),e.jsxs("p",{children:["Safety number, sizin ve ",r,"'in ÅŸifreleme anahtarlarÄ±nÄ±n parmak izidir (fingerprint). Bu numarayÄ± karÅŸÄ±laÅŸtÄ±rarak identity key'lerini doÄŸrulayabilirsiniz."]}),e.jsx("h3",{children:"NasÄ±l DoÄŸrulanÄ±r?"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[r," ile yÃ¼z yÃ¼ze gÃ¶rÃ¼ÅŸÃ¼n veya gÃ¼venilir bir kanal kullanÄ±n"]}),e.jsx("li",{children:"Her ikiniz de safety number'Ä± aÃ§Ä±n"}),e.jsx("li",{children:"NumaralarÄ± karÅŸÄ±laÅŸtÄ±rÄ±n (aynÄ± olmalÄ±!)"}),e.jsx("li",{children:'EÅŸleÅŸiyorsa "DoÄŸrula" butonuna basÄ±n'})]})]}),!h&&e.jsxs("button",{onClick:T,style:i.verifyButton,children:[e.jsx(B,{})," Bu NumarayÄ± DoÄŸrula"]})]})})},i={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e5},modal:{backgroundColor:"#2b2d31",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",position:"relative"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",flex:1},closeButton:{backgroundColor:"transparent",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"4px",fontSize:"20px"},user:{color:"#5865f2",fontSize:"18px",fontWeight:"500",marginBottom:"24px",textAlign:"center"},numberContainer:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},numberGroup:{backgroundColor:"#1e1f22",color:"#fff",padding:"12px",borderRadius:"4px",textAlign:"center",fontSize:"18px",fontFamily:"monospace",letterSpacing:"2px"},qrContainer:{display:"flex",justifyContent:"center",marginBottom:"24px",padding:"16px",backgroundColor:"#fff",borderRadius:"8px"},qrButton:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"4px",padding:"10px 16px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto 24px"},statusContainer:{marginBottom:"24px"},statusVerified:{backgroundColor:"#43b581",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusPartial:{backgroundColor:"#faa61a",color:"#000",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusUnverified:{backgroundColor:"#ed4245",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},info:{backgroundColor:"#1e1f22",padding:"16px",borderRadius:"8px",marginBottom:"24px",color:"#b9bbbe",fontSize:"14px"},verifyButton:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"4px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},loading:{color:"#b9bbbe",textAlign:"center",padding:"32px"}},Te=({username:t,apiBaseUrl:r,fetchWithAuth:n})=>{const[a,s]=l.useState(!1),[d,x]=l.useState(null),[p,g]=l.useState(null),[h,m]=l.useState(!1),[R,C]=l.useState({encryptedMessagesCount:0,trustedContacts:0,lastKeyRotation:null}),[E,j]=l.useState(!1),[P,T]=l.useState(null);l.useEffect(()=>{c()},[]);const c=()=>{const u=localStorage.getItem("e2ee_enabled")==="true",w=localStorage.getItem("e2ee_setup_date"),K=localStorage.getItem("e2ee_last_rotation");s(u),x(w?new Date(w):null),g(K?new Date(K):null)},y=async()=>{if(window.confirm(`ðŸ”‘ AnahtarlarÄ± yenilemek istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ Yeni kimlik anahtarlarÄ± oluÅŸturur
â€¢ Eski ÅŸifreli mesajlar okunamaz hale gelir
â€¢ TÃ¼m kiÅŸilerle yeniden gÃ¼venlik doÄŸrulamasÄ± gerekir`)){m(!0);try{const{generateIdentityKeyPair:u,generateSignedPreKeyPair:w,generateOneTimePreKeys:K,storePrivateKeys:J}=await X(async()=>{const{generateIdentityKeyPair:b,generateSignedPreKeyPair:W,generateOneTimePreKeys:U,storePrivateKeys:q}=await Promise.resolve().then(()=>Se);return{generateIdentityKeyPair:b,generateSignedPreKeyPair:W,generateOneTimePreKeys:U,storePrivateKeys:q}},void 0);f.info("ðŸ” Yeni anahtarlar oluÅŸturuluyor...");const _=await u(),S=await w(Date.now(),_.privateKey),Y=await K(100);if(await J(t,_.privateKey,S.privateKey),f.info("â˜ï¸ Sunucuya yÃ¼kleniyor..."),(await n(`${r}/e2ee/rotate-keys/`,{method:"POST",body:JSON.stringify({identityPublicKey:_.publicKey,signedPreKeyId:S.keyId,signedPreKeyPublic:S.publicKey,signedPreKeySignature:S.signature,oneTimePreKeys:Y.map(b=>({keyId:b.keyId,publicKey:b.publicKey}))})})).ok){const b=new Date().toISOString();localStorage.setItem("e2ee_last_rotation",b),g(new Date(b)),f.success("âœ… Anahtarlar baÅŸarÄ±yla yenilendi!")}else throw new Error("Key rotation failed")}catch(u){console.error("Key rotation error:",u),f.error("âŒ Anahtar yenileme baÅŸarÄ±sÄ±z!")}finally{m(!1)}}},V=async()=>{if(window.confirm(`âš ï¸ E2EE'yi devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ TÃ¼m ÅŸifreli mesajlarÄ±nÄ±zÄ± siler
â€¢ AnahtarlarÄ±nÄ±zÄ± kaldÄ±rÄ±r
â€¢ Geri alÄ±namaz!`)){m(!0);try{localStorage.removeItem("e2ee_enabled"),localStorage.removeItem("e2ee_setup_date"),localStorage.removeItem("e2ee_last_rotation"),localStorage.removeItem(`e2ee_identity_private_${t}`),localStorage.removeItem(`e2ee_signed_pre_key_private_${t}`),s(!1),f.success("âœ… E2EE devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±")}catch(u){console.error("E2EE disable error:",u),f.error("âŒ Ä°ÅŸlem baÅŸarÄ±sÄ±z!")}finally{m(!1)}}},F=u=>u?u.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"HiÃ§",z=p?Math.floor((new Date-p)/(1e3*60*60*24)):d?Math.floor((new Date-d)/(1e3*60*60*24)):null,L=z&&z>90;return a?e.jsxs("div",{style:o.container,children:[e.jsxs("div",{style:o.header,children:[e.jsx(H,{size:24}),e.jsx("h3",{style:o.title,children:"E2EE AyarlarÄ±"})]}),e.jsxs("div",{style:o.statusCard,children:[e.jsxs("div",{style:o.statusHeader,children:[e.jsx(ee,{size:32,color:"#43b581"}),e.jsx("span",{style:o.statusText,children:"E2EE Aktif"})]}),e.jsxs("div",{style:o.statusInfo,children:[e.jsxs("div",{style:o.infoRow,children:[e.jsx(te,{}),e.jsxs("span",{children:["Kurulum: ",F(d)]})]}),p&&e.jsxs("div",{style:o.infoRow,children:[e.jsx($,{}),e.jsxs("span",{children:["Son Yenileme: ",F(p)]})]})]})]}),L&&e.jsxs("div",{style:o.warningCard,children:[e.jsx(N,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Anahtar Yenileme Ã–nerilir"}),e.jsxs("p",{children:["Son anahtar yenilemeden ",z," gÃ¼n geÃ§ti. GÃ¼venlik iÃ§in anahtarlarÄ±nÄ±zÄ± yenileyin."]})]})]}),e.jsxs("div",{style:o.actions,children:[e.jsxs("button",{onClick:y,disabled:h,style:o.rotateButton,children:[e.jsx($,{}),h?"Yenileniyor...":"AnahtarlarÄ± Yenile"]}),e.jsxs("button",{onClick:V,disabled:h,style:o.disableButton,children:[e.jsx(re,{}),"E2EE\\'yi Devre DÄ±ÅŸÄ± BÄ±rak"]})]}),e.jsxs("div",{style:o.infoSection,children:[e.jsxs("h4",{style:o.infoTitle,children:[e.jsx(O,{}),"E2EE HakkÄ±nda"]}),e.jsxs("ul",{style:o.infoList,children:[e.jsx("li",{children:"âœ… MesajlarÄ±nÄ±z uÃ§tan uca ÅŸifrelenir"}),e.jsx("li",{children:"âœ… Sadece siz ve karÅŸÄ±nÄ±zdaki kiÅŸi okuyabilir"}),e.jsx("li",{children:"âœ… Sunucu bile mesajlarÄ± gÃ¶remez"}),e.jsx("li",{children:"âš ï¸ AnahtarlarÄ±nÄ±zÄ± kaybederseniz mesajlar okunamaz"}),e.jsx("li",{children:"ðŸ”‘ 90 gÃ¼nde bir anahtar yenileme Ã¶nerilir"})]})]}),E&&e.jsx(ke,{username:t,targetUser:P,apiBaseUrl:r,fetchWithAuth:n,onClose:()=>j(!1)})]}):e.jsxs("div",{style:o.container,children:[e.jsxs("div",{style:o.header,children:[e.jsx(H,{size:24}),e.jsx("h3",{style:o.title,children:"End-to-End Encryption"})]}),e.jsxs("div",{style:o.disabledState,children:[e.jsx(N,{size:48,color:"#faa61a"}),e.jsx("h4",{children:"E2EE Devre DÄ±ÅŸÄ±"}),e.jsx("p",{children:"Åžu anda E2EE kullanmÄ±yorsunuz. MesajlarÄ±nÄ±zÄ± ÅŸifrelemek iÃ§in ayarlardan etkinleÅŸtirin."})]})]})},o={container:{padding:"20px",backgroundColor:"#2f3136",borderRadius:"8px",color:"#dcddde"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",paddingBottom:"16px",borderBottom:"2px solid #40444b"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},statusCard:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px",marginBottom:"16px",border:"2px solid #43b581"},statusHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},statusText:{fontSize:"18px",fontWeight:"bold",color:"#43b581"},statusInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#b9bbbe"},warningCard:{backgroundColor:"#faa61a20",border:"2px solid #faa61a",borderRadius:"8px",padding:"16px",marginBottom:"16px",display:"flex",gap:"12px",alignItems:"flex-start",color:"#faa61a"},actions:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},rotateButton:{padding:"12px 20px",backgroundColor:"#5865f2",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disableButton:{padding:"12px 20px",backgroundColor:"#ed4245",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disabledState:{textAlign:"center",padding:"40px 20px",color:"#b9bbbe"},infoSection:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px"},infoTitle:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"16px"},infoList:{margin:0,paddingLeft:"20px",color:"#b9bbbe",fontSize:"14px",lineHeight:"1.8"}};export{Te as default};
