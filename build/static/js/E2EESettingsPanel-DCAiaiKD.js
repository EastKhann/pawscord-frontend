import{r as a,ay as A,l as P,dk as G,aX as I,y as _,o as T,V as O,Y as Q,n as j,v as W,_ as q}from"./react-core-B6hadH-M.js";import{t as i,h as F}from"./index-D_6pZib5.js";import{Q as J}from"./index-C-c1bP5T.js";const X=({username:y,targetUser:r,apiBaseUrl:f,fetchWithAuth:b,onClose:u})=>{const[m,S]=a.useState(null),[s,g]=a.useState(!1),[p,c]=a.useState(!1),[B,v]=a.useState(!0),[h,E]=a.useState(!1);a.useEffect(()=>{z()},[r]);const z=async()=>{try{const l=await(await b(`${f}/e2ee/safety-number/${r}/`)).json();S(l.safetyNumber),g(l.verified),c(l.verifiedByMe),v(!1)}catch(n){console.error("Failed to fetch safety number:",n),v(!1)}},K=async()=>{try{const l=await(await b(`${f}/e2ee/verify-safety-number/${r}/`,{method:"POST"})).json();c(!0),g(l.bothVerified),i.success(`âœ… Safety number doÄŸrulandÄ±!${l.bothVerified?`

Her iki taraf da doÄŸruladÄ±! ðŸŽ‰`:""}`)}catch(n){console.error("Failed to verify safety number:",n),i.error("âŒ DoÄŸrulama baÅŸarÄ±sÄ±z!")}};return B?React.createElement("div",{style:e.overlay,onClick:u},React.createElement("div",{style:e.modal,onClick:n=>n.stopPropagation()},React.createElement("p",{style:e.loading},"YÃ¼kleniyor..."))):React.createElement("div",{style:e.overlay,onClick:u},React.createElement("div",{style:e.modal,onClick:n=>n.stopPropagation()},React.createElement("div",{style:e.header},React.createElement(A,{size:32,color:s?"#43b581":"#faa61a"}),React.createElement("h2",{style:e.title},"Safety Number"),React.createElement("button",{onClick:u,style:e.closeButton},React.createElement(P,null))),React.createElement("div",{style:e.user},r),h?React.createElement(React.Fragment,null,React.createElement("div",{style:e.qrContainer},React.createElement(J,{value:m||"",size:200})),React.createElement("button",{onClick:()=>E(!1),style:e.qrButton},"NumarayÄ± GÃ¶ster")):React.createElement(React.Fragment,null,React.createElement("div",{style:e.numberContainer},m?.split(" ").map((n,l)=>React.createElement("div",{key:l,style:e.numberGroup},n))),React.createElement("button",{onClick:()=>E(!0),style:e.qrButton},React.createElement(G,null)," QR Kodu GÃ¶ster")),React.createElement("div",{style:e.statusContainer},s?React.createElement("div",{style:e.statusVerified},React.createElement(I,{size:20}),React.createElement("span",null,"Her iki taraf da doÄŸruladÄ±! âœ…")):p?React.createElement("div",{style:e.statusPartial},React.createElement(I,{size:20}),React.createElement("span",null,"Siz doÄŸruladÄ±nÄ±z. ",r," henÃ¼z doÄŸrulamadÄ±.")):React.createElement("div",{style:e.statusUnverified},React.createElement(P,{size:20}),React.createElement("span",null,"HenÃ¼z doÄŸrulanmadÄ±"))),React.createElement("div",{style:e.info},React.createElement("h3",null,"Safety Number Nedir?"),React.createElement("p",null,"Safety number, sizin ve ",r,"'in ÅŸifreleme anahtarlarÄ±nÄ±n parmak izidir (fingerprint). Bu numarayÄ± karÅŸÄ±laÅŸtÄ±rarak identity key'lerini doÄŸrulayabilirsiniz."),React.createElement("h3",null,"NasÄ±l DoÄŸrulanÄ±r?"),React.createElement("ol",null,React.createElement("li",null,r," ile yÃ¼z yÃ¼ze gÃ¶rÃ¼ÅŸÃ¼n veya gÃ¼venilir bir kanal kullanÄ±n"),React.createElement("li",null,"Her ikiniz de safety number'Ä± aÃ§Ä±n"),React.createElement("li",null,"NumaralarÄ± karÅŸÄ±laÅŸtÄ±rÄ±n (aynÄ± olmalÄ±!)"),React.createElement("li",null,'EÅŸleÅŸiyorsa "DoÄŸrula" butonuna basÄ±n'))),!p&&React.createElement("button",{onClick:K,style:e.verifyButton},React.createElement(I,null)," Bu NumarayÄ± DoÄŸrula")))},e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e5},modal:{backgroundColor:"#2b2d31",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",position:"relative"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",flex:1},closeButton:{backgroundColor:"transparent",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"4px",fontSize:"20px"},user:{color:"#5865f2",fontSize:"18px",fontWeight:"500",marginBottom:"24px",textAlign:"center"},numberContainer:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},numberGroup:{backgroundColor:"#1e1f22",color:"#fff",padding:"12px",borderRadius:"4px",textAlign:"center",fontSize:"18px",fontFamily:"monospace",letterSpacing:"2px"},qrContainer:{display:"flex",justifyContent:"center",marginBottom:"24px",padding:"16px",backgroundColor:"#fff",borderRadius:"8px"},qrButton:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"4px",padding:"10px 16px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto 24px"},statusContainer:{marginBottom:"24px"},statusVerified:{backgroundColor:"#43b581",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusPartial:{backgroundColor:"#faa61a",color:"#000",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusUnverified:{backgroundColor:"#ed4245",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},info:{backgroundColor:"#1e1f22",padding:"16px",borderRadius:"8px",marginBottom:"24px",color:"#b9bbbe",fontSize:"14px"},verifyButton:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"4px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},loading:{color:"#b9bbbe",textAlign:"center",padding:"32px"}},ne=({username:y,apiBaseUrl:r,fetchWithAuth:f})=>{const[b,u]=a.useState(!1),[m,S]=a.useState(null),[s,g]=a.useState(null),[p,c]=a.useState(!1),[B,v]=a.useState({encryptedMessagesCount:0,trustedContacts:0,lastKeyRotation:null}),[h,E]=a.useState(!1),[z,K]=a.useState(null);a.useEffect(()=>{n()},[]);const n=()=>{const o=localStorage.getItem("e2ee_enabled")==="true",x=localStorage.getItem("e2ee_setup_date"),R=localStorage.getItem("e2ee_last_rotation");u(o),S(x?new Date(x):null),g(R?new Date(R):null)},l=async()=>{if(await F(`ðŸ”‘ AnahtarlarÄ± yenilemek istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ Yeni kimlik anahtarlarÄ± oluÅŸturur
â€¢ Eski ÅŸifreli mesajlar okunamaz hale gelir
â€¢ TÃ¼m kiÅŸilerle yeniden gÃ¼venlik doÄŸrulamasÄ± gerekir`)){c(!0);try{const{generateIdentityKeyPair:o,generateSignedPreKeyPair:x,generateOneTimePreKeys:R,storePrivateKeys:H}=await q(async()=>{const{generateIdentityKeyPair:d,generateSignedPreKeyPair:Y,generateOneTimePreKeys:$,storePrivateKeys:L}=await import("./e2ee-CZtQJWDz.js");return{generateIdentityKeyPair:d,generateSignedPreKeyPair:Y,generateOneTimePreKeys:$,storePrivateKeys:L}},[],import.meta.url);i.info("ðŸ” Yeni anahtarlar oluÅŸturuluyor...");const w=await o(),k=await x(Date.now(),w.privateKey),V=await R(100);if(await H(y,w.privateKey,k.privateKey),i.info("â˜ï¸ Sunucuya yÃ¼kleniyor..."),(await f(`${r}/e2ee/rotate-keys/`,{method:"POST",body:JSON.stringify({identityPublicKey:w.publicKey,signedPreKeyId:k.keyId,signedPreKeyPublic:k.publicKey,signedPreKeySignature:k.signature,oneTimePreKeys:V.map(d=>({keyId:d.keyId,publicKey:d.publicKey}))})})).ok){const d=new Date().toISOString();localStorage.setItem("e2ee_last_rotation",d),g(new Date(d)),i.success("âœ… Anahtarlar baÅŸarÄ±yla yenilendi!")}else throw new Error("Key rotation failed")}catch(o){console.error("Key rotation error:",o),i.error("âŒ Anahtar yenileme baÅŸarÄ±sÄ±z!")}finally{c(!1)}}},N=async()=>{if(await F(`âš ï¸ E2EE'yi devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ TÃ¼m ÅŸifreli mesajlarÄ±nÄ±zÄ± siler
â€¢ AnahtarlarÄ±nÄ±zÄ± kaldÄ±rÄ±r
â€¢ Geri alÄ±namaz!`)){c(!0);try{localStorage.removeItem("e2ee_enabled"),localStorage.removeItem("e2ee_setup_date"),localStorage.removeItem("e2ee_last_rotation"),localStorage.removeItem(`e2ee_identity_private_${y}`),localStorage.removeItem(`e2ee_signed_pre_key_private_${y}`),u(!1),i.success("âœ… E2EE devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±")}catch(o){console.error("E2EE disable error:",o),i.error("âŒ Ä°ÅŸlem baÅŸarÄ±sÄ±z!")}finally{c(!1)}}},D=o=>o?o.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"HiÃ§",C=s?Math.floor((new Date-s)/(1e3*60*60*24)):m?Math.floor((new Date-m)/(1e3*60*60*24)):null,M=C&&C>90;return b?React.createElement("div",{style:t.container},React.createElement("div",{style:t.header},React.createElement(_,{size:24}),React.createElement("h3",{style:t.title},"E2EE AyarlarÄ±")),React.createElement("div",{style:t.statusCard},React.createElement("div",{style:t.statusHeader},React.createElement(O,{size:32,color:"#43b581"}),React.createElement("span",{style:t.statusText},"E2EE Aktif")),React.createElement("div",{style:t.statusInfo},React.createElement("div",{style:t.infoRow},React.createElement(Q,null),React.createElement("span",null,"Kurulum: ",D(m))),s&&React.createElement("div",{style:t.infoRow},React.createElement(j,null),React.createElement("span",null,"Son Yenileme: ",D(s))))),M&&React.createElement("div",{style:t.warningCard},React.createElement(T,null),React.createElement("div",null,React.createElement("strong",null,"Anahtar Yenileme Ã–nerilir"),React.createElement("p",null,"Son anahtar yenilemeden ",C," gÃ¼n geÃ§ti. GÃ¼venlik iÃ§in anahtarlarÄ±nÄ±zÄ± yenileyin."))),React.createElement("div",{style:t.actions},React.createElement("button",{onClick:l,disabled:p,style:t.rotateButton},React.createElement(j,null),p?"Yenileniyor...":"AnahtarlarÄ± Yenile"),React.createElement("button",{onClick:N,disabled:p,style:t.disableButton},React.createElement(W,null),"E2EE\\'yi Devre DÄ±ÅŸÄ± BÄ±rak")),React.createElement("div",{style:t.infoSection},React.createElement("h4",{style:t.infoTitle},React.createElement(A,null),"E2EE HakkÄ±nda"),React.createElement("ul",{style:t.infoList},React.createElement("li",null,"âœ… MesajlarÄ±nÄ±z uÃ§tan uca ÅŸifrelenir"),React.createElement("li",null,"âœ… Sadece siz ve karÅŸÄ±nÄ±zdaki kiÅŸi okuyabilir"),React.createElement("li",null,"âœ… Sunucu bile mesajlarÄ± gÃ¶remez"),React.createElement("li",null,"âš ï¸ AnahtarlarÄ±nÄ±zÄ± kaybederseniz mesajlar okunamaz"),React.createElement("li",null,"ðŸ”‘ 90 gÃ¼nde bir anahtar yenileme Ã¶nerilir"))),h&&React.createElement(X,{username:y,targetUser:z,apiBaseUrl:r,fetchWithAuth:f,onClose:()=>E(!1)})):React.createElement("div",{style:t.container},React.createElement("div",{style:t.header},React.createElement(_,{size:24}),React.createElement("h3",{style:t.title},"End-to-End Encryption")),React.createElement("div",{style:t.disabledState},React.createElement(T,{size:48,color:"#faa61a"}),React.createElement("h4",null,"E2EE Devre DÄ±ÅŸÄ±"),React.createElement("p",null,"Åžu anda E2EE kullanmÄ±yorsunuz. MesajlarÄ±nÄ±zÄ± ÅŸifrelemek iÃ§in ayarlardan etkinleÅŸtirin.")))},t={container:{padding:"20px",backgroundColor:"#2f3136",borderRadius:"8px",color:"#dcddde"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",paddingBottom:"16px",borderBottom:"2px solid #40444b"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},statusCard:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px",marginBottom:"16px",border:"2px solid #43b581"},statusHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},statusText:{fontSize:"18px",fontWeight:"bold",color:"#43b581"},statusInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#b9bbbe"},warningCard:{backgroundColor:"#faa61a20",border:"2px solid #faa61a",borderRadius:"8px",padding:"16px",marginBottom:"16px",display:"flex",gap:"12px",alignItems:"flex-start",color:"#faa61a"},actions:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},rotateButton:{padding:"12px 20px",backgroundColor:"#5865f2",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disableButton:{padding:"12px 20px",backgroundColor:"#ed4245",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disabledState:{textAlign:"center",padding:"40px 20px",color:"#b9bbbe"},infoSection:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px"},infoTitle:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"16px"},infoList:{margin:0,paddingLeft:"20px",color:"#b9bbbe",fontSize:"14px",lineHeight:"1.8"}};export{ne as default};
