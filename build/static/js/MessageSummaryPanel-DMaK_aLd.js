import{r,n as s}from"./react-core-BMiyQWF6.js";import{G as C,a as z,cE as G,a7 as w,D as k,ab as l,z as H,az as E,an as A,bv as P,bq as I}from"./icons-vendor-T72gfvdf.js";import{p as O}from"./purify.es-FVN2sLic.js";import"./editor-vendor-D9c4a6XZ.js";const V=({channelId:g,onClose:c,fetchWithAuth:o,apiBaseUrl:m})=>{const[f,p]=r.useState(!1),[a,d]=r.useState([]),[n,y]=r.useState(null),[v,N]=r.useState(!1),[h,_]=r.useState("24h"),[u,F]=r.useState(100),[x,D]=r.useState(g),[S,b]=r.useState([]);r.useEffect(()=>{L()},[g]);const L=async()=>{p(!0);try{const e=await o(`${m}/rooms/list/`);if(e.ok){const i=await e.json();b(i.rooms||i||[])}const t=await o(`${m}/messages/summaries/`);if(t.ok){const i=await t.json();d(i.summaries||i||[])}}catch{b([]),d([])}p(!1)},$=async()=>{N(!0);try{const e=await o(`${m}/messages/summarize/`,{method:"POST",body:JSON.stringify({channel_id:x,time_range:h,message_count:u})});if(e.ok){const t=await e.json(),i={id:t.id||Date.now(),channel:S.find(T=>T.id===x)?.name||"general",created_at:new Date().toISOString(),time_range:h,message_count:t.message_count||u,summary:t.summary||"Özet oluşturulamadı.",keywords:t.keywords||[],participants:t.participants||0};y(i),d([i,...a])}}catch{}N(!1)},j=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=e=>{navigator.clipboard.writeText(e)},R=e=>{`${e.channel}${j(e.created_at)}${e.message_count}${e.time_range}${e.summary}`};return f?s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsx("div",{className:"summary-panel",onClick:e=>e.stopPropagation(),children:s.jsx("div",{className:"loading",children:"Loading message summary..."})})}):s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsxs("div",{className:"summary-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(C,{}),"AI Message Summary"]}),s.jsx("span",{className:"subtitle",children:"Summarize channel conversations with AI"})]}),s.jsx("button",{className:"close-btn",onClick:c,children:s.jsx(z,{})})]}),s.jsxs("div",{className:"summary-content",children:[s.jsxs("div",{className:"generator-section",children:[s.jsxs("h3",{children:[s.jsx(G,{})," Generate Summary"]}),s.jsxs("div",{className:"generator-controls",children:[s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(w,{})," Channel"]}),s.jsx("select",{value:x,onChange:e=>D(Number(e.target.value)),children:S.map(e=>s.jsxs("option",{value:e.id,children:["#",e.name]},e.id))})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(k,{})," Time Range"]}),s.jsxs("select",{value:h,onChange:e=>_(e.target.value),children:[s.jsx("option",{value:"1h",children:"Last Hour"}),s.jsx("option",{value:"6h",children:"Last 6 Hours"}),s.jsx("option",{value:"24h",children:"Last 24 Hours"}),s.jsx("option",{value:"7d",children:"Last 7 Days"}),s.jsx("option",{value:"30d",children:"Last 30 Days"})]})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(l,{})," Max Messages"]}),s.jsxs("select",{value:u,onChange:e=>F(Number(e.target.value)),children:[s.jsx("option",{value:50,children:"50 messages"}),s.jsx("option",{value:100,children:"100 messages"}),s.jsx("option",{value:250,children:"250 messages"}),s.jsx("option",{value:500,children:"500 messages"})]})]}),s.jsx("button",{className:"generate-btn",onClick:$,disabled:v,children:v?s.jsxs(s.Fragment,{children:[s.jsx(H,{className:"spinning"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{}),"Generate Summary"]})})]})]}),(n||a.length>0)&&s.jsxs("div",{className:"summary-display",children:[s.jsxs("div",{className:"summary-header",children:[s.jsxs("h3",{children:[s.jsx(l,{}),n?"Generated Summary":"Latest Summary"]}),s.jsxs("div",{className:"summary-actions",children:[s.jsxs("button",{className:"action-btn",onClick:()=>M((n||a[0]).summary),children:[s.jsx(E,{})," Copy"]}),s.jsxs("button",{className:"action-btn",onClick:()=>R(n||a[0]),children:[s.jsx(A,{})," Export"]})]})]}),s.jsxs("div",{className:"summary-meta",children:[s.jsxs("span",{className:"meta-item",children:[s.jsx(w,{})," #",(n||a[0]).channel]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(k,{})," ",(n||a[0]).time_range]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(l,{})," ",(n||a[0]).message_count," messages"]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(P,{})," ",j((n||a[0]).created_at)]})]}),s.jsx("div",{className:"summary-body",children:s.jsx("div",{className:"summary-text",dangerouslySetInnerHTML:{__html:O.sanitize((n||a[0]).summary.replace(/## /g,"<h4>").replace(/\n\n/g,`</h4>
`).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/- /g,"• ").replace(/\n/g,"<br/>"))}})}),s.jsxs("div",{className:"summary-keywords",children:[s.jsx("span",{className:"keywords-label",children:"Keywords:"}),(n||a[0]).keywords.map((e,t)=>s.jsx("span",{className:"keyword-chip",children:e},t))]})]}),s.jsxs("div",{className:"history-section",children:[s.jsxs("h3",{children:[s.jsx(I,{})," Summary History"]}),s.jsx("div",{className:"history-list",children:a.map(e=>s.jsxs("div",{className:`history-item ${n?.id===e.id?"active":""}`,onClick:()=>y(e),children:[s.jsx("div",{className:"history-icon",children:s.jsx(l,{})}),s.jsxs("div",{className:"history-info",children:[s.jsxs("span",{className:"history-channel",children:["#",e.channel]}),s.jsxs("span",{className:"history-meta",children:[e.message_count," messages • ",e.time_range]})]}),s.jsx("div",{className:"history-date",children:j(e.created_at)})]},e.id))})]})]})]})})};export{V as default};
