import{r as c,cm as w,aI as S,w as B,aq as M,bP as E,l as F,v as Q}from"./react-core-B6hadH-M.js";function K({apiBaseUrl:o,fetchWithAuth:r}){const[k,R]=c.useState([]),[i,N]=c.useState([]),[l,p]=c.useState([]),[n,L]=c.useState(""),[$,m]=c.useState(!1),[d,v]=c.useState(""),[y,f]=c.useState("#5865f2"),[_,b]=c.useState(!1),[h,s]=c.useState(""),j=["#5865f2","#43b581","#f04747","#faa61a","#9b59b6","#3498db","#e91e63","#00bcd4","#ff9800","#4caf50"];c.useEffect(()=>{g(),P()},[]);const g=async()=>{b(!0);try{const e=await r(`${o}/messages/readlater/list/`);if(e.ok){const t=await e.json();R(t.bookmarks||[])}}catch(e){s("Failed to load bookmarks: "+e.message)}finally{b(!1)}},P=async()=>{try{const e=await r(`${o}/bookmarks/tags/list/`);if(e.ok){const t=await e.json();N(t.tags||[])}}catch(e){console.error("Error loading tags:",e)}},T=async()=>{if(!d.trim()){s("Tag name cannot be empty");return}try{const e=await r(`${o}/bookmarks/tags/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d,color:y})});if(e.ok){const t=await e.json();N([...i,t.tag]),v(""),f("#5865f2"),m(!1),s("")}else{const t=await e.json();s(t.error||"Failed to create tag")}}catch(e){s("Network error: "+e.message)}},O=async e=>{try{(await r(`${o}/messages/readlater/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(R(k.filter(a=>a.message_id!==e)),s(""))}catch(t){s("Failed to remove bookmark: "+t.message)}},x=async(e,t)=>{try{(await r(`${o}/bookmarks/tags/${t}/add/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(g(),s(""))}catch(a){s("Failed to add tag: "+a.message)}},J=async(e,t)=>{try{(await r(`${o}/bookmarks/tags/${t}/remove/`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(g(),s(""))}catch(a){s("Failed to remove tag: "+a.message)}},D=e=>{l.includes(e)?p(l.filter(t=>t!==e)):p([...l,e])},C=k.filter(e=>{const t=n===""||e.content.toLowerCase().includes(n.toLowerCase())||e.author.toLowerCase().includes(n.toLowerCase()),a=l.length===0||e.tags?.some(u=>l.includes(u.id));return t&&a});return React.createElement("div",{className:"readlater-panel"},React.createElement("div",{className:"readlater-header"},React.createElement("h2",null,React.createElement(w,null)," Read Later"),React.createElement("button",{className:"create-tag-btn",onClick:()=>m(!0)},React.createElement(S,null)," New Tag")),h&&React.createElement("div",{className:"rl-error"},h),React.createElement("div",{className:"readlater-controls"},React.createElement("div",{className:"search-box"},React.createElement(B,{className:"search-icon"}),React.createElement("input",{type:"text",placeholder:"Search bookmarks...",value:n,onChange:e=>L(e.target.value),className:"search-input"})),React.createElement("div",{className:"tag-filters"},React.createElement(M,{className:"filter-icon"}),React.createElement("div",{className:"tag-filter-list"},i.map(e=>React.createElement("button",{key:e.id,className:`tag-filter ${l.includes(e.id)?"active":""}`,style:{borderColor:e.color},onClick:()=>D(e.id)},React.createElement(E,{style:{color:e.color}}),e.name))))),React.createElement("div",{className:"bookmarks-list"},_?React.createElement("div",{className:"rl-loading"},"Loading bookmarks..."):C.length===0?React.createElement("div",{className:"empty-state"},React.createElement(w,{className:"empty-icon"}),React.createElement("p",null,"No bookmarks found"),React.createElement("span",null,"Save messages with the bookmark button to read them later")):C.map((e,t)=>React.createElement("div",{key:t,className:"bookmark-item"},React.createElement("div",{className:"bookmark-header"},React.createElement("div",{className:"bookmark-author"},React.createElement("img",{src:e.author_avatar||"/default-avatar.png",alt:e.author,className:"author-avatar"}),React.createElement("span",{className:"author-name"},e.author)),React.createElement("div",{className:"bookmark-date"},new Date(e.saved_at).toLocaleDateString())),React.createElement("div",{className:"bookmark-content"},e.content),React.createElement("div",{className:"bookmark-footer"},React.createElement("div",{className:"bookmark-tags"},e.tags?.map(a=>React.createElement("span",{key:a.id,className:"bookmark-tag",style:{borderColor:a.color,color:a.color}},React.createElement(E,null),a.name,React.createElement(F,{className:"remove-tag-icon",onClick:()=>J(e.message_id,a.id)}))),React.createElement("select",{className:"add-tag-select",onChange:a=>{a.target.value&&(x(e.message_id,parseInt(a.target.value)),a.target.value="")}},React.createElement("option",{value:""},"+ Add Tag"),i.filter(a=>!e.tags?.find(u=>u.id===a.id)).map(a=>React.createElement("option",{key:a.id,value:a.id},a.name)))),React.createElement("button",{className:"remove-bookmark-btn",onClick:()=>O(e.message_id)},React.createElement(Q,null)," Remove"))))),$&&React.createElement("div",{className:"modal-overlay",onClick:()=>m(!1)},React.createElement("div",{className:"modal-content",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"modal-header"},React.createElement("h3",null,React.createElement(E,null)," Create New Tag"),React.createElement("button",{className:"modal-close",onClick:()=>m(!1)},React.createElement(F,null))),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Tag Name"),React.createElement("input",{type:"text",className:"tag-input",placeholder:"Enter tag name...",value:d,onChange:e=>v(e.target.value),onKeyPress:e=>e.key==="Enter"&&T()})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Tag Color"),React.createElement("div",{className:"color-picker"},j.map(e=>React.createElement("button",{key:e,className:`color-option ${y===e?"selected":""}`,style:{backgroundColor:e},onClick:()=>f(e)})))),React.createElement("button",{className:"create-tag-submit",onClick:T},React.createElement(S,null)," Create Tag")))))}export{K as default};
