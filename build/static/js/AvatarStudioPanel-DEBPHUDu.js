import{r as d,d as t,S as X,aK as I,i as G,bx as H,c3 as R,cT as J,c7 as M}from"./react-core-CecKX_Gm.js";import{t as l}from"./index-nWEO2Ei4.js";const V=({fetchWithAuth:s,apiBaseUrl:i,onClose:h})=>{const[o,S]=d.useState({}),[p,u]=d.useState({}),[v,E]=d.useState([]),[b,k]=d.useState(0),[f,c]=d.useState([]),[w,y]=d.useState(!1),[g,P]=d.useState("face_shapes"),[x,C]=d.useState("customize"),T=[{id:"face_shapes",name:"Face",icon:"üë§"},{id:"skin_tones",name:"Skin",icon:"üé®"},{id:"eyes",name:"Eyes",icon:"üëÅÔ∏è"},{id:"eye_colors",name:"Eye Color",icon:"üîµ"},{id:"hairstyles",name:"Hair",icon:"üíá"},{id:"hair_colors",name:"Hair Color",icon:"üåà"},{id:"mouths",name:"Mouth",icon:"üëÑ"},{id:"accessories",name:"Accessories",icon:"üëì"},{id:"backgrounds",name:"Background",icon:"üñºÔ∏è"},{id:"expressions",name:"Expression",icon:"üòä"}];d.useEffect(()=>{j(),A(),_()},[]);const j=async()=>{try{const r=await(await s(`${i}/api/avatar-studio/parts/`)).json();S(r.parts||{}),k(r.user_coins||0)}catch(e){console.error("Failed to fetch parts:",e)}},A=async()=>{try{const r=await(await s(`${i}/api/avatar-studio/my-avatar/`)).json();u(r.avatar||B()),E(r.owned_items||[])}catch(e){console.error("Failed to fetch avatar:",e)}},_=async()=>{try{const r=await(await s(`${i}/api/avatar-studio/presets/`)).json();c(r.presets||[])}catch(e){console.error("Failed to fetch presets:",e)}},B=()=>({face_shape:"round",skin_tone:"medium",eyes:"normal",eye_color:"brown",hairstyle:"short",hair_color:"black",mouth:"smile",accessory:"none",background:"solid_gray",expression:"default"}),F=(e,r)=>{e.replace("s","").replace("_color","_color").replace("_tone","_tone");let n=e;e==="face_shapes"?n="face_shape":e==="skin_tones"?n="skin_tone":e==="hairstyles"?n="hairstyle":e==="mouths"?n="mouth":e==="accessories"?n="accessory":e==="backgrounds"?n="background":e==="expressions"?n="expression":e==="eyes"?n="eyes":e==="eye_colors"?n="eye_color":e==="hair_colors"&&(n="hair_color"),u({...p,[n]:r})},N=async(e,r)=>{y(!0);try{const m=await(await s(`${i}/api/avatar-studio/purchase/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:e,item_id:r})})).json();m.message?(l.success(m.message),k(m.new_balance),E(m.owned_items)):l.error(m.error||"Purchase failed")}catch{l.error("Purchase failed")}finally{y(!1)}},O=async()=>{y(!0);try{const r=await(await s(`${i}/api/avatar-studio/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:p})})).json();r.message?l.success("Avatar saved!"):l.error(r.error||"Save failed")}catch{l.error("Save failed")}finally{y(!1)}},D=async()=>{try{const r=await(await s(`${i}/api/avatar-studio/randomize/`,{method:"POST"})).json();r.avatar&&(u(r.avatar),l.success("Randomized!"))}catch{l.error("Failed to randomize")}},$=async()=>{const e=prompt("Enter preset name:");if(e)try{(await(await s(`${i}/api/avatar-studio/presets/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,config:p})})).json()).preset_id&&(l.success("Preset saved!"),_())}catch{l.error("Failed to save preset")}},L=e=>{u(e.config),C("customize")};return t.createElement("div",{style:a.overlay},t.createElement("div",{style:a.modal},t.createElement("div",{style:a.header},t.createElement("div",{style:a.headerLeft},t.createElement(X,{style:{marginRight:"10px",color:"#5865f2"}}),t.createElement("h2",{style:a.title},"Avatar Studio")),t.createElement("div",{style:a.coinsDisplay},t.createElement(I,{style:{color:"#faa61a"}}),t.createElement("span",null,b)),t.createElement("button",{onClick:h,style:a.closeButton},t.createElement(G,null))),t.createElement("div",{style:a.tabs},t.createElement("button",{onClick:()=>C("customize"),style:x==="customize"?a.activeTab:a.tab},t.createElement(H,null)," Customize"),t.createElement("button",{onClick:()=>C("presets"),style:x==="presets"?a.activeTab:a.tab},t.createElement(R,null)," Presets")),t.createElement("div",{style:a.mainContent},x==="customize"&&t.createElement(t.Fragment,null,t.createElement("div",{style:a.previewSection},t.createElement(z,{avatar:p,parts:o}),t.createElement("div",{style:a.previewActions},t.createElement("button",{onClick:D,style:a.actionBtn},t.createElement(J,null)," Random"),t.createElement("button",{onClick:$,style:a.actionBtn},t.createElement(R,null)," Save Preset"),t.createElement("button",{onClick:O,style:a.saveBtn,disabled:w},t.createElement(M,null)," ",w?"Saving...":"Save Avatar"))),t.createElement("div",{style:a.customizeSection},t.createElement("div",{style:a.categoryTabs},T.map(e=>t.createElement("button",{key:e.id,onClick:()=>P(e.id),style:g===e.id?a.catActive:a.catBtn},t.createElement("span",null,e.icon),t.createElement("span",{style:a.catName},e.name)))),t.createElement("div",{style:a.itemsGrid},(o[g]||[]).map(e=>{const r=e.free||v.includes(e.id),n=Object.values(p).includes(e.id);return t.createElement("div",{key:e.id,style:{...a.itemCard,...n?a.itemSelected:{},...r?{}:a.itemLocked},onClick:()=>r&&F(g,e.id)},e.color&&e.color!=="gradient"&&e.color!=="galaxy"&&e.color!=="rainbow"?t.createElement("div",{style:{...a.colorSwatch,background:e.color}}):t.createElement("span",{style:a.itemPreview},e.name?.charAt(0)||e.id.charAt(0).toUpperCase()),t.createElement("span",{style:a.itemName},e.name||e.id),!r&&t.createElement("button",{onClick:m=>{m.stopPropagation(),N(g,e.id)},style:a.buyBtn,disabled:w||b<(e.coins||0)},t.createElement(I,null)," ",e.coins))})))),x==="presets"&&t.createElement("div",{style:a.presetsGrid},f.map(e=>t.createElement("div",{key:e.id,style:a.presetCard},t.createElement(z,{avatar:e.config,parts:o,mini:!0}),t.createElement("span",{style:a.presetName},e.name),t.createElement("button",{onClick:()=>L(e),style:a.loadBtn},"Load"))),f.length===0&&t.createElement("p",{style:a.emptyText},"No presets saved yet")))))},z=({avatar:s,parts:i,mini:h=!1})=>{const o=h?80:200,p=i.backgrounds?.find(c=>c.id===s.background)?.color||"#36393f",v=i.skin_tones?.find(c=>c.id===s.skin_tone)?.color||"#D2B48C",b=i.hair_colors?.find(c=>c.id===s.hair_color)?.color||"#1C1C1C",f=i.eye_colors?.find(c=>c.id===s.eye_color)?.color||"#8B4513";return t.createElement("div",{style:{width:o,height:o,borderRadius:"50%",background:p,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",border:"4px solid #40444b"}},t.createElement("div",{style:{width:o*.7,height:o*.8,borderRadius:s.face_shape==="round"?"50%":s.face_shape==="oval"?"50% 50% 45% 45%":s.face_shape==="square"?"10%":"50%",background:v,position:"relative"}},t.createElement("div",{style:{position:"absolute",top:-o*.1,left:"50%",transform:"translateX(-50%)",width:o*.7,height:o*.3,background:b,borderRadius:"50% 50% 0 0"}}),t.createElement("div",{style:{position:"absolute",top:"35%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:o*.15}},t.createElement("div",{style:{width:o*.1,height:o*.1,borderRadius:"50%",background:f}}),t.createElement("div",{style:{width:o*.1,height:o*.1,borderRadius:"50%",background:f}})),t.createElement("div",{style:{position:"absolute",bottom:"20%",left:"50%",transform:"translateX(-50%)",width:o*.2,height:o*.05,background:s.mouth==="smile"?"#e8a0a0":"#d4a0a0",borderRadius:s.mouth==="smile"?"0 0 50% 50%":"4px"}})),s.accessory==="glasses"&&t.createElement("div",{style:{position:"absolute",top:"32%",left:"50%",transform:"translateX(-50%)",width:o*.5,height:o*.12,border:"2px solid #333",borderRadius:"4px",background:"transparent"}}),s.accessory==="crown"&&t.createElement("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",fontSize:o*.2}},"üëë"),s.accessory==="cat_ears"&&t.createElement("div",{style:{position:"absolute",top:o*.05,left:"50%",transform:"translateX(-50%)",fontSize:o*.15}},"üê±"))},a={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e4},modal:{backgroundColor:"#2f3136",borderRadius:"12px",width:"900px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"20px",borderBottom:"1px solid #40444b"},headerLeft:{display:"flex",alignItems:"center",flex:1},title:{margin:0,color:"#fff",fontSize:"20px"},coinsDisplay:{display:"flex",alignItems:"center",gap:"6px",color:"#fff",marginRight:"20px",background:"#40444b",padding:"6px 12px",borderRadius:"20px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},tabs:{display:"flex",padding:"10px 20px",gap:"10px",borderBottom:"1px solid #40444b"},tab:{background:"#40444b",border:"none",color:"#b9bbbe",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},activeTab:{background:"#5865f2",border:"none",color:"#fff",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},mainContent:{display:"flex",padding:"20px",gap:"20px",overflowY:"auto",flex:1},previewSection:{width:"250px",display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},previewActions:{display:"flex",flexDirection:"column",gap:"10px",width:"100%"},actionBtn:{background:"#40444b",border:"none",color:"#fff",padding:"10px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},saveBtn:{background:"#57f287",border:"none",color:"#000",padding:"12px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"bold"},customizeSection:{flex:1},categoryTabs:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px"},catBtn:{background:"#40444b",border:"none",color:"#b9bbbe",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",fontSize:"12px"},catActive:{background:"#5865f2",border:"none",color:"#fff",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",fontSize:"12px"},catName:{display:"none"},itemsGrid:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px"},itemCard:{background:"#40444b",borderRadius:"8px",padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",cursor:"pointer",position:"relative"},itemSelected:{border:"2px solid #5865f2",background:"#36393f"},itemLocked:{opacity:.7,cursor:"default"},colorSwatch:{width:"40px",height:"40px",borderRadius:"50%",border:"2px solid #fff"},itemPreview:{width:"40px",height:"40px",borderRadius:"50%",background:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:"bold"},itemName:{color:"#dcddde",fontSize:"11px",textAlign:"center"},buyBtn:{position:"absolute",bottom:"8px",right:"8px",background:"#faa61a",border:"none",color:"#000",padding:"4px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"10px",display:"flex",alignItems:"center",gap:"4px"},presetsGrid:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"15px",width:"100%"},presetCard:{background:"#40444b",borderRadius:"10px",padding:"15px",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},presetName:{color:"#fff",fontSize:"14px"},loadBtn:{background:"#5865f2",border:"none",color:"#fff",padding:"6px 16px",borderRadius:"4px",cursor:"pointer"},emptyText:{color:"#72767d",textAlign:"center",gridColumn:"1 / -1",padding:"40px"}};export{V as default};
