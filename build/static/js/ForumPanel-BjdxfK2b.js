import{r as i,n as e}from"./react-core-Cj7FUMmY.js";import{t as n}from"./index-CC_Kftin.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-DnRG7SaF.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const K=({serverId:p,apiBaseUrl:c,onClose:j})=>{const[x,y]=i.useState([]),[d,b]=i.useState(null),[m,f]=i.useState([]),[o,u]=i.useState(null),[_,z]=i.useState(!0),[C,S]=i.useState(!1),[w,k]=i.useState(!1),[l,v]=i.useState({title:"",content:"",tags:[]}),[N,$]=i.useState("");i.useEffect(()=>{F()},[p]),i.useEffect(()=>{d&&A(d.id)},[d]);const F=async()=>{try{const s=localStorage.getItem("access_token"),t=await fetch(`${c}/servers/${p}/forums/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const a=await t.json();y(Array.isArray(a)?a:a.forums||[])}}catch{}finally{z(!1)}},A=async s=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/forums/${s}/posts/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const r=await a.json();f(Array.isArray(r)?r:r.posts||[])}}catch{}},P=async()=>{const s=prompt("Forum kanalÄ± adÄ±:");if(s)try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/servers/${p}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:s})});if(a.ok){const r=await a.json();y([...x,r.forum]),n.success("âœ… Forum oluÅŸturuldu!")}else n.error("âŒ Forum oluÅŸturulamadÄ±")}catch{n.error("âŒ Hata oluÅŸtu")}},T=async()=>{if(!l.title.trim()||!l.content.trim()){n.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}S(!0);try{const s=localStorage.getItem("access_token"),t=await fetch(`${c}/forums/${d.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(t.ok){const a=await t.json();f([a.post,...m]),v({title:"",content:"",tags:[]}),k(!1),n.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else n.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch{n.error("âŒ Hata oluÅŸtu")}finally{S(!1)}},O=async s=>{if(!N.trim()){n.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/forums/posts/${s}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({content:N})});if(a.ok){const r=await a.json();u({...o,replies:[...o.replies||[],r.reply]}),$(""),n.success("âœ… YanÄ±t gÃ¶nderildi!")}else n.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch{n.error("âŒ Hata oluÅŸtu")}},h=async(s,t)=>{try{const a=localStorage.getItem("access_token"),r=await fetch(`${c}/forums/posts/${s}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:t})});if(r.ok){const G=await r.json();f(m.map(g=>g.id===s?{...g,votes:G.votes}:g)),n.success(t==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch{}},Y=async(s,t)=>{try{const a=localStorage.getItem("access_token");(await fetch(`${c}/forums/posts/${s}/solve/${t}/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(n.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),u({...o,solution_id:t}))}catch{}};return _?e.jsx("div",{className:"forum-panel-overlay",onClick:j,children:e.jsx("div",{className:"forum-panel",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"forum-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"forum-panel-overlay",onClick:j,children:e.jsxs("div",{className:"forum-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"forum-header",children:[e.jsx("h2",{children:"ğŸ’¬ Forum"}),e.jsx("button",{className:"close-btn",onClick:j,children:"âœ•"})]}),d?o?e.jsxs("div",{className:"post-detail",children:[e.jsx("div",{className:"detail-header",children:e.jsx("button",{className:"back-btn",onClick:()=>u(null),children:"â† Geri"})}),e.jsxs("div",{className:"post-main",children:[e.jsxs("div",{className:"post-votes-vertical",children:[e.jsx("button",{onClick:()=>h(o.id,"up"),children:"ğŸ‘"}),e.jsx("span",{children:o.votes||0}),e.jsx("button",{onClick:()=>h(o.id,"down"),children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-body",children:[e.jsx("h2",{children:o.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",o.author," â€¢ â° ",new Date(o.created_at).toLocaleString("tr-TR")]}),e.jsx("div",{className:"post-text",children:o.content})]})]}),e.jsxs("div",{className:"replies-section",children:[e.jsxs("h3",{children:["ğŸ’¬ YanÄ±tlar (",o.replies?.length||0,")"]}),(o.replies||[]).map(s=>e.jsxs("div",{className:`reply-item ${s.id===o.solution_id?"solution":""}`,children:[e.jsxs("div",{className:"reply-header",children:[e.jsxs("span",{className:"reply-author",children:["ğŸ‘¤ ",s.author]}),e.jsx("span",{className:"reply-time",children:new Date(s.created_at).toLocaleString("tr-TR")}),s.id===o.solution_id&&e.jsx("span",{className:"solution-badge",children:"âœ… Ã‡Ã¶zÃ¼m"})]}),e.jsx("div",{className:"reply-content",children:s.content}),!o.solution_id&&e.jsx("button",{className:"mark-solution-btn",onClick:()=>Y(o.id,s.id),children:"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"})]},s.id)),e.jsxs("div",{className:"reply-form",children:[e.jsx("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:N,onChange:s=>$(s.target.value),rows:4}),e.jsx("button",{className:"reply-submit-btn",onClick:()=>O(o.id),children:"ğŸ“¤ YanÄ±tla"})]})]})]}):e.jsxs("div",{className:"posts-view",children:[e.jsxs("div",{className:"posts-header",children:[e.jsx("button",{className:"back-btn",onClick:()=>b(null),children:"â† Geri"}),e.jsxs("h3",{children:["# ",d.name]}),e.jsx("button",{className:"new-post-btn",onClick:()=>k(!w),children:"â• Yeni GÃ¶nderi"})]}),w&&e.jsxs("div",{className:"create-post-form",children:[e.jsx("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:l.title,onChange:s=>v({...l,title:s.target.value}),maxLength:200}),e.jsx("textarea",{placeholder:"Ä°Ã§erik...",value:l.content,onChange:s=>v({...l,content:s.target.value}),rows:6}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:T,disabled:C,children:C?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"}),e.jsx("button",{className:"cancel-btn",onClick:()=>k(!1),children:"Ä°ptal"})]})]}),e.jsxs("div",{className:"posts-list",children:[m.map(s=>e.jsxs("div",{className:"post-item",onClick:()=>u(s),children:[e.jsxs("div",{className:"post-votes",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),h(s.id,"up")},children:"ğŸ‘"}),e.jsx("span",{children:s.votes||0}),e.jsx("button",{onClick:t=>{t.stopPropagation(),h(s.id,"down")},children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-content",children:[e.jsx("h4",{children:s.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",s.author," â€¢ â° ",new Date(s.created_at).toLocaleDateString("tr-TR"),s.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"]}),e.jsxs("p",{className:"post-preview",children:[s.content?.substring(0,150),"..."]}),e.jsxs("div",{className:"post-stats",children:["ğŸ’¬ ",s.replies_count||0," yanÄ±t"]})]})]},s.id)),m.length===0&&e.jsx("div",{className:"no-posts",children:e.jsx("p",{children:"ğŸ“­ HenÃ¼z gÃ¶nderi yok"})})]})]}):e.jsxs("div",{className:"forum-list",children:[e.jsxs("div",{className:"forum-list-header",children:[e.jsx("h3",{children:"Forum KanallarÄ±"}),e.jsx("button",{className:"create-forum-btn",onClick:P,children:"â• Yeni Forum"})]}),x.length>0?e.jsx("div",{className:"forums-grid",children:x.map(s=>e.jsxs("div",{className:"forum-card",onClick:()=>b(s),children:[e.jsx("div",{className:"forum-icon",children:"ğŸ’¬"}),e.jsx("h4",{children:s.name}),e.jsxs("p",{className:"forum-stats",children:[s.posts_count||0," gÃ¶nderi â€¢ ",s.members_count||0," Ã¼ye"]})]},s.id))}):e.jsxs("div",{className:"no-forums",children:[e.jsx("p",{children:"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"}),e.jsx("button",{onClick:P,children:"Ä°lk forumu oluÅŸtur"})]})]})]})})};export{K as default};
