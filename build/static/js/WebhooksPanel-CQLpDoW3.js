import{r as c,n as e}from"./react-core-CvG1duuD.js";import{y as n}from"./ui-vendor-CZjcsNHc.js";import{g as D,f}from"./index-CzRXpBw8.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-DQG9xQkU.js";import"./router-vendor-DXeerrpf.js";import"./icons-vendor-DhG1XKwU.js";import"./state-vendor-BJ77FbUv.js";import"./crypto-vendor-BHxPXfg-.js";const G=({serverId:d,onClose:b})=>{const[r,h]=c.useState([]),[j,x]=c.useState(!1),[o,u]=c.useState({name:"",channel_id:"",avatar_url:""}),[k,y]=c.useState([]),[$,W]=c.useState(!0),[_,p]=c.useState(null),[v,S]=c.useState([]),[C,g]=c.useState(null),l=D();c.useEffect(()=>{d&&(B(),w())},[d]);const B=async()=>{try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/webhooks/server/${d}/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();h(t.webhooks||[])}}catch{}finally{W(!1)}},w=async()=>{try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/servers/${d}/channels/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();y(t.channels||[])}}catch{}},T=async()=>{if(!o.name||!o.channel_id){n.error("‚ùå Webhook adƒ± ve kanal se√ßimi zorunludur");return}try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/webhooks/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:d,...o})});if(a.ok){const t=await a.json();h([...r,t.webhook]),u({name:"",channel_id:"",avatar_url:""}),x(!1),n.success("‚úÖ Webhook ba≈üarƒ±yla olu≈üturuldu")}else n.error("‚ùå Webhook olu≈üturulamadƒ±")}catch{n.error("‚ùå Baƒülantƒ± hatasƒ±")}},z=async(s,a)=>{try{const t=localStorage.getItem("access_token"),i=await fetch(`${l}/webhooks/${s}/update/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(i.ok){const m=await i.json();h(r.map(N=>N.id===s?m.webhook:N)),p(null),n.success("‚úÖ Webhook g√ºncellendi")}else n.error("‚ùå Webhook g√ºncellenemedi")}catch{n.error("‚ùå Baƒülantƒ± hatasƒ±")}},L=async s=>{if(await f("Bu webhook'u silmek istediƒüinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${l}/webhooks/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(h(r.filter(i=>i.id!==s)),n.success("‚úÖ Webhook silindi")):n.error("‚ùå Webhook silinemedi")}catch{n.error("‚ùå Baƒülantƒ± hatasƒ±")}},A=async s=>{try{const a=localStorage.getItem("access_token");(await fetch(`${l}/webhooks/${s}/test/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok?n.success("‚úÖ Test mesajƒ± g√∂nderildi"):n.error("‚ùå Test mesajƒ± g√∂nderilemedi")}catch{n.error("‚ùå Baƒülantƒ± hatasƒ±")}},E=async s=>{if(await f("Webhook tokenini yenilemek istediƒüinizden emin misiniz? Eski token ge√ßersiz hale gelecek."))try{const a=localStorage.getItem("access_token"),t=await fetch(`${l}/webhooks/${s}/regenerate-token/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(t.ok){const i=await t.json();h(r.map(m=>m.id===s?{...m,token:i.token}:m)),n.success("‚úÖ Token yenilendi")}else n.error("‚ùå Token yenilenemedi")}catch{n.error("‚ùå Baƒülantƒ± hatasƒ±")}},O=async s=>{try{const a=localStorage.getItem("access_token"),t=await fetch(`${l}/webhooks/${s}/logs/`,{headers:{Authorization:`Bearer ${a}`}});if(t.ok){const i=await t.json();S(i.logs||[]),g(s)}}catch{n.error("‚ùå Loglar y√ºklenemedi")}},R=s=>{const a=`${l}/webhooks/${s.id}/${s.token}`;navigator.clipboard.writeText(a),n.success("‚úÖ Webhook URL kopyalandƒ±")};return $?e.jsx("div",{className:"webhooks-overlay",children:e.jsx("div",{className:"webhooks-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Webhooklar y√ºkleniyor..."})]})})}):e.jsx("div",{className:"webhooks-overlay",onClick:b,children:e.jsxs("div",{className:"webhooks-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsx("h2",{children:"üîó Webhook Y√∂netimi"}),e.jsx("button",{className:"close-btn",onClick:b,children:"√ó"})]}),e.jsxs("div",{className:"webhooks-content",children:[!j&&e.jsx("button",{className:"create-webhook-btn",onClick:()=>x(!0),children:"‚ûï Yeni Webhook Olu≈ütur"}),j&&e.jsxs("div",{className:"create-webhook-form",children:[e.jsx("h3",{children:"Yeni Webhook"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ± *"}),e.jsx("input",{type:"text",placeholder:"√ñrn: GitHub Bot",value:o.name,onChange:s=>u({...o,name:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:o.channel_id,onChange:s=>u({...o,channel_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Kanal se√ßin..."}),k.map(s=>e.jsxs("option",{value:s.id,children:["#",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL (Opsiyonel)"}),e.jsx("input",{type:"text",placeholder:"https://example.com/avatar.png",value:o.avatar_url,onChange:s=>u({...o,avatar_url:s.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>x(!1),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:T,children:"Olu≈ütur"})]})]}),r.length>0?e.jsx("div",{className:"webhooks-list",children:r.map(s=>e.jsx("div",{className:"webhook-card",children:_===s.id?e.jsxs("div",{className:"edit-webhook-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ±"}),e.jsx("input",{type:"text",defaultValue:s.name,id:`edit-name-${s.id}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("select",{defaultValue:s.channel_id,id:`edit-channel-${s.id}`,children:k.map(a=>e.jsxs("option",{value:a.id,children:["#",a.name]},a.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL"}),e.jsx("input",{type:"text",defaultValue:s.avatar_url||"",id:`edit-avatar-${s.id}`})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>p(null),children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:()=>{const a=document.getElementById(`edit-name-${s.id}`).value,t=document.getElementById(`edit-channel-${s.id}`).value,i=document.getElementById(`edit-avatar-${s.id}`).value;z(s.id,{name:a,channel_id:t,avatar_url:i})},children:"Kaydet"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"webhook-info",children:[e.jsx("div",{className:"webhook-avatar",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name}):e.jsx("div",{className:"default-avatar",children:"üîó"})}),e.jsxs("div",{className:"webhook-details",children:[e.jsx("h4",{children:s.name}),e.jsxs("p",{children:["#",k.find(a=>a.id===s.channel_id)?.name||"Bilinmeyen Kanal"]}),e.jsxs("span",{className:"webhook-id",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"webhook-url",children:[e.jsx("label",{children:"Webhook URL:"}),e.jsxs("div",{className:"url-display",children:[e.jsx("code",{children:`${l}/webhooks/${s.id}/${s.token}`}),e.jsx("button",{className:"copy-btn",onClick:()=>R(s),title:"URL'yi kopyala",children:"üìã"})]})]}),e.jsxs("div",{className:"webhook-actions",children:[e.jsx("button",{className:"action-btn test-btn",onClick:()=>A(s.id),title:"Test mesajƒ± g√∂nder",children:"üß™ Test"}),e.jsx("button",{className:"action-btn logs-btn",onClick:()=>O(s.id),title:"Loglarƒ± g√∂r√ºnt√ºle",children:"üìä Loglar"}),e.jsx("button",{className:"action-btn edit-btn",onClick:()=>p(s.id),title:"D√ºzenle",children:"‚úèÔ∏è"}),e.jsx("button",{className:"action-btn regenerate-btn",onClick:()=>E(s.id),title:"Token yenile",children:"üîÑ"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>L(s.id),title:"Sil",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"webhook-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Toplam √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.total_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±lƒ±:"}),e.jsx("span",{className:"stat-value success",children:s.successful_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±sƒ±z:"}),e.jsx("span",{className:"stat-value error",children:s.failed_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Son √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.last_call?new Date(s.last_call).toLocaleString("tr-TR"):"Hi√ß"})]})]})]})},s.id))}):!j&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîó"}),e.jsx("h3",{children:"Hen√ºz webhook yok"}),e.jsx("p",{children:"Dƒ±≈ü uygulamalardan mesaj g√∂ndermek i√ßin webhook olu≈üturun"})]}),C&&e.jsx("div",{className:"logs-modal",onClick:()=>g(null),children:e.jsxs("div",{className:"logs-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"logs-header",children:[e.jsx("h3",{children:"üìä Webhook Loglarƒ±"}),e.jsx("button",{className:"close-btn",onClick:()=>g(null),children:"√ó"})]}),e.jsx("div",{className:"logs-list",children:v.length>0?v.map((s,a)=>e.jsxs("div",{className:`log-item ${s.status}`,children:[e.jsx("div",{className:"log-time",children:new Date(s.timestamp).toLocaleString("tr-TR")}),e.jsxs("div",{className:"log-status",children:[s.status==="success"?"‚úÖ":"‚ùå"," ",s.status]}),e.jsx("div",{className:"log-message",children:s.message}),s.error&&e.jsxs("div",{className:"log-error",children:["Hata: ",s.error]})]},a)):e.jsx("p",{className:"empty-state",children:"Hen√ºz log kaydƒ± yok"})})]})})]})]})})};export{G as default};
