import{r as u,n as a}from"./react-core-BMiyQWF6.js";import{al as U,H as q,a1 as z,h as P}from"./icons-vendor-T72gfvdf.js";import{C as b,G as I,i as h,t as M,A as T}from"./index-CDSQ4ORk.js";import{u as O}from"./recaptcha-Cetfa3Ty.js";import{j as f}from"./crypto-vendor-1Q6e4ZD-.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";const Z=({onLogin:_,onRegister:L,error:y,setAuthError:o})=>{const[g,v]=u.useState(!0),[c,x]=u.useState({username:"",email:"",password:""}),[S,j]=u.useState(!1),{getToken:N}=O();u.useEffect(()=>{if(b.isNativePlatform())try{I.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0})}catch{}},[]),u.useEffect(()=>{if(h&&window.require){const{ipcRenderer:e}=window.require("electron"),s=(w,l)=>{try{const{access:r,refresh:n}=l;if(r&&n){const m=f(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch{o("Token işleme hatası.")}},t=(w,l)=>{o(l.error||"Google girişi başarısız.")},d=(w,l)=>{try{const{access:r,refresh:n}=l;if(r&&n){const m=f(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",n),localStorage.setItem("chat_username",m.username),setTimeout(()=>window.location.reload(),500)}}catch{o("Token işleme hatası.")}},i=(w,l)=>{try{const r=new URL(l),n=new URLSearchParams(r.search),m=n.get("access"),p=n.get("refresh");if(m&&p){const k=f(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",p),localStorage.setItem("chat_username",k.username),window.location.reload()}}catch{try{if(l.includes("access=")&&l.includes("refresh=")){const n=l.split("access=");if(n.length>1){const m=n[1].split("&")[0],p=l.split("refresh=");if(p.length>1){const k=p[1],R=f(m);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",m),localStorage.setItem("refresh_token",k),localStorage.setItem("chat_username",R.username),window.location.reload()}else o("Giriş verisi okunamadı.")}else o("Giriş verisi okunamadı.")}else o("Giriş verisi okunamadı.")}catch{o("Giriş işlemi başarısız.")}}};return e.on("google-auth-success",s),e.on("google-auth-error",t),e.on("deep-link-auth",i),e.on("oauth-tokens",d),()=>{e.removeListener("google-auth-success",s),e.removeListener("google-auth-error",t),e.removeListener("deep-link-auth",i),e.removeListener("oauth-tokens",d)}}},[o]),u.useEffect(()=>{if(!h){const e=new URLSearchParams(window.location.search),s=e.get("access"),t=e.get("refresh"),d=e.get("error");if(d){o(decodeURIComponent(d)),window.history.replaceState({},document.title,"/");return}if(s&&t)try{const i=f(s);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",t),localStorage.setItem("chat_username",i.username),window.history.replaceState({},document.title,"/"),window.location.reload()}catch{o("Tarayıcı depolama hatası. Lütfen gizli modda değilseniz kontrol edin.")}}},[]);const G=async()=>{try{if(b.isNativePlatform()){const e=await I.signIn(),s=`${T}/auth/google/native/`,t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})}),d=t.headers.get("content-type");if(!d||!d.includes("application/json")){const w=await t.text();o("Backend hatası: JSON yerine HTML yanıtı alındı. Sunucu ayarlarını kontrol edin.");return}const i=await t.json();t.ok?i.access&&i.refresh?(localStorage.setItem("access_token",i.access),localStorage.setItem("refresh_token",i.refresh),window.location.reload()):o("Token bilgileri eksik."):o(i.error||"Google girişi başarısız.")}else{const t=`${h?"https://api.pawscord.com/api":T}/auth/google/start/?source=${h?"electron":"web"}`;if(h&&window.require){const{ipcRenderer:d}=window.require("electron");d.send("start-google-login",t)}else window.location.href=t}}catch(e){o("Google girişi sırasında bir hata oluştu: "+e.message)}},C=async e=>{e.preventDefault(),j(!0),o("");try{const s=await N(g?"login":"register");g?await _(c.username,c.password,s):await L(c.username,c.email,c.password,s)&&(M.success("Kayıt başarılı! Lütfen e-postanı kontrol et.",4e3),v(!0))}catch{o("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.")}finally{j(!1)}};return a.jsxs("div",{className:"login-container",children:[a.jsx("div",{className:"background-animate"}),a.jsxs("div",{className:"login-card",children:[a.jsxs("div",{className:"logo-header",children:[a.jsx("div",{className:"logo-circle",children:a.jsx(U,{size:40,color:"white"})}),a.jsx("h1",{children:"Pawscord"}),a.jsx("p",{children:g?"Tekrar hoşgeldin!":"Aramıza katıl!"})]}),y&&a.jsx("div",{className:"error-message",children:y}),a.jsxs("form",{onSubmit:C,children:[a.jsxs("div",{className:"input-group",children:[a.jsx(q,{className:"input-icon"}),a.jsx("input",{type:"text",placeholder:"Kullanıcı Adı",value:c.username,onChange:e=>x({...c,username:e.target.value}),required:!0})]}),!g&&a.jsxs("div",{className:"input-group slide-down",children:[a.jsx(z,{className:"input-icon"}),a.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:c.email,onChange:e=>x({...c,email:e.target.value}),required:!0})]}),a.jsxs("div",{className:"input-group",children:[a.jsx(P,{className:"input-icon"}),a.jsx("input",{type:"password",placeholder:"Şifre",value:c.password,onChange:e=>x({...c,password:e.target.value}),required:!0})]}),a.jsx("button",{type:"submit",className:"submit-btn",disabled:S,children:S?a.jsx("div",{className:"spinner"}):g?"Giriş Yap":"Kayıt Ol"})]}),g&&a.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:a.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1",children:"Şifremi Unuttum?"})}),a.jsx("div",{className:"divider",children:a.jsx("span",{children:"veya"})}),a.jsx("div",{className:"google-btn-wrapper",children:a.jsxs("button",{onClick:G,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5",children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),a.jsx("span",{children:"Google ile Giriş Yap"})]})}),a.jsxs("div",{className:"toggle-mode",children:[g?"Hesabın yok mu? ":"Zaten üye misin? ",a.jsx("span",{onClick:()=>{v(!g),o("")},children:g?"Kayıt Ol":"Giriş Yap"})]})]})]})};export{Z as default};
