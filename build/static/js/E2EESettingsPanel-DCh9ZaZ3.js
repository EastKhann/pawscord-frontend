import{a as G,_ as O}from"./media-vendor-BuSyE8vR.js";import{r as a,n as e}from"./react-core-BMiyQWF6.js";import{t as l}from"./index-6woDk0p4.js";import{a4 as F,a as P,cn as W,ar as R,h as _,d as T,A as q,D as Q,c as A,s as J}from"./icons-vendor-T72gfvdf.js";import"./editor-vendor-D9c4a6XZ.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const X=({username:f,targetUser:i,apiBaseUrl:g,fetchWithAuth:b,onClose:p})=>{const[x,v]=a.useState(null),[d,m]=a.useState(!1),[y,c]=a.useState(!1),[B,z]=a.useState(!0),[C,h]=a.useState(!1);a.useEffect(()=>{E()},[i]);const E=async()=>{try{const s=await(await b(`${g}/e2ee/safety-number/${i}/`)).json();v(s.safetyNumber),m(s.verified),c(s.verifiedByMe),z(!1)}catch{z(!1)}},K=async()=>{try{const s=await(await b(`${g}/e2ee/verify-safety-number/${i}/`,{method:"POST"})).json();c(!0),m(s.bothVerified),l.success(`âœ… Safety number doÄŸrulandÄ±!${s.bothVerified?`

Her iki taraf da doÄŸruladÄ±! ðŸŽ‰`:""}`)}catch{l.error("âŒ DoÄŸrulama baÅŸarÄ±sÄ±z!")}};return B?e.jsx("div",{style:t.overlay,onClick:p,children:e.jsx("div",{style:t.modal,onClick:r=>r.stopPropagation(),children:e.jsx("p",{style:t.loading,children:"YÃ¼kleniyor..."})})}):e.jsx("div",{style:t.overlay,onClick:p,children:e.jsxs("div",{style:t.modal,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsx(F,{size:32,color:d?"#43b581":"#faa61a"}),e.jsx("h2",{style:t.title,children:"Safety Number"}),e.jsx("button",{onClick:p,style:t.closeButton,children:e.jsx(P,{})})]}),e.jsx("div",{style:t.user,children:i}),C?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.qrContainer,children:e.jsx(G,{value:x||"",size:200})}),e.jsx("button",{onClick:()=>h(!1),style:t.qrButton,children:"NumarayÄ± GÃ¶ster"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.numberContainer,children:x?.split(" ").map((r,s)=>e.jsx("div",{style:t.numberGroup,children:r},s))}),e.jsxs("button",{onClick:()=>h(!0),style:t.qrButton,children:[e.jsx(W,{})," QR Kodu GÃ¶ster"]})]}),e.jsx("div",{style:t.statusContainer,children:d?e.jsxs("div",{style:t.statusVerified,children:[e.jsx(R,{size:20}),e.jsx("span",{children:"Her iki taraf da doÄŸruladÄ±! âœ…"})]}):y?e.jsxs("div",{style:t.statusPartial,children:[e.jsx(R,{size:20}),e.jsxs("span",{children:["Siz doÄŸruladÄ±nÄ±z. ",i," henÃ¼z doÄŸrulamadÄ±."]})]}):e.jsxs("div",{style:t.statusUnverified,children:[e.jsx(P,{size:20}),e.jsx("span",{children:"HenÃ¼z doÄŸrulanmadÄ±"})]})}),e.jsxs("div",{style:t.info,children:[e.jsx("h3",{children:"Safety Number Nedir?"}),e.jsxs("p",{children:["Safety number, sizin ve ",i,"'in ÅŸifreleme anahtarlarÄ±nÄ±n parmak izidir (fingerprint). Bu numarayÄ± karÅŸÄ±laÅŸtÄ±rarak identity key'lerini doÄŸrulayabilirsiniz."]}),e.jsx("h3",{children:"NasÄ±l DoÄŸrulanÄ±r?"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[i," ile yÃ¼z yÃ¼ze gÃ¶rÃ¼ÅŸÃ¼n veya gÃ¼venilir bir kanal kullanÄ±n"]}),e.jsx("li",{children:"Her ikiniz de safety number'Ä± aÃ§Ä±n"}),e.jsx("li",{children:"NumaralarÄ± karÅŸÄ±laÅŸtÄ±rÄ±n (aynÄ± olmalÄ±!)"}),e.jsx("li",{children:'EÅŸleÅŸiyorsa "DoÄŸrula" butonuna basÄ±n'})]})]}),!y&&e.jsxs("button",{onClick:K,style:t.verifyButton,children:[e.jsx(R,{})," Bu NumarayÄ± DoÄŸrula"]})]})})},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e5},modal:{backgroundColor:"#2b2d31",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",position:"relative"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",flex:1},closeButton:{backgroundColor:"transparent",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"4px",fontSize:"20px"},user:{color:"#5865f2",fontSize:"18px",fontWeight:"500",marginBottom:"24px",textAlign:"center"},numberContainer:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},numberGroup:{backgroundColor:"#1e1f22",color:"#fff",padding:"12px",borderRadius:"4px",textAlign:"center",fontSize:"18px",fontFamily:"monospace",letterSpacing:"2px"},qrContainer:{display:"flex",justifyContent:"center",marginBottom:"24px",padding:"16px",backgroundColor:"#fff",borderRadius:"8px"},qrButton:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"4px",padding:"10px 16px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto 24px"},statusContainer:{marginBottom:"24px"},statusVerified:{backgroundColor:"#43b581",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusPartial:{backgroundColor:"#faa61a",color:"#000",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusUnverified:{backgroundColor:"#ed4245",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},info:{backgroundColor:"#1e1f22",padding:"16px",borderRadius:"8px",marginBottom:"24px",color:"#b9bbbe",fontSize:"14px"},verifyButton:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"4px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},loading:{color:"#b9bbbe",textAlign:"center",padding:"32px"}},le=({username:f,apiBaseUrl:i,fetchWithAuth:g})=>{const[b,p]=a.useState(!1),[x,v]=a.useState(null),[d,m]=a.useState(null),[y,c]=a.useState(!1),[B,z]=a.useState({encryptedMessagesCount:0,trustedContacts:0,lastKeyRotation:null}),[C,h]=a.useState(!1),[E,K]=a.useState(null);a.useEffect(()=>{r()},[]);const r=()=>{const o=localStorage.getItem("e2ee_enabled")==="true",j=localStorage.getItem("e2ee_setup_date"),k=localStorage.getItem("e2ee_last_rotation");p(o),v(j?new Date(j):null),m(k?new Date(k):null)},s=async()=>{if(window.confirm(`ðŸ”‘ AnahtarlarÄ± yenilemek istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ Yeni kimlik anahtarlarÄ± oluÅŸturur
â€¢ Eski ÅŸifreli mesajlar okunamaz hale gelir
â€¢ TÃ¼m kiÅŸilerle yeniden gÃ¼venlik doÄŸrulamasÄ± gerekir`)){c(!0);try{const{generateIdentityKeyPair:o,generateSignedPreKeyPair:j,generateOneTimePreKeys:k,storePrivateKeys:H}=await O(async()=>{const{generateIdentityKeyPair:u,generateSignedPreKeyPair:$,generateOneTimePreKeys:L,storePrivateKeys:Y}=await import("./e2ee-DAIuxcxx.js");return{generateIdentityKeyPair:u,generateSignedPreKeyPair:$,generateOneTimePreKeys:L,storePrivateKeys:Y}},[]);l.info("ðŸ” Yeni anahtarlar oluÅŸturuluyor...");const I=await o(),S=await j(Date.now(),I.privateKey),V=await k(100);if(await H(f,I.privateKey,S.privateKey),l.info("â˜ï¸ Sunucuya yÃ¼kleniyor..."),(await g(`${i}/e2ee/rotate-keys/`,{method:"POST",body:JSON.stringify({identityPublicKey:I.publicKey,signedPreKeyId:S.keyId,signedPreKeyPublic:S.publicKey,signedPreKeySignature:S.signature,oneTimePreKeys:V.map(u=>({keyId:u.keyId,publicKey:u.publicKey}))})})).ok){const u=new Date().toISOString();localStorage.setItem("e2ee_last_rotation",u),m(new Date(u)),l.success("âœ… Anahtarlar baÅŸarÄ±yla yenilendi!")}else throw new Error("Key rotation failed")}catch{l.error("âŒ Anahtar yenileme baÅŸarÄ±sÄ±z!")}finally{c(!1)}}},N=async()=>{if(window.confirm(`âš ï¸ E2EE'yi devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ TÃ¼m ÅŸifreli mesajlarÄ±nÄ±zÄ± siler
â€¢ AnahtarlarÄ±nÄ±zÄ± kaldÄ±rÄ±r
â€¢ Geri alÄ±namaz!`)){c(!0);try{localStorage.removeItem("e2ee_enabled"),localStorage.removeItem("e2ee_setup_date"),localStorage.removeItem("e2ee_last_rotation"),localStorage.removeItem(`e2ee_identity_private_${f}`),localStorage.removeItem(`e2ee_signed_pre_key_private_${f}`),p(!1),l.success("âœ… E2EE devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±")}catch{l.error("âŒ Ä°ÅŸlem baÅŸarÄ±sÄ±z!")}finally{c(!1)}}},D=o=>o?o.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"HiÃ§",w=d?Math.floor((new Date-d)/(1e3*60*60*24)):x?Math.floor((new Date-x)/(1e3*60*60*24)):null,M=w&&w>90;return b?e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsx(_,{size:24}),e.jsx("h3",{style:n.title,children:"E2EE AyarlarÄ±"})]}),e.jsxs("div",{style:n.statusCard,children:[e.jsxs("div",{style:n.statusHeader,children:[e.jsx(q,{size:32,color:"#43b581"}),e.jsx("span",{style:n.statusText,children:"E2EE Aktif"})]}),e.jsxs("div",{style:n.statusInfo,children:[e.jsxs("div",{style:n.infoRow,children:[e.jsx(Q,{}),e.jsxs("span",{children:["Kurulum: ",D(x)]})]}),d&&e.jsxs("div",{style:n.infoRow,children:[e.jsx(A,{}),e.jsxs("span",{children:["Son Yenileme: ",D(d)]})]})]})]}),M&&e.jsxs("div",{style:n.warningCard,children:[e.jsx(T,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Anahtar Yenileme Ã–nerilir"}),e.jsxs("p",{children:["Son anahtar yenilemeden ",w," gÃ¼n geÃ§ti. GÃ¼venlik iÃ§in anahtarlarÄ±nÄ±zÄ± yenileyin."]})]})]}),e.jsxs("div",{style:n.actions,children:[e.jsxs("button",{onClick:s,disabled:y,style:n.rotateButton,children:[e.jsx(A,{}),y?"Yenileniyor...":"AnahtarlarÄ± Yenile"]}),e.jsxs("button",{onClick:N,disabled:y,style:n.disableButton,children:[e.jsx(J,{}),"E2EE\\'yi Devre DÄ±ÅŸÄ± BÄ±rak"]})]}),e.jsxs("div",{style:n.infoSection,children:[e.jsxs("h4",{style:n.infoTitle,children:[e.jsx(F,{}),"E2EE HakkÄ±nda"]}),e.jsxs("ul",{style:n.infoList,children:[e.jsx("li",{children:"âœ… MesajlarÄ±nÄ±z uÃ§tan uca ÅŸifrelenir"}),e.jsx("li",{children:"âœ… Sadece siz ve karÅŸÄ±nÄ±zdaki kiÅŸi okuyabilir"}),e.jsx("li",{children:"âœ… Sunucu bile mesajlarÄ± gÃ¶remez"}),e.jsx("li",{children:"âš ï¸ AnahtarlarÄ±nÄ±zÄ± kaybederseniz mesajlar okunamaz"}),e.jsx("li",{children:"ðŸ”‘ 90 gÃ¼nde bir anahtar yenileme Ã¶nerilir"})]})]}),C&&e.jsx(X,{username:f,targetUser:E,apiBaseUrl:i,fetchWithAuth:g,onClose:()=>h(!1)})]}):e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsx(_,{size:24}),e.jsx("h3",{style:n.title,children:"End-to-End Encryption"})]}),e.jsxs("div",{style:n.disabledState,children:[e.jsx(T,{size:48,color:"#faa61a"}),e.jsx("h4",{children:"E2EE Devre DÄ±ÅŸÄ±"}),e.jsx("p",{children:"Åžu anda E2EE kullanmÄ±yorsunuz. MesajlarÄ±nÄ±zÄ± ÅŸifrelemek iÃ§in ayarlardan etkinleÅŸtirin."})]})]})},n={container:{padding:"20px",backgroundColor:"#2f3136",borderRadius:"8px",color:"#dcddde"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",paddingBottom:"16px",borderBottom:"2px solid #40444b"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},statusCard:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px",marginBottom:"16px",border:"2px solid #43b581"},statusHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},statusText:{fontSize:"18px",fontWeight:"bold",color:"#43b581"},statusInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#b9bbbe"},warningCard:{backgroundColor:"#faa61a20",border:"2px solid #faa61a",borderRadius:"8px",padding:"16px",marginBottom:"16px",display:"flex",gap:"12px",alignItems:"flex-start",color:"#faa61a"},actions:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},rotateButton:{padding:"12px 20px",backgroundColor:"#5865f2",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disableButton:{padding:"12px 20px",backgroundColor:"#ed4245",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disabledState:{textAlign:"center",padding:"40px 20px",color:"#b9bbbe"},infoSection:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px"},infoTitle:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"16px"},infoList:{margin:0,paddingLeft:"20px",color:"#b9bbbe",fontSize:"14px",lineHeight:"1.8"}};export{le as default};
