var W=Object.defineProperty;var l=(a,i)=>W(a,"name",{value:i,configurable:!0});import{r as c,a as T,j as e}from"./react-core-Djgtqrmb.js";import{a as B,an as L,d as C,aB as A,ay as z,t as D,C as F,f as $}from"./icons-vendor-BW7dxHkX.js";import{t as S,d as R}from"./index-m2zCEI_Z.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},E=l((a,i,r)=>{const[d,p]=c.useState([]),[m,o]=c.useState([]),[j,y]=c.useState(!0),[k,_]=c.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0}),u=c.useCallback(async()=>{y(!0);try{const t=await i(`${r}/moderation/warnings/${a}/`);if(t.ok){const s=await t.json();p(s.results||s)}}catch{}y(!1)},[a,i,r]),v=c.useCallback(async()=>{try{const t=await i(`${r}/servers/${a}/members/`);t.ok&&o(await t.json())}catch{}},[a,i,r]),b=c.useCallback(async()=>{try{const t=await i(`${r}/moderation/warnings/stats/${a}/`);t.ok&&_(await t.json())}catch{}},[a,i,r]);c.useEffect(()=>{u(),v(),b()},[u,v,b]);const h=c.useCallback(async(t,s)=>{try{(await i(`${r}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:a,user:t,reason:s})})).ok&&(S.success("âœ… User banned successfully"),u(),b())}catch{}},[a,i,r,u,b]),w=c.useCallback(async t=>{if(!t.user_id||!t.reason)return S.error("âŒ Please select a user and provide a reason"),!1;try{const s=await i(`${r}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:a,user:t.user_id,reason:t.reason,severity:t.severity,expires_at:new Date(Date.now()+t.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(s.ok){const g=await s.json();return g.total_warnings>=t.auto_ban_on&&await R(`User has ${g.total_warnings} warnings. Auto-ban now?`)&&await h(t.user_id,`Auto-ban: ${t.auto_ban_on} warnings reached`),u(),b(),!0}else S.error("âŒ Failed to add warning")}catch{}return!1},[a,i,r,h,u,b]),f=c.useCallback(async t=>{if(await R("Remove this warning?"))try{(await i(`${r}/moderation/warnings/${t}/`,{method:"DELETE"})).ok?(u(),b()):S.error("âŒ Failed to remove warning")}catch{}},[i,r,u,b]);return{warnings:d,users:m,loading:j,stats:k,addWarning:w,removeWarning:f,banUser:h}},"useWarnings"),G={user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3},N=l(({users:a,onAdd:i,onClose:r})=>{const[d,p]=c.useState(G),m=l(async()=>{await i(d)&&r()},"handleAdd");return e.jsx("div",{style:n.modalOverlay,onClick:r,children:e.jsxs("div",{style:n.modal,onClick:l(o=>o.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:n.modalHeader,children:[e.jsx("h3",{style:n.modalTitle,children:"Add Warning"}),e.jsx("button",{onClick:r,style:n.modalClose,children:e.jsx(B,{})})]}),e.jsxs("div",{style:n.modalContent,children:[e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"User"}),e.jsxs("select",{value:d.user_id,onChange:l(o=>p({...d,user_id:o.target.value}),"onChange"),style:n.select,children:[e.jsx("option",{value:"",children:"Select user..."}),a.map(o=>e.jsx("option",{value:o.id,children:o.username},o.id))]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Reason"}),e.jsx("textarea",{value:d.reason,onChange:l(o=>p({...d,reason:o.target.value}),"onChange"),placeholder:"Why is this warning being issued?",style:n.textarea,rows:"3"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Severity"}),e.jsxs("select",{value:d.severity,onChange:l(o=>p({...d,severity:o.target.value}),"onChange"),style:n.select,children:[e.jsxs("option",{value:"low",children:["ðŸŸ¢"," Low"]}),e.jsxs("option",{value:"medium",children:["ðŸŸ¡"," Medium"]}),e.jsxs("option",{value:"high",children:["ðŸ”´"," High"]})]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:d.expires_in_days,onChange:l(o=>p({...d,expires_in_days:parseInt(o.target.value)}),"onChange"),style:n.input,min:"1",max:"365"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Auto-ban Threshold"}),e.jsx("input",{type:"number",value:d.auto_ban_on,onChange:l(o=>p({...d,auto_ban_on:parseInt(o.target.value)}),"onChange"),style:n.input,min:"2",max:"10"}),e.jsxs("div",{style:n.hint,children:["User will be auto-banned after reaching ",d.auto_ban_on," active warnings"]})]})]}),e.jsxs("div",{style:n.modalActions,children:[e.jsx("button",{onClick:r,style:n.cancelBtn,children:"Cancel"}),e.jsxs("button",{onClick:m,style:n.submitBtn,children:[e.jsx(L,{})," Add Warning"]})]})]})})},"AddWarningModal"),O=T.memo(N),H=l(a=>{switch(a){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},"getSeverityColor"),Q=l(({serverId:a,fetchWithAuth:i,apiBaseUrl:r,onClose:d})=>{const[p,m]=c.useState(""),[o,j]=c.useState(!1),{warnings:y,users:k,loading:_,stats:u,addWarning:v,removeWarning:b,banUser:h}=E(a,i,r),w=c.useMemo(()=>y.filter(t=>!p||t.user_username?.toLowerCase().includes(p.toLowerCase())||t.reason?.toLowerCase().includes(p.toLowerCase())).reduce((t,s)=>(t[s.user]||(t[s.user]={user_id:s.user,username:s.user_username,warnings:[]}),t[s.user].warnings.push(s),t),{}),[y,p]);return e.jsx("div",{style:n.overlay,onClick:d,children:e.jsxs("div",{style:n.panel,onClick:l(f=>f.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{style:n.headerLeft,children:[e.jsx(C,{style:n.headerIcon}),e.jsx("h2",{style:n.title,children:"User Warnings"})]}),e.jsxs("div",{style:n.headerRight,children:[e.jsxs("button",{onClick:l(()=>j(!0),"onClick"),style:n.addBtn,children:[e.jsx(L,{})," Add Warning"]}),e.jsx("button",{onClick:d,style:n.closeButton,children:e.jsx(B,{})})]})]}),e.jsx("div",{style:n.statsGrid,children:[{icon:C,color:"#f0b132",value:u.total_warnings,label:"Total Warnings"},{icon:C,color:"#43b581",value:u.active_warnings,label:"Active"},{icon:A,color:"#72767d",value:u.expired_warnings,label:"Expired"},{icon:z,color:"#ed4245",value:u.auto_banned_users,label:"Auto-Banned"}].map(({icon:f,color:t,value:s,label:g})=>e.jsxs("div",{style:n.statCard,children:[e.jsx(f,{style:{...n.statIcon,color:t}}),e.jsx("div",{style:n.statValue,children:s}),e.jsx("div",{style:n.statLabel,children:g})]},g))}),e.jsxs("div",{style:n.searchBar,children:[e.jsx(D,{style:n.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by username or reason...",value:p,onChange:l(f=>m(f.target.value),"onChange"),style:n.searchInput})]}),e.jsx("div",{style:n.warningsList,children:_?e.jsx("div",{style:n.loading,children:"Loading warnings..."}):Object.keys(w).length===0?e.jsxs("div",{style:n.empty,children:[e.jsx(C,{style:n.emptyIcon}),e.jsx("p",{children:"No warnings found"})]}):Object.values(w).map(({user_id:f,username:t,warnings:s})=>{const g=s.filter(x=>x.is_active),I=g.length>=2;return e.jsxs("div",{style:n.userCard,children:[e.jsxs("div",{style:n.userHeader,children:[e.jsxs("div",{style:n.userInfo,children:[e.jsx(F,{style:n.userIcon}),e.jsx("div",{style:n.userName,children:t}),e.jsxs("span",{style:{...n.badge,backgroundColor:I?"#ed4245":"#f0b132"},children:[g.length," Active Warning",g.length!==1?"s":""]}),I&&e.jsxs("span",{style:n.riskBadge,children:["âš ï¸"," AT RISK"]})]}),g.length>=3&&e.jsxs("button",{onClick:l(()=>h(f,"Auto-ban: 3 warnings"),"onClick"),style:n.banBtn,children:[e.jsx(z,{})," Ban User"]})]}),e.jsx("div",{style:n.userWarnings,children:s.map(x=>e.jsxs("div",{style:{...n.warningItem,opacity:x.is_active?1:.5},children:[e.jsxs("div",{style:n.warningLeft,children:[e.jsx("div",{style:{...n.severityDot,backgroundColor:H(x.severity)}}),e.jsxs("div",{style:n.warningContent,children:[e.jsx("div",{style:n.warningReason,children:x.reason}),e.jsxs("div",{style:n.warningMeta,children:[e.jsx("span",{children:x.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(x.created_at).toLocaleString()}),x.expires_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Expires: ",new Date(x.expires_at).toLocaleDateString()]})]}),!x.is_active&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{style:{color:"#72767d"},children:"EXPIRED"})]})]})]})]}),x.is_active&&!x.is_auto&&e.jsx("button",{onClick:l(()=>b(x.id),"onClick"),style:n.removeBtn,title:"Remove warning",children:e.jsx($,{})})]},x.id))})]},f)})}),o&&e.jsx(O,{users:k,onAdd:v,onClose:l(()=>j(!1),"onClose")})]})})},"UserWarningsPanel");export{Q as default};
