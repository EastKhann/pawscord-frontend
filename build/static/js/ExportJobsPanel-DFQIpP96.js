import{r as c,j as e}from"./react-core-D6cE4lil.js";import{z as w,aL as E,v as j,w as T,a5 as g,a as h,bc as z}from"./icons-vendor-fClA8qVL.js";import{t as i,d as k}from"./index-B3eDbSm-.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const b=[{id:"messages",name:"Messages",description:"Export all your messages"},{id:"server",name:"Server Data",description:"Export server content"},{id:"dm",name:"Direct Messages",description:"Export DM history"},{id:"media",name:"Media Files",description:"Export uploaded media"},{id:"profile",name:"Profile Data",description:"Export your profile info"},{id:"analytics",name:"Analytics",description:"Export analytics data"}],F=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(2)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(2)} MB`:`${(r/(1024*1024*1024)).toFixed(2)} GB`,B={completed:e.jsx(T,{style:{color:"#43b581"}}),processing:e.jsx(j,{style:{color:"#faa61a"},className:"fa-spin"}),failed:e.jsx(E,{style:{color:"#f04747"}})},D={completed:"#43b581",processing:"#faa61a",failed:"#f04747"},R=r=>B[r]||e.jsx(w,{style:{color:"#99aab5"}}),L=r=>D[r]||"#99aab5";function I(r,a){const[p,s]=c.useState([]),[o,f]=c.useState(!0),[m,S]=c.useState("messages"),[C,y]=c.useState(!1),x=async()=>{try{const l=await(await r(`${a}/exports/jobs/`)).json();s(l.jobs||[])}catch{}finally{f(!1)}};return c.useEffect(()=>{x();const n=setInterval(x,5e3);return()=>clearInterval(n)},[]),{jobs:p,loading:o,exportType:m,setExportType:S,creating:C,createExport:async()=>{y(!0);try{const l=await(await r(`${a}/exports/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:m})})).json();l.success?(i.success("Export job created! Processing..."),x()):i.error(l.error||"Failed to create export")}catch{i.error("Failed to create export")}finally{y(!1)}},downloadExport:async n=>{try{const v=await(await r(`${a}/exports/${n}/download/`)).blob(),u=window.URL.createObjectURL(v),d=document.createElement("a");d.href=u,d.download=`export_${n}.zip`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(u),i.success("Download started!")}catch{i.error("Download failed")}},deleteJob:async n=>{if(await k("Delete this export job?"))try{await r(`${a}/exports/${n}/delete/`,{method:"DELETE"}),i.success("Export job deleted"),x()}catch{i.error("Failed to delete job")}}}}const t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},createSection:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",marginBottom:"24px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},exportTypeSelector:{display:"flex",gap:"12px"},select:{flex:1,padding:"10px",backgroundColor:"#202225",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px"},createBtn:{padding:"10px 24px",backgroundColor:"#5865f2",border:"none",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},jobsSection:{marginBottom:"24px"},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},empty:{textAlign:"center",padding:"60px 20px",color:"#dcddde"},jobsList:{display:"flex",flexDirection:"column",gap:"12px"},jobCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center",gap:"16px"},jobIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},jobDetails:{flex:1},jobTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"4px"},jobMeta:{fontSize:"12px",color:"#99aab5",marginBottom:"8px"},progressBar:{position:"relative",height:"20px",backgroundColor:"#202225",borderRadius:"10px",overflow:"hidden",marginTop:"8px"},progressFill:{height:"100%",backgroundColor:"#5865f2",transition:"width 0.3s ease"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:"600",color:"#fff"},fileSize:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},jobActions:{display:"flex",alignItems:"center",gap:"8px"},statusBadge:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},downloadBtn:{padding:"8px 12px",backgroundColor:"#43b581",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},deleteBtn:{padding:"8px 12px",backgroundColor:"#f04747",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},info:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},infoText:{fontSize:"14px",color:"#dcddde",margin:"8px 0",lineHeight:"1.6"}},H=({fetchWithAuth:r,apiBaseUrl:a,onClose:p})=>{const s=I(r,a);return e.jsx("div",{style:t.overlay,onClick:p,children:e.jsxs("div",{style:t.modal,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(g,{style:{fontSize:"24px",color:"#5865f2"}}),e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"Export Jobs"})]}),e.jsx("button",{onClick:p,style:t.closeBtn,children:e.jsx(h,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.createSection,children:[e.jsx("h3",{style:t.sectionTitle,children:"Create New Export"}),e.jsxs("div",{style:t.exportTypeSelector,children:[e.jsx("select",{value:s.exportType,onChange:o=>s.setExportType(o.target.value),style:t.select,children:b.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",o.description]},o.id))}),e.jsx("button",{onClick:s.createExport,disabled:s.creating,style:t.createBtn,children:s.creating?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"fa-spin"})," Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{})," Create Export"]})})]})]}),e.jsxs("div",{style:t.jobsSection,children:[e.jsx("h3",{style:t.sectionTitle,children:"Your Export Jobs"}),s.loading?e.jsx("div",{style:t.loading,children:"Loading jobs..."}):s.jobs.length===0?e.jsxs("div",{style:t.empty,children:[e.jsx(z,{style:{fontSize:"48px",color:"#99aab5",marginBottom:"16px"}}),e.jsx("p",{children:"No export jobs yet"}),e.jsx("p",{style:{fontSize:"14px",color:"#99aab5"},children:"Create your first export to get started"})]}):e.jsx("div",{style:t.jobsList,children:s.jobs.map(o=>e.jsxs("div",{style:t.jobCard,children:[e.jsx("div",{style:t.jobIcon,children:R(o.status)}),e.jsxs("div",{style:t.jobDetails,children:[e.jsx("div",{style:t.jobTitle,children:b.find(f=>f.id===o.type)?.name||o.type}),e.jsxs("div",{style:t.jobMeta,children:[e.jsxs("span",{children:["Created: ",new Date(o.created_at).toLocaleString()]}),o.completed_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{margin:"0 8px"},children:"â€¢"}),e.jsxs("span",{children:["Completed: ",new Date(o.completed_at).toLocaleString()]})]})]}),o.status==="processing"&&o.progress&&e.jsxs("div",{style:t.progressBar,children:[e.jsx("div",{style:{...t.progressFill,width:`${o.progress}%`}}),e.jsxs("span",{style:t.progressText,children:[o.progress,"%"]})]}),o.file_size&&e.jsxs("div",{style:t.fileSize,children:["Size: ",F(o.file_size)]})]}),e.jsxs("div",{style:t.jobActions,children:[e.jsx("span",{style:{...t.statusBadge,backgroundColor:L(o.status)},children:o.status}),o.status==="completed"&&e.jsx("button",{onClick:()=>s.downloadExport(o.id),style:t.downloadBtn,title:"Download",children:e.jsx(g,{})}),e.jsx("button",{onClick:()=>s.deleteJob(o.id),style:t.deleteBtn,title:"Delete",children:e.jsx(h,{})})]})]},o.id))})]}),e.jsxs("div",{style:t.info,children:[e.jsxs("p",{style:t.infoText,children:["ðŸ“¦"," Exports are processed in the background and may take a few minutes"]}),e.jsxs("p",{style:t.infoText,children:["ðŸ’¾"," Completed exports are available for 7 days before auto-deletion"]})]})]})]})})};export{H as default};
