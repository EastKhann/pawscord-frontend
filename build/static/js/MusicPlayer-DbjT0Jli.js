import{r as s,d as e,cM as Q,cH as L,cZ as V,dg as D,bJ as J,bK as K,dh as Y,a1 as G,di as H,aC as Z,bQ as W,$ as X,i as q}from"./react-core-DrOm_csO.js";import{t as r}from"./index-BYhWpPLp.js";const ae=({channelId:n})=>{const[o,f]=s.useState(!1),[l,u]=s.useState(null),[c,d]=s.useState([]),[E,N]=s.useState(70),[m,_]=s.useState(!1),[v,x]=s.useState(!1),[g,z]=s.useState(!1),[S,b]=s.useState(!1),[$,p]=s.useState(!1),[k,C]=s.useState(""),[T,P]=s.useState(0),[h,A]=s.useState(0),i=s.useRef(null);s.useEffect(()=>{B();const t=setInterval(()=>{o&&i.current&&(P(i.current.currentTime),A(i.current.duration))},1e3);return()=>clearInterval(t)},[o]);const B=async()=>{try{const t=await fetch(`/api/music/status/${n}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const a=await t.json();u(a.current_track),d(a.queue||[]),f(a.is_playing),N(a.volume||70)}}catch(t){console.error("Failed to fetch player status:",t)}},R=async()=>{try{(await fetch(`/api/music/${o?"pause":"play"}/${n}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(f(!o),r.success(o?"⏸️ Durakladı":"▶️ Çalıyor"))}catch{r.error("❌ İşlem başarısız")}},M=async()=>{try{const t=await fetch(`/api/music/skip/${n}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const a=await t.json();u(a.current_track),r.success("⏭️ Sonraki şarkı")}}catch{r.error("❌ Atlama başarısız")}},O=async()=>{try{const t=await fetch(`/api/music/previous/${n}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const a=await t.json();u(a.current_track),r.success("⏮️ Önceki şarkı")}}catch{r.error("❌ Geri alma başarısız")}},j=async t=>{N(t);try{await fetch(`/api/music/volume/${n}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({volume:t})})}catch(a){console.error("Volume change failed:",a)}},w=async()=>{if(!k.trim()){r.error("❌ URL girin");return}try{const t=await fetch(`/api/music/add/${n}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({url:k})});if(t.ok){const a=await t.json();d([...c,a.track]),C(""),p(!1),r.success("✅ Sıraya eklendi")}else r.error("❌ Eklenemedi")}catch{r.error("❌ Bağlantı hatası")}},U=async t=>{try{(await fetch(`/api/music/remove/${n}/${t}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(d(c.filter(y=>y.id!==t)),r.success("✅ Sıradan çıkarıldı"))}catch{r.error("❌ İşlem başarısız")}},F=t=>{if(!t||isNaN(t))return"0:00";const a=Math.floor(t/60),y=Math.floor(t%60);return`${a}:${y.toString().padStart(2,"0")}`},I=t=>{const a=t.target.value/100*h;P(a),i.current&&(i.current.currentTime=a)};return e.createElement("div",{className:"music-player"},e.createElement("audio",{ref:i,src:l?.audio_url}),e.createElement("div",{className:"player-main"},e.createElement("div",{className:"track-info"},l?e.createElement(e.Fragment,null,e.createElement("img",{src:l.thumbnail||"/default-music.png",alt:l.title,className:"track-thumbnail"}),e.createElement("div",{className:"track-details"},e.createElement("div",{className:"track-title"},l.title),e.createElement("div",{className:"track-artist"},l.artist||"Bilinmeyen Sanatçı")),e.createElement("div",{className:"track-source"},l.source==="youtube"&&e.createElement(Q,{className:"source-icon youtube"}),l.source==="spotify"&&e.createElement(L,{className:"source-icon spotify"}))):e.createElement("div",{className:"no-track"},e.createElement("span",null,"Şarkı seçilmedi"))),e.createElement("div",{className:"player-controls"},e.createElement("div",{className:"control-buttons"},e.createElement("button",{className:`control-btn ${v?"active":""}`,onClick:()=>x(!v),title:"Karıştır"},e.createElement(V,null)),e.createElement("button",{className:"control-btn",onClick:O,title:"Önceki"},e.createElement(D,null)),e.createElement("button",{className:"control-btn play-btn",onClick:R},o?e.createElement(J,null):e.createElement(K,null)),e.createElement("button",{className:"control-btn",onClick:M,title:"Sonraki"},e.createElement(Y,null)),e.createElement("button",{className:`control-btn ${g?"active":""}`,onClick:()=>z(!g),title:"Tekrarla"},e.createElement(G,null))),e.createElement("div",{className:"progress-container"},e.createElement("span",{className:"time-display"},F(T)),e.createElement("input",{type:"range",className:"progress-bar",min:"0",max:"100",value:T/h*100||0,onChange:I}),e.createElement("span",{className:"time-display"},F(h)))),e.createElement("div",{className:"player-extras"},e.createElement("button",{className:"extra-btn",onClick:()=>b(!S),title:"Sıra"},e.createElement(H,null),c.length>0&&e.createElement("span",{className:"queue-count"},c.length)),e.createElement("button",{className:"extra-btn",onClick:()=>p(!$),title:"Şarkı Ekle"},e.createElement(Z,null)),e.createElement("div",{className:"volume-control"},e.createElement("button",{className:"extra-btn",onClick:()=>_(!m)},m||E===0?e.createElement(W,null):e.createElement(X,null)),e.createElement("input",{type:"range",className:"volume-slider",min:"0",max:"100",value:m?0:E,onChange:t=>j(parseInt(t.target.value))}),e.createElement("span",{className:"volume-display"},m?0:E,"%")))),S&&e.createElement("div",{className:"queue-panel"},e.createElement("div",{className:"queue-header"},e.createElement("h3",null,"Sıra (",c.length,")"),e.createElement("button",{className:"close-btn",onClick:()=>b(!1)},e.createElement(q,null))),e.createElement("div",{className:"queue-list"},c.length===0?e.createElement("div",{className:"queue-empty"},"Sıra boş"):c.map((t,a)=>e.createElement("div",{key:t.id,className:"queue-item"},e.createElement("span",{className:"queue-index"},a+1),e.createElement("img",{src:t.thumbnail,alt:t.title,className:"queue-thumbnail"}),e.createElement("div",{className:"queue-track-info"},e.createElement("div",{className:"queue-track-title"},t.title),e.createElement("div",{className:"queue-track-artist"},t.artist||"Bilinmeyen")),e.createElement("button",{className:"remove-btn",onClick:()=>U(t.id),title:"Sıradan Çıkar"},e.createElement(q,null)))))),$&&e.createElement("div",{className:"add-track-modal"},e.createElement("div",{className:"add-track-content"},e.createElement("h3",null,"Şarkı Ekle"),e.createElement("input",{type:"text",className:"track-url-input",placeholder:"YouTube veya Spotify URL'si girin...",value:k,onChange:t=>C(t.target.value),onKeyPress:t=>t.key==="Enter"&&w()}),e.createElement("div",{className:"modal-actions"},e.createElement("button",{className:"btn-cancel",onClick:()=>p(!1)},"İptal"),e.createElement("button",{className:"btn-add",onClick:w},"Ekle")))))};export{ae as default};
