import{r as o}from"./react-core-B6hadH-M.js";import{t as r}from"./index-D_6pZib5.js";const $=({roomId:s,apiBaseUrl:n,onClose:d,currentUser:y})=>{const[g,k]=o.useState([]),[_,C]=o.useState(null),[R,E]=o.useState(!0),[p,i]=o.useState("list"),[c,l]=o.useState({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0});o.useEffect(()=>{u();const e=setInterval(u,5e3);return()=>clearInterval(e)},[s]);const u=async()=>{try{const e=localStorage.getItem("access_token"),t=s?`${n}/stages/active/`:`${n}/stages/active/`,a=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const m=await a.json();k(Array.isArray(m)?m:m.stages||[])}}catch(e){console.error("Stages fetch error:",e)}finally{E(!1)}},h=async()=>{if(!c.topic.trim()){r.error("âš ï¸ Konu baÅŸlÄ±ÄŸÄ± gerekli");return}if(!s){r.error("âš ï¸ LÃ¼tfen bir ses kanalÄ±nda olun");return}try{const e=localStorage.getItem("access_token"),t=await fetch(`${n}/stages/create/${s}/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(t.ok){const a=await t.json();k([...g,a.stage]),l({topic:"",description:"",max_speakers:10,max_audience:1e3,is_public:!0}),i("list"),r.success("âœ… Stage oluÅŸturuldu!")}else{const a=await t.json();r.error(a.error||"âŒ Stage oluÅŸturulamadÄ±")}}catch(e){console.error("Stage creation error:",e),r.error("âŒ Hata oluÅŸtu")}},v=async e=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${n}/stages/${e}/join/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(a.ok)r.success("ðŸŽ™ï¸ Stage'e katÄ±ldÄ±n!"),u();else{const m=await a.json();r.error(m.error||"âŒ Stage'e katÄ±lamadÄ±n")}}catch(t){console.error("Join stage error:",t),r.error("âŒ Hata oluÅŸtu")}},N=async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${n}/stages/${e}/leave/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&(r.success("ðŸ‘‹ Stage'den ayrÄ±ldÄ±n"),u())}catch(t){console.error("Leave stage error:",t)}},S=async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${n}/stages/${e}/request-speak/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&r.success("âœ‹ KonuÅŸma talebi gÃ¶nderildi")}catch(t){console.error("Request speak error:",t)}},b=e=>({host:"ðŸ‘‘",moderator:"ðŸ›¡ï¸",speaker:"ðŸŽ™ï¸",listener:"ðŸ‘‚"})[e]||"ðŸ‘¤",f=e=>({host:"#faa61a",moderator:"#8b5cf6",speaker:"#34c759",listener:"#6c6d7d"})[e]||"#6c6d7d";return R?React.createElement("div",{className:"stage-overlay",onClick:d},React.createElement("div",{className:"stage-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"stage-loading"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"YÃ¼kleniyor...")))):React.createElement("div",{className:"stage-overlay",onClick:d},React.createElement("div",{className:"stage-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"stage-header"},React.createElement("h2",null,"ðŸŽ™ï¸ Stage KanallarÄ±"),React.createElement("div",{className:"header-actions"},s&&React.createElement(React.Fragment,null,React.createElement("button",{className:`view-toggle ${p==="list"?"active":""}`,onClick:()=>i("list")},"ðŸ“‹ Aktif Stage'ler"),React.createElement("button",{className:`view-toggle ${p==="create"?"active":""}`,onClick:()=>i("create")},"âž• OluÅŸtur")),React.createElement("button",{className:"close-btn",onClick:d},"âœ•"))),React.createElement("div",{className:"stage-content"},p==="list"?React.createElement("div",{className:"stages-list"},g.length>0?g.map(e=>React.createElement("div",{key:e.id,className:"stage-card"},React.createElement("div",{className:"stage-info"},React.createElement("div",{className:"stage-icon"},"ðŸŽ™ï¸"),React.createElement("div",{className:"stage-details"},React.createElement("h3",null,e.topic),e.description&&React.createElement("p",{className:"stage-description"},e.description),React.createElement("div",{className:"stage-meta"},React.createElement("span",null,"ðŸ‘‘ Host: ",e.host_username),React.createElement("span",null,"ðŸŽ™ï¸ ",e.speakers_count||0," konuÅŸmacÄ±"),React.createElement("span",null,"ðŸ‘‚ ",e.audience_count||0," dinleyici")))),e.speakers&&e.speakers.length>0&&React.createElement("div",{className:"speakers-list"},React.createElement("h4",null,"KonuÅŸmacÄ±lar"),React.createElement("div",{className:"speakers-grid"},e.speakers.slice(0,6).map((t,a)=>React.createElement("div",{key:a,className:"speaker-badge"},React.createElement("span",{className:"role-icon",style:{color:f(t.role)}},b(t.role)),React.createElement("span",{className:"speaker-name"},t.username))),e.speakers.length>6&&React.createElement("div",{className:"speaker-badge more"},"+",e.speakers.length-6))),React.createElement("div",{className:"stage-actions"},e.is_member?React.createElement(React.Fragment,null,React.createElement("button",{className:"leave-stage-btn",onClick:()=>N(e.id)},"ðŸ‘‹ AyrÄ±l"),e.user_role==="listener"&&React.createElement("button",{className:"request-speak-btn",onClick:()=>S(e.id)},"âœ‹ KonuÅŸmak Ä°stiyorum")):React.createElement("button",{className:"join-stage-btn",onClick:()=>v(e.id)},"ðŸŽ§ Dinle")))):React.createElement("div",{className:"no-stages"},React.createElement("p",null,"ðŸŽ™ï¸ Aktif stage yok"),s&&React.createElement("button",{onClick:()=>i("create")},"Ä°lk stage'i oluÅŸtur"))):React.createElement("div",{className:"create-stage-form"},React.createElement("h3",null,"ðŸŽ™ï¸ Yeni Stage OluÅŸtur"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Konu BaÅŸlÄ±ÄŸÄ± *"),React.createElement("input",{type:"text",placeholder:"KonuÅŸma konusu...",value:c.topic,onChange:e=>l({...c,topic:e.target.value}),maxLength:100})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"AÃ§Ä±klama"),React.createElement("textarea",{placeholder:"Stage hakkÄ±nda detaylar...",value:c.description,onChange:e=>l({...c,description:e.target.value}),rows:4})),React.createElement("div",{className:"form-row"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Maks. KonuÅŸmacÄ± (1-10)"),React.createElement("input",{type:"number",value:c.max_speakers,onChange:e=>l({...c,max_speakers:Math.min(10,Math.max(1,parseInt(e.target.value)||1))}),min:"1",max:"10"})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Maks. Dinleyici"),React.createElement("input",{type:"number",value:c.max_audience,onChange:e=>l({...c,max_audience:Math.min(1e3,Math.max(1,parseInt(e.target.value)||100))}),min:"1",max:"1000"}))),React.createElement("div",{className:"form-group checkbox-group"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:c.is_public,onChange:e=>l({...c,is_public:e.target.checked})}),React.createElement("span",null,"ðŸŒ Herkese AÃ§Ä±k"))),React.createElement("div",{className:"form-actions"},React.createElement("button",{className:"submit-btn",onClick:h},"âœ¨ Stage OluÅŸtur"),React.createElement("button",{className:"cancel-btn",onClick:()=>i("list")},"Ä°ptal"))))))};export{$ as default};
