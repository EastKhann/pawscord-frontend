import{r as u,n as e}from"./react-core-zXIKm1Jm.js";import{cs as v,a as B,j as _,ac as f,g,f as L,cd as I,bY as Y,ct as D,bW as G,bV as H,bT as K,bQ as R,bU as J,bX as F,ar as N,c as U,aZ as A,cu as Q,aq as V,aQ as q,p as X}from"./icons-vendor-DZdpmN99.js";import{y as m}from"./ui-vendor-BGw4w3Ed.js";import"./editor-vendor-DiU449Dh.js";const re=({serverId:t,onClose:l})=>{const[c,d]=u.useState("connected"),[h,i]=u.useState([]),[s,o]=u.useState([]),[a,x]=u.useState(!0),[b,r]=u.useState(""),[w,C]=u.useState({show:!1,integration:null}),p=localStorage.getItem("access_token"),S={github:J,spotify:R,twitch:K,youtube:H,discord:G,slack:D,google:Y,twitter:I},$={github:"#333",spotify:"#1db954",twitch:"#9146ff",youtube:"#ff0000",discord:"#5865f2",slack:"#4a154b",google:"#4285f4",twitter:"#1da1f2"};u.useEffect(()=>{y()},[t]);const y=async()=>{x(!0);try{const[n,j]=await Promise.all([fetch(`/api/servers/${t}/integrations/`,{headers:{Authorization:`Bearer ${p}`}}),fetch("/api/integrations/available/",{headers:{Authorization:`Bearer ${p}`}})]);if(n.ok){const k=await n.json();i(k.integrations||[])}if(j.ok){const k=await j.json();o(k.integrations||[])}else o([])}catch(n){console.error("Error fetching integrations:",n),o([])}x(!1)},T=async n=>{try{const j=await fetch(`/api/servers/${t}/integrations/connect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({integration_type:n})});if(j.ok){const k=await j.json();k.oauth_url&&window.open(k.oauth_url,"_blank","width=500,height=600"),m.success(`${n} entegrasyon başlatıldı`),y()}else m.error("Bağlantı başlatılamadı")}catch{m.error("Bağlantı hatası")}},E=async n=>{if(window.confirm("Bu entegrasyonu kaldırmak istediğinize emin misiniz?"))try{(await fetch(`/api/servers/${t}/integrations/${n}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}})).ok&&(m.success("Entegrasyon kaldırıldı"),y())}catch{m.error("Entegrasyon kaldırılamadı")}},W=async n=>{try{(await fetch(`/api/servers/${t}/integrations/${n}/sync/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}})).ok&&m.success("Senkronizasyon başlatıldı")}catch{m.error("Senkronizasyon başarısız")}},O=n=>{switch(n){case"development":return e.jsx(X,{});case"entertainment":return e.jsx(q,{});case"streaming":return e.jsx(V,{});case"productivity":return e.jsx(Q,{});default:return e.jsx(v,{})}},M=s.filter(n=>n.name.toLowerCase().includes(b.toLowerCase())||n.description.toLowerCase().includes(b.toLowerCase())),P=h.map(n=>n.type),z=M.filter(n=>!P.includes(n.id));return e.jsx("div",{className:"integration-hub-overlay",onClick:n=>n.target.className==="integration-hub-overlay"&&l(),children:e.jsxs("div",{className:"integration-hub-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(v,{})," Entegrasyon Merkezi"]}),e.jsx("button",{className:"close-btn",onClick:l,children:e.jsx(B,{})})]}),e.jsx("div",{className:"tabs-bar",children:e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${c==="connected"?"active":""}`,onClick:()=>d("connected"),children:[e.jsx(_,{})," Bağlı (",h.length,")"]}),e.jsxs("button",{className:`tab ${c==="available"?"active":""}`,onClick:()=>d("available"),children:[e.jsx(f,{})," Mevcut (",z.length,")"]}),e.jsxs("button",{className:`tab ${c==="webhooks"?"active":""}`,onClick:()=>d("webhooks"),children:[e.jsx(g,{})," Webhooks"]})]})}),c==="available"&&e.jsxs("div",{className:"search-bar",children:[e.jsx(L,{}),e.jsx("input",{type:"text",placeholder:"Entegrasyon ara...",value:b,onChange:n=>r(n.target.value)})]}),e.jsx("div",{className:"panel-content",children:a?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):e.jsxs(e.Fragment,{children:[c==="connected"&&e.jsx(Z,{integrations:h,icons:S,colors:$,onDisconnect:E,onSync:W,onConfigure:n=>C({show:!0,integration:n})}),c==="available"&&e.jsx(ee,{integrations:z,icons:S,colors:$,getCategoryIcon:O,onConnect:T}),c==="webhooks"&&e.jsx(se,{serverId:t,token:p})]})}),w.show&&e.jsx(ne,{integration:w.integration,serverId:t,token:p,onClose:()=>C({show:!1,integration:null}),onSave:y})]})})},Z=({integrations:t,icons:l,colors:c,onDisconnect:d,onSync:h,onConfigure:i})=>t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(F,{}),e.jsx("p",{children:"Henüz bağlı entegrasyon yok"}),e.jsx("span",{className:"hint",children:'"Mevcut" sekmesinden entegrasyon ekleyin'})]}):e.jsx("div",{className:"connected-list",children:t.map(s=>{const o=l[s.type]||v,a=c[s.type]||"#666";return e.jsxs("div",{className:"integration-card connected",children:[e.jsx("div",{className:"integration-icon",style:{background:a},children:e.jsx(o,{})}),e.jsxs("div",{className:"integration-info",children:[e.jsx("h4",{children:s.name}),e.jsxs("div",{className:"connection-info",children:[e.jsxs("span",{className:"status connected",children:[e.jsx(N,{})," Bağlı"]}),s.account_name&&e.jsxs("span",{className:"account",children:["@",s.account_name]})]}),e.jsxs("div",{className:"last-sync",children:["Son senkronizasyon: ",s.last_sync||"Hiç"]})]}),e.jsxs("div",{className:"integration-actions",children:[e.jsx("button",{className:"action-btn sync",onClick:()=>h(s.id),title:"Senkronize Et",children:e.jsx(U,{})}),e.jsx("button",{className:"action-btn config",onClick:()=>i(s),title:"Ayarlar",children:e.jsx(A,{})}),e.jsx("button",{className:"action-btn disconnect",onClick:()=>d(s.id),title:"Bağlantıyı Kes",children:e.jsx(F,{})})]})]},s.id)})}),ee=({integrations:t,icons:l,colors:c,getCategoryIcon:d,onConnect:h})=>{const i=[...new Set(t.map(s=>s.category))];return t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(v,{}),e.jsx("p",{children:"Tüm entegrasyonlar zaten bağlı"})]}):e.jsx("div",{className:"available-list",children:i.map(s=>e.jsxs("div",{className:"category-section",children:[e.jsxs("h3",{className:"category-title",children:[d(s),s==="development"&&"Geliştirme",s==="entertainment"&&"Eğlence",s==="streaming"&&"Yayın",s==="productivity"&&"Üretkenlik",s==="content"&&"İçerik",s==="social"&&"Sosyal"]}),e.jsx("div",{className:"integrations-grid",children:t.filter(o=>o.category===s).map(o=>{const a=l[o.id]||v,x=c[o.id]||"#666";return e.jsxs("div",{className:"integration-card available",children:[e.jsx("div",{className:"integration-icon",style:{background:x},children:e.jsx(a,{})}),e.jsxs("div",{className:"integration-details",children:[e.jsx("h4",{children:o.name}),e.jsx("p",{children:o.description}),e.jsx("ul",{className:"features",children:o.features?.slice(0,3).map((b,r)=>e.jsxs("li",{children:[e.jsx(N,{})," ",b]},r))})]}),e.jsxs("button",{className:"connect-btn",onClick:()=>h(o.id),children:[e.jsx(_,{})," Bağla"]})]},o.id)})})]},s))})},se=({serverId:t,token:l})=>{const[c,d]=u.useState([]),[h,i]=u.useState(!1);u.useEffect(()=>{s()},[]);const s=async()=>{try{const a=await fetch(`/api/servers/${t}/webhooks/`,{headers:{Authorization:`Bearer ${l}`}});if(a.ok){const x=await a.json();d(x.webhooks||[])}}catch(a){console.error("Error fetching webhooks:",a)}},o=async a=>{if(window.confirm("Bu webhook'u silmek istediğinize emin misiniz?"))try{(await fetch(`/api/servers/${t}/webhooks/${a}/`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok&&(m.success("Webhook silindi"),s())}catch{m.error("Webhook silinemedi")}};return e.jsxs("div",{className:"webhooks-view",children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsx("p",{children:"Webhooks ile dış servislerden otomatik mesajlar alın"}),e.jsxs("button",{className:"create-webhook-btn",onClick:()=>i(!0),children:[e.jsx(f,{})," Yeni Webhook"]})]}),c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(g,{}),e.jsx("p",{children:"Henüz webhook oluşturulmamış"})]}):e.jsx("div",{className:"webhooks-list",children:c.map(a=>e.jsxs("div",{className:"webhook-item",children:[e.jsx("div",{className:"webhook-avatar",children:a.avatar?e.jsx("img",{src:a.avatar,alt:""}):e.jsx(g,{})}),e.jsxs("div",{className:"webhook-info",children:[e.jsx("h4",{children:a.name}),e.jsxs("span",{className:"webhook-channel",children:["#",a.channel_name]}),e.jsxs("div",{className:"webhook-url",children:[e.jsxs("code",{children:[a.url.substring(0,40),"..."]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a.url),m.success("URL kopyalandı")},children:"Kopyala"})]})]}),e.jsx("div",{className:"webhook-actions",children:e.jsx("button",{className:"action-btn delete",onClick:()=>o(a.id),children:e.jsx(B,{})})})]},a.id))}),h&&e.jsx(ae,{serverId:t,token:l,onClose:()=>i(!1),onCreated:()=>{s(),i(!1)}})]})},ae=({serverId:t,token:l,onClose:c,onCreated:d})=>{const[h,i]=u.useState(""),[s,o]=u.useState(""),[a,x]=u.useState([]);u.useEffect(()=>{fetch(`/api/servers/${t}/channels/`,{headers:{Authorization:`Bearer ${l}`}}).then(r=>r.json()).then(r=>x(r.channels||[])).catch(()=>{})},[]);const b=async()=>{if(!h||!s){m.warning("Tüm alanları doldurun");return}try{(await fetch(`/api/servers/${t}/webhooks/`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({name:h,channel_id:s})})).ok&&(m.success("Webhook oluşturuldu"),d())}catch{m.error("Webhook oluşturulamadı")}};return e.jsx("div",{className:"modal-overlay",onClick:r=>r.target.className==="modal-overlay"&&c(),children:e.jsxs("div",{className:"webhook-modal",children:[e.jsxs("h3",{children:[e.jsx(f,{})," Yeni Webhook Oluştur"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adı"}),e.jsx("input",{type:"text",value:h,onChange:r=>i(r.target.value),placeholder:"örn: GitHub Bot"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsxs("select",{value:s,onChange:r=>o(r.target.value),children:[e.jsx("option",{value:"",children:"Kanal seçin..."}),a.map(r=>e.jsxs("option",{value:r.id,children:["#",r.name]},r.id))]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:c,children:"İptal"}),e.jsx("button",{className:"create-btn",onClick:b,children:"Oluştur"})]})]})})},ne=({integration:t,serverId:l,token:c,onClose:d,onSave:h})=>{const[i,s]=u.useState({notifications_enabled:!0,notification_channel:"",auto_sync:!0,sync_interval:30}),o=async()=>{try{(await fetch(`/api/servers/${l}/integrations/${t.id}/configure/`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(i)})).ok&&(m.success("Ayarlar kaydedildi"),h(),d())}catch{m.error("Ayarlar kaydedilemedi")}};return e.jsx("div",{className:"modal-overlay",onClick:a=>a.target.className==="modal-overlay"&&d(),children:e.jsxs("div",{className:"config-modal",children:[e.jsxs("h3",{children:[e.jsx(A,{})," ",t.name," Ayarları"]}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i.notifications_enabled,onChange:a=>s({...i,notifications_enabled:a.target.checked})}),"Bildirimleri Etkinleştir"]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i.auto_sync,onChange:a=>s({...i,auto_sync:a.target.checked})}),"Otomatik Senkronizasyon"]})}),i.auto_sync&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Senkronizasyon Aralığı (dakika)"}),e.jsx("input",{type:"number",value:i.sync_interval,onChange:a=>s({...i,sync_interval:parseInt(a.target.value)}),min:5,max:1440})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:d,children:"İptal"}),e.jsxs("button",{className:"save-btn",onClick:o,children:[e.jsx(N,{})," Kaydet"]})]})]})})};export{re as default};
