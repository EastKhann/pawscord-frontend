import{r as s,a0 as C,l as x,dC as H,aD as b,Y as k,aH as l,U as G,bo as z,aT as A,cq as P,cl as j}from"./react-core-B6hadH-M.js";import{p as I}from"./purify.es-HRjpPm7y.js";const J=({channelId:g,onClose:r,fetchWithAuth:m,apiBaseUrl:o})=>{const[w,y]=s.useState(!1),[a,i]=s.useState([]),[t,p]=s.useState(null),[v,N]=s.useState(!1),[u,f]=s.useState("24h"),[R,_]=s.useState(100),[d,F]=s.useState(g),[h,S]=s.useState([]);s.useEffect(()=>{D()},[g]);const D=async()=>{y(!0);try{const e=await m(`${o}/rooms/list/`);if(e.ok){const c=await e.json();S(c.rooms||c||[])}const n=await m(`${o}/messages/summaries/`);if(n.ok){const c=await n.json();i(c.summaries||c||[])}}catch(e){console.error("Error loading data:",e),S([]),i([])}y(!1)},L=async()=>{N(!0);try{const e=await m(`${o}/messages/summarize/`,{method:"POST",body:JSON.stringify({channel_id:d,time_range:u,message_count:R})});if(e.ok){const n=await e.json(),c={id:n.id||Date.now(),channel:h.find(M=>M.id===d)?.name||"general",created_at:new Date().toISOString(),time_range:u,message_count:n.message_count||R,summary:n.summary||"Özet oluşturulamadı.",keywords:n.keywords||[],participants:n.participants||0};p(c),i([c,...a])}else console.error("Summary generation failed")}catch(e){console.error("Error generating summary:",e)}N(!1)},E=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=e=>{navigator.clipboard.writeText(e)},T=e=>{`${e.channel}${E(e.created_at)}${e.message_count}${e.time_range}${e.summary}`};return w?React.createElement("div",{className:"summary-overlay",onClick:r},React.createElement("div",{className:"summary-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"loading"},"Loading message summary..."))):React.createElement("div",{className:"summary-overlay",onClick:r},React.createElement("div",{className:"summary-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"panel-header"},React.createElement("div",{className:"header-info"},React.createElement("h2",null,React.createElement(C,null),"AI Message Summary"),React.createElement("span",{className:"subtitle"},"Summarize channel conversations with AI")),React.createElement("button",{className:"close-btn",onClick:r},React.createElement(x,null))),React.createElement("div",{className:"summary-content"},React.createElement("div",{className:"generator-section"},React.createElement("h3",null,React.createElement(H,null)," Generate Summary"),React.createElement("div",{className:"generator-controls"},React.createElement("div",{className:"control-group"},React.createElement("label",null,React.createElement(b,null)," Channel"),React.createElement("select",{value:d,onChange:e=>F(Number(e.target.value))},h.map(e=>React.createElement("option",{key:e.id,value:e.id},"#",e.name)))),React.createElement("div",{className:"control-group"},React.createElement("label",null,React.createElement(k,null)," Time Range"),React.createElement("select",{value:u,onChange:e=>f(e.target.value)},React.createElement("option",{value:"1h"},"Last Hour"),React.createElement("option",{value:"6h"},"Last 6 Hours"),React.createElement("option",{value:"24h"},"Last 24 Hours"),React.createElement("option",{value:"7d"},"Last 7 Days"),React.createElement("option",{value:"30d"},"Last 30 Days"))),React.createElement("div",{className:"control-group"},React.createElement("label",null,React.createElement(l,null)," Max Messages"),React.createElement("select",{value:R,onChange:e=>_(Number(e.target.value))},React.createElement("option",{value:50},"50 messages"),React.createElement("option",{value:100},"100 messages"),React.createElement("option",{value:250},"250 messages"),React.createElement("option",{value:500},"500 messages"))),React.createElement("button",{className:"generate-btn",onClick:L,disabled:v},v?React.createElement(React.Fragment,null,React.createElement(G,{className:"spinning"}),"Generating..."):React.createElement(React.Fragment,null,React.createElement(C,null),"Generate Summary")))),(t||a.length>0)&&React.createElement("div",{className:"summary-display"},React.createElement("div",{className:"summary-header"},React.createElement("h3",null,React.createElement(l,null),t?"Generated Summary":"Latest Summary"),React.createElement("div",{className:"summary-actions"},React.createElement("button",{className:"action-btn",onClick:()=>$((t||a[0]).summary)},React.createElement(z,null)," Copy"),React.createElement("button",{className:"action-btn",onClick:()=>T(t||a[0])},React.createElement(A,null)," Export"))),React.createElement("div",{className:"summary-meta"},React.createElement("span",{className:"meta-item"},React.createElement(b,null)," #",(t||a[0]).channel),React.createElement("span",{className:"meta-item"},React.createElement(k,null)," ",(t||a[0]).time_range),React.createElement("span",{className:"meta-item"},React.createElement(l,null)," ",(t||a[0]).message_count," messages"),React.createElement("span",{className:"meta-item"},React.createElement(P,null)," ",E((t||a[0]).created_at))),React.createElement("div",{className:"summary-body"},React.createElement("div",{className:"summary-text",dangerouslySetInnerHTML:{__html:I.sanitize((t||a[0]).summary.replace(/## /g,"<h4>").replace(/\n\n/g,`</h4>
`).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/- /g,"• ").replace(/\n/g,"<br/>"))}})),React.createElement("div",{className:"summary-keywords"},React.createElement("span",{className:"keywords-label"},"Keywords:"),(t||a[0]).keywords.map((e,n)=>React.createElement("span",{key:n,className:"keyword-chip"},e)))),React.createElement("div",{className:"history-section"},React.createElement("h3",null,React.createElement(j,null)," Summary History"),React.createElement("div",{className:"history-list"},a.map(e=>React.createElement("div",{key:e.id,className:`history-item ${t?.id===e.id?"active":""}`,onClick:()=>p(e)},React.createElement("div",{className:"history-icon"},React.createElement(l,null)),React.createElement("div",{className:"history-info"},React.createElement("span",{className:"history-channel"},"#",e.channel),React.createElement("span",{className:"history-meta"},e.message_count," messages • ",e.time_range)),React.createElement("div",{className:"history-date"},E(e.created_at)))))))))};export{J as default};
