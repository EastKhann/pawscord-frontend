import{r as n,d as e,p as h,bM as G,i as P,du as K,ap as Q,ak as V,w as X,aR as Z}from"./react-core-DrOm_csO.js";import{g as r}from"./index-DmEhdEtw.js";const ae=({userId:s,onClose:O})=>{const[i,d]=n.useState([]),[u,E]=n.useState(0),[m,f]=n.useState("all"),[I,x]=n.useState(null),[N,p]=n.useState(!1),[D,R]=n.useState(!0),[v,b]=n.useState(!0),[y,k]=n.useState(!0),[S,w]=n.useState(!1),[$,C]=n.useState(!1),[_,F]=n.useState(!0);n.useEffect(()=>{B(),L()},[s,m]);const c=async(t,a={})=>{const T=localStorage.getItem("access_token"),o=await fetch(t,{...a,headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json",...a.headers}});if(!o.ok)throw new Error(`HTTP ${o.status}`);return await o.json()},B=async()=>{try{const t=await c(`${r()}/notifications/${s}/list/?filter=${m}`);d(t.notifications||[]),E(t.unread_count||0)}catch(t){console.error("Notifications fetch error:",t)}finally{R(!1)}},L=async()=>{try{const t=await c(`${r()}/notifications/${s}/settings/`);x(t),b(t.push_enabled),k(t.email_enabled),w(t.mentions_only),C(t.dnd_enabled),F(t.sound_enabled)}catch(t){console.error("Settings fetch error:",t)}},U=async t=>{try{await c(`${r()}/notifications/${s}/${t}/read/`,{method:"POST"}),d(i.map(a=>a.id===t?{...a,read:!0}:a)),E(Math.max(0,u-1))}catch(a){console.error("Mark as read error:",a)}},j=async()=>{try{await c(`${r()}/notifications/${s}/read-all/`,{method:"POST"}),d(i.map(t=>({...t,read:!0}))),E(0),l("All notifications marked as read!")}catch(t){console.error("Mark all as read error:",t),l("Failed to mark as read","error")}},z=async t=>{try{await c(`${r()}/notifications/${s}/${t}/delete/`,{method:"DELETE"}),d(i.filter(a=>a.id!==t)),l("Notification deleted!")}catch(a){console.error("Delete notification error:",a),l("Failed to delete notification","error")}},J=async()=>{if(window.confirm("Are you sure you want to clear all notifications?"))try{await c(`${r()}/notifications/${s}/clear/`,{method:"POST"}),d([]),E(0),l("All notifications cleared!")}catch(t){console.error("Clear all error:",t),l("Failed to clear notifications","error")}},H=async()=>{try{await c(`${r()}/notifications/${s}/settings/update/`,{method:"PUT",body:JSON.stringify({push_enabled:v,email_enabled:y,mentions_only:S,dnd_enabled:$,sound_enabled:_})}),l("Settings updated!"),p(!1)}catch(t){console.error("Settings update error:",t),l("Failed to update settings","error")}},W=async()=>{try{await c(`${r()}/notifications/${s}/test/`,{method:"POST"}),l("Test notification sent!")}catch(t){console.error("Test notification error:",t),l("Failed to send test notification","error")}},Y=t=>{switch(t){case"mention":return"ðŸ’¬";case"reply":return"â†©ï¸";case"like":return"â¤ï¸";case"follow":return"ðŸ‘¤";case"server_invite":return"ðŸ“§";case"role_update":return"ðŸ·ï¸";case"announcement":return"ðŸ“¢";default:return"ðŸ””"}},q=t=>{const a=new Date(t),o=new Date-a,g=Math.floor(o/6e4),A=Math.floor(o/36e5),M=Math.floor(o/864e5);return g<1?"Just now":g<60?`${g}m ago`:A<24?`${A}h ago`:M<7?`${M}d ago`:a.toLocaleDateString()},l=(t,a="success")=>{console.log(`[${a}] ${t}`)};return D?e.createElement("div",{className:"notifications-overlay"},e.createElement("div",{className:"notifications-panel loading"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"Loading Notifications..."))):e.createElement("div",{className:"notifications-overlay"},e.createElement("div",{className:"notifications-panel"},e.createElement("div",{className:"panel-header"},e.createElement("div",null,e.createElement("h2",null,e.createElement(h,null)," Notifications"),u>0&&e.createElement("span",{className:"unread-badge"},u," new")),e.createElement("div",{className:"header-actions"},e.createElement("button",{onClick:()=>p(!N),className:"btn-settings"},e.createElement(G,null)),e.createElement("button",{onClick:O,className:"btn-close"},e.createElement(P,null)))),e.createElement("div",{className:"filter-bar"},e.createElement("button",{className:m==="all"?"active":"",onClick:()=>f("all")},"All"),e.createElement("button",{className:m==="unread"?"active":"",onClick:()=>f("unread")},"Unread"),e.createElement("button",{className:m==="mentions"?"active":"",onClick:()=>f("mentions")},"Mentions"),e.createElement("button",{className:m==="servers"?"active":"",onClick:()=>f("servers")},"Servers")),N&&e.createElement("div",{className:"settings-panel"},e.createElement("h3",null,"Notification Settings"),e.createElement("div",{className:"setting-item"},e.createElement("div",{className:"setting-info"},e.createElement(K,null),e.createElement("div",null,e.createElement("h4",null,"Push Notifications"),e.createElement("p",null,"Receive notifications on your device"))),e.createElement("label",{className:"toggle"},e.createElement("input",{type:"checkbox",checked:v,onChange:t=>b(t.target.checked)}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"setting-item"},e.createElement("div",{className:"setting-info"},e.createElement(Q,null),e.createElement("div",null,e.createElement("h4",null,"Email Notifications"),e.createElement("p",null,"Receive notifications via email"))),e.createElement("label",{className:"toggle"},e.createElement("input",{type:"checkbox",checked:y,onChange:t=>k(t.target.checked)}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"setting-item"},e.createElement("div",{className:"setting-info"},e.createElement(h,null),e.createElement("div",null,e.createElement("h4",null,"Sound Effects"),e.createElement("p",null,"Play sound when you receive notifications"))),e.createElement("label",{className:"toggle"},e.createElement("input",{type:"checkbox",checked:_,onChange:t=>F(t.target.checked)}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"setting-item"},e.createElement("div",{className:"setting-info"},e.createElement(V,null),e.createElement("div",null,e.createElement("h4",null,"Mentions Only"),e.createElement("p",null,"Only notify when you're mentioned"))),e.createElement("label",{className:"toggle"},e.createElement("input",{type:"checkbox",checked:S,onChange:t=>w(t.target.checked)}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"setting-item"},e.createElement("div",{className:"setting-info"},e.createElement(X,null),e.createElement("div",null,e.createElement("h4",null,"Do Not Disturb"),e.createElement("p",null,"Mute all notifications temporarily"))),e.createElement("label",{className:"toggle"},e.createElement("input",{type:"checkbox",checked:$,onChange:t=>C(t.target.checked)}),e.createElement("span",{className:"toggle-slider"}))),e.createElement("div",{className:"settings-actions"},e.createElement("button",{onClick:W,className:"btn-test"},"Test Notification"),e.createElement("button",{onClick:H,className:"btn-save"},"Save Settings"))),e.createElement("div",{className:"panel-actions"},u>0&&e.createElement("button",{onClick:j,className:"btn-mark-read"},e.createElement(Z,null)," Mark All as Read"),i.length>0&&e.createElement("button",{onClick:J,className:"btn-clear"},"Clear All")),e.createElement("div",{className:"notifications-content"},i.length===0?e.createElement("div",{className:"empty-state"},e.createElement(h,{size:64}),e.createElement("h3",null,"No Notifications"),e.createElement("p",null,"You're all caught up!")):e.createElement("div",{className:"notifications-list"},i.map(t=>e.createElement("div",{key:t.id,className:`notification-item ${t.read?"":"unread"}`,onClick:()=>!t.read&&U(t.id)},e.createElement("div",{className:"notification-icon"},Y(t.type)),e.createElement("div",{className:"notification-body"},e.createElement("div",{className:"notification-header"},e.createElement("h4",null,t.title),e.createElement("span",{className:"notification-time"},q(t.created_at))),e.createElement("p",{className:"notification-message"},t.message),t.server_name&&e.createElement("span",{className:"notification-server"},"in ",t.server_name)),e.createElement("button",{onClick:a=>{a.stopPropagation(),z(t.id)},className:"btn-delete-notification"},e.createElement(P,null)),!t.read&&e.createElement("div",{className:"unread-dot"})))))))};export{ae as default};
