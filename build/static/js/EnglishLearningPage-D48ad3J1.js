import{r as n,j as e}from"./react-vendor-D8Fi5F9E.js";import{b as F,L as I}from"./router-vendor-CTPwQFnc.js";import"./grammarQuestions-DGt-yM1z.js";import{A as w,u as N}from"./index-Dg-dU9FV.js";import"./media-vendor-Dp18sh1g.js";import"./crypto-vendor-Cz32ecGD.js";import"./icons-vendor-BPCemF_6.js";import"./state-vendor-De5qIGw3.js";const A=`${w}/auth/token/refresh/`,G=`${w}/eng-learn/words/`,M=`${w}/eng-learn/known-words/`,$=`${w}/eng-learn/mark-known/`;IS_PRODUCTION;IS_PRODUCTION||`${MY_LOCAL_IP}${DJANGO_PORT}`;const U=()=>localStorage.getItem("access_token");function ee(){const[d,E]=n.useState({}),[x,k]=n.useState({}),[v,L]=n.useState([]),[s,C]=n.useState(""),[c,B]=n.useState(null),[W,T]=n.useState(!1),[j,z]=n.useState(!0),[_,D]=n.useState(null),[y,R]=n.useState(!1),O=F();n.useRef(null);const b=n.useCallback(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),O("/")},[O]),m=n.useCallback(async(r,o={})=>{const a=async()=>{const u=U(),l=o.headers||{};return u&&(l.Authorization=`Bearer ${u}`),o.body instanceof FormData||(l["Content-Type"]="application/json"),fetch(r,{...o,headers:l})};let i=await a();if(i.status===401&&r!==A){console.warn("Token sÃ¼resi doldu, yenileniyor...");const u=localStorage.getItem("refresh_token");if(!u)throw b(),new Error("Oturum sÃ¼resi doldu, giriÅŸ yapÄ±n.");try{const l=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:u})}),K=await l.json();if(!l.ok)throw b(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",K.access),i=await a()}catch(l){throw b(),l}}return i},[b]);n.useEffect(()=>{(async()=>{try{const[o,a]=await Promise.all([m(G),m(M)]);if(!o.ok)throw o.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!a.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const i=await o.json(),u=await a.json(),l=Object.keys(i||{}).sort();E(i),k(u||{}),L(l),l.length>0&&C(l[0])}catch(o){D(o.message)}finally{z(!1)}})()},[m]);const h=n.useMemo(()=>{if(!s||!d[s])return[];const r=new Set(x[s]||[]);return d[s].filter(o=>!r.has(o.term))},[d,s,x]),p=n.useMemo(()=>{const r=d[s]?.length||0,o=x[s]?.length||0,a=r>0?o/r*100:0;return{totalWords:r,knownWords:o,progress:Math.round(a)}},[s,d,x]),g=n.useMemo(()=>{let r=0,o=0;Object.values(d).forEach(i=>{r+=i.length}),Object.values(x).forEach(i=>{o+=i.length});const a=r>0?o/r*100:0;return{totalWords:r,totalKnownWords:o,progress:Math.round(a)}},[d,x]),S=n.useCallback(()=>{if(T(!1),R(!1),h.length===0){B(null),s&&R(!0);return}const r=Math.floor(Math.random()*h.length);B(h[r])},[h,s]);n.useEffect(()=>{!j&&v.length>0&&S()},[s,j,v,h,S]);const P=n.useCallback(async()=>{if(!c)return;const{term:r}=c,o=s;try{const a=await m($,{method:"POST",body:JSON.stringify({level:o,word:r})});if(!a.ok)throw new Error("Kelime kaydedilemedi");const i=await a.json();k(i)}catch(a){console.error("Kelime kaydetme API hatasÄ±:",a)}},[c,s,m]),{globalData:f}=N();return n.useEffect(()=>{f?.type==="user_profile_update"&&(console.log("EnglishLearnPage: Global soketten gÃ¼ncelleme alÄ±ndÄ±."),f.user_data&&f.user_data.known_words&&k(f.user_data.known_words))},[f]),j?e.jsx("div",{style:t.pageContainer,children:"YÃ¼kleniyor..."}):_?e.jsxs("div",{style:t.pageContainer,children:[e.jsxs("h1",{style:t.errorText,children:["Hata: ",_]}),e.jsx(I,{to:"/",style:t.backButton,children:"Sohbete Geri DÃ¶n"})]}):e.jsxs("div",{style:t.pageContainer,children:[e.jsx(I,{to:"/eng-learn",style:t.backButton,children:"â† Merkeze DÃ¶n"}),e.jsxs("div",{style:t.quizContainer,children:[e.jsx("h1",{style:t.pageTitle,children:"Ä°ngilizce Kelime Ã–ÄŸren"}),e.jsxs("div",{style:t.levelAndProgressContainer,children:[e.jsxs("div",{style:t.controls,children:[e.jsx("label",{htmlFor:"level-select",style:t.label,children:"Seviye:"}),e.jsx("select",{id:"level-select",value:s,onChange:r=>C(r.target.value),style:t.select,children:v.map(r=>e.jsxs("option",{value:r,children:[r.toUpperCase()," (",d[r]?.length||0," kelime)"]},r))})]}),e.jsxs("div",{style:t.progressStats,children:[e.jsxs("span",{children:["BildiÄŸiniz: ",e.jsx("strong",{children:p.knownWords})]}),e.jsxs("span",{children:["Toplam: ",e.jsx("strong",{children:p.totalWords})]})]})]}),e.jsxs("div",{style:{...t.progressBarBackground,marginBottom:"20px"},children:[e.jsx("div",{style:{...t.progressBarFill,width:`${p.progress}%`},children:p.progress>15&&e.jsxs("span",{children:[p.progress,"%"]})}),p.progress<=15&&e.jsxs("span",{style:t.progressTextOutside,children:[p.progress,"%"]})]}),e.jsxs("div",{children:[e.jsx("h4",{style:t.totalStatsHeader,children:"Genel Toplam Ä°lerleme"}),e.jsxs("div",{style:{...t.progressStats,marginBottom:"8px"},children:[e.jsxs("span",{children:["Toplam BildiÄŸiniz: ",e.jsx("strong",{children:g.totalKnownWords})]}),e.jsxs("span",{children:["Toplam Kelime: ",e.jsx("strong",{children:g.totalWords})]})]}),e.jsxs("div",{style:t.progressBarBackground,children:[e.jsx("div",{style:{...t.progressBarFill,...t.totalProgressBarFill,width:`${g.progress}%`},children:g.progress>15&&e.jsxs("span",{children:[g.progress,"%"]})}),g.progress<=15&&e.jsxs("span",{style:t.progressTextOutside,children:[g.progress,"%"]})]})]}),e.jsx("div",{style:t.wordArea,children:y?e.jsxs("h2",{style:{...t.term,color:"var(--text-positive)"},children:["Tebrikler! ðŸŽ‰",e.jsx("br",{}),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."]}):c?e.jsxs(e.Fragment,{children:[e.jsx("h2",{style:t.term,children:c.term}),W&&e.jsx("p",{style:t.meanings,children:c.meanings.join(" / ")})]}):e.jsx("p",{children:"Bu seviyede kelime bulunamadÄ±."})}),e.jsxs("div",{style:t.buttonGroup,children:[e.jsx("button",{style:t.actionButton,onClick:()=>T(!0),disabled:W||!c||y,children:"CevabÄ± GÃ¶ster"}),e.jsx("button",{style:{...t.actionButton,...t.knownButton},onClick:P,disabled:!c||y,children:"Biliyorum (GeÃ§)"}),e.jsx("button",{style:{...t.actionButton,...t.primaryButton},onClick:S,disabled:y||h.length<=1,children:"Yeni Kelime"})]})]})]})}const t={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};export{ee as default};
