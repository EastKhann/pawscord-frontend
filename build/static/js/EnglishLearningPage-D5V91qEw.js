import{r as o,j as t}from"./react-core-D6cE4lil.js";import{b as P,L as T}from"./router-vendor-wrB4dqw3.js";import{A as v,u as M}from"./index-DHLSv4f5.js";import"./media-vendor-Du00QUHb.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./icons-vendor-fClA8qVL.js";import"./ui-vendor-CZOhtEfS.js";const L=`${v}/auth/token/refresh/`,N=`${v}/eng-learn/words/`,G=`${v}/eng-learn/known-words/`,$=`${v}/eng-learn/mark-known/`,U=()=>localStorage.getItem("access_token");function H(){const[e,d]=o.useState({}),[p,y]=o.useState({}),[b,_]=o.useState([]),[a,S]=o.useState(""),[x,j]=o.useState(null),[A,C]=o.useState(!1),[w,E]=o.useState(!0),[R,z]=o.useState(null),[O,W]=o.useState(!1),B=P(),m=o.useCallback(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),B("/")},[B]),h=o.useCallback(async(s,n={})=>{const i=async()=>{const c=U(),l=n.headers||{};return c&&(l.Authorization=`Bearer ${c}`),n.body instanceof FormData||(l["Content-Type"]="application/json"),fetch(s,{...n,headers:l})};let u=await i();if(u.status===401&&s!==L){const c=localStorage.getItem("refresh_token");if(!c)throw m(),new Error("Oturum sÃ¼resi doldu, giriÅŸ yapÄ±n.");try{const l=await fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:c})}),F=await l.json();if(!l.ok)throw m(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",F.access),u=await i()}catch(l){throw m(),l}}return u},[m]);o.useEffect(()=>{(async()=>{try{const[n,i]=await Promise.all([h(N),h(G)]);if(!n.ok)throw n.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!i.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const u=await n.json(),c=await i.json(),l=Object.keys(u||{}).sort();d(u),y(c||{}),_(l),l.length>0&&S(l[0])}catch(n){z(n.message)}finally{E(!1)}})()},[h]);const g=o.useMemo(()=>{if(!a||!e[a])return[];const s=new Set(p[a]||[]);return e[a].filter(n=>!s.has(n.term))},[e,a,p]),D=o.useMemo(()=>{const s=e[a]?.length||0,n=p[a]?.length||0;return{totalWords:s,knownWords:n,progress:Math.round(s>0?n/s*100:0)}},[a,e,p]),I=o.useMemo(()=>{let s=0,n=0;return Object.values(e).forEach(i=>{s+=i.length}),Object.values(p).forEach(i=>{n+=i.length}),{totalWords:s,totalKnownWords:n,progress:Math.round(s>0?n/s*100:0)}},[e,p]),k=o.useCallback(()=>{if(C(!1),W(!1),g.length===0){j(null),a&&W(!0);return}j(g[Math.floor(Math.random()*g.length)])},[g,a]);o.useEffect(()=>{!w&&b.length>0&&k()},[a,w,b,g,k]);const K=o.useCallback(async()=>{if(x)try{const s=await h($,{method:"POST",body:JSON.stringify({level:a,word:x.term})});if(!s.ok)throw new Error("Kelime kaydedilemedi");y(await s.json())}catch{}},[x,a,h]),{globalData:f}=M();return o.useEffect(()=>{f?.type==="user_profile_update"&&f.user_data?.known_words&&y(f.user_data.known_words)},[f]),{allData:e,availableLevels:b,currentLevel:a,setCurrentLevel:S,currentWord:x,showAnswer:A,setShowAnswer:C,isLoading:w,error:R,levelComplete:O,levelStats:D,totalStats:I,availableWordsForLevel:g,getNewWord:k,handleMarkAsKnown:K}}const r={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};function te(){const e=H();return e.isLoading?t.jsx("div",{style:r.pageContainer,children:"YÃ¼kleniyor..."}):e.error?t.jsxs("div",{style:r.pageContainer,children:[t.jsxs("h1",{style:r.errorText,children:["Hata: ",e.error]}),t.jsx(T,{to:"/",style:r.backButton,children:"Sohbete Geri DÃ¶n"})]}):t.jsxs("div",{style:r.pageContainer,children:[t.jsxs(T,{to:"/eng-learn",style:r.backButton,children:["â†"," Merkeze DÃ¶n"]}),t.jsxs("div",{style:r.quizContainer,children:[t.jsxs("h1",{style:r.pageTitle,children:["Ä°","ngilizce Kelime ","Ã–ÄŸren"]}),t.jsxs("div",{style:r.levelAndProgressContainer,children:[t.jsxs("div",{style:r.controls,children:[t.jsx("label",{htmlFor:"level-select",style:r.label,children:"Seviye:"}),t.jsx("select",{id:"level-select",value:e.currentLevel,onChange:d=>e.setCurrentLevel(d.target.value),style:r.select,children:e.availableLevels.map(d=>t.jsxs("option",{value:d,children:[d.toUpperCase()," (",e.allData[d]?.length||0," kelime)"]},d))})]}),t.jsxs("div",{style:r.progressStats,children:[t.jsxs("span",{children:["BildiÄŸiniz: ",t.jsx("strong",{children:e.levelStats.knownWords})]}),t.jsxs("span",{children:["Toplam: ",t.jsx("strong",{children:e.levelStats.totalWords})]})]})]}),t.jsxs("div",{style:{...r.progressBarBackground,marginBottom:"20px"},children:[t.jsx("div",{style:{...r.progressBarFill,width:`${e.levelStats.progress}%`},children:e.levelStats.progress>15&&t.jsxs("span",{children:[e.levelStats.progress,"%"]})}),e.levelStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.levelStats.progress,"%"]})]}),t.jsxs("div",{children:[t.jsxs("h4",{style:r.totalStatsHeader,children:["Genel Toplam ","Ä°","lerleme"]}),t.jsxs("div",{style:{...r.progressStats,marginBottom:"8px"},children:[t.jsxs("span",{children:["Toplam BildiÄŸiniz: ",t.jsx("strong",{children:e.totalStats.totalKnownWords})]}),t.jsxs("span",{children:["Toplam Kelime: ",t.jsx("strong",{children:e.totalStats.totalWords})]})]}),t.jsxs("div",{style:r.progressBarBackground,children:[t.jsx("div",{style:{...r.progressBarFill,...r.totalProgressBarFill,width:`${e.totalStats.progress}%`},children:e.totalStats.progress>15&&t.jsxs("span",{children:[e.totalStats.progress,"%"]})}),e.totalStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.totalStats.progress,"%"]})]})]}),t.jsx("div",{style:r.wordArea,children:e.levelComplete?t.jsxs("h2",{style:{...r.term,color:"var(--text-positive)"},children:["Tebrikler! ","ðŸŽ‰",t.jsx("br",{}),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."]}):e.currentWord?t.jsxs(t.Fragment,{children:[t.jsx("h2",{style:r.term,children:e.currentWord.term}),e.showAnswer&&t.jsx("p",{style:r.meanings,children:e.currentWord.meanings.join(" / ")})]}):t.jsx("p",{children:"Bu seviyede kelime bulunamadÄ±."})}),t.jsxs("div",{style:r.buttonGroup,children:[t.jsx("button",{style:r.actionButton,onClick:()=>e.setShowAnswer(!0),disabled:e.showAnswer||!e.currentWord||e.levelComplete,children:"CevabÄ± GÃ¶ster"}),t.jsx("button",{style:{...r.actionButton,...r.knownButton},onClick:e.handleMarkAsKnown,disabled:!e.currentWord||e.levelComplete,children:"Biliyorum (GeÃ§)"}),t.jsx("button",{style:{...r.actionButton,...r.primaryButton},onClick:e.getNewWord,disabled:e.levelComplete||e.availableWordsForLevel.length<=1,children:"Yeni Kelime"})]})]})]})}export{te as default};
