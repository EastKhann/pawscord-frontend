var z=Object.defineProperty;var o=(k,y)=>z(k,"name",{value:y,configurable:!0});import{r as p,j as a}from"./react-core-Djgtqrmb.js";import{a3 as O,C as P,_ as D,h as M}from"./icons-vendor-BMXAt4pj.js";import{C as T,G as L,c as q,i as f,t as F,A as N}from"./index-DwVhiipM.js";import{u as B}from"./recaptcha-D67gYgdo.js";import{j as w}from"./crypto-vendor-D1XRGppi.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./ui-vendor-IhB9Znpc.js";const X=o(({onLogin:k,onRegister:y,error:j,setAuthError:t})=>{const[u,b]=p.useState(!0),[c,v]=p.useState({username:"",email:"",password:""}),[I,_]=p.useState(!1),{getToken:G}=B();p.useEffect(()=>{if(T.isNativePlatform())try{L.initialize({clientId:q,scopes:["profile","email"],grantOfflineAccess:!0})}catch{}},[]),p.useEffect(()=>{if(f&&window.require){const{ipcRenderer:e}=window.require("electron"),r=o((x,d)=>{try{const{access:n,refresh:i}=d;if(n&&i){const g=w(n);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",i),localStorage.setItem("chat_username",g.username),setTimeout(()=>window.location.reload(),500)}}catch{t("Token işleme hatası.")}},"handleAuthSuccess"),s=o((x,d)=>{t(d.error||"Google girişi başarısız.")},"handleAuthError"),m=o((x,d)=>{try{const{access:n,refresh:i}=d;if(n&&i){const g=w(n);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",i),localStorage.setItem("chat_username",g.username),setTimeout(()=>window.location.reload(),500)}}catch{t("Token işleme hatası.")}},"handleOAuthTokens"),l=o((x,d)=>{try{const n=new URL(d),i=new URLSearchParams(n.search),g=i.get("access"),h=i.get("refresh");if(g&&h){const S=w(g);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",h),localStorage.setItem("chat_username",S.username),window.location.reload()}}catch{try{if(d.includes("access=")&&d.includes("refresh=")){const i=d.split("access=");if(i.length>1){const g=i[1].split("&")[0],h=d.split("refresh=");if(h.length>1){const S=h[1],U=w(g);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",S),localStorage.setItem("chat_username",U.username),window.location.reload()}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}else t("Giriş verisi okunamadı.")}catch{t("Giriş işlemi başarısız.")}}},"handleDeepLink");return e.on("google-auth-success",r),e.on("google-auth-error",s),e.on("deep-link-auth",l),e.on("oauth-tokens",m),()=>{e.removeListener("google-auth-success",r),e.removeListener("google-auth-error",s),e.removeListener("deep-link-auth",l),e.removeListener("oauth-tokens",m)}}},[t]),p.useEffect(()=>{if(!f){const e=new URLSearchParams(window.location.search),r=e.get("access"),s=e.get("refresh"),m=e.get("error");if(m){t(decodeURIComponent(m)),window.history.replaceState({},document.title,"/");return}if(r&&s)try{const l=w(r);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",s),localStorage.setItem("chat_username",l.username),window.history.replaceState({},document.title,"/"),window.location.reload()}catch{t("Tarayıcı depolama hatası. Lütfen gizli modda değilseniz kontrol edin.")}}},[]);const C=o(async()=>{try{if(T.isNativePlatform()){const e=await L.signIn(),r=`${N}/auth/google/native/`,s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})}),m=s.headers.get("content-type");if(!m||!m.includes("application/json")){const x=await s.text();t("Backend hatası: JSON yerine HTML yanıtı alındı. Sunucu ayarlarını kontrol edin.");return}const l=await s.json();s.ok?l.access&&l.refresh?(localStorage.setItem("access_token",l.access),localStorage.setItem("refresh_token",l.refresh),window.location.reload()):t("Token bilgileri eksik."):t(l.error||"Google girişi başarısız.")}else{const s=`${f?"https://api.pawscord.com/api":N}/auth/google/start/?source=${f?"electron":"web"}`;if(f&&window.require){const{ipcRenderer:m}=window.require("electron");m.send("start-google-login",s)}else window.location.href=s}}catch(e){t("Google girişi sırasında bir hata oluştu: "+e.message)}},"handleGoogleLogin"),R=o(async e=>{e.preventDefault(),_(!0),t("");try{const r=await G(u?"login":"register");u?await k(c.username,c.password,r):await y(c.username,c.email,c.password,r)&&(F.success("Kayıt başarılı! Lütfen e-postanı kontrol et.",4e3),b(!0))}catch{t("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.")}finally{_(!1)}},"handleSubmit");return a.jsxs("div",{className:"login-container",children:[a.jsx("div",{className:"background-animate"}),a.jsxs("div",{className:"login-card",children:[a.jsxs("div",{className:"logo-header",children:[a.jsx("div",{className:"logo-circle",children:a.jsx(O,{size:40,color:"white"})}),a.jsx("h1",{children:"Pawscord"}),a.jsx("p",{children:u?"Tekrar hoşgeldin!":"Aramıza katıl!"})]}),j&&a.jsx("div",{className:"error-message",children:j}),a.jsxs("form",{onSubmit:R,children:[a.jsxs("div",{className:"input-group",children:[a.jsx(P,{className:"input-icon"}),a.jsx("input",{type:"text",placeholder:"Kullanıcı Adı",value:c.username,onChange:o(e=>v({...c,username:e.target.value}),"onChange"),required:!0})]}),!u&&a.jsxs("div",{className:"input-group slide-down",children:[a.jsx(D,{className:"input-icon"}),a.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:c.email,onChange:o(e=>v({...c,email:e.target.value}),"onChange"),required:!0})]}),a.jsxs("div",{className:"input-group",children:[a.jsx(M,{className:"input-icon"}),a.jsx("input",{type:"password",placeholder:"Şifre",value:c.password,onChange:o(e=>v({...c,password:e.target.value}),"onChange"),required:!0})]}),a.jsx("button",{type:"submit",className:"submit-btn",disabled:I,children:I?a.jsx("div",{className:"spinner"}):u?"Giriş Yap":"Kayıt Ol"})]}),u&&a.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:a.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:o(e=>e.target.style.opacity="0.8","onMouseEnter"),onMouseLeave:o(e=>e.target.style.opacity="1","onMouseLeave"),children:"Şifremi Unuttum?"})}),a.jsx("div",{className:"divider",children:a.jsx("span",{children:"veya"})}),a.jsx("div",{className:"google-btn-wrapper",children:a.jsxs("button",{onClick:C,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:o(e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},"onMouseEnter"),onMouseLeave:o(e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},"onMouseLeave"),onMouseDown:o(e=>e.currentTarget.style.backgroundColor="#eff2f5","onMouseDown"),children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),a.jsx("span",{children:"Google ile Giriş Yap"})]})}),a.jsxs("div",{className:"toggle-mode",children:[u?"Hesabın yok mu? ":"Zaten üye misin? ",a.jsx("span",{onClick:o(()=>{b(!u),t("")},"onClick"),children:u?"Kayıt Ol":"Giriş Yap"})]})]})]})},"LoginPage");export{X as default};
