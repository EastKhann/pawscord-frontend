import{r as s,b as e}from"./react-core-9vc7GIjk.js";import{aa as d,a as E,t as b,b2 as D,x as j,aJ as R,u as L}from"./icons-vendor-BHKL7tCa.js";import{t as n}from"./index-BIYh9lA9.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const H=({fetchWithAuth:r,apiBaseUrl:i,onClose:p,username:$})=>{const[m,S]=s.useState([]),[v,C]=s.useState(!0),[x,w]=s.useState("messages"),[f,g]=s.useState(!1),u=[{id:"messages",name:"Messages",description:"Export all your messages"},{id:"server",name:"Server Data",description:"Export server content"},{id:"dm",name:"Direct Messages",description:"Export DM history"},{id:"media",name:"Media Files",description:"Export uploaded media"},{id:"profile",name:"Profile Data",description:"Export your profile info"},{id:"analytics",name:"Analytics",description:"Export analytics data"}];s.useEffect(()=>{c();const t=setInterval(c,5e3);return()=>clearInterval(t)},[]);const c=async()=>{try{const a=await(await r(`${i}/api/exports/jobs/`)).json();S(a.jobs||[])}catch(t){console.error("Failed to load export jobs:",t)}finally{C(!1)}},h=async()=>{g(!0);try{const a=await(await r(`${i}/api/exports/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:x})})).json();a.success?(n.success("Export job created! Processing..."),c()):n.error(a.error||"Failed to create export")}catch(t){console.error("Export creation error:",t),n.error("Failed to create export")}finally{g(!1)}},k=async t=>{try{const B=await(await r(`${i}/exports/${t}/download/`)).blob(),y=window.URL.createObjectURL(B),l=document.createElement("a");l.href=y,l.download=`export_${t}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(y),n.success("Download started!")}catch(a){console.error("Download error:",a),n.error("Download failed")}},z=async t=>{if(window.confirm("Delete this export job?"))try{await r(`${i}/exports/${t}/delete/`,{method:"DELETE"}),n.success("Export job deleted"),c()}catch(a){console.error("Delete error:",a),n.error("Failed to delete job")}},F=t=>{switch(t){case"completed":return e.createElement(L,{style:{color:"#43b581"}});case"processing":return e.createElement(b,{style:{color:"#faa61a"},className:"fa-spin"});case"failed":return e.createElement(R,{style:{color:"#f04747"}});default:return e.createElement(j,{style:{color:"#99aab5"}})}},T=t=>{switch(t){case"completed":return"#43b581";case"processing":return"#faa61a";case"failed":return"#f04747";default:return"#99aab5"}};return e.createElement("div",{style:o.overlay,onClick:p},e.createElement("div",{style:o.modal,onClick:t=>t.stopPropagation()},e.createElement("div",{style:o.header},e.createElement("div",{style:o.headerLeft},e.createElement(d,{style:{fontSize:"24px",color:"#5865f2"}}),e.createElement("h2",{style:{margin:0,fontSize:"20px"}},"Export Jobs")),e.createElement("button",{onClick:p,style:o.closeBtn},e.createElement(E,null))),e.createElement("div",{style:o.content},e.createElement("div",{style:o.createSection},e.createElement("h3",{style:o.sectionTitle},"Create New Export"),e.createElement("div",{style:o.exportTypeSelector},e.createElement("select",{value:x,onChange:t=>w(t.target.value),style:o.select},u.map(t=>e.createElement("option",{key:t.id,value:t.id},t.name," - ",t.description))),e.createElement("button",{onClick:h,disabled:f,style:o.createBtn},f?e.createElement(e.Fragment,null,e.createElement(b,{className:"fa-spin"})," Creating..."):e.createElement(e.Fragment,null,e.createElement(d,null)," Create Export")))),e.createElement("div",{style:o.jobsSection},e.createElement("h3",{style:o.sectionTitle},"Your Export Jobs"),v?e.createElement("div",{style:o.loading},"Loading jobs..."):m.length===0?e.createElement("div",{style:o.empty},e.createElement(D,{style:{fontSize:"48px",color:"#99aab5",marginBottom:"16px"}}),e.createElement("p",null,"No export jobs yet"),e.createElement("p",{style:{fontSize:"14px",color:"#99aab5"}},"Create your first export to get started")):e.createElement("div",{style:o.jobsList},m.map(t=>e.createElement("div",{key:t.id,style:o.jobCard},e.createElement("div",{style:o.jobIcon},F(t.status)),e.createElement("div",{style:o.jobDetails},e.createElement("div",{style:o.jobTitle},u.find(a=>a.id===t.type)?.name||t.type),e.createElement("div",{style:o.jobMeta},e.createElement("span",null,"Created: ",new Date(t.created_at).toLocaleString()),t.completed_at&&e.createElement(e.Fragment,null,e.createElement("span",{style:{margin:"0 8px"}},"â€¢"),e.createElement("span",null,"Completed: ",new Date(t.completed_at).toLocaleString()))),t.status==="processing"&&t.progress&&e.createElement("div",{style:o.progressBar},e.createElement("div",{style:{...o.progressFill,width:`${t.progress}%`}}),e.createElement("span",{style:o.progressText},t.progress,"%")),t.file_size&&e.createElement("div",{style:o.fileSize},"Size: ",I(t.file_size))),e.createElement("div",{style:o.jobActions},e.createElement("span",{style:{...o.statusBadge,backgroundColor:T(t.status)}},t.status),t.status==="completed"&&e.createElement("button",{onClick:()=>k(t.id),style:o.downloadBtn,title:"Download"},e.createElement(d,null)),e.createElement("button",{onClick:()=>z(t.id),style:o.deleteBtn,title:"Delete"},e.createElement(E,null))))))),e.createElement("div",{style:o.info},e.createElement("p",{style:o.infoText},"ðŸ“¦ Exports are processed in the background and may take a few minutes"),e.createElement("p",{style:o.infoText},"ðŸ’¾ Completed exports are available for 7 days before auto-deletion")))))},I=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(2)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(2)} MB`:`${(r/(1024*1024*1024)).toFixed(2)} GB`,o={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},createSection:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",marginBottom:"24px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},exportTypeSelector:{display:"flex",gap:"12px"},select:{flex:1,padding:"10px",backgroundColor:"#202225",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px"},createBtn:{padding:"10px 24px",backgroundColor:"#5865f2",border:"none",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},jobsSection:{marginBottom:"24px"},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},empty:{textAlign:"center",padding:"60px 20px",color:"#dcddde"},jobsList:{display:"flex",flexDirection:"column",gap:"12px"},jobCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center",gap:"16px"},jobIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},jobDetails:{flex:1},jobTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"4px"},jobMeta:{fontSize:"12px",color:"#99aab5",marginBottom:"8px"},progressBar:{position:"relative",height:"20px",backgroundColor:"#202225",borderRadius:"10px",overflow:"hidden",marginTop:"8px"},progressFill:{height:"100%",backgroundColor:"#5865f2",transition:"width 0.3s ease"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:"600",color:"#fff"},fileSize:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},jobActions:{display:"flex",alignItems:"center",gap:"8px"},statusBadge:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},downloadBtn:{padding:"8px 12px",backgroundColor:"#43b581",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},deleteBtn:{padding:"8px 12px",backgroundColor:"#f04747",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},info:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},infoText:{fontSize:"14px",color:"#dcddde",margin:"8px 0",lineHeight:"1.6"}};export{H as default};
