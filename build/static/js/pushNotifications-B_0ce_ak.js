const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/index-CR4ubrBh.js","static/js/index-D_luy7FO.js","static/js/media-vendor-CxFPycob.js","static/js/react-core-Djgtqrmb.js","static/js/router-vendor-gmJ9Mn-1.js","static/js/state-vendor-BRqaXHJQ.js","static/js/crypto-vendor-D1XRGppi.js","static/js/icons-vendor-BW7dxHkX.js","static/js/ui-vendor-IhB9Znpc.js","static/css/index-pnGyWLwG.css"])))=>i.map(i=>d[i]);
var d=Object.defineProperty;var n=(r,i)=>d(r,"name",{value:i,configurable:!0});import{_ as h}from"./media-vendor-CxFPycob.js";import"./react-core-Djgtqrmb.js";const o=class o{constructor(){this.isSupported="PushManager"in window,this.permission="default",this.deviceToken=null,this.listeners=new Map}async init(i,e){this.apiBaseUrl=i,this.fetchWithAuth=e,window.Capacitor?.isNativePlatform()?await this.initCapacitor():await this.initWeb()}async initCapacitor(){try{const{PushNotifications:i}=await h(async()=>{const{PushNotifications:t}=await import("./index-CR4ubrBh.js");return{PushNotifications:t}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));(await i.requestPermissions()).receive==="granted"&&(this.permission="granted",await i.register(),await i.addListener("registration",async t=>{this.deviceToken=t.value,await this.registerDevice(t.value)}),await i.addListener("registrationError",t=>{}),await i.addListener("pushNotificationReceived",t=>{this.handleNotification(t)}),await i.addListener("pushNotificationActionPerformed",t=>{this.handleNotificationAction(t)}))}catch{}}async initWeb(){if(!this.isSupported)return;const i=await Notification.requestPermission();this.permission=i}async registerDevice(i){try{(await this.fetchWithAuth(`${this.apiBaseUrl}/devices/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({registration_id:i,type:"android",active:!0})})).ok}catch{}}handleNotification(i){const{title:e,body:t,data:s}=i;this.listeners.forEach(c=>{c({type:"notification",title:e,body:t,data:s})}),document.hidden&&this.permission==="granted"&&new Notification(e,{body:t,icon:"/logo192.png",badge:"/badge.png",tag:s?.messageId||"default",data:s})}handleNotificationAction(i){const{notification:e,actionId:t}=i;this.listeners.forEach(s=>{s({type:"action",actionId:t,notification:e})}),e.data?.roomId?window.location.href=`/#/room/${e.data.roomId}`:e.data?.conversationId&&(window.location.href=`/#/dm/${e.data.conversationId}`)}on(i,e){const t=Math.random().toString(36).substr(2,9);return this.listeners.set(t,e),()=>this.listeners.delete(t)}async sendTestNotification(){try{await this.fetchWithAuth(`${this.apiBaseUrl}/push/test/`,{method:"POST"})}catch{}}async unregister(){if(this.deviceToken)try{await this.fetchWithAuth(`${this.apiBaseUrl}/devices/${this.deviceToken}/`,{method:"DELETE"})}catch{}}};n(o,"PushNotificationManager");let a=o;const u=new a;export{u as pushNotificationManager};
