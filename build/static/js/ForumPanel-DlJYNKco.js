import{r as c,n as e}from"./react-core-zXIKm1Jm.js";import{t as a}from"./index-Cuuw2ydP.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-DZdpmN99.js";import"./state-vendor-8NbFPBhQ.js";const M=({serverId:p,apiBaseUrl:i,onClose:j})=>{const[x,y]=c.useState([]),[d,b]=c.useState(null),[m,f]=c.useState([]),[r,u]=c.useState(null),[_,z]=c.useState(!0),[C,S]=c.useState(!1),[w,k]=c.useState(!1),[l,v]=c.useState({title:"",content:"",tags:[]}),[N,$]=c.useState("");c.useEffect(()=>{F()},[p]),c.useEffect(()=>{d&&A(d.id)},[d]);const F=async()=>{try{const s=localStorage.getItem("access_token"),t=await fetch(`${i}/servers/${p}/forums/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const o=await t.json();y(Array.isArray(o)?o:o.forums||[])}}catch(s){console.error("Forum fetch error:",s)}finally{z(!1)}},A=async s=>{try{const t=localStorage.getItem("access_token"),o=await fetch(`${i}/forums/${s}/posts/`,{headers:{Authorization:`Bearer ${t}`}});if(o.ok){const n=await o.json();f(Array.isArray(n)?n:n.posts||[])}}catch(t){console.error("Posts fetch error:",t)}},P=async()=>{const s=prompt("Forum kanalÄ± adÄ±:");if(s)try{const t=localStorage.getItem("access_token"),o=await fetch(`${i}/servers/${p}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:s})});if(o.ok){const n=await o.json();y([...x,n.forum]),a.success("âœ… Forum oluÅŸturuldu!")}else a.error("âŒ Forum oluÅŸturulamadÄ±")}catch(t){console.error("Forum creation error:",t),a.error("âŒ Hata oluÅŸtu")}},T=async()=>{if(!l.title.trim()||!l.content.trim()){a.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}S(!0);try{const s=localStorage.getItem("access_token"),t=await fetch(`${i}/forums/${d.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(t.ok){const o=await t.json();f([o.post,...m]),v({title:"",content:"",tags:[]}),k(!1),a.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else a.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch(s){console.error("Post creation error:",s),a.error("âŒ Hata oluÅŸtu")}finally{S(!1)}},O=async s=>{if(!N.trim()){a.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const t=localStorage.getItem("access_token"),o=await fetch(`${i}/forums/posts/${s}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({content:N})});if(o.ok){const n=await o.json();u({...r,replies:[...r.replies||[],n.reply]}),$(""),a.success("âœ… YanÄ±t gÃ¶nderildi!")}else a.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch(t){console.error("Reply error:",t),a.error("âŒ Hata oluÅŸtu")}},h=async(s,t)=>{try{const o=localStorage.getItem("access_token"),n=await fetch(`${i}/forums/posts/${s}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:t})});if(n.ok){const G=await n.json();f(m.map(g=>g.id===s?{...g,votes:G.votes}:g)),a.success(t==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch(o){console.error("Vote error:",o)}},Y=async(s,t)=>{try{const o=localStorage.getItem("access_token");(await fetch(`${i}/forums/posts/${s}/solve/${t}/`,{method:"POST",headers:{Authorization:`Bearer ${o}`}})).ok&&(a.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),u({...r,solution_id:t}))}catch(o){console.error("Mark solution error:",o)}};return _?e.jsx("div",{className:"forum-panel-overlay",onClick:j,children:e.jsx("div",{className:"forum-panel",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"forum-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"forum-panel-overlay",onClick:j,children:e.jsxs("div",{className:"forum-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"forum-header",children:[e.jsx("h2",{children:"ğŸ’¬ Forum"}),e.jsx("button",{className:"close-btn",onClick:j,children:"âœ•"})]}),d?r?e.jsxs("div",{className:"post-detail",children:[e.jsx("div",{className:"detail-header",children:e.jsx("button",{className:"back-btn",onClick:()=>u(null),children:"â† Geri"})}),e.jsxs("div",{className:"post-main",children:[e.jsxs("div",{className:"post-votes-vertical",children:[e.jsx("button",{onClick:()=>h(r.id,"up"),children:"ğŸ‘"}),e.jsx("span",{children:r.votes||0}),e.jsx("button",{onClick:()=>h(r.id,"down"),children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-body",children:[e.jsx("h2",{children:r.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",r.author," â€¢ â° ",new Date(r.created_at).toLocaleString("tr-TR")]}),e.jsx("div",{className:"post-text",children:r.content})]})]}),e.jsxs("div",{className:"replies-section",children:[e.jsxs("h3",{children:["ğŸ’¬ YanÄ±tlar (",r.replies?.length||0,")"]}),(r.replies||[]).map(s=>e.jsxs("div",{className:`reply-item ${s.id===r.solution_id?"solution":""}`,children:[e.jsxs("div",{className:"reply-header",children:[e.jsxs("span",{className:"reply-author",children:["ğŸ‘¤ ",s.author]}),e.jsx("span",{className:"reply-time",children:new Date(s.created_at).toLocaleString("tr-TR")}),s.id===r.solution_id&&e.jsx("span",{className:"solution-badge",children:"âœ… Ã‡Ã¶zÃ¼m"})]}),e.jsx("div",{className:"reply-content",children:s.content}),!r.solution_id&&e.jsx("button",{className:"mark-solution-btn",onClick:()=>Y(r.id,s.id),children:"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"})]},s.id)),e.jsxs("div",{className:"reply-form",children:[e.jsx("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:N,onChange:s=>$(s.target.value),rows:4}),e.jsx("button",{className:"reply-submit-btn",onClick:()=>O(r.id),children:"ğŸ“¤ YanÄ±tla"})]})]})]}):e.jsxs("div",{className:"posts-view",children:[e.jsxs("div",{className:"posts-header",children:[e.jsx("button",{className:"back-btn",onClick:()=>b(null),children:"â† Geri"}),e.jsxs("h3",{children:["# ",d.name]}),e.jsx("button",{className:"new-post-btn",onClick:()=>k(!w),children:"â• Yeni GÃ¶nderi"})]}),w&&e.jsxs("div",{className:"create-post-form",children:[e.jsx("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:l.title,onChange:s=>v({...l,title:s.target.value}),maxLength:200}),e.jsx("textarea",{placeholder:"Ä°Ã§erik...",value:l.content,onChange:s=>v({...l,content:s.target.value}),rows:6}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:T,disabled:C,children:C?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"}),e.jsx("button",{className:"cancel-btn",onClick:()=>k(!1),children:"Ä°ptal"})]})]}),e.jsxs("div",{className:"posts-list",children:[m.map(s=>e.jsxs("div",{className:"post-item",onClick:()=>u(s),children:[e.jsxs("div",{className:"post-votes",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),h(s.id,"up")},children:"ğŸ‘"}),e.jsx("span",{children:s.votes||0}),e.jsx("button",{onClick:t=>{t.stopPropagation(),h(s.id,"down")},children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-content",children:[e.jsx("h4",{children:s.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",s.author," â€¢ â° ",new Date(s.created_at).toLocaleDateString("tr-TR"),s.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"]}),e.jsxs("p",{className:"post-preview",children:[s.content?.substring(0,150),"..."]}),e.jsxs("div",{className:"post-stats",children:["ğŸ’¬ ",s.replies_count||0," yanÄ±t"]})]})]},s.id)),m.length===0&&e.jsx("div",{className:"no-posts",children:e.jsx("p",{children:"ğŸ“­ HenÃ¼z gÃ¶nderi yok"})})]})]}):e.jsxs("div",{className:"forum-list",children:[e.jsxs("div",{className:"forum-list-header",children:[e.jsx("h3",{children:"Forum KanallarÄ±"}),e.jsx("button",{className:"create-forum-btn",onClick:P,children:"â• Yeni Forum"})]}),x.length>0?e.jsx("div",{className:"forums-grid",children:x.map(s=>e.jsxs("div",{className:"forum-card",onClick:()=>b(s),children:[e.jsx("div",{className:"forum-icon",children:"ğŸ’¬"}),e.jsx("h4",{children:s.name}),e.jsxs("p",{className:"forum-stats",children:[s.posts_count||0," gÃ¶nderi â€¢ ",s.members_count||0," Ã¼ye"]})]},s.id))}):e.jsxs("div",{className:"no-forums",children:[e.jsx("p",{children:"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"}),e.jsx("button",{onClick:P,children:"Ä°lk forumu oluÅŸtur"})]})]})]})})};export{M as default};
