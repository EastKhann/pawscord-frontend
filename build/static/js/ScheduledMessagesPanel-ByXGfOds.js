var S=Object.defineProperty;var a=(i,o)=>S(i,"name",{value:o,configurable:!0});import{r as h,j as e}from"./react-core-Djgtqrmb.js";import{t as n}from"./index-D09YXCFH.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";import"./ui-vendor-IhB9Znpc.js";const L=a(({apiBaseUrl:i,roomSlug:o,onClose:f})=>{const[u,g]=h.useState([]),[v,p]=h.useState(!0),[x,j]=h.useState(!1),[r,d]=h.useState({content:"",scheduled_time:"",room_slug:o||""});h.useEffect(()=>{k()},[]);const k=a(async()=>{try{p(!0);const s=localStorage.getItem("access_token"),t=await fetch(`${i}/scheduled/list/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const l=await t.json();g(l.scheduled_messages||[])}else n.error("âŒ ZamanlanmÄ±ÅŸ mesajlar yÃ¼klenemedi")}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{p(!1)}},"fetchScheduledMessages"),w=a(async()=>{if(!r.content.trim()){n.error("âŒ Mesaj iÃ§eriÄŸi boÅŸ olamaz");return}if(!r.scheduled_time){n.error("âŒ Tarih ve saat seÃ§iniz");return}if(!r.room_slug){n.error("âŒ Kanal seÃ§iniz");return}try{const s=localStorage.getItem("access_token"),t=await fetch(`${i}/scheduled/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(t.ok){const l=await t.json();g([...u,l.scheduled_message]),j(!1),d({content:"",scheduled_time:"",room_slug:o||""}),n.success("âœ… Mesaj zamanlandÄ±")}else{const l=await t.json();n.error(`âŒ ${l.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z"}`)}}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"createScheduledMessage"),b=a(async s=>{if(confirm("Bu zamanlanmÄ±ÅŸ mesajÄ± iptal etmek istediÄŸinize emin misiniz?"))try{const t=localStorage.getItem("access_token");(await fetch(`${i}/scheduled/cancel/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(g(u.filter(c=>c.id!==s)),n.success("âœ… ZamanlanmÄ±ÅŸ mesaj iptal edildi")):n.error("âŒ Ä°ptal baÅŸarÄ±sÄ±z")}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"cancelScheduledMessage"),y=a(s=>{const t=new Date,c=new Date(s)-t;if(c<0)return"GÃ¶nderildi";const m=Math.floor(c/(1e3*60*60)),N=Math.floor(c%(1e3*60*60)/(1e3*60));return m>24?`${Math.floor(m/24)} gÃ¼n ${m%24} saat`:m>0?`${m} saat ${N} dakika`:`${N} dakika`},"getTimeRemaining"),M=a(s=>new Date(s).toLocaleString("tr-TR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),"formatDateTime"),_=a(s=>{const t=new Date,c=new Date(s)-t;return c<0?"status-sent":c<36e5?"status-imminent":c<864e5?"status-soon":"status-scheduled"},"getStatusColor"),z=a(()=>{const s=new Date;return s.setMinutes(s.getMinutes()+1),s.toISOString().slice(0,16)},"getMinDateTime");return e.jsx("div",{className:"scheduled-messages-overlay",onClick:f,children:e.jsxs("div",{className:"scheduled-messages-panel",onClick:a(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"scheduled-messages-header",children:[e.jsx("h2",{children:"â° ZamanlanmÄ±ÅŸ Mesajlar"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"create-btn",onClick:a(()=>j(!x),"onClick"),children:x?"âœ• Ä°ptal":"+ Yeni Mesaj"}),e.jsx("button",{className:"close-btn",onClick:f,children:"âœ•"})]})]}),x&&e.jsxs("div",{className:"create-form",children:[e.jsx("h3",{children:"ğŸ“ Yeni ZamanlanmÄ±ÅŸ Mesaj"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mesaj Ä°Ã§eriÄŸi"}),e.jsx("textarea",{className:"message-textarea",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:r.content,onChange:a(s=>d({...r,content:s.target.value}),"onChange"),rows:4})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"room-slug",value:r.room_slug,onChange:a(s=>d({...r,room_slug:s.target.value}),"onChange")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"GÃ¶nderim ZamanÄ±"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:r.scheduled_time,min:z(),onChange:a(s=>d({...r,scheduled_time:s.target.value}),"onChange")})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-form-btn",onClick:a(()=>{j(!1),d({content:"",scheduled_time:"",room_slug:o||""})},"onClick"),children:"Ä°ptal"}),e.jsx("button",{className:"submit-btn",onClick:w,children:"â° Zamanla"})]})]}),e.jsx("div",{className:"scheduled-messages-content",children:v?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"â°"}),e.jsx("h3",{children:"ZamanlanmÄ±ÅŸ mesaj yok"}),e.jsx("p",{children:"Gelecekte gÃ¶nderilmek Ã¼zere mesaj zamanlamadÄ±nÄ±z"}),e.jsx("button",{className:"create-first-btn",onClick:a(()=>j(!0),"onClick"),children:"+ Ä°lk MesajÄ± Zamanla"})]}):e.jsx("div",{className:"messages-list",children:u.map(s=>e.jsxs("div",{className:`scheduled-message-card ${_(s.scheduled_time)}`,children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"message-info",children:[e.jsx("span",{className:"room-badge",children:s.room_slug}),e.jsx("span",{className:"time-badge",children:M(s.scheduled_time)})]}),e.jsx("button",{className:"cancel-btn",onClick:a(()=>b(s.id),"onClick"),title:"Ä°ptal Et",children:"ğŸ—‘ï¸"})]}),e.jsx("div",{className:"message-content",children:s.content}),e.jsxs("div",{className:"message-footer",children:[e.jsxs("div",{className:"countdown",children:[e.jsx("span",{className:"countdown-icon",children:"â³"}),e.jsx("span",{className:"countdown-text",children:y(s.scheduled_time)})]}),s.sent&&e.jsx("div",{className:"sent-badge",children:"âœ… GÃ¶nderildi"})]})]},s.id))})})]})})},"ScheduledMessagesPanel");export{L as default};
