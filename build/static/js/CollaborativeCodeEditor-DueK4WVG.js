var F=Object.defineProperty;var a=(u,p)=>F(u,"name",{value:p,configurable:!0});import{r as s,j as o}from"./react-core-Djgtqrmb.js";import{q as D,u as M,aV as I,a5 as J,aY as P,aN as U}from"./icons-vendor-BW7dxHkX.js";import{t as L}from"./index-m2zCEI_Z.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const K={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"},H=a(({roomId:u,userId:p,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:c})=>{const[g,w]=s.useState(`// Start coding...
`),[l,y]=s.useState("javascript"),[j,f]=s.useState(""),[S,h]=s.useState([]),[E,v]=s.useState(!1),[R,b]=s.useState(!1),d=s.useRef(null),k=s.useRef(null),C=s.useRef(new Map),N=a(e=>{e.user_id!==p&&window.monacoEditor&&window.monacoEditor.setValue(e.code)},"handleRemoteCodeUpdate"),B=a(e=>{if(e.user_id===p)return;const t=window.monacoEditor,r=k.current;if(!t||!r)return;const i=C.current.get(e.user_id);i&&t.deltaDecorations(i,[]);const z=t.deltaDecorations([],[{range:new r.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);C.current.set(e.user_id,z)},"handleRemoteCursorUpdate"),O=a(e=>h(t=>[...t,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}]),"handleCollaboratorJoined"),T=a(e=>{h(r=>r.filter(i=>i.id!==e.user_id));const t=C.current.get(e.user_id);t&&window.monacoEditor&&window.monacoEditor.deltaDecorations(t,[]),C.current.delete(e.user_id)},"handleCollaboratorLeft"),$=a(async()=>{try{const e=await m(`${x}/code-editor/load/?room_id=${u}`);if(e.ok){const t=await e.json();t.code&&(w(t.code),y(t.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(t.code),window.monacoEditor.setLanguage(t.language||"javascript")))}}catch{}},"loadSavedCode");return s.useEffect(()=>{const e=a(t=>{const r=JSON.parse(t.data);r.type==="code_update"?N(r):r.type==="cursor_update"?B(r):r.type==="collaborator_joined"?O(r):r.type==="collaborator_left"&&T(r)},"handleMessage");return c&&c.addEventListener("message",e),$(),()=>{c&&(c.removeEventListener("message",e),c.close()),window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor)}},[]),{code:g,language:l,output:j,collaborators:S,saving:E,running:R,editorRef:d,saveCode:a(async()=>{v(!0);try{(await m(`${x}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:u,code:g,language:l})})).ok&&L.success("✅ Kod kaydedildi!")}catch{L.error("❌ Kaydetme başarısız")}finally{v(!1)}},"saveCode"),runCode:a(async()=>{b(!0),f("Çalıştırılıyor...");try{const e=await m(`${x}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g,language:l})});if(e.ok){const t=await e.json();f(t.output||"No output")}else{const t=await e.json();f(`Error: ${t.error||"Execution failed"}`)}}catch(e){f(`Error: ${e.message}`)}finally{b(!1)}},"runCode"),copyCode:a(()=>{navigator.clipboard.writeText(g),L.success("✅ Kod kopyalandı!")},"copyCode"),downloadCode:a(()=>{const e=K[l]||"txt",t=new Blob([g],{type:"text/plain"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=`code.${e}`,i.click(),URL.revokeObjectURL(r)},"downloadCode"),changeLanguage:a(e=>{y(e),window.monacoEditor&&k.current&&k.current.editor.setModelLanguage(window.monacoEditor.getModel(),e)},"changeLanguage")}},"useCodeEditor"),n={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}},V=[{value:"javascript",label:"JavaScript"},{value:"typescript",label:"TypeScript"},{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"},{value:"html",label:"HTML"},{value:"css",label:"CSS"}],se=a(({roomId:u,userId:p,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:c,onClose:g})=>{const{language:w,output:l,collaborators:y,saving:j,running:f,editorRef:S,saveCode:h,runCode:E,copyCode:v,downloadCode:R,changeLanguage:b}=H({roomId:u,userId:p,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:c});return o.jsxs("div",{style:n.container,children:[o.jsxs("div",{style:n.header,children:[o.jsxs("div",{style:n.headerLeft,children:[o.jsx(D,{style:n.headerIcon}),o.jsx("h2",{style:n.title,children:"Code Editor"}),o.jsx("select",{value:w,onChange:a(d=>b(d.target.value),"onChange"),style:n.languageSelect,children:V.map(d=>o.jsx("option",{value:d.value,children:d.label},d.value))})]}),o.jsxs("div",{style:n.headerRight,children:[o.jsxs("div",{style:n.collaborators,children:[o.jsx(M,{style:{marginRight:"6px"}}),o.jsx("span",{children:y.length+1})]}),o.jsx("button",{onClick:v,style:n.actionButton,title:"Kopyala",children:o.jsx(I,{})}),o.jsx("button",{onClick:R,style:n.actionButton,title:"İndir",children:o.jsx(J,{})}),o.jsx("button",{onClick:h,disabled:j,style:{...n.actionButton,...n.saveButton},title:"Kaydet",children:o.jsx(P,{})}),o.jsx("button",{onClick:E,disabled:f,style:{...n.actionButton,...n.runButton},title:"Çalıştır",children:o.jsx(U,{})})]})]}),o.jsx("div",{style:n.editorContainer,children:o.jsx("div",{ref:S,style:n.editor})}),l&&o.jsxs("div",{style:n.outputPanel,children:[o.jsx("div",{style:n.outputHeader,children:o.jsx("span",{children:"Output"})}),o.jsx("pre",{style:n.outputContent,children:l})]})]})},"CollaborativeCodeEditor");export{se as default};
