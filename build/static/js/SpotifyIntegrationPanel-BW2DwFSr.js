var b=Object.defineProperty;var i=(t,c)=>b(t,"name",{value:c,configurable:!0});import{r as o,j as s}from"./react-core-Djgtqrmb.js";import{bU as y,a9 as d,b$ as C,aK as g,aN as F,aM as P}from"./icons-vendor-BMXAt4pj.js";function E({apiBaseUrl:t,fetchWithAuth:c}){const[h,j]=o.useState(!1),[e,x]=o.useState(null),[m,p]=o.useState(!0),[u,r]=o.useState(!1),[f,l]=o.useState("");o.useEffect(()=>{if(v(),h){N();const a=setInterval(N,3e4);return()=>clearInterval(a)}},[h]);const v=i(async()=>{try{const a=await c(`${t}/auth/spotify/status/`);if(a.ok){const n=await a.json();j(n.connected),p(n.show_activity)}}catch{}},"checkSpotifyConnection"),k=i(async()=>{r(!0);try{const a=await c(`${t}/auth/spotify/start/`);if(a.ok){const n=await a.json();window.location.href=n.url||n.auth_url}}catch(a){l("Failed to connect: "+a.message)}finally{r(!1)}},"connectSpotify"),S=i(async()=>{r(!0);try{(await c(`${t}/auth/spotify/disconnect/`,{method:"POST"})).ok&&(j(!1),x(null),l(""))}catch(a){l("Failed to disconnect: "+a.message)}finally{r(!1)}},"disconnectSpotify"),N=i(async()=>{try{const a=await c(`${t}/spotify/current-track/`);if(a.ok){const n=await a.json();x(n.track)}}catch{}},"fetchCurrentTrack"),w=i(async()=>{try{(await c(`${t}/spotify/toggle-activity/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({show_activity:!m})})).ok&&p(!m)}catch(a){l("Failed to toggle activity: "+a.message)}},"toggleActivityStatus");return s.jsxs("div",{className:"spotify-panel",children:[s.jsx("div",{className:"spotify-header",children:s.jsxs("h2",{children:[s.jsx(y,{className:"spotify-icon"})," Spotify Integration"]})}),f&&s.jsx("div",{className:"spotify-error",children:f}),h?s.jsxs("div",{className:"spotify-connected",children:[s.jsxs("div",{className:"connection-status",children:[s.jsx(d,{className:"status-icon"}),s.jsx("span",{children:"Connected to Spotify"}),s.jsxs("button",{className:"disconnect-btn",onClick:S,disabled:u,children:[s.jsx(C,{})," Disconnect"]})]}),s.jsx("div",{className:"activity-toggle",children:s.jsxs("label",{className:"toggle-label",children:[s.jsx("input",{type:"checkbox",checked:m,onChange:w}),s.jsx("span",{className:"toggle-slider"}),s.jsx("span",{className:"toggle-text",children:"Show listening activity"})]})}),e?s.jsxs("div",{className:"current-track",children:[s.jsxs("div",{className:"track-header",children:[s.jsx(g,{className:"music-icon"}),s.jsx("h3",{children:"Now Playing"})]}),s.jsxs("div",{className:"track-info",children:[e.album_art&&s.jsx("img",{src:e.album_art,alt:"Album art",className:"album-art"}),s.jsxs("div",{className:"track-details",children:[s.jsx("div",{className:"track-name",children:e.name}),s.jsx("div",{className:"track-artist",children:e.artist}),s.jsx("div",{className:"track-album",children:e.album})]}),s.jsx("div",{className:"track-status",children:e.is_playing?s.jsx(F,{className:"playing-icon"}):s.jsx(P,{className:"paused-icon"})})]}),s.jsx("div",{className:"track-progress",children:s.jsx("div",{className:"progress-bar",style:{width:`${e.progress_percent||0}%`}})})]}):s.jsxs("div",{className:"no-track",children:[s.jsx(g,{className:"no-track-icon"}),s.jsx("p",{children:"Not playing anything right now"})]})]}):s.jsxs("div",{className:"spotify-connect",children:[s.jsx("div",{className:"spotify-logo-container",children:s.jsx(y,{className:"spotify-logo"})}),s.jsx("h3",{children:"Connect Your Spotify"}),s.jsx("p",{children:"Share what you're listening to with your friends!"}),s.jsxs("button",{className:"connect-btn",onClick:k,disabled:u,children:[s.jsx(y,{})," Connect Spotify"]}),s.jsxs("div",{className:"spotify-features",children:[s.jsxs("div",{className:"feature-item",children:[s.jsx(d,{className:"check-icon"}),s.jsx("span",{children:"Show currently playing track"})]}),s.jsxs("div",{className:"feature-item",children:[s.jsx(d,{className:"check-icon"}),s.jsx("span",{children:"Display in your status"})]}),s.jsxs("div",{className:"feature-item",children:[s.jsx(d,{className:"check-icon"}),s.jsx("span",{children:"Privacy controls"})]})]})]})]})}i(E,"SpotifyIntegrationPanel");export{E as default};
