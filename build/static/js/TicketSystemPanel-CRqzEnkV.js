import{r as l,ch as c}from"./react-core-B6hadH-M.js";import{g as M,h as I}from"./index-D_6pZib5.js";const U=({serverId:i,onClose:h})=>{const s=M(),[k,b]=l.useState([]),[_,S]=l.useState(!0),[a,o]=l.useState({enabled:!1,category_id:"",support_role_id:"",max_tickets_per_user:3,auto_close_after:48,transcript_channel_id:"",welcome_message:"Merhaba! Destek ekibimiz en kÄ±sa sÃ¼rede size yardÄ±mcÄ± olacak."}),[w,T]=l.useState([]),[$,C]=l.useState([]),[x,A]=l.useState([]),[n,m]=l.useState(null),[g,E]=l.useState("");l.useEffect(()=>{B(),u(),z(),j(),O()},[i]);const B=async()=>{try{const e=await fetch(`${s}/tickets/server/${i}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();o(t)}}catch(e){console.error("Error fetching config:",e)}},u=async()=>{try{const e=await fetch(`${s}/tickets/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();b(t)}}catch(e){console.error("Error fetching tickets:",e)}finally{S(!1)}},z=async()=>{try{const e=await fetch(`${s}/channels/server/${i}/categories/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();T(t)}}catch(e){console.error("Error fetching categories:",e)}},j=async()=>{try{const e=await fetch(`${s}/roles/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();C(t)}}catch(e){console.error("Error fetching roles:",e)}},O=async()=>{try{const e=await fetch(`${s}/channels/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();A(t.filter(r=>r.type==="text"))}}catch(e){console.error("Error fetching channels:",e)}},P=async()=>{try{(await fetch(`${s}/tickets/server/${i}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?c.success("âœ… Ayarlar gÃ¼ncellendi"):c.error("âŒ Ayarlar gÃ¼ncellenemedi")}catch(e){console.error("Error updating config:",e),c.error("âŒ BaÄŸlantÄ± hatasÄ±")}},R=async e=>{if(await I("Ticket'Ä± kapatmak istediÄŸinize emin misiniz?"))try{(await fetch(`${s}/tickets/${e}/close/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok?(c.success("âœ… Ticket kapatÄ±ldÄ±"),u(),n?.id===e&&m(null)):c.error("âŒ Ticket kapatÄ±lamadÄ±")}catch(t){console.error("Error closing ticket:",t),c.error("âŒ BaÄŸlantÄ± hatasÄ±")}},K=async(e,t)=>{try{(await fetch(`${s}/tickets/${e}/priority/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({priority:t})})).ok?(c.success("âœ… Ã–ncelik gÃ¼ncellendi"),u()):c.error("âŒ Ã–ncelik gÃ¼ncellenemedi")}catch(r){console.error("Error setting priority:",r),c.error("âŒ BaÄŸlantÄ± hatasÄ±")}},f=async()=>{if(g.trim())try{const e=await fetch(`${s}/tickets/${n.id}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({message:g})});if(e.ok){const t=await e.json();m({...n,messages:[...n.messages||[],t.message]}),E(""),c.success("âœ… Mesaj gÃ¶nderildi")}else c.error("âŒ Mesaj gÃ¶nderilemedi")}catch(e){console.error("Error sending message:",e),c.error("âŒ BaÄŸlantÄ± hatasÄ±")}},D=async e=>{try{const t=await fetch(`${s}/tickets/${e}/transcript/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(t.ok){const r=await t.blob(),p=window.URL.createObjectURL(r),d=document.createElement("a");d.href=p,d.download=`ticket-${e}-transcript.txt`,d.click(),c.success("âœ… Transcript indirildi")}else c.error("âŒ Transcript indirilemedi")}catch(t){console.error("Error exporting transcript:",t),c.error("âŒ BaÄŸlantÄ± hatasÄ±")}},y=e=>{const t={open:{text:"AÃ§Ä±k",color:"#10b981"},assigned:{text:"AtandÄ±",color:"#f59e0b"},closed:{text:"KapalÄ±",color:"#6b7280"}};return t[e]||t.open},N=e=>{const t={low:{text:"DÃ¼ÅŸÃ¼k",color:"#10b981"},medium:{text:"Orta",color:"#f59e0b"},high:{text:"YÃ¼ksek",color:"#ef4444"},urgent:{text:"Acil",color:"#dc2626"}};return t[e]||t.medium},v=e=>{const t=new Date(e);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)};return React.createElement("div",{className:"ticket-panel-overlay",onClick:h},React.createElement("div",{className:"ticket-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"ticket-header"},React.createElement("h2",null,"ðŸŽ« Destek Sistemi"),React.createElement("button",{className:"close-btn",onClick:h},"Ã—")),React.createElement("div",{className:"ticket-content"},React.createElement("div",{className:"ticket-config-section"},React.createElement("h3",null,"âš™ï¸ Sistem AyarlarÄ±"),React.createElement("div",{className:"config-grid"},React.createElement("div",{className:"config-item"},React.createElement("label",{className:"toggle-label"},React.createElement("input",{type:"checkbox",checked:a.enabled,onChange:e=>o({...a,enabled:e.target.checked})}),React.createElement("span",{className:"toggle-switch"}),React.createElement("span",{className:"toggle-text"},"Ticket Sistemi Aktif"))),React.createElement("div",{className:"config-item"},React.createElement("label",null,"Ticket Kategorisi"),React.createElement("select",{value:a.category_id,onChange:e=>o({...a,category_id:e.target.value})},React.createElement("option",{value:""},"Kategori SeÃ§in"),w.map(e=>React.createElement("option",{key:e.id,value:e.id},e.name)))),React.createElement("div",{className:"config-item"},React.createElement("label",null,"Destek RolÃ¼"),React.createElement("select",{value:a.support_role_id,onChange:e=>o({...a,support_role_id:e.target.value})},React.createElement("option",{value:""},"Rol SeÃ§in"),$.map(e=>React.createElement("option",{key:e.id,value:e.id},e.name)))),React.createElement("div",{className:"config-item"},React.createElement("label",null,"KullanÄ±cÄ± BaÅŸÄ±na Max Ticket"),React.createElement("input",{type:"number",min:"1",max:"10",value:a.max_tickets_per_user,onChange:e=>o({...a,max_tickets_per_user:parseInt(e.target.value)})})),React.createElement("div",{className:"config-item"},React.createElement("label",null,"Otomatik Kapanma (Saat)"),React.createElement("input",{type:"number",min:"1",max:"168",value:a.auto_close_after,onChange:e=>o({...a,auto_close_after:parseInt(e.target.value)})})),React.createElement("div",{className:"config-item"},React.createElement("label",null,"Transcript KanalÄ±"),React.createElement("select",{value:a.transcript_channel_id,onChange:e=>o({...a,transcript_channel_id:e.target.value})},React.createElement("option",{value:""},"Kanal SeÃ§in (Opsiyonel)"),x.map(e=>React.createElement("option",{key:e.id,value:e.id},"# ",e.name)))),React.createElement("div",{className:"config-item full-width"},React.createElement("label",null,"HoÅŸ Geldin MesajÄ±"),React.createElement("textarea",{value:a.welcome_message,onChange:e=>o({...a,welcome_message:e.target.value}),rows:"3"}))),React.createElement("button",{className:"save-config-btn",onClick:P},"ðŸ’¾ AyarlarÄ± Kaydet")),React.createElement("div",{className:"tickets-section"},React.createElement("h3",null,"ðŸ“‹ Aktif Ticket'lar"),_?React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"Ticket'lar yÃ¼kleniyor...")):k.length===0?React.createElement("div",{className:"empty-state"},React.createElement("span",{className:"empty-icon"},"ðŸŽ«"),React.createElement("p",null,"HenÃ¼z ticket yok"),React.createElement("span",{className:"empty-hint"},"KullanÄ±cÄ±lar ticket oluÅŸturduÄŸunda burada gÃ¶rÃ¼necek")):React.createElement("div",{className:"tickets-grid"},k.map(e=>React.createElement("div",{key:e.id,className:"ticket-card",onClick:()=>m(e)},React.createElement("div",{className:"ticket-card-header"},React.createElement("div",{className:"ticket-info"},React.createElement("span",{className:"ticket-id"},"#",e.id),React.createElement("h4",null,e.subject||"Destek Talebi")),React.createElement("div",{className:"ticket-badges"},React.createElement("span",{className:"status-badge",style:{background:y(e.status).color}},y(e.status).text),React.createElement("span",{className:"priority-badge",style:{background:N(e.priority).color}},N(e.priority).text))),React.createElement("div",{className:"ticket-meta"},React.createElement("div",{className:"meta-item"},React.createElement("span",{className:"meta-label"},"OluÅŸturan:"),React.createElement("span",{className:"meta-value"},e.creator_username)),e.assigned_to&&React.createElement("div",{className:"meta-item"},React.createElement("span",{className:"meta-label"},"Atanan:"),React.createElement("span",{className:"meta-value"},e.assigned_to_username)),React.createElement("div",{className:"meta-item"},React.createElement("span",{className:"meta-label"},"OluÅŸturulma:"),React.createElement("span",{className:"meta-value"},v(e.created_at)))),React.createElement("div",{className:"ticket-actions-quick"},React.createElement("button",{className:"priority-btn",onClick:t=>{t.stopPropagation();const r=["low","medium","high","urgent"],p=r.indexOf(e.priority),d=r[(p+1)%r.length];K(e.id,d)}},"ðŸ·ï¸ Ã–ncelik"),React.createElement("button",{className:"close-ticket-btn",onClick:t=>{t.stopPropagation(),R(e.id)}},"âœ“ Kapat"))))))),n&&React.createElement("div",{className:"ticket-detail-modal",onClick:()=>m(null)},React.createElement("div",{className:"ticket-detail-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"detail-header"},React.createElement("div",null,React.createElement("span",{className:"ticket-id-large"},"#",n.id),React.createElement("h3",null,n.subject||"Destek Talebi")),React.createElement("button",{className:"close-btn",onClick:()=>m(null)},"Ã—")),React.createElement("div",{className:"detail-body"},React.createElement("div",{className:"messages-container"},n.messages?.map((e,t)=>React.createElement("div",{key:t,className:"message-item"},React.createElement("div",{className:"message-author"},React.createElement("span",{className:"author-name"},e.author),React.createElement("span",{className:"message-time"},v(e.created_at))),React.createElement("div",{className:"message-content"},e.content)))),React.createElement("div",{className:"message-input-container"},React.createElement("input",{type:"text",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:g,onChange:e=>E(e.target.value),onKeyPress:e=>e.key==="Enter"&&f()}),React.createElement("button",{className:"send-btn",onClick:f},"ðŸ“¤ GÃ¶nder"))),React.createElement("div",{className:"detail-footer"},React.createElement("button",{className:"export-btn",onClick:()=>D(n.id)},"ðŸ“„ Transcript Ä°ndir"),React.createElement("button",{className:"close-ticket-btn-large",onClick:()=>R(n.id)},"âœ“ Ticket'Ä± Kapat"))))))};export{U as default};
