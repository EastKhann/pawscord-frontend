import{r as o,aD as A,l as M,w as P,aU as H,aX as J,A as Y,n as K,h as G}from"./react-core-B6hadH-M.js";import{t as s}from"./index-D_6pZib5.js";const q=({onClose:d,server:r,fetchWithAuth:l,apiBaseUrl:c,currentUser:g})=>{const[y,_]=o.useState([]),[z,b]=o.useState(!1),[m,F]=o.useState(""),[j,v]=o.useState(new Set),[p,k]=o.useState(""),[h,R]=o.useState(!1),[S,x]=o.useState(!0),[u,E]=o.useState(!1),w=o.useRef(null);o.useEffect(()=>{D(),C(),setTimeout(()=>w.current?.focus(),100)},[]);const C=async()=>{if(!r?.id){x(!1);return}x(!0);try{const e=await l(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:r.id,max_uses:0,expires_in_hours:0})});if(e.ok){const n=await e.json(),a=n.url||n.invite_link||`https://www.pawscord.com/#/invite/${n.code}`;k(a)}else{const n=await e.json().catch(()=>({}));console.error("[InviteModal] Create failed:",n)}}catch(e){console.error("[InviteModal] Create error:",e)}finally{x(!1)}},B=async()=>{if(r?.id){E(!0);try{const e=await l(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:r.id,max_uses:0,expires_in_hours:0})});if(e.ok){const n=await e.json(),a=n.url||n.invite_link||`https://www.pawscord.com/#/invite/${n.code}`;k(a),s.success("ğŸ”— Yeni davet linki oluÅŸturuldu!")}else s.error("Link oluÅŸturulamadÄ±")}catch(e){s.error("Link oluÅŸturulurken hata: "+e.message)}finally{E(!1)}}},D=async()=>{b(!0);try{const e=await l(`${c}/friends/list/`);if(e.ok){const n=await e.json(),a=Array.isArray(n)?n:n.friends||[];_(a)}}catch(e){console.error("ArkadaÅŸ listesi hatasÄ±:",e)}finally{b(!1)}},O=async e=>{v(n=>new Set(n).add(e));try{let n=p;if(!n){const L=await l(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:r.id,max_uses:1,expires_in_hours:24})});if(!L.ok)throw new Error("Davet oluÅŸturulamadÄ±");const T=await L.json();n=T.url||T.invite_link}const a=await l(`${c}/conversations/find_or_create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_username:e})});if(!a.ok)throw new Error("DM oluÅŸturulamadÄ±");const i=await a.json();(await l(`${c}/messages/send_dm/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:i.conversation_id,content:`Hey! Seni **${r?.name||"sunucu"}** sunucusuna davet ediyorum! ğŸ‰
${n}`})})).ok?s.success(`âœ… ${e} kullanÄ±cÄ±sÄ±na davet gÃ¶nderildi!`):(navigator.clipboard.writeText(n),s.success(`Link kopyalandÄ±! ${e} ile paylaÅŸabilirsiniz.`))}catch(n){v(a=>{const i=new Set(a);return i.delete(e),i}),s.error("Davet gÃ¶nderilemedi: "+n.message)}},f=e=>g?e.sender_username===g?e.receiver_username:e.sender_username:e.receiver_username,N=e=>{const n=f(e);return e.sender_username===n?e.sender_avatar:e.receiver_avatar},I=y.filter(e=>f(e)?.toLowerCase().includes(m.toLowerCase())),$=()=>{navigator.clipboard.writeText(p),R(!0),s.success("ğŸ“‹ Davet linki kopyalandÄ±!"),setTimeout(()=>R(!1),2e3)},W=React.createElement("div",{style:t.overlay,onClick:d},React.createElement("div",{style:t.modal,onClick:e=>e.stopPropagation()},React.createElement("div",{style:t.header},React.createElement("div",null,React.createElement("div",{style:t.headerRow},React.createElement(A,{style:{color:"#b5bac1",fontSize:"14px"}}),React.createElement("span",{style:t.serverLabel},r?.name||"Sunucu")),React.createElement("h2",{style:t.title},"ArkadaÅŸlarÄ±nÄ± Davet Et")),React.createElement("button",{onClick:d,style:t.closeBtn},React.createElement(M,null))),React.createElement("div",{style:t.searchWrap},React.createElement("div",{style:t.searchBox},React.createElement(P,{style:t.searchIcon}),React.createElement("input",{ref:w,type:"text",placeholder:"ArkadaÅŸ ara...",style:t.searchInput,value:m,onChange:e=>F(e.target.value)}))),React.createElement("div",{style:t.friendList},z?React.createElement("div",{style:t.emptyState},React.createElement("div",{style:t.spinner}),React.createElement("span",{style:t.emptyText},"YÃ¼kleniyor...")):I.length===0?React.createElement("div",{style:t.emptyState},React.createElement(H,{style:{fontSize:"32px",color:"#4e5058",marginBottom:"8px"}}),React.createElement("span",{style:t.emptyText},m?"SonuÃ§ bulunamadÄ±.":y.length===0?"HenÃ¼z arkadaÅŸÄ±n yok.":"EÅŸleÅŸen arkadaÅŸ yok.")):I.map(e=>{const n=f(e),a=N(e),i=j.has(n);return React.createElement("div",{key:e.id,style:t.friendItem,className:"invite-friend-item"},React.createElement("div",{style:t.friendInfo},React.createElement("div",{style:t.friendAvatar},a?React.createElement("img",{src:a,alt:n,style:t.avatarImg}):React.createElement("span",{style:t.avatarLetter},n?.charAt(0).toUpperCase())),React.createElement("span",{style:t.friendName},n)),React.createElement("button",{onClick:()=>!i&&O(n),style:{...t.inviteBtn,...i?t.inviteBtnSent:{}},disabled:i},i?React.createElement(React.Fragment,null,React.createElement(J,{style:{marginRight:"4px"}})," GÃ¶nderildi"):"Davet Et"))})),React.createElement("div",{style:t.linkSection},React.createElement("div",{style:t.linkLabel},"VEYA BÄ°R SUNUCU DAVET LÄ°NKÄ° GÃ–NDER"),React.createElement("div",{style:t.linkBox},S?React.createElement("div",{style:t.linkLoading},React.createElement("div",{style:t.spinner}),React.createElement("span",{style:{color:"#b5bac1",fontSize:"13px"}},"Link hazÄ±rlanÄ±yor...")):p?React.createElement(React.Fragment,null,React.createElement("div",{style:t.linkInputWrap},React.createElement(Y,{style:{color:"#b5bac1",marginRight:"8px",flexShrink:0}}),React.createElement("input",{type:"text",value:p,readOnly:!0,style:t.linkInput,onClick:e=>e.target.select()})),React.createElement("button",{onClick:$,style:{...t.copyBtn,...h?t.copyBtnDone:{}}},h?"KopyalandÄ±!":"Kopyala")):React.createElement("div",{style:t.linkError},React.createElement("span",{style:{color:"#f0b232",fontSize:"13px"}},"Link oluÅŸturulamadÄ±"),React.createElement("button",{onClick:C,style:t.retryBtn},"Tekrar Dene"))),p&&!S&&React.createElement("button",{onClick:B,disabled:u,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",color:"#b5bac1",padding:"6px 12px",borderRadius:"4px",cursor:u?"wait":"pointer",fontSize:"12px",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.15s"},onMouseEnter:e=>{e.target.style.background="rgba(255,255,255,0.06)",e.target.style.color="#fff"},onMouseLeave:e=>{e.target.style.background="transparent",e.target.style.color="#b5bac1"}},React.createElement(K,{style:{fontSize:"11px",animation:u?"inviteSpin 1s linear infinite":"none"}}),u?"OluÅŸturuluyor...":"Yeni Link OluÅŸtur"),React.createElement("div",{style:t.linkNote},"Bu davet linki sÃ¼resiz geÃ§erli ve sÄ±nÄ±rsÄ±z kullanÄ±mlÄ±."))));return G.createPortal(W,document.body)};if(typeof document<"u"){const d="invite-modal-styles";if(!document.getElementById(d)){const r=document.createElement("style");r.id=d,r.textContent=`
            .invite-friend-item:hover { background: rgba(88, 101, 242, 0.06) !important; }
            @keyframes inviteSpin { to { transform: rotate(360deg); } }
        `,document.head.appendChild(r)}}const t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,backdropFilter:"blur(4px)"},modal:{backgroundColor:"#313338",borderRadius:"12px",width:"460px",maxWidth:"92vw",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 16px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04)",overflow:"hidden",animation:"contextMenuIn 0.15s ease-out"},header:{padding:"20px 20px 8px 20px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerRow:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"},serverLabel:{color:"#b5bac1",fontSize:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.02em"},title:{margin:0,color:"#f2f3f5",fontSize:"18px",fontWeight:"700"},closeBtn:{background:"none",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"18px",padding:"4px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center"},searchWrap:{padding:"8px 20px 4px 20px"},searchBox:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"0 12px",display:"flex",alignItems:"center"},searchIcon:{color:"#6d6f78",marginRight:"10px",fontSize:"14px",flexShrink:0},searchInput:{backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px 0",flex:1,outline:"none",fontSize:"14px"},friendList:{flex:1,overflowY:"auto",padding:"8px 12px",minHeight:"120px",maxHeight:"280px"},friendItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderRadius:"8px",transition:"background 0.15s",cursor:"default"},friendInfo:{display:"flex",alignItems:"center",gap:"12px",minWidth:0},friendAvatar:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",flexShrink:0},avatarImg:{width:"100%",height:"100%",objectFit:"cover"},avatarLetter:{color:"#fff",fontSize:"15px",fontWeight:"600"},friendName:{color:"#f2f3f5",fontSize:"14px",fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},inviteBtn:{padding:"6px 16px",backgroundColor:"transparent",border:"1px solid #248046",color:"#2dc770",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s",whiteSpace:"nowrap",display:"flex",alignItems:"center",flexShrink:0},inviteBtnSent:{border:"1px solid #4e5058",color:"#b5bac1",cursor:"default",backgroundColor:"transparent"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 20px",gap:"4px"},emptyText:{color:"#6d6f78",fontSize:"14px",textAlign:"center"},spinner:{width:"20px",height:"20px",border:"2px solid #4e5058",borderTopColor:"#5865f2",borderRadius:"50%",animation:"inviteSpin 0.6s linear infinite"},linkSection:{backgroundColor:"#2b2d31",padding:"16px 20px",borderTop:"1px solid rgba(255,255,255,0.04)"},linkLabel:{color:"#b5bac1",fontSize:"11px",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.02em",marginBottom:"10px"},linkBox:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"#1e1f22",borderRadius:"8px",padding:"4px 4px 4px 12px",minHeight:"44px"},linkInputWrap:{display:"flex",alignItems:"center",flex:1,minWidth:0},linkInput:{flex:1,backgroundColor:"transparent",border:"none",color:"#00a8fc",fontSize:"13px",outline:"none",textOverflow:"ellipsis",minWidth:0},linkLoading:{display:"flex",alignItems:"center",gap:"10px",flex:1,padding:"4px 0"},linkError:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,padding:"4px 0"},copyBtn:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background 0.15s",whiteSpace:"nowrap",flexShrink:0},copyBtnDone:{backgroundColor:"#248046"},retryBtn:{padding:"6px 12px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:"500"},linkNote:{color:"#6d6f78",fontSize:"11px",marginTop:"8px"}};export{q as default};
