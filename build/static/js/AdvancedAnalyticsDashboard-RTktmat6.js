import{r as n,d as e,ad as I,dE as ee,aN as ae,i as te,G as w,ar as le,bk as T,U as V,bq as se,cd as ce,cl as ne,ay as re,v as me,bW as ie,bX as oe,cT as de}from"./react-core-DrOm_csO.js";import{t as $}from"./index-BYhWpPLp.js";const ve=({serverId:r,apiBaseUrl:o,onClose:h})=>{const[s,O]=n.useState("7d"),[P,S]=n.useState(!0),[A,_]=n.useState(!1),[m,H]=n.useState({total_members:0,active_members:0,messages_count:0,voice_minutes:0,member_growth:0,message_growth:0}),[k,z]=n.useState([]),[y,K]=n.useState([]),[u,q]=n.useState([]),[g,J]=n.useState([]),[v,W]=n.useState([]),[p,X]=n.useState([]),[R,Y]=n.useState([]),[F,Q]=n.useState([]);n.useEffect(()=>{j()},[r,s]);const j=async()=>{S(!0);try{const t={Authorization:`Bearer ${localStorage.getItem("access_token")}`},[l,c,E,i,N,M,G,L,D]=await Promise.all([fetch(`${o}/analytics/${r}/overview/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/member-activity/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/message-activity/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/top-channels/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/top-members/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/geo/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/reactions/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/link-clicks/?range=${s}`,{headers:t}),fetch(`${o}/analytics/${r}/peak-hours/?range=${s}`,{headers:t})]);l.ok&&H(await l.json()),c.ok&&z((await c.json()).data||[]),E.ok&&K((await E.json()).data||[]),i.ok&&q((await i.json()).channels||[]),N.ok&&J((await N.json()).members||[]),M.ok&&W((await M.json()).data||[]),G.ok&&X((await G.json()).reactions||[]),L.ok&&Y((await L.json()).links||[]),D.ok&&Q((await D.json()).hours||[])}catch(a){console.error("Fetch analytics error:",a),$.error("âŒ Analitik verileri yÃ¼klenemedi")}finally{S(!1)}},U=async()=>{_(!0),await j(),_(!1),$.success("ðŸ”„ Veriler gÃ¼ncellendi")},Z=()=>{const a={exported_at:new Date().toISOString(),time_range:s,overview:m,memberActivity:k,messageActivity:y,topChannels:u,topMembers:g,geoData:v,reactionStats:p},t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),c=document.createElement("a");c.href=l,c.download=`analytics_${r}_${s}.json`,c.click(),URL.revokeObjectURL(l),$.success("ðŸ“¥ Analitik verileri indirildi")},d=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString(),C=a=>a>0?{icon:ie,color:"#23a559",text:`+${a}%`}:a<0?{icon:oe,color:"#da373c",text:`${a}%`}:{icon:de,color:"#72767d",text:"0%"},x=(a,t="#5865f2",l=60)=>{if(!a||a.length===0)return null;const c=Math.max(...a.map(i=>i.value)),E=100/a.length;return e.createElement("div",{className:"simple-chart",style:{height:l}},a.map((i,N)=>e.createElement("div",{key:N,className:"chart-bar",style:{width:`${E}%`,height:`${i.value/c*100}%`,background:t},title:`${i.label}: ${i.value}`})))},B=()=>{const a=Array(24).fill(0).map((l,c)=>{const E=F.find(i=>i.hour===c);return{hour:c,value:E?.value||0}}),t=Math.max(...a.map(l=>l.value));return e.createElement("div",{className:"peak-hours-chart"},a.map((l,c)=>e.createElement("div",{key:c,className:"hour-bar",style:{height:`${t>0?l.value/t*100:0}%`,background:l.value>t*.8?"#23a559":l.value>t*.5?"#5865f2":"#3f4147"},title:`${l.hour}:00 - ${l.value} mesaj`},e.createElement("span",{className:"hour-label"},l.hour))))};if(P)return e.createElement("div",{className:"analytics-overlay",onClick:h},e.createElement("div",{className:"analytics-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"Analitik verileri yÃ¼kleniyor..."))));const b=C(m.member_growth),f=C(m.message_growth);return e.createElement("div",{className:"analytics-overlay",onClick:h},e.createElement("div",{className:"analytics-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"analytics-header"},e.createElement("h2",null,e.createElement(I,null)," GeliÅŸmiÅŸ Analitik"),e.createElement("div",{className:"header-controls"},e.createElement("div",{className:"time-range-selector"},["24h","7d","30d","90d"].map(a=>e.createElement("button",{key:a,className:`range-btn ${s===a?"active":""}`,onClick:()=>O(a)},a==="24h"?"24 Saat":a==="7d"?"7 GÃ¼n":a==="30d"?"30 GÃ¼n":"90 GÃ¼n"))),e.createElement("button",{className:"action-btn",onClick:U,disabled:A},e.createElement(ee,{className:A?"spinning":""})),e.createElement("button",{className:"action-btn",onClick:Z},e.createElement(ae,null))),e.createElement("button",{className:"close-btn",onClick:h},e.createElement(te,null))),e.createElement("div",{className:"analytics-content"},e.createElement("div",{className:"overview-section"},e.createElement("div",{className:"overview-card"},e.createElement("div",{className:"card-icon members"},e.createElement(w,null)),e.createElement("div",{className:"card-content"},e.createElement("span",{className:"card-value"},d(m.total_members)),e.createElement("span",{className:"card-label"},"Toplam Ãœye"),e.createElement("span",{className:"card-growth",style:{color:b.color}},e.createElement(b.icon,null)," ",b.text))),e.createElement("div",{className:"overview-card"},e.createElement("div",{className:"card-icon active"},e.createElement(le,null)),e.createElement("div",{className:"card-content"},e.createElement("span",{className:"card-value"},d(m.active_members)),e.createElement("span",{className:"card-label"},"Aktif Ãœye"),e.createElement("span",{className:"card-detail"},(m.active_members/m.total_members*100||0).toFixed(1),"% aktiflik"))),e.createElement("div",{className:"overview-card"},e.createElement("div",{className:"card-icon messages"},e.createElement(T,null)),e.createElement("div",{className:"card-content"},e.createElement("span",{className:"card-value"},d(m.messages_count)),e.createElement("span",{className:"card-label"},"Mesaj"),e.createElement("span",{className:"card-growth",style:{color:f.color}},e.createElement(f.icon,null)," ",f.text))),e.createElement("div",{className:"overview-card"},e.createElement("div",{className:"card-icon voice"},e.createElement(V,null)),e.createElement("div",{className:"card-content"},e.createElement("span",{className:"card-value"},d(m.voice_minutes)),e.createElement("span",{className:"card-label"},"Sesli Dakika"),e.createElement("span",{className:"card-detail"},Math.round(m.voice_minutes/60)," saat")))),e.createElement("div",{className:"charts-grid"},e.createElement("div",{className:"chart-card"},e.createElement("div",{className:"chart-header"},e.createElement("h3",null,e.createElement(w,null)," Ãœye Aktivitesi")),e.createElement("div",{className:"chart-body"},k.length>0?x(k,"#5865f2",120):e.createElement("div",{className:"no-data"},"Veri yok"))),e.createElement("div",{className:"chart-card"},e.createElement("div",{className:"chart-header"},e.createElement("h3",null,e.createElement(T,null)," Mesaj Aktivitesi")),e.createElement("div",{className:"chart-body"},y.length>0?x(y,"#23a559",120):e.createElement("div",{className:"no-data"},"Veri yok"))),e.createElement("div",{className:"chart-card wide"},e.createElement("div",{className:"chart-header"},e.createElement("h3",null,e.createElement(V,null)," YoÄŸunluk Saatleri"),e.createElement("span",{className:"chart-info"},e.createElement(se,null)," En yoÄŸun saatler yeÅŸil ile gÃ¶sterilir")),e.createElement("div",{className:"chart-body"},F.length>0?B():e.createElement("div",{className:"no-data"},"Veri yok")))),e.createElement("div",{className:"lists-grid"},e.createElement("div",{className:"list-card"},e.createElement("div",{className:"list-header"},e.createElement("h3",null,e.createElement(ce,null)," En Aktif Kanallar")),e.createElement("div",{className:"list-body"},u.length>0?u.map((a,t)=>e.createElement("div",{key:a.id,className:"list-item"},e.createElement("span",{className:"rank"},t+1),e.createElement("span",{className:"name"},"# ",a.name),e.createElement("div",{className:"bar-container"},e.createElement("div",{className:"bar",style:{width:`${a.messages/u[0].messages*100}%`}})),e.createElement("span",{className:"value"},d(a.messages)))):e.createElement("div",{className:"no-data"},"Veri yok"))),e.createElement("div",{className:"list-card"},e.createElement("div",{className:"list-header"},e.createElement("h3",null,e.createElement(w,null)," En Aktif Ãœyeler")),e.createElement("div",{className:"list-body"},g.length>0?g.map((a,t)=>e.createElement("div",{key:a.id,className:"list-item"},e.createElement("span",{className:"rank"},t+1),e.createElement("img",{src:a.avatar||"/default-avatar.png",alt:a.username,className:"avatar"}),e.createElement("span",{className:"name"},a.username),e.createElement("span",{className:"value"},d(a.messages)," mesaj"))):e.createElement("div",{className:"no-data"},"Veri yok"))),e.createElement("div",{className:"list-card"},e.createElement("div",{className:"list-header"},e.createElement("h3",null,e.createElement(ne,null)," En Ã‡ok KullanÄ±lan Reaksiyonlar")),e.createElement("div",{className:"list-body"},p.length>0?e.createElement("div",{className:"reactions-grid"},p.map((a,t)=>e.createElement("div",{key:t,className:"reaction-item"},e.createElement("span",{className:"emoji"},a.emoji),e.createElement("span",{className:"count"},d(a.count))))):e.createElement("div",{className:"no-data"},"Veri yok"))),e.createElement("div",{className:"list-card"},e.createElement("div",{className:"list-header"},e.createElement("h3",null,e.createElement(re,null)," CoÄŸrafi DaÄŸÄ±lÄ±m")),e.createElement("div",{className:"list-body"},v.length>0?v.map((a,t)=>e.createElement("div",{key:t,className:"list-item"},e.createElement("span",{className:"flag"},a.flag||"ðŸŒ"),e.createElement("span",{className:"name"},a.country),e.createElement("div",{className:"bar-container"},e.createElement("div",{className:"bar geo",style:{width:`${a.count/v[0].count*100}%`}})),e.createElement("span",{className:"value"},a.percentage,"%"))):e.createElement("div",{className:"no-data"},"Veri yok")))),R.length>0&&e.createElement("div",{className:"links-section"},e.createElement("h3",null,e.createElement(me,null)," Link TÄ±klamalarÄ±"),e.createElement("div",{className:"links-table"},e.createElement("div",{className:"table-header"},e.createElement("span",null,"URL"),e.createElement("span",null,"TÄ±klama"),e.createElement("span",null,"Benzersiz")),R.map((a,t)=>e.createElement("div",{key:t,className:"table-row"},e.createElement("span",{className:"link-url",title:a.url},a.url.length>50?a.url.substring(0,50)+"...":a.url),e.createElement("span",null,d(a.clicks)),e.createElement("span",null,d(a.unique_clicks)))))))))};export{ve as default};
