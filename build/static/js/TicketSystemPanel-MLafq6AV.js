var D=Object.defineProperty;var t=(i,n)=>D(i,"name",{value:n,configurable:!0});import{r as p,j as e}from"./react-core-Djgtqrmb.js";import{y as o}from"./ui-vendor-IhB9Znpc.js";import{e as M,g as A}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const K=t(i=>{const n=A(),s=t(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),"authHeader"),[r,m]=p.useState([]),[h,c]=p.useState(!0),[x,d]=p.useState({enabled:!1,category_id:"",support_role_id:"",max_tickets_per_user:3,auto_close_after:48,transcript_channel_id:"",welcome_message:"Merhaba! Destek ekibimiz en kÄ±sa sÃ¼rede size yardÄ±mcÄ± olacak."}),[k,b]=p.useState([]),[T,_]=p.useState([]),[w,S]=p.useState([]),[u,y]=p.useState(null),[f,v]=p.useState(""),C=t(async()=>{try{const a=await fetch(`${n}/tickets/server/${i}/config/`,{headers:s()});a.ok&&d(await a.json())}catch{}},"fetchConfig"),j=t(async()=>{try{const a=await fetch(`${n}/tickets/server/${i}/`,{headers:s()});a.ok&&m(await a.json())}catch{}finally{c(!1)}},"fetchTickets"),$=t(async()=>{try{const a=await fetch(`${n}/channels/server/${i}/categories/`,{headers:s()});a.ok&&b(await a.json())}catch{}},"fetchCategories"),B=t(async()=>{try{const a=await fetch(`${n}/roles/server/${i}/`,{headers:s()});a.ok&&_(await a.json())}catch{}},"fetchRoles"),P=t(async()=>{try{const a=await fetch(`${n}/channels/server/${i}/`,{headers:s()});if(a.ok){const l=await a.json();S(l.filter(g=>g.type==="text"))}}catch{}},"fetchChannels");return p.useEffect(()=>{C(),j(),$(),B(),P()},[i]),{tickets:r,loading:h,config:x,setConfig:d,categories:k,roles:T,channels:w,selectedTicket:u,setSelectedTicket:y,newMessage:f,setNewMessage:v,updateConfig:t(async()=>{try{(await fetch(`${n}/tickets/server/${i}/config/update/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify(x)})).ok?o.success("âœ… Ayarlar gÃ¼ncellendi"):o.error("âŒ Ayarlar gÃ¼ncellenemedi")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"updateConfig"),closeTicket:t(async a=>{if(await M("Ticket'Ä± kapatmak istediÄŸinize emin misiniz?"))try{(await fetch(`${n}/tickets/${a}/close/`,{method:"POST",headers:s()})).ok?(o.success("âœ… Ticket kapatÄ±ldÄ±"),j(),u?.id===a&&y(null)):o.error("âŒ Ticket kapatÄ±lamadÄ±")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"closeTicket"),assignTicket:t(async(a,l)=>{try{(await fetch(`${n}/tickets/${a}/assign/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({user_id:l})})).ok?(o.success("âœ… Ticket atandÄ±"),j()):o.error("âŒ Ticket atanamadÄ±")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"assignTicket"),setPriority:t(async(a,l)=>{try{(await fetch(`${n}/tickets/${a}/priority/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({priority:l})})).ok?(o.success("âœ… Ã–ncelik gÃ¼ncellendi"),j()):o.error("âŒ Ã–ncelik gÃ¼ncellenemedi")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"setPriority"),sendMessage:t(async()=>{if(f.trim())try{const a=await fetch(`${n}/tickets/${u.id}/reply/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({message:f})});if(a.ok){const l=await a.json();y({...u,messages:[...u.messages||[],l.message]}),v(""),o.success("âœ… Mesaj gÃ¶nderildi")}else o.error("âŒ Mesaj gÃ¶nderilemedi")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"sendMessage"),exportTranscript:t(async a=>{try{const l=await fetch(`${n}/tickets/${a}/transcript/`,{headers:s()});if(l.ok){const g=await l.blob(),O=window.URL.createObjectURL(g),N=document.createElement("a");N.href=O,N.download=`ticket-${a}-transcript.txt`,N.click(),o.success("âœ… Transcript indirildi")}else o.error("âŒ Transcript indirilemedi")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"exportTranscript"),getStatusBadge:t(a=>{const l={open:{text:"AÃ§Ä±k",color:"#10b981"},assigned:{text:"AtandÄ±",color:"#f59e0b"},closed:{text:"KapalÄ±",color:"#6b7280"}};return l[a]||l.open},"getStatusBadge"),getPriorityBadge:t(a=>{const l={low:{text:"DÃ¼ÅŸÃ¼k",color:"#10b981"},medium:{text:"Orta",color:"#f59e0b"},high:{text:"YÃ¼ksek",color:"#ef4444"},urgent:{text:"Acil",color:"#dc2626"}};return l[a]||l.medium},"getPriorityBadge"),formatDate:t(a=>{const l=new Date(a);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(l)},"formatDate")}},"useTicketSystem"),z=t(({config:i,setConfig:n,categories:s,roles:r,channels:m,updateConfig:h})=>e.jsxs("div",{className:"ticket-config-section",children:[e.jsxs("h3",{children:["âš™ï¸"," Sistem AyarlarÄ±"]}),e.jsxs("div",{className:"config-grid",children:[e.jsx("div",{className:"config-item",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:i.enabled,onChange:t(c=>n({...i,enabled:c.target.checked}),"onChange")}),e.jsx("span",{className:"toggle-switch"}),e.jsx("span",{className:"toggle-text",children:"Ticket Sistemi Aktif"})]})}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Ticket Kategorisi"}),e.jsxs("select",{value:i.category_id,onChange:t(c=>n({...i,category_id:c.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"Kategori SeÃ§in"}),s.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Destek RolÃ¼"}),e.jsxs("select",{value:i.support_role_id,onChange:t(c=>n({...i,support_role_id:c.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"Rol SeÃ§in"}),r.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"KullanÄ±cÄ± BaÅŸÄ±na Max Ticket"}),e.jsx("input",{type:"number",min:"1",max:"10",value:i.max_tickets_per_user,onChange:t(c=>n({...i,max_tickets_per_user:parseInt(c.target.value)}),"onChange")})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Otomatik Kapanma (Saat)"}),e.jsx("input",{type:"number",min:"1",max:"168",value:i.auto_close_after,onChange:t(c=>n({...i,auto_close_after:parseInt(c.target.value)}),"onChange")})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Transcript KanalÄ±"}),e.jsxs("select",{value:i.transcript_channel_id,onChange:t(c=>n({...i,transcript_channel_id:c.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"Kanal SeÃ§in (Opsiyonel)"}),m.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{className:"config-item full-width",children:[e.jsx("label",{children:"HoÅŸ Geldin MesajÄ±"}),e.jsx("textarea",{value:i.welcome_message,onChange:t(c=>n({...i,welcome_message:c.target.value}),"onChange"),rows:"3"})]})]}),e.jsxs("button",{className:"save-config-btn",onClick:h,children:["ðŸ’¾"," AyarlarÄ± Kaydet"]})]}),"TicketConfig"),R=t(({ticket:i,onClose:n,newMessage:s,setNewMessage:r,sendMessage:m,exportTranscript:h,closeTicket:c,formatDate:x})=>e.jsx("div",{className:"ticket-detail-modal",onClick:n,children:e.jsxs("div",{className:"ticket-detail-panel",onClick:t(d=>d.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"ticket-id-large",children:i.id}),e.jsx("h3",{children:i.subject||"Destek Talebi"})]}),e.jsx("button",{className:"close-btn",onClick:n,children:"Ã—"})]}),e.jsxs("div",{className:"detail-body",children:[e.jsx("div",{className:"messages-container",children:i.messages?.map((d,k)=>e.jsxs("div",{className:"message-item",children:[e.jsxs("div",{className:"message-author",children:[e.jsx("span",{className:"author-name",children:d.author}),e.jsx("span",{className:"message-time",children:x(d.created_at)})]}),e.jsx("div",{className:"message-content",children:d.content})]},k))}),e.jsxs("div",{className:"message-input-container",children:[e.jsx("input",{type:"text",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:s,onChange:t(d=>r(d.target.value),"onChange"),onKeyPress:t(d=>d.key==="Enter"&&m(),"onKeyPress")}),e.jsxs("button",{className:"send-btn",onClick:m,children:["ðŸ“¤"," GÃ¶nder"]})]})]}),e.jsxs("div",{className:"detail-footer",children:[e.jsxs("button",{className:"export-btn",onClick:t(()=>h(i.id),"onClick"),children:["ðŸ“„"," Transcript Ä°ndir"]}),e.jsxs("button",{className:"close-ticket-btn-large",onClick:t(()=>c(i.id),"onClick"),children:["âœ“"," Ticket'Ä± Kapat"]})]})]})}),"TicketDetail"),te=t(({serverId:i,onClose:n})=>{const s=K(i);return e.jsx("div",{className:"ticket-panel-overlay",onClick:n,children:e.jsxs("div",{className:"ticket-panel",onClick:t(r=>r.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"ticket-header",children:[e.jsxs("h2",{children:["ðŸŽ«"," Destek Sistemi"]}),e.jsx("button",{className:"close-btn",onClick:n,children:"Ã—"})]}),e.jsxs("div",{className:"ticket-content",children:[e.jsx(z,{config:s.config,setConfig:s.setConfig,categories:s.categories,roles:s.roles,channels:s.channels,updateConfig:s.updateConfig}),e.jsxs("div",{className:"tickets-section",children:[e.jsxs("h3",{children:["ðŸ“‹"," Aktif Ticket","â€™","lar"]}),s.loading?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Ticket","â€™","lar yÃ¼kleniyor..."]})]}):s.tickets.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ðŸŽ«"}),e.jsx("p",{children:"HenÃ¼z ticket yok"}),e.jsx("span",{className:"empty-hint",children:"KullanÄ±cÄ±lar ticket oluÅŸturduÄŸunda burada gÃ¶rÃ¼necek"})]}):e.jsx("div",{className:"tickets-grid",children:s.tickets.map(r=>e.jsxs("div",{className:"ticket-card",onClick:t(()=>s.setSelectedTicket(r),"onClick"),children:[e.jsxs("div",{className:"ticket-card-header",children:[e.jsxs("div",{className:"ticket-info",children:[e.jsx("span",{className:"ticket-id",children:r.id}),e.jsx("h4",{children:r.subject||"Destek Talebi"})]}),e.jsxs("div",{className:"ticket-badges",children:[e.jsx("span",{className:"status-badge",style:{background:s.getStatusBadge(r.status).color},children:s.getStatusBadge(r.status).text}),e.jsx("span",{className:"priority-badge",style:{background:s.getPriorityBadge(r.priority).color},children:s.getPriorityBadge(r.priority).text})]})]}),e.jsxs("div",{className:"ticket-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"OluÅŸturan:"}),e.jsx("span",{className:"meta-value",children:r.creator_username})]}),r.assigned_to&&e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Atanan:"}),e.jsx("span",{className:"meta-value",children:r.assigned_to_username})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"OluÅŸturulma:"}),e.jsx("span",{className:"meta-value",children:s.formatDate(r.created_at)})]})]}),e.jsxs("div",{className:"ticket-actions-quick",children:[e.jsxs("button",{className:"priority-btn",onClick:t(m=>{m.stopPropagation();const h=["low","medium","high","urgent"],c=h.indexOf(r.priority);s.setPriority(r.id,h[(c+1)%h.length])},"onClick"),children:["ðŸ·ï¸"," Ã–ncelik"]}),e.jsxs("button",{className:"close-ticket-btn",onClick:t(m=>{m.stopPropagation(),s.closeTicket(r.id)},"onClick"),children:["âœ“"," Kapat"]})]})]},r.id))})]})]}),s.selectedTicket&&e.jsx(R,{ticket:s.selectedTicket,onClose:t(()=>s.setSelectedTicket(null),"onClose"),newMessage:s.newMessage,setNewMessage:s.setNewMessage,sendMessage:s.sendMessage,exportTranscript:s.exportTranscript,closeTicket:s.closeTicket,formatDate:s.formatDate})]})})},"TicketSystemPanel");export{te as default};
