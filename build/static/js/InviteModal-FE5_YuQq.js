var P=Object.defineProperty;var o=(a,r)=>P(a,"name",{value:r,configurable:!0});import{r as c,j as e,f as H}from"./react-core-Djgtqrmb.js";import{t as A,a6 as M,a9 as J,j as Y,c as K,aF as G,a as V}from"./icons-vendor-BMXAt4pj.js";import{P as z,t as m}from"./index-D09YXCFH.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const Q=o(()=>{if(typeof document>"u")return;const a="invite-modal-styles";if(document.getElementById(a))return;const r=document.createElement("style");r.id=a,r.textContent=`
        .invite-friend-item:hover { background: rgba(88, 101, 242, 0.06) !important; }
        @keyframes inviteSpin { to { transform: rotate(360deg); } }
    `,document.head.appendChild(r)},"injectInviteStyles"),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,backdropFilter:"blur(4px)"},modal:{backgroundColor:"#313338",borderRadius:"12px",width:"460px",maxWidth:"92vw",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 16px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04)",overflow:"hidden",animation:"contextMenuIn 0.15s ease-out"},header:{padding:"20px 20px 8px 20px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerRow:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"},serverLabel:{color:"#b5bac1",fontSize:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.02em"},title:{margin:0,color:"#f2f3f5",fontSize:"18px",fontWeight:"700"},closeBtn:{background:"none",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"18px",padding:"4px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center"},searchWrap:{padding:"8px 20px 4px 20px"},searchBox:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"0 12px",display:"flex",alignItems:"center"},searchIcon:{color:"#6d6f78",marginRight:"10px",fontSize:"14px",flexShrink:0},searchInput:{backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px 0",flex:1,outline:"none",fontSize:"14px"},friendList:{flex:1,overflowY:"auto",padding:"8px 12px",minHeight:"120px",maxHeight:"280px"},friendItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderRadius:"8px",transition:"background 0.15s",cursor:"default"},friendInfo:{display:"flex",alignItems:"center",gap:"12px",minWidth:0},friendAvatar:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",flexShrink:0},avatarImg:{width:"100%",height:"100%",objectFit:"cover"},avatarLetter:{color:"#fff",fontSize:"15px",fontWeight:"600"},friendName:{color:"#f2f3f5",fontSize:"14px",fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},inviteBtn:{padding:"6px 16px",backgroundColor:"transparent",border:"1px solid #248046",color:"#2dc770",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s",whiteSpace:"nowrap",display:"flex",alignItems:"center",flexShrink:0},inviteBtnSent:{border:"1px solid #4e5058",color:"#b5bac1",cursor:"default",backgroundColor:"transparent"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 20px",gap:"4px"},emptyText:{color:"#6d6f78",fontSize:"14px",textAlign:"center"},spinner:{width:"20px",height:"20px",border:"2px solid #4e5058",borderTopColor:"#5865f2",borderRadius:"50%",animation:"inviteSpin 0.6s linear infinite"},linkSection:{backgroundColor:"#2b2d31",padding:"16px 20px",borderTop:"1px solid rgba(255,255,255,0.04)"},linkLabel:{color:"#b5bac1",fontSize:"11px",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.02em",marginBottom:"10px"},linkBox:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"#1e1f22",borderRadius:"8px",padding:"4px 4px 4px 12px",minHeight:"44px"},linkInputWrap:{display:"flex",alignItems:"center",flex:1,minWidth:0},linkInput:{flex:1,backgroundColor:"transparent",border:"none",color:"#00a8fc",fontSize:"13px",outline:"none",textOverflow:"ellipsis",minWidth:0},linkLoading:{display:"flex",alignItems:"center",gap:"10px",flex:1,padding:"4px 0"},linkError:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,padding:"4px 0"},copyBtn:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background 0.15s",whiteSpace:"nowrap",flexShrink:0},copyBtnDone:{backgroundColor:"#248046"},retryBtn:{padding:"6px 12px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:"500"},linkNote:{color:"#6d6f78",fontSize:"11px",marginTop:"8px"},regenBtn:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",color:"#b5bac1",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.15s"}},q=o(({server:a,fetchWithAuth:r,apiBaseUrl:s,currentUser:x})=>{const[p,u]=c.useState([]),[d,l]=c.useState(!1),[b,j]=c.useState(""),[g,f]=c.useState(new Set),[h,y]=c.useState(""),[F,C]=c.useState(!1),[B,S]=c.useState(!0),[O,I]=c.useState(!1),L=c.useRef(null);c.useEffect(()=>{E(),T(),setTimeout(()=>L.current?.focus(),100)},[]);const T=o(async()=>{if(!a?.id){S(!1);return}S(!0);try{const n=await r(`${s}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:0,expires_in_hours:0})});if(n.ok){const i=await n.json();y(i.url||i.invite_link||`${z}/#/invite/${i.code}`)}}catch{}finally{S(!1)}},"getOrCreatePermanentLink"),D=o(async()=>{if(a?.id){I(!0);try{const n=await r(`${s}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:0,expires_in_hours:0})});if(n.ok){const i=await n.json();y(i.url||i.invite_link||`${z}/#/invite/${i.code}`),m.success("ðŸ”— Yeni davet linki oluÅŸturuldu!")}else m.error("Link oluÅŸturulamadÄ±")}catch(n){m.error("Link oluÅŸturulurken hata: "+n.message)}finally{I(!1)}}},"regenerateLink"),E=o(async()=>{l(!0);try{const n=await r(`${s}/friends/list/`);if(n.ok){const i=await n.json();u(Array.isArray(i)?i:i.friends||[])}}catch{}finally{l(!1)}},"fetchFriends"),N=o(async n=>{f(i=>new Set(i).add(n));try{let i=h;if(!i){const _=await r(`${s}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:1,expires_in_hours:24})});if(!_.ok)throw new Error("Davet oluÅŸturulamadÄ±");const R=await _.json();i=R.url||R.invite_link}const v=await r(`${s}/conversations/find_or_create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_username:n})});if(!v.ok)throw new Error("DM oluÅŸturulamadÄ±");const k=await v.json();(await r(`${s}/messages/send_dm/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:k.conversation_id,content:`Hey! Seni **${a?.name||"sunucu"}** sunucusuna davet ediyorum! ðŸŽ‰
${i}`})})).ok?m.success(`âœ… ${n} kullanÄ±cÄ±sÄ±na davet gÃ¶nderildi!`):(navigator.clipboard.writeText(i),m.success(`Link kopyalandÄ±! ${n} ile paylaÅŸabilirsiniz.`))}catch(i){f(v=>{const k=new Set(v);return k.delete(n),k}),m.error("Davet gÃ¶nderilemedi: "+i.message)}},"sendInviteToFriend"),w=o(n=>x?n.sender_username===x?n.receiver_username:n.sender_username:n.receiver_username,"getFriendName"),$=o(n=>{const i=w(n);return n.sender_username===i?n.sender_avatar:n.receiver_avatar},"getFriendAvatar"),W=p.filter(n=>w(n)?.toLowerCase().includes(b.toLowerCase()));return{friends:p,loadingFriends:d,searchQuery:b,setSearchQuery:j,invitedUsers:g,inviteLink:h,copied:F,loadingLink:B,isRegenerating:O,searchRef:L,filteredFriends:W,getOrCreatePermanentLink:T,regenerateLink:D,sendInviteToFriend:N,getFriendName:w,getFriendAvatar:$,copyToClipboard:o(()=>{navigator.clipboard.writeText(h),C(!0),m.success("ðŸ“‹ Davet linki kopyalandÄ±!"),setTimeout(()=>C(!1),2e3)},"copyToClipboard")}},"useInviteLogic"),X=o(({searchRef:a,searchQuery:r,setSearchQuery:s,loadingFriends:x,filteredFriends:p,friends:u,getFriendName:d,getFriendAvatar:l,invitedUsers:b,sendInviteToFriend:j})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.searchWrap,children:e.jsxs("div",{style:t.searchBox,children:[e.jsx(A,{style:t.searchIcon}),e.jsx("input",{ref:a,type:"text",placeholder:"ArkadaÅŸ ara...",style:t.searchInput,value:r,onChange:o(g=>s(g.target.value),"onChange")})]})}),e.jsx("div",{style:t.friendList,children:x?e.jsxs("div",{style:t.emptyState,children:[e.jsx("div",{style:t.spinner}),e.jsx("span",{style:t.emptyText,children:"YÃ¼kleniyor..."})]}):p.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(M,{style:{fontSize:"32px",color:"#4e5058",marginBottom:"8px"}}),e.jsx("span",{style:t.emptyText,children:r?"SonuÃ§ bulunamadÄ±.":u.length===0?"HenÃ¼z arkadaÅŸÄ±n yok.":"EÅŸleÅŸen arkadaÅŸ yok."})]}):p.map(g=>{const f=d(g),h=l(g),y=b.has(f);return e.jsxs("div",{style:t.friendItem,className:"invite-friend-item",children:[e.jsxs("div",{style:t.friendInfo,children:[e.jsx("div",{style:t.friendAvatar,children:h?e.jsx("img",{src:h,alt:f,style:t.avatarImg}):e.jsx("span",{style:t.avatarLetter,children:f?.charAt(0).toUpperCase()})}),e.jsx("span",{style:t.friendName,children:f})]}),e.jsx("button",{onClick:o(()=>!y&&j(f),"onClick"),style:{...t.inviteBtn,...y?t.inviteBtnSent:{}},disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(J,{style:{marginRight:"4px"}})," GÃ¶nderildi"]}):"Davet Et"})]},g.id)})})]}),"FriendList"),Z=o(({loadingLink:a,inviteLink:r,copied:s,copyToClipboard:x,getOrCreatePermanentLink:p,regenerateLink:u,isRegenerating:d})=>e.jsxs("div",{style:t.linkSection,children:[e.jsx("div",{style:t.linkLabel,children:"VEYA BÄ°R SUNUCU DAVET LÄ°NKÄ° GÃ–NDER"}),e.jsx("div",{style:t.linkBox,children:a?e.jsxs("div",{style:t.linkLoading,children:[e.jsx("div",{style:t.spinner}),e.jsx("span",{style:{color:"#b5bac1",fontSize:"13px"},children:"Link hazÄ±rlanÄ±yor..."})]}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:t.linkInputWrap,children:[e.jsx(Y,{style:{color:"#b5bac1",marginRight:"8px",flexShrink:0}}),e.jsx("input",{type:"text",value:r,readOnly:!0,style:t.linkInput,onClick:o(l=>l.target.select(),"onClick")})]}),e.jsx("button",{onClick:x,style:{...t.copyBtn,...s?t.copyBtnDone:{}},children:s?"KopyalandÄ±!":"Kopyala"})]}):e.jsxs("div",{style:t.linkError,children:[e.jsx("span",{style:{color:"#f0b232",fontSize:"13px"},children:"Link oluÅŸturulamadÄ±"}),e.jsx("button",{onClick:p,style:t.retryBtn,children:"Tekrar Dene"})]})}),r&&!a&&e.jsxs("button",{onClick:u,disabled:d,style:{...t.regenBtn,cursor:d?"wait":"pointer"},onMouseEnter:o(l=>{l.target.style.background="rgba(255,255,255,0.06)",l.target.style.color="#fff"},"onMouseEnter"),onMouseLeave:o(l=>{l.target.style.background="transparent",l.target.style.color="#b5bac1"},"onMouseLeave"),children:[e.jsx(K,{style:{fontSize:"11px",animation:d?"inviteSpin 1s linear infinite":"none"}}),d?"OluÅŸturuluyor...":"Yeni Link OluÅŸtur"]}),e.jsx("div",{style:t.linkNote,children:"Bu davet linki sÃ¼resiz geÃ§erli ve sÄ±nÄ±rsÄ±z kullanÄ±mlÄ±."})]}),"LinkSection");Q();const ce=o(({onClose:a,server:r,fetchWithAuth:s,apiBaseUrl:x,currentUser:p})=>{const u=q({server:r,fetchWithAuth:s,apiBaseUrl:x,currentUser:p});return H.createPortal(e.jsx("div",{style:t.overlay,onClick:a,children:e.jsxs("div",{style:t.modal,onClick:o(d=>d.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{children:[e.jsxs("div",{style:t.headerRow,children:[e.jsx(G,{style:{color:"#b5bac1",fontSize:"14px"}}),e.jsx("span",{style:t.serverLabel,children:r?.name||"Sunucu"})]}),e.jsxs("h2",{style:t.title,children:["Arkada","ÅŸ","lar","Ä±","n","Ä±"," Davet Et"]})]}),e.jsx("button",{onClick:a,style:t.closeBtn,children:e.jsx(V,{})})]}),e.jsx(X,{...u}),e.jsx(Z,{...u})]})}),document.body)},"InviteModal");export{ce as default};
