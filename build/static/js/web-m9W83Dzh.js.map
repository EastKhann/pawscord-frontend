{"version":3,"file":"web-m9W83Dzh.js","sources":["../../../node_modules/@codetrix-studio/capacitor-google-auth/dist/esm/web.js"],"sourcesContent":["import { WebPlugin } from '@capacitor/core';\nexport class GoogleAuthWeb extends WebPlugin {\n    constructor() {\n        super();\n    }\n    loadScript() {\n        if (typeof document === 'undefined') {\n            return;\n        }\n        const scriptId = 'gapi';\n        const scriptEl = document === null || document === void 0 ? void 0 : document.getElementById(scriptId);\n        if (scriptEl) {\n            return;\n        }\n        const head = document.getElementsByTagName('head')[0];\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.defer = true;\n        script.async = true;\n        script.id = scriptId;\n        script.onload = this.platformJsLoaded.bind(this);\n        script.src = 'https://apis.google.com/js/platform.js';\n        head.appendChild(script);\n    }\n    initialize(_options = {\n        clientId: '',\n        scopes: [],\n        grantOfflineAccess: false,\n    }) {\n        var _a, _b;\n        if (typeof window === 'undefined') {\n            return;\n        }\n        const metaClientId = (_a = document.getElementsByName('google-signin-client_id')[0]) === null || _a === void 0 ? void 0 : _a.content;\n        const clientId = _options.clientId || metaClientId || '';\n        if (!clientId) {\n            console.warn('GoogleAuthPlugin - clientId is empty');\n        }\n        this.options = {\n            clientId,\n            grantOfflineAccess: (_b = _options.grantOfflineAccess) !== null && _b !== void 0 ? _b : false,\n            scopes: _options.scopes || [],\n        };\n        this.gapiLoaded = new Promise((resolve) => {\n            // HACK: Relying on window object, can't get property in gapi.load callback\n            window.gapiResolve = resolve;\n            this.loadScript();\n        });\n        this.addUserChangeListener();\n        return this.gapiLoaded;\n    }\n    platformJsLoaded() {\n        gapi.load('auth2', () => {\n            // https://github.com/CodetrixStudio/CapacitorGoogleAuth/issues/202#issuecomment-1147393785\n            const clientConfig = {\n                client_id: this.options.clientId,\n                plugin_name: 'CodetrixStudioCapacitorGoogleAuth',\n            };\n            if (this.options.scopes.length) {\n                clientConfig.scope = this.options.scopes.join(' ');\n            }\n            gapi.auth2.init(clientConfig);\n            window.gapiResolve();\n        });\n    }\n    async signIn() {\n        return new Promise(async (resolve, reject) => {\n            var _a;\n            try {\n                let serverAuthCode;\n                const needsOfflineAccess = (_a = this.options.grantOfflineAccess) !== null && _a !== void 0 ? _a : false;\n                if (needsOfflineAccess) {\n                    const offlineAccessResponse = await gapi.auth2.getAuthInstance().grantOfflineAccess();\n                    serverAuthCode = offlineAccessResponse.code;\n                }\n                else {\n                    await gapi.auth2.getAuthInstance().signIn();\n                }\n                const googleUser = gapi.auth2.getAuthInstance().currentUser.get();\n                if (needsOfflineAccess) {\n                    // HACK: AuthResponse is null if we don't do this when using grantOfflineAccess\n                    await googleUser.reloadAuthResponse();\n                }\n                const user = this.getUserFrom(googleUser);\n                user.serverAuthCode = serverAuthCode;\n                resolve(user);\n            }\n            catch (error) {\n                reject(error);\n            }\n        });\n    }\n    async refresh() {\n        const authResponse = await gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();\n        return {\n            accessToken: authResponse.access_token,\n            idToken: authResponse.id_token,\n            refreshToken: '',\n        };\n    }\n    async signOut() {\n        return gapi.auth2.getAuthInstance().signOut();\n    }\n    async addUserChangeListener() {\n        await this.gapiLoaded;\n        gapi.auth2.getAuthInstance().currentUser.listen((googleUser) => {\n            this.notifyListeners('userChange', googleUser.isSignedIn() ? this.getUserFrom(googleUser) : null);\n        });\n    }\n    getUserFrom(googleUser) {\n        const user = {};\n        const profile = googleUser.getBasicProfile();\n        user.email = profile.getEmail();\n        user.familyName = profile.getFamilyName();\n        user.givenName = profile.getGivenName();\n        user.id = profile.getId();\n        user.imageUrl = profile.getImageUrl();\n        user.name = profile.getName();\n        const authResponse = googleUser.getAuthResponse(true);\n        user.authentication = {\n            accessToken: authResponse.access_token,\n            idToken: authResponse.id_token,\n            refreshToken: '',\n        };\n        return user;\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":[],"mappings":"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","x_google_ignoreList":[0]}