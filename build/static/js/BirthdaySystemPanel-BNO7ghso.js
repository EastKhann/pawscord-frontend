var D=Object.defineProperty;var s=(n,h)=>D(n,"name",{value:h,configurable:!0});import{r as c,j as e}from"./react-core-Djgtqrmb.js";import{y as d}from"./ui-vendor-IhB9Znpc.js";import{g as A}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const O=s(({serverId:n,onClose:h})=>{const l=A(),[r,i]=c.useState({enabled:!1,announcement_channel_id:"",birthday_role_id:"",message_template:"ðŸŽ‰ BugÃ¼n @{user}'un doÄŸum gÃ¼nÃ¼! Mutlu yÄ±llar! ðŸŽ‚",give_role:!0,remove_role_after_day:!0}),[m,x]=c.useState([]),[u,j]=c.useState([]),[y,p]=c.useState([]),[f,v]=c.useState([]),[b,_]=c.useState(!0);c.useEffect(()=>{N(),k(),S(),$()},[n]);const N=s(async()=>{try{const a=await fetch(`${l}/birthday-system/server/${n}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();i(t)}}catch{}finally{_(!1)}},"fetchConfig"),k=s(async()=>{try{const a=await fetch(`${l}/birthday-system/server/${n}/birthdays/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();x(t.all_birthdays),j(t.upcoming)}}catch{}},"fetchBirthdays"),S=s(async()=>{try{const a=await fetch(`${l}/channels/server/${n}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();p(t.filter(o=>o.type==="text"))}}catch{}},"fetchChannels"),$=s(async()=>{try{const a=await fetch(`${l}/roles/server/${n}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();v(t)}}catch{}},"fetchRoles"),w=s(async()=>{try{(await fetch(`${l}/birthday-system/server/${n}/config/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).ok?d.success("âœ… Ayarlar kaydedildi"):d.error("âŒ Kaydetme hatasÄ±")}catch{d.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"saveConfig"),B=s(async()=>{try{(await fetch(`${l}/birthday-system/server/${n}/test/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&d.success("âœ… Test mesajÄ± gÃ¶nderildi")}catch{d.error("âŒ GÃ¶nderim hatasÄ±")}},"testMessage"),g=s(a=>new Date(a).toLocaleDateString("tr-TR",{day:"numeric",month:"long"}),"formatBirthday"),C=s(a=>{const t=new Date,o=new Date(a);return o.setFullYear(t.getFullYear()),o<t&&o.setFullYear(t.getFullYear()+1),Math.ceil((o-t)/(1e3*60*60*24))},"getDaysUntil");return e.jsx("div",{className:"birthday-overlay",onClick:h,children:e.jsxs("div",{className:"birthday-panel",onClick:s(a=>a.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"birthday-header",children:[e.jsx("h2",{children:"ðŸŽ‚ DoÄŸum GÃ¼nÃ¼ Sistemi"}),e.jsx("button",{className:"close-btn",onClick:h,children:"Ã—"})]}),e.jsx("div",{className:"birthday-content",children:b?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"âš™ï¸ Ayarlar"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:r.enabled,onChange:s(a=>i({...r,enabled:a.target.checked}),"onChange")}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ“¢ Duyuru KanalÄ±"}),e.jsxs("select",{value:r.announcement_channel_id,onChange:s(a=>i({...r,announcement_channel_id:a.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"SeÃ§in"}),y.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸŽ­ DoÄŸum GÃ¼nÃ¼ RolÃ¼"}),e.jsxs("select",{value:r.birthday_role_id,onChange:s(a=>i({...r,birthday_role_id:a.target.value}),"onChange"),children:[e.jsx("option",{value:"",children:"Yok"}),f.map(a=>e.jsxs("option",{value:a.id,children:["@",a.name]},a.id))]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"ðŸ’¬ Mesaj Åžablonu"}),e.jsx("textarea",{value:r.message_template,onChange:s(a=>i({...r,message_template:a.target.value}),"onChange"),rows:"2"}),e.jsxs("small",{children:["KullanÄ±labilir: ","{user}",", ","{age}",", ","{server}"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.give_role,onChange:s(a=>i({...r,give_role:a.target.checked}),"onChange")}),e.jsx("span",{children:"DoÄŸum gÃ¼nÃ¼ rolÃ¼ ver"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.remove_role_after_day,onChange:s(a=>i({...r,remove_role_after_day:a.target.checked}),"onChange")}),e.jsx("span",{children:"Bir gÃ¼n sonra rolÃ¼ kaldÄ±r"})]})})]}),e.jsxs("div",{className:"config-actions",children:[e.jsx("button",{className:"save-btn",onClick:w,children:"ðŸ’¾ Kaydet"}),e.jsx("button",{className:"test-btn",onClick:B,children:"âœ‰ï¸ Test MesajÄ±"})]})]}),e.jsxs("div",{className:"upcoming-section",children:[e.jsx("h3",{children:"ðŸ“… YaklaÅŸan DoÄŸum GÃ¼nleri"}),u.length===0?e.jsx("div",{className:"empty-state-small",children:e.jsx("p",{children:"YaklaÅŸan doÄŸum gÃ¼nÃ¼ yok"})}):e.jsx("div",{className:"upcoming-list",children:u.map(a=>e.jsxs("div",{className:"upcoming-card",children:[e.jsx("div",{className:"upcoming-avatar",children:a.user_avatar?e.jsx("img",{src:a.user_avatar,alt:""}):e.jsx("div",{className:"default-avatar",children:"ðŸ‘¤"})}),e.jsxs("div",{className:"upcoming-info",children:[e.jsx("h4",{children:a.user_name}),e.jsx("p",{children:g(a.birthday)})]}),e.jsx("div",{className:"upcoming-days",children:e.jsxs("span",{className:"days-badge",children:[C(a.birthday)," gÃ¼n"]})})]},a.user_id))})]}),e.jsxs("div",{className:"all-birthdays-section",children:[e.jsxs("h3",{children:["ðŸ“‹ TÃ¼m DoÄŸum GÃ¼nleri (",m.length,")"]}),e.jsx("div",{className:"birthdays-grid",children:m.map(a=>e.jsxs("div",{className:"birthday-item",children:[e.jsx("span",{className:"user-name",children:a.user_name}),e.jsx("span",{className:"birthday-date",children:g(a.birthday)})]},a.user_id))})]})]})})]})})},"BirthdaySystemPanel");export{O as default};
