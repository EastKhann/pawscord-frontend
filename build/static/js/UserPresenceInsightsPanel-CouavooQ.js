var w=Object.defineProperty;var t=(r,l)=>w(r,"name",{value:l,configurable:!0});import{r as n,j as s}from"./react-core-Djgtqrmb.js";import{c as A,am as M,ax as p,a as S,z as N,c6 as $,E as y,u as P,R as T,O as g,a8 as b,c7 as _,bT as z,P as U,Q as E,aK as O}from"./icons-vendor-BMXAt4pj.js";import{g as R}from"./index-D0nbcjO7.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const Q=t(({userId:r,username:l,onClose:o,fetchWithAuth:j})=>{const[e,m]=n.useState(null),[k,x]=n.useState(!0),[c,h]=n.useState("overview"),u=n.useCallback(async()=>{x(!0);try{const a=await j(`${R()}/users/${r}/presence-insights/`);if(a.ok){const i=await a.json();m(i)}else m({user:{username:l||"User",status:"online",joined:"2024-03-15",timezone:"UTC+3"},activity_summary:{total_online_hours:847,messages_sent:12453,voice_hours:234,servers_active:8,reactions_given:3421},active_hours:Array(24).fill(0).map((i,C)=>({hour:C,activity:Math.random()*100})),weekly_pattern:[{day:"Mon",activity:65},{day:"Tue",activity:72},{day:"Wed",activity:80},{day:"Thu",activity:75},{day:"Fri",activity:90},{day:"Sat",activity:100},{day:"Sun",activity:85}],status_distribution:{online:45,idle:25,dnd:15,offline:15},top_activities:[{name:"Gaming",hours:156,icon:"gaming"},{name:"Music",hours:89,icon:"music"},{name:"Voice Chat",hours:234,icon:"voice"},{name:"Streaming",hours:45,icon:"stream"}],engagement_score:87,peak_time:{start:20,end:23},preferred_timezone:"Evening (8PM - 11PM)"})}catch{m(null)}x(!1)},[r,l,j]);n.useEffect(()=>{u()},[u]);const d=t(a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a?.toString()||"0","formatNumber"),v=t(a=>{switch(a){case"online":return"#10b981";case"idle":return"#f59e0b";case"dnd":return"#ef4444";default:return"#6b7280"}},"getStatusColor"),f=t(a=>{switch(a){case"gaming":return s.jsx(b,{});case"music":return s.jsx(O,{});case"voice":return s.jsx(y,{});case"stream":return s.jsx(g,{});default:return s.jsx(E,{})}},"getActivityIcon"),F=t(()=>e?.active_hours?Math.max(...e.active_hours.map(a=>a.activity),1):1,"getMaxHourlyActivity");return k?s.jsx("div",{className:"presence-insights-overlay",onClick:o,children:s.jsx("div",{className:"presence-insights-panel",onClick:t(a=>a.stopPropagation(),"onClick"),children:s.jsxs("div",{className:"loading-state",children:[s.jsx(A,{className:"spin"}),s.jsx("span",{children:"Analyzing activity patterns..."})]})})}):s.jsx("div",{className:"presence-insights-overlay",onClick:o,children:s.jsxs("div",{className:"presence-insights-panel",onClick:t(a=>a.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"user-header",children:[s.jsxs("div",{className:"user-avatar-large",children:[s.jsx("span",{children:(e?.user?.username||"U").charAt(0).toUpperCase()}),s.jsx("div",{className:"status-indicator",style:{backgroundColor:v(e?.user?.status)}})]}),s.jsxs("div",{className:"user-info",children:[s.jsx("h2",{children:e?.user?.username||"User"}),s.jsxs("div",{className:"user-meta",children:[s.jsxs("span",{children:[s.jsx(M,{})," Joined ",e?.user?.joined||"N/A"]}),s.jsxs("span",{children:[s.jsx(p,{})," ",e?.user?.timezone||"Unknown"]})]})]})]}),s.jsxs("div",{className:"engagement-score",children:[s.jsx("div",{className:"score-circle",children:s.jsx("span",{className:"score-value",children:e?.engagement_score||0})}),s.jsx("span",{className:"score-label",children:"Engagement"})]}),s.jsx("button",{className:"close-btn",onClick:o,children:s.jsx(S,{})})]}),s.jsxs("div",{className:"stats-bar",children:[s.jsxs("div",{className:"stat",children:[s.jsx(N,{}),s.jsxs("span",{className:"stat-value",children:[d(e?.activity_summary?.total_online_hours),"h"]}),s.jsx("span",{className:"stat-label",children:"Online"})]}),s.jsxs("div",{className:"stat",children:[s.jsx($,{}),s.jsx("span",{className:"stat-value",children:d(e?.activity_summary?.messages_sent)}),s.jsx("span",{className:"stat-label",children:"Messages"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(y,{}),s.jsxs("span",{className:"stat-value",children:[d(e?.activity_summary?.voice_hours),"h"]}),s.jsx("span",{className:"stat-label",children:"Voice"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(P,{}),s.jsx("span",{className:"stat-value",children:e?.activity_summary?.servers_active||0}),s.jsx("span",{className:"stat-label",children:"Servers"})]}),s.jsxs("div",{className:"stat",children:[s.jsx(T,{}),s.jsx("span",{className:"stat-value",children:d(e?.activity_summary?.reactions_given)}),s.jsx("span",{className:"stat-label",children:"Reactions"})]})]}),s.jsxs("div",{className:"tabs",children:[s.jsxs("button",{className:`tab ${c==="overview"?"active":""}`,onClick:t(()=>h("overview"),"onClick"),children:[s.jsx(g,{})," Overview"]}),s.jsxs("button",{className:`tab ${c==="schedule"?"active":""}`,onClick:t(()=>h("schedule"),"onClick"),children:[s.jsx(N,{})," Activity Schedule"]}),s.jsxs("button",{className:`tab ${c==="activities"?"active":""}`,onClick:t(()=>h("activities"),"onClick"),children:[s.jsx(b,{})," Activities"]})]}),s.jsxs("div",{className:"tab-content",children:[c==="overview"&&s.jsxs("div",{className:"overview-tab",children:[s.jsx("div",{className:"peak-info",children:s.jsxs("div",{className:"peak-card",children:[s.jsx(_,{className:"peak-icon day"}),s.jsxs("div",{className:"peak-content",children:[s.jsx("span",{className:"peak-label",children:"Peak Activity Time"}),s.jsx("span",{className:"peak-value",children:e?.preferred_timezone})]})]})}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Status Distribution"}),s.jsx("div",{className:"status-bars",children:Object.entries(e?.status_distribution||{}).map(([a,i])=>s.jsxs("div",{className:"status-bar-item",children:[s.jsxs("div",{className:"status-bar-header",children:[s.jsx("span",{className:"status-name",style:{color:v(a)},children:a.toUpperCase()}),s.jsxs("span",{className:"status-percent",children:[i,"%"]})]}),s.jsx("div",{className:"status-bar-track",children:s.jsx("div",{className:"status-bar-fill",style:{width:`${i}%`,backgroundColor:v(a)}})})]},a))})]}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Weekly Activity Pattern"}),s.jsx("div",{className:"weekly-chart",children:(e?.weekly_pattern||[]).map((a,i)=>s.jsxs("div",{className:"day-bar",children:[s.jsx("div",{className:"bar",style:{height:`${a.activity}%`}}),s.jsx("span",{className:"day-label",children:a.day})]},i))})]})]}),c==="schedule"&&s.jsxs("div",{className:"schedule-tab",children:[s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:[s.jsx(z,{})," ",s.jsx(_,{})," 24-Hour Activity Pattern"]}),s.jsx("div",{className:"hourly-chart",children:(e?.active_hours||[]).map((a,i)=>s.jsxs("div",{className:"hour-column",children:[s.jsx("div",{className:`hour-bar ${i>=(e?.peak_time?.start||0)&&i<=(e?.peak_time?.end||23)?"peak":""}`,style:{height:`${Math.max(a.activity/F()*100,5)}%`},title:`${a.hour}:00 - Activity: ${Math.round(a.activity)}%`}),s.jsx("span",{className:"hour-num",children:a.hour})]},i))}),s.jsxs("div",{className:"chart-legend",children:[s.jsxs("span",{children:[s.jsx("span",{className:"legend-dot peak"})," Peak hours"]}),s.jsxs("span",{children:[s.jsx("span",{className:"legend-dot"})," Regular activity"]})]})]}),s.jsxs("div",{className:"timezone-note",children:[s.jsx(p,{}),s.jsxs("span",{children:["Times shown in user's local timezone (",e?.user?.timezone,")"]})]})]}),c==="activities"&&s.jsx("div",{className:"activities-tab",children:s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:[s.jsx(U,{})," Top Activities"]}),s.jsxs("div",{className:"activities-list",children:[(e?.top_activities||[]).map((a,i)=>s.jsxs("div",{className:`activity-item rank-${i+1}`,children:[s.jsx("span",{className:"activity-rank",children:i+1}),s.jsx("div",{className:"activity-icon",children:f(a.icon)}),s.jsxs("div",{className:"activity-info",children:[s.jsx("span",{className:"activity-name",children:a.name}),s.jsxs("span",{className:"activity-hours",children:[a.hours," hours total"]})]}),s.jsx("div",{className:"activity-bar",children:s.jsx("div",{className:"bar-fill",style:{width:`${a.hours/(e?.top_activities?.[0]?.hours||1)*100}%`}})})]},i)),(!e?.top_activities||e.top_activities.length===0)&&s.jsx("div",{className:"empty-state",children:"No activity data available"})]})]})})]})]})})},"UserPresenceInsightsPanel");export{Q as default};
