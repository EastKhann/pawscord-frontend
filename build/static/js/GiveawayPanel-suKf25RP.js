import{r as o,n as e}from"./react-core-zXIKm1Jm.js";import{y as r}from"./ui-vendor-BGw4w3Ed.js";import{g as G}from"./index-BcyeUaJO.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-BBdoVeJd.js";import"./state-vendor-8NbFPBhQ.js";const L=({serverId:c,onClose:p})=>{const t=G(),[x,f]=o.useState([]),[k,N]=o.useState(!0),[y,d]=o.useState(!1),[w,_]=o.useState([]),[b,S]=o.useState([]),[i,n]=o.useState({title:"",description:"",prize:"",channel_id:"",winners_count:1,duration:3600,required_role_id:"",required_messages:0,required_invites:0,allow_multiple_entries:!1});o.useEffect(()=>{h(),z(),$()},[c]);const h=async()=>{try{const s=await fetch(`${t}/giveaways/server/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();f(a)}}catch(s){console.error("Error fetching giveaways:",s)}finally{N(!1)}},z=async()=>{try{const s=await fetch(`${t}/channels/server/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();_(a.filter(l=>l.type==="text"))}}catch(s){console.error("Error fetching channels:",s)}},$=async()=>{try{const s=await fetch(`${t}/roles/server/${c}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();S(a)}}catch(s){console.error("Error fetching roles:",s)}},C=async()=>{if(!i.title||!i.prize||!i.channel_id){r.error("âŒ LÃ¼tfen tÃ¼m gerekli alanlarÄ± doldurun");return}try{(await fetch(`${t}/giveaways/create/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:c,...i})})).ok?(r.success("âœ… Ã‡ekiliÅŸ oluÅŸturuldu!"),d(!1),h(),n({title:"",description:"",prize:"",channel_id:"",winners_count:1,duration:3600,required_role_id:"",required_messages:0,required_invites:0,allow_multiple_entries:!1})):r.error("âŒ Ã‡ekiliÅŸ oluÅŸturulamadÄ±")}catch(s){console.error("Error creating giveaway:",s),r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},q=async s=>{if(window.confirm("Ã‡ekiliÅŸi sonlandÄ±rmak istediÄŸinize emin misiniz?"))try{const a=await fetch(`${t}/giveaways/${s}/end/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const l=await a.json();r.success(`âœ… Ã‡ekiliÅŸ sonlandÄ±! Kazananlar: ${l.winners.join(", ")}`),h()}else r.error("âŒ Ã‡ekiliÅŸ sonlandÄ±rÄ±lamadÄ±")}catch(a){console.error("Error ending giveaway:",a),r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},B=async s=>{try{const a=await fetch(`${t}/giveaways/${s}/reroll/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const l=await a.json();r.success(`âœ… Yeni kazanan: ${l.new_winner}`),h()}else r.error("âŒ Reroll yapÄ±lamadÄ±")}catch(a){console.error("Error rerolling giveaway:",a),r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},E=async s=>{if(window.confirm("Ã‡ekiliÅŸi silmek istediÄŸinize emin misiniz?"))try{(await fetch(`${t}/giveaways/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok?(r.success("âœ… Ã‡ekiliÅŸ silindi"),h()):r.error("âŒ Ã‡ekiliÅŸ silinemedi")}catch(a){console.error("Error deleting giveaway:",a),r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},j=s=>{const a={active:{text:"Aktif",color:"#10b981"},ended:{text:"SonlandÄ±",color:"#6b7280"},cancelled:{text:"Ä°ptal",color:"#ef4444"}};return a[s]||a.active},A=s=>{const a=new Date,l=new Date(s),m=Math.floor((l-a)/1e3);if(m<=0)return"Sona erdi";const v=Math.floor(m/86400),u=Math.floor(m%86400/3600),g=Math.floor(m%3600/60);return v>0?`${v}g ${u}s kaldÄ±`:u>0?`${u}s ${g}dk kaldÄ±`:`${g} dakika kaldÄ±`};return e.jsx("div",{className:"giveaway-panel-overlay",onClick:p,children:e.jsxs("div",{className:"giveaway-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"giveaway-header",children:[e.jsx("h2",{children:"ğŸ‰ Ã‡ekiliÅŸler"}),e.jsx("button",{className:"close-btn",onClick:p,children:"Ã—"})]}),e.jsxs("div",{className:"giveaway-content",children:[e.jsx("div",{className:"giveaway-actions",children:e.jsx("button",{className:"create-giveaway-btn",onClick:()=>d(!0),children:"+ Yeni Ã‡ekiliÅŸ OluÅŸtur"})}),k?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Ã‡ekiliÅŸler yÃ¼kleniyor..."})]}):x.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ"}),e.jsx("p",{children:"HenÃ¼z Ã§ekiliÅŸ yok"}),e.jsx("span",{className:"empty-hint",children:"Yeni bir Ã§ekiliÅŸ oluÅŸturun!"})]}):e.jsx("div",{className:"giveaways-list",children:x.map(s=>e.jsxs("div",{className:"giveaway-card",children:[e.jsxs("div",{className:"giveaway-card-header",children:[e.jsx("h3",{children:s.title}),e.jsx("span",{className:"status-badge",style:{background:j(s.status).color},children:j(s.status).text})]}),e.jsxs("div",{className:"giveaway-card-body",children:[e.jsxs("div",{className:"giveaway-prize",children:[e.jsx("span",{className:"prize-icon",children:"ğŸ"}),e.jsx("span",{className:"prize-text",children:s.prize})]}),s.description&&e.jsx("p",{className:"giveaway-description",children:s.description}),e.jsxs("div",{className:"giveaway-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Kazanan SayÄ±sÄ±:"}),e.jsxs("span",{className:"info-value",children:[s.winners_count," kiÅŸi"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"KatÄ±lÄ±mcÄ±lar:"}),e.jsxs("span",{className:"info-value",children:[s.entries_count||0," kiÅŸi"]})]}),s.status==="active"&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Kalan SÃ¼re:"}),e.jsx("span",{className:"info-value time-remaining",children:A(s.end_time)})]})]}),s.required_role_id&&e.jsx("div",{className:"requirement-badge",children:"â­ Rol gereksinimi var"}),s.required_messages>0&&e.jsxs("div",{className:"requirement-badge",children:["ğŸ’¬ ",s.required_messages," mesaj gerekli"]}),s.required_invites>0&&e.jsxs("div",{className:"requirement-badge",children:["ğŸ‘¥ ",s.required_invites," davet gerekli"]}),s.winners&&s.winners.length>0&&e.jsxs("div",{className:"winners-section",children:[e.jsx("h4",{children:"ğŸ‰ Kazananlar:"}),e.jsx("ul",{className:"winners-list",children:s.winners.map((a,l)=>e.jsx("li",{children:a},l))})]})]}),e.jsxs("div",{className:"giveaway-card-footer",children:[s.status==="active"&&e.jsx("button",{className:"end-btn",onClick:()=>q(s.id),children:"ğŸ SonlandÄ±r"}),s.status==="ended"&&e.jsx("button",{className:"reroll-btn",onClick:()=>B(s.id),children:"ğŸ”„ Reroll"}),e.jsx("button",{className:"delete-btn",onClick:()=>E(s.id),children:"ğŸ—‘ï¸ Sil"})]})]},s.id))})]}),y&&e.jsx("div",{className:"create-modal-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"create-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Yeni Ã‡ekiliÅŸ OluÅŸtur"}),e.jsx("button",{className:"close-btn",onClick:()=>d(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"BaÅŸlÄ±k *"}),e.jsx("input",{type:"text",placeholder:"Discord Nitro Ã‡ekiliÅŸi",value:i.title,onChange:s=>n({...i,title:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"AÃ§Ä±klama"}),e.jsx("textarea",{placeholder:"Ã‡ekiliÅŸ hakkÄ±nda detaylar...",value:i.description,onChange:s=>n({...i,description:s.target.value}),rows:"3"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ã–dÃ¼l *"}),e.jsx("input",{type:"text",placeholder:"1 AylÄ±k Discord Nitro",value:i.prize,onChange:s=>n({...i,prize:s.target.value})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:i.channel_id,onChange:s=>n({...i,channel_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Kanal SeÃ§in"}),w.map(s=>e.jsxs("option",{value:s.id,children:["# ",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kazanan SayÄ±sÄ±"}),e.jsx("input",{type:"number",min:"1",max:"100",value:i.winners_count,onChange:s=>n({...i,winners_count:parseInt(s.target.value)})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SÃ¼re"}),e.jsxs("select",{value:i.duration,onChange:s=>n({...i,duration:parseInt(s.target.value)}),children:[e.jsx("option",{value:"1800",children:"30 dakika"}),e.jsx("option",{value:"3600",children:"1 saat"}),e.jsx("option",{value:"10800",children:"3 saat"}),e.jsx("option",{value:"21600",children:"6 saat"}),e.jsx("option",{value:"43200",children:"12 saat"}),e.jsx("option",{value:"86400",children:"1 gÃ¼n"}),e.jsx("option",{value:"172800",children:"2 gÃ¼n"}),e.jsx("option",{value:"259200",children:"3 gÃ¼n"}),e.jsx("option",{value:"604800",children:"1 hafta"})]})]}),e.jsxs("div",{className:"requirements-section",children:[e.jsx("h4",{children:"KatÄ±lÄ±m Gereksinimleri (Opsiyonel)"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Gerekli Rol"}),e.jsxs("select",{value:i.required_role_id,onChange:s=>n({...i,required_role_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Rol yok"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Minimum Mesaj SayÄ±sÄ±"}),e.jsx("input",{type:"number",min:"0",value:i.required_messages,onChange:s=>n({...i,required_messages:parseInt(s.target.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Minimum Davet SayÄ±sÄ±"}),e.jsx("input",{type:"number",min:"0",value:i.required_invites,onChange:s=>n({...i,required_invites:parseInt(s.target.value)})})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i.allow_multiple_entries,onChange:s=>n({...i,allow_multiple_entries:s.target.checked})}),e.jsx("span",{children:"Birden fazla katÄ±lÄ±ma izin ver"})]})})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>d(!1),children:"Ä°ptal"}),e.jsx("button",{className:"submit-btn",onClick:C,children:"ğŸ‰ Ã‡ekiliÅŸ OluÅŸtur"})]})]})})]})})};export{L as default};
