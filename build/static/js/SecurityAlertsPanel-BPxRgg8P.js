import{r as o,n as s}from"./react-core-BMiyQWF6.js";import{d as w,c as E,a as f,f as L,a4 as $,D,a8 as I,H as K,A as g,a3 as B,g as O,U as G}from"./icons-vendor-GUGjkvMm.js";import{t as T}from"./index-Cw8DImG3.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const X=({serverId:a,apiBaseUrl:i,onClose:x})=>{const[d,m]=o.useState([]),[r,h]=o.useState(!0),[c,j]=o.useState("all"),[t,v]=o.useState(""),[p,y]=o.useState(null),[u,P]=o.useState({total:0,unresolved:0,critical:0,resolved_today:0}),S={critical:{label:"Kritik",color:"#ef4444",icon:s.jsx(G,{})},high:{label:"Yüksek",color:"#f97316",icon:s.jsx(w,{})},medium:{label:"Orta",color:"#f59e0b",icon:s.jsx(O,{})},low:{label:"Düşük",color:"#3b82f6",icon:s.jsx($,{})}},_={brute_force:"Brute Force Saldırısı",suspicious_login:"Şüpheli Giriş",unusual_activity:"Olağandışı Aktivite",permission_abuse:"Yetki Suistimali",spam_detected:"Spam Algılandı",raid_attempt:"Raid Girişimi",api_abuse:"API Suistimali",unauthorized_access:"Yetkisiz Erişim Denemesi"};o.useEffect(()=>{N(),C();const e=setInterval(N,3e4);return()=>clearInterval(e)},[a]);const N=async()=>{try{const e=localStorage.getItem("access_token"),l=await fetch(`${i}/security/alerts/`,{headers:{Authorization:`Bearer ${e}`}});if(l.ok){const n=await l.json();m(n.alerts||[])}}catch{}finally{h(!1)}},C=async()=>{try{const e=localStorage.getItem("access_token"),l=await fetch(`${i}/security/alerts/stats/`,{headers:{Authorization:`Bearer ${e}`}});if(l.ok){const n=await l.json();P(n)}}catch{}},A=async(e,l)=>{try{const n=localStorage.getItem("access_token");(await fetch(`${i}/security/alerts/${e}/resolve/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({resolution:l})})).ok&&(T.success("✅ Uyarı çözümlendi"),m(k=>k.map(b=>b.id===e?{...b,resolved:!0,resolution:l}:b)),y(null),C())}catch{}},R=async e=>{try{const l=localStorage.getItem("access_token");(await fetch(`${i}/security/alerts/${e}/dismiss/`,{method:"POST",headers:{Authorization:`Bearer ${l}`}})).ok&&(T.success("Uyarı yok sayıldı"),m(F=>F.filter(k=>k.id!==e)))}catch{}},z=d.filter(e=>{const l=e.message?.toLowerCase().includes(t.toLowerCase())||e.source_ip?.includes(t)||e.user_info?.username?.toLowerCase().includes(t.toLowerCase()),n=c==="all"||c==="unresolved"&&!e.resolved||c==="resolved"&&e.resolved||c==="critical"&&e.severity==="critical";return l&&n});return s.jsx("div",{className:"security-alerts-overlay",onClick:x,children:s.jsxs("div",{className:"security-alerts-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("h2",{children:[s.jsx(w,{})," Güvenlik Uyarıları"]}),s.jsxs("div",{className:"header-actions",children:[s.jsx("button",{className:"refresh-btn",onClick:N,children:s.jsx(E,{})}),s.jsx("button",{className:"close-btn",onClick:x,children:s.jsx(f,{})})]})]}),s.jsxs("div",{className:"stats-bar",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-value",children:u.total}),s.jsx("span",{className:"stat-label",children:"Toplam"})]}),s.jsxs("div",{className:"stat-item danger",children:[s.jsx("span",{className:"stat-value",children:u.unresolved}),s.jsx("span",{className:"stat-label",children:"Bekleyen"})]}),s.jsxs("div",{className:"stat-item critical",children:[s.jsx("span",{className:"stat-value",children:u.critical}),s.jsx("span",{className:"stat-label",children:"Kritik"})]}),s.jsxs("div",{className:"stat-item success",children:[s.jsx("span",{className:"stat-value",children:u.resolved_today}),s.jsx("span",{className:"stat-label",children:"Bugün Çözülen"})]})]}),s.jsxs("div",{className:"toolbar",children:[s.jsxs("div",{className:"search-box",children:[s.jsx(L,{}),s.jsx("input",{type:"text",placeholder:"Uyarı, IP veya kullanıcı ara...",value:t,onChange:e=>v(e.target.value)})]}),s.jsx("div",{className:"filter-buttons",children:["all","unresolved","resolved","critical"].map(e=>s.jsxs("button",{className:`filter-btn ${c===e?"active":""}`,onClick:()=>j(e),children:[e==="all"&&"Tümü",e==="unresolved"&&"Bekleyen",e==="resolved"&&"Çözülen",e==="critical"&&"Kritik"]},e))})]}),s.jsx("div",{className:"panel-content",children:r?s.jsx("div",{className:"loading",children:"Yükleniyor..."}):z.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx($,{}),s.jsx("p",{children:"Güvenlik uyarısı bulunmuyor"}),s.jsx("span",{children:"Sisteminiz güvende görünüyor"})]}):s.jsx("div",{className:"alerts-list",children:z.map(e=>s.jsx(Y,{alert:e,severityLevels:S,alertTypes:_,onView:()=>y(e),onDismiss:()=>R(e.id),onResolve:l=>A(e.id,l)},e.id))})}),p&&s.jsx(q,{alert:p,severityLevels:S,alertTypes:_,onClose:()=>y(null),onResolve:e=>A(p.id,e)})]})})},Y=({alert:a,severityLevels:i,alertTypes:x,onView:d,onDismiss:m,onResolve:r})=>{const h=i[a.severity]||i.low;return s.jsxs("div",{className:`alert-card ${a.severity} ${a.resolved?"resolved":""}`,children:[s.jsx("div",{className:"alert-severity",style:{background:h.color},children:h.icon}),s.jsxs("div",{className:"alert-content",children:[s.jsxs("div",{className:"alert-header",children:[s.jsx("span",{className:"alert-type",children:x[a.type]||a.type}),s.jsxs("span",{className:"alert-time",children:[s.jsx(D,{})," ",new Date(a.created_at).toLocaleString("tr-TR")]})]}),s.jsx("p",{className:"alert-message",children:a.message}),s.jsxs("div",{className:"alert-meta",children:[a.source_ip&&s.jsxs("span",{children:[s.jsx(I,{})," ",a.source_ip]}),a.user_info&&s.jsxs("span",{children:[s.jsx(K,{})," ",a.user_info.username]}),a.resolved&&s.jsxs("span",{className:"resolved-badge",children:[s.jsx(g,{})," Çözümlendi"]})]})]}),s.jsxs("div",{className:"alert-actions",children:[s.jsx("button",{className:"view-btn",onClick:d,children:s.jsx(B,{})}),!a.resolved&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"resolve-btn",onClick:()=>r("Hızlı çözüm"),children:s.jsx(g,{})}),s.jsx("button",{className:"dismiss-btn",onClick:m,children:s.jsx(f,{})})]})]})]})},q=({alert:a,severityLevels:i,alertTypes:x,onClose:d,onResolve:m})=>{const[r,h]=o.useState(""),c=i[a.severity]||i.low,j=["False positive - Normal aktivite","Kullanıcı uyarıldı","IP engellendi","Hesap askıya alındı","İncelendi - Aksiyon gerekmiyor"];return s.jsx("div",{className:"modal-overlay",onClick:d,children:s.jsxs("div",{className:"alert-detail-modal",onClick:t=>t.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",style:{borderLeftColor:c.color},children:[s.jsxs("div",{className:"severity-badge",style:{background:c.color},children:[c.icon," ",c.label]}),s.jsx("button",{className:"close-modal",onClick:d,children:s.jsx(f,{})})]}),s.jsxs("div",{className:"modal-content",children:[s.jsx("h3",{children:x[a.type]||a.type}),s.jsx("p",{className:"detail-message",children:a.message}),s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Detaylar"}),s.jsxs("div",{className:"detail-grid",children:[s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(D,{})," Zaman"]}),s.jsx("span",{children:new Date(a.created_at).toLocaleString("tr-TR")})]}),a.source_ip&&s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(I,{})," Kaynak IP"]}),s.jsx("span",{className:"mono",children:a.source_ip})]}),a.user_info&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"detail-item",children:[s.jsxs("label",{children:[s.jsx(K,{})," Kullanıcı"]}),s.jsx("span",{children:a.user_info.username})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:"Kullanıcı ID"}),s.jsx("span",{className:"mono",children:a.user_info.id})]})]}),a.location&&s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:"Konum"}),s.jsx("span",{children:a.location})]})]})]}),a.additional_data&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Ek Veriler"}),s.jsx("pre",{className:"json-data",children:JSON.stringify(a.additional_data,null,2)})]}),!a.resolved&&s.jsxs("div",{className:"resolution-section",children:[s.jsx("h4",{children:"Çözüm"}),s.jsx("div",{className:"quick-resolutions",children:j.map((t,v)=>s.jsx("button",{className:`quick-res-btn ${r===t?"active":""}`,onClick:()=>h(t),children:t},v))}),s.jsx("textarea",{value:r,onChange:t=>h(t.target.value),placeholder:"Veya özel bir çözüm notu yazın...",rows:"3"})]})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"cancel-btn",onClick:d,children:"Kapat"}),!a.resolved&&s.jsxs("button",{className:"resolve-btn",onClick:()=>m(r||"Çözümlendi"),disabled:!r,children:[s.jsx(g,{})," Çözümle"]})]})]})})};export{X as default};
