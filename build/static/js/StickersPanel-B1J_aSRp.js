import{r as c,n as e}from"./react-core-Cj7FUMmY.js";import{h as A}from"./index-DsN-N-A2.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-TGltgKsJ.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const O=({serverId:l,onClose:k})=>{const[n,h]=c.useState([]),[p,C]=c.useState([]),[x,r]=c.useState(!0),[i,u]=c.useState("my-stickers"),[P,o]=c.useState(!1),[j,f]=c.useState(!1),[d,g]=c.useState(""),[m,N]=c.useState(null),[v,y]=c.useState("");c.useEffect(()=>{i==="my-stickers"?S():b()},[i,l]);const S=async()=>{try{r(!0);const s=localStorage.getItem("access_token"),t=await fetch(`/api/stickers/${l}/list/`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const a=await t.json();h(a.stickers||[])}}catch{}finally{r(!1)}},b=async()=>{try{r(!0);const s=localStorage.getItem("access_token"),t=await fetch("/api/stickers/packs/",{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const a=await t.json();C(a.packs||[])}}catch{}finally{r(!1)}},$=async()=>{if(!d.trim()||!m)return;const s=new FormData;s.append("name",d),s.append("sticker",m);try{f(!0);const t=localStorage.getItem("access_token"),a=await fetch(`/api/stickers/${l}/upload/`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(a.ok)o(!1),g(""),N(null),y(""),S();else{const w=await a.json()}}catch{}finally{f(!1)}},U=async s=>{if(await A("Delete this sticker?"))try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok&&h(n.filter(w=>w.id!==s))}catch{}},F=async s=>{try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/install-pack/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({pack_id:s})})).ok&&b()}catch{}},_=s=>{const t=s.target.files[0];t&&t.type.startsWith("image/")&&(t.size>512*1024||(N(t),y(URL.createObjectURL(t))))};return e.jsx("div",{className:"stickers-panel-overlay",onClick:k,children:e.jsxs("div",{className:"stickers-panel-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"stickers-panel-header",children:[e.jsx("h2",{children:"ðŸŽ¨ Stickers"}),e.jsx("button",{className:"close-btn",onClick:k,children:"âœ•"})]}),e.jsxs("div",{className:"stickers-tabs",children:[e.jsx("button",{className:`tab-btn ${i==="my-stickers"?"active":""}`,onClick:()=>u("my-stickers"),children:"ðŸ“ My Stickers"}),e.jsx("button",{className:`tab-btn ${i==="packs"?"active":""}`,onClick:()=>u("packs"),children:"ðŸ“¦ Sticker Packs"})]}),e.jsxs("div",{className:"stickers-panel-content",children:[i==="my-stickers"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sticker-actions",children:[e.jsx("button",{className:"upload-sticker-btn",onClick:()=>o(!0),children:"âž• Upload Sticker"}),e.jsxs("p",{className:"sticker-count",children:[n.length," stickers"]})]}),x?e.jsx("div",{className:"loading-spinner",children:"Loading stickers..."}):n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ¨"}),e.jsx("h3",{children:"No Stickers Yet"}),e.jsx("p",{children:"Upload your first custom sticker"})]}):e.jsx("div",{className:"stickers-grid",children:n.map(s=>e.jsxs("div",{className:"sticker-card",children:[e.jsx("img",{src:s.url,alt:s.name,className:"sticker-image"}),e.jsx("div",{className:"sticker-name",children:s.name}),e.jsx("button",{className:"delete-sticker-btn",onClick:()=>U(s.id),title:"Delete",children:"ðŸ—‘ï¸"})]},s.id))})]}),i==="packs"&&e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"loading-spinner",children:"Loading packs..."}):p.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“¦"}),e.jsx("h3",{children:"No Packs Available"}),e.jsx("p",{children:"Check back later for new sticker packs"})]}):e.jsx("div",{className:"packs-grid",children:p.map(s=>e.jsxs("div",{className:"pack-card",children:[e.jsx("div",{className:"pack-preview",children:s.preview_stickers?.slice(0,4).map((t,a)=>e.jsx("img",{src:t.url,alt:"",className:"pack-preview-img"},a))}),e.jsxs("div",{className:"pack-info",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{children:[s.sticker_count," stickers"]})]}),e.jsx("button",{className:`install-pack-btn ${s.installed?"installed":""}`,onClick:()=>!s.installed&&F(s.id),disabled:s.installed,children:s.installed?"âœ“ Installed":"âž• Install"})]},s.id))})})]}),P&&e.jsx("div",{className:"upload-modal-overlay",onClick:()=>o(!1),children:e.jsxs("div",{className:"upload-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"âž• Upload Sticker"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Name"}),e.jsx("input",{type:"text",value:d,onChange:s=>g(s.target.value),placeholder:"My Sticker",maxLength:32,className:"sticker-name-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sticker Image"}),e.jsx("div",{className:"file-upload-area",onClick:()=>document.getElementById("sticker-file").click(),children:v?e.jsx("img",{src:v,alt:"Preview",className:"upload-preview"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-icon",children:"ðŸ“¤"}),e.jsx("p",{children:"Click to select image"}),e.jsx("p",{className:"upload-hint",children:"PNG, GIF â€¢ Max 512KB â€¢ 512x512px recommended"})]})}),e.jsx("input",{id:"sticker-file",type:"file",accept:"image/*",onChange:_,style:{display:"none"}})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>o(!1),children:"Cancel"}),e.jsx("button",{className:"upload-btn",onClick:$,disabled:j||!d||!m,children:j?"Uploading...":"Upload"})]})]})})]})})};export{O as default};
