var $=Object.defineProperty;var s=(i,u)=>$(i,"name",{value:u,configurable:!0});import{r as c,j as e}from"./react-core-Djgtqrmb.js";import{B as z,an as B,a1 as y,bo as T,bp as F,at as O,g as P,d as Y,ay as D}from"./icons-vendor-BMXAt4pj.js";import{t as l}from"./index-DjBRFZUD.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const V=s(({serverId:i,onClose:u})=>{const[d,m]=c.useState([]),[k,p]=c.useState(!0),[f,h]=c.useState(!1),[_,j]=c.useState(null),[t,r]=c.useState({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60});c.useEffect(()=>{g()},[i]);const g=s(async()=>{p(!0);try{const a=await fetch(`/api/moderation/auto-mod/rules/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const n=await a.json();m(n.rules||[])}}catch{l.error("âŒ Kurallar yÃ¼klenemedi")}finally{p(!1)}},"fetchRules"),v=s(async()=>{if(!t.name.trim()){l.error("âŒ Kural adÄ± girin");return}try{const a=await fetch(`/api/moderation/auto-mod/rules/${i}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok){const n=await a.json();m([...d,n.rule]),h(!1),C(),l.success("âœ… Kural oluÅŸturuldu")}else l.error("âŒ Kural oluÅŸturulamadÄ±")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},"createRule"),N=s(async(a,n)=>{try{const o=await fetch(`/api/moderation/auto-mod/rules/${i}/${a}/`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(o.ok){const A=await o.json();m(d.map(x=>x.id===a?A.rule:x)),j(null),l.success("âœ… Kural gÃ¼ncellendi")}}catch{l.error("âŒ GÃ¼ncelleme baÅŸarÄ±sÄ±z")}},"updateRule"),b=s(async a=>{if(confirm("Bu kuralÄ± silmek istediÄŸinizden emin misiniz?"))try{(await fetch(`/api/moderation/auto-mod/rules/${i}/${a}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(m(d.filter(o=>o.id!==a)),l.success("âœ… Kural silindi"))}catch{l.error("âŒ Silme baÅŸarÄ±sÄ±z")}},"deleteRule"),w=s(async(a,n)=>{await N(a,{enabled:n})},"toggleRule"),C=s(()=>{r({name:"",type:"spam",action:"warn",enabled:!0,keywords:[],threshold:5,duration:60})},"resetNewRule"),S=s(a=>{a.trim()&&!t.keywords.includes(a.trim())&&r({...t,keywords:[...t.keywords,a.trim()]})},"addKeyword"),K=s(a=>{r({...t,keywords:t.keywords.filter(n=>n!==a)})},"removeKeyword"),E=s(a=>{switch(a){case"spam":return e.jsx(D,{});case"profanity":return e.jsx(Y,{});case"caps":return"ðŸ”¤";case"links":return"ðŸ”—";case"mentions":return"@";default:return e.jsx(y,{})}},"getRuleIcon"),R=s(a=>{switch(a){case"warn":return"#faa61a";case"mute":return"#ff9500";case"kick":return"#ff3b30";case"ban":return"#ff0000";default:return"#8b5cf6"}},"getActionColor");return e.jsx("div",{className:"auto-mod-panel-overlay",onClick:u,children:e.jsxs("div",{className:"auto-mod-panel",onClick:s(a=>a.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(z,{className:"header-icon"}),e.jsx("h2",{children:"Otomatik Moderasyon"}),e.jsx("button",{className:"close-btn",onClick:u,children:"Ã—"})]}),e.jsx("div",{className:"panel-actions",children:e.jsxs("button",{className:"btn-create",onClick:s(()=>h(!0),"onClick"),children:[e.jsx(B,{})," Yeni Kural"]})}),k?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):e.jsx("div",{className:"rules-list",children:d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(y,{size:48}),e.jsx("h3",{children:"Kural Yok"}),e.jsx("p",{children:"Otomatik moderasyon kurallarÄ± oluÅŸturun"})]}):d.map(a=>e.jsxs("div",{className:`rule-card ${a.enabled?"":"disabled"}`,children:[e.jsxs("div",{className:"rule-header",children:[e.jsx("div",{className:"rule-icon",children:E(a.type)}),e.jsxs("div",{className:"rule-info",children:[e.jsx("h3",{children:a.name}),e.jsx("span",{className:"rule-type",children:a.type})]}),e.jsxs("div",{className:"rule-actions",children:[e.jsx("button",{className:"action-btn toggle",onClick:s(()=>w(a.id,!a.enabled),"onClick"),title:a.enabled?"Devre DÄ±ÅŸÄ± BÄ±rak":"EtkinleÅŸtir",children:a.enabled?e.jsx(T,{}):e.jsx(F,{})}),e.jsx("button",{className:"action-btn edit",onClick:s(()=>j(a),"onClick"),title:"DÃ¼zenle",children:e.jsx(O,{})}),e.jsx("button",{className:"action-btn delete",onClick:s(()=>b(a.id),"onClick"),title:"Sil",children:e.jsx(P,{})})]})]}),e.jsxs("div",{className:"rule-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Aksiyon:"}),e.jsx("span",{className:"value action-badge",style:{backgroundColor:R(a.action)},children:a.action})]}),a.keywords&&a.keywords.length>0&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"Anahtar Kelimeler:"}),e.jsx("div",{className:"keywords",children:a.keywords.map((n,o)=>e.jsx("span",{className:"keyword",children:n},o))})]}),a.threshold&&e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"label",children:"EÅŸik:"}),e.jsx("span",{className:"value",children:a.threshold})]})]})]},a.id))}),f&&e.jsx("div",{className:"rule-editor-modal",children:e.jsxs("div",{className:"rule-editor",children:[e.jsx("h3",{children:"Yeni Kural OluÅŸtur"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural AdÄ±"}),e.jsx("input",{type:"text",value:t.name,onChange:s(a=>r({...t,name:a.target.value}),"onChange"),placeholder:"Ã–rn: Spam Engelleme"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kural Tipi"}),e.jsxs("select",{value:t.type,onChange:s(a=>r({...t,type:a.target.value}),"onChange"),children:[e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"profanity",children:"KÃ¼fÃ¼r"}),e.jsx("option",{value:"caps",children:"BÃ¼yÃ¼k Harf"}),e.jsx("option",{value:"links",children:"Link"}),e.jsx("option",{value:"mentions",children:"Mention"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Aksiyon"}),e.jsxs("select",{value:t.action,onChange:s(a=>r({...t,action:a.target.value}),"onChange"),children:[e.jsx("option",{value:"warn",children:"Uyar"}),e.jsx("option",{value:"mute",children:"Sustur"}),e.jsx("option",{value:"kick",children:"At"}),e.jsx("option",{value:"ban",children:"Yasakla"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Anahtar Kelimeler (Enter ile ekle)"}),e.jsx("input",{type:"text",placeholder:"Kelime girin ve Enter'a basÄ±n",onKeyPress:s(a=>{a.key==="Enter"&&(S(a.target.value),a.target.value="")},"onKeyPress")}),e.jsx("div",{className:"keywords-list",children:t.keywords.map((a,n)=>e.jsxs("span",{className:"keyword-chip",children:[a,e.jsx("button",{onClick:s(()=>K(a),"onClick"),children:"Ã—"})]},n))})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"EÅŸik"}),e.jsx("input",{type:"number",value:t.threshold,onChange:s(a=>r({...t,threshold:parseInt(a.target.value)}),"onChange"),min:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SÃ¼re (saniye)"}),e.jsx("input",{type:"number",value:t.duration,onChange:s(a=>r({...t,duration:parseInt(a.target.value)}),"onChange"),min:"1"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:s(()=>h(!1),"onClick"),children:"Ä°ptal"}),e.jsx("button",{className:"btn-save",onClick:v,children:"OluÅŸtur"})]})]})})]})})},"AutoModerationPanel");export{V as default};
