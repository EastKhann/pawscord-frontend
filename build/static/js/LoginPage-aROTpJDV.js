import{r as m,n as o}from"./react-core-zXIKm1Jm.js";import{aj as C,H as z,$ as D,h as O}from"./icons-vendor-BBdoVeJd.js";import{C as y,G as T,i as p,t as M,A as v}from"./index-C08_kc3Q.js";import{u as P}from"./recaptcha-D7lu4pwC.js";import{j as k}from"./crypto-vendor-D_AcF0lD.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./state-vendor-8NbFPBhQ.js";const A=({onLogin:I,onRegister:L,error:b,setAuthError:a})=>{const[u,S]=m.useState(!0),[g,x]=m.useState({username:"",email:"",password:""}),[G,j]=m.useState(!1),{getToken:_}=P();m.useEffect(()=>{if(y.isNativePlatform()){console.log("ğŸ“± [Google] Initializing Google Auth for mobile...");try{T.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}),console.log("âœ… [Google] Initialized successfully")}catch(e){console.error("âŒ [Google] Initialization failed:",e)}}},[]),m.useEffect(()=>{if(p&&window.require){const{ipcRenderer:e}=window.require("electron"),r=(h,l)=>{console.log("âœ… [Electron] Google auth success received");try{const{access:n,refresh:c}=l;if(n&&c){const d=k(n);console.log("ğŸ‘¤ [Electron] User:",d.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",d.username),setTimeout(()=>window.location.reload(),500)}}catch(n){console.error("âŒ [Electron] Token error:",n),a("Token iÅŸleme hatasÄ±.")}},s=(h,l)=>{console.error("âŒ [Electron] Auth error:",l),a(l.error||"Google giriÅŸi baÅŸarÄ±sÄ±z.")},i=(h,l)=>{console.log("ğŸ”— [Electron] OAuth tokens received from main process");try{const{access:n,refresh:c}=l;if(n&&c){const d=k(n);console.log("ğŸ‘¤ [Electron] User from deep link:",d.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",d.username),console.log("âœ… [Electron] Tokens saved, reloading..."),setTimeout(()=>window.location.reload(),500)}}catch(n){console.error("âŒ [Electron] OAuth token error:",n),a("Token iÅŸleme hatasÄ±.")}},t=(h,l)=>{console.log("ğŸš€ [DeepLink] URL YakalandÄ±:",l);try{const n=new URL(l),c=new URLSearchParams(n.search),d=c.get("access"),f=c.get("refresh");if(d&&f){console.log("âœ… [DeepLink] GiriÅŸ BaÅŸarÄ±lÄ±!");const w=k(d);console.log("ğŸ‘¤ [Electron] Decoded user from token:",w.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",d),localStorage.setItem("refresh_token",f),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(n){console.error("Deep link hatasÄ±:",n);try{if(l.includes("access=")&&l.includes("refresh=")){const c=l.split("access=");if(c.length>1){const d=c[1].split("&")[0],f=l.split("refresh=");if(f.length>1){const w=f[1],R=k(d);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",d),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",R.username),window.location.reload()}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}catch(c){console.error("Manual parsing error:",c),a("GiriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z.")}}};return e.on("google-auth-success",r),e.on("google-auth-error",s),e.on("deep-link-auth",t),e.on("oauth-tokens",i),()=>{e.removeListener("google-auth-success",r),e.removeListener("google-auth-error",s),e.removeListener("deep-link-auth",t),e.removeListener("oauth-tokens",i)}}},[a]),m.useEffect(()=>{if(!p){const e=new URLSearchParams(window.location.search),r=e.get("access"),s=e.get("refresh"),i=e.get("error");if(i){console.error("âŒ [Web] OAuth error from URL:",i),a(decodeURIComponent(i)),window.history.replaceState({},document.title,"/");return}if(r&&s){console.log("ğŸŒ [Web] Tokenlar URL'den alÄ±ndÄ± (OAuth success)");try{const t=k(r);console.log("ğŸ‘¤ [Web] Decoded user from token:",t.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",s),localStorage.setItem("chat_username",t.username),console.log("âœ… [Web] Tokens and username saved to localStorage"),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(t){console.error("âŒ [Web] LocalStorage error:",t),a("TarayÄ±cÄ± depolama hatasÄ±. LÃ¼tfen gizli modda deÄŸilseniz kontrol edin.")}}}},[]);const N=async()=>{try{if(console.log("ğŸ”µ [Google] Login baÅŸlatÄ±lÄ±yor...",{isNative:y.isNativePlatform(),isElectron:p,apiUrl:v}),y.isNativePlatform()){console.log("ğŸ“± [Google] Mobile auth flow");const e=await T.signIn();console.log("âœ… [Google] User signed in:",e.email),console.log("ğŸ”‘ [Google] ID Token:",e.authentication.idToken);const r=`${v}/auth/google/native/`;console.log("ğŸ“¡ [Google] Sending to:",r);const s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})});console.log("ğŸ” [Google] Response status:",s.status),console.log("ğŸ” [Google] Response headers:",s.headers);const i=s.headers.get("content-type");if(console.log("ğŸ” [Google] Content-Type:",i),!i||!i.includes("application/json")){const h=await s.text();console.error("âŒ [Google] Backend HTML dÃ¶ndÃ¼:",h.substring(0,500)),a("Backend hatasÄ±: JSON yerine HTML yanÄ±tÄ± alÄ±ndÄ±. Sunucu ayarlarÄ±nÄ± kontrol edin.");return}const t=await s.json();console.log("ğŸ“¦ [Google] Backend response data:",t),s.ok?(console.log("âœ… [Google] Login successful"),t.access&&t.refresh?(localStorage.setItem("access_token",t.access),localStorage.setItem("refresh_token",t.refresh),window.location.reload()):(console.error("âŒ [Google] Tokens eksik:",t),a("Token bilgileri eksik."))):(console.error("âŒ [Google] Login failed:",t),a(t.error||"Google giriÅŸi baÅŸarÄ±sÄ±z."))}else{console.log("ğŸŒ [Google] Web/Electron redirect flow");const s=`${p?"https://api.pawscord.com/api":v}/auth/google/start/?source=${p?"electron":"web"}`;if(console.log("ğŸ”€ [Google] Redirecting to:",s),p&&window.require){const{ipcRenderer:i}=window.require("electron");console.log("âœ… [Google] Opening in Electron popup:",s),i.send("start-google-login",s)}else window.location.href=s}}catch(e){console.error("âŒ [Google] Unexpected error:",e),a("Google giriÅŸi sÄ±rasÄ±nda bir hata oluÅŸtu: "+e.message)}},U=async e=>{e.preventDefault(),j(!0),a("");try{const r=await _(u?"login":"register");u?await I(g.username,g.password,r):await L(g.username,g.email,g.password,r)&&(M.success("KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ± kontrol et.",4e3),S(!0))}catch(r){console.error("âŒ [Login] Beklenmeyen hata:",r),a("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{j(!1)}};return o.jsxs("div",{className:"login-container",children:[o.jsx("div",{className:"background-animate"}),o.jsxs("div",{className:"login-card",children:[o.jsxs("div",{className:"logo-header",children:[o.jsx("div",{className:"logo-circle",children:o.jsx(C,{size:40,color:"white"})}),o.jsx("h1",{children:"Pawscord"}),o.jsx("p",{children:u?"Tekrar hoÅŸgeldin!":"AramÄ±za katÄ±l!"})]}),b&&o.jsx("div",{className:"error-message",children:b}),o.jsxs("form",{onSubmit:U,children:[o.jsxs("div",{className:"input-group",children:[o.jsx(z,{className:"input-icon"}),o.jsx("input",{type:"text",placeholder:"KullanÄ±cÄ± AdÄ±",value:g.username,onChange:e=>x({...g,username:e.target.value}),required:!0})]}),!u&&o.jsxs("div",{className:"input-group slide-down",children:[o.jsx(D,{className:"input-icon"}),o.jsx("input",{type:"email",placeholder:"E-posta Adresi",value:g.email,onChange:e=>x({...g,email:e.target.value}),required:!0})]}),o.jsxs("div",{className:"input-group",children:[o.jsx(O,{className:"input-icon"}),o.jsx("input",{type:"password",placeholder:"Åifre",value:g.password,onChange:e=>x({...g,password:e.target.value}),required:!0})]}),o.jsx("button",{type:"submit",className:"submit-btn",disabled:G,children:G?o.jsx("div",{className:"spinner"}):u?"GiriÅŸ Yap":"KayÄ±t Ol"})]}),u&&o.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:o.jsx("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1",children:"Åifremi Unuttum?"})}),o.jsx("div",{className:"divider",children:o.jsx("span",{children:"veya"})}),o.jsx("div",{className:"google-btn-wrapper",children:o.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5",children:[o.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),o.jsx("span",{children:"Google ile GiriÅŸ Yap"})]})}),o.jsxs("div",{className:"toggle-mode",children:[u?"HesabÄ±n yok mu? ":"Zaten Ã¼ye misin? ",o.jsx("span",{onClick:()=>{S(!u),a("")},children:u?"KayÄ±t Ol":"GiriÅŸ Yap"})]})]})]})};export{A as default};
