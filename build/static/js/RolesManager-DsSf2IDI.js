import{r as m,n as e}from"./react-core-Cj7FUMmY.js";import{h as A}from"./index-BSDoL1zz.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-DnRG7SaF.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const J=({serverId:d,onClose:j})=>{const[t,h]=m.useState([]),[k,b]=m.useState(!0),[y,g]=m.useState(!1),[o,r]=m.useState(null),[x,v]=m.useState(null),[n,p]=m.useState({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0}),f=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}];m.useEffect(()=>{N()},[d]);const N=async()=>{try{b(!0);const a=localStorage.getItem("access_token"),s=await fetch(`/api/roles/${d}/list/`,{headers:{Authorization:`Bearer ${a}`}});if(s.ok){const l=await s.json();h(l.roles||[])}}catch{}finally{b(!1)}},C=async()=>{if(n.name.trim())try{const a=localStorage.getItem("access_token"),s=await fetch(`/api/roles/${d}/create/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(s.ok){const l=await s.json();h([...t,l.role]),g(!1),p({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0})}}catch{}},R=async(a,s)=>{try{const l=localStorage.getItem("access_token"),c=await fetch(`/api/roles/${d}/${a}/update/`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(c.ok){const u=await c.json();h(t.map(i=>i.id===a?u.role:i)),r(null)}}catch{}},S=async a=>{if(await A("Are you sure you want to delete this role?"))try{const s=localStorage.getItem("access_token");(await fetch(`/api/roles/${d}/${a}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok&&h(t.filter(c=>c.id!==a))}catch{}},w=async a=>{try{const s=localStorage.getItem("access_token");(await fetch(`/api/roles/${d}/reorder/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({order:a})})).ok&&N()}catch{}},$=(a,s)=>{v(s),a.dataTransfer.effectAllowed="move"},D=a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},E=(a,s)=>{if(a.preventDefault(),!x||x.id===s.id)return;const l=t.findIndex(i=>i.id===x.id),c=t.findIndex(i=>i.id===s.id),u=[...t];u.splice(l,1),u.splice(c,0,x),h(u),w(u.map(i=>i.id)),v(null)},T=async a=>{try{const s=localStorage.getItem("access_token"),l=await fetch(`/api/roles/${d}/${a}/copy/`,{method:"POST",headers:{Authorization:`Bearer ${s}`}});if(l.ok){const c=await l.json();h([...t,c.role])}}catch{}};return k?e.jsx("div",{className:"roles-manager-overlay",children:e.jsx("div",{className:"roles-manager-modal",children:e.jsx("div",{className:"loading-spinner",children:"Loading roles..."})})}):e.jsx("div",{className:"roles-manager-overlay",onClick:j,children:e.jsxs("div",{className:"roles-manager-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"roles-manager-header",children:[e.jsx("h2",{children:"ğŸ­ Server Roles"}),e.jsx("button",{className:"close-btn",onClick:j,children:"âœ•"})]}),e.jsxs("div",{className:"roles-manager-content",children:[e.jsxs("div",{className:"roles-actions",children:[e.jsx("button",{className:"create-role-btn",onClick:()=>g(!0),children:"â• Create Role"}),e.jsxs("div",{className:"roles-info",children:[e.jsxs("span",{children:[t.length," roles"]}),e.jsx("span",{className:"info-tip",children:"ğŸ’¡ Drag to reorder hierarchy"})]})]}),e.jsx("div",{className:"roles-list",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ğŸ­"}),e.jsx("h3",{children:"No Roles Yet"}),e.jsx("p",{children:"Create roles to organize your server members"})]}):t.map(a=>e.jsxs("div",{className:`role-card ${x?.id===a.id?"dragging":""}`,draggable:!0,onDragStart:s=>$(s,a),onDragOver:D,onDrop:s=>E(s,a),children:[e.jsx("div",{className:"role-drag-handle",children:"â˜°"}),e.jsx("div",{className:"role-color-badge",style:{backgroundColor:a.color}}),e.jsxs("div",{className:"role-info",children:[e.jsx("div",{className:"role-name",style:{color:a.color},children:a.name}),e.jsxs("div",{className:"role-meta",children:[e.jsxs("span",{className:"role-members",children:["ğŸ‘¥ ",a.member_count||0," members"]}),a.hoist&&e.jsx("span",{className:"role-badge",children:"ğŸ“Œ Hoisted"}),a.mentionable&&e.jsx("span",{className:"role-badge",children:"@ Mentionable"})]})]}),e.jsxs("div",{className:"role-actions",children:[e.jsx("button",{className:"role-action-btn edit",onClick:()=>r(a),title:"Edit",children:"âœï¸"}),e.jsx("button",{className:"role-action-btn copy",onClick:()=>T(a.id),title:"Copy",children:"ğŸ“‹"}),e.jsx("button",{className:"role-action-btn delete",onClick:()=>S(a.id),title:"Delete",children:"ğŸ—‘ï¸"})]})]},a.id))})]}),y&&e.jsx("div",{className:"role-modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"role-modal",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{children:"Create New Role"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:n.name,onChange:a=>p({...n,name:a.target.value}),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[f.map(a=>e.jsx("button",{className:`color-preset ${n.color===a.value?"active":""}`,style:{backgroundColor:a.value},onClick:()=>p({...n,color:a.value}),title:a.name},a.value)),e.jsx("input",{type:"color",value:n.color,onChange:a=>p({...n,color:a.target.value}),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.hoist,onChange:a=>p({...n,hoist:a.target.checked})}),e.jsx("span",{children:"Display role members separately from online members"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.mentionable,onChange:a=>p({...n,mentionable:a.target.checked})}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"create-btn",onClick:C,children:"Create Role"})]})]})}),o&&e.jsx("div",{className:"role-modal-overlay",onClick:()=>r(null),children:e.jsxs("div",{className:"role-modal",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{children:"Edit Role"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:o.name,onChange:a=>r({...o,name:a.target.value}),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[f.map(a=>e.jsx("button",{className:`color-preset ${o.color===a.value?"active":""}`,style:{backgroundColor:a.value},onClick:()=>r({...o,color:a.value}),title:a.name},a.value)),e.jsx("input",{type:"color",value:o.color,onChange:a=>r({...o,color:a.target.value}),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.hoist,onChange:a=>r({...o,hoist:a.target.checked})}),e.jsx("span",{children:"Display role members separately"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.mentionable,onChange:a=>r({...o,mentionable:a.target.checked})}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>r(null),children:"Cancel"}),e.jsx("button",{className:"save-btn",onClick:()=>R(o.id,o),children:"Save Changes"})]})]})})]})})};export{J as default};
