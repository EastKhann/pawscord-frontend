import{r as o,o as b,aI as C,l as S,b$ as U,b_ as _,w as G,a1 as H,v as P}from"./react-core-B6hadH-M.js";import{t as y,h as k}from"./index-D_6pZib5.js";const K=({serverId:l,fetchWithAuth:s,apiBaseUrl:i,onClose:R})=>{const[I,z]=o.useState([]),[B,W]=o.useState([]),[m,L]=o.useState(""),[N,V]=o.useState(null),[F,d]=o.useState(!1),[n,c]=o.useState({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3}),[T,E]=o.useState(!0),[u,A]=o.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0});o.useEffect(()=>{g(),D(),f()},[l]);const g=async()=>{E(!0);try{const t=await s(`${i}/moderation/warnings/${l}/`);if(t.ok){const a=await t.json();z(a.results||a)}}catch(t){console.error("Failed to load warnings:",t)}E(!1)},D=async()=>{try{const t=await s(`${i}/servers/${l}/members/`);if(t.ok){const a=await t.json();W(a)}}catch(t){console.error("Failed to load users:",t)}},f=async()=>{try{const t=await s(`${i}/moderation/warnings/stats/${l}/`);if(t.ok){const a=await t.json();A(a)}}catch(t){console.error("Failed to load stats:",t)}},j=async()=>{if(!n.user_id||!n.reason){y.error("âŒ Please select a user and provide a reason");return}try{const t=await s(`${i}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:l,user:n.user_id,reason:n.reason,severity:n.severity,expires_at:new Date(Date.now()+n.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(t.ok){const a=await t.json();a.total_warnings>=n.auto_ban_on&&await k(`User has ${a.total_warnings} warnings. Auto-ban now?`)&&await v(n.user_id,`Auto-ban: ${n.auto_ban_on} warnings reached`),g(),f(),d(!1),c({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3})}else y.error("âŒ Failed to add warning")}catch(t){console.error("Failed to add warning:",t)}},$=async t=>{if(await k("Remove this warning?"))try{(await s(`${i}/moderation/warnings/${t}/`,{method:"DELETE"})).ok?(g(),f()):y.error("âŒ Failed to remove warning")}catch(a){console.error("Failed to remove warning:",a)}},v=async(t,a)=>{try{(await s(`${i}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:l,user:t,reason:a})})).ok&&(y.success("âœ… User banned successfully"),g(),f())}catch(p){console.error("Failed to ban user:",p)}},O=t=>{switch(t){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},h=I.filter(t=>!m||t.user_username?.toLowerCase().includes(m.toLowerCase())||t.reason?.toLowerCase().includes(m.toLowerCase())).reduce((t,a)=>(t[a.user]||(t[a.user]={user_id:a.user,username:a.user_username,warnings:[]}),t[a.user].warnings.push(a),t),{});return React.createElement("div",{style:e.overlay,onClick:R},React.createElement("div",{style:e.panel,onClick:t=>t.stopPropagation()},React.createElement("div",{style:e.header},React.createElement("div",{style:e.headerLeft},React.createElement(b,{style:e.headerIcon}),React.createElement("h2",{style:e.title},"User Warnings")),React.createElement("div",{style:e.headerRight},React.createElement("button",{onClick:()=>d(!0),style:e.addBtn},React.createElement(C,null)," Add Warning"),React.createElement("button",{onClick:R,style:e.closeButton},React.createElement(S,null)))),React.createElement("div",{style:e.statsGrid},React.createElement("div",{style:e.statCard},React.createElement(b,{style:{...e.statIcon,color:"#f0b132"}}),React.createElement("div",{style:e.statValue},u.total_warnings),React.createElement("div",{style:e.statLabel},"Total Warnings")),React.createElement("div",{style:e.statCard},React.createElement(b,{style:{...e.statIcon,color:"#43b581"}}),React.createElement("div",{style:e.statValue},u.active_warnings),React.createElement("div",{style:e.statLabel},"Active")),React.createElement("div",{style:e.statCard},React.createElement(U,{style:{...e.statIcon,color:"#72767d"}}),React.createElement("div",{style:e.statValue},u.expired_warnings),React.createElement("div",{style:e.statLabel},"Expired")),React.createElement("div",{style:e.statCard},React.createElement(_,{style:{...e.statIcon,color:"#ed4245"}}),React.createElement("div",{style:e.statValue},u.auto_banned_users),React.createElement("div",{style:e.statLabel},"Auto-Banned"))),React.createElement("div",{style:e.searchBar},React.createElement(G,{style:e.searchIcon}),React.createElement("input",{type:"text",placeholder:"Search by username or reason...",value:m,onChange:t=>L(t.target.value),style:e.searchInput})),React.createElement("div",{style:e.warningsList},T?React.createElement("div",{style:e.loading},"Loading warnings..."):Object.keys(h).length===0?React.createElement("div",{style:e.empty},React.createElement(b,{style:e.emptyIcon}),React.createElement("p",null,"No warnings found")):Object.values(h).map(({user_id:t,username:a,warnings:p})=>{const x=p.filter(r=>r.is_active),w=x.length>=2;return React.createElement("div",{key:t,style:e.userCard},React.createElement("div",{style:e.userHeader},React.createElement("div",{style:e.userInfo},React.createElement(H,{style:e.userIcon}),React.createElement("div",{style:e.userName},a),React.createElement("span",{style:{...e.badge,backgroundColor:w?"#ed4245":"#f0b132"}},x.length," Active Warning",x.length!==1?"s":""),w&&React.createElement("span",{style:e.riskBadge},"âš ï¸ AT RISK")),x.length>=3&&React.createElement("button",{onClick:()=>v(t,"Auto-ban: 3 warnings"),style:e.banBtn},React.createElement(_,null)," Ban User")),React.createElement("div",{style:e.userWarnings},p.map(r=>React.createElement("div",{key:r.id,style:{...e.warningItem,opacity:r.is_active?1:.5}},React.createElement("div",{style:e.warningLeft},React.createElement("div",{style:{...e.severityDot,backgroundColor:O(r.severity)}}),React.createElement("div",{style:e.warningContent},React.createElement("div",{style:e.warningReason},r.reason),React.createElement("div",{style:e.warningMeta},React.createElement("span",null,r.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"),React.createElement("span",null,"â€¢"),React.createElement("span",null,new Date(r.created_at).toLocaleString()),r.expires_at&&React.createElement(React.Fragment,null,React.createElement("span",null,"â€¢"),React.createElement("span",null,"Expires: ",new Date(r.expires_at).toLocaleDateString())),!r.is_active&&React.createElement(React.Fragment,null,React.createElement("span",null,"â€¢"),React.createElement("span",{style:{color:"#72767d"}},"EXPIRED"))))),r.is_active&&!r.is_auto&&React.createElement("button",{onClick:()=>$(r.id),style:e.removeBtn,title:"Remove warning"},React.createElement(P,null))))))})),F&&React.createElement("div",{style:e.modalOverlay,onClick:()=>d(!1)},React.createElement("div",{style:e.modal,onClick:t=>t.stopPropagation()},React.createElement("div",{style:e.modalHeader},React.createElement("h3",{style:e.modalTitle},"Add Warning"),React.createElement("button",{onClick:()=>d(!1),style:e.modalClose},React.createElement(S,null))),React.createElement("div",{style:e.modalContent},React.createElement("div",{style:e.formGroup},React.createElement("label",{style:e.label},"User"),React.createElement("select",{value:n.user_id,onChange:t=>c({...n,user_id:t.target.value}),style:e.select},React.createElement("option",{value:""},"Select user..."),B.map(t=>React.createElement("option",{key:t.id,value:t.id},t.username)))),React.createElement("div",{style:e.formGroup},React.createElement("label",{style:e.label},"Reason"),React.createElement("textarea",{value:n.reason,onChange:t=>c({...n,reason:t.target.value}),placeholder:"Why is this warning being issued?",style:e.textarea,rows:"3"})),React.createElement("div",{style:e.formGroup},React.createElement("label",{style:e.label},"Severity"),React.createElement("select",{value:n.severity,onChange:t=>c({...n,severity:t.target.value}),style:e.select},React.createElement("option",{value:"low"},"ðŸŸ¢ Low"),React.createElement("option",{value:"medium"},"ðŸŸ¡ Medium"),React.createElement("option",{value:"high"},"ðŸ”´ High"))),React.createElement("div",{style:e.formGroup},React.createElement("label",{style:e.label},"Expires In (Days)"),React.createElement("input",{type:"number",value:n.expires_in_days,onChange:t=>c({...n,expires_in_days:parseInt(t.target.value)}),style:e.input,min:"1",max:"365"})),React.createElement("div",{style:e.formGroup},React.createElement("label",{style:e.label},"Auto-ban Threshold"),React.createElement("input",{type:"number",value:n.auto_ban_on,onChange:t=>c({...n,auto_ban_on:parseInt(t.target.value)}),style:e.input,min:"2",max:"10"}),React.createElement("div",{style:e.hint},"User will be auto-banned after reaching ",n.auto_ban_on," active warnings"))),React.createElement("div",{style:e.modalActions},React.createElement("button",{onClick:()=>d(!1),style:e.cancelBtn},"Cancel"),React.createElement("button",{onClick:j,style:e.submitBtn},React.createElement(C,null)," Add Warning"))))))},e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}};export{K as default};
