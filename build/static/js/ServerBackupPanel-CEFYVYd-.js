import{r,n as e}from"./react-core-zXIKm1Jm.js";import{y as n}from"./ui-vendor-BGw4w3Ed.js";import{g as v}from"./index-DzDUXmXs.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-BBdoVeJd.js";import"./state-vendor-8NbFPBhQ.js";const T=({serverId:l,onClose:h})=>{const t=v(),[o,k]=r.useState([]),[x,j]=r.useState(!0),[m,p]=r.useState(!1),[c,i]=r.useState({include_channels:!0,include_roles:!0,include_messages:!1,include_settings:!0,include_emojis:!0});r.useEffect(()=>{d()},[l]);const d=async()=>{try{const s=await fetch(`${t}/backups/server/${l}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();k(a)}}catch(s){console.error("Error:",s)}finally{j(!1)}},g=async()=>{p(!0);try{(await fetch(`${t}/backups/create/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:l,...c})})).ok?(n.success("âœ… Yedek oluÅŸturuluyor..."),d()):n.error("âŒ Yedek oluÅŸturulamadÄ±")}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{p(!1)}},b=async s=>{if(window.confirm("Sunucuyu bu yedeÄŸe geri yÃ¼klemek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz!"))try{(await fetch(`${t}/backups/${s}/restore/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok?n.success("âœ… Sunucu geri yÃ¼kleniyor..."):n.error("âŒ Geri yÃ¼kleme hatasÄ±")}catch{n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},f=async s=>{try{const a=await fetch(`${t}/backups/${s}/download/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const B=await a.blob(),S=window.URL.createObjectURL(B),u=document.createElement("a");u.href=S,u.download=`backup_${s}.json`,u.click(),n.success("âœ… Yedek indiriliyor")}}catch{n.error("âŒ Ä°ndirme hatasÄ±")}},y=async s=>{if(window.confirm("YedeÄŸi silmek istediÄŸinize emin misiniz?"))try{(await fetch(`${t}/backups/${s}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(n.success("âœ… Yedek silindi"),d())}catch{n.error("âŒ Silme hatasÄ±")}},N=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(2)+" KB":(s/(1024*1024)).toFixed(2)+" MB",_=s=>{const a={completed:{text:"TamamlandÄ±",color:"#22c55e",icon:"âœ…"},processing:{text:"Ä°ÅŸleniyor",color:"#f59e0b",icon:"â³"},failed:{text:"BaÅŸarÄ±sÄ±z",color:"#ef4444",icon:"âŒ"}};return a[s]||a.processing};return e.jsx("div",{className:"backup-overlay",onClick:h,children:e.jsxs("div",{className:"backup-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"backup-header",children:[e.jsx("h2",{children:"ğŸ’¾ Sunucu Yedekleme"}),e.jsx("button",{className:"close-btn",onClick:h,children:"Ã—"})]}),e.jsxs("div",{className:"backup-content",children:[e.jsxs("div",{className:"create-backup-section",children:[e.jsx("h3",{children:"Yeni Yedek OluÅŸtur"}),e.jsxs("div",{className:"backup-options",children:[e.jsxs("label",{className:"option-label",children:[e.jsx("input",{type:"checkbox",checked:c.include_channels,onChange:s=>i({...c,include_channels:s.target.checked})}),e.jsx("span",{children:"ğŸ“ KanallarÄ± dahil et"})]}),e.jsxs("label",{className:"option-label",children:[e.jsx("input",{type:"checkbox",checked:c.include_roles,onChange:s=>i({...c,include_roles:s.target.checked})}),e.jsx("span",{children:"ğŸ­ Rolleri dahil et"})]}),e.jsxs("label",{className:"option-label",children:[e.jsx("input",{type:"checkbox",checked:c.include_messages,onChange:s=>i({...c,include_messages:s.target.checked})}),e.jsx("span",{children:"ğŸ’¬ MesajlarÄ± dahil et (son 100)"})]}),e.jsxs("label",{className:"option-label",children:[e.jsx("input",{type:"checkbox",checked:c.include_settings,onChange:s=>i({...c,include_settings:s.target.checked})}),e.jsx("span",{children:"âš™ï¸ AyarlarÄ± dahil et"})]}),e.jsxs("label",{className:"option-label",children:[e.jsx("input",{type:"checkbox",checked:c.include_emojis,onChange:s=>i({...c,include_emojis:s.target.checked})}),e.jsx("span",{children:"ğŸ˜€ Emojileri dahil et"})]})]}),e.jsx("button",{className:"create-backup-btn",onClick:g,disabled:m,children:m?"â³ OluÅŸturuluyor...":"ğŸ’¾ Yedek OluÅŸtur"})]}),x?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ’¾"}),e.jsx("p",{children:"HenÃ¼z yedek yok"})]}):e.jsxs("div",{className:"backups-list",children:[e.jsxs("h3",{children:["Mevcut Yedekler (",o.length,")"]}),o.map(s=>{const a=_(s.status);return e.jsxs("div",{className:"backup-card",children:[e.jsx("div",{className:"backup-info",children:e.jsxs("div",{className:"backup-main",children:[e.jsxs("h4",{children:["Yedek #",s.id]}),e.jsxs("div",{className:"backup-meta",children:[e.jsxs("span",{children:["ğŸ“… ",new Date(s.created_at).toLocaleString("tr-TR")]}),e.jsxs("span",{children:["ğŸ“¦ ",N(s.file_size)]}),e.jsxs("span",{className:"status-badge",style:{background:a.color},children:[a.icon," ",a.text]})]}),e.jsxs("div",{className:"backup-includes",children:[s.includes_channels&&e.jsx("span",{className:"include-badge",children:"ğŸ“ Kanallar"}),s.includes_roles&&e.jsx("span",{className:"include-badge",children:"ğŸ­ Roller"}),s.includes_messages&&e.jsx("span",{className:"include-badge",children:"ğŸ’¬ Mesajlar"}),s.includes_settings&&e.jsx("span",{className:"include-badge",children:"âš™ï¸ Ayarlar"}),s.includes_emojis&&e.jsx("span",{className:"include-badge",children:"ğŸ˜€ Emojiler"})]})]})}),s.status==="completed"&&e.jsxs("div",{className:"backup-actions",children:[e.jsx("button",{className:"restore-btn",onClick:()=>b(s.id),children:"ğŸ”„ Geri YÃ¼kle"}),e.jsx("button",{className:"download-btn",onClick:()=>f(s.id),children:"ğŸ“¥ Ä°ndir"}),e.jsx("button",{className:"delete-btn",onClick:()=>y(s.id),children:"ğŸ—‘ï¸ Sil"})]})]},s.id)})]})]})]})})};export{T as default};
