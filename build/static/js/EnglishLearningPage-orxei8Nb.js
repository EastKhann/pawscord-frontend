var P=Object.defineProperty;var p=(e,l)=>P(e,"name",{value:l,configurable:!0});import{r as o,j as t}from"./react-core-Djgtqrmb.js";import{b as M,L as T}from"./router-vendor-ClgLnMjk.js";import{A as v,u as N}from"./index-Dy0QUtja.js";import"./media-vendor-CxFPycob.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";import"./ui-vendor-IhB9Znpc.js";const A=`${v}/auth/token/refresh/`,G=`${v}/eng-learn/words/`,$=`${v}/eng-learn/known-words/`,U=`${v}/eng-learn/mark-known/`,H=p(()=>localStorage.getItem("access_token"),"getToken");function Y(){const[e,l]=o.useState({}),[g,y]=o.useState({}),[b,R]=o.useState([]),[a,S]=o.useState(""),[m,C]=o.useState(null),[_,W]=o.useState(!1),[w,E]=o.useState(!0),[z,D]=o.useState(null),[O,B]=o.useState(!1),L=M(),k=o.useCallback(()=>{localStorage.removeItem("access_token"),L("/")},[L]),h=o.useCallback(async(s,n={})=>{const i=p(async()=>{const d=H(),c=n.headers||{};return d&&(c.Authorization=`Bearer ${d}`),n.body instanceof FormData||(c["Content-Type"]="application/json"),fetch(s,{...n,headers:c,credentials:"include"})},"originalFetch");let x=await i();if(x.status===401&&s!==A)try{const d=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({})}),c=await d.json();if(!d.ok)throw k(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",c.access),x=await i()}catch(d){throw k(),d}return x},[k]);o.useEffect(()=>{p(async()=>{try{const[n,i]=await Promise.all([h(G),h($)]);if(!n.ok)throw n.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!i.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const x=await n.json(),d=await i.json(),c=Object.keys(x||{}).sort();l(x),y(d||{}),R(c),c.length>0&&S(c[0])}catch(n){D(n.message)}finally{E(!1)}},"fetchInitialData")()},[h]);const u=o.useMemo(()=>{if(!a||!e[a])return[];const s=new Set(g[a]||[]);return e[a].filter(n=>!s.has(n.term))},[e,a,g]),I=o.useMemo(()=>{const s=e[a]?.length||0,n=g[a]?.length||0;return{totalWords:s,knownWords:n,progress:Math.round(s>0?n/s*100:0)}},[a,e,g]),K=o.useMemo(()=>{let s=0,n=0;return Object.values(e).forEach(i=>{s+=i.length}),Object.values(g).forEach(i=>{n+=i.length}),{totalWords:s,totalKnownWords:n,progress:Math.round(s>0?n/s*100:0)}},[e,g]),j=o.useCallback(()=>{if(W(!1),B(!1),u.length===0){C(null),a&&B(!0);return}C(u[Math.floor(Math.random()*u.length)])},[u,a]);o.useEffect(()=>{!w&&b.length>0&&j()},[a,w,b,u,j]);const F=o.useCallback(async()=>{if(m)try{const s=await h(U,{method:"POST",body:JSON.stringify({level:a,word:m.term})});if(!s.ok)throw new Error("Kelime kaydedilemedi");y(await s.json())}catch{}},[m,a,h]),{globalData:f}=N();return o.useEffect(()=>{f?.type==="user_profile_update"&&f.user_data?.known_words&&y(f.user_data.known_words)},[f]),{allData:e,availableLevels:b,currentLevel:a,setCurrentLevel:S,currentWord:m,showAnswer:_,setShowAnswer:W,isLoading:w,error:z,levelComplete:O,levelStats:I,totalStats:K,availableWordsForLevel:u,getNewWord:j,handleMarkAsKnown:F}}p(Y,"useEnglishLearning");const r={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};function oe(){const e=Y();return e.isLoading?t.jsx("div",{style:r.pageContainer,children:"YÃ¼kleniyor..."}):e.error?t.jsxs("div",{style:r.pageContainer,children:[t.jsxs("h1",{style:r.errorText,children:["Hata: ",e.error]}),t.jsx(T,{to:"/",style:r.backButton,children:"Sohbete Geri DÃ¶n"})]}):t.jsxs("div",{style:r.pageContainer,children:[t.jsxs(T,{to:"/eng-learn",style:r.backButton,children:["â†"," Merkeze DÃ¶n"]}),t.jsxs("div",{style:r.quizContainer,children:[t.jsxs("h1",{style:r.pageTitle,children:["Ä°","ngilizce Kelime ","Ã–ÄŸren"]}),t.jsxs("div",{style:r.levelAndProgressContainer,children:[t.jsxs("div",{style:r.controls,children:[t.jsx("label",{htmlFor:"level-select",style:r.label,children:"Seviye:"}),t.jsx("select",{id:"level-select",value:e.currentLevel,onChange:p(l=>e.setCurrentLevel(l.target.value),"onChange"),style:r.select,children:e.availableLevels.map(l=>t.jsxs("option",{value:l,children:[l.toUpperCase()," (",e.allData[l]?.length||0," kelime)"]},l))})]}),t.jsxs("div",{style:r.progressStats,children:[t.jsxs("span",{children:["BildiÄŸiniz: ",t.jsx("strong",{children:e.levelStats.knownWords})]}),t.jsxs("span",{children:["Toplam: ",t.jsx("strong",{children:e.levelStats.totalWords})]})]})]}),t.jsxs("div",{style:{...r.progressBarBackground,marginBottom:"20px"},children:[t.jsx("div",{style:{...r.progressBarFill,width:`${e.levelStats.progress}%`},children:e.levelStats.progress>15&&t.jsxs("span",{children:[e.levelStats.progress,"%"]})}),e.levelStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.levelStats.progress,"%"]})]}),t.jsxs("div",{children:[t.jsxs("h4",{style:r.totalStatsHeader,children:["Genel Toplam ","Ä°","lerleme"]}),t.jsxs("div",{style:{...r.progressStats,marginBottom:"8px"},children:[t.jsxs("span",{children:["Toplam BildiÄŸiniz: ",t.jsx("strong",{children:e.totalStats.totalKnownWords})]}),t.jsxs("span",{children:["Toplam Kelime: ",t.jsx("strong",{children:e.totalStats.totalWords})]})]}),t.jsxs("div",{style:r.progressBarBackground,children:[t.jsx("div",{style:{...r.progressBarFill,...r.totalProgressBarFill,width:`${e.totalStats.progress}%`},children:e.totalStats.progress>15&&t.jsxs("span",{children:[e.totalStats.progress,"%"]})}),e.totalStats.progress<=15&&t.jsxs("span",{style:r.progressTextOutside,children:[e.totalStats.progress,"%"]})]})]}),t.jsx("div",{style:r.wordArea,children:e.levelComplete?t.jsxs("h2",{style:{...r.term,color:"var(--text-positive)"},children:["Tebrikler! ","ðŸŽ‰",t.jsx("br",{}),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."]}):e.currentWord?t.jsxs(t.Fragment,{children:[t.jsx("h2",{style:r.term,children:e.currentWord.term}),e.showAnswer&&t.jsx("p",{style:r.meanings,children:e.currentWord.meanings.join(" / ")})]}):t.jsx("p",{children:"Bu seviyede kelime bulunamadÄ±."})}),t.jsxs("div",{style:r.buttonGroup,children:[t.jsx("button",{style:r.actionButton,onClick:p(()=>e.setShowAnswer(!0),"onClick"),disabled:e.showAnswer||!e.currentWord||e.levelComplete,children:"CevabÄ± GÃ¶ster"}),t.jsx("button",{style:{...r.actionButton,...r.knownButton},onClick:e.handleMarkAsKnown,disabled:!e.currentWord||e.levelComplete,children:"Biliyorum (GeÃ§)"}),t.jsx("button",{style:{...r.actionButton,...r.primaryButton},onClick:e.getNewWord,disabled:e.levelComplete||e.availableWordsForLevel.length<=1,children:"Yeni Kelime"})]})]})]})}p(oe,"EnglishLearningPage");export{oe as default};
