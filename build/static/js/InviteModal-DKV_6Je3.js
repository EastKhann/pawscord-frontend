import{r as a,n as t,f as Y}from"./react-core-BMiyQWF6.js";import{a as U,f as K,ar as Q,b4 as V}from"./icons-vendor-GUGjkvMm.js";import{t as s}from"./index-CiuOrqQ3.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const de=({onClose:g,server:c,fetchWithAuth:l,apiBaseUrl:d,currentUser:T})=>{const[p,y]=a.useState(""),[m,W]=a.useState(0),[x,_]=a.useState(0),[b,v]=a.useState(!1),[h,k]=a.useState(!1),[R,D]=a.useState([]),[O,j]=a.useState(!1),[S,z]=a.useState(""),[L,w]=a.useState(new Set),[u,$]=a.useState(T||"");a.useEffect(()=>{F(),A()},[]);const F=async()=>{if(!u)try{const e=await l(`${d}/users/me/`);if(e.ok){const o=await e.json();$(o.username)}}catch{}},A=async()=>{j(!0);try{const e=await l(`${d}/friends/list/`);if(e.ok){const o=await e.json(),r=Array.isArray(o)?o:o.friends||[];D(r)}}catch{}finally{j(!1)}},E=async e=>{w(o=>new Set(o).add(e));try{const o={server_id:c.id,max_uses:1,expires_in_hours:24},r=await l(`${d}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const J=await r.json();throw new Error(J.error||"Davet oluşturulamadı")}const i=await r.json(),q=i.code,f=i.url||i.invite_link,B=await l(`${d}/conversations/find_or_create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_username:e})});if(!B.ok)throw new Error("DM oluşturulamadı");const G={conversation_id:(await B.json()).conversation_id,content:`Hey! Seni **${c.name}** sunucusuna davet ediyorum. Katılmak için:
${f}`};(await l(`${d}/messages/send_dm/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)})).ok?s.success(`${e} kullanıcısına davet DM olarak gönderildi!`):(navigator.clipboard.writeText(f),s.success(`Davet linki oluşturuldu ve panoya kopyalandı!

${e} ile manuel olarak paylaşabilirsiniz:

${f}`,5e3))}catch(o){w(r=>{const i=new Set(r);return i.delete(e),i}),s.error("Davet gönderilemedi: "+o.message)}},C=e=>u?e.sender_username===u?e.receiver_username:e.sender_username:e.receiver_username,I=R.filter(e=>C(e).toLowerCase().includes(S.toLowerCase())),M=async()=>{if(!c||!c.id){s.error("Hata: Sunucu bilgisi bulunamadı!");return}k(!0);try{const e={server_id:c.id,max_uses:m===0?0:m,expires_in_hours:Math.floor(x/60)},o=await l(`${d}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await o.json();if(o.ok){const i=r.url||r.invite_link||`https://www.pawscord.com/#/invite/${r.code}`;if(!i){s.error("Hata: Davet linki oluşturulamadı (URL yok)");return}y(i),s.success(`Davet linki oluşturuldu!
${i}`,4e3)}else s.error(r.error||"Davet oluşturulamadı.")}catch(e){s.error("Bağlantı hatası: "+e.message)}finally{k(!1)}},N=()=>{navigator.clipboard.writeText(p),v(!0),setTimeout(()=>v(!1),2e3)},P=[{label:"30 Dk",value:30},{label:"1 Gün",value:1440},{label:"Süresiz",value:0}],H=t.jsx("div",{style:n.overlay,onClick:g,children:t.jsxs("div",{style:n.modal,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:n.header,children:[t.jsx("h2",{style:n.title,children:"Arkadaşlarını Davet Et"}),t.jsx("button",{onClick:g,style:n.closeBtn,children:t.jsx(U,{})})]}),t.jsxs("div",{style:n.content,children:[t.jsxs("div",{style:n.friendSection,children:[t.jsxs("div",{style:n.searchBox,children:[t.jsx(K,{style:n.searchIcon}),t.jsx("input",{type:"text",placeholder:"Arkadaş ara...",style:n.searchInput,value:S,onChange:e=>z(e.target.value)})]}),t.jsx("div",{style:n.friendList,children:O?t.jsx("div",{style:n.loadingText,children:"Yükleniyor..."}):I.length===0?t.jsx("div",{style:n.emptyText,children:"Arkadaş bulunamadı."}):I.map(e=>{const o=C(e),r=L.has(o),i=e.sender_username===o?e.sender_avatar:e.receiver_avatar;return t.jsxs("div",{style:n.friendItem,children:[t.jsxs("div",{style:n.friendInfo,children:[t.jsx("div",{style:n.friendAvatar,children:i?t.jsx("img",{src:i,alt:o,style:n.avatarImg}):t.jsx("span",{children:o.charAt(0).toUpperCase()})}),t.jsx("span",{style:n.friendName,children:o})]}),t.jsx("button",{onClick:()=>!r&&E(o),style:{...n.inviteBtn,...r?n.inviteBtnSent:{}},disabled:r,children:r?"Gönderildi":"Davet Et"})]},e.id)})})]}),t.jsx("div",{style:n.divider,children:t.jsx("span",{children:"VEYA LİNK OLUŞTUR"})}),t.jsxs("div",{style:n.linkSection,children:[t.jsx("div",{style:n.optionsRow,children:P.map(e=>t.jsx("button",{onClick:()=>_(e.value),style:{...n.miniOptionBtn,...x===e.value&&n.optionBtnActive},children:e.label},e.value))}),t.jsx("div",{style:n.linkBoxContainer,children:p?t.jsxs("div",{style:n.linkBox,children:[t.jsx("input",{type:"text",value:p,readOnly:!0,style:n.linkInput}),t.jsx("button",{onClick:N,style:{...n.copyBtn,...b&&n.copyBtnSuccess},children:b?t.jsx(Q,{}):t.jsx(V,{})})]}):t.jsx("button",{onClick:M,disabled:h,style:n.generateBtn,children:h?"Link Oluşturuluyor...":"Davet Linki Oluştur"})}),p&&t.jsxs("div",{style:n.footerLinkOpts,children:[t.jsx("small",{style:{color:"#b9bbbe"},children:x===0?"Süre sınırı yok":`${x} dakika geçerli`}),t.jsx("button",{onClick:()=>y(""),style:n.textBtn,children:"Yeni Link"})]})]})]})]})});return Y.createPortal(H,document.body)},n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,backdropFilter:"blur(5px)",margin:0,padding:0},modal:{backgroundColor:"#313338",borderRadius:"8px",width:"440px",maxWidth:"90%",maxHeight:"85%",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0,0,0,0.5)",overflow:"hidden",position:"relative",margin:0},header:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{margin:0,color:"#f2f3f5",fontSize:"16px",fontWeight:"bold",textTransform:"uppercase"},closeBtn:{background:"none",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"20px"},content:{padding:"0 20px 20px 20px",display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},friendSection:{flex:1,display:"flex",flexDirection:"column",minHeight:"200px",marginBottom:"10px"},searchBox:{backgroundColor:"#1e1f22",borderRadius:"4px",padding:"0 10px",display:"flex",alignItems:"center",marginBottom:"10px",border:"1px solid #1e1f22"},searchIcon:{color:"#b5bac1",marginRight:"8px"},searchInput:{backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px 0",flex:1,outline:"none",fontSize:"14px"},friendList:{flex:1,overflowY:"auto",paddingRight:"5px"},friendItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #3f4147"},friendInfo:{display:"flex",alignItems:"center",gap:"10px"},friendAvatar:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",overflow:"hidden"},avatarImg:{width:"100%",height:"100%",objectFit:"cover"},friendName:{color:"#f2f3f5",fontSize:"14px",fontWeight:"500"},inviteBtn:{padding:"6px 16px",backgroundColor:"transparent",border:"1px solid #23a559",color:"#23a559",borderRadius:"3px",cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.2s"},inviteBtnSent:{backgroundColor:"transparent",border:"1px solid #b5bac1",color:"#b5bac1",cursor:"default"},loadingText:{color:"#b5bac1",textAlign:"center",marginTop:"20px",fontSize:"13px"},emptyText:{color:"#b5bac1",textAlign:"center",marginTop:"20px",fontSize:"13px"},divider:{display:"flex",alignItems:"center",justifyContent:"center",margin:"15px 0",color:"#b5bac1",fontSize:"11px",fontWeight:"bold",position:"relative"},linkSection:{backgroundColor:"#2b2d31",margin:"0 -20px -20px -20px",padding:"20px",borderTop:"1px solid #1e1f22"},optionsRow:{display:"flex",gap:"10px",marginBottom:"15px"},miniOptionBtn:{flex:1,padding:"8px",backgroundColor:"#1e1f22",border:"none",borderRadius:"4px",color:"#b5bac1",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},optionBtnActive:{backgroundColor:"#404249",color:"#f2f3f5"},linkBoxContainer:{display:"flex",gap:"10px"},linkBox:{display:"flex",flex:1,backgroundColor:"#1e1f22",borderRadius:"4px",padding:"2px",border:"1px solid #1e1f22",alignItems:"center"},linkInput:{flex:1,backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px",fontSize:"13px",outline:"none",textOverflow:"ellipsis"},copyBtn:{padding:"8px 20px",backgroundColor:"#5865f2",border:"none",borderRadius:"3px",color:"white",cursor:"pointer",height:"100%",marginRight:"2px"},copyBtnSuccess:{backgroundColor:"#23a559"},generateBtn:{width:"100%",padding:"10px",backgroundColor:"#5865f2",border:"none",borderRadius:"3px",color:"white",fontWeight:"500",cursor:"pointer",fontSize:"13px"},footerLinkOpts:{display:"flex",justifyContent:"space-between",marginTop:"10px",alignItems:"center"},textBtn:{background:"none",border:"none",color:"#00a8fc",fontSize:"12px",cursor:"pointer",padding:0}};export{de as default};
