var E=Object.defineProperty;var s=(r,a)=>E(r,"name",{value:a,configurable:!0});import{r as p,j as e}from"./react-core-Djgtqrmb.js";import{z as T,aL as z,v as S,w as k,a5 as m,a as b,bc as F}from"./icons-vendor-BMXAt4pj.js";import{t as l,d as B}from"./index-DwVhiipM.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const j=[{id:"messages",name:"Messages",description:"Export all your messages"},{id:"server",name:"Server Data",description:"Export server content"},{id:"dm",name:"Direct Messages",description:"Export DM history"},{id:"media",name:"Media Files",description:"Export uploaded media"},{id:"profile",name:"Profile Data",description:"Export your profile info"},{id:"analytics",name:"Analytics",description:"Export analytics data"}],D=s(r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(2)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(2)} MB`:`${(r/(1024*1024*1024)).toFixed(2)} GB`,"formatFileSize"),R={completed:e.jsx(k,{style:{color:"#43b581"}}),processing:e.jsx(S,{style:{color:"#faa61a"},className:"fa-spin"}),failed:e.jsx(z,{style:{color:"#f04747"}})},L={completed:"#43b581",processing:"#faa61a",failed:"#f04747"},I=s(r=>R[r]||e.jsx(T,{style:{color:"#99aab5"}}),"getStatusIcon"),$=s(r=>L[r]||"#99aab5","getStatusColor");function J(r,a){const[x,n]=p.useState([]),[o,g]=p.useState(!0),[y,C]=p.useState("messages"),[v,u]=p.useState(!1),f=s(async()=>{try{const d=await(await r(`${a}/exports/jobs/`)).json();n(d.jobs||[])}catch{}finally{g(!1)}},"loadExportJobs");return p.useEffect(()=>{f();const i=setInterval(f,5e3);return()=>clearInterval(i)},[]),{jobs:x,loading:o,exportType:y,setExportType:C,creating:v,createExport:s(async()=>{u(!0);try{const d=await(await r(`${a}/exports/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:y})})).json();d.success?(l.success("Export job created! Processing..."),f()):l.error(d.error||"Failed to create export")}catch{l.error("Failed to create export")}finally{u(!1)}},"createExport"),downloadExport:s(async i=>{try{const w=await(await r(`${a}/exports/${i}/download/`)).blob(),h=window.URL.createObjectURL(w),c=document.createElement("a");c.href=h,c.download=`export_${i}.zip`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(h),l.success("Download started!")}catch{l.error("Download failed")}},"downloadExport"),deleteJob:s(async i=>{if(await B("Delete this export job?"))try{await r(`${a}/exports/${i}/delete/`,{method:"DELETE"}),l.success("Export job deleted"),f()}catch{l.error("Failed to delete job")}},"deleteJob")}}s(J,"useExportJobs");const t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},createSection:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",marginBottom:"24px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},exportTypeSelector:{display:"flex",gap:"12px"},select:{flex:1,padding:"10px",backgroundColor:"#202225",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px"},createBtn:{padding:"10px 24px",backgroundColor:"#5865f2",border:"none",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},jobsSection:{marginBottom:"24px"},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},empty:{textAlign:"center",padding:"60px 20px",color:"#dcddde"},jobsList:{display:"flex",flexDirection:"column",gap:"12px"},jobCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center",gap:"16px"},jobIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},jobDetails:{flex:1},jobTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"4px"},jobMeta:{fontSize:"12px",color:"#99aab5",marginBottom:"8px"},progressBar:{position:"relative",height:"20px",backgroundColor:"#202225",borderRadius:"10px",overflow:"hidden",marginTop:"8px"},progressFill:{height:"100%",backgroundColor:"#5865f2",transition:"width 0.3s ease"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:"600",color:"#fff"},fileSize:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},jobActions:{display:"flex",alignItems:"center",gap:"8px"},statusBadge:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},downloadBtn:{padding:"8px 12px",backgroundColor:"#43b581",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},deleteBtn:{padding:"8px 12px",backgroundColor:"#f04747",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},info:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},infoText:{fontSize:"14px",color:"#dcddde",margin:"8px 0",lineHeight:"1.6"}},X=s(({fetchWithAuth:r,apiBaseUrl:a,onClose:x})=>{const n=J(r,a);return e.jsx("div",{style:t.overlay,onClick:x,children:e.jsxs("div",{style:t.modal,onClick:s(o=>o.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(m,{style:{fontSize:"24px",color:"#5865f2"}}),e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"Export Jobs"})]}),e.jsx("button",{onClick:x,style:t.closeBtn,children:e.jsx(b,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.createSection,children:[e.jsx("h3",{style:t.sectionTitle,children:"Create New Export"}),e.jsxs("div",{style:t.exportTypeSelector,children:[e.jsx("select",{value:n.exportType,onChange:s(o=>n.setExportType(o.target.value),"onChange"),style:t.select,children:j.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",o.description]},o.id))}),e.jsx("button",{onClick:n.createExport,disabled:n.creating,style:t.createBtn,children:n.creating?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"fa-spin"})," Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{})," Create Export"]})})]})]}),e.jsxs("div",{style:t.jobsSection,children:[e.jsx("h3",{style:t.sectionTitle,children:"Your Export Jobs"}),n.loading?e.jsx("div",{style:t.loading,children:"Loading jobs..."}):n.jobs.length===0?e.jsxs("div",{style:t.empty,children:[e.jsx(F,{style:{fontSize:"48px",color:"#99aab5",marginBottom:"16px"}}),e.jsx("p",{children:"No export jobs yet"}),e.jsx("p",{style:{fontSize:"14px",color:"#99aab5"},children:"Create your first export to get started"})]}):e.jsx("div",{style:t.jobsList,children:n.jobs.map(o=>e.jsxs("div",{style:t.jobCard,children:[e.jsx("div",{style:t.jobIcon,children:I(o.status)}),e.jsxs("div",{style:t.jobDetails,children:[e.jsx("div",{style:t.jobTitle,children:j.find(g=>g.id===o.type)?.name||o.type}),e.jsxs("div",{style:t.jobMeta,children:[e.jsxs("span",{children:["Created: ",new Date(o.created_at).toLocaleString()]}),o.completed_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{margin:"0 8px"},children:"â€¢"}),e.jsxs("span",{children:["Completed: ",new Date(o.completed_at).toLocaleString()]})]})]}),o.status==="processing"&&o.progress&&e.jsxs("div",{style:t.progressBar,children:[e.jsx("div",{style:{...t.progressFill,width:`${o.progress}%`}}),e.jsxs("span",{style:t.progressText,children:[o.progress,"%"]})]}),o.file_size&&e.jsxs("div",{style:t.fileSize,children:["Size: ",D(o.file_size)]})]}),e.jsxs("div",{style:t.jobActions,children:[e.jsx("span",{style:{...t.statusBadge,backgroundColor:$(o.status)},children:o.status}),o.status==="completed"&&e.jsx("button",{onClick:s(()=>n.downloadExport(o.id),"onClick"),style:t.downloadBtn,title:"Download",children:e.jsx(m,{})}),e.jsx("button",{onClick:s(()=>n.deleteJob(o.id),"onClick"),style:t.deleteBtn,title:"Delete",children:e.jsx(b,{})})]})]},o.id))})]}),e.jsxs("div",{style:t.info,children:[e.jsxs("p",{style:t.infoText,children:["ðŸ“¦"," Exports are processed in the background and may take a few minutes"]}),e.jsxs("p",{style:t.infoText,children:["ðŸ’¾"," Completed exports are available for 7 days before auto-deletion"]})]})]})]})})},"ExportJobsPanel");export{X as default};
