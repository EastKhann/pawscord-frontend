import{r as o,n as e,f as H}from"./react-core-Cj7FUMmY.js";import{a8 as A,a as M,h as J,ap as Y,as as K,l as G,c as Q}from"./icons-vendor-DnRG7SaF.js";import{t as l}from"./index-BMfm-Nut.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const re=({onClose:p,server:a,fetchWithAuth:d,apiBaseUrl:c,currentUser:m})=>{const[h,z]=o.useState([]),[F,b]=o.useState(!1),[f,B]=o.useState(""),[O,v]=o.useState(new Set),[x,k]=o.useState(""),[S,j]=o.useState(!1),[w,g]=o.useState(!0),[u,C]=o.useState(!1),I=o.useRef(null);o.useEffect(()=>{E(),L(),setTimeout(()=>I.current?.focus(),100)},[]);const L=async()=>{if(!a?.id){g(!1);return}g(!0);try{const t=await d(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:0,expires_in_hours:0})});if(t.ok){const i=await t.json(),r=i.url||i.invite_link||`https://www.pawscord.com/#/invite/${i.code}`;k(r)}else{const i=await t.json().catch(()=>({}))}}catch{}finally{g(!1)}},D=async()=>{if(a?.id){C(!0);try{const t=await d(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:0,expires_in_hours:0})});if(t.ok){const i=await t.json(),r=i.url||i.invite_link||`https://www.pawscord.com/#/invite/${i.code}`;k(r),l.success("ğŸ”— Yeni davet linki oluÅŸturuldu!")}else l.error("Link oluÅŸturulamadÄ±")}catch(t){l.error("Link oluÅŸturulurken hata: "+t.message)}finally{C(!1)}}},E=async()=>{b(!0);try{const t=await d(`${c}/friends/list/`);if(t.ok){const i=await t.json(),r=Array.isArray(i)?i:i.friends||[];z(r)}}catch{}finally{b(!1)}},N=async t=>{v(i=>new Set(i).add(t));try{let i=x;if(!i){const T=await d(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({server_id:a.id,max_uses:1,expires_in_hours:24})});if(!T.ok)throw new Error("Davet oluÅŸturulamadÄ±");const _=await T.json();i=_.url||_.invite_link}const r=await d(`${c}/conversations/find_or_create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_username:t})});if(!r.ok)throw new Error("DM oluÅŸturulamadÄ±");const s=await r.json();(await d(`${c}/messages/send_dm/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:s.conversation_id,content:`Hey! Seni **${a?.name||"sunucu"}** sunucusuna davet ediyorum! ğŸ‰
${i}`})})).ok?l.success(`âœ… ${t} kullanÄ±cÄ±sÄ±na davet gÃ¶nderildi!`):(navigator.clipboard.writeText(i),l.success(`Link kopyalandÄ±! ${t} ile paylaÅŸabilirsiniz.`))}catch(i){v(r=>{const s=new Set(r);return s.delete(t),s}),l.error("Davet gÃ¶nderilemedi: "+i.message)}},y=t=>m?t.sender_username===m?t.receiver_username:t.sender_username:t.receiver_username,$=t=>{const i=y(t);return t.sender_username===i?t.sender_avatar:t.receiver_avatar},R=h.filter(t=>y(t)?.toLowerCase().includes(f.toLowerCase())),W=()=>{navigator.clipboard.writeText(x),j(!0),l.success("ğŸ“‹ Davet linki kopyalandÄ±!"),setTimeout(()=>j(!1),2e3)},P=e.jsx("div",{style:n.overlay,onClick:p,children:e.jsxs("div",{style:n.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{children:[e.jsxs("div",{style:n.headerRow,children:[e.jsx(A,{style:{color:"#b5bac1",fontSize:"14px"}}),e.jsx("span",{style:n.serverLabel,children:a?.name||"Sunucu"})]}),e.jsx("h2",{style:n.title,children:"ArkadaÅŸlarÄ±nÄ± Davet Et"})]}),e.jsx("button",{onClick:p,style:n.closeBtn,children:e.jsx(M,{})})]}),e.jsx("div",{style:n.searchWrap,children:e.jsxs("div",{style:n.searchBox,children:[e.jsx(J,{style:n.searchIcon}),e.jsx("input",{ref:I,type:"text",placeholder:"ArkadaÅŸ ara...",style:n.searchInput,value:f,onChange:t=>B(t.target.value)})]})}),e.jsx("div",{style:n.friendList,children:F?e.jsxs("div",{style:n.emptyState,children:[e.jsx("div",{style:n.spinner}),e.jsx("span",{style:n.emptyText,children:"YÃ¼kleniyor..."})]}):R.length===0?e.jsxs("div",{style:n.emptyState,children:[e.jsx(Y,{style:{fontSize:"32px",color:"#4e5058",marginBottom:"8px"}}),e.jsx("span",{style:n.emptyText,children:f?"SonuÃ§ bulunamadÄ±.":h.length===0?"HenÃ¼z arkadaÅŸÄ±n yok.":"EÅŸleÅŸen arkadaÅŸ yok."})]}):R.map(t=>{const i=y(t),r=$(t),s=O.has(i);return e.jsxs("div",{style:n.friendItem,className:"invite-friend-item",children:[e.jsxs("div",{style:n.friendInfo,children:[e.jsx("div",{style:n.friendAvatar,children:r?e.jsx("img",{src:r,alt:i,style:n.avatarImg}):e.jsx("span",{style:n.avatarLetter,children:i?.charAt(0).toUpperCase()})}),e.jsx("span",{style:n.friendName,children:i})]}),e.jsx("button",{onClick:()=>!s&&N(i),style:{...n.inviteBtn,...s?n.inviteBtnSent:{}},disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(K,{style:{marginRight:"4px"}})," GÃ¶nderildi"]}):"Davet Et"})]},t.id)})}),e.jsxs("div",{style:n.linkSection,children:[e.jsx("div",{style:n.linkLabel,children:"VEYA BÄ°R SUNUCU DAVET LÄ°NKÄ° GÃ–NDER"}),e.jsx("div",{style:n.linkBox,children:w?e.jsxs("div",{style:n.linkLoading,children:[e.jsx("div",{style:n.spinner}),e.jsx("span",{style:{color:"#b5bac1",fontSize:"13px"},children:"Link hazÄ±rlanÄ±yor..."})]}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:n.linkInputWrap,children:[e.jsx(G,{style:{color:"#b5bac1",marginRight:"8px",flexShrink:0}}),e.jsx("input",{type:"text",value:x,readOnly:!0,style:n.linkInput,onClick:t=>t.target.select()})]}),e.jsx("button",{onClick:W,style:{...n.copyBtn,...S?n.copyBtnDone:{}},children:S?"KopyalandÄ±!":"Kopyala"})]}):e.jsxs("div",{style:n.linkError,children:[e.jsx("span",{style:{color:"#f0b232",fontSize:"13px"},children:"Link oluÅŸturulamadÄ±"}),e.jsx("button",{onClick:L,style:n.retryBtn,children:"Tekrar Dene"})]})}),x&&!w&&e.jsxs("button",{onClick:D,disabled:u,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.1)",color:"#b5bac1",padding:"6px 12px",borderRadius:"4px",cursor:u?"wait":"pointer",fontSize:"12px",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.15s"},onMouseEnter:t=>{t.target.style.background="rgba(255,255,255,0.06)",t.target.style.color="#fff"},onMouseLeave:t=>{t.target.style.background="transparent",t.target.style.color="#b5bac1"},children:[e.jsx(Q,{style:{fontSize:"11px",animation:u?"inviteSpin 1s linear infinite":"none"}}),u?"OluÅŸturuluyor...":"Yeni Link OluÅŸtur"]}),e.jsx("div",{style:n.linkNote,children:"Bu davet linki sÃ¼resiz geÃ§erli ve sÄ±nÄ±rsÄ±z kullanÄ±mlÄ±."})]})]})});return H.createPortal(P,document.body)};if(typeof document<"u"){const p="invite-modal-styles";if(!document.getElementById(p)){const a=document.createElement("style");a.id=p,a.textContent=`
            .invite-friend-item:hover { background: rgba(88, 101, 242, 0.06) !important; }
            @keyframes inviteSpin { to { transform: rotate(360deg); } }
        `,document.head.appendChild(a)}}const n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,backdropFilter:"blur(4px)"},modal:{backgroundColor:"#313338",borderRadius:"12px",width:"460px",maxWidth:"92vw",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 16px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04)",overflow:"hidden",animation:"contextMenuIn 0.15s ease-out"},header:{padding:"20px 20px 8px 20px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerRow:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"},serverLabel:{color:"#b5bac1",fontSize:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.02em"},title:{margin:0,color:"#f2f3f5",fontSize:"18px",fontWeight:"700"},closeBtn:{background:"none",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"18px",padding:"4px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center"},searchWrap:{padding:"8px 20px 4px 20px"},searchBox:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"0 12px",display:"flex",alignItems:"center"},searchIcon:{color:"#6d6f78",marginRight:"10px",fontSize:"14px",flexShrink:0},searchInput:{backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px 0",flex:1,outline:"none",fontSize:"14px"},friendList:{flex:1,overflowY:"auto",padding:"8px 12px",minHeight:"120px",maxHeight:"280px"},friendItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderRadius:"8px",transition:"background 0.15s",cursor:"default"},friendInfo:{display:"flex",alignItems:"center",gap:"12px",minWidth:0},friendAvatar:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",flexShrink:0},avatarImg:{width:"100%",height:"100%",objectFit:"cover"},avatarLetter:{color:"#fff",fontSize:"15px",fontWeight:"600"},friendName:{color:"#f2f3f5",fontSize:"14px",fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},inviteBtn:{padding:"6px 16px",backgroundColor:"transparent",border:"1px solid #248046",color:"#2dc770",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s",whiteSpace:"nowrap",display:"flex",alignItems:"center",flexShrink:0},inviteBtnSent:{border:"1px solid #4e5058",color:"#b5bac1",cursor:"default",backgroundColor:"transparent"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 20px",gap:"4px"},emptyText:{color:"#6d6f78",fontSize:"14px",textAlign:"center"},spinner:{width:"20px",height:"20px",border:"2px solid #4e5058",borderTopColor:"#5865f2",borderRadius:"50%",animation:"inviteSpin 0.6s linear infinite"},linkSection:{backgroundColor:"#2b2d31",padding:"16px 20px",borderTop:"1px solid rgba(255,255,255,0.04)"},linkLabel:{color:"#b5bac1",fontSize:"11px",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.02em",marginBottom:"10px"},linkBox:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"#1e1f22",borderRadius:"8px",padding:"4px 4px 4px 12px",minHeight:"44px"},linkInputWrap:{display:"flex",alignItems:"center",flex:1,minWidth:0},linkInput:{flex:1,backgroundColor:"transparent",border:"none",color:"#00a8fc",fontSize:"13px",outline:"none",textOverflow:"ellipsis",minWidth:0},linkLoading:{display:"flex",alignItems:"center",gap:"10px",flex:1,padding:"4px 0"},linkError:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,padding:"4px 0"},copyBtn:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background 0.15s",whiteSpace:"nowrap",flexShrink:0},copyBtnDone:{backgroundColor:"#248046"},retryBtn:{padding:"6px 12px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:"500"},linkNote:{color:"#6d6f78",fontSize:"11px",marginTop:"8px"}};export{re as default};
