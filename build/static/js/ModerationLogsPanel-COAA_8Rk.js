import{r as i,j as e}from"./react-core-D6cE4lil.js";import{a1 as S,a as H,ay as F,aC as A,z as f,d as C,V as K,cB as L,e as P,a5 as G,aD as $,av as V,aF as Z,a0 as q,aA as J,B as Q,g as W,au as X}from"./icons-vendor-fClA8qVL.js";import{y as j}from"./ui-vendor-CZOhtEfS.js";import{d as I}from"./index-BXSbZAFz.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";const ce=({serverId:o,onClose:b})=>{const[y,d]=i.useState([]),[x,k]=i.useState(!0),[s,m]=i.useState({action_type:"all",moderator:"",target_user:"",date_from:"",date_to:""}),[p,E]=i.useState(!1),[v,M]=i.useState(null),[l,g]=i.useState(null),[h,c]=i.useState(1),[B,D]=i.useState(!0),u=localStorage.getItem("access_token");i.useEffect(()=>{_(),T()},[o,s,h]);const _=async()=>{k(!0);try{const a=new URLSearchParams({page:h,...Object.fromEntries(Object.entries(s).filter(([t,r])=>r&&r!=="all"))}),n=await fetch(`/api/servers/${o}/moderation/logs/?${a}`,{headers:{Authorization:`Bearer ${u}`}});if(n.ok){const t=await n.json();d(h===1?t.logs||[]:r=>[...r,...t.logs||[]]),D(t.has_more??!0)}else d([])}catch{d([])}k(!1)},T=async()=>{try{const a=await fetch(`/api/servers/${o}/moderation/stats/`,{headers:{Authorization:`Bearer ${u}`}});a.ok?g(await a.json()||N):g(N)}catch{g(N)}},N={total_actions:0,this_week:0,bans:0,kicks:0,timeouts:0,warns:0,mutes:0,deletes:0,automod_actions:0,top_moderators:[]},z=a=>({ban:e.jsx(F,{className:"action-ban"}),kick:e.jsx(A,{className:"action-kick"}),timeout:e.jsx(f,{className:"action-timeout"}),mute:e.jsx(X,{className:"action-mute"}),warn:e.jsx(C,{className:"action-warn"}),delete_messages:e.jsx(W,{className:"action-delete"}),automod:e.jsx(Q,{className:"action-automod"})})[a]||e.jsx(J,{}),U=a=>({ban:"Yasaklama",kick:"Sunucudan Atma",timeout:"Zaman Aşımı",mute:"Susturma",warn:"Uyarı",delete_messages:"Mesaj Silme",automod:"AutoMod"})[a]||a,O=async a=>{if(await I("Bu moderasyon eylemini geri almak istediğinizden emin misiniz?"))try{(await fetch(`/api/servers/${o}/moderation/logs/${a}/revert/`,{method:"POST",headers:{Authorization:`Bearer ${u}`}})).ok&&(j.success("Eylem geri alındı"),_())}catch{d(y.map(t=>t.id===a?{...t,reverted:!0}:t)),j.success("Eylem geri alındı")}},R=async()=>{try{const a=await fetch(`/api/servers/${o}/moderation/logs/export/`,{headers:{Authorization:`Bearer ${u}`}});if(a.ok){const n=await a.blob(),t=window.URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=`moderation-logs-${new Date().toISOString().split("T")[0]}.csv`,r.click(),j.success("Loglar indirildi")}}catch{j.error("Dışa aktarma başarısız")}},Y=a=>new Date(a).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),w=y;return e.jsx("div",{className:"moderation-logs-overlay",onClick:a=>a.target.className==="moderation-logs-overlay"&&b(),children:e.jsxs("div",{className:"moderation-logs-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(S,{})," Moderasyon Logları"]}),e.jsx("button",{className:"close-btn",onClick:b,children:e.jsx(H,{})})]}),l&&e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:l.total_actions}),e.jsx("span",{className:"stat-label",children:"Toplam"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:l.this_week}),e.jsx("span",{className:"stat-label",children:"Bu Hafta"})]}),e.jsxs("div",{className:"stat-item ban",children:[e.jsx(F,{}),e.jsx("span",{children:l.bans})]}),e.jsxs("div",{className:"stat-item kick",children:[e.jsx(A,{}),e.jsx("span",{children:l.kicks})]}),e.jsxs("div",{className:"stat-item timeout",children:[e.jsx(f,{}),e.jsx("span",{children:l.timeouts})]}),e.jsxs("div",{className:"stat-item warn",children:[e.jsx(C,{}),e.jsx("span",{children:l.warns})]})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filters-header",children:[e.jsxs("button",{className:"filter-toggle",onClick:()=>E(!p),children:[e.jsx(K,{})," Filtreler",p?e.jsx(L,{}):e.jsx(P,{})]}),e.jsxs("button",{className:"export-btn",onClick:R,children:[e.jsx(G,{})," Dışa Aktar"]})]}),p&&e.jsxs("div",{className:"filters-content",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Eylem Türü"}),e.jsxs("select",{value:s.action_type,onChange:a=>{m({...s,action_type:a.target.value}),c(1)},children:[e.jsx("option",{value:"all",children:"Tümü"}),e.jsx("option",{value:"ban",children:"Yasaklama"}),e.jsx("option",{value:"kick",children:"Atma"}),e.jsx("option",{value:"timeout",children:"Zaman Aşımı"}),e.jsx("option",{value:"mute",children:"Susturma"}),e.jsx("option",{value:"warn",children:"Uyarı"}),e.jsx("option",{value:"delete_messages",children:"Mesaj Silme"}),e.jsx("option",{value:"automod",children:"AutoMod"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Moderatör"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:s.moderator,onChange:a=>{m({...s,moderator:a.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Hedef Kullanıcı"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:s.target_user,onChange:a=>{m({...s,target_user:a.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Başlangıç"}),e.jsx("input",{type:"date",value:s.date_from,onChange:a=>{m({...s,date_from:a.target.value}),c(1)}})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Bitiş"}),e.jsx("input",{type:"date",value:s.date_to,onChange:a=>{m({...s,date_to:a.target.value}),c(1)}})]})]})]}),e.jsx("div",{className:"panel-content",children:x&&h===1?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):w.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(S,{}),e.jsx("p",{children:"Moderasyon logu bulunamadı"})]}):e.jsxs("div",{className:"logs-list",children:[w.map(a=>e.jsxs("div",{className:`log-item ${a.reverted?"reverted":""}`,children:[e.jsx("div",{className:"log-icon",children:z(a.action_type)}),e.jsxs("div",{className:"log-main",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("span",{className:`action-badge ${a.action_type}`,children:U(a.action_type)}),a.reverted&&e.jsxs("span",{className:"reverted-badge",children:[e.jsx($,{})," Geri Alındı"]}),e.jsxs("span",{className:"log-time",children:[e.jsx(f,{})," ",Y(a.created_at)]})]}),e.jsxs("div",{className:"log-users",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:a.moderator.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:a.moderator.username})]}),e.jsx("span",{className:"arrow",children:"→"}),e.jsxs("div",{className:"user-info target",children:[e.jsx("img",{src:a.target_user.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:a.target_user.username})]})]}),e.jsxs("div",{className:"log-reason",children:[e.jsx(V,{})," ",a.reason]}),a.channel&&e.jsxs("div",{className:"log-channel",children:[e.jsx(Z,{})," ",a.channel.name]}),v===a.id&&a.details&&Object.keys(a.details).length>0&&e.jsxs("div",{className:"log-details",children:[a.details.duration&&e.jsxs("span",{children:[e.jsx("strong",{children:"Süre:"})," ",a.details.duration]}),a.details.message_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Silinen Mesaj:"})," ",a.details.message_count]}),a.details.warning_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Toplam Uyarı:"})," ",a.details.warning_count]}),a.details.trigger&&e.jsxs("span",{children:[e.jsx("strong",{children:"Tetikleyici:"})," ",a.details.trigger]}),a.details.evidence&&e.jsxs("div",{className:"evidence",children:[e.jsx("strong",{children:"Kanıtlar:"}),e.jsx("ul",{children:a.details.evidence.map((n,t)=>e.jsx("li",{children:n},t))})]})]})]}),e.jsxs("div",{className:"log-actions",children:[Object.keys(a.details||{}).length>0&&e.jsx("button",{className:"detail-btn",onClick:()=>M(v===a.id?null:a.id),title:"Detaylar",children:v===a.id?e.jsx(L,{}):e.jsx(q,{})}),!a.reverted&&["ban","mute","timeout"].includes(a.action_type)&&e.jsx("button",{className:"revert-btn",onClick:()=>O(a.id),title:"Geri Al",children:e.jsx($,{})})]})]},a.id)),B&&e.jsx("button",{className:"load-more-btn",onClick:()=>c(a=>a+1),disabled:x,children:x?"Yükleniyor...":"Daha Fazla Yükle"})]})})]})})};export{ce as default};
