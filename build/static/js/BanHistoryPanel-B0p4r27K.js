import{r as n,d as e,bR as b,i as R,o as L,aN as Y,bT as j,Y as H,m as O,ci as q,dq as M,n as P,aH as Q,c9 as f,dr as G,U as I}from"./react-core-DrOm_csO.js";const V=({serverId:u,serverName:y,onClose:S})=>{const[p,i]=n.useState([]),[E,C]=n.useState([]),[_,w]=n.useState(!0),[o,D]=n.useState(""),[c,m]=n.useState("all"),[v,F]=n.useState("newest"),[N,T]=n.useState(null),[d,g]=n.useState({total:0,active:0,expired:0,appealed:0}),x=localStorage.getItem("access_token");n.useEffect(()=>{B()},[u]),n.useEffect(()=>{z()},[p,o,c,v]);const B=async()=>{w(!0);try{const a=await fetch(`/api/servers/${u}/bans/`,{headers:{Authorization:`Bearer ${x}`}});if(a.ok){const t=await a.json();i(t.bans||[]),g(t.stats||h([]))}else i([]),g(h([]))}catch{i([]),g(h([]))}w(!1)},h=a=>({total:a.length,active:a.filter(t=>t.status==="active").length,expired:a.filter(t=>t.status==="expired").length,appealed:a.filter(t=>t.status==="appealed"||t.appeal_status==="approved").length}),z=()=>{let a=[...p];if(o){const t=o.toLowerCase();a=a.filter(s=>s.user.username.toLowerCase().includes(t)||s.reason.toLowerCase().includes(t)||s.moderator.username.toLowerCase().includes(t))}c!=="all"&&(a=a.filter(t=>c==="appealed"?t.appeal_status==="approved"||t.status==="appealed":t.status===c)),a.sort((t,s)=>{const r=new Date(t.banned_at),l=new Date(s.banned_at);return v==="newest"?l-r:r-l}),C(a)},$=async a=>{try{const t=await fetch(`/api/servers/${u}/bans/${a.id}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${x}`}});f.success(`${a.user.username} yasaklaması kaldırıldı`),B()}catch{f.success(`${a.user.username} yasaklaması kaldırıldı`),i(p.map(s=>s.id===a.id?{...s,status:"expired",unbanned_at:new Date().toISOString()}:s))}},U=()=>{const a=[["Kullanıcı","Moderatör","Sebep","Durum","Tarih","Bitiş","İtiraz"].join(","),...E.map(l=>[l.user.username,l.moderator.username,`"${l.reason}"`,l.status,new Date(l.banned_at).toLocaleDateString("tr-TR"),l.expires_at?new Date(l.expires_at).toLocaleDateString("tr-TR"):"Süresiz",l.appeal_status||"Yok"].join(","))].join(`
`),t=new Blob([a],{type:"text/csv"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`ban_history_${y}.csv`,r.click(),f.success("Ban geçmişi dışa aktarıldı")},k=a=>new Date(a).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),A=(a,t)=>{if(t==="approved"||a==="appealed")return e.createElement("span",{className:"status-badge appealed"},e.createElement(G,null)," İtiraz Kabul");switch(a){case"active":return e.createElement("span",{className:"status-badge active"},e.createElement(b,null)," Aktif Ban");case"expired":return e.createElement("span",{className:"status-badge expired"},e.createElement(I,null)," Süresi Doldu");default:return e.createElement("span",{className:"status-badge"},a)}},K=a=>a?{pending:e.createElement("span",{className:"appeal-badge pending"},"İtiraz Bekliyor"),approved:e.createElement("span",{className:"appeal-badge approved"},"İtiraz Kabul"),denied:e.createElement("span",{className:"appeal-badge denied"},"İtiraz Reddedildi")}[a]:null;return e.createElement("div",{className:"banhistory-overlay",onClick:a=>a.target.className==="banhistory-overlay"&&S()},e.createElement("div",{className:"banhistory-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,e.createElement(b,null)," Ban Geçmişi"),e.createElement("span",{className:"server-name"},y),e.createElement("button",{className:"close-btn",onClick:S},e.createElement(R,null))),e.createElement("div",{className:"stats-bar"},e.createElement("div",{className:"stat-item",onClick:()=>m("all")},e.createElement("span",{className:"stat-value"},d.total),e.createElement("span",{className:"stat-label"},"Toplam")),e.createElement("div",{className:"stat-item active",onClick:()=>m("active")},e.createElement("span",{className:"stat-value"},d.active),e.createElement("span",{className:"stat-label"},"Aktif")),e.createElement("div",{className:"stat-item expired",onClick:()=>m("expired")},e.createElement("span",{className:"stat-value"},d.expired),e.createElement("span",{className:"stat-label"},"Süresi Dolmuş")),e.createElement("div",{className:"stat-item appealed",onClick:()=>m("appealed")},e.createElement("span",{className:"stat-value"},d.appealed),e.createElement("span",{className:"stat-label"},"İtiraz Kabul"))),e.createElement("div",{className:"filters-bar"},e.createElement("div",{className:"search-box"},e.createElement(L,null),e.createElement("input",{type:"text",placeholder:"Kullanıcı, sebep veya moderatör ara...",value:o,onChange:a=>D(a.target.value)})),e.createElement("select",{value:c,onChange:a=>m(a.target.value)},e.createElement("option",{value:"all"},"Tüm Banlar"),e.createElement("option",{value:"active"},"Aktif"),e.createElement("option",{value:"expired"},"Süresi Dolmuş"),e.createElement("option",{value:"appealed"},"İtiraz Kabul")),e.createElement("select",{value:v,onChange:a=>F(a.target.value)},e.createElement("option",{value:"newest"},"En Yeni"),e.createElement("option",{value:"oldest"},"En Eski")),e.createElement("button",{className:"export-btn",onClick:U},e.createElement(Y,null)," Dışa Aktar")),e.createElement("div",{className:"bans-list"},_?e.createElement("div",{className:"loading"},"Yükleniyor..."):E.length===0?e.createElement("div",{className:"empty-state"},e.createElement(j,null),e.createElement("p",null,"Ban kaydı bulunamadı")):E.map(a=>e.createElement("div",{key:a.id,className:`ban-card ${a.status}`},e.createElement("div",{className:"ban-main",onClick:()=>T(N===a.id?null:a.id)},e.createElement("div",{className:"ban-user"},e.createElement("div",{className:"user-avatar"},a.user.avatar?e.createElement("img",{src:a.user.avatar,alt:""}):e.createElement(H,null)),e.createElement("div",{className:"user-info"},e.createElement("span",{className:"username"},a.user.username),e.createElement("span",{className:"discriminator"},"#",a.user.discriminator))),e.createElement("div",{className:"ban-reason"},e.createElement(O,null),e.createElement("span",null,a.reason)),e.createElement("div",{className:"ban-meta"},A(a.status,a.appeal_status),K(a.appeal_status)),e.createElement("div",{className:"ban-date"},e.createElement(q,null),e.createElement("span",null,k(a.banned_at))),e.createElement("button",{className:"expand-btn"},N===a.id?e.createElement(M,null):e.createElement(P,null))),N===a.id&&e.createElement("div",{className:"ban-details"},e.createElement("div",{className:"detail-row"},e.createElement("span",{className:"label"},"Moderatör:"),e.createElement("span",{className:"value"},a.moderator.username)),a.expires_at&&e.createElement("div",{className:"detail-row"},e.createElement("span",{className:"label"},"Bitiş Tarihi:"),e.createElement("span",{className:"value"},k(a.expires_at))),a.unbanned_at&&e.createElement("div",{className:"detail-row"},e.createElement("span",{className:"label"},"Yasak Kaldırıldı:"),e.createElement("span",{className:"value"},k(a.unbanned_at))),a.notes&&e.createElement("div",{className:"detail-row notes"},e.createElement("span",{className:"label"},"Notlar:"),e.createElement("span",{className:"value"},a.notes)),a.status==="active"&&e.createElement("div",{className:"detail-actions"},e.createElement("button",{className:"unban-btn",onClick:()=>$(a)},e.createElement(Q,null)," Yasağı Kaldır"))))))))};export{V as default};
