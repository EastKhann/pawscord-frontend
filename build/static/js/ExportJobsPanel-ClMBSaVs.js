import{r as l,aT as i,l as y,U as E,c9 as F,Y as B,bR as D,V as j}from"./react-core-B6hadH-M.js";import{t as r,h as L}from"./index-D_6pZib5.js";const _=({fetchWithAuth:a,apiBaseUrl:s,onClose:d,username:$})=>{const[p,R]=l.useState([]),[b,S]=l.useState(!0),[m,v]=l.useState("messages"),[x,f]=l.useState(!1),g=[{id:"messages",name:"Messages",description:"Export all your messages"},{id:"server",name:"Server Data",description:"Export server content"},{id:"dm",name:"Direct Messages",description:"Export DM history"},{id:"media",name:"Media Files",description:"Export uploaded media"},{id:"profile",name:"Profile Data",description:"Export your profile info"},{id:"analytics",name:"Analytics",description:"Export analytics data"}];l.useEffect(()=>{c();const e=setInterval(c,5e3);return()=>clearInterval(e)},[]);const c=async()=>{try{const o=await(await a(`${s}/exports/jobs/`)).json();R(o.jobs||[])}catch(e){console.error("Failed to load export jobs:",e)}finally{S(!1)}},C=async()=>{f(!0);try{const o=await(await a(`${s}/exports/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:m})})).json();o.success?(r.success("Export job created! Processing..."),c()):r.error(o.error||"Failed to create export")}catch(e){console.error("Export creation error:",e),r.error("Failed to create export")}finally{f(!1)}},h=async e=>{try{const T=await(await a(`${s}/exports/${e}/download/`)).blob(),u=window.URL.createObjectURL(T),n=document.createElement("a");n.href=u,n.download=`export_${e}.zip`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(u),r.success("Download started!")}catch(o){console.error("Download error:",o),r.error("Download failed")}},w=async e=>{if(await L("Delete this export job?"))try{await a(`${s}/exports/${e}/delete/`,{method:"DELETE"}),r.success("Export job deleted"),c()}catch(o){console.error("Delete error:",o),r.error("Failed to delete job")}},k=e=>{switch(e){case"completed":return React.createElement(j,{style:{color:"#43b581"}});case"processing":return React.createElement(E,{style:{color:"#faa61a"},className:"fa-spin"});case"failed":return React.createElement(D,{style:{color:"#f04747"}});default:return React.createElement(B,{style:{color:"#99aab5"}})}},z=e=>{switch(e){case"completed":return"#43b581";case"processing":return"#faa61a";case"failed":return"#f04747";default:return"#99aab5"}};return React.createElement("div",{style:t.overlay,onClick:d},React.createElement("div",{style:t.modal,onClick:e=>e.stopPropagation()},React.createElement("div",{style:t.header},React.createElement("div",{style:t.headerLeft},React.createElement(i,{style:{fontSize:"24px",color:"#5865f2"}}),React.createElement("h2",{style:{margin:0,fontSize:"20px"}},"Export Jobs")),React.createElement("button",{onClick:d,style:t.closeBtn},React.createElement(y,null))),React.createElement("div",{style:t.content},React.createElement("div",{style:t.createSection},React.createElement("h3",{style:t.sectionTitle},"Create New Export"),React.createElement("div",{style:t.exportTypeSelector},React.createElement("select",{value:m,onChange:e=>v(e.target.value),style:t.select},g.map(e=>React.createElement("option",{key:e.id,value:e.id},e.name," - ",e.description))),React.createElement("button",{onClick:C,disabled:x,style:t.createBtn},x?React.createElement(React.Fragment,null,React.createElement(E,{className:"fa-spin"})," Creating..."):React.createElement(React.Fragment,null,React.createElement(i,null)," Create Export")))),React.createElement("div",{style:t.jobsSection},React.createElement("h3",{style:t.sectionTitle},"Your Export Jobs"),b?React.createElement("div",{style:t.loading},"Loading jobs..."):p.length===0?React.createElement("div",{style:t.empty},React.createElement(F,{style:{fontSize:"48px",color:"#99aab5",marginBottom:"16px"}}),React.createElement("p",null,"No export jobs yet"),React.createElement("p",{style:{fontSize:"14px",color:"#99aab5"}},"Create your first export to get started")):React.createElement("div",{style:t.jobsList},p.map(e=>React.createElement("div",{key:e.id,style:t.jobCard},React.createElement("div",{style:t.jobIcon},k(e.status)),React.createElement("div",{style:t.jobDetails},React.createElement("div",{style:t.jobTitle},g.find(o=>o.id===e.type)?.name||e.type),React.createElement("div",{style:t.jobMeta},React.createElement("span",null,"Created: ",new Date(e.created_at).toLocaleString()),e.completed_at&&React.createElement(React.Fragment,null,React.createElement("span",{style:{margin:"0 8px"}},"â€¢"),React.createElement("span",null,"Completed: ",new Date(e.completed_at).toLocaleString()))),e.status==="processing"&&e.progress&&React.createElement("div",{style:t.progressBar},React.createElement("div",{style:{...t.progressFill,width:`${e.progress}%`}}),React.createElement("span",{style:t.progressText},e.progress,"%")),e.file_size&&React.createElement("div",{style:t.fileSize},"Size: ",I(e.file_size))),React.createElement("div",{style:t.jobActions},React.createElement("span",{style:{...t.statusBadge,backgroundColor:z(e.status)}},e.status),e.status==="completed"&&React.createElement("button",{onClick:()=>h(e.id),style:t.downloadBtn,title:"Download"},React.createElement(i,null)),React.createElement("button",{onClick:()=>w(e.id),style:t.deleteBtn,title:"Delete"},React.createElement(y,null))))))),React.createElement("div",{style:t.info},React.createElement("p",{style:t.infoText},"ðŸ“¦ Exports are processed in the background and may take a few minutes"),React.createElement("p",{style:t.infoText},"ðŸ’¾ Completed exports are available for 7 days before auto-deletion")))))},I=a=>a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:a<1024*1024*1024?`${(a/(1024*1024)).toFixed(2)} MB`:`${(a/(1024*1024*1024)).toFixed(2)} GB`,t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},createSection:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",marginBottom:"24px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},exportTypeSelector:{display:"flex",gap:"12px"},select:{flex:1,padding:"10px",backgroundColor:"#202225",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px"},createBtn:{padding:"10px 24px",backgroundColor:"#5865f2",border:"none",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},jobsSection:{marginBottom:"24px"},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},empty:{textAlign:"center",padding:"60px 20px",color:"#dcddde"},jobsList:{display:"flex",flexDirection:"column",gap:"12px"},jobCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center",gap:"16px"},jobIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},jobDetails:{flex:1},jobTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"4px"},jobMeta:{fontSize:"12px",color:"#99aab5",marginBottom:"8px"},progressBar:{position:"relative",height:"20px",backgroundColor:"#202225",borderRadius:"10px",overflow:"hidden",marginTop:"8px"},progressFill:{height:"100%",backgroundColor:"#5865f2",transition:"width 0.3s ease"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"12px",fontWeight:"600",color:"#fff"},fileSize:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},jobActions:{display:"flex",alignItems:"center",gap:"8px"},statusBadge:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},downloadBtn:{padding:"8px 12px",backgroundColor:"#43b581",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},deleteBtn:{padding:"8px 12px",backgroundColor:"#f04747",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"14px"},info:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px"},infoText:{fontSize:"14px",color:"#dcddde",margin:"8px 0",lineHeight:"1.6"}};export{_ as default};
