import{r as d,j as e}from"./react-core-D6cE4lil.js";import{h as E}from"./index-BvqjkDq7.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./icons-vendor-DT2gd7vx.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-BYnay7oC.js";import"./ui-vendor-CZOhtEfS.js";const y={name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0},O=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}],T=l=>{const[r,a]=d.useState([]),[o,c]=d.useState(!0),[g,n]=d.useState(!1),[C,v]=d.useState(null),[h,f]=d.useState(null),[x,b]=d.useState(y),m=()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`});d.useEffect(()=>{N()},[l]);const N=async()=>{try{c(!0);const s=await fetch(`/api/roles/${l}/list/`,{headers:m()});if(s.ok){const t=await s.json();a(t.roles||[])}}catch{}finally{c(!1)}},k=async()=>{if(x.name.trim())try{const s=await fetch(`/api/roles/${l}/create/`,{method:"POST",headers:{...m(),"Content-Type":"application/json"},body:JSON.stringify(x)});if(s.ok){const t=await s.json();a([...r,t.role]),n(!1),b(y)}}catch{}},w=async(s,t)=>{try{const i=await fetch(`/api/roles/${l}/${s}/update/`,{method:"PUT",headers:{...m(),"Content-Type":"application/json"},body:JSON.stringify(t)});if(i.ok){const j=await i.json();a(r.map(u=>u.id===s?j.role:u)),v(null)}}catch{}},S=async s=>{if(await E("Are you sure you want to delete this role?"))try{(await fetch(`/api/roles/${l}/${s}/delete/`,{method:"DELETE",headers:m()})).ok&&a(r.filter(i=>i.id!==s))}catch{}},D=async s=>{try{await fetch(`/api/roles/${l}/reorder/`,{method:"POST",headers:{...m(),"Content-Type":"application/json"},body:JSON.stringify({order:s})}),N()}catch{}};return{roles:r,loading:o,showCreateModal:g,setShowCreateModal:n,editingRole:C,setEditingRole:v,draggedRole:h,newRole:x,setNewRole:b,createRole:k,updateRole:w,deleteRole:S,copyRole:async s=>{try{const t=await fetch(`/api/roles/${l}/${s}/copy/`,{method:"POST",headers:m()});if(t.ok){const i=await t.json();a([...r,i.role])}}catch{}},handleDragStart:(s,t)=>{f(t),s.dataTransfer.effectAllowed="move"},handleDragOver:s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},handleDrop:(s,t)=>{if(s.preventDefault(),!h||h.id===t.id)return;const i=[...r],j=i.findIndex(p=>p.id===h.id),u=i.findIndex(p=>p.id===t.id);i.splice(j,1),i.splice(u,0,h),a(i),D(i.map(p=>p.id)),f(null)}}},R=({role:l,setRole:r,onSave:a,onCancel:o,title:c,saveLabel:g})=>e.jsx("div",{className:"role-modal-overlay",onClick:o,children:e.jsxs("div",{className:"role-modal",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{children:c}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:l.name,onChange:n=>r({...l,name:n.target.value}),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[O.map(n=>e.jsx("button",{className:`color-preset ${l.color===n.value?"active":""}`,style:{backgroundColor:n.value},onClick:()=>r({...l,color:n.value}),title:n.name},n.value)),e.jsx("input",{type:"color",value:l.color,onChange:n=>r({...l,color:n.target.value}),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l.hoist,onChange:n=>r({...l,hoist:n.target.checked})}),e.jsx("span",{children:"Display role members separately from online members"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l.mentionable,onChange:n=>r({...l,mentionable:n.target.checked})}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:o,children:"Cancel"}),e.jsx("button",{className:c.includes("Edit")?"save-btn":"create-btn",onClick:a,children:g})]})]})}),F=({serverId:l,onClose:r})=>{const a=T(l);return a.loading?e.jsx("div",{className:"roles-manager-overlay",children:e.jsx("div",{className:"roles-manager-modal",children:e.jsx("div",{className:"loading-spinner",children:"Loading roles..."})})}):e.jsx("div",{className:"roles-manager-overlay",onClick:r,children:e.jsxs("div",{className:"roles-manager-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"roles-manager-header",children:[e.jsxs("h2",{children:["ðŸŽ­"," Server Roles"]}),e.jsx("button",{className:"close-btn",onClick:r,children:"âœ•"})]}),e.jsxs("div",{className:"roles-manager-content",children:[e.jsxs("div",{className:"roles-actions",children:[e.jsxs("button",{className:"create-role-btn",onClick:()=>a.setShowCreateModal(!0),children:["âž•"," Create Role"]}),e.jsxs("div",{className:"roles-info",children:[e.jsxs("span",{children:[a.roles.length," roles"]}),e.jsxs("span",{className:"info-tip",children:["ðŸ’¡"," Drag to reorder hierarchy"]})]})]}),e.jsx("div",{className:"roles-list",children:a.roles.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸŽ­"}),e.jsx("h3",{children:"No Roles Yet"}),e.jsx("p",{children:"Create roles to organize your server members"})]}):a.roles.map(o=>e.jsxs("div",{className:`role-card ${a.draggedRole?.id===o.id?"dragging":""}`,draggable:!0,onDragStart:c=>a.handleDragStart(c,o),onDragOver:a.handleDragOver,onDrop:c=>a.handleDrop(c,o),children:[e.jsx("div",{className:"role-drag-handle",children:"â˜°"}),e.jsx("div",{className:"role-color-badge",style:{backgroundColor:o.color}}),e.jsxs("div",{className:"role-info",children:[e.jsx("div",{className:"role-name",style:{color:o.color},children:o.name}),e.jsxs("div",{className:"role-meta",children:[e.jsxs("span",{className:"role-members",children:["ðŸ‘¥"," ",o.member_count||0," members"]}),o.hoist&&e.jsxs("span",{className:"role-badge",children:["ðŸ“Œ"," Hoisted"]}),o.mentionable&&e.jsx("span",{className:"role-badge",children:"@ Mentionable"})]})]}),e.jsxs("div",{className:"role-actions",children:[e.jsx("button",{className:"role-action-btn edit",onClick:()=>a.setEditingRole(o),title:"Edit",children:"âœï¸"}),e.jsx("button",{className:"role-action-btn copy",onClick:()=>a.copyRole(o.id),title:"Copy",children:"ðŸ“‹"}),e.jsx("button",{className:"role-action-btn delete",onClick:()=>a.deleteRole(o.id),title:"Delete",children:"ðŸ—‘ï¸"})]})]},o.id))})]}),a.showCreateModal&&e.jsx(R,{role:a.newRole,setRole:a.setNewRole,onSave:a.createRole,onCancel:()=>a.setShowCreateModal(!1),title:"Create New Role",saveLabel:"Create Role"}),a.editingRole&&e.jsx(R,{role:a.editingRole,setRole:a.setEditingRole,onSave:()=>a.updateRole(a.editingRole.id,a.editingRole),onCancel:()=>a.setEditingRole(null),title:"Edit Role",saveLabel:"Save Changes"})]})})};export{F as default};
