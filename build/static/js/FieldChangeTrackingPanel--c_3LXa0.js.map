{"version":3,"file":"FieldChangeTrackingPanel--c_3LXa0.js","sources":["../../../src/components/FieldChangeTrackingPanel.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { FaTimes, FaHistory, FaDownload } from 'react-icons/fa';\nimport { toast } from '../utils/toast';\n\nconst FieldChangeTrackingPanel = ({ fetchWithAuth, apiBaseUrl, onClose, entityType, entityId }) => {\n    const [changes, setChanges] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [filter, setFilter] = useState('all');\n\n    useEffect(() => {\n        fetchChanges();\n    }, []);\n\n    const fetchChanges = async () => {\n        setLoading(true);\n        try {\n            const response = await fetchWithAuth(\n                `${apiBaseUrl}/audit/field-changes/?entity_type=${entityType}&entity_id=${entityId}`\n            );\n            const data = await response.json();\n            setChanges(data.changes || []);\n        } catch (error) {\n            toast.error('Failed to load change history');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const exportChanges = () => {\n        const csv = [\n            ['Date', 'Field', 'Old Value', 'New Value', 'Changed By'],\n            ...filteredChanges.map(c => [\n                new Date(c.changed_at).toLocaleString(),\n                c.field_name,\n                c.old_value || '',\n                c.new_value || '',\n                c.changed_by_username\n            ])\n        ].map(row => row.map(cell => `\"${cell}\"`).join(',')).join('\\n');\n\n        const blob = new Blob([csv], { type: 'text/csv' });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `field_changes_${entityType}_${Date.now()}.csv`;\n        document.body.appendChild(a);\n        a.click();\n        window.URL.revokeObjectURL(url);\n        document.body.removeChild(a);\n\n        toast.success('Changes exported');\n    };\n\n    const fieldNames = [...new Set(changes.map(c => c.field_name))];\n\n    const filteredChanges = filter === 'all'\n        ? changes\n        : changes.filter(c => c.field_name === filter);\n\n    return (\n        <div style={styles.overlay}>\n            <div style={styles.modal}>\n                <div style={styles.header}>\n                    <div style={styles.headerLeft}>\n                        <FaHistory style={{ marginRight: '10px', color: '#5865f2' }} />\n                        <h2 style={styles.title}>Field Change History</h2>\n                    </div>\n                    <button onClick={onClose} style={styles.closeButton}>\n                        <FaTimes />\n                    </button>\n                </div>\n\n                <div style={styles.toolbar}>\n                    <select value={filter} onChange={(e) => setFilter(e.target.value)} style={styles.filterSelect}>\n                        <option value=\"all\">All Fields ({changes.length})</option>\n                        {fieldNames.map(field => (\n                            <option key={field} value={field}>\n                                {field} ({changes.filter(c => c.field_name === field).length})\n                            </option>\n                        ))}\n                    </select>\n                    <button onClick={exportChanges} style={styles.exportButton}>\n                        <FaDownload style={{ marginRight: '6px' }} />\n                        Export\n                    </button>\n                </div>\n\n                <div style={styles.content}>\n                    {loading ? (\n                        <div style={styles.loading}>Loading changes...</div>\n                    ) : filteredChanges.length === 0 ? (\n                        <div style={styles.empty}>No changes recorded</div>\n                    ) : (\n                        <div style={styles.changesList}>\n                            {filteredChanges.map((change, idx) => (\n                                <div key={idx} style={styles.changeCard}>\n                                    <div style={styles.changeField}>{change.field_name}</div>\n                                    <div style={styles.changeValues}>\n                                        <div style={styles.oldValue}>\n                                            <div style={styles.valueLabel}>Old:</div>\n                                            <div style={styles.value}>{change.old_value || <em style={{ color: '#99aab5' }}>empty</em>}</div>\n                                        </div>\n                                        <div style={styles.arrow}>â†’</div>\n                                        <div style={styles.newValue}>\n                                            <div style={styles.valueLabel}>New:</div>\n                                            <div style={styles.value}>{change.new_value || <em style={{ color: '#99aab5' }}>empty</em>}</div>\n                                        </div>\n                                    </div>\n                                    <div style={styles.changeMeta}>\n                                        Changed by <span style={styles.username}>{change.changed_by_username}</span> on {new Date(change.changed_at).toLocaleString()}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst styles = {\n    overlay: {\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'rgba(0, 0, 0, 0.85)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 999999,\n    },\n    modal: {\n        backgroundColor: '#1e1e1e',\n        borderRadius: '8px',\n        width: '90%',\n        maxWidth: '800px',\n        maxHeight: '90vh',\n        display: 'flex',\n        flexDirection: 'column',\n        boxShadow: '0 8px 32px rgba(0, 0, 0, 0.4)',\n    },\n    header: {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: '20px',\n        borderBottom: '1px solid #2c2f33',\n    },\n    headerLeft: {\n        display: 'flex',\n        alignItems: 'center',\n    },\n    title: {\n        margin: 0,\n        fontSize: '20px',\n        color: '#ffffff',\n    },\n    closeButton: {\n        background: 'none',\n        border: 'none',\n        color: '#99aab5',\n        cursor: 'pointer',\n        fontSize: '20px',\n        padding: '5px',\n    },\n    toolbar: {\n        display: 'flex',\n        gap: '12px',\n        padding: '15px 20px',\n        borderBottom: '1px solid #2c2f33',\n    },\n    filterSelect: {\n        flex: 1,\n        padding: '8px 12px',\n        backgroundColor: '#2c2f33',\n        border: '1px solid #2c2f33',\n        borderRadius: '4px',\n        color: '#ffffff',\n        fontSize: '14px',\n    },\n    exportButton: {\n        padding: '8px 16px',\n        backgroundColor: '#5865f2',\n        border: 'none',\n        borderRadius: '4px',\n        color: '#ffffff',\n        cursor: 'pointer',\n        fontSize: '13px',\n        display: 'flex',\n        alignItems: 'center',\n    },\n    content: {\n        padding: '20px',\n        overflowY: 'auto',\n        flex: 1,\n    },\n    loading: {\n        textAlign: 'center',\n        color: '#99aab5',\n        padding: '40px',\n    },\n    empty: {\n        textAlign: 'center',\n        color: '#99aab5',\n        padding: '40px',\n    },\n    changesList: {\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '16px',\n    },\n    changeCard: {\n        backgroundColor: '#2c2f33',\n        borderRadius: '8px',\n        padding: '16px',\n    },\n    changeField: {\n        fontSize: '16px',\n        fontWeight: '600',\n        color: '#5865f2',\n        marginBottom: '12px',\n    },\n    changeValues: {\n        display: 'flex',\n        gap: '16px',\n        alignItems: 'center',\n        marginBottom: '12px',\n        padding: '12px',\n        backgroundColor: '#1e1e1e',\n        borderRadius: '6px',\n    },\n    oldValue: {\n        flex: 1,\n    },\n    newValue: {\n        flex: 1,\n    },\n    arrow: {\n        fontSize: '20px',\n        color: '#5865f2',\n    },\n    valueLabel: {\n        fontSize: '12px',\n        color: '#99aab5',\n        marginBottom: '4px',\n    },\n    value: {\n        fontSize: '14px',\n        color: '#ffffff',\n        wordBreak: 'break-word',\n    },\n    changeMeta: {\n        fontSize: '12px',\n        color: '#99aab5',\n    },\n    username: {\n        color: '#5865f2',\n        fontWeight: '500',\n    },\n};\n\nexport default FieldChangeTrackingPanel;\n"],"names":["useState","useEffect","jsx","jsxs"],"mappings":"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"}