import{r as i,d as e,m as $,l as x,i as S,o as B,as as T,U as I,ay as K,Y as P,Q as f,ar as O,p as G,ag as Y}from"./react-core-DrOm_csO.js";import{t as D}from"./index-DmEhdEtw.js";const V=({serverId:a,apiBaseUrl:n,onClose:E})=>{const[m,u]=i.useState([]),[o,d]=i.useState(!0),[c,p]=i.useState("all"),[s,y]=i.useState(""),[N,k]=i.useState(null),[v,R]=i.useState({total:0,unresolved:0,critical:0,resolved_today:0}),_={critical:{label:"Kritik",color:"#ef4444",icon:e.createElement(Y,null)},high:{label:"Yüksek",color:"#f97316",icon:e.createElement($,null)},medium:{label:"Orta",color:"#f59e0b",icon:e.createElement(G,null)},low:{label:"Düşük",color:"#3b82f6",icon:e.createElement(T,null)}},C={brute_force:"Brute Force Saldırısı",suspicious_login:"Şüpheli Giriş",unusual_activity:"Olağandışı Aktivite",permission_abuse:"Yetki Suistimali",spam_detected:"Spam Algılandı",raid_attempt:"Raid Girişimi",api_abuse:"API Suistimali",unauthorized_access:"Yetkisiz Erişim Denemesi"};i.useEffect(()=>{b(),F();const t=setInterval(b,3e4);return()=>clearInterval(t)},[a]);const b=async()=>{try{const t=localStorage.getItem("access_token"),l=await fetch(`${n}/security/alerts/`,{headers:{Authorization:`Bearer ${t}`}});if(l.ok){const r=await l.json();u(r.alerts||[])}}catch(t){console.error("Fetch alerts error:",t)}finally{d(!1)}},F=async()=>{try{const t=localStorage.getItem("access_token"),l=await fetch(`${n}/security/alerts/stats/`,{headers:{Authorization:`Bearer ${t}`}});if(l.ok){const r=await l.json();R(r)}}catch(t){console.error("Fetch stats error:",t)}},z=async(t,l)=>{try{const r=localStorage.getItem("access_token");(await fetch(`${n}/security/alerts/${t}/resolve/`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({resolution:l})})).ok&&(D.success("✅ Uyarı çözümlendi"),u(h=>h.map(g=>g.id===t?{...g,resolved:!0,resolution:l}:g)),k(null),F())}catch(r){console.error("Resolve alert error:",r)}},L=async t=>{try{const l=localStorage.getItem("access_token");(await fetch(`${n}/security/alerts/${t}/dismiss/`,{method:"POST",headers:{Authorization:`Bearer ${l}`}})).ok&&(D.success("Uyarı yok sayıldı"),u(w=>w.filter(h=>h.id!==t)))}catch(l){console.error("Dismiss alert error:",l)}},A=m.filter(t=>{const l=t.message?.toLowerCase().includes(s.toLowerCase())||t.source_ip?.includes(s)||t.user_info?.username?.toLowerCase().includes(s.toLowerCase()),r=c==="all"||c==="unresolved"&&!t.resolved||c==="resolved"&&t.resolved||c==="critical"&&t.severity==="critical";return l&&r});return e.createElement("div",{className:"security-alerts-overlay",onClick:E},e.createElement("div",{className:"security-alerts-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,e.createElement($,null)," Güvenlik Uyarıları"),e.createElement("div",{className:"header-actions"},e.createElement("button",{className:"refresh-btn",onClick:b},e.createElement(x,null)),e.createElement("button",{className:"close-btn",onClick:E},e.createElement(S,null)))),e.createElement("div",{className:"stats-bar"},e.createElement("div",{className:"stat-item"},e.createElement("span",{className:"stat-value"},v.total),e.createElement("span",{className:"stat-label"},"Toplam")),e.createElement("div",{className:"stat-item danger"},e.createElement("span",{className:"stat-value"},v.unresolved),e.createElement("span",{className:"stat-label"},"Bekleyen")),e.createElement("div",{className:"stat-item critical"},e.createElement("span",{className:"stat-value"},v.critical),e.createElement("span",{className:"stat-label"},"Kritik")),e.createElement("div",{className:"stat-item success"},e.createElement("span",{className:"stat-value"},v.resolved_today),e.createElement("span",{className:"stat-label"},"Bugün Çözülen"))),e.createElement("div",{className:"toolbar"},e.createElement("div",{className:"search-box"},e.createElement(B,null),e.createElement("input",{type:"text",placeholder:"Uyarı, IP veya kullanıcı ara...",value:s,onChange:t=>y(t.target.value)})),e.createElement("div",{className:"filter-buttons"},["all","unresolved","resolved","critical"].map(t=>e.createElement("button",{key:t,className:`filter-btn ${c===t?"active":""}`,onClick:()=>p(t)},t==="all"&&"Tümü",t==="unresolved"&&"Bekleyen",t==="resolved"&&"Çözülen",t==="critical"&&"Kritik")))),e.createElement("div",{className:"panel-content"},o?e.createElement("div",{className:"loading"},"Yükleniyor..."):A.length===0?e.createElement("div",{className:"empty-state"},e.createElement(T,null),e.createElement("p",null,"Güvenlik uyarısı bulunmuyor"),e.createElement("span",null,"Sisteminiz güvende görünüyor")):e.createElement("div",{className:"alerts-list"},A.map(t=>e.createElement(j,{key:t.id,alert:t,severityLevels:_,alertTypes:C,onView:()=>k(t),onDismiss:()=>L(t.id),onResolve:l=>z(t.id,l)})))),N&&e.createElement(q,{alert:N,severityLevels:_,alertTypes:C,onClose:()=>k(null),onResolve:t=>z(N.id,t)})))},j=({alert:a,severityLevels:n,alertTypes:E,onView:m,onDismiss:u,onResolve:o})=>{const d=n[a.severity]||n.low;return e.createElement("div",{className:`alert-card ${a.severity} ${a.resolved?"resolved":""}`},e.createElement("div",{className:"alert-severity",style:{background:d.color}},d.icon),e.createElement("div",{className:"alert-content"},e.createElement("div",{className:"alert-header"},e.createElement("span",{className:"alert-type"},E[a.type]||a.type),e.createElement("span",{className:"alert-time"},e.createElement(I,null)," ",new Date(a.created_at).toLocaleString("tr-TR"))),e.createElement("p",{className:"alert-message"},a.message),e.createElement("div",{className:"alert-meta"},a.source_ip&&e.createElement("span",null,e.createElement(K,null)," ",a.source_ip),a.user_info&&e.createElement("span",null,e.createElement(P,null)," ",a.user_info.username),a.resolved&&e.createElement("span",{className:"resolved-badge"},e.createElement(f,null)," Çözümlendi"))),e.createElement("div",{className:"alert-actions"},e.createElement("button",{className:"view-btn",onClick:m},e.createElement(O,null)),!a.resolved&&e.createElement(e.Fragment,null,e.createElement("button",{className:"resolve-btn",onClick:()=>o("Hızlı çözüm")},e.createElement(f,null)),e.createElement("button",{className:"dismiss-btn",onClick:u},e.createElement(S,null)))))},q=({alert:a,severityLevels:n,alertTypes:E,onClose:m,onResolve:u})=>{const[o,d]=i.useState(""),c=n[a.severity]||n.low,p=["False positive - Normal aktivite","Kullanıcı uyarıldı","IP engellendi","Hesap askıya alındı","İncelendi - Aksiyon gerekmiyor"];return e.createElement("div",{className:"modal-overlay",onClick:m},e.createElement("div",{className:"alert-detail-modal",onClick:s=>s.stopPropagation()},e.createElement("div",{className:"modal-header",style:{borderLeftColor:c.color}},e.createElement("div",{className:"severity-badge",style:{background:c.color}},c.icon," ",c.label),e.createElement("button",{className:"close-modal",onClick:m},e.createElement(S,null))),e.createElement("div",{className:"modal-content"},e.createElement("h3",null,E[a.type]||a.type),e.createElement("p",{className:"detail-message"},a.message),e.createElement("div",{className:"detail-section"},e.createElement("h4",null,"Detaylar"),e.createElement("div",{className:"detail-grid"},e.createElement("div",{className:"detail-item"},e.createElement("label",null,e.createElement(I,null)," Zaman"),e.createElement("span",null,new Date(a.created_at).toLocaleString("tr-TR"))),a.source_ip&&e.createElement("div",{className:"detail-item"},e.createElement("label",null,e.createElement(K,null)," Kaynak IP"),e.createElement("span",{className:"mono"},a.source_ip)),a.user_info&&e.createElement(e.Fragment,null,e.createElement("div",{className:"detail-item"},e.createElement("label",null,e.createElement(P,null)," Kullanıcı"),e.createElement("span",null,a.user_info.username)),e.createElement("div",{className:"detail-item"},e.createElement("label",null,"Kullanıcı ID"),e.createElement("span",{className:"mono"},a.user_info.id))),a.location&&e.createElement("div",{className:"detail-item"},e.createElement("label",null,"Konum"),e.createElement("span",null,a.location)))),a.additional_data&&e.createElement("div",{className:"detail-section"},e.createElement("h4",null,"Ek Veriler"),e.createElement("pre",{className:"json-data"},JSON.stringify(a.additional_data,null,2))),!a.resolved&&e.createElement("div",{className:"resolution-section"},e.createElement("h4",null,"Çözüm"),e.createElement("div",{className:"quick-resolutions"},p.map((s,y)=>e.createElement("button",{key:y,className:`quick-res-btn ${o===s?"active":""}`,onClick:()=>d(s)},s))),e.createElement("textarea",{value:o,onChange:s=>d(s.target.value),placeholder:"Veya özel bir çözüm notu yazın...",rows:"3"}))),e.createElement("div",{className:"modal-actions"},e.createElement("button",{className:"cancel-btn",onClick:m},"Kapat"),!a.resolved&&e.createElement("button",{className:"resolve-btn",onClick:()=>u(o||"Çözümlendi"),disabled:!o},e.createElement(f,null)," Çözümle"))))};export{V as default};
