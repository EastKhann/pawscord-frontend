import{r as a,n as e}from"./react-core-BMiyQWF6.js";import{g as f,b0 as G,a as F,cD as K,a1 as Q,Y as V,k as X,ar as Z}from"./icons-vendor-T72gfvdf.js";import{g as c}from"./index-lWZOr2BX.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const oe=({userId:n,onClose:M})=>{const[o,d]=a.useState([]),[m,x]=a.useState(0),[r,j]=a.useState("all"),[I,P]=a.useState(null),[g,N]=a.useState(!1),[O,D]=a.useState(!0),[p,v]=a.useState(!0),[b,y]=a.useState(!0),[k,S]=a.useState(!1),[w,$]=a.useState(!1),[C,E]=a.useState(!0);a.useEffect(()=>{R(),B()},[n,r]);const i=async(s,t={})=>{const _=localStorage.getItem("access_token"),l=await fetch(s,{...t,headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json",...t.headers}});if(!l.ok)throw new Error(`HTTP ${l.status}`);return await l.json()},R=async()=>{try{const s=await i(`${c()}/notifications/${n}/list/?filter=${r}`);d(s.notifications||[]),x(s.unread_count||0)}catch{}finally{D(!1)}},B=async()=>{try{const s=await i(`${c()}/notifications/${n}/settings/`);P(s),v(s.push_enabled),y(s.email_enabled),S(s.mentions_only),$(s.dnd_enabled),E(s.sound_enabled)}catch{}},L=async s=>{try{await i(`${c()}/notifications/${n}/${s}/read/`,{method:"POST"}),d(o.map(t=>t.id===s?{...t,read:!0}:t)),x(Math.max(0,m-1))}catch{}},U=async()=>{try{await i(`${c()}/notifications/${n}/read-all/`,{method:"POST"}),d(o.map(s=>({...s,read:!0}))),x(0),h("All notifications marked as read!")}catch{}},z=async s=>{try{await i(`${c()}/notifications/${n}/${s}/delete/`,{method:"DELETE"}),d(o.filter(t=>t.id!==s)),h("Notification deleted!")}catch{}},J=async()=>{if(window.confirm("Are you sure you want to clear all notifications?"))try{await i(`${c()}/notifications/${n}/clear/`,{method:"POST"}),d([]),x(0),h("All notifications cleared!")}catch{}},Y=async()=>{try{await i(`${c()}/notifications/${n}/settings/update/`,{method:"PUT",body:JSON.stringify({push_enabled:p,email_enabled:b,mentions_only:k,dnd_enabled:w,sound_enabled:C})}),h("Settings updated!"),N(!1)}catch{}},H=async()=>{try{await i(`${c()}/notifications/${n}/test/`,{method:"POST"}),h("Test notification sent!")}catch{}},W=s=>{switch(s){case"mention":return"ðŸ’¬";case"reply":return"â†©ï¸";case"like":return"â¤ï¸";case"follow":return"ðŸ‘¤";case"server_invite":return"ðŸ“§";case"role_update":return"ðŸ·ï¸";case"announcement":return"ðŸ“¢";default:return"ðŸ””"}},q=s=>{const t=new Date(s),l=new Date-t,u=Math.floor(l/6e4),A=Math.floor(l/36e5),T=Math.floor(l/864e5);return u<1?"Just now":u<60?`${u}m ago`:A<24?`${A}h ago`:T<7?`${T}d ago`:t.toLocaleDateString()},h=(s,t="success")=>{};return O?e.jsx("div",{className:"notifications-overlay",children:e.jsxs("div",{className:"notifications-panel loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading Notifications..."})]})}):e.jsx("div",{className:"notifications-overlay",children:e.jsxs("div",{className:"notifications-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[e.jsx(f,{})," Notifications"]}),m>0&&e.jsxs("span",{className:"unread-badge",children:[m," new"]})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:()=>N(!g),className:"btn-settings",children:e.jsx(G,{})}),e.jsx("button",{onClick:M,className:"btn-close",children:e.jsx(F,{})})]})]}),e.jsxs("div",{className:"filter-bar",children:[e.jsx("button",{className:r==="all"?"active":"",onClick:()=>j("all"),children:"All"}),e.jsx("button",{className:r==="unread"?"active":"",onClick:()=>j("unread"),children:"Unread"}),e.jsx("button",{className:r==="mentions"?"active":"",onClick:()=>j("mentions"),children:"Mentions"}),e.jsx("button",{className:r==="servers"?"active":"",onClick:()=>j("servers"),children:"Servers"})]}),g&&e.jsxs("div",{className:"settings-panel",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(K,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Push Notifications"}),e.jsx("p",{children:"Receive notifications on your device"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>v(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(Q,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Email Notifications"}),e.jsx("p",{children:"Receive notifications via email"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>y(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(f,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Sound Effects"}),e.jsx("p",{children:"Play sound when you receive notifications"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>E(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mentions Only"}),e.jsx("p",{children:"Only notify when you're mentioned"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>S(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx(X,{}),e.jsxs("div",{children:[e.jsx("h4",{children:"Do Not Disturb"}),e.jsx("p",{children:"Mute all notifications temporarily"})]})]}),e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>$(s.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{onClick:H,className:"btn-test",children:"Test Notification"}),e.jsx("button",{onClick:Y,className:"btn-save",children:"Save Settings"})]})]}),e.jsxs("div",{className:"panel-actions",children:[m>0&&e.jsxs("button",{onClick:U,className:"btn-mark-read",children:[e.jsx(Z,{})," Mark All as Read"]}),o.length>0&&e.jsx("button",{onClick:J,className:"btn-clear",children:"Clear All"})]}),e.jsx("div",{className:"notifications-content",children:o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(f,{size:64}),e.jsx("h3",{children:"No Notifications"}),e.jsx("p",{children:"You're all caught up!"})]}):e.jsx("div",{className:"notifications-list",children:o.map(s=>e.jsxs("div",{className:`notification-item ${s.read?"":"unread"}`,onClick:()=>!s.read&&L(s.id),children:[e.jsx("div",{className:"notification-icon",children:W(s.type)}),e.jsxs("div",{className:"notification-body",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:s.title}),e.jsx("span",{className:"notification-time",children:q(s.created_at)})]}),e.jsx("p",{className:"notification-message",children:s.message}),s.server_name&&e.jsxs("span",{className:"notification-server",children:["in ",s.server_name]})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),z(s.id)},className:"btn-delete-notification",children:e.jsx(F,{})}),!s.read&&e.jsx("div",{className:"unread-dot"})]},s.id))})})]})})};export{oe as default};
