var E=Object.defineProperty;var n=(i,d)=>E(i,"name",{value:d,configurable:!0});import{r as s,j as e}from"./react-core-Djgtqrmb.js";import{y as l}from"./ui-vendor-IhB9Znpc.js";import{g as P,e as O}from"./index-BT6pEMKq.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-ClgLnMjk.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";const D=n(({serverId:i,onClose:d})=>{const o=P(),[p,k]=s.useState([]),[f,h]=s.useState(!1),[r,c]=s.useState({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""}),[x,v]=s.useState([]),[b,C]=s.useState(!0),j=s.useCallback(a=>a.stopPropagation(),[]),N=s.useCallback(()=>h(!0),[]),m=s.useCallback(()=>h(!1),[]),y=s.useCallback(a=>c(t=>({...t,title:a.target.value})),[]),_=s.useCallback(a=>c(t=>({...t,description:a.target.value})),[]),S=s.useCallback(a=>c(t=>({...t,remind_at:a.target.value})),[]),w=s.useCallback(a=>c(t=>({...t,repeat:a.target.value})),[]),$=s.useCallback(a=>c(t=>({...t,channel_id:a.target.value})),[]);s.useEffect(()=>{u(),R()},[i]);const u=n(async()=>{try{const a=await fetch(`${o}/reminders/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();k(t)}}catch{}finally{C(!1)}},"fetchReminders"),R=n(async()=>{try{const a=await fetch(`${o}/channels/server/${i}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const t=await a.json();v(t.filter(A=>A.type==="text"))}}catch{}},"fetchChannels"),B=n(async()=>{if(!r.title||!r.remind_at||!r.channel_id){l.error("‚ùå L√ºtfen gerekli alanlarƒ± doldurun");return}try{(await fetch(`${o}/reminders/create/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:i,...r})})).ok?(l.success("‚úÖ Hatƒ±rlatƒ±cƒ± olu≈üturuldu"),h(!1),u(),c({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""})):l.error("‚ùå Olu≈üturma hatasƒ±")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"createReminder"),H=n(async a=>{if(await O("Hatƒ±rlatƒ±cƒ±yƒ± silmek istediƒüinize emin misiniz?"))try{(await fetch(`${o}/reminders/${a}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(l.success("‚úÖ Hatƒ±rlatƒ±cƒ± silindi"),u())}catch{l.error("‚ùå Silme hatasƒ±")}},"deleteReminder"),T=n(async a=>{try{(await fetch(`${o}/reminders/${a}/trigger/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&l.success("‚úÖ Hatƒ±rlatƒ±cƒ± tetiklendi")}catch{l.error("‚ùå Tetikleme hatasƒ±")}},"triggerNow"),z=n(a=>new Date(a).toLocaleString("tr-TR"),"formatTime"),g=n(a=>{const t={once:{text:"Bir kez",color:"#6b7280"},daily:{text:"G√ºnl√ºk",color:"#3b82f6"},weekly:{text:"Haftalƒ±k",color:"#8b5cf6"},monthly:{text:"Aylƒ±k",color:"#ec4899"}};return t[a]||t.once},"getRepeatBadge");return e.jsx("div",{className:"reminder-overlay",onClick:d,children:e.jsxs("div",{className:"reminder-panel",onClick:j,children:[e.jsxs("div",{className:"reminder-header",children:[e.jsx("h2",{children:"‚è∞ Hatƒ±rlatƒ±cƒ±lar"}),e.jsx("button",{className:"close-btn",onClick:d,children:"√ó"})]}),e.jsxs("div",{className:"reminder-content",children:[e.jsx("button",{className:"create-reminder-btn",onClick:N,children:"+ Yeni Hatƒ±rlatƒ±cƒ±"}),b?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Y√ºkleniyor..."})]}):p.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"‚è∞"}),e.jsx("p",{children:"Hen√ºz hatƒ±rlatƒ±cƒ± yok"})]}):e.jsx("div",{className:"reminders-list",children:p.map(a=>e.jsxs("div",{className:"reminder-card",children:[e.jsxs("div",{className:"reminder-main",children:[e.jsx("h3",{children:a.title}),a.description&&e.jsx("p",{children:a.description}),e.jsxs("div",{className:"reminder-meta",children:[e.jsxs("span",{children:["‚è∞ ",z(a.remind_at)]}),e.jsxs("span",{children:["üìç ",x.find(t=>t.id===a.channel_id)?.name]}),e.jsxs("span",{className:"repeat-badge",style:{background:g(a.repeat).color},children:["üîÑ ",g(a.repeat).text]})]})]}),e.jsxs("div",{className:"reminder-actions",children:[e.jsx("button",{className:"trigger-btn",onClick:n(()=>T(a.id),"onClick"),children:"‚ñ∂Ô∏è Tetikle"}),e.jsx("button",{className:"delete-btn",onClick:n(()=>H(a.id),"onClick"),children:"üóëÔ∏è"})]})]},a.id))})]}),f&&e.jsx("div",{className:"create-modal-overlay",onClick:m,children:e.jsxs("div",{className:"create-modal",onClick:j,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Yeni Hatƒ±rlatƒ±cƒ±"}),e.jsx("button",{className:"close-btn",onClick:m,children:"√ó"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ba≈ülƒ±k *"}),e.jsx("input",{value:r.title,onChange:y})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"A√ßƒ±klama"}),e.jsx("textarea",{value:r.description,onChange:_,rows:"3"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tarih/Saat *"}),e.jsx("input",{type:"datetime-local",value:r.remind_at,onChange:S})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tekrar"}),e.jsxs("select",{value:r.repeat,onChange:w,children:[e.jsx("option",{value:"once",children:"Bir kez"}),e.jsx("option",{value:"daily",children:"G√ºnl√ºk"}),e.jsx("option",{value:"weekly",children:"Haftalƒ±k"}),e.jsx("option",{value:"monthly",children:"Aylƒ±k"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:r.channel_id,onChange:$,children:[e.jsx("option",{value:"",children:"Se√ßin"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:m,children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:B,children:"‚è∞ Olu≈ütur"})]})]})})]})})},"ReminderPanel"),F=s.memo(D);export{F as default};
