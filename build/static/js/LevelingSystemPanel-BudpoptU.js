import{r as i,n as s}from"./react-core-Cj7FUMmY.js";import{y as t}from"./ui-vendor-EA4dxvko.js";import{g as K,h as M}from"./index-m_1Kt7YY.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./icons-vendor-DnRG7SaF.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const Q=({serverId:r,onClose:g})=>{const[l,c]=i.useState({enabled:!1,xp_per_message:15,xp_cooldown:60,level_up_message:"Tebrikler {user}! {level} seviyeye ulaÅŸtÄ±n! ğŸ‰",announce_channel_id:"",stack_roles:!1,reset_on_leave:!1}),[m,v]=i.useState([]),[d,p]=i.useState({level:1,role_id:""}),[b,y]=i.useState([]),[k,N]=i.useState([]),[u,_]=i.useState([]),[S,$]=i.useState(!0),o=K();i.useEffect(()=>{r&&(w(),C(),z(),P(),j())},[r]);const w=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/leveling/server/${r}/config/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();c(n.config||l)}}catch{}finally{$(!1)}},C=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/leveling/server/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();v(n.level_roles||[])}}catch{}},z=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/servers/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();y(n.roles||[])}}catch{}},P=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/servers/${r}/channels/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();N(n.channels||[])}}catch{}},j=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/leveling/server/${r}/leaderboard/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();_(n.leaderboard||[])}}catch{}},R=async()=>{try{const e=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(l)})).ok?t.success("âœ… Ayarlar kaydedildi"):t.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch{t.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}},A=async()=>{if(!d.role_id||d.level<1){t.error("âŒ Rol ve seviye zorunludur");return}try{const e=localStorage.getItem("access_token"),a=await fetch(`${o}/leveling/server/${r}/roles/add/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(a.ok){const n=await a.json();v([...m,n.level_role]),p({level:1,role_id:""}),t.success("âœ… Seviye rolÃ¼ eklendi")}}catch{t.error("âŒ Ekleme baÅŸarÄ±sÄ±z")}},L=async e=>{try{const a=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/roles/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok&&(v(m.filter(h=>h.id!==e)),t.success("âœ… Seviye rolÃ¼ kaldÄ±rÄ±ldÄ±"))}catch{t.error("âŒ KaldÄ±rma baÅŸarÄ±sÄ±z")}},B=async e=>{if(await M("Bu kullanÄ±cÄ±nÄ±n XP'sini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${o}/leveling/server/${r}/user/${e}/reset/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(t.success("âœ… XP sÄ±fÄ±rlandÄ±"),j())}catch{t.error("âŒ SÄ±fÄ±rlama baÅŸarÄ±sÄ±z")}},X=e=>e===1?"#fbbf24":e===2?"#c0c0c0":e===3?"#cd7f32":"#6366f1",E=e=>{const h=100-e,x=Math.floor((-50+Math.sqrt(2500-20*h))/10);return Math.max(1,x)},f=e=>5*e**2+50*e+100;return S?s.jsx("div",{className:"leveling-overlay",children:s.jsx("div",{className:"leveling-panel",children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Seviye sistemi yÃ¼kleniyor..."})]})})}):s.jsx("div",{className:"leveling-overlay",onClick:g,children:s.jsxs("div",{className:"leveling-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"leveling-header",children:[s.jsx("h2",{children:"â­ Seviye Sistemi"}),s.jsx("button",{className:"close-btn",onClick:g,children:"Ã—"})]}),s.jsxs("div",{className:"leveling-content",children:[s.jsxs("div",{className:"config-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsx("h3",{children:"âš™ï¸ Genel Ayarlar"}),s.jsxs("label",{className:"toggle-switch",children:[s.jsx("input",{type:"checkbox",checked:l.enabled,onChange:e=>c({...l,enabled:e.target.checked})}),s.jsx("span",{className:"slider"}),s.jsx("span",{className:"toggle-label",children:l.enabled?"Aktif":"Pasif"})]})]}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Mesaj BaÅŸÄ±na XP"}),s.jsx("input",{type:"number",min:"1",max:"100",value:l.xp_per_message,onChange:e=>c({...l,xp_per_message:parseInt(e.target.value)}),disabled:!l.enabled})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"XP Cooldown (saniye)"}),s.jsx("input",{type:"number",min:"0",max:"300",value:l.xp_cooldown,onChange:e=>c({...l,xp_cooldown:parseInt(e.target.value)}),disabled:!l.enabled})]}),s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Duyuru KanalÄ±"}),s.jsxs("select",{value:l.announce_channel_id,onChange:e=>c({...l,announce_channel_id:e.target.value}),disabled:!l.enabled,children:[s.jsx("option",{value:"",children:"SeÃ§iniz (opsiyonel)"}),k.map(e=>s.jsxs("option",{value:e.id,children:["#",e.name]},e.id))]})]}),s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Seviye Atlama MesajÄ±"}),s.jsx("textarea",{value:l.level_up_message,onChange:e=>c({...l,level_up_message:e.target.value}),disabled:!l.enabled,rows:"2"}),s.jsxs("span",{className:"hint",children:["KullanÄ±labilir: ","{user}",", ","{level}"]})]}),s.jsx("div",{className:"form-group",children:s.jsxs("label",{className:"checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:l.stack_roles,onChange:e=>c({...l,stack_roles:e.target.checked}),disabled:!l.enabled}),s.jsx("span",{children:"Rolleri biriktir (Ã¶nceki seviye rollerini kaldÄ±rma)"})]})}),s.jsx("div",{className:"form-group",children:s.jsxs("label",{className:"checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:l.reset_on_leave,onChange:e=>c({...l,reset_on_leave:e.target.checked}),disabled:!l.enabled}),s.jsx("span",{children:"Sunucudan ayrÄ±lÄ±nca XP'yi sÄ±fÄ±rla"})]})})]}),s.jsx("button",{className:"save-btn",onClick:R,children:"ğŸ’¾ AyarlarÄ± Kaydet"})]}),s.jsxs("div",{className:"level-roles-section",children:[s.jsx("h3",{children:"ğŸ­ Seviye Rolleri"}),s.jsxs("div",{className:"add-role-form",children:[s.jsx("input",{type:"number",placeholder:"Seviye",min:"1",value:d.level,onChange:e=>p({...d,level:parseInt(e.target.value)})}),s.jsxs("select",{value:d.role_id,onChange:e=>p({...d,role_id:e.target.value}),children:[s.jsx("option",{value:"",children:"Rol seÃ§in"}),b.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("button",{className:"add-btn",onClick:A,children:"â• Ekle"})]}),s.jsx("div",{className:"level-roles-list",children:m.length===0?s.jsx("div",{className:"empty-state",children:s.jsx("span",{children:"HenÃ¼z seviye rolÃ¼ eklenmedi"})}):m.sort((e,a)=>e.level-a.level).map(e=>s.jsxs("div",{className:"level-role-item",children:[s.jsxs("div",{className:"level-badge",children:["Lv ",e.level]}),s.jsx("span",{className:"role-name",children:e.role_name||`Role #${e.role_id}`}),s.jsx("button",{className:"remove-btn",onClick:()=>L(e.id),children:"Ã—"})]},e.id))})]}),s.jsxs("div",{className:"leaderboard-section",children:[s.jsx("h3",{children:"ğŸ† SÄ±ralama"}),s.jsx("div",{className:"leaderboard-list",children:u.length===0?s.jsx("div",{className:"empty-state",children:s.jsx("span",{children:"HenÃ¼z seviye kazanan Ã¼ye yok"})}):u.map((e,a)=>{const n=E(e.xp),h=f(n),x=f(n+1),T=(e.xp-h)/(x-h)*100;return s.jsxs("div",{className:"leaderboard-item",children:[s.jsxs("div",{className:"rank-badge",style:{background:X(a+1)},children:["#",a+1]}),s.jsx("div",{className:"user-avatar",children:e.avatar?s.jsx("img",{src:e.avatar,alt:e.username}):s.jsx("span",{children:e.username[0]})}),s.jsxs("div",{className:"user-info",children:[s.jsx("div",{className:"user-name",children:e.username}),s.jsxs("div",{className:"level-progress",children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${T}%`}})}),s.jsxs("span",{className:"level-text",children:["Level ",n," â€¢ ",e.xp," XP"]})]})]}),s.jsx("button",{className:"reset-btn",onClick:()=>B(e.user_id),children:"ğŸ”„"})]},e.user_id)})})]})]})]})})};export{Q as default};
