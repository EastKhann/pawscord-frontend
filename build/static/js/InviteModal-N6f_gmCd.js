import{r as a,n as t,f as K}from"./react-core-zXIKm1Jm.js";import{a as Q,f as V,ap as W,b3 as q}from"./icons-vendor-BBdoVeJd.js";import{t as l}from"./index-BQhmOVgm.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const de=({onClose:v,server:s,fetchWithAuth:d,apiBaseUrl:c,currentUser:R})=>{const[x,y]=a.useState(""),[g,X]=a.useState(0),[p,T]=a.useState(0),[m,b]=a.useState(!1),[h,k]=a.useState(!1),[_,D]=a.useState([]),[O,j]=a.useState(!1),[I,L]=a.useState(""),[z,S]=a.useState(new Set),[f,F]=a.useState(R||"");a.useEffect(()=>{$(),E()},[]);const $=async()=>{if(!f)try{const e=await d(`${c}/users/me/`);if(e.ok){const o=await e.json();F(o.username)}}catch(e){console.error(e)}},E=async()=>{j(!0);try{const e=await d(`${c}/friends/list/`);if(e.ok){const o=await e.json();console.log("[InviteModal] Friends response:",o);const r=Array.isArray(o)?o:o.friends||[];D(r),console.log("[InviteModal] Friends loaded:",r.length)}}catch(e){console.error("ArkadaÅŸ listesi hatasÄ±:",e)}finally{j(!1)}},A=async e=>{console.log(`ðŸ“¨ [InviteModal] Sending invite to: ${e}`),S(o=>new Set(o).add(e));try{const o={server_id:s.id,max_uses:1,expires_in_hours:24};console.log("ðŸ“¤ [InviteModal] Creating invite:",o);const r=await d(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const U=await r.json();throw new Error(U.error||"Davet oluÅŸturulamadÄ±")}const i=await r.json(),J=i.code,u=i.url||i.invite_link;console.log("âœ… [InviteModal] Invite created:",{code:J,url:u});const M=await d(`${c}/conversations/find_or_create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_username:e})});if(!M.ok)throw new Error("DM oluÅŸturulamadÄ±");const B=(await M.json()).conversation_id;console.log("ðŸ’¬ [InviteModal] Conversation created/found:",B);const Y={conversation_id:B,content:`Hey! Seni **${s.name}** sunucusuna davet ediyorum. KatÄ±lmak iÃ§in:
${u}`};(await d(`${c}/messages/send_dm/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)})).ok?(console.log("âœ… [InviteModal] Message sent successfully"),l.success(`${e} kullanÄ±cÄ±sÄ±na davet DM olarak gÃ¶nderildi!`)):(console.warn("âš ï¸ [InviteModal] Message send failed"),navigator.clipboard.writeText(u),l.success(`Davet linki oluÅŸturuldu ve panoya kopyalandÄ±!

${e} ile manuel olarak paylaÅŸabilirsiniz:

${u}`,5e3))}catch(o){console.error("âŒ [InviteModal] Error:",o),S(r=>{const i=new Set(r);return i.delete(e),i}),l.error("Davet gÃ¶nderilemedi: "+o.message)}},w=e=>f?e.sender_username===f?e.receiver_username:e.sender_username:e.receiver_username,C=_.filter(e=>w(e).toLowerCase().includes(I.toLowerCase())),N=async()=>{if(console.log("ðŸŽ¬ [InviteModal] Starting invite creation...",{server:s?{id:s.id,name:s.name}:null,maxUses:g,expiresAfter:p}),!s||!s.id){l.error("Hata: Sunucu bilgisi bulunamadÄ±!"),console.error("âŒ [InviteModal] No server provided!");return}k(!0);try{const e={server_id:s.id,max_uses:g===0?0:g,expires_in_hours:Math.floor(p/60)};console.log("ðŸ“¤ [InviteModal] Payload:",e);const o=await d(`${c}/invites/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("ðŸ“¥ [InviteModal] Response status:",o.status);const r=await o.json();if(console.log("ðŸ“‹ [InviteModal] Response data:",r),o.ok){const i=r.url||r.invite_link||`https://www.pawscord.com/#/invite/${r.code}`;if(console.log("âœ… [InviteModal] Invite created:",{code:r.code,url:i,rawData:r}),!i){console.error("âŒ [InviteModal] No URL in response!",r),l.error("Hata: Davet linki oluÅŸturulamadÄ± (URL yok)");return}y(i),console.log("ðŸ”— [InviteModal] Link set to:",i),l.success(`Davet linki oluÅŸturuldu!
${i}`,4e3)}else console.error("âŒ [InviteModal] Error:",r.error),l.error(r.error||"Davet oluÅŸturulamadÄ±.")}catch(e){console.error("âŒ [InviteModal] Exception:",e),l.error("BaÄŸlantÄ± hatasÄ±: "+e.message)}finally{k(!1)}},P=()=>{navigator.clipboard.writeText(x),b(!0),setTimeout(()=>b(!1),2e3)},H=[{label:"30 Dk",value:30},{label:"1 GÃ¼n",value:1440},{label:"SÃ¼resiz",value:0}],G=t.jsx("div",{style:n.overlay,onClick:v,children:t.jsxs("div",{style:n.modal,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:n.header,children:[t.jsx("h2",{style:n.title,children:"ArkadaÅŸlarÄ±nÄ± Davet Et"}),t.jsx("button",{onClick:v,style:n.closeBtn,children:t.jsx(Q,{})})]}),t.jsxs("div",{style:n.content,children:[t.jsxs("div",{style:n.friendSection,children:[t.jsxs("div",{style:n.searchBox,children:[t.jsx(V,{style:n.searchIcon}),t.jsx("input",{type:"text",placeholder:"ArkadaÅŸ ara...",style:n.searchInput,value:I,onChange:e=>L(e.target.value)})]}),t.jsx("div",{style:n.friendList,children:O?t.jsx("div",{style:n.loadingText,children:"YÃ¼kleniyor..."}):C.length===0?t.jsx("div",{style:n.emptyText,children:"ArkadaÅŸ bulunamadÄ±."}):C.map(e=>{const o=w(e),r=z.has(o),i=e.sender_username===o?e.sender_avatar:e.receiver_avatar;return t.jsxs("div",{style:n.friendItem,children:[t.jsxs("div",{style:n.friendInfo,children:[t.jsx("div",{style:n.friendAvatar,children:i?t.jsx("img",{src:i,alt:o,style:n.avatarImg}):t.jsx("span",{children:o.charAt(0).toUpperCase()})}),t.jsx("span",{style:n.friendName,children:o})]}),t.jsx("button",{onClick:()=>!r&&A(o),style:{...n.inviteBtn,...r?n.inviteBtnSent:{}},disabled:r,children:r?"GÃ¶nderildi":"Davet Et"})]},e.id)})})]}),t.jsx("div",{style:n.divider,children:t.jsx("span",{children:"VEYA LÄ°NK OLUÅžTUR"})}),t.jsxs("div",{style:n.linkSection,children:[t.jsx("div",{style:n.optionsRow,children:H.map(e=>t.jsx("button",{onClick:()=>T(e.value),style:{...n.miniOptionBtn,...p===e.value&&n.optionBtnActive},children:e.label},e.value))}),t.jsx("div",{style:n.linkBoxContainer,children:x?t.jsxs("div",{style:n.linkBox,children:[t.jsx("input",{type:"text",value:x,readOnly:!0,style:n.linkInput}),t.jsx("button",{onClick:P,style:{...n.copyBtn,...m&&n.copyBtnSuccess},children:m?t.jsx(W,{}):t.jsx(q,{})})]}):t.jsx("button",{onClick:N,disabled:h,style:n.generateBtn,children:h?"Link OluÅŸturuluyor...":"Davet Linki OluÅŸtur"})}),x&&t.jsxs("div",{style:n.footerLinkOpts,children:[t.jsx("small",{style:{color:"#b9bbbe"},children:p===0?"SÃ¼re sÄ±nÄ±rÄ± yok":`${p} dakika geÃ§erli`}),t.jsx("button",{onClick:()=>y(""),style:n.textBtn,children:"Yeni Link"})]})]})]})]})});return K.createPortal(G,document.body)},n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,backdropFilter:"blur(5px)",margin:0,padding:0},modal:{backgroundColor:"#313338",borderRadius:"8px",width:"440px",maxWidth:"90%",maxHeight:"85%",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0,0,0,0.5)",overflow:"hidden",position:"relative",margin:0},header:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{margin:0,color:"#f2f3f5",fontSize:"16px",fontWeight:"bold",textTransform:"uppercase"},closeBtn:{background:"none",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"20px"},content:{padding:"0 20px 20px 20px",display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},friendSection:{flex:1,display:"flex",flexDirection:"column",minHeight:"200px",marginBottom:"10px"},searchBox:{backgroundColor:"#1e1f22",borderRadius:"4px",padding:"0 10px",display:"flex",alignItems:"center",marginBottom:"10px",border:"1px solid #1e1f22"},searchIcon:{color:"#b5bac1",marginRight:"8px"},searchInput:{backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px 0",flex:1,outline:"none",fontSize:"14px"},friendList:{flex:1,overflowY:"auto",paddingRight:"5px"},friendItem:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #3f4147"},friendInfo:{display:"flex",alignItems:"center",gap:"10px"},friendAvatar:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"#5865f2",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",overflow:"hidden"},avatarImg:{width:"100%",height:"100%",objectFit:"cover"},friendName:{color:"#f2f3f5",fontSize:"14px",fontWeight:"500"},inviteBtn:{padding:"6px 16px",backgroundColor:"transparent",border:"1px solid #23a559",color:"#23a559",borderRadius:"3px",cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.2s"},inviteBtnSent:{backgroundColor:"transparent",border:"1px solid #b5bac1",color:"#b5bac1",cursor:"default"},loadingText:{color:"#b5bac1",textAlign:"center",marginTop:"20px",fontSize:"13px"},emptyText:{color:"#b5bac1",textAlign:"center",marginTop:"20px",fontSize:"13px"},divider:{display:"flex",alignItems:"center",justifyContent:"center",margin:"15px 0",color:"#b5bac1",fontSize:"11px",fontWeight:"bold",position:"relative"},linkSection:{backgroundColor:"#2b2d31",margin:"0 -20px -20px -20px",padding:"20px",borderTop:"1px solid #1e1f22"},optionsRow:{display:"flex",gap:"10px",marginBottom:"15px"},miniOptionBtn:{flex:1,padding:"8px",backgroundColor:"#1e1f22",border:"none",borderRadius:"4px",color:"#b5bac1",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},optionBtnActive:{backgroundColor:"#404249",color:"#f2f3f5"},linkBoxContainer:{display:"flex",gap:"10px"},linkBox:{display:"flex",flex:1,backgroundColor:"#1e1f22",borderRadius:"4px",padding:"2px",border:"1px solid #1e1f22",alignItems:"center"},linkInput:{flex:1,backgroundColor:"transparent",border:"none",color:"#f2f3f5",padding:"10px",fontSize:"13px",outline:"none",textOverflow:"ellipsis"},copyBtn:{padding:"8px 20px",backgroundColor:"#5865f2",border:"none",borderRadius:"3px",color:"white",cursor:"pointer",height:"100%",marginRight:"2px"},copyBtnSuccess:{backgroundColor:"#23a559"},generateBtn:{width:"100%",padding:"10px",backgroundColor:"#5865f2",border:"none",borderRadius:"3px",color:"white",fontWeight:"500",cursor:"pointer",fontSize:"13px"},footerLinkOpts:{display:"flex",justifyContent:"space-between",marginTop:"10px",alignItems:"center"},textBtn:{background:"none",border:"none",color:"#00a8fc",fontSize:"12px",cursor:"pointer",padding:0}};export{de as default};
