import{r as u,j as e}from"./react-core-D6cE4lil.js";import{cg as P,c0 as I,cv as L,b_ as D,bZ as H,bX as K,bU as Y,bY as G,cw as y,cx as R,a8 as J,aK as U,q,b$ as $,a9 as C,c as V,az as T,j as _,an as S,k as w,a as A,t as X}from"./icons-vendor-fClA8qVL.js";import{y as m}from"./ui-vendor-CZOhtEfS.js";import{d as B}from"./index-B3eDbSm-.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";const z={github:G,spotify:Y,twitch:K,youtube:H,discord:D,slack:L,google:I,twitter:P},F={github:"#333",spotify:"#1db954",twitch:"#9146ff",youtube:"#ff0000",discord:"#5865f2",slack:"#4a154b",google:"#4285f4",twitter:"#1da1f2"},Z=n=>{switch(n){case"development":return e.jsx(q,{});case"entertainment":return e.jsx(U,{});case"streaming":return e.jsx(J,{});case"productivity":return e.jsx(R,{});default:return e.jsx(y,{})}},Q=n=>{const[l,i]=u.useState("connected"),[r,h]=u.useState([]),[t,s]=u.useState([]),[c,a]=u.useState(!0),[x,b]=u.useState(""),[o,f]=u.useState({show:!1,integration:null}),p=localStorage.getItem("access_token");u.useEffect(()=>{v()},[n]);const v=async()=>{a(!0);try{const[d,j]=await Promise.all([fetch(`/api/servers/${n}/integrations/`,{headers:{Authorization:`Bearer ${p}`}}),fetch("/api/integrations/available/",{headers:{Authorization:`Bearer ${p}`}})]);if(d.ok){const g=await d.json();h(g.integrations||[])}if(j.ok){const g=await j.json();s(g.integrations||[])}else s([])}catch{s([])}a(!1)},N=async d=>{try{const j=await fetch(`/api/servers/${n}/integrations/connect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({integration_type:d})});if(j.ok){const g=await j.json();g.oauth_url&&window.open(g.oauth_url,"_blank","width=500,height=600"),m.success(`${d} entegrasyon başlatıldı`),v()}else m.error("Bağlantı başlatılamadı")}catch{m.error("Bağlantı hatası")}},k=async d=>{if(await B("Bu entegrasyonu kaldırmak istediğinize emin misiniz?"))try{(await fetch(`/api/servers/${n}/integrations/${d}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}})).ok&&(m.success("Entegrasyon kaldırıldı"),v())}catch{m.error("Entegrasyon kaldırılamadı")}},E=async d=>{try{(await fetch(`/api/servers/${n}/integrations/${d}/sync/`,{method:"POST",headers:{Authorization:`Bearer ${p}`}})).ok&&m.success("Senkronizasyon başlatıldı")}catch{m.error("Senkronizasyon başarısız")}},W=t.filter(d=>d.name.toLowerCase().includes(x.toLowerCase())||d.description.toLowerCase().includes(x.toLowerCase())),M=r.map(d=>d.type),O=W.filter(d=>!M.includes(d.id));return{activeTab:l,setActiveTab:i,integrations:r,notConnected:O,loading:c,searchTerm:x,setSearchTerm:b,configModal:o,setConfigModal:f,token:p,handleConnect:N,handleDisconnect:k,handleSync:E,fetchIntegrations:v}},ee=({integrations:n,icons:l,colors:i,onDisconnect:r,onSync:h,onConfigure:t})=>n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx($,{}),e.jsx("p",{children:"Henüz bağlı entegrasyon yok"}),e.jsx("span",{className:"hint",children:'"Mevcut" sekmesinden entegrasyon ekleyin'})]}):e.jsx("div",{className:"connected-list",children:n.map(s=>{const c=l[s.type]||y,a=i[s.type]||"#666";return e.jsxs("div",{className:"integration-card connected",children:[e.jsx("div",{className:"integration-icon",style:{background:a},children:e.jsx(c,{})}),e.jsxs("div",{className:"integration-info",children:[e.jsx("h4",{children:s.name}),e.jsxs("div",{className:"connection-info",children:[e.jsxs("span",{className:"status connected",children:[e.jsx(C,{})," Bağlı"]}),s.account_name&&e.jsxs("span",{className:"account",children:["@",s.account_name]})]}),e.jsxs("div",{className:"last-sync",children:["Son senkronizasyon: ",s.last_sync||"Hiç"]})]}),e.jsxs("div",{className:"integration-actions",children:[e.jsx("button",{className:"action-btn sync",onClick:()=>h(s.id),title:"Senkronize Et",children:e.jsx(V,{})}),e.jsx("button",{className:"action-btn config",onClick:()=>t(s),title:"Ayarlar",children:e.jsx(T,{})}),e.jsx("button",{className:"action-btn disconnect",onClick:()=>r(s.id),title:"Bağlantıyı Kes",children:e.jsx($,{})})]})]},s.id)})}),se=({integrations:n,icons:l,colors:i,getCategoryIcon:r,onConnect:h})=>{const t=[...new Set(n.map(s=>s.category))];return n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(y,{}),e.jsx("p",{children:"Tüm entegrasyonlar zaten bağlı"})]}):e.jsx("div",{className:"available-list",children:t.map(s=>e.jsxs("div",{className:"category-section",children:[e.jsxs("h3",{className:"category-title",children:[r(s),s==="development"&&"Geliştirme",s==="entertainment"&&"Eğlence",s==="streaming"&&"Yayın",s==="productivity"&&"Üretkenlik",s==="content"&&"İçerik",s==="social"&&"Sosyal"]}),e.jsx("div",{className:"integrations-grid",children:n.filter(c=>c.category===s).map(c=>{const a=l[c.id]||y,x=i[c.id]||"#666";return e.jsxs("div",{className:"integration-card available",children:[e.jsx("div",{className:"integration-icon",style:{background:x},children:e.jsx(a,{})}),e.jsxs("div",{className:"integration-details",children:[e.jsx("h4",{children:c.name}),e.jsx("p",{children:c.description}),e.jsx("ul",{className:"features",children:c.features?.slice(0,3).map((b,o)=>e.jsxs("li",{children:[e.jsx(C,{})," ",b]},o))})]}),e.jsxs("button",{className:"connect-btn",onClick:()=>h(c.id),children:[e.jsx(_,{})," Bağla"]})]},c.id)})})]},s))})},ae=({serverId:n,token:l,onClose:i,onCreated:r})=>{const[h,t]=u.useState(""),[s,c]=u.useState(""),[a,x]=u.useState([]);u.useEffect(()=>{fetch(`/api/servers/${n}/channels/`,{headers:{Authorization:`Bearer ${l}`}}).then(o=>o.json()).then(o=>x(o.channels||[])).catch(()=>{})},[]);const b=async()=>{if(!h||!s){m.warning("Tüm alanları doldurun");return}try{(await fetch(`/api/servers/${n}/webhooks/`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({name:h,channel_id:s})})).ok&&(m.success("Webhook oluşturuldu"),r())}catch{m.error("Webhook oluşturulamadı")}};return e.jsx("div",{className:"modal-overlay",onClick:o=>o.target.className==="modal-overlay"&&i(),children:e.jsxs("div",{className:"webhook-modal",children:[e.jsxs("h3",{children:[e.jsx(S,{})," Yeni Webhook Oluştur"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adı"}),e.jsx("input",{type:"text",value:h,onChange:o=>t(o.target.value),placeholder:"örn: GitHub Bot"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsxs("select",{value:s,onChange:o=>c(o.target.value),children:[e.jsx("option",{value:"",children:"Kanal seçin..."}),a.map(o=>e.jsxs("option",{value:o.id,children:["#",o.name]},o.id))]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:i,children:"İptal"}),e.jsx("button",{className:"create-btn",onClick:b,children:"Oluştur"})]})]})})},ne=({serverId:n,token:l})=>{const[i,r]=u.useState([]),[h,t]=u.useState(!1);u.useEffect(()=>{s()},[]);const s=async()=>{try{const a=await fetch(`/api/servers/${n}/webhooks/`,{headers:{Authorization:`Bearer ${l}`}});if(a.ok){const x=await a.json();r(x.webhooks||[])}}catch{}},c=async a=>{if(await B("Bu webhook'u silmek istediğinize emin misiniz?"))try{(await fetch(`/api/servers/${n}/webhooks/${a}/`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok&&(m.success("Webhook silindi"),s())}catch{m.error("Webhook silinemedi")}};return e.jsxs("div",{className:"webhooks-view",children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsx("p",{children:"Webhooks ile dış servislerden otomatik mesajlar alın"}),e.jsxs("button",{className:"create-webhook-btn",onClick:()=>t(!0),children:[e.jsx(S,{})," Yeni Webhook"]})]}),i.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(w,{}),e.jsx("p",{children:"Henüz webhook oluşturulmamış"})]}):e.jsx("div",{className:"webhooks-list",children:i.map(a=>e.jsxs("div",{className:"webhook-item",children:[e.jsx("div",{className:"webhook-avatar",children:a.avatar?e.jsx("img",{src:a.avatar,alt:""}):e.jsx(w,{})}),e.jsxs("div",{className:"webhook-info",children:[e.jsx("h4",{children:a.name}),e.jsxs("span",{className:"webhook-channel",children:["#",a.channel_name]}),e.jsxs("div",{className:"webhook-url",children:[e.jsxs("code",{children:[a.url.substring(0,40),"..."]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a.url),m.success("URL kopyalandı")},children:"Kopyala"})]})]}),e.jsx("div",{className:"webhook-actions",children:e.jsx("button",{className:"action-btn delete",onClick:()=>c(a.id),children:e.jsx(A,{})})})]},a.id))}),h&&e.jsx(ae,{serverId:n,token:l,onClose:()=>t(!1),onCreated:()=>{s(),t(!1)}})]})},te=({integration:n,serverId:l,token:i,onClose:r,onSave:h})=>{const[t,s]=u.useState({notifications_enabled:!0,notification_channel:"",auto_sync:!0,sync_interval:30}),c=async()=>{try{(await fetch(`/api/servers/${l}/integrations/${n.id}/configure/`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(m.success("Ayarlar kaydedildi"),h(),r())}catch{m.error("Ayarlar kaydedilemedi")}};return e.jsx("div",{className:"modal-overlay",onClick:a=>a.target.className==="modal-overlay"&&r(),children:e.jsxs("div",{className:"config-modal",children:[e.jsxs("h3",{children:[e.jsx(T,{})," ",n.name," Ayarları"]}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.notifications_enabled,onChange:a=>s({...t,notifications_enabled:a.target.checked})}),"Bildirimleri Etkinleştir"]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.auto_sync,onChange:a=>s({...t,auto_sync:a.target.checked})}),"Otomatik Senkronizasyon"]})}),t.auto_sync&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Senkronizasyon Aralığı (dakika)"}),e.jsx("input",{type:"number",value:t.sync_interval,onChange:a=>s({...t,sync_interval:parseInt(a.target.value)}),min:5,max:1440})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:r,children:"İptal"}),e.jsxs("button",{className:"save-btn",onClick:c,children:[e.jsx(C,{})," Kaydet"]})]})]})})},me=({serverId:n,onClose:l})=>{const{activeTab:i,setActiveTab:r,integrations:h,notConnected:t,loading:s,searchTerm:c,setSearchTerm:a,configModal:x,setConfigModal:b,token:o,handleConnect:f,handleDisconnect:p,handleSync:v,fetchIntegrations:N}=Q(n);return e.jsx("div",{className:"integration-hub-overlay",onClick:k=>k.target.className==="integration-hub-overlay"&&l(),children:e.jsxs("div",{className:"integration-hub-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(y,{})," Entegrasyon Merkezi"]}),e.jsx("button",{className:"close-btn",onClick:l,children:e.jsx(A,{})})]}),e.jsx("div",{className:"tabs-bar",children:e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${i==="connected"?"active":""}`,onClick:()=>r("connected"),children:[e.jsx(_,{})," Bağlı (",h.length,")"]}),e.jsxs("button",{className:`tab ${i==="available"?"active":""}`,onClick:()=>r("available"),children:[e.jsx(S,{})," Mevcut (",t.length,")"]}),e.jsxs("button",{className:`tab ${i==="webhooks"?"active":""}`,onClick:()=>r("webhooks"),children:[e.jsx(w,{})," Webhooks"]})]})}),i==="available"&&e.jsxs("div",{className:"search-bar",children:[e.jsx(X,{}),e.jsx("input",{type:"text",placeholder:"Entegrasyon ara...",value:c,onChange:k=>a(k.target.value)})]}),e.jsx("div",{className:"panel-content",children:s?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):e.jsxs(e.Fragment,{children:[i==="connected"&&e.jsx(ee,{integrations:h,icons:z,colors:F,onDisconnect:p,onSync:v,onConfigure:k=>b({show:!0,integration:k})}),i==="available"&&e.jsx(se,{integrations:t,icons:z,colors:F,getCategoryIcon:Z,onConnect:f}),i==="webhooks"&&e.jsx(ne,{serverId:n,token:o})]})}),x.show&&e.jsx(te,{integration:x.integration,serverId:n,token:o,onClose:()=>b({show:!1,integration:null}),onSave:N})]})})};export{me as default};
