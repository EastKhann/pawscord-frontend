var L=Object.defineProperty;var t=(c,p)=>L(c,"name",{value:p,configurable:!0});import{r as n,j as e}from"./react-core-Djgtqrmb.js";import{ay as b,a as R,t as Y,a5 as O,aC as H,C as M,d as P,bv as Q,cB as q,g as G,aD as I,cC as J,z as V}from"./icons-vendor-BW7dxHkX.js";import{y}from"./ui-vendor-IhB9Znpc.js";const ae=t(({serverId:c,serverName:p,onClose:S})=>{const[h,u]=n.useState([]),[j,_]=n.useState([]),[D,w]=n.useState(!0),[x,F]=n.useState(""),[d,o]=n.useState("all"),[v,z]=n.useState("newest"),[N,E]=n.useState(null),[m,g]=n.useState({total:0,active:0,expired:0,appealed:0}),B=localStorage.getItem("access_token");n.useEffect(()=>{C()},[c]),n.useEffect(()=>{T()},[h,x,d,v]);const C=t(async()=>{w(!0);try{const a=await fetch(`/api/servers/${c}/bans/`,{headers:{Authorization:`Bearer ${B}`}});if(a.ok){const s=await a.json();u(s.bans||[]),g(s.stats||f([]))}else u([]),g(f([]))}catch{u([]),g(f([]))}w(!1)},"fetchBanHistory"),f=t(a=>({total:a.length,active:a.filter(s=>s.status==="active").length,expired:a.filter(s=>s.status==="expired").length,appealed:a.filter(s=>s.status==="appealed"||s.appeal_status==="approved").length}),"calculateStats"),T=t(()=>{let a=[...h];if(x){const s=x.toLowerCase();a=a.filter(l=>l.user.username.toLowerCase().includes(s)||l.reason.toLowerCase().includes(s)||l.moderator.username.toLowerCase().includes(s))}d!=="all"&&(a=a.filter(s=>d==="appealed"?s.appeal_status==="approved"||s.status==="appealed":s.status===d)),a.sort((s,l)=>{const i=new Date(s.banned_at),r=new Date(l.banned_at);return v==="newest"?r-i:i-r}),_(a)},"applyFilters"),$=t(async a=>{try{const s=await fetch(`/api/servers/${c}/bans/${a.id}/revoke/`,{method:"POST",headers:{Authorization:`Bearer ${B}`}});y.success(`${a.user.username} yasaklaması kaldırıldı`),C()}catch{y.success(`${a.user.username} yasaklaması kaldırıldı`),u(h.map(l=>l.id===a.id?{...l,status:"expired",unbanned_at:new Date().toISOString()}:l))}},"handleUnban"),A=t(()=>{const a=[["Kullanıcı","Moderatör","Sebep","Durum","Tarih","Bitiş","İtiraz"].join(","),...j.map(r=>[r.user.username,r.moderator.username,`"${r.reason}"`,r.status,new Date(r.banned_at).toLocaleDateString("tr-TR"),r.expires_at?new Date(r.expires_at).toLocaleDateString("tr-TR"):"Süresiz",r.appeal_status||"Yok"].join(","))].join(`
`),s=new Blob([a],{type:"text/csv"}),l=URL.createObjectURL(s),i=document.createElement("a");i.href=l,i.download=`ban_history_${p}.csv`,i.click(),y.success("Ban geçmişi dışa aktarıldı")},"handleExport"),k=t(a=>new Date(a).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),"formatDate"),K=t((a,s)=>{if(s==="approved"||a==="appealed")return e.jsxs("span",{className:"status-badge appealed",children:[e.jsx(J,{})," İtiraz Kabul"]});switch(a){case"active":return e.jsxs("span",{className:"status-badge active",children:[e.jsx(b,{})," Aktif Ban"]});case"expired":return e.jsxs("span",{className:"status-badge expired",children:[e.jsx(V,{})," Süresi Doldu"]});default:return e.jsx("span",{className:"status-badge",children:a})}},"getStatusBadge"),U=t(a=>a?{pending:e.jsx("span",{className:"appeal-badge pending",children:"İtiraz Bekliyor"}),approved:e.jsx("span",{className:"appeal-badge approved",children:"İtiraz Kabul"}),denied:e.jsx("span",{className:"appeal-badge denied",children:"İtiraz Reddedildi"})}[a]:null,"getAppealBadge");return e.jsx("div",{className:"banhistory-overlay",onClick:t(a=>a.target.className==="banhistory-overlay"&&S(),"onClick"),children:e.jsxs("div",{className:"banhistory-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(b,{})," Ban Geçmişi"]}),e.jsx("span",{className:"server-name",children:p}),e.jsx("button",{className:"close-btn",onClick:S,children:e.jsx(R,{})})]}),e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",onClick:t(()=>o("all"),"onClick"),children:[e.jsx("span",{className:"stat-value",children:m.total}),e.jsx("span",{className:"stat-label",children:"Toplam"})]}),e.jsxs("div",{className:"stat-item active",onClick:t(()=>o("active"),"onClick"),children:[e.jsx("span",{className:"stat-value",children:m.active}),e.jsx("span",{className:"stat-label",children:"Aktif"})]}),e.jsxs("div",{className:"stat-item expired",onClick:t(()=>o("expired"),"onClick"),children:[e.jsx("span",{className:"stat-value",children:m.expired}),e.jsx("span",{className:"stat-label",children:"Süresi Dolmuş"})]}),e.jsxs("div",{className:"stat-item appealed",onClick:t(()=>o("appealed"),"onClick"),children:[e.jsx("span",{className:"stat-value",children:m.appealed}),e.jsx("span",{className:"stat-label",children:"İtiraz Kabul"})]})]}),e.jsxs("div",{className:"filters-bar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(Y,{}),e.jsx("input",{type:"text",placeholder:"Kullanıcı, sebep veya moderatör ara...",value:x,onChange:t(a=>F(a.target.value),"onChange")})]}),e.jsxs("select",{value:d,onChange:t(a=>o(a.target.value),"onChange"),children:[e.jsx("option",{value:"all",children:"Tüm Banlar"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"expired",children:"Süresi Dolmuş"}),e.jsx("option",{value:"appealed",children:"İtiraz Kabul"})]}),e.jsxs("select",{value:v,onChange:t(a=>z(a.target.value),"onChange"),children:[e.jsx("option",{value:"newest",children:"En Yeni"}),e.jsx("option",{value:"oldest",children:"En Eski"})]}),e.jsxs("button",{className:"export-btn",onClick:A,children:[e.jsx(O,{})," Dışa Aktar"]})]}),e.jsx("div",{className:"bans-list",children:D?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):j.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(H,{}),e.jsx("p",{children:"Ban kaydı bulunamadı"})]}):j.map(a=>e.jsxs("div",{className:`ban-card ${a.status}`,children:[e.jsxs("div",{className:"ban-main",onClick:t(()=>E(N===a.id?null:a.id),"onClick"),children:[e.jsxs("div",{className:"ban-user",children:[e.jsx("div",{className:"user-avatar",children:a.user.avatar?e.jsx("img",{src:a.user.avatar,alt:""}):e.jsx(M,{})}),e.jsxs("div",{className:"user-info",children:[e.jsx("span",{className:"username",children:a.user.username}),e.jsx("span",{className:"discriminator",children:a.user.discriminator})]})]}),e.jsxs("div",{className:"ban-reason",children:[e.jsx(P,{}),e.jsx("span",{children:a.reason})]}),e.jsxs("div",{className:"ban-meta",children:[K(a.status,a.appeal_status),U(a.appeal_status)]}),e.jsxs("div",{className:"ban-date",children:[e.jsx(Q,{}),e.jsx("span",{children:k(a.banned_at)})]}),e.jsx("button",{className:"expand-btn",children:N===a.id?e.jsx(q,{}):e.jsx(G,{})})]}),N===a.id&&e.jsxs("div",{className:"ban-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Moderatör:"}),e.jsx("span",{className:"value",children:a.moderator.username})]}),a.expires_at&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Bitiş Tarihi:"}),e.jsx("span",{className:"value",children:k(a.expires_at)})]}),a.unbanned_at&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Yasak Kaldırıldı:"}),e.jsx("span",{className:"value",children:k(a.unbanned_at)})]}),a.notes&&e.jsxs("div",{className:"detail-row notes",children:[e.jsx("span",{className:"label",children:"Notlar:"}),e.jsx("span",{className:"value",children:a.notes})]}),a.status==="active"&&e.jsx("div",{className:"detail-actions",children:e.jsxs("button",{className:"unban-btn",onClick:t(()=>$(a),"onClick"),children:[e.jsx(I,{})," Yasağı Kaldır"]})})]})]},a.id))})]})})},"BanHistoryPanel");export{ae as default};
