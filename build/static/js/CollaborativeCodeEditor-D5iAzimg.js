import{r,d as o,B as K,G as P,bU as I,aN as H,bu as V,bK as G}from"./react-core-DrOm_csO.js";import{t as y}from"./index-DmEhdEtw.js";const X=({roomId:E,userId:b,username:W,apiBaseUrl:m,fetchWithAuth:f,websocket:l,onClose:Y})=>{const[i,S]=r.useState(`// Start coding...
`),[d,x]=r.useState("javascript"),[v,u]=r.useState(""),[k,w]=r.useState([]),[R,C]=r.useState(!1),[j,h]=r.useState(!1),_=r.useRef(null),g=r.useRef(null),p=r.useRef(new Map);r.useEffect(()=>(L(),B(),z(),()=>{J()}),[]);const L=async()=>{try{setMonacoLoaded(!1),console.log("✅ [CodeEditor] Using textarea fallback (monaco-editor not installed)")}catch(e){console.error("❌ [CodeEditor] Editor init error:",e)}},B=()=>{l&&l.addEventListener("message",e=>{const t=JSON.parse(e.data);switch(t.type){case"code_update":D(t);break;case"cursor_update":N(t);break;case"collaborator_joined":O(t);break;case"collaborator_left":$(t);break}})},D=e=>{if(e.user_id===b)return;const t=window.monacoEditor;t&&t.setValue(e.code)},N=e=>{if(e.user_id===b)return;const t=window.monacoEditor,c=g.current;if(!t||!c)return;const a=p.current.get(e.user_id);a&&t.deltaDecorations(a,[]);const s=t.deltaDecorations([],[{range:new c.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);p.current.set(e.user_id,s)},O=e=>{w(t=>[...t,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}])},$=e=>{w(c=>c.filter(a=>a.id!==e.user_id));const t=p.current.get(e.user_id);t&&window.monacoEditor&&window.monacoEditor.deltaDecorations(t,[]),p.current.delete(e.user_id)},z=async()=>{try{const e=await f(`${m}/code-editor/load/?room_id=${E}`);if(e.ok){const t=await e.json();t.code&&(S(t.code),x(t.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(t.code),window.monacoEditor.setLanguage(t.language||"javascript")))}}catch(e){console.error("Failed to load code:",e)}},F=async()=>{C(!0);try{(await f(`${m}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:E,code:i,language:d})})).ok&&y.success("✅ Kod kaydedildi!")}catch(e){console.error("Save error:",e),y.error("❌ Kaydetme başarısız")}finally{C(!1)}},M=async()=>{h(!0),u("Çalıştırılıyor...");try{const e=await f(`${m}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i,language:d})});if(e.ok){const t=await e.json();u(t.output||"No output")}else{const t=await e.json();u(`Error: ${t.error||"Execution failed"}`)}}catch(e){u(`Error: ${e.message}`)}finally{h(!1)}},T=()=>{navigator.clipboard.writeText(i),y.success("✅ Kod kopyalandı!")},U=()=>{const t={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"}[d]||"txt",c=new Blob([i],{type:"text/plain"}),a=URL.createObjectURL(c),s=document.createElement("a");s.href=a,s.download=`code.${t}`,s.click(),URL.revokeObjectURL(a)},J=()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),l&&l.close()};return o.createElement("div",{style:n.container},o.createElement("div",{style:n.header},o.createElement("div",{style:n.headerLeft},o.createElement(K,{style:n.headerIcon}),o.createElement("h2",{style:n.title},"Code Editor"),o.createElement("select",{value:d,onChange:e=>{x(e.target.value),window.monacoEditor&&g.current&&g.current.editor.setModelLanguage(window.monacoEditor.getModel(),e.target.value)},style:n.languageSelect},o.createElement("option",{value:"javascript"},"JavaScript"),o.createElement("option",{value:"typescript"},"TypeScript"),o.createElement("option",{value:"python"},"Python"),o.createElement("option",{value:"java"},"Java"),o.createElement("option",{value:"cpp"},"C++"),o.createElement("option",{value:"html"},"HTML"),o.createElement("option",{value:"css"},"CSS"))),o.createElement("div",{style:n.headerRight},o.createElement("div",{style:n.collaborators},o.createElement(P,{style:{marginRight:"6px"}}),o.createElement("span",null,k.length+1)),o.createElement("button",{onClick:T,style:n.actionButton,title:"Kopyala"},o.createElement(I,null)),o.createElement("button",{onClick:U,style:n.actionButton,title:"İndir"},o.createElement(H,null)),o.createElement("button",{onClick:F,disabled:R,style:{...n.actionButton,...n.saveButton},title:"Kaydet"},o.createElement(V,null)),o.createElement("button",{onClick:M,disabled:j,style:{...n.actionButton,...n.runButton},title:"Çalıştır"},o.createElement(G,null)))),o.createElement("div",{style:n.editorContainer},o.createElement("div",{ref:_,style:n.editor})),v&&o.createElement("div",{style:n.outputPanel},o.createElement("div",{style:n.outputHeader},o.createElement("span",null,"Output")),o.createElement("pre",{style:n.outputContent},v)))},n={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}};export{X as default};
