import{r as o,j as t}from"./react-vendor-D4QjtNWS.js";import{aX as b}from"./vendor-Brv1On52.js";import"./state-vendor-T8XA44Ud.js";import"./perf-vendor-CmoV45_-.js";const P=({onCropComplete:v,onCancel:x,imageFile:m})=>{const[u,w]=o.useState(null),[y,f]=o.useState({unit:"%",width:50,aspect:1}),[d,j]=o.useState(null),h=o.useRef(null),p=o.useRef(null);o.useEffect(()=>{if(m){const e=new FileReader;e.addEventListener("load",()=>{w(e.result)}),e.readAsDataURL(m)}},[m]);const C=o.useCallback(e=>{h.current=e;const s=e.width,r=e.height,n=Math.min(s,r),l=(s-n)/2,c=(r-n)/2,a={unit:"px",width:n,height:n,x:l,y:c,aspect:1};f(a),j(a)},[]);o.useEffect(()=>{if(!d||!h.current||!p.current)return;const e=h.current,s=p.current,r=d,n=e.naturalWidth/e.width,l=e.naturalHeight/e.height,c=s.getContext("2d"),a=window.devicePixelRatio||1,i=180;s.width=i*a,s.height=i*a,c.setTransform(a,0,0,a,0,0),c.imageSmoothingQuality="high",c.drawImage(e,r.x*n,r.y*l,r.width*n,r.height*l,0,0,i,i)},[d]);const N=o.useCallback(async()=>{if(!d||!h.current||!p.current)return;const e=h.current,s=p.current,r=d,n=e.naturalWidth/e.width,l=e.naturalHeight/e.height,c=s.getContext("2d"),a=window.devicePixelRatio,i=512;return s.width=i*a,s.height=i*a,c.setTransform(a,0,0,a,0,0),c.imageSmoothingQuality="high",c.drawImage(e,r.x*n,r.y*l,r.width*n,r.height*l,0,0,i,i),new Promise(R=>{s.toBlob(g=>{if(!g){console.error("Canvas is empty");return}g.name="avatar.png",v(g),R()},"image/png",1)})},[d,v]);return t.jsx("div",{className:"avatar-cropper-modal",onClick:x,children:t.jsxs("div",{className:"avatar-cropper-content",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"avatar-cropper-header",children:[t.jsx("h2",{children:"üì∏ Profil Fotoƒürafƒ±nƒ± D√ºzenle"}),t.jsx("button",{className:"close-btn",onClick:x,children:"√ó"})]}),t.jsxs("div",{className:"avatar-cropper-body",children:[!u&&t.jsxs("div",{style:{padding:"40px",textAlign:"center",color:"#dcddde"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"‚è≥"}),t.jsx("p",{children:"Fotoƒüraf y√ºkleniyor..."}),!m&&t.jsx("p",{style:{color:"#f04747",marginTop:"8px"},children:"‚ö†Ô∏è Dosya bulunamadƒ±!"})]}),u&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"crop-container",children:t.jsx(b,{crop:y,onChange:e=>f(e),onComplete:e=>j(e),aspect:1,circularCrop:!1,keepSelection:!0,minWidth:100,minHeight:100,children:t.jsx("img",{ref:h,src:u,alt:"Crop",onLoad:e=>C(e.currentTarget),style:{maxWidth:"100%",maxHeight:"55vh",display:"block",objectFit:"contain"}})})}),t.jsxs("div",{className:"preview-section",children:[t.jsx("h3",{children:"√ñnizleme:"}),t.jsx("div",{className:"preview-container",children:t.jsx("canvas",{ref:p,style:{width:180,height:180,borderRadius:"50%",objectFit:"cover"}})}),t.jsx("p",{className:"preview-note",children:"‚ÑπÔ∏è Tam kare (1:1)"})]})]})]}),u&&t.jsxs("div",{className:"avatar-cropper-footer",children:[t.jsx("button",{className:"btn-secondary",onClick:x,children:"ƒ∞ptal"}),t.jsx("button",{className:"btn-primary",onClick:N,children:"‚úì Kaydet"})]})]})})};export{P as default};
