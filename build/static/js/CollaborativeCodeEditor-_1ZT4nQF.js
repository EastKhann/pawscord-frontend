var D=Object.defineProperty;var r=(d,u)=>D(d,"name",{value:u,configurable:!0});import{r as a,j as t}from"./react-core-Djgtqrmb.js";import{q as I,u as J,aV as M,a5 as P,aY as U,aN as K}from"./icons-vendor-BMXAt4pj.js";import{t as L}from"./index-D09YXCFH.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const H={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"},V=r(({roomId:d,userId:u,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:p})=>{const[g,w]=a.useState(`// Start coding...
`),[c,y]=a.useState("javascript"),[j,f]=a.useState(""),[S,h]=a.useState([]),[E,b]=a.useState(!1),[k,v]=a.useState(!1),i=a.useRef(null),R=a.useRef(null),C=a.useRef(new Map),N=r(e=>{e.user_id!==u&&window.monacoEditor&&window.monacoEditor.setValue(e.code)},"handleRemoteCodeUpdate"),B=r(e=>{if(e.user_id===u)return;const o=window.monacoEditor,l=R.current;if(!o||!l)return;const s=C.current.get(e.user_id);s&&o.deltaDecorations(s,[]);const F=o.deltaDecorations([],[{range:new l.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);C.current.set(e.user_id,F)},"handleRemoteCursorUpdate"),O=r(e=>h(o=>[...o,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}]),"handleCollaboratorJoined"),T=r(e=>{h(l=>l.filter(s=>s.id!==e.user_id));const o=C.current.get(e.user_id);o&&window.monacoEditor&&window.monacoEditor.deltaDecorations(o,[]),C.current.delete(e.user_id)},"handleCollaboratorLeft"),$=r(()=>{p&&p.addEventListener("message",e=>{const o=JSON.parse(e.data);o.type==="code_update"?N(o):o.type==="cursor_update"?B(o):o.type==="collaborator_joined"?O(o):o.type==="collaborator_left"&&T(o)})},"setupWebSocket"),z=r(async()=>{try{const e=await m(`${x}/code-editor/load/?room_id=${d}`);if(e.ok){const o=await e.json();o.code&&(w(o.code),y(o.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(o.code),window.monacoEditor.setLanguage(o.language||"javascript")))}}catch{}},"loadSavedCode");return a.useEffect(()=>($(),z(),()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),p&&p.close()}),[]),{code:g,language:c,output:j,collaborators:S,saving:E,running:k,editorRef:i,saveCode:r(async()=>{b(!0);try{(await m(`${x}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:d,code:g,language:c})})).ok&&L.success("✅ Kod kaydedildi!")}catch{L.error("❌ Kaydetme başarısız")}finally{b(!1)}},"saveCode"),runCode:r(async()=>{v(!0),f("Çalıştırılıyor...");try{const e=await m(`${x}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g,language:c})});if(e.ok){const o=await e.json();f(o.output||"No output")}else{const o=await e.json();f(`Error: ${o.error||"Execution failed"}`)}}catch(e){f(`Error: ${e.message}`)}finally{v(!1)}},"runCode"),copyCode:r(()=>{navigator.clipboard.writeText(g),L.success("✅ Kod kopyalandı!")},"copyCode"),downloadCode:r(()=>{const e=H[c]||"txt",o=new Blob([g],{type:"text/plain"}),l=URL.createObjectURL(o),s=document.createElement("a");s.href=l,s.download=`code.${e}`,s.click(),URL.revokeObjectURL(l)},"downloadCode"),changeLanguage:r(e=>{y(e),window.monacoEditor&&R.current&&R.current.editor.setModelLanguage(window.monacoEditor.getModel(),e)},"changeLanguage")}},"useCodeEditor"),n={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}},G=[{value:"javascript",label:"JavaScript"},{value:"typescript",label:"TypeScript"},{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"},{value:"html",label:"HTML"},{value:"css",label:"CSS"}],ce=r(({roomId:d,userId:u,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:p,onClose:g})=>{const{language:w,output:c,collaborators:y,saving:j,running:f,editorRef:S,saveCode:h,runCode:E,copyCode:b,downloadCode:k,changeLanguage:v}=V({roomId:d,userId:u,username:_,apiBaseUrl:x,fetchWithAuth:m,websocket:p});return t.jsxs("div",{style:n.container,children:[t.jsxs("div",{style:n.header,children:[t.jsxs("div",{style:n.headerLeft,children:[t.jsx(I,{style:n.headerIcon}),t.jsx("h2",{style:n.title,children:"Code Editor"}),t.jsx("select",{value:w,onChange:r(i=>v(i.target.value),"onChange"),style:n.languageSelect,children:G.map(i=>t.jsx("option",{value:i.value,children:i.label},i.value))})]}),t.jsxs("div",{style:n.headerRight,children:[t.jsxs("div",{style:n.collaborators,children:[t.jsx(J,{style:{marginRight:"6px"}}),t.jsx("span",{children:y.length+1})]}),t.jsx("button",{onClick:b,style:n.actionButton,title:"Kopyala",children:t.jsx(M,{})}),t.jsx("button",{onClick:k,style:n.actionButton,title:"İndir",children:t.jsx(P,{})}),t.jsx("button",{onClick:h,disabled:j,style:{...n.actionButton,...n.saveButton},title:"Kaydet",children:t.jsx(U,{})}),t.jsx("button",{onClick:E,disabled:f,style:{...n.actionButton,...n.runButton},title:"Çalıştır",children:t.jsx(K,{})})]})]}),t.jsx("div",{style:n.editorContainer,children:t.jsx("div",{ref:S,style:n.editor})}),c&&t.jsxs("div",{style:n.outputPanel,children:[t.jsx("div",{style:n.outputHeader,children:t.jsx("span",{children:"Output"})}),t.jsx("pre",{style:n.outputContent,children:c})]})]})},"CollaborativeCodeEditor");export{ce as default};
