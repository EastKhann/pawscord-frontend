import{r as o,n as e}from"./react-core-zXIKm1Jm.js";import{t as k}from"./index-Cuuw2ydP.js";import{Q as D}from"./media-vendor-BSOZ7IB3.js";import"./editor-vendor-DiU449Dh.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-DZdpmN99.js";import"./state-vendor-8NbFPBhQ.js";const O=({onClose:i,fetchWithAuth:f,apiBaseUrl:x})=>{const[r,d]=o.useState(1),[j,b]=o.useState(""),[u,y]=o.useState(""),[w,g]=o.useState([]),[n,N]=o.useState(""),[m,s]=o.useState(""),[h,c]=o.useState(!1);o.useEffect(()=>{r===1&&v()},[r]);const v=async()=>{c(!0);try{const a=await f(`${x}/auth/2fa/setup/`,{method:"POST"});if(a.ok){const t=await a.json();y(t.secret);const l=await D.toDataURL(t.otpauth_url);b(l)}else{const t=await a.json();s(t.error||"QR kod oluÅŸturulamadÄ±")}}catch(a){console.error("QR Code generation error:",a),s("BaÄŸlantÄ± hatasÄ±")}finally{c(!1)}},C=async()=>{if(n.length!==6){s("6 haneli kod giriniz");return}c(!0),s("");try{const a=await f(`${x}/auth/2fa/verify/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,secret:u})});if(a.ok){const t=await a.json();g(t.backup_codes),d(3)}else{const t=await a.json();s(t.error||"GeÃ§ersiz kod")}}catch(a){console.error("Verification error:",a),s("DoÄŸrulama hatasÄ±")}finally{c(!1)}},R=()=>{const a=w.join(`
`),t=new Blob([a],{type:"text/plain"}),l=URL.createObjectURL(t),p=document.createElement("a");p.href=l,p.download="pawscord-backup-codes.txt",p.click(),URL.revokeObjectURL(l)},S=()=>{k.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),i(),window.location.reload()};return e.jsx("div",{className:"twofa-modal-overlay",onClick:i,children:e.jsxs("div",{className:"twofa-modal-content",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"twofa-close-btn",onClick:i,children:"Ã—"}),e.jsx("h2",{children:"ðŸ” Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama"}),r===1&&e.jsxs("div",{className:"twofa-step",children:[e.jsx("h3",{children:"AdÄ±m 1: QR Kodu Tara"}),e.jsx("p",{children:"Google Authenticator veya Authy uygulamasÄ±yla bu QR kodu tarayÄ±n:"}),h?e.jsx("div",{className:"twofa-loading",children:"QR kod oluÅŸturuluyor..."}):j?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:j,alt:"QR Code",className:"twofa-qr-code"}),e.jsxs("div",{className:"twofa-secret",children:[e.jsx("p",{children:e.jsx("strong",{children:"Manuel Kod:"})}),e.jsx("code",{children:u}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(u),k.success("âœ… Kod kopyalandÄ±!")},className:"twofa-copy-btn",children:"ðŸ“‹ Kopyala"})]}),e.jsx("button",{onClick:()=>d(2),className:"twofa-next-btn",children:"Ä°leri â†’"})]}):e.jsx("div",{className:"twofa-error",children:m})]}),r===2&&e.jsxs("div",{className:"twofa-step",children:[e.jsx("h3",{children:"AdÄ±m 2: DoÄŸrulama Kodu"}),e.jsx("p",{children:"Authenticator uygulamasÄ±ndaki 6 haneli kodu girin:"}),e.jsx("input",{type:"text",maxLength:"6",value:n,onChange:a=>N(a.target.value.replace(/\D/g,"")),placeholder:"000000",className:"twofa-code-input",autoFocus:!0}),m&&e.jsx("div",{className:"twofa-error",children:m}),e.jsxs("div",{className:"twofa-buttons",children:[e.jsx("button",{onClick:()=>d(1),className:"twofa-back-btn",children:"â† Geri"}),e.jsx("button",{onClick:C,disabled:h||n.length!==6,className:"twofa-verify-btn",children:h?"DoÄŸrulanÄ±yor...":"DoÄŸrula"})]})]}),r===3&&e.jsxs("div",{className:"twofa-step",children:[e.jsx("h3",{children:"AdÄ±m 3: Yedek Kodlar"}),e.jsx("p",{className:"twofa-warning",children:"âš ï¸ Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n! Telefonunuza eriÅŸemediÄŸinizde bu kodlarÄ± kullanabilirsiniz."}),e.jsx("div",{className:"twofa-backup-codes",children:w.map((a,t)=>e.jsx("div",{className:"twofa-backup-code",children:a},t))}),e.jsxs("div",{className:"twofa-buttons",children:[e.jsx("button",{onClick:R,className:"twofa-download-btn",children:"ðŸ’¾ Ä°ndir"}),e.jsx("button",{onClick:S,className:"twofa-complete-btn",children:"âœ… Tamamla"})]})]})]})})};export{O as default};
