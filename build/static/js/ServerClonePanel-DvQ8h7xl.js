import{r as c,j as s}from"./react-core-D6cE4lil.js";import{aV as S,y as R,a as U,v as V,bs as w,a9 as l,aF as k,a1 as y,az as F,n as $,u as _,G,d as H}from"./icons-vendor-fClA8qVL.js";import{g as b,t as x}from"./index-B3eDbSm-.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const Z=({serverId:d,serverName:m,onClose:h,onClone:g})=>{const[P,v]=c.useState(!0),[E,T]=c.useState(!1),[n,j]=c.useState(null),[i,p]=c.useState(""),[a,A]=c.useState({channels:!0,roles:!0,emojis:!0,settings:!0,permissions:!0,categories:!0}),[N,u]=c.useState(0),[O,f]=c.useState(""),C=localStorage.getItem("access_token");c.useEffect(()=>{B()},[d]);const B=async()=>{v(!0);try{const e=await fetch(`${b()}/api/servers/${d}/clone-data/`,{headers:{Authorization:`Bearer ${C}`}});if(e.ok){const r=await e.json();j(r),p(`${r.name||m} (Copy)`)}else j({id:d,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),p(`${m} (Copy)`)}catch{j({id:d,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),p(`${m} (Copy)`)}v(!1)},t=e=>{A(r=>({...r,[e]:!r[e]}))},z=async()=>{if(i.trim()){T(!0),u(0),f("Starting clone process...");try{const e=await fetch(`${b()}/api/servers/${d}/clone/`,{method:"POST",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"},body:JSON.stringify({name:i,options:a})}),r=[{progress:20,status:"Creating server..."},{progress:40,status:"Setting up channels..."},{progress:60,status:"Configuring roles..."},{progress:80,status:"Applying settings..."},{progress:100,status:"Complete!"}];for(const o of r)await new Promise(L=>setTimeout(L,300)),u(o.progress),f(o.status);if(e.ok){const o=await e.json();x.success(`Server "${i}" created successfully!`),g&&g({name:i,...a,newServerId:o.server_id})}else{const o=await e.json();x.error(o.error||"Failed to clone server")}}catch{x.error("Failed to clone server")}h()}},D=()=>Object.values(a).filter(Boolean).length;return P?s.jsx("div",{className:"serverclone-overlay",onClick:h,children:s.jsx("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation(),children:s.jsx("div",{className:"loading",children:"Loading server data..."})})}):s.jsx("div",{className:"serverclone-overlay",onClick:h,children:s.jsxs("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(S,{})," Clone Server"]}),s.jsxs("span",{className:"source-server",children:[s.jsx(R,{})," ",n?.name]})]}),s.jsx("button",{className:"close-btn",onClick:h,children:s.jsx(U,{})})]}),E?s.jsxs("div",{className:"cloning-progress",children:[s.jsx("div",{className:"progress-icon",children:s.jsx(V,{className:"spinning"})}),s.jsx("h3",{children:"Cloning Server..."}),s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),s.jsx("span",{className:"progress-status",children:O}),s.jsxs("span",{className:"progress-percent",children:[N,"%"]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"content",children:[s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"New Server Name"}),s.jsx("input",{type:"text",value:i,onChange:e=>p(e.target.value),placeholder:"Enter server name",maxLength:100})]}),s.jsxs("div",{className:"section",children:[s.jsxs("h3",{children:["What to Clone (",D(),"/6)"]}),s.jsxs("div",{className:"options-grid",children:[s.jsxs("div",{className:`option-card ${a.categories?"selected":""}`,onClick:()=>t("categories"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(w,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Categories"}),s.jsxs("span",{className:"option-count",children:[n?.categories?.length||0," categories"]})]}),a.categories&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.channels?"selected":""}`,onClick:()=>t("channels"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(k,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Channels"}),s.jsxs("span",{className:"option-count",children:[n?.channels?.length||0," channels"]})]}),a.channels&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.roles?"selected":""}`,onClick:()=>t("roles"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(y,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Roles"}),s.jsxs("span",{className:"option-count",children:[n?.roles?.length||0," roles"]})]}),a.roles&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.permissions?"selected":""}`,onClick:()=>t("permissions"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(F,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Permissions"}),s.jsx("span",{className:"option-count",children:"Channel overrides"})]}),a.permissions&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.emojis?"selected":""}`,onClick:()=>t("emojis"),children:[s.jsx("div",{className:"option-icon",children:s.jsx($,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Emojis"}),s.jsxs("span",{className:"option-count",children:[n?.emojis?.length||0," emojis"]})]}),a.emojis&&s.jsx(l,{className:"check"})]}),s.jsxs("div",{className:`option-card ${a.settings?"selected":""}`,onClick:()=>t("settings"),children:[s.jsx("div",{className:"option-icon",children:s.jsx(F,{})}),s.jsxs("div",{className:"option-info",children:[s.jsx("span",{className:"option-name",children:"Settings"}),s.jsx("span",{className:"option-count",children:"Server config"})]}),a.settings&&s.jsx(l,{className:"check"})]})]})]}),s.jsxs("div",{className:"section",children:[s.jsx("h3",{children:"Preview"}),s.jsxs("div",{className:"preview-card",children:[s.jsxs("div",{className:"preview-header",children:[s.jsx("div",{className:"preview-icon",children:i.charAt(0).toUpperCase()}),s.jsxs("div",{className:"preview-info",children:[s.jsx("span",{className:"preview-name",children:i||"New Server"}),s.jsxs("span",{className:"preview-meta",children:[s.jsx(_,{})," 1 member"]})]})]}),s.jsxs("div",{className:"preview-items",children:[a.categories&&s.jsxs("span",{className:"preview-item",children:[s.jsx(w,{})," ",n?.categories?.length," Categories"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(k,{})," ",n?.channels?.filter(e=>e.type==="text").length," Text"]}),a.channels&&s.jsxs("span",{className:"preview-item",children:[s.jsx(G,{})," ",n?.channels?.filter(e=>e.type==="voice").length," Voice"]}),a.roles&&s.jsxs("span",{className:"preview-item",children:[s.jsx(y,{})," ",n?.roles?.length," Roles"]}),a.emojis&&s.jsxs("span",{className:"preview-item",children:[s.jsx($,{})," ",n?.emojis?.length," Emojis"]})]})]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(H,{}),s.jsxs("div",{children:[s.jsx("strong",{children:"Note:"})," Members, messages, and message history will not be cloned. Only server structure and settings will be copied."]})]})]}),s.jsxs("div",{className:"panel-footer",children:[s.jsx("button",{className:"cancel-btn",onClick:h,children:"Cancel"}),s.jsxs("button",{className:"clone-btn",onClick:z,disabled:!i.trim(),children:[s.jsx(S,{})," Clone Server"]})]})]})]})})};export{Z as default};
