import{r as c,n as e}from"./react-core-zXIKm1Jm.js";import{D as S,a as k,aJ as w,s as P}from"./icons-vendor-BBdoVeJd.js";import{t as l}from"./index-BG_AnZTm.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const I=({fetchWithAuth:s,apiBaseUrl:r,onClose:u,serverId:x})=>{const[p,b]=c.useState([]),[h,f]=c.useState(!1),[n,y]=c.useState({content_type:"messages",retention_days:30,enabled:!0}),g=[{value:"messages",label:"Messages"},{value:"media",label:"Media Files"},{value:"voice_recordings",label:"Voice Recordings"},{value:"audit_logs",label:"Audit Logs"},{value:"deleted_messages",label:"Deleted Messages"}],m=[{days:7,label:"7 Days"},{days:30,label:"30 Days"},{days:90,label:"90 Days"},{days:180,label:"6 Months"},{days:365,label:"1 Year"},{days:730,label:"2 Years"},{days:-1,label:"Forever"}];c.useEffect(()=>{a()},[]);const a=async()=>{f(!0);try{const i=await(await s(`${r}/servers/${x}/retention/`)).json();b(i.policies||[])}catch{l.error("Failed to load retention policies")}finally{f(!1)}},v=async()=>{try{await s(`${r}/retention/policies/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,server_id:x})}),l.success("Retention policy created"),y({content_type:"messages",retention_days:30,enabled:!0}),a()}catch{l.error("Failed to create policy")}},j=async(o,i)=>{try{await s(`${r}/retention/policies/${o}/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:i})}),l.success(i?"Policy enabled":"Policy disabled"),a()}catch{l.error("Failed to toggle policy")}},C=async o=>{if(confirm("Delete this retention policy?"))try{await s(`${r}/retention/policies/${o}/delete/`,{method:"DELETE"}),l.success("Policy deleted"),a()}catch{l.error("Failed to delete policy")}};return e.jsx("div",{style:t.overlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(S,{style:{marginRight:"10px",color:"#5865f2"}}),e.jsx("h2",{style:t.title,children:"Data Retention Policies"})]}),e.jsx("button",{onClick:u,style:t.closeButton,children:e.jsx(k,{})})]}),e.jsxs("div",{style:t.content,children:[e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Create New Policy"}),e.jsxs("div",{style:t.form,children:[e.jsxs("div",{style:t.formRow,children:[e.jsx("label",{style:t.label,children:"Content Type"}),e.jsx("select",{value:n.content_type,onChange:o=>y({...n,content_type:o.target.value}),style:t.select,children:g.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{style:t.formRow,children:[e.jsx("label",{style:t.label,children:"Retention Period"}),e.jsx("div",{style:t.presetButtons,children:m.map(o=>e.jsx("button",{onClick:()=>y({...n,retention_days:o.days}),style:{...t.presetButton,...n.retention_days===o.days&&t.presetButtonActive},children:o.label},o.days))})]}),e.jsxs("button",{onClick:v,style:t.saveButton,children:[e.jsx(w,{style:{marginRight:"8px"}}),"Create Policy"]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsxs("h3",{style:t.sectionTitle,children:["Active Policies (",p.length,")"]}),h?e.jsx("div",{style:t.loading,children:"Loading..."}):p.length===0?e.jsx("div",{style:t.empty,children:"No retention policies configured"}):e.jsx("div",{style:t.policiesList,children:p.map((o,i)=>e.jsxs("div",{style:t.policyCard,children:[e.jsxs("div",{style:t.policyInfo,children:[e.jsx("div",{style:t.policyType,children:g.find(d=>d.value===o.content_type)?.label||o.content_type}),e.jsx("div",{style:t.policyRetention,children:o.retention_days===-1?"Forever":`${o.retention_days} days`}),e.jsxs("div",{style:t.policyMeta,children:["Last run: ",o.last_run?new Date(o.last_run).toLocaleString():"Never"]}),o.items_deleted>0&&e.jsxs("div",{style:t.policyMeta,children:["Items deleted: ",o.items_deleted.toLocaleString()]})]}),e.jsxs("div",{style:t.policyActions,children:[e.jsxs("label",{style:t.toggleSwitch,children:[e.jsx("input",{type:"checkbox",checked:o.enabled,onChange:d=>j(o.id,d.target.checked)}),e.jsx("span",{style:t.toggleSlider})]}),e.jsx("button",{onClick:()=>C(o.id),style:t.deleteButton,title:"Delete Policy",children:e.jsx(P,{})})]})]},i))})]})]})]})})},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},section:{marginBottom:"30px"},sectionTitle:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"16px"},form:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px"},formRow:{marginBottom:"20px"},label:{display:"block",fontSize:"14px",fontWeight:"600",color:"#dcddde",marginBottom:"8px"},select:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},presetButtons:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"8px"},presetButton:{padding:"8px 12px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#dcddde",cursor:"pointer",fontSize:"13px"},presetButtonActive:{backgroundColor:"#5865f2",borderColor:"#5865f2",color:"#ffffff"},saveButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center"},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},policiesList:{display:"flex",flexDirection:"column",gap:"12px"},policyCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},policyInfo:{flex:1},policyType:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},policyRetention:{fontSize:"14px",color:"#5865f2",marginBottom:"8px"},policyMeta:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},policyActions:{display:"flex",gap:"12px",alignItems:"center"},toggleSwitch:{position:"relative",display:"inline-block",width:"44px",height:"24px"},toggleSlider:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:"#2c2f33",transition:"0.3s",borderRadius:"24px"},deleteButton:{background:"none",border:"none",color:"#f04747",cursor:"pointer",fontSize:"16px",padding:"8px"}};export{I as default};
