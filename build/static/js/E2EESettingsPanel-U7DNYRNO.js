var W=Object.defineProperty;var r=(d,i)=>W(d,"name",{value:i,configurable:!0});import{a as q,_ as Q}from"./media-vendor-CxFPycob.js";import{r as n,j as e}from"./react-core-Djgtqrmb.js";import{c as J,t as l,e as T}from"./index-BRQzOq3v.js";import{a1 as H,a as A,cp as X,a9 as _,h as N,d as F,w as Z,z as U,c as M,f as ee}from"./icons-vendor-BW7dxHkX.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const te=r(({username:d,targetUser:i,apiBaseUrl:g,fetchWithAuth:b,onClose:m})=>{const{overlayProps:y,dialogProps:h}=J({onClose:m,label:"Safety Number"}),[c,j]=n.useState(null),[f,u]=n.useState(!1),[C,E]=n.useState(!1),[w,S]=n.useState(!0),[I,R]=n.useState(!1);n.useEffect(()=>{B()},[i]);const B=r(async()=>{try{const s=await(await b(`${g}/e2ee/safety-number/${i}/`)).json();j(s.safetyNumber),u(s.verified),E(s.verifiedByMe),S(!1)}catch{S(!1)}},"fetchSafetyNumber"),K=r(async()=>{try{const s=await(await b(`${g}/e2ee/verify-safety-number/${i}/`,{method:"POST"})).json();E(!0),u(s.bothVerified),l.success(`âœ… Safety number doÄŸrulandÄ±!${s.bothVerified?`

Her iki taraf da doÄŸruladÄ±! ðŸŽ‰`:""}`)}catch{l.error("âŒ DoÄŸrulama baÅŸarÄ±sÄ±z!")}},"handleVerify");return w?e.jsx("div",{style:t.overlay,...y,children:e.jsx("div",{style:t.modal,...h,children:e.jsx("p",{style:t.loading,children:"YÃ¼kleniyor..."})})}):e.jsx("div",{style:t.overlay,...y,children:e.jsxs("div",{style:t.modal,...h,children:[e.jsxs("div",{style:t.header,children:[e.jsx(H,{size:32,color:f?"#43b581":"#faa61a"}),e.jsx("h2",{style:t.title,children:"Safety Number"}),e.jsx("button",{onClick:m,style:t.closeButton,children:e.jsx(A,{})})]}),e.jsx("div",{style:t.user,children:i}),I?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.qrContainer,children:e.jsx(q,{value:c||"",size:200})}),e.jsx("button",{onClick:r(()=>R(!1),"onClick"),style:t.qrButton,children:"NumarayÄ± GÃ¶ster"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.numberContainer,children:c?.split(" ").map((p,s)=>e.jsx("div",{style:t.numberGroup,children:p},s))}),e.jsxs("button",{onClick:r(()=>R(!0),"onClick"),style:t.qrButton,children:[e.jsx(X,{})," QR Kodu GÃ¶ster"]})]}),e.jsx("div",{style:t.statusContainer,children:f?e.jsxs("div",{style:t.statusVerified,children:[e.jsx(_,{size:20}),e.jsx("span",{children:"Her iki taraf da doÄŸruladÄ±! âœ…"})]}):C?e.jsxs("div",{style:t.statusPartial,children:[e.jsx(_,{size:20}),e.jsxs("span",{children:["Siz doÄŸruladÄ±nÄ±z. ",i," henÃ¼z doÄŸrulamadÄ±."]})]}):e.jsxs("div",{style:t.statusUnverified,children:[e.jsx(A,{size:20}),e.jsx("span",{children:"HenÃ¼z doÄŸrulanmadÄ±"})]})}),e.jsxs("div",{style:t.info,children:[e.jsx("h3",{children:"Safety Number Nedir?"}),e.jsxs("p",{children:["Safety number, sizin ve ",i,"'in ÅŸifreleme anahtarlarÄ±nÄ±n parmak izidir (fingerprint). Bu numarayÄ± karÅŸÄ±laÅŸtÄ±rarak identity key'lerini doÄŸrulayabilirsiniz."]}),e.jsx("h3",{children:"NasÄ±l DoÄŸrulanÄ±r?"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[i," ile yÃ¼z yÃ¼ze gÃ¶rÃ¼ÅŸÃ¼n veya gÃ¼venilir bir kanal kullanÄ±n"]}),e.jsx("li",{children:"Her ikiniz de safety number'Ä± aÃ§Ä±n"}),e.jsx("li",{children:"NumaralarÄ± karÅŸÄ±laÅŸtÄ±rÄ±n (aynÄ± olmalÄ±!)"}),e.jsx("li",{children:'EÅŸleÅŸiyorsa "DoÄŸrula" butonuna basÄ±n'})]})]}),!C&&e.jsxs("button",{onClick:K,style:t.verifyButton,children:[e.jsx(_,{})," Bu NumarayÄ± DoÄŸrula"]})]})})},"SafetyNumberModal"),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e5},modal:{backgroundColor:"#2b2d31",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",position:"relative"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",flex:1},closeButton:{backgroundColor:"transparent",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"4px",fontSize:"20px"},user:{color:"#5865f2",fontSize:"18px",fontWeight:"500",marginBottom:"24px",textAlign:"center"},numberContainer:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},numberGroup:{backgroundColor:"#1e1f22",color:"#fff",padding:"12px",borderRadius:"4px",textAlign:"center",fontSize:"18px",fontFamily:"monospace",letterSpacing:"2px"},qrContainer:{display:"flex",justifyContent:"center",marginBottom:"24px",padding:"16px",backgroundColor:"#fff",borderRadius:"8px"},qrButton:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"4px",padding:"10px 16px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto 24px"},statusContainer:{marginBottom:"24px"},statusVerified:{backgroundColor:"#43b581",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusPartial:{backgroundColor:"#faa61a",color:"#000",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusUnverified:{backgroundColor:"#ed4245",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},info:{backgroundColor:"#1e1f22",padding:"16px",borderRadius:"8px",marginBottom:"24px",color:"#b9bbbe",fontSize:"14px"},verifyButton:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"4px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},loading:{color:"#b9bbbe",textAlign:"center",padding:"32px"}},xe=r(({username:d,apiBaseUrl:i,fetchWithAuth:g})=>{const[b,m]=n.useState(!1),[y,h]=n.useState(null),[c,j]=n.useState(null),[f,u]=n.useState(!1),[C,E]=n.useState({encryptedMessagesCount:0,trustedContacts:0,lastKeyRotation:null}),[w,S]=n.useState(!1),[I,R]=n.useState(null);n.useEffect(()=>{B()},[]);const B=r(()=>{const o=localStorage.getItem("e2ee_enabled")==="true",k=localStorage.getItem("e2ee_setup_date"),v=localStorage.getItem("e2ee_last_rotation");m(o),h(k?new Date(k):null),j(v?new Date(v):null)},"loadE2EEStatus"),K=r(async()=>{if(await T(`ðŸ”‘ AnahtarlarÄ± yenilemek istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ Yeni kimlik anahtarlarÄ± oluÅŸturur
â€¢ Eski ÅŸifreli mesajlar okunamaz hale gelir
â€¢ TÃ¼m kiÅŸilerle yeniden gÃ¼venlik doÄŸrulamasÄ± gerekir`)){u(!0);try{const{generateIdentityKeyPair:o,generateSignedPreKeyPair:k,generateOneTimePreKeys:v,storePrivateKeys:$}=await Q(async()=>{const{generateIdentityKeyPair:x,generateSignedPreKeyPair:Y,generateOneTimePreKeys:G,storePrivateKeys:O}=await import("./e2ee-BrsGVOed.js");return{generateIdentityKeyPair:x,generateSignedPreKeyPair:Y,generateOneTimePreKeys:G,storePrivateKeys:O}},[]);l.info("ðŸ” Yeni anahtarlar oluÅŸturuluyor...");const P=await o(),z=await k(Date.now(),P.privateKey),L=await v(100);if(await $(d,P.privateKey,z.privateKey),l.info("â˜ï¸ Sunucuya yÃ¼kleniyor..."),(await g(`${i}/e2ee/rotate-keys/`,{method:"POST",body:JSON.stringify({identityPublicKey:P.publicKey,signedPreKeyId:z.keyId,signedPreKeyPublic:z.publicKey,signedPreKeySignature:z.signature,oneTimePreKeys:L.map(x=>({keyId:x.keyId,publicKey:x.publicKey}))})})).ok){const x=new Date().toISOString();localStorage.setItem("e2ee_last_rotation",x),j(new Date(x)),l.success("âœ… Anahtarlar baÅŸarÄ±yla yenilendi!")}else throw new Error("Key rotation failed")}catch{l.error("âŒ Anahtar yenileme baÅŸarÄ±sÄ±z!")}finally{u(!1)}}},"handleRotateKeys"),p=r(async()=>{if(await T(`âš ï¸ E2EE'yi devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ TÃ¼m ÅŸifreli mesajlarÄ±nÄ±zÄ± siler
â€¢ AnahtarlarÄ±nÄ±zÄ± kaldÄ±rÄ±r
â€¢ Geri alÄ±namaz!`)){u(!0);try{localStorage.removeItem("e2ee_enabled"),localStorage.removeItem("e2ee_setup_date"),localStorage.removeItem("e2ee_last_rotation"),localStorage.removeItem(`e2ee_identity_private_${d}`),localStorage.removeItem(`e2ee_signed_pre_key_private_${d}`),m(!1),l.success("âœ… E2EE devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±")}catch{l.error("âŒ Ä°ÅŸlem baÅŸarÄ±sÄ±z!")}finally{u(!1)}}},"handleDisableE2EE"),s=r(o=>o?o.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"HiÃ§","formatDate"),D=r(()=>c?Math.floor((new Date-c)/(1e3*60*60*24)):y?Math.floor((new Date-y)/(1e3*60*60*24)):null,"getDaysSinceRotation")(),V=D&&D>90;return b?e.jsxs("div",{style:a.container,children:[e.jsxs("div",{style:a.header,children:[e.jsx(N,{size:24}),e.jsx("h3",{style:a.title,children:"E2EE AyarlarÄ±"})]}),e.jsxs("div",{style:a.statusCard,children:[e.jsxs("div",{style:a.statusHeader,children:[e.jsx(Z,{size:32,color:"#43b581"}),e.jsx("span",{style:a.statusText,children:"E2EE Aktif"})]}),e.jsxs("div",{style:a.statusInfo,children:[e.jsxs("div",{style:a.infoRow,children:[e.jsx(U,{}),e.jsxs("span",{children:["Kurulum: ",s(y)]})]}),c&&e.jsxs("div",{style:a.infoRow,children:[e.jsx(M,{}),e.jsxs("span",{children:["Son Yenileme: ",s(c)]})]})]})]}),V&&e.jsxs("div",{style:a.warningCard,children:[e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Anahtar Yenileme Ã–nerilir"}),e.jsxs("p",{children:["Son anahtar yenilemeden ",D," gÃ¼n geÃ§ti. GÃ¼venlik iÃ§in anahtarlarÄ±nÄ±zÄ± yenileyin."]})]})]}),e.jsxs("div",{style:a.actions,children:[e.jsxs("button",{onClick:K,disabled:f,style:a.rotateButton,children:[e.jsx(M,{}),f?"Yenileniyor...":"AnahtarlarÄ± Yenile"]}),e.jsxs("button",{onClick:p,disabled:f,style:a.disableButton,children:[e.jsx(ee,{}),"E2EE\\'yi Devre DÄ±ÅŸÄ± BÄ±rak"]})]}),e.jsxs("div",{style:a.infoSection,children:[e.jsxs("h4",{style:a.infoTitle,children:[e.jsx(H,{}),"E2EE HakkÄ±nda"]}),e.jsxs("ul",{style:a.infoList,children:[e.jsx("li",{children:"âœ… MesajlarÄ±nÄ±z uÃ§tan uca ÅŸifrelenir"}),e.jsx("li",{children:"âœ… Sadece siz ve karÅŸÄ±nÄ±zdaki kiÅŸi okuyabilir"}),e.jsx("li",{children:"âœ… Sunucu bile mesajlarÄ± gÃ¶remez"}),e.jsx("li",{children:"âš ï¸ AnahtarlarÄ±nÄ±zÄ± kaybederseniz mesajlar okunamaz"}),e.jsx("li",{children:"ðŸ”‘ 90 gÃ¼nde bir anahtar yenileme Ã¶nerilir"})]})]}),w&&e.jsx(te,{username:d,targetUser:I,apiBaseUrl:i,fetchWithAuth:g,onClose:r(()=>S(!1),"onClose")})]}):e.jsxs("div",{style:a.container,children:[e.jsxs("div",{style:a.header,children:[e.jsx(N,{size:24}),e.jsx("h3",{style:a.title,children:"End-to-End Encryption"})]}),e.jsxs("div",{style:a.disabledState,children:[e.jsx(F,{size:48,color:"#faa61a"}),e.jsx("h4",{children:"E2EE Devre DÄ±ÅŸÄ±"}),e.jsx("p",{children:"Åžu anda E2EE kullanmÄ±yorsunuz. MesajlarÄ±nÄ±zÄ± ÅŸifrelemek iÃ§in ayarlardan etkinleÅŸtirin."})]})]})},"E2EESettingsPanel"),a={container:{padding:"20px",backgroundColor:"#2f3136",borderRadius:"8px",color:"#dcddde"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",paddingBottom:"16px",borderBottom:"2px solid #40444b"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},statusCard:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px",marginBottom:"16px",border:"2px solid #43b581"},statusHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},statusText:{fontSize:"18px",fontWeight:"bold",color:"#43b581"},statusInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#b9bbbe"},warningCard:{backgroundColor:"#faa61a20",border:"2px solid #faa61a",borderRadius:"8px",padding:"16px",marginBottom:"16px",display:"flex",gap:"12px",alignItems:"flex-start",color:"#faa61a"},actions:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},rotateButton:{padding:"12px 20px",backgroundColor:"#5865f2",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disableButton:{padding:"12px 20px",backgroundColor:"#ed4245",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disabledState:{textAlign:"center",padding:"40px 20px",color:"#b9bbbe"},infoSection:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px"},infoTitle:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"16px"},infoList:{margin:0,paddingLeft:"20px",color:"#b9bbbe",fontSize:"14px",lineHeight:"1.8"}};export{xe as default};
