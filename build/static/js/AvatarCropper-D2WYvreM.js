import{r as i,d as t,bn as R}from"./react-core-DMT_QkRe.js";const S=({onCropComplete:E,onCancel:g,imageFile:h})=>{const[u,x]=i.useState(null),[y,f]=i.useState({unit:"%",width:50,aspect:1}),[m,w]=i.useState(null),d=i.useRef(null),p=i.useRef(null);i.useEffect(()=>{if(h){const e=new FileReader;e.addEventListener("load",()=>{x(e.result)}),e.readAsDataURL(h)}},[h]);const C=i.useCallback(e=>{d.current=e;const r=e.width,a=e.height,c=Math.min(r,a),l=(r-c)/2,o=(a-c)/2,n={unit:"px",width:c,height:c,x:l,y:o,aspect:1};f(n),w(n)},[]);i.useEffect(()=>{if(!m||!d.current||!p.current)return;const e=d.current,r=p.current,a=m,c=e.naturalWidth/e.width,l=e.naturalHeight/e.height,o=r.getContext("2d"),n=window.devicePixelRatio||1,s=180;r.width=s*n,r.height=s*n,o.setTransform(n,0,0,n,0,0),o.imageSmoothingQuality="high",o.drawImage(e,a.x*c,a.y*l,a.width*c,a.height*l,0,0,s,s)},[m]);const b=i.useCallback(async()=>{if(!m||!d.current||!p.current)return;const e=d.current,r=p.current,a=m,c=e.naturalWidth/e.width,l=e.naturalHeight/e.height,o=r.getContext("2d"),n=window.devicePixelRatio,s=512;return r.width=s*n,r.height=s*n,o.setTransform(n,0,0,n,0,0),o.imageSmoothingQuality="high",o.drawImage(e,a.x*c,a.y*l,a.width*c,a.height*l,0,0,s,s),new Promise(N=>{r.toBlob(v=>{if(!v){console.error("Canvas is empty");return}v.name="avatar.png",E(v),N()},"image/png",1)})},[m,E]);return t.createElement("div",{className:"avatar-cropper-modal",onClick:g},t.createElement("div",{className:"avatar-cropper-content",onClick:e=>e.stopPropagation()},t.createElement("div",{className:"avatar-cropper-header"},t.createElement("h2",null,"üì∏ Profil Fotoƒürafƒ±nƒ± D√ºzenle"),t.createElement("button",{className:"close-btn",onClick:g},"√ó")),t.createElement("div",{className:"avatar-cropper-body"},!u&&t.createElement("div",{style:{padding:"40px",textAlign:"center",color:"#dcddde"}},t.createElement("div",{style:{fontSize:"48px",marginBottom:"16px"}},"‚è≥"),t.createElement("p",null,"Fotoƒüraf y√ºkleniyor..."),!h&&t.createElement("p",{style:{color:"#f04747",marginTop:"8px"}},"‚ö†Ô∏è Dosya bulunamadƒ±!")),u&&t.createElement(t.Fragment,null,t.createElement("div",{className:"crop-container"},t.createElement(R,{crop:y,onChange:e=>f(e),onComplete:e=>w(e),aspect:1,circularCrop:!1,keepSelection:!0,minWidth:100,minHeight:100},t.createElement("img",{ref:d,src:u,alt:"Crop",onLoad:e=>C(e.currentTarget),style:{maxWidth:"100%",maxHeight:"55vh",display:"block",objectFit:"contain"}}))),t.createElement("div",{className:"preview-section"},t.createElement("h3",null,"√ñnizleme:"),t.createElement("div",{className:"preview-container"},t.createElement("canvas",{ref:p,style:{width:180,height:180,borderRadius:"50%",objectFit:"cover"}})),t.createElement("p",{className:"preview-note"},"‚ÑπÔ∏è Tam kare (1:1)")))),u&&t.createElement("div",{className:"avatar-cropper-footer"},t.createElement("button",{className:"btn-secondary",onClick:g},"ƒ∞ptal"),t.createElement("button",{className:"btn-primary",onClick:b},"‚úì Kaydet"))))};export{S as default};
