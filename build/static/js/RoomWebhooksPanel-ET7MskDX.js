var W=Object.defineProperty;var r=(l,i)=>W(l,"name",{value:i,configurable:!0});import{r as c,j as e}from"./react-core-Djgtqrmb.js";import{j as B,a as F,an as R,aB as T,g as z,w as E,d as D,I as L}from"./icons-vendor-BMXAt4pj.js";import{t as d}from"./index-D0nbcjO7.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const o={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"900px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},section:{marginBottom:"24px"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},sectionTitle:{margin:0,fontSize:"16px",color:"#ffffff",fontWeight:"600"},addButton:{padding:"8px 16px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center"},createForm:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"20px",marginBottom:"16px"},formGroup:{marginBottom:"16px"},label:{display:"block",color:"#dcddde",fontSize:"14px",marginBottom:"8px",fontWeight:"500"},input:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},eventsGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},eventCheckbox:{display:"flex",alignItems:"center",gap:"8px",color:"#dcddde",fontSize:"14px",cursor:"pointer"},eventLabel:{userSelect:"none"},formActions:{display:"flex",gap:"10px",justifyContent:"flex-end"},createButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},cancelButton:{padding:"10px 20px",backgroundColor:"#4f545c",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px"},webhooksList:{display:"flex",flexDirection:"column",gap:"12px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},webhookCard:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px"},webhookHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},webhookName:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},webhookUrl:{fontSize:"13px",color:"#5865f2",marginBottom:"4px",wordBreak:"break-all"},webhookEvents:{fontSize:"12px",color:"#99aab5"},webhookActions:{display:"flex",gap:"8px"},iconButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"16px",padding:"5px"},deliveriesList:{display:"flex",flexDirection:"column",gap:"12px",maxHeight:"300px",overflowY:"auto"},deliveryCard:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px"},deliveryHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},deliveryStatus:{display:"flex",alignItems:"center",gap:"8px"},deliveryStatusText:{fontSize:"14px",fontWeight:"600",color:"#ffffff"},deliveryTime:{fontSize:"12px",color:"#99aab5"},deliveryBody:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"13px",color:"#dcddde"},deliveryInfo:{display:"flex",gap:"8px"},deliveryError:{color:"#f04747",marginTop:"4px"},retryButton:{marginTop:"12px",padding:"6px 12px",backgroundColor:"#5865f2",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center"}},I=["message.created","message.updated","message.deleted","member.joined","member.left","member.updated","channel.created","channel.updated","channel.deleted","role.created","role.updated","role.deleted"],N=r((l,i,f)=>{const[j,b]=c.useState([]),[g,k]=c.useState([]),[m,h]=c.useState(!1),[w,a]=c.useState(!1),[x,C]=c.useState(null),[p,y]=c.useState({name:"",url:"",events:[]});c.useEffect(()=>{u()},[f]);const u=r(async()=>{h(!0);try{const n=await(await l(`${i}/rooms/${f}/webhooks/`)).json();b(n.webhooks||[])}catch{d.error("Failed to load webhooks")}finally{h(!1)}},"fetchWebhooks"),v=r(async s=>{try{const S=await(await l(`${i}/webhooks/${s}/deliveries/`)).json();k(S.deliveries||[]),C(s)}catch{d.error("Failed to load delivery logs")}},"fetchDeliveries");return{webhooks:j,deliveries:g,loading:m,showCreateForm:w,setShowCreateForm:a,selectedWebhook:x,newWebhook:p,setNewWebhook:y,fetchDeliveries:v,createWebhook:r(async()=>{if(!p.name||!p.url){d.error("Name and URL are required");return}try{await l(`${i}/webhooks/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...p,room_slug:f})}),d.success("Webhook created successfully"),a(!1),y({name:"",url:"",events:[]}),u()}catch{d.error("Failed to create webhook")}},"createWebhook"),deleteWebhook:r(async s=>{if(confirm("Are you sure you want to delete this webhook?"))try{await l(`${i}/webhooks/${s}/delete/`,{method:"DELETE"}),d.success("Webhook deleted successfully"),u()}catch{d.error("Failed to delete webhook")}},"deleteWebhook"),retryDelivery:r(async s=>{try{await l(`${i}/webhook/deliveries/retry/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({delivery_id:s})}),d.success("Delivery retried successfully"),x&&v(x)}catch{d.error("Failed to retry delivery")}},"retryDelivery"),toggleEvent:r(s=>{y(n=>({...n,events:n.events.includes(s)?n.events.filter(S=>S!==s):[...n.events,s]}))},"toggleEvent")}},"useRoomWebhooks"),K=r(({fetchWithAuth:l,apiBaseUrl:i,onClose:f,roomSlug:j})=>{const{webhooks:b,deliveries:g,loading:k,showCreateForm:m,setShowCreateForm:h,selectedWebhook:w,newWebhook:a,setNewWebhook:x,fetchDeliveries:C,createWebhook:p,deleteWebhook:y,retryDelivery:u,toggleEvent:v}=N(l,i,j);return e.jsx("div",{style:o.overlay,children:e.jsxs("div",{style:o.modal,children:[e.jsxs("div",{style:o.header,children:[e.jsxs("div",{style:o.headerLeft,children:[e.jsx(B,{style:{marginRight:"10px",color:"#5865f2"}}),e.jsx("h2",{style:o.title,children:"Channel Webhooks"})]}),e.jsx("button",{onClick:f,style:o.closeButton,children:e.jsx(F,{})})]}),e.jsx("div",{style:o.content,children:k?e.jsx("div",{style:o.loading,children:"Loading webhooks..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:o.section,children:[e.jsxs("div",{style:o.sectionHeader,children:[e.jsx("h3",{style:o.sectionTitle,children:"Webhooks"}),e.jsxs("button",{onClick:r(()=>h(!m),"onClick"),style:o.addButton,children:[e.jsx(R,{style:{marginRight:"5px"}}),"Create Webhook"]})]}),m&&e.jsxs("div",{style:o.createForm,children:[e.jsxs("div",{style:o.formGroup,children:[e.jsx("label",{style:o.label,children:"Webhook Name"}),e.jsx("input",{type:"text",value:a.name,onChange:r(t=>x({...a,name:t.target.value}),"onChange"),placeholder:"My Webhook",style:o.input})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsx("label",{style:o.label,children:"Payload URL"}),e.jsx("input",{type:"url",value:a.url,onChange:r(t=>x({...a,url:t.target.value}),"onChange"),placeholder:"https://example.com/webhook",style:o.input})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsx("label",{style:o.label,children:"Events to Subscribe"}),e.jsx("div",{style:o.eventsGrid,children:I.map(t=>e.jsxs("label",{style:o.eventCheckbox,children:[e.jsx("input",{type:"checkbox",checked:a.events.includes(t),onChange:r(()=>v(t),"onChange")}),e.jsx("span",{style:o.eventLabel,children:t})]},t))})]}),e.jsxs("div",{style:o.formActions,children:[e.jsx("button",{onClick:p,style:o.createButton,children:"Create Webhook"}),e.jsx("button",{onClick:r(()=>h(!1),"onClick"),style:o.cancelButton,children:"Cancel"})]})]}),e.jsx("div",{style:o.webhooksList,children:b.length===0?e.jsx("div",{style:o.empty,children:"No webhooks configured for this channel"}):b.map(t=>e.jsx("div",{style:o.webhookCard,children:e.jsxs("div",{style:o.webhookHeader,children:[e.jsxs("div",{children:[e.jsx("div",{style:o.webhookName,children:t.name}),e.jsx("div",{style:o.webhookUrl,children:t.url}),e.jsx("div",{style:o.webhookEvents,children:t.events?.join(", ")||"All events"})]}),e.jsxs("div",{style:o.webhookActions,children:[e.jsx("button",{onClick:r(()=>C(t.id),"onClick"),style:o.iconButton,title:"View Deliveries",children:e.jsx(T,{})}),e.jsx("button",{onClick:r(()=>y(t.id),"onClick"),style:{...o.iconButton,color:"#f04747"},title:"Delete Webhook",children:e.jsx(z,{})})]})]})},t.id))})]}),w&&e.jsxs("div",{style:o.section,children:[e.jsx("h3",{style:o.sectionTitle,children:"Recent Deliveries"}),e.jsx("div",{style:o.deliveriesList,children:g.length===0?e.jsx("div",{style:o.empty,children:"No deliveries yet"}):g.map(t=>e.jsxs("div",{style:o.deliveryCard,children:[e.jsxs("div",{style:o.deliveryHeader,children:[e.jsxs("div",{style:o.deliveryStatus,children:[t.status==="success"?e.jsx(E,{style:{color:"#43b581"}}):e.jsx(D,{style:{color:"#f04747"}}),e.jsx("span",{style:o.deliveryStatusText,children:t.status==="success"?"Success":"Failed"})]}),e.jsx("div",{style:o.deliveryTime,children:new Date(t.delivered_at).toLocaleString()})]}),e.jsxs("div",{style:o.deliveryBody,children:[e.jsxs("div",{style:o.deliveryInfo,children:[e.jsx("strong",{children:"Event:"})," ",t.event_type]}),e.jsxs("div",{style:o.deliveryInfo,children:[e.jsx("strong",{children:"Response Code:"})," ",t.response_code||"N/A"]}),t.error&&e.jsxs("div",{style:o.deliveryError,children:[e.jsx("strong",{children:"Error:"})," ",t.error]})]}),t.status==="failed"&&e.jsxs("button",{onClick:r(()=>u(t.id),"onClick"),style:o.retryButton,children:[e.jsx(L,{style:{marginRight:"5px"}})," Retry"]})]},t.id))})]})]})})]})})},"RoomWebhooksPanel");export{K as default};
