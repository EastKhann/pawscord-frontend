import{r as m,d as e}from"./react-core-DrOm_csO.js";import{t as s}from"./index-DmEhdEtw.js";const $=({apiBaseUrl:u,roomSlug:h,onClose:E})=>{const[i,g]=m.useState([]),[v,p]=m.useState(!0),[f,d]=m.useState(!1),[n,c]=m.useState({content:"",scheduled_time:"",room_slug:h||""});m.useEffect(()=>{k()},[]);const k=async()=>{try{p(!0);const t=localStorage.getItem("access_token"),a=await fetch(`${u}/scheduled/list/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const l=await a.json();g(l.scheduled_messages||[])}else s.error("âŒ ZamanlanmÄ±ÅŸ mesajlar yÃ¼klenemedi")}catch(t){console.error("Fetch scheduled messages error:",t),s.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{p(!1)}},w=async()=>{if(!n.content.trim()){s.error("âŒ Mesaj iÃ§eriÄŸi boÅŸ olamaz");return}if(!n.scheduled_time){s.error("âŒ Tarih ve saat seÃ§iniz");return}if(!n.room_slug){s.error("âŒ Kanal seÃ§iniz");return}try{const t=localStorage.getItem("access_token"),a=await fetch(`${u}/scheduled/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(a.ok){const l=await a.json();g([...i,l.scheduled_message]),d(!1),c({content:"",scheduled_time:"",room_slug:h||""}),s.success("âœ… Mesaj zamanlandÄ±")}else{const l=await a.json();s.error(`âŒ ${l.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z"}`)}}catch(t){console.error("Create scheduled message error:",t),s.error("âŒ BaÄŸlantÄ± hatasÄ±")}},y=async t=>{if(confirm("Bu zamanlanmÄ±ÅŸ mesajÄ± iptal etmek istediÄŸinize emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${u}/scheduled/cancel/${t}/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(g(i.filter(r=>r.id!==t)),s.success("âœ… ZamanlanmÄ±ÅŸ mesaj iptal edildi")):s.error("âŒ Ä°ptal baÅŸarÄ±sÄ±z")}catch(a){console.error("Cancel scheduled message error:",a),s.error("âŒ BaÄŸlantÄ± hatasÄ±")}},b=t=>{const a=new Date,r=new Date(t)-a;if(r<0)return"GÃ¶nderildi";const o=Math.floor(r/(1e3*60*60)),N=Math.floor(r%(1e3*60*60)/(1e3*60));return o>24?`${Math.floor(o/24)} gÃ¼n ${o%24} saat`:o>0?`${o} saat ${N} dakika`:`${N} dakika`},M=t=>new Date(t).toLocaleString("tr-TR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),_=t=>{const a=new Date,r=new Date(t)-a;return r<0?"status-sent":r<36e5?"status-imminent":r<864e5?"status-soon":"status-scheduled"},j=()=>{const t=new Date;return t.setMinutes(t.getMinutes()+1),t.toISOString().slice(0,16)};return e.createElement("div",{className:"scheduled-messages-overlay",onClick:E},e.createElement("div",{className:"scheduled-messages-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"scheduled-messages-header"},e.createElement("h2",null,"â° ZamanlanmÄ±ÅŸ Mesajlar"),e.createElement("div",{className:"header-actions"},e.createElement("button",{className:"create-btn",onClick:()=>d(!f)},f?"âœ• Ä°ptal":"+ Yeni Mesaj"),e.createElement("button",{className:"close-btn",onClick:E},"âœ•"))),f&&e.createElement("div",{className:"create-form"},e.createElement("h3",null,"ğŸ“ Yeni ZamanlanmÄ±ÅŸ Mesaj"),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Mesaj Ä°Ã§eriÄŸi"),e.createElement("textarea",{className:"message-textarea",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:n.content,onChange:t=>c({...n,content:t.target.value}),rows:4})),e.createElement("div",{className:"form-row"},e.createElement("div",{className:"form-group"},e.createElement("label",null,"Kanal"),e.createElement("input",{type:"text",className:"form-input",placeholder:"room-slug",value:n.room_slug,onChange:t=>c({...n,room_slug:t.target.value})})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"GÃ¶nderim ZamanÄ±"),e.createElement("input",{type:"datetime-local",className:"form-input",value:n.scheduled_time,min:j(),onChange:t=>c({...n,scheduled_time:t.target.value})}))),e.createElement("div",{className:"form-actions"},e.createElement("button",{className:"cancel-form-btn",onClick:()=>{d(!1),c({content:"",scheduled_time:"",room_slug:h||""})}},"Ä°ptal"),e.createElement("button",{className:"submit-btn",onClick:w},"â° Zamanla"))),e.createElement("div",{className:"scheduled-messages-content"},v?e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"YÃ¼kleniyor...")):i.length===0?e.createElement("div",{className:"empty-state"},e.createElement("div",{className:"empty-icon"},"â°"),e.createElement("h3",null,"ZamanlanmÄ±ÅŸ mesaj yok"),e.createElement("p",null,"Gelecekte gÃ¶nderilmek Ã¼zere mesaj zamanlamadÄ±nÄ±z"),e.createElement("button",{className:"create-first-btn",onClick:()=>d(!0)},"+ Ä°lk MesajÄ± Zamanla")):e.createElement("div",{className:"messages-list"},i.map(t=>e.createElement("div",{key:t.id,className:`scheduled-message-card ${_(t.scheduled_time)}`},e.createElement("div",{className:"message-header"},e.createElement("div",{className:"message-info"},e.createElement("span",{className:"room-badge"},"# ",t.room_slug),e.createElement("span",{className:"time-badge"},M(t.scheduled_time))),e.createElement("button",{className:"cancel-btn",onClick:()=>y(t.id),title:"Ä°ptal Et"},"ğŸ—‘ï¸")),e.createElement("div",{className:"message-content"},t.content),e.createElement("div",{className:"message-footer"},e.createElement("div",{className:"countdown"},e.createElement("span",{className:"countdown-icon"},"â³"),e.createElement("span",{className:"countdown-text"},b(t.scheduled_time))),t.sent&&e.createElement("div",{className:"sent-badge"},"âœ… GÃ¶nderildi"))))))))};export{$ as default};
