import{r as s,d as e,I as v,i as B,o as y,aC as g,cC as A,cD as z,cE as x,cF as R,cG as D,cH as G,cI as I,bo as N,bv as H,J as L,cJ as X}from"./react-core-DMT_QkRe.js";import{a as Y,t as l}from"./index-Bb71lKFt.js";import{g as j}from"./apiEndpoints-DTuZVK56.js";const U=({onClose:p})=>{const{token:E,user:k}=Y(),[C,w]=s.useState({}),[F,$]=s.useState(!0),[T,r]=s.useState(null),c=s.useRef(null),m=s.useRef(null),u=j().replace("/api",""),h=[{id:"spotify",name:"Spotify",icon:A,color:"#1DB954",description:"Dinlediğin müziği profilinde göster",oauth:!0,features:["Now Playing","Rich Presence"]},{id:"steam",name:"Steam",icon:z,color:"#171A21",description:"Oynadığın oyunları profilinde göster",oauth:!0,features:["Game Activity","Rich Presence","Achievements"]},{id:"xbox",name:"Xbox",icon:x,color:"#107C10",description:"Xbox Live hesabını bağla",oauth:!0,features:["Gamertag","Game Activity","Achievements"]},{id:"twitch",name:"Twitch",icon:R,color:"#9146FF",description:"Twitch yayın durumunu göster",oauth:!0,features:["Stream Status","Rich Presence"]},{id:"github",name:"GitHub",icon:D,color:"#333333",description:"GitHub profilini bağla",oauth:!0,features:["Repositories","Contributions","Profile"]},{id:"youtube",name:"YouTube",icon:G,color:"#FF0000",description:"YouTube kanalını bağla",oauth:!0,features:["Channel","Subscribers","Videos"]},{id:"discord",name:"Discord",icon:I,color:"#5865F2",description:"Discord hesabını bağla (migration)",oauth:!0,features:["Profile","Friends Import"]}],d=s.useCallback(async()=>{const n=new AbortController,t=setTimeout(()=>n.abort(),1e4);try{const a=await fetch(`${u}/api/connections/status/`,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(t),a.ok){const i=await a.json();w(i.connections||{})}}catch(a){a.name==="AbortError"?(console.error("Connections loading timeout (10s)"),l.error("Bağlantılar yüklenemedi - zaman aşımı")):console.error("Failed to load connections:",a)}finally{$(!1)}},[E,u]);s.useEffect(()=>(d(),()=>{c.current&&clearInterval(c.current),m.current&&clearTimeout(m.current)}),[d]);const P=n=>{c.current&&clearInterval(c.current),m.current&&clearTimeout(m.current),r(n);const t=500,a=700,i=window.screenX+(window.outerWidth-t)/2,f=window.screenY+(window.outerHeight-a)/2,o=window.open(`${u}/api/auth/${n}/start/?username=${k?.username||"anonymous"}`,`${n}_oauth`,`width=${t},height=${a},left=${i},top=${f},toolbar=no,menubar=no`);if(!o){l.error("Popup blocker tarafından engellendi. Lütfen popup'lara izin verin."),r(null);return}c.current=setInterval(()=>{o.closed&&(clearInterval(c.current),c.current=null,r(null),d(),l.success(`${n} bağlantısı kontrol ediliyor...`))},500),m.current=setTimeout(()=>{c.current&&(clearInterval(c.current),c.current=null),o.closed||o.close(),r(null)},12e4)},S=async n=>{if(confirm(`${n} bağlantısını kesmek istediğinize emin misiniz?`)){r(n);try{(await fetch(`${u}/api/connections/${n}/disconnect/`,{method:"POST",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}})).ok?(l.success(`${n} bağlantısı kesildi`),d()):l.error("Bağlantı kesilemedi")}catch(t){console.error("Disconnect error:",t),l.error("Bağlantı kesme hatası")}finally{r(null)}}},b=n=>{const t=C[n.id],a=t?.connected,i=T===n.id,f=n.icon;return e.createElement("div",{key:n.id,className:`connection-card ${a?"connected":""}`,style:{"--platform-color":n.color}},e.createElement("div",{className:"connection-header"},e.createElement("div",{className:"platform-icon",style:{backgroundColor:n.color}},e.createElement(f,null)),e.createElement("div",{className:"platform-info"},e.createElement("h3",null,n.name),e.createElement("p",null,n.description))),a&&t.username&&e.createElement("div",{className:"connection-details"},e.createElement("span",{className:"connected-as"},e.createElement(L,{className:"status-icon success"}),"Bağlı: ",e.createElement("strong",null,t.username)),t.data&&e.createElement("div",{className:"connection-data"},t.data.game&&e.createElement("span",{className:"activity"},e.createElement(g,null)," ",t.data.game),t.data.track&&e.createElement("span",{className:"activity"},e.createElement(N,null)," ",t.data.track))),e.createElement("div",{className:"connection-features"},n.features.map(o=>e.createElement("span",{key:o,className:"feature-tag"},o))),e.createElement("div",{className:"connection-actions"},a?e.createElement("button",{className:"disconnect-btn",onClick:()=>S(n.id),disabled:i},i?e.createElement(v,{className:"spin"}):e.createElement(X,null),"Bağlantıyı Kes"):e.createElement("button",{className:"connect-btn",onClick:()=>P(n.id),disabled:i,style:{backgroundColor:n.color}},i?e.createElement(v,{className:"spin"}):e.createElement(y,null),"Bağlan")))};return F?e.createElement("div",{className:"connections-modal-overlay",onClick:p},e.createElement("div",{className:"connections-modal",onClick:n=>n.stopPropagation()},e.createElement("div",{className:"connections-panel loading"},e.createElement(v,{className:"spin large"}),e.createElement("p",null,"Bağlantılar yükleniyor...")))):e.createElement("div",{className:"connections-modal-overlay",onClick:p},e.createElement("div",{className:"connections-modal",onClick:n=>n.stopPropagation()},e.createElement("button",{className:"connections-close-btn",onClick:p},e.createElement(B,null)),e.createElement("div",{className:"connections-panel"},e.createElement("div",{className:"connections-header"},e.createElement("h2",null,e.createElement(y,null)," Bağlantılar"),e.createElement("p",null,"Hesaplarını bağlayarak profilini zenginleştir ve aktivitelerini göster")),e.createElement("div",{className:"connections-grid"},e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(g,null)," Oyun Platformları"),e.createElement("div",{className:"platforms-grid"},h.filter(n=>["steam","epic","xbox","playstation","battlenet","riot"].includes(n.id)).map(b))),e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(N,null)," Müzik & Streaming"),e.createElement("div",{className:"platforms-grid"},h.filter(n=>["spotify","twitch","youtube"].includes(n.id)).map(b))),e.createElement("div",{className:"connection-section"},e.createElement("h3",{className:"section-title"},e.createElement(y,null)," Sosyal Medya"),e.createElement("div",{className:"platforms-grid"},h.filter(n=>["discord","twitter","github"].includes(n.id)).map(b)))),e.createElement("div",{className:"connections-footer"},e.createElement("p",{className:"privacy-note"},e.createElement(H,null),"Bağlantılar sadece izin verdiğin bilgilere erişir. İstediğin zaman bağlantıyı kesebilirsin.")))))};export{U as default};
