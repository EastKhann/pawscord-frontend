import{r as a,cU as L,cP as Q,d5 as V,dn as D,bS as J,bT as K,dp as Y,a5 as G,dq as Z,aI as H,bZ as W,a3 as X,l as F}from"./react-core-B6hadH-M.js";import{r as n,t as c}from"./index-D_6pZib5.js";const ae=({channelId:r})=>{const[o,y]=a.useState(!1),[s,u]=a.useState(null),[l,d]=a.useState([]),[E,f]=a.useState(70),[m,q]=a.useState(!1),[N,_]=a.useState(!1),[v,A]=a.useState(!1),[S,b]=a.useState(!1),[g,R]=a.useState(!1),[p,$]=a.useState(""),[T,P]=a.useState(0),[k,B]=a.useState(0),i=a.useRef(null);a.useEffect(()=>{x();const e=setInterval(()=>{o&&i.current&&(P(i.current.currentTime),B(i.current.duration))},1e3);return()=>clearInterval(e)},[o]);const x=async()=>{try{const e=await fetch(`${n}/music/${r}/status/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();u(t.current_track),d(t.queue||[]),y(t.is_playing),f(t.volume||70)}}catch(e){console.error("Failed to fetch player status:",e)}},z=async()=>{try{(await fetch(`${n}/music/${r}/${o?"pause":"play"}/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(y(!o),c.success(o?"⏸️ Durakladı":"▶️ Çalıyor"))}catch{c.error("❌ İşlem başarısız")}},U=async()=>{try{const e=await fetch(`${n}/music/${r}/skip/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();u(t.current_track),c.success("⏭️ Sonraki şarkı")}}catch{c.error("❌ Atlama başarısız")}},I=async()=>{try{const e=await fetch(`${n}/music/${r}/previous/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const t=await e.json();u(t.current_track),c.success("⏮️ Önceki şarkı")}}catch{c.error("❌ Geri alma başarısız")}},O=async e=>{f(e);try{await fetch(`${n}/music/${r}/volume/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({volume:e})})}catch(t){console.error("Volume change failed:",t)}},C=async()=>{if(!p.trim()){c.error("❌ URL girin");return}try{const e=await fetch(`${n}/music/${r}/add/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({url:p})});if(e.ok){const t=await e.json();d([...l,t.track]),$(""),R(!1),c.success("✅ Sıraya eklendi")}else c.error("❌ Eklenemedi")}catch{c.error("❌ Bağlantı hatası")}},j=async e=>{try{(await fetch(`${n}/music/${r}/remove/${e}/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(d(l.filter(h=>h.id!==e)),c.success("✅ Sıradan çıkarıldı"))}catch{c.error("❌ İşlem başarısız")}},w=e=>{if(!e||isNaN(e))return"0:00";const t=Math.floor(e/60),h=Math.floor(e%60);return`${t}:${h.toString().padStart(2,"0")}`},M=e=>{const t=e.target.value/100*k;P(t),i.current&&(i.current.currentTime=t)};return React.createElement("div",{className:"music-player"},React.createElement("audio",{ref:i,src:s?.audio_url}),React.createElement("div",{className:"player-main"},React.createElement("div",{className:"track-info"},s?React.createElement(React.Fragment,null,React.createElement("img",{src:s.thumbnail||"/default-music.png",alt:s.title,className:"track-thumbnail"}),React.createElement("div",{className:"track-details"},React.createElement("div",{className:"track-title"},s.title),React.createElement("div",{className:"track-artist"},s.artist||"Bilinmeyen Sanatçı")),React.createElement("div",{className:"track-source"},s.source==="youtube"&&React.createElement(L,{className:"source-icon youtube"}),s.source==="spotify"&&React.createElement(Q,{className:"source-icon spotify"}))):React.createElement("div",{className:"no-track"},React.createElement("span",null,"Şarkı seçilmedi"))),React.createElement("div",{className:"player-controls"},React.createElement("div",{className:"control-buttons"},React.createElement("button",{className:`control-btn ${N?"active":""}`,onClick:()=>_(!N),title:"Karıştır"},React.createElement(V,null)),React.createElement("button",{className:"control-btn",onClick:I,title:"Önceki"},React.createElement(D,null)),React.createElement("button",{className:"control-btn play-btn",onClick:z},o?React.createElement(J,null):React.createElement(K,null)),React.createElement("button",{className:"control-btn",onClick:U,title:"Sonraki"},React.createElement(Y,null)),React.createElement("button",{className:`control-btn ${v?"active":""}`,onClick:()=>A(!v),title:"Tekrarla"},React.createElement(G,null))),React.createElement("div",{className:"progress-container"},React.createElement("span",{className:"time-display"},w(T)),React.createElement("input",{type:"range",className:"progress-bar",min:"0",max:"100",value:T/k*100||0,onChange:M}),React.createElement("span",{className:"time-display"},w(k)))),React.createElement("div",{className:"player-extras"},React.createElement("button",{className:"extra-btn",onClick:()=>b(!S),title:"Sıra"},React.createElement(Z,null),l.length>0&&React.createElement("span",{className:"queue-count"},l.length)),React.createElement("button",{className:"extra-btn",onClick:()=>R(!g),title:"Şarkı Ekle"},React.createElement(H,null)),React.createElement("div",{className:"volume-control"},React.createElement("button",{className:"extra-btn",onClick:()=>q(!m)},m||E===0?React.createElement(W,null):React.createElement(X,null)),React.createElement("input",{type:"range",className:"volume-slider",min:"0",max:"100",value:m?0:E,onChange:e=>O(parseInt(e.target.value))}),React.createElement("span",{className:"volume-display"},m?0:E,"%")))),S&&React.createElement("div",{className:"queue-panel"},React.createElement("div",{className:"queue-header"},React.createElement("h3",null,"Sıra (",l.length,")"),React.createElement("button",{className:"close-btn",onClick:()=>b(!1)},React.createElement(F,null))),React.createElement("div",{className:"queue-list"},l.length===0?React.createElement("div",{className:"queue-empty"},"Sıra boş"):l.map((e,t)=>React.createElement("div",{key:e.id,className:"queue-item"},React.createElement("span",{className:"queue-index"},t+1),React.createElement("img",{src:e.thumbnail,alt:e.title,className:"queue-thumbnail"}),React.createElement("div",{className:"queue-track-info"},React.createElement("div",{className:"queue-track-title"},e.title),React.createElement("div",{className:"queue-track-artist"},e.artist||"Bilinmeyen")),React.createElement("button",{className:"remove-btn",onClick:()=>j(e.id),title:"Sıradan Çıkar"},React.createElement(F,null)))))),g&&React.createElement("div",{className:"add-track-modal"},React.createElement("div",{className:"add-track-content"},React.createElement("h3",null,"Şarkı Ekle"),React.createElement("input",{type:"text",className:"track-url-input",placeholder:"YouTube veya Spotify URL'si girin...",value:p,onChange:e=>$(e.target.value),onKeyPress:e=>e.key==="Enter"&&C()}),React.createElement("div",{className:"modal-actions"},React.createElement("button",{className:"btn-cancel",onClick:()=>R(!1)},"İptal"),React.createElement("button",{className:"btn-add",onClick:C},"Ekle")))))};export{ae as default};
