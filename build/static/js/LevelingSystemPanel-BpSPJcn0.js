import{r as o,ch as n}from"./react-core-B6hadH-M.js";import{g as T,h as K}from"./index-D_6pZib5.js";const D=({serverId:r,onClose:h})=>{const[t,s]=o.useState({enabled:!1,xp_per_message:15,xp_cooldown:60,level_up_message:"Tebrikler {user}! {level} seviyeye ulaÅŸtÄ±n! ğŸ‰",announce_channel_id:"",stack_roles:!1,reset_on_leave:!1}),[d,v]=o.useState([]),[i,u]=o.useState({level:1,role_id:""}),[f,b]=o.useState([]),[y,k]=o.useState([]),[p,N]=o.useState([]),[_,S]=o.useState(!0),c=T();o.useEffect(()=>{r&&($(),w(),C(),x(),E())},[r]);const $=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/leveling/server/${r}/config/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();s(l.config||t)}}catch(e){console.error("Error fetching config:",e)}finally{S(!1)}},w=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/leveling/server/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();v(l.level_roles||[])}}catch(e){console.error("Error fetching level roles:",e)}},C=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/servers/${r}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();b(l.roles||[])}}catch(e){console.error("Error fetching roles:",e)}},x=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/servers/${r}/channels/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();k(l.channels||[])}}catch(e){console.error("Error fetching channels:",e)}},E=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/leveling/server/${r}/leaderboard/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();N(l.leaderboard||[])}}catch(e){console.error("Error fetching leaderboard:",e)}},z=async()=>{try{const e=localStorage.getItem("access_token");(await fetch(`${c}/leveling/server/${r}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?n.success("âœ… Ayarlar kaydedildi"):n.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch(e){console.error("Error saving config:",e),n.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}},P=async()=>{if(!i.role_id||i.level<1){n.error("âŒ Rol ve seviye zorunludur");return}try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/leveling/server/${r}/roles/add/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const l=await a.json();v([...d,l.level_role]),u({level:1,role_id:""}),n.success("âœ… Seviye rolÃ¼ eklendi")}}catch(e){console.error("Error adding level role:",e),n.error("âŒ Ekleme baÅŸarÄ±sÄ±z")}},A=async e=>{try{const a=localStorage.getItem("access_token");(await fetch(`${c}/leveling/server/${r}/roles/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok&&(v(d.filter(m=>m.id!==e)),n.success("âœ… Seviye rolÃ¼ kaldÄ±rÄ±ldÄ±"))}catch(a){console.error("Error removing level role:",a),n.error("âŒ KaldÄ±rma baÅŸarÄ±sÄ±z")}},L=async e=>{if(await K("Bu kullanÄ±cÄ±nÄ±n XP'sini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${c}/leveling/server/${r}/user/${e}/reset/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(n.success("âœ… XP sÄ±fÄ±rlandÄ±"),E())}catch(a){console.error("Error resetting XP:",a),n.error("âŒ SÄ±fÄ±rlama baÅŸarÄ±sÄ±z")}},B=e=>e===1?"#fbbf24":e===2?"#c0c0c0":e===3?"#cd7f32":"#6366f1",X=e=>{const m=100-e,g=Math.floor((-50+Math.sqrt(2500-20*m))/10);return Math.max(1,g)},R=e=>5*e**2+50*e+100;return _?React.createElement("div",{className:"leveling-overlay"},React.createElement("div",{className:"leveling-panel"},React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"Seviye sistemi yÃ¼kleniyor...")))):React.createElement("div",{className:"leveling-overlay",onClick:h},React.createElement("div",{className:"leveling-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"leveling-header"},React.createElement("h2",null,"â­ Seviye Sistemi"),React.createElement("button",{className:"close-btn",onClick:h},"Ã—")),React.createElement("div",{className:"leveling-content"},React.createElement("div",{className:"config-section"},React.createElement("div",{className:"section-header"},React.createElement("h3",null,"âš™ï¸ Genel Ayarlar"),React.createElement("label",{className:"toggle-switch"},React.createElement("input",{type:"checkbox",checked:t.enabled,onChange:e=>s({...t,enabled:e.target.checked})}),React.createElement("span",{className:"slider"}),React.createElement("span",{className:"toggle-label"},t.enabled?"Aktif":"Pasif"))),React.createElement("div",{className:"form-grid"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Mesaj BaÅŸÄ±na XP"),React.createElement("input",{type:"number",min:"1",max:"100",value:t.xp_per_message,onChange:e=>s({...t,xp_per_message:parseInt(e.target.value)}),disabled:!t.enabled})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"XP Cooldown (saniye)"),React.createElement("input",{type:"number",min:"0",max:"300",value:t.xp_cooldown,onChange:e=>s({...t,xp_cooldown:parseInt(e.target.value)}),disabled:!t.enabled})),React.createElement("div",{className:"form-group full-width"},React.createElement("label",null,"Duyuru KanalÄ±"),React.createElement("select",{value:t.announce_channel_id,onChange:e=>s({...t,announce_channel_id:e.target.value}),disabled:!t.enabled},React.createElement("option",{value:""},"SeÃ§iniz (opsiyonel)"),y.map(e=>React.createElement("option",{key:e.id,value:e.id},"#",e.name)))),React.createElement("div",{className:"form-group full-width"},React.createElement("label",null,"Seviye Atlama MesajÄ±"),React.createElement("textarea",{value:t.level_up_message,onChange:e=>s({...t,level_up_message:e.target.value}),disabled:!t.enabled,rows:"2"}),React.createElement("span",{className:"hint"},"KullanÄ±labilir: ","{user}",", ","{level}")),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:t.stack_roles,onChange:e=>s({...t,stack_roles:e.target.checked}),disabled:!t.enabled}),React.createElement("span",null,"Rolleri biriktir (Ã¶nceki seviye rollerini kaldÄ±rma)"))),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"checkbox-label"},React.createElement("input",{type:"checkbox",checked:t.reset_on_leave,onChange:e=>s({...t,reset_on_leave:e.target.checked}),disabled:!t.enabled}),React.createElement("span",null,"Sunucudan ayrÄ±lÄ±nca XP'yi sÄ±fÄ±rla")))),React.createElement("button",{className:"save-btn",onClick:z},"ğŸ’¾ AyarlarÄ± Kaydet")),React.createElement("div",{className:"level-roles-section"},React.createElement("h3",null,"ğŸ­ Seviye Rolleri"),React.createElement("div",{className:"add-role-form"},React.createElement("input",{type:"number",placeholder:"Seviye",min:"1",value:i.level,onChange:e=>u({...i,level:parseInt(e.target.value)})}),React.createElement("select",{value:i.role_id,onChange:e=>u({...i,role_id:e.target.value})},React.createElement("option",{value:""},"Rol seÃ§in"),f.map(e=>React.createElement("option",{key:e.id,value:e.id},e.name))),React.createElement("button",{className:"add-btn",onClick:P},"â• Ekle")),React.createElement("div",{className:"level-roles-list"},d.length===0?React.createElement("div",{className:"empty-state"},React.createElement("span",null,"HenÃ¼z seviye rolÃ¼ eklenmedi")):d.sort((e,a)=>e.level-a.level).map(e=>React.createElement("div",{key:e.id,className:"level-role-item"},React.createElement("div",{className:"level-badge"},"Lv ",e.level),React.createElement("span",{className:"role-name"},e.role_name||`Role #${e.role_id}`),React.createElement("button",{className:"remove-btn",onClick:()=>A(e.id)},"Ã—"))))),React.createElement("div",{className:"leaderboard-section"},React.createElement("h3",null,"ğŸ† SÄ±ralama"),React.createElement("div",{className:"leaderboard-list"},p.length===0?React.createElement("div",{className:"empty-state"},React.createElement("span",null,"HenÃ¼z seviye kazanan Ã¼ye yok")):p.map((e,a)=>{const l=X(e.xp),m=R(l),g=R(l+1),j=(e.xp-m)/(g-m)*100;return React.createElement("div",{key:e.user_id,className:"leaderboard-item"},React.createElement("div",{className:"rank-badge",style:{background:B(a+1)}},"#",a+1),React.createElement("div",{className:"user-avatar"},e.avatar?React.createElement("img",{src:e.avatar,alt:e.username}):React.createElement("span",null,e.username[0])),React.createElement("div",{className:"user-info"},React.createElement("div",{className:"user-name"},e.username),React.createElement("div",{className:"level-progress"},React.createElement("div",{className:"progress-bar"},React.createElement("div",{className:"progress-fill",style:{width:`${j}%`}})),React.createElement("span",{className:"level-text"},"Level ",l," â€¢ ",e.xp," XP"))),React.createElement("button",{className:"reset-btn",onClick:()=>L(e.user_id)},"ğŸ”„"))}))))))};export{D as default};
