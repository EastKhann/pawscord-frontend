import{r as a,T as K,Z as O}from"./react-core-B6hadH-M.js";import"./grammarQuestions-CqWa-vZX.js";import{A as b,u as F}from"./index-D_6pZib5.js";const I=`${b}/auth/token/refresh/`,N=`${b}/eng-learn/words/`,M=`${b}/eng-learn/known-words/`,G=`${b}/eng-learn/mark-known/`;IS_PRODUCTION;IS_PRODUCTION||`${MY_LOCAL_IP}${DJANGO_PORT}`;const $=()=>localStorage.getItem("access_token");function J(){const[i,A]=a.useState({}),[u,w]=a.useState({}),[k,z]=a.useState([]),[o,E]=a.useState(""),[c,S]=a.useState(null),[C,B]=a.useState(!1),[v,L]=a.useState(!0),[W,D]=a.useState(null),[h,T]=a.useState(!1),_=K();a.useRef(null);const x=a.useCallback(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),_("/")},[_]),f=a.useCallback(async(t,r={})=>{const n=async()=>{const m=$(),l=r.headers||{};return m&&(l.Authorization=`Bearer ${m}`),r.body instanceof FormData||(l["Content-Type"]="application/json"),fetch(t,{...r,headers:l})};let s=await n();if(s.status===401&&t!==I){console.warn("Token sÃ¼resi doldu, yenileniyor...");const m=localStorage.getItem("refresh_token");if(!m)throw x(),new Error("Oturum sÃ¼resi doldu, giriÅŸ yapÄ±n.");try{const l=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:m})}),j=await l.json();if(!l.ok)throw x(),new Error("Oturum yenilenemedi.");localStorage.setItem("access_token",j.access),s=await n()}catch(l){throw x(),l}}return s},[x]);a.useEffect(()=>{(async()=>{try{const[r,n]=await Promise.all([f(N),f(M)]);if(!r.ok)throw r.status===401?new Error("LÃ¼tfen Ã¶nce Pawscord'a giriÅŸ yapÄ±n."):new Error("Kelimeler yÃ¼klenemedi. API hatasÄ±.");if(!n.ok)throw new Error("Bilinen kelimeler listesi alÄ±namadÄ±.");const s=await r.json(),m=await n.json(),l=Object.keys(s||{}).sort();A(s),w(m||{}),z(l),l.length>0&&E(l[0])}catch(r){D(r.message)}finally{L(!1)}})()},[f]);const g=a.useMemo(()=>{if(!o||!i[o])return[];const t=new Set(u[o]||[]);return i[o].filter(r=>!t.has(r.term))},[i,o,u]),d=a.useMemo(()=>{const t=i[o]?.length||0,r=u[o]?.length||0,n=t>0?r/t*100:0;return{totalWords:t,knownWords:r,progress:Math.round(n)}},[o,i,u]),p=a.useMemo(()=>{let t=0,r=0;Object.values(i).forEach(s=>{t+=s.length}),Object.values(u).forEach(s=>{r+=s.length});const n=t>0?r/t*100:0;return{totalWords:t,totalKnownWords:r,progress:Math.round(n)}},[i,u]),R=a.useCallback(()=>{if(B(!1),T(!1),g.length===0){S(null),o&&T(!0);return}const t=Math.floor(Math.random()*g.length);S(g[t])},[g,o]);a.useEffect(()=>{!v&&k.length>0&&R()},[o,v,k,g,R]);const P=a.useCallback(async()=>{if(!c)return;const{term:t}=c,r=o;try{const n=await f(G,{method:"POST",body:JSON.stringify({level:r,word:t})});if(!n.ok)throw new Error("Kelime kaydedilemedi");const s=await n.json();w(s)}catch(n){console.error("Kelime kaydetme API hatasÄ±:",n)}},[c,o,f]),{globalData:y}=F();return a.useEffect(()=>{y?.type==="user_profile_update"&&y.user_data&&y.user_data.known_words&&w(y.user_data.known_words)},[y]),v?React.createElement("div",{style:e.pageContainer},"YÃ¼kleniyor..."):W?React.createElement("div",{style:e.pageContainer},React.createElement("h1",{style:e.errorText},"Hata: ",W),React.createElement(O,{to:"/",style:e.backButton},"Sohbete Geri DÃ¶n")):React.createElement("div",{style:e.pageContainer},React.createElement(O,{to:"/eng-learn",style:e.backButton},"â† Merkeze DÃ¶n"),React.createElement("div",{style:e.quizContainer},React.createElement("h1",{style:e.pageTitle},"Ä°ngilizce Kelime Ã–ÄŸren"),React.createElement("div",{style:e.levelAndProgressContainer},React.createElement("div",{style:e.controls},React.createElement("label",{htmlFor:"level-select",style:e.label},"Seviye:"),React.createElement("select",{id:"level-select",value:o,onChange:t=>E(t.target.value),style:e.select},k.map(t=>React.createElement("option",{key:t,value:t},t.toUpperCase()," (",i[t]?.length||0," kelime)")))),React.createElement("div",{style:e.progressStats},React.createElement("span",null,"BildiÄŸiniz: ",React.createElement("strong",null,d.knownWords)),React.createElement("span",null,"Toplam: ",React.createElement("strong",null,d.totalWords)))),React.createElement("div",{style:{...e.progressBarBackground,marginBottom:"20px"}},React.createElement("div",{style:{...e.progressBarFill,width:`${d.progress}%`}},d.progress>15&&React.createElement("span",null,d.progress,"%")),d.progress<=15&&React.createElement("span",{style:e.progressTextOutside},d.progress,"%")),React.createElement("div",null,React.createElement("h4",{style:e.totalStatsHeader},"Genel Toplam Ä°lerleme"),React.createElement("div",{style:{...e.progressStats,marginBottom:"8px"}},React.createElement("span",null,"Toplam BildiÄŸiniz: ",React.createElement("strong",null,p.totalKnownWords)),React.createElement("span",null,"Toplam Kelime: ",React.createElement("strong",null,p.totalWords))),React.createElement("div",{style:e.progressBarBackground},React.createElement("div",{style:{...e.progressBarFill,...e.totalProgressBarFill,width:`${p.progress}%`}},p.progress>15&&React.createElement("span",null,p.progress,"%")),p.progress<=15&&React.createElement("span",{style:e.progressTextOutside},p.progress,"%"))),React.createElement("div",{style:e.wordArea},h?React.createElement("h2",{style:{...e.term,color:"var(--text-positive)"}},"Tebrikler! ðŸŽ‰",React.createElement("br",null),"Bu seviyedeki tÃ¼m kelimeleri tamamladÄ±nÄ±z."):c?React.createElement(React.Fragment,null,React.createElement("h2",{style:e.term},c.term),C&&React.createElement("p",{style:e.meanings},c.meanings.join(" / "))):React.createElement("p",null,"Bu seviyede kelime bulunamadÄ±.")),React.createElement("div",{style:e.buttonGroup},React.createElement("button",{style:e.actionButton,onClick:()=>B(!0),disabled:C||!c||h},"CevabÄ± GÃ¶ster"),React.createElement("button",{style:{...e.actionButton,...e.knownButton},onClick:P,disabled:!c||h},"Biliyorum (GeÃ§)"),React.createElement("button",{style:{...e.actionButton,...e.primaryButton},onClick:R,disabled:h||g.length<=1},"Yeni Kelime"))))}const e={pageContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",minHeight:"100%",backgroundColor:"var(--background-primary, #36393f)",color:"var(--text-primary, #dcddde)",fontFamily:"Poppins, sans-serif",padding:"30px 20px",boxSizing:"border-box"},quizContainer:{width:"100%",maxWidth:"600px",backgroundColor:"var(--background-secondary, #2f3136)",borderRadius:"8px",padding:"25px 25px 35px 25px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",textAlign:"center",position:"relative",boxSizing:"border-box",marginTop:"10px"},pageTitle:{marginTop:"10px",marginBottom:"15px",color:"var(--text-primary, #dcddde)"},backButton:{padding:"10px 15px",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold",fontSize:"1em",marginBottom:"20px"},levelAndProgressContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},controls:{display:"flex",alignItems:"center",gap:"10px"},progressStats:{display:"flex",gap:"15px",fontSize:"0.9em",color:"var(--text-secondary, #72767d)",justifyContent:"flex-start"},totalStatsHeader:{fontSize:"0.9em",color:"var(--text-secondary, #72767d)",fontWeight:"bold",textTransform:"uppercase",textAlign:"left",margin:"0 0 8px 0"},label:{fontSize:"1.1em",color:"var(--text-primary, #dcddde)"},select:{padding:"8px",fontSize:"1em",backgroundColor:"var(--background-tertiary, #202225)",color:"var(--text-primary, #dcddde)",border:"1px solid var(--border-primary, #202225)",borderRadius:"4px"},progressBarBackground:{width:"100%",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",height:"24px",overflow:"hidden",position:"relative"},progressBarFill:{height:"100%",backgroundColor:"var(--text-positive, #43b581)",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"0.9em",transition:"width 0.3s ease"},totalProgressBarFill:{backgroundColor:"var(--button-primary, #5865f2)"},progressTextOutside:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-primary, #dcddde)",fontSize:"0.9em",fontWeight:"bold"},wordArea:{marginTop:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"var(--background-tertiary, #202225)",borderRadius:"5px",padding:"30px 20px",wordBreak:"break-word"},term:{fontSize:"clamp(1.8em, 5vw, 2.5em)",fontWeight:"bold",color:"var(--text-primary, #dcddde)",margin:0},meanings:{fontSize:"clamp(1.1em, 3vw, 1.5em)",color:"var(--text-positive, #43b581)",margin:"10px 0 0 0"},buttonGroup:{marginTop:"30px",display:"flex",gap:"10px",flexWrap:"wrap"},actionButton:{flex:1,minWidth:"150px",padding:"12px",fontSize:"1.1em",fontWeight:"bold",border:"none",borderRadius:"5px",cursor:"pointer",backgroundColor:"var(--button-secondary, #4f545c)",color:"white",transition:"opacity 0.2s"},knownButton:{backgroundColor:"var(--text-positive, #43b581)"},primaryButton:{backgroundColor:"var(--button-primary, #5865f2)"},errorText:{color:"var(--text-danger, #f04747)"}};export{J as default};
