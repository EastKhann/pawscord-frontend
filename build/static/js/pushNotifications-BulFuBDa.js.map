{"version":3,"mappings":"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","names":["PushNotifications"],"ignoreList":[],"sources":["../../../src/utils/pushNotifications.js"],"sourcesContent":["// frontend/src/utils/pushNotifications.js\n\n/**\n * üîî Push Notifications Manager\n * APK i√ßin FCM entegrasyonu\n */\n\nclass PushNotificationManager {\n    constructor() {\n        this.isSupported = 'PushManager' in window;\n        this.permission = 'default';\n        this.deviceToken = null;\n        this.listeners = new Map();\n    }\n\n    /**\n     * Initialize push notifications\n     */\n    async init(apiBaseUrl, fetchWithAuth) {\n        this.apiBaseUrl = apiBaseUrl;\n        this.fetchWithAuth = fetchWithAuth;\n\n        // Check if running in Capacitor (APK)\n        const isCapacitor = window.Capacitor?.isNativePlatform();\n\n        if (isCapacitor) {\n            await this.initCapacitor();\n        } else {\n            await this.initWeb();\n        }\n    }\n\n    /**\n     * Capacitor (APK) initialization\n     */\n    async initCapacitor() {\n        try {\n            const { PushNotifications } = await import('@capacitor/push-notifications');\n\n            // Request permission\n            const permResult = await PushNotifications.requestPermissions();\n\n            if (permResult.receive === 'granted') {\n                this.permission = 'granted';\n\n                // Register with FCM\n                await PushNotifications.register();\n\n                // Listen for registration\n                await PushNotifications.addListener('registration', async (token) => {\n                    this.deviceToken = token.value;\n                    await this.registerDevice(token.value);\n                });\n\n                // Listen for registration errors\n                await PushNotifications.addListener('registrationError', (error) => {\n                    console.error('üîî [Push] Registration error:', error);\n                });\n\n                // Listen for push notifications\n                await PushNotifications.addListener('pushNotificationReceived', (notification) => {\n                    this.handleNotification(notification);\n                });\n\n                // Listen for notification actions\n                await PushNotifications.addListener('pushNotificationActionPerformed', (action) => {\n                    this.handleNotificationAction(action);\n                });\n\n            }\n        } catch (error) {\n            console.error('‚ùå [Push] Capacitor init failed:', error);\n        }\n    }\n\n    /**\n     * Web push notifications initialization\n     */\n    async initWeb() {\n        if (!this.isSupported) {\n            console.warn('‚ö†Ô∏è [Push] Web push not supported');\n            return;\n        }\n\n        // Request permission\n        const permission = await Notification.requestPermission();\n        this.permission = permission;\n\n        if (permission === 'granted') {\n        }\n    }\n\n    /**\n     * Register device token with backend\n     */\n    async registerDevice(token) {\n        try {\n            const response = await this.fetchWithAuth(`${this.apiBaseUrl}/devices/`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    registration_id: token,\n                    type: 'android', // or 'ios', 'web'\n                    active: true\n                })\n            });\n\n            if (response.ok) {\n            }\n        } catch (error) {\n            console.error('‚ùå [Push] Device registration failed:', error);\n        }\n    }\n\n    /**\n     * Handle incoming notification\n     */\n    handleNotification(notification) {\n        const { title, body, data } = notification;\n\n        // Trigger listeners\n        this.listeners.forEach((callback) => {\n            callback({ type: 'notification', title, body, data });\n        });\n\n        // Show visual notification (if app is in background)\n        if (document.hidden && this.permission === 'granted') {\n            new Notification(title, {\n                body,\n                icon: '/logo192.png',\n                badge: '/badge.png',\n                tag: data?.messageId || 'default',\n                data\n            });\n        }\n    }\n\n    /**\n     * Handle notification action (user clicked)\n     */\n    handleNotificationAction(action) {\n        const { notification, actionId } = action;\n\n        this.listeners.forEach((callback) => {\n            callback({\n                type: 'action',\n                actionId,\n                notification\n            });\n        });\n\n        // Navigate to relevant page\n        if (notification.data?.roomId) {\n            window.location.href = `/#/room/${notification.data.roomId}`;\n        } else if (notification.data?.conversationId) {\n            window.location.href = `/#/dm/${notification.data.conversationId}`;\n        }\n    }\n\n    /**\n     * Subscribe to notification events\n     */\n    on(eventType, callback) {\n        const id = Math.random().toString(36).substr(2, 9);\n        this.listeners.set(id, callback);\n        return () => this.listeners.delete(id);\n    }\n\n    /**\n     * Send notification (for testing)\n     */\n    async sendTestNotification() {\n        try {\n            await this.fetchWithAuth(`${this.apiBaseUrl}/push/test/`, {\n                method: 'POST'\n            });\n        } catch (error) {\n            console.error('‚ùå [Push] Test failed:', error);\n        }\n    }\n\n    /**\n     * Unregister device\n     */\n    async unregister() {\n        if (this.deviceToken) {\n            try {\n                await this.fetchWithAuth(`${this.apiBaseUrl}/devices/${this.deviceToken}/`, {\n                    method: 'DELETE'\n                });\n            } catch (error) {\n                console.error('‚ùå [Push] Unregister failed:', error);\n            }\n        }\n    }\n}\n\nexport const pushNotificationManager = new PushNotificationManager();\n\nexport default pushNotificationManager;\n\n\n"],"file":"pushNotifications-BulFuBDa.js"}