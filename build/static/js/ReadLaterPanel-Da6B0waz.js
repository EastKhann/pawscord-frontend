import{r,b as a}from"./react-core-9vc7GIjk.js";import{bg as F,Z as L,b as M,bf as Q,aH as k,a as $,m as H}from"./icons-vendor-c3DBUQOi.js";import"./editor-vendor-DiU449Dh.js";function z({apiBaseUrl:l,fetchWithAuth:n}){const[p,N]=r.useState([]),[d,v]=r.useState([]),[c,f]=r.useState([]),[m,_]=r.useState(""),[j,i]=r.useState(!1),[g,y]=r.useState(""),[b,h]=r.useState("#5865f2"),[O,T]=r.useState(!1),[C,o]=r.useState(""),P=["#5865f2","#43b581","#f04747","#faa61a","#9b59b6","#3498db","#e91e63","#00bcd4","#ff9800","#4caf50"];r.useEffect(()=>{u(),x()},[]);const u=async()=>{T(!0);try{const e=await n(`${l}/api/messages/readlater/list/`);if(e.ok){const s=await e.json();N(s.bookmarks||[])}}catch(e){o("Failed to load bookmarks: "+e.message)}finally{T(!1)}},x=async()=>{try{const e=await n(`${l}/api/bookmarks/tags/list/`);if(e.ok){const s=await e.json();v(s.tags||[])}}catch(e){console.error("Error loading tags:",e)}},w=async()=>{if(!g.trim()){o("Tag name cannot be empty");return}try{const e=await n(`${l}/api/bookmarks/tags/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g,color:b})});if(e.ok){const s=await e.json();v([...d,s.tag]),y(""),h("#5865f2"),i(!1),o("")}else{const s=await e.json();o(s.error||"Failed to create tag")}}catch(e){o("Network error: "+e.message)}},J=async e=>{try{(await n(`${l}/api/messages/readlater/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(N(p.filter(t=>t.message_id!==e)),o(""))}catch(s){o("Failed to remove bookmark: "+s.message)}},R=async(e,s)=>{try{(await n(`${l}/api/bookmarks/tags/${s}/add/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(u(),o(""))}catch(t){o("Failed to add tag: "+t.message)}},D=async(e,s)=>{try{(await n(`${l}/api/bookmarks/tags/${s}/remove/`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(u(),o(""))}catch(t){o("Failed to remove tag: "+t.message)}},B=e=>{c.includes(e)?f(c.filter(s=>s!==e)):f([...c,e])},S=p.filter(e=>{const s=m===""||e.content.toLowerCase().includes(m.toLowerCase())||e.author.toLowerCase().includes(m.toLowerCase()),t=c.length===0||e.tags?.some(E=>c.includes(E.id));return s&&t});return a.createElement("div",{className:"readlater-panel"},a.createElement("div",{className:"readlater-header"},a.createElement("h2",null,a.createElement(F,null)," Read Later"),a.createElement("button",{className:"create-tag-btn",onClick:()=>i(!0)},a.createElement(L,null)," New Tag")),C&&a.createElement("div",{className:"rl-error"},C),a.createElement("div",{className:"readlater-controls"},a.createElement("div",{className:"search-box"},a.createElement(M,{className:"search-icon"}),a.createElement("input",{type:"text",placeholder:"Search bookmarks...",value:m,onChange:e=>_(e.target.value),className:"search-input"})),a.createElement("div",{className:"tag-filters"},a.createElement(Q,{className:"filter-icon"}),a.createElement("div",{className:"tag-filter-list"},d.map(e=>a.createElement("button",{key:e.id,className:`tag-filter ${c.includes(e.id)?"active":""}`,style:{borderColor:e.color},onClick:()=>B(e.id)},a.createElement(k,{style:{color:e.color}}),e.name))))),a.createElement("div",{className:"bookmarks-list"},O?a.createElement("div",{className:"rl-loading"},"Loading bookmarks..."):S.length===0?a.createElement("div",{className:"empty-state"},a.createElement(F,{className:"empty-icon"}),a.createElement("p",null,"No bookmarks found"),a.createElement("span",null,"Save messages with the bookmark button to read them later")):S.map((e,s)=>a.createElement("div",{key:s,className:"bookmark-item"},a.createElement("div",{className:"bookmark-header"},a.createElement("div",{className:"bookmark-author"},a.createElement("img",{src:e.author_avatar||"/default-avatar.png",alt:e.author,className:"author-avatar"}),a.createElement("span",{className:"author-name"},e.author)),a.createElement("div",{className:"bookmark-date"},new Date(e.saved_at).toLocaleDateString())),a.createElement("div",{className:"bookmark-content"},e.content),a.createElement("div",{className:"bookmark-footer"},a.createElement("div",{className:"bookmark-tags"},e.tags?.map(t=>a.createElement("span",{key:t.id,className:"bookmark-tag",style:{borderColor:t.color,color:t.color}},a.createElement(k,null),t.name,a.createElement($,{className:"remove-tag-icon",onClick:()=>D(e.message_id,t.id)}))),a.createElement("select",{className:"add-tag-select",onChange:t=>{t.target.value&&(R(e.message_id,parseInt(t.target.value)),t.target.value="")}},a.createElement("option",{value:""},"+ Add Tag"),d.filter(t=>!e.tags?.find(E=>E.id===t.id)).map(t=>a.createElement("option",{key:t.id,value:t.id},t.name)))),a.createElement("button",{className:"remove-bookmark-btn",onClick:()=>J(e.message_id)},a.createElement(H,null)," Remove"))))),j&&a.createElement("div",{className:"modal-overlay",onClick:()=>i(!1)},a.createElement("div",{className:"modal-content",onClick:e=>e.stopPropagation()},a.createElement("div",{className:"modal-header"},a.createElement("h3",null,a.createElement(k,null)," Create New Tag"),a.createElement("button",{className:"modal-close",onClick:()=>i(!1)},a.createElement($,null))),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"form-group"},a.createElement("label",null,"Tag Name"),a.createElement("input",{type:"text",className:"tag-input",placeholder:"Enter tag name...",value:g,onChange:e=>y(e.target.value),onKeyPress:e=>e.key==="Enter"&&w()})),a.createElement("div",{className:"form-group"},a.createElement("label",null,"Tag Color"),a.createElement("div",{className:"color-picker"},P.map(e=>a.createElement("button",{key:e,className:`color-option ${b===e?"selected":""}`,style:{backgroundColor:e},onClick:()=>h(e)})))),a.createElement("button",{className:"create-tag-submit",onClick:w},a.createElement(L,null)," Create Tag")))))}export{z as default};
