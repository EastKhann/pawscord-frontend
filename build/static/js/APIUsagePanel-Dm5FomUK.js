import{r as o,n as e}from"./react-core-zXIKm1Jm.js";import{R,a as k,p as _,A as y,D as z,d as u}from"./icons-vendor-BBdoVeJd.js";import{t as w}from"./index-BcyeUaJO.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const $=({fetchWithAuth:c,apiBaseUrl:x,onClose:p,username:a})=>{const[r,l]=o.useState(null),[m,j]=o.useState([]),[g,v]=o.useState([]),[b,f]=o.useState(!0),[h,S]=o.useState("24h"),[B,C]=o.useState(null);o.useEffect(()=>{L()},[h]);const L=async()=>{f(!0);try{const n=await(await c(`${x}/analytics/usage/?range=${h}`)).json();l(n.stats||{}),j(n.endpoints||[]),v(n.timeline||[])}catch(s){console.error("Failed to load API usage:",s),w.error("Failed to load analytics")}finally{f(!1)}},I=()=>{if(!r||!r.rate_limit)return{color:"#43b581",text:"Normal"};const n=(r.requests_made||0)/r.rate_limit*100;return n>=90?{color:"#f04747",text:"Critical"}:n>=70?{color:"#faa61a",text:"Warning"}:{color:"#43b581",text:"Normal"}},i=r||{requests_made:0,rate_limit:1e4,success_rate:0,avg_response_time:0,errors:0},d=I();return e.jsx("div",{style:t.overlay,onClick:p,children:e.jsxs("div",{style:t.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(R,{style:{fontSize:"24px",color:"#5865f2"}}),e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"API Usage Analytics"})]}),e.jsxs("div",{style:t.headerRight,children:[e.jsxs("select",{value:h,onChange:s=>S(s.target.value),style:t.timeRangeSelect,children:[e.jsx("option",{value:"24h",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"})]}),e.jsx("button",{onClick:p,style:t.closeBtn,children:e.jsx(k,{})})]})]}),e.jsx("div",{style:t.content,children:b?e.jsx("div",{style:t.loading,children:"Loading analytics..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(_,{style:{color:"#5865f2"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:(i.requests_made||0).toLocaleString()}),e.jsx("div",{style:t.statLabel,children:"Total Requests"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(y,{style:{color:"#43b581"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.success_rate?`${i.success_rate.toFixed(1)}%`:"0%"}),e.jsx("div",{style:t.statLabel,children:"Success Rate"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(z,{style:{color:"#faa61a"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.avg_response_time?`${i.avg_response_time}ms`:"0ms"}),e.jsx("div",{style:t.statLabel,children:"Avg Response Time"})]})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx("div",{style:t.statIcon,children:e.jsx(u,{style:{color:"#f04747"}})}),e.jsxs("div",{style:t.statInfo,children:[e.jsx("div",{style:t.statValue,children:i.errors||0}),e.jsx("div",{style:t.statLabel,children:"Errors"})]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Rate Limit Status"}),e.jsxs("div",{style:{...t.rateLimitCard,borderLeftColor:d.color},children:[e.jsxs("div",{style:t.rateLimitInfo,children:[e.jsxs("div",{style:t.rateLimitText,children:[i.requests_made||0," / ",i.rate_limit||1e4," requests used"]}),e.jsx("div",{style:{...t.rateLimitStatus,color:d.color},children:d.text})]}),e.jsx("div",{style:t.rateLimitBar,children:e.jsx("div",{style:{...t.rateLimitProgress,width:`${Math.min((i.requests_made||0)/(i.rate_limit||1e4)*100,100)}%`,backgroundColor:d.color}})}),i.reset_at&&e.jsxs("div",{style:t.rateLimitReset,children:["Resets in: ",T(i.reset_at)]})]})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Top Endpoints"}),e.jsx("div",{style:t.endpointsList,children:m.length===0?e.jsx("div",{style:t.empty,children:"No endpoint data"}):m.slice(0,10).map((s,n)=>e.jsxs("div",{style:t.endpointItem,onClick:()=>C(s),children:[e.jsxs("div",{style:t.endpointRank,children:["#",n+1]}),e.jsxs("div",{style:t.endpointDetails,children:[e.jsxs("div",{style:t.endpointPath,children:[e.jsx("span",{style:t.endpointMethod,children:s.method}),s.path]}),e.jsxs("div",{style:t.endpointStats,children:[e.jsxs("span",{children:[s.count," requests"]}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{children:[s.avg_time,"ms avg"]}),s.error_rate>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{style:{color:"#f04747"},children:[s.error_rate,"% errors"]})]})]})]}),e.jsx("div",{style:t.endpointBar,children:e.jsx("div",{style:{...t.endpointBarFill,width:`${s.count/m[0].count*100}%`,backgroundColor:s.error_rate>5?"#f04747":"#5865f2"}})})]},n))})]}),e.jsxs("div",{style:t.section,children:[e.jsx("h3",{style:t.sectionTitle,children:"Recent Activity"}),e.jsx("div",{style:t.timeline,children:g.length===0?e.jsx("div",{style:t.empty,children:"No recent activity"}):g.slice(0,20).map((s,n)=>e.jsxs("div",{style:t.timelineItem,children:[e.jsx("div",{style:{...t.timelineIcon,backgroundColor:s.status>=400?"#f04747":"#43b581"},children:s.status>=400?e.jsx(u,{}):e.jsx(y,{})}),e.jsxs("div",{style:t.timelineContent,children:[e.jsxs("div",{style:t.timelinePath,children:[e.jsx("span",{style:t.timelineMethod,children:s.method}),s.path]}),e.jsxs("div",{style:t.timelineMeta,children:[e.jsx("span",{style:{color:s.status>=400?"#f04747":"#43b581"},children:s.status}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsxs("span",{children:[s.response_time,"ms"]}),e.jsx("span",{style:{margin:"0 8px",color:"#444"},children:"•"}),e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString()})]})]})]},n))})]})]})})]})})},T=c=>{const x=new Date,a=new Date(c)-x;if(a<=0)return"Soon";const r=Math.floor(a/(1e3*60*60)),l=Math.floor(a%(1e3*60*60)/(1e3*60));return r>0?`${r}h ${l}m`:`${l}m`},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerRight:{display:"flex",alignItems:"center",gap:"12px"},timeRangeSelect:{padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px",cursor:"pointer"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},statCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",display:"flex",alignItems:"center",gap:"16px"},statIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},statInfo:{flex:1},statValue:{fontSize:"28px",fontWeight:"bold",marginBottom:"4px"},statLabel:{fontSize:"12px",color:"#99aab5",textTransform:"uppercase",letterSpacing:"1px"},section:{marginBottom:"32px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},rateLimitCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",borderLeft:"4px solid"},rateLimitInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},rateLimitText:{fontSize:"14px",fontWeight:"600"},rateLimitStatus:{fontSize:"14px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px"},rateLimitBar:{height:"8px",backgroundColor:"#202225",borderRadius:"4px",overflow:"hidden",marginBottom:"8px"},rateLimitProgress:{height:"100%",transition:"width 0.3s ease"},rateLimitReset:{fontSize:"12px",color:"#99aab5"},endpointsList:{display:"flex",flexDirection:"column",gap:"8px"},endpointItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},endpointRank:{fontSize:"20px",fontWeight:"bold",color:"#5865f2",minWidth:"40px"},endpointDetails:{flex:1},endpointPath:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",fontFamily:"monospace"},endpointMethod:{display:"inline-block",padding:"2px 8px",backgroundColor:"#5865f2",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",marginRight:"8px"},endpointStats:{fontSize:"12px",color:"#99aab5"},endpointBar:{width:"100px",height:"6px",backgroundColor:"#202225",borderRadius:"3px",overflow:"hidden"},endpointBarFill:{height:"100%",transition:"width 0.3s ease"},timeline:{display:"flex",flexDirection:"column",gap:"8px"},timelineItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px",display:"flex",alignItems:"center",gap:"12px"},timelineIcon:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},timelineContent:{flex:1},timelinePath:{fontSize:"14px",fontWeight:"600",fontFamily:"monospace",marginBottom:"4px"},timelineMethod:{display:"inline-block",padding:"2px 6px",backgroundColor:"#5865f2",borderRadius:"3px",fontSize:"10px",fontWeight:"bold",marginRight:"8px"},timelineMeta:{fontSize:"12px",color:"#99aab5"},empty:{textAlign:"center",padding:"40px",color:"#99aab5"}};export{$ as default};
