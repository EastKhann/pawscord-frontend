var K=Object.defineProperty;var s=(c,u)=>K(c,"name",{value:u,configurable:!0});import{r,j as e}from"./react-core-Djgtqrmb.js";import{a1 as F,a as P,ay as A,aC as C,z as y,d as L,V as G,cB as $,g as V,a5 as Z,aD as E,av as q,aF as J,a0 as Q,aA as W,B as X,f as I,au as ee}from"./icons-vendor-BW7dxHkX.js";import{y as p}from"./ui-vendor-IhB9Znpc.js";import{e as ae}from"./index-D_luy7FO.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";const me=s(({serverId:c,onClose:u})=>{const[k,m]=r.useState([]),[v,_]=r.useState(!0),[t,h]=r.useState({action_type:"all",moderator:"",target_user:"",date_from:"",date_to:""}),[g,M]=r.useState(!1),[N,B]=r.useState(null),[o,f]=r.useState(null),[j,d]=r.useState(1),[D,T]=r.useState(!0),x=localStorage.getItem("access_token");r.useEffect(()=>{w(),z()},[c,t,j]);const w=s(async()=>{_(!0);try{const a=new URLSearchParams({page:j,...Object.fromEntries(Object.entries(t).filter(([n,l])=>l&&l!=="all"))}),i=await fetch(`/api/servers/${c}/moderation/logs/?${a}`,{headers:{Authorization:`Bearer ${x}`}});if(i.ok){const n=await i.json();m(j===1?n.logs||[]:l=>[...l,...n.logs||[]]),T(n.has_more??!0)}else m([])}catch{m([])}_(!1)},"fetchLogs"),z=s(async()=>{try{const a=await fetch(`/api/servers/${c}/moderation/stats/`,{headers:{Authorization:`Bearer ${x}`}});a.ok?f(await a.json()||b):f(b)}catch{f(b)}},"fetchStats"),b={total_actions:0,this_week:0,bans:0,kicks:0,timeouts:0,warns:0,mutes:0,deletes:0,automod_actions:0,top_moderators:[]},U=s(a=>({ban:e.jsx(A,{className:"action-ban"}),kick:e.jsx(C,{className:"action-kick"}),timeout:e.jsx(y,{className:"action-timeout"}),mute:e.jsx(ee,{className:"action-mute"}),warn:e.jsx(L,{className:"action-warn"}),delete_messages:e.jsx(I,{className:"action-delete"}),automod:e.jsx(X,{className:"action-automod"})})[a]||e.jsx(W,{}),"getActionIcon"),O=s(a=>({ban:"Yasaklama",kick:"Sunucudan Atma",timeout:"Zaman Aşımı",mute:"Susturma",warn:"Uyarı",delete_messages:"Mesaj Silme",automod:"AutoMod"})[a]||a,"getActionLabel"),R=s(async a=>{if(await ae("Bu moderasyon eylemini geri almak istediğinizden emin misiniz?"))try{(await fetch(`/api/servers/${c}/moderation/logs/${a}/revert/`,{method:"POST",headers:{Authorization:`Bearer ${x}`}})).ok&&(p.success("Eylem geri alındı"),w())}catch{m(k.map(n=>n.id===a?{...n,reverted:!0}:n)),p.success("Eylem geri alındı")}},"handleRevertAction"),Y=s(async()=>{try{const a=await fetch(`/api/servers/${c}/moderation/logs/export/`,{headers:{Authorization:`Bearer ${x}`}});if(a.ok){const i=await a.blob(),n=window.URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.download=`moderation-logs-${new Date().toISOString().split("T")[0]}.csv`,l.click(),p.success("Loglar indirildi")}}catch{p.error("Dışa aktarma başarısız")}},"handleExport"),H=s(a=>new Date(a).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),"formatDate"),S=k;return e.jsx("div",{className:"moderation-logs-overlay",onClick:s(a=>a.target.className==="moderation-logs-overlay"&&u(),"onClick"),children:e.jsxs("div",{className:"moderation-logs-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(F,{})," Moderasyon Logları"]}),e.jsx("button",{className:"close-btn",onClick:u,children:e.jsx(P,{})})]}),o&&e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:o.total_actions}),e.jsx("span",{className:"stat-label",children:"Toplam"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:o.this_week}),e.jsx("span",{className:"stat-label",children:"Bu Hafta"})]}),e.jsxs("div",{className:"stat-item ban",children:[e.jsx(A,{}),e.jsx("span",{children:o.bans})]}),e.jsxs("div",{className:"stat-item kick",children:[e.jsx(C,{}),e.jsx("span",{children:o.kicks})]}),e.jsxs("div",{className:"stat-item timeout",children:[e.jsx(y,{}),e.jsx("span",{children:o.timeouts})]}),e.jsxs("div",{className:"stat-item warn",children:[e.jsx(L,{}),e.jsx("span",{children:o.warns})]})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filters-header",children:[e.jsxs("button",{className:"filter-toggle",onClick:s(()=>M(!g),"onClick"),children:[e.jsx(G,{})," Filtreler",g?e.jsx($,{}):e.jsx(V,{})]}),e.jsxs("button",{className:"export-btn",onClick:Y,children:[e.jsx(Z,{})," Dışa Aktar"]})]}),g&&e.jsxs("div",{className:"filters-content",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Eylem Türü"}),e.jsxs("select",{value:t.action_type,onChange:s(a=>{h({...t,action_type:a.target.value}),d(1)},"onChange"),children:[e.jsx("option",{value:"all",children:"Tümü"}),e.jsx("option",{value:"ban",children:"Yasaklama"}),e.jsx("option",{value:"kick",children:"Atma"}),e.jsx("option",{value:"timeout",children:"Zaman Aşımı"}),e.jsx("option",{value:"mute",children:"Susturma"}),e.jsx("option",{value:"warn",children:"Uyarı"}),e.jsx("option",{value:"delete_messages",children:"Mesaj Silme"}),e.jsx("option",{value:"automod",children:"AutoMod"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Moderatör"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:t.moderator,onChange:s(a=>{h({...t,moderator:a.target.value}),d(1)},"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Hedef Kullanıcı"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı adı",value:t.target_user,onChange:s(a=>{h({...t,target_user:a.target.value}),d(1)},"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Başlangıç"}),e.jsx("input",{type:"date",value:t.date_from,onChange:s(a=>{h({...t,date_from:a.target.value}),d(1)},"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Bitiş"}),e.jsx("input",{type:"date",value:t.date_to,onChange:s(a=>{h({...t,date_to:a.target.value}),d(1)},"onChange")})]})]})]}),e.jsx("div",{className:"panel-content",children:v&&j===1?e.jsx("div",{className:"loading",children:"Yükleniyor..."}):S.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(F,{}),e.jsx("p",{children:"Moderasyon logu bulunamadı"})]}):e.jsxs("div",{className:"logs-list",children:[S.map(a=>e.jsxs("div",{className:`log-item ${a.reverted?"reverted":""}`,children:[e.jsx("div",{className:"log-icon",children:U(a.action_type)}),e.jsxs("div",{className:"log-main",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("span",{className:`action-badge ${a.action_type}`,children:O(a.action_type)}),a.reverted&&e.jsxs("span",{className:"reverted-badge",children:[e.jsx(E,{})," Geri Alındı"]}),e.jsxs("span",{className:"log-time",children:[e.jsx(y,{})," ",H(a.created_at)]})]}),e.jsxs("div",{className:"log-users",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:a.moderator.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:a.moderator.username})]}),e.jsx("span",{className:"arrow",children:"→"}),e.jsxs("div",{className:"user-info target",children:[e.jsx("img",{src:a.target_user.avatar||"/default-avatar.png",alt:""}),e.jsx("span",{children:a.target_user.username})]})]}),e.jsxs("div",{className:"log-reason",children:[e.jsx(q,{})," ",a.reason]}),a.channel&&e.jsxs("div",{className:"log-channel",children:[e.jsx(J,{})," ",a.channel.name]}),N===a.id&&a.details&&Object.keys(a.details).length>0&&e.jsxs("div",{className:"log-details",children:[a.details.duration&&e.jsxs("span",{children:[e.jsx("strong",{children:"Süre:"})," ",a.details.duration]}),a.details.message_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Silinen Mesaj:"})," ",a.details.message_count]}),a.details.warning_count&&e.jsxs("span",{children:[e.jsx("strong",{children:"Toplam Uyarı:"})," ",a.details.warning_count]}),a.details.trigger&&e.jsxs("span",{children:[e.jsx("strong",{children:"Tetikleyici:"})," ",a.details.trigger]}),a.details.evidence&&e.jsxs("div",{className:"evidence",children:[e.jsx("strong",{children:"Kanıtlar:"}),e.jsx("ul",{children:a.details.evidence.map((i,n)=>e.jsx("li",{children:i},n))})]})]})]}),e.jsxs("div",{className:"log-actions",children:[Object.keys(a.details||{}).length>0&&e.jsx("button",{className:"detail-btn",onClick:s(()=>B(N===a.id?null:a.id),"onClick"),title:"Detaylar",children:N===a.id?e.jsx($,{}):e.jsx(Q,{})}),!a.reverted&&["ban","mute","timeout"].includes(a.action_type)&&e.jsx("button",{className:"revert-btn",onClick:s(()=>R(a.id),"onClick"),title:"Geri Al",children:e.jsx(E,{})})]})]},a.id)),D&&e.jsx("button",{className:"load-more-btn",onClick:s(()=>d(a=>a+1),"onClick"),disabled:v,children:v?"Yükleniyor...":"Daha Fazla Yükle"})]})})]})})},"ModerationLogsPanel");export{me as default};
