import{r,ch as n}from"./react-core-B6hadH-M.js";import{g as x,h as N}from"./index-D_6pZib5.js";const U=({serverId:i,onClose:p})=>{const[o,m]=r.useState([]),[h,E]=r.useState(!1),[s,u]=r.useState({name:"",channel_id:"",avatar_url:""}),[k,y]=r.useState([]),[f,$]=r.useState(!0),[W,R]=r.useState(null),[b,_]=r.useState([]),[S,g]=r.useState(null),c=x();r.useEffect(()=>{i&&(w(),C())},[i]);const w=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${c}/webhooks/server/${i}/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const a=await t.json();m(a.webhooks||[])}}catch(e){console.error("Error fetching webhooks:",e)}finally{$(!1)}},C=async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch(`${c}/servers/${i}/channels/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const a=await t.json();y(a.channels||[])}}catch(e){console.error("Error fetching channels:",e)}},B=async()=>{if(!s.name||!s.channel_id){n.error("âŒ Webhook adÄ± ve kanal seÃ§imi zorunludur");return}try{const e=localStorage.getItem("access_token"),t=await fetch(`${c}/webhooks/create/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:i,...s})});if(t.ok){const a=await t.json();m([...o,a.webhook]),u({name:"",channel_id:"",avatar_url:""}),E(!1),n.success("âœ… Webhook baÅŸarÄ±yla oluÅŸturuldu")}else n.error("âŒ Webhook oluÅŸturulamadÄ±")}catch(e){console.error("Error creating webhook:",e),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},T=async(e,t)=>{try{const a=localStorage.getItem("access_token"),l=await fetch(`${c}/webhooks/${e}/update/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(l.ok){const d=await l.json();m(o.map(v=>v.id===e?d.webhook:v)),R(null),n.success("âœ… Webhook gÃ¼ncellendi")}else n.error("âŒ Webhook gÃ¼ncellenemedi")}catch(a){console.error("Error updating webhook:",a),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},z=async e=>{if(await N("Bu webhook'u silmek istediÄŸinizden emin misiniz?"))try{const t=localStorage.getItem("access_token");(await fetch(`${c}/webhooks/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(m(o.filter(l=>l.id!==e)),n.success("âœ… Webhook silindi")):n.error("âŒ Webhook silinemedi")}catch(t){console.error("Error deleting webhook:",t),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},L=async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${c}/webhooks/${e}/test/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok?n.success("âœ… Test mesajÄ± gÃ¶nderildi"):n.error("âŒ Test mesajÄ± gÃ¶nderilemedi")}catch(t){console.error("Error testing webhook:",t),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},A=async e=>{if(await N("Webhook tokenini yenilemek istediÄŸinizden emin misiniz? Eski token geÃ§ersiz hale gelecek."))try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/webhooks/${e}/regenerate-token/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(a.ok){const l=await a.json();m(o.map(d=>d.id===e?{...d,token:l.token}:d)),n.success("âœ… Token yenilendi")}else n.error("âŒ Token yenilenemedi")}catch(t){console.error("Error regenerating token:",t),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},j=async e=>{try{const t=localStorage.getItem("access_token"),a=await fetch(`${c}/webhooks/${e}/logs/`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const l=await a.json();_(l.logs||[]),g(e)}}catch(t){console.error("Error fetching logs:",t),n.error("âŒ Loglar yÃ¼klenemedi")}},O=e=>{const t=`${c}/webhooks/${e.id}/${e.token}`;navigator.clipboard.writeText(t),n.success("âœ… Webhook URL kopyalandÄ±")};return f?React.createElement("div",{className:"webhooks-overlay"},React.createElement("div",{className:"webhooks-panel"},React.createElement("div",{className:"loading-state"},React.createElement("div",{className:"spinner"}),React.createElement("p",null,"Webhooklar yÃ¼kleniyor...")))):React.createElement("div",{className:"webhooks-overlay",onClick:p},React.createElement("div",{className:"webhooks-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"webhooks-header"},React.createElement("h2",null,"ğŸ”— Webhook YÃ¶netimi"),React.createElement("button",{className:"close-btn",onClick:p},"Ã—")),React.createElement("div",{className:"webhooks-content"},!h&&React.createElement("button",{className:"create-webhook-btn",onClick:()=>E(!0)},"â• Yeni Webhook OluÅŸtur"),h&&React.createElement("div",{className:"create-webhook-form"},React.createElement("h3",null,"Yeni Webhook"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Webhook AdÄ± *"),React.createElement("input",{type:"text",placeholder:"Ã–rn: GitHub Bot",value:s.name,onChange:e=>u({...s,name:e.target.value})})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Kanal *"),React.createElement("select",{value:s.channel_id,onChange:e=>u({...s,channel_id:e.target.value})},React.createElement("option",{value:""},"Kanal seÃ§in..."),k.map(e=>React.createElement("option",{key:e.id,value:e.id},"#",e.name)))),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Avatar URL (Opsiyonel)"),React.createElement("input",{type:"text",placeholder:"https://example.com/avatar.png",value:s.avatar_url,onChange:e=>u({...s,avatar_url:e.target.value})})),React.createElement("div",{className:"form-actions"},React.createElement("button",{className:"cancel-btn",onClick:()=>E(!1)},"Ä°ptal"),React.createElement("button",{className:"submit-btn",onClick:B},"OluÅŸtur"))),o.length>0?React.createElement("div",{className:"webhooks-list"},o.map(e=>React.createElement("div",{key:e.id,className:"webhook-card"},W===e.id?React.createElement("div",{className:"edit-webhook-form"},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Webhook AdÄ±"),React.createElement("input",{type:"text",defaultValue:e.name,id:`edit-name-${e.id}`})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Kanal"),React.createElement("select",{defaultValue:e.channel_id,id:`edit-channel-${e.id}`},k.map(t=>React.createElement("option",{key:t.id,value:t.id},"#",t.name)))),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Avatar URL"),React.createElement("input",{type:"text",defaultValue:e.avatar_url||"",id:`edit-avatar-${e.id}`})),React.createElement("div",{className:"form-actions"},React.createElement("button",{className:"cancel-btn",onClick:()=>R(null)},"Ä°ptal"),React.createElement("button",{className:"submit-btn",onClick:()=>{const t=document.getElementById(`edit-name-${e.id}`).value,a=document.getElementById(`edit-channel-${e.id}`).value,l=document.getElementById(`edit-avatar-${e.id}`).value;T(e.id,{name:t,channel_id:a,avatar_url:l})}},"Kaydet"))):React.createElement(React.Fragment,null,React.createElement("div",{className:"webhook-info"},React.createElement("div",{className:"webhook-avatar"},e.avatar_url?React.createElement("img",{src:e.avatar_url,alt:e.name}):React.createElement("div",{className:"default-avatar"},"ğŸ”—")),React.createElement("div",{className:"webhook-details"},React.createElement("h4",null,e.name),React.createElement("p",null,"#",k.find(t=>t.id===e.channel_id)?.name||"Bilinmeyen Kanal"),React.createElement("span",{className:"webhook-id"},"ID: ",e.id))),React.createElement("div",{className:"webhook-url"},React.createElement("label",null,"Webhook URL:"),React.createElement("div",{className:"url-display"},React.createElement("code",null,`${c}/webhooks/${e.id}/${e.token}`),React.createElement("button",{className:"copy-btn",onClick:()=>O(e),title:"URL'yi kopyala"},"ğŸ“‹"))),React.createElement("div",{className:"webhook-actions"},React.createElement("button",{className:"action-btn test-btn",onClick:()=>L(e.id),title:"Test mesajÄ± gÃ¶nder"},"ğŸ§ª Test"),React.createElement("button",{className:"action-btn logs-btn",onClick:()=>j(e.id),title:"LoglarÄ± gÃ¶rÃ¼ntÃ¼le"},"ğŸ“Š Loglar"),React.createElement("button",{className:"action-btn edit-btn",onClick:()=>R(e.id),title:"DÃ¼zenle"},"âœï¸"),React.createElement("button",{className:"action-btn regenerate-btn",onClick:()=>A(e.id),title:"Token yenile"},"ğŸ”„"),React.createElement("button",{className:"action-btn delete-btn",onClick:()=>z(e.id),title:"Sil"},"ğŸ—‘ï¸")),React.createElement("div",{className:"webhook-stats"},React.createElement("div",{className:"stat"},React.createElement("span",{className:"stat-label"},"Toplam Ã‡aÄŸrÄ±:"),React.createElement("span",{className:"stat-value"},e.total_calls||0)),React.createElement("div",{className:"stat"},React.createElement("span",{className:"stat-label"},"BaÅŸarÄ±lÄ±:"),React.createElement("span",{className:"stat-value success"},e.successful_calls||0)),React.createElement("div",{className:"stat"},React.createElement("span",{className:"stat-label"},"BaÅŸarÄ±sÄ±z:"),React.createElement("span",{className:"stat-value error"},e.failed_calls||0)),React.createElement("div",{className:"stat"},React.createElement("span",{className:"stat-label"},"Son Ã‡aÄŸrÄ±:"),React.createElement("span",{className:"stat-value"},e.last_call?new Date(e.last_call).toLocaleString("tr-TR"):"HiÃ§"))))))):!h&&React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-icon"},"ğŸ”—"),React.createElement("h3",null,"HenÃ¼z webhook yok"),React.createElement("p",null,"DÄ±ÅŸ uygulamalardan mesaj gÃ¶ndermek iÃ§in webhook oluÅŸturun")),S&&React.createElement("div",{className:"logs-modal",onClick:()=>g(null)},React.createElement("div",{className:"logs-content",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"logs-header"},React.createElement("h3",null,"ğŸ“Š Webhook LoglarÄ±"),React.createElement("button",{className:"close-btn",onClick:()=>g(null)},"Ã—")),React.createElement("div",{className:"logs-list"},b.length>0?b.map((e,t)=>React.createElement("div",{key:t,className:`log-item ${e.status}`},React.createElement("div",{className:"log-time"},new Date(e.timestamp).toLocaleString("tr-TR")),React.createElement("div",{className:"log-status"},e.status==="success"?"âœ…":"âŒ"," ",e.status),React.createElement("div",{className:"log-message"},e.message),e.error&&React.createElement("div",{className:"log-error"},"Hata: ",e.error))):React.createElement("p",{className:"empty-state"},"HenÃ¼z log kaydÄ± yok")))))))};export{U as default};
