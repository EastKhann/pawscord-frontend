import{r,n as o}from"./react-core-BMiyQWF6.js";import{p as P,t as U,b4 as I,an as H,aK as V,aX as W}from"./icons-vendor-GUGjkvMm.js";import{t as h}from"./index-Tex9oDNg.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const ne=({roomId:m,userId:y,username:X,apiBaseUrl:x,fetchWithAuth:f,websocket:c,onClose:Y})=>{const[d,S]=r.useState(`// Start coding...
`),[l,b]=r.useState("javascript"),[j,u]=r.useState(""),[k,v]=r.useState([]),[E,w]=r.useState(!1),[R,C]=r.useState(!1),_=r.useRef(null),g=r.useRef(null),p=r.useRef(new Map);r.useEffect(()=>(L(),B(),M(),()=>{K()}),[]);const L=async()=>{try{setMonacoLoaded(!1)}catch{}},B=()=>{c&&c.addEventListener("message",e=>{const t=JSON.parse(e.data);switch(t.type){case"code_update":D(t);break;case"cursor_update":O(t);break;case"collaborator_joined":$(t);break;case"collaborator_left":z(t);break}})},D=e=>{if(e.user_id===y)return;const t=window.monacoEditor;t&&t.setValue(e.code)},O=e=>{if(e.user_id===y)return;const t=window.monacoEditor,a=g.current;if(!t||!a)return;const s=p.current.get(e.user_id);s&&t.deltaDecorations(s,[]);const i=t.deltaDecorations([],[{range:new a.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);p.current.set(e.user_id,i)},$=e=>{v(t=>[...t,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}])},z=e=>{v(a=>a.filter(s=>s.id!==e.user_id));const t=p.current.get(e.user_id);t&&window.monacoEditor&&window.monacoEditor.deltaDecorations(t,[]),p.current.delete(e.user_id)},M=async()=>{try{const e=await f(`${x}/code-editor/load/?room_id=${m}`);if(e.ok){const t=await e.json();t.code&&(S(t.code),b(t.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(t.code),window.monacoEditor.setLanguage(t.language||"javascript")))}}catch{}},N=async()=>{w(!0);try{(await f(`${x}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:m,code:d,language:l})})).ok&&h.success("✅ Kod kaydedildi!")}catch{h.error("❌ Kaydetme başarısız")}finally{w(!1)}},T=async()=>{C(!0),u("Çalıştırılıyor...");try{const e=await f(`${x}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,language:l})});if(e.ok){const t=await e.json();u(t.output||"No output")}else{const t=await e.json();u(`Error: ${t.error||"Execution failed"}`)}}catch(e){u(`Error: ${e.message}`)}finally{C(!1)}},F=()=>{navigator.clipboard.writeText(d),h.success("✅ Kod kopyalandı!")},J=()=>{const t={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"}[l]||"txt",a=new Blob([d],{type:"text/plain"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`code.${t}`,i.click(),URL.revokeObjectURL(s)},K=()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),c&&c.close()};return o.jsxs("div",{style:n.container,children:[o.jsxs("div",{style:n.header,children:[o.jsxs("div",{style:n.headerLeft,children:[o.jsx(P,{style:n.headerIcon}),o.jsx("h2",{style:n.title,children:"Code Editor"}),o.jsxs("select",{value:l,onChange:e=>{b(e.target.value),window.monacoEditor&&g.current&&g.current.editor.setModelLanguage(window.monacoEditor.getModel(),e.target.value)},style:n.languageSelect,children:[o.jsx("option",{value:"javascript",children:"JavaScript"}),o.jsx("option",{value:"typescript",children:"TypeScript"}),o.jsx("option",{value:"python",children:"Python"}),o.jsx("option",{value:"java",children:"Java"}),o.jsx("option",{value:"cpp",children:"C++"}),o.jsx("option",{value:"html",children:"HTML"}),o.jsx("option",{value:"css",children:"CSS"})]})]}),o.jsxs("div",{style:n.headerRight,children:[o.jsxs("div",{style:n.collaborators,children:[o.jsx(U,{style:{marginRight:"6px"}}),o.jsx("span",{children:k.length+1})]}),o.jsx("button",{onClick:F,style:n.actionButton,title:"Kopyala",children:o.jsx(I,{})}),o.jsx("button",{onClick:J,style:n.actionButton,title:"İndir",children:o.jsx(H,{})}),o.jsx("button",{onClick:N,disabled:E,style:{...n.actionButton,...n.saveButton},title:"Kaydet",children:o.jsx(V,{})}),o.jsx("button",{onClick:T,disabled:R,style:{...n.actionButton,...n.runButton},title:"Çalıştır",children:o.jsx(W,{})})]})]}),o.jsx("div",{style:n.editorContainer,children:o.jsx("div",{ref:_,style:n.editor})}),j&&o.jsxs("div",{style:n.outputPanel,children:[o.jsx("div",{style:n.outputHeader,children:o.jsx("span",{children:"Output"})}),o.jsx("pre",{style:n.outputContent,children:j})]})]})},n={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}};export{ne as default};
