import{r as d,d as e}from"./react-core-DrOm_csO.js";const O=({serverId:i,onClose:b})=>{const[n,u]=d.useState([]),[k,v]=d.useState(!0),[C,h]=d.useState(!1),[o,c]=d.useState(null),[E,f]=d.useState(null),[r,p]=d.useState({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0}),N=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}];d.useEffect(()=>{y()},[i]);const y=async()=>{try{v(!0);const a=localStorage.getItem("access_token"),t=await fetch(`/api/roles/${i}/list/`,{headers:{Authorization:`Bearer ${a}`}});if(t.ok){const l=await t.json();u(l.roles||[])}else console.error("Failed to fetch roles")}catch(a){console.error("Error fetching roles:",a)}finally{v(!1)}},R=async()=>{if(!r.name.trim()){console.log("âš ï¸ Role name required");return}try{const a=localStorage.getItem("access_token"),t=await fetch(`/api/roles/${i}/create/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(t.ok){const l=await t.json();console.log("âœ… Role created successfully"),u([...n,l.role]),h(!1),p({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0})}else console.error("âŒ Failed to create role")}catch(a){console.error("Error creating role:",a)}},w=async(a,t)=>{try{const l=localStorage.getItem("access_token"),s=await fetch(`/api/roles/${i}/${a}/update/`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok){const g=await s.json();console.log("âœ… Role updated"),u(n.map(m=>m.id===a?g.role:m)),c(null)}else console.error("âŒ Failed to update role")}catch(l){console.error("Error updating role:",l)}},S=async a=>{if(window.confirm("Are you sure you want to delete this role?"))try{const t=localStorage.getItem("access_token");(await fetch(`/api/roles/${i}/${a}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(console.log("âœ… Role deleted"),u(n.filter(s=>s.id!==a))):console.error("âŒ Failed to delete role")}catch(t){console.error("Error deleting role:",t)}},x=async a=>{try{const t=localStorage.getItem("access_token");(await fetch(`/api/roles/${i}/reorder/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({order:a})})).ok?(console.log("âœ… Roles reordered"),y()):console.error("âŒ Failed to reorder roles")}catch(t){console.error("Error reordering roles:",t)}},$=(a,t)=>{f(t),a.dataTransfer.effectAllowed="move"},D=a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},T=(a,t)=>{if(a.preventDefault(),!E||E.id===t.id)return;const l=n.findIndex(m=>m.id===E.id),s=n.findIndex(m=>m.id===t.id),g=[...n];g.splice(l,1),g.splice(s,0,E),u(g),x(g.map(m=>m.id)),f(null)},A=async a=>{try{const t=localStorage.getItem("access_token"),l=await fetch(`/api/roles/${i}/${a}/copy/`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(l.ok){const s=await l.json();console.log("âœ… Role copied"),u([...n,s.role])}else console.error("âŒ Failed to copy role")}catch(t){console.error("Error copying role:",t)}};return k?e.createElement("div",{className:"roles-manager-overlay"},e.createElement("div",{className:"roles-manager-modal"},e.createElement("div",{className:"loading-spinner"},"Loading roles..."))):e.createElement("div",{className:"roles-manager-overlay",onClick:b},e.createElement("div",{className:"roles-manager-modal",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"roles-manager-header"},e.createElement("h2",null,"ðŸŽ­ Server Roles"),e.createElement("button",{className:"close-btn",onClick:b},"âœ•")),e.createElement("div",{className:"roles-manager-content"},e.createElement("div",{className:"roles-actions"},e.createElement("button",{className:"create-role-btn",onClick:()=>h(!0)},"âž• Create Role"),e.createElement("div",{className:"roles-info"},e.createElement("span",null,n.length," roles"),e.createElement("span",{className:"info-tip"},"ðŸ’¡ Drag to reorder hierarchy"))),e.createElement("div",{className:"roles-list"},n.length===0?e.createElement("div",{className:"empty-state"},e.createElement("div",{className:"empty-icon"},"ðŸŽ­"),e.createElement("h3",null,"No Roles Yet"),e.createElement("p",null,"Create roles to organize your server members")):n.map(a=>e.createElement("div",{key:a.id,className:`role-card ${E?.id===a.id?"dragging":""}`,draggable:!0,onDragStart:t=>$(t,a),onDragOver:D,onDrop:t=>T(t,a)},e.createElement("div",{className:"role-drag-handle"},"â˜°"),e.createElement("div",{className:"role-color-badge",style:{backgroundColor:a.color}}),e.createElement("div",{className:"role-info"},e.createElement("div",{className:"role-name",style:{color:a.color}},a.name),e.createElement("div",{className:"role-meta"},e.createElement("span",{className:"role-members"},"ðŸ‘¥ ",a.member_count||0," members"),a.hoist&&e.createElement("span",{className:"role-badge"},"ðŸ“Œ Hoisted"),a.mentionable&&e.createElement("span",{className:"role-badge"},"@ Mentionable"))),e.createElement("div",{className:"role-actions"},e.createElement("button",{className:"role-action-btn edit",onClick:()=>c(a),title:"Edit"},"âœï¸"),e.createElement("button",{className:"role-action-btn copy",onClick:()=>A(a.id),title:"Copy"},"ðŸ“‹"),e.createElement("button",{className:"role-action-btn delete",onClick:()=>S(a.id),title:"Delete"},"ðŸ—‘ï¸")))))),C&&e.createElement("div",{className:"role-modal-overlay",onClick:()=>h(!1)},e.createElement("div",{className:"role-modal",onClick:a=>a.stopPropagation()},e.createElement("h3",null,"Create New Role"),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Role Name"),e.createElement("input",{type:"text",value:r.name,onChange:a=>p({...r,name:a.target.value}),placeholder:"Enter role name...",maxLength:32})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Role Color"),e.createElement("div",{className:"color-picker"},N.map(a=>e.createElement("button",{key:a.value,className:`color-preset ${r.color===a.value?"active":""}`,style:{backgroundColor:a.value},onClick:()=>p({...r,color:a.value}),title:a.name})),e.createElement("input",{type:"color",value:r.color,onChange:a=>p({...r,color:a.target.value}),className:"color-input"}))),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:r.hoist,onChange:a=>p({...r,hoist:a.target.checked})}),e.createElement("span",null,"Display role members separately from online members"))),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:r.mentionable,onChange:a=>p({...r,mentionable:a.target.checked})}),e.createElement("span",null,"Allow anyone to @mention this role"))),e.createElement("div",{className:"modal-actions"},e.createElement("button",{className:"cancel-btn",onClick:()=>h(!1)},"Cancel"),e.createElement("button",{className:"create-btn",onClick:R},"Create Role")))),o&&e.createElement("div",{className:"role-modal-overlay",onClick:()=>c(null)},e.createElement("div",{className:"role-modal",onClick:a=>a.stopPropagation()},e.createElement("h3",null,"Edit Role"),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Role Name"),e.createElement("input",{type:"text",value:o.name,onChange:a=>c({...o,name:a.target.value}),placeholder:"Enter role name...",maxLength:32})),e.createElement("div",{className:"form-group"},e.createElement("label",null,"Role Color"),e.createElement("div",{className:"color-picker"},N.map(a=>e.createElement("button",{key:a.value,className:`color-preset ${o.color===a.value?"active":""}`,style:{backgroundColor:a.value},onClick:()=>c({...o,color:a.value}),title:a.name})),e.createElement("input",{type:"color",value:o.color,onChange:a=>c({...o,color:a.target.value}),className:"color-input"}))),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:o.hoist,onChange:a=>c({...o,hoist:a.target.checked})}),e.createElement("span",null,"Display role members separately"))),e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:o.mentionable,onChange:a=>c({...o,mentionable:a.target.checked})}),e.createElement("span",null,"Allow anyone to @mention this role"))),e.createElement("div",{className:"modal-actions"},e.createElement("button",{className:"cancel-btn",onClick:()=>c(null)},"Cancel"),e.createElement("button",{className:"save-btn",onClick:()=>w(o.id,o)},"Save Changes"))))))};export{O as default};
