var L=Object.defineProperty;var t=(h,o)=>L(h,"name",{value:o,configurable:!0});import{r as n,j as e}from"./react-core-Djgtqrmb.js";import{t as m,a as E,V as R,C as _,bv as y}from"./icons-vendor-BW7dxHkX.js";import{t as x}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const V=t(({serverId:h,channelId:o,onClose:j,onSelectMessage:v})=>{const[r,N]=n.useState(""),[d,F]=n.useState([]),[u,k]=n.useState(!1),[s,i]=n.useState({author:"",dateFrom:"",dateTo:"",hasAttachment:!1,hasLink:!1}),[p,C]=n.useState(!1),c=n.useRef(null);n.useEffect(()=>(r.length>=3&&(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{b()},500)),()=>{c.current&&clearTimeout(c.current)}),[r,s]);const b=t(async()=>{if(!r.trim()){x.error("âŒ Arama terimi girin");return}k(!0);try{const a=new URLSearchParams({q:r,...h&&{server:h},...o&&{channel:o},...s.author&&{author:s.author},...s.dateFrom&&{date_from:s.dateFrom},...s.dateTo&&{date_to:s.dateTo},...s.hasAttachment&&{has_attachment:!0},...s.hasLink&&{has_link:!0}}),l=await fetch(`/api/messages/search/?${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(l.ok){const g=await l.json();F(g.results),g.results.length===0&&x.info("â„¹ï¸ SonuÃ§ bulunamadÄ±")}else x.error("âŒ Arama hatasÄ±")}catch{x.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{k(!1)}},"searchMessages"),S=t((a,l)=>l?a.split(new RegExp(`(${l})`,"gi")).map((f,A)=>f.toLowerCase()===l.toLowerCase()?e.jsx("mark",{children:f},A):f):a,"highlightText"),T=t(a=>new Date(a).toLocaleString("tr-TR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),"formatDate"),w=t(a=>{v&&v(a),j()},"handleMessageClick");return e.jsx("div",{className:"message-search-panel-overlay",onClick:j,children:e.jsxs("div",{className:"message-search-panel",onClick:t(a=>a.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"search-header",children:[e.jsx(m,{className:"header-icon"}),e.jsx("h2",{children:"Mesaj Ara"}),e.jsx("button",{className:"close-btn",onClick:j,children:"Ã—"})]}),e.jsxs("div",{className:"search-input-container",children:[e.jsx(m,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Mesaj ara...",value:r,onChange:t(a=>N(a.target.value),"onChange"),onKeyPress:t(a=>a.key==="Enter"&&b(),"onKeyPress"),autoFocus:!0}),r&&e.jsx("button",{className:"clear-btn",onClick:t(()=>N(""),"onClick"),children:e.jsx(E,{})}),e.jsx("button",{className:`filter-toggle-btn ${p?"active":""}`,onClick:t(()=>C(!p),"onClick"),title:"Filtreler",children:e.jsx(R,{})})]}),p&&e.jsxs("div",{className:"filters-section",children:[e.jsx("div",{className:"filter-row",children:e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(_,{})," KullanÄ±cÄ±"]}),e.jsx("input",{type:"text",placeholder:"@kullanÄ±cÄ±adÄ±",value:s.author,onChange:t(a=>i({...s,author:a.target.value}),"onChange")})]})}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(y,{})," BaÅŸlangÄ±Ã§"]}),e.jsx("input",{type:"date",value:s.dateFrom,onChange:t(a=>i({...s,dateFrom:a.target.value}),"onChange")})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[e.jsx(y,{})," BitiÅŸ"]}),e.jsx("input",{type:"date",value:s.dateTo,onChange:t(a=>i({...s,dateTo:a.target.value}),"onChange")})]})]}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasAttachment,onChange:t(a=>i({...s,hasAttachment:a.target.checked}),"onChange")}),e.jsx("span",{children:"Ekli dosya iÃ§eren"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasLink,onChange:t(a=>i({...s,hasLink:a.target.checked}),"onChange")}),e.jsx("span",{children:"Link iÃ§eren"})]})]})]}),e.jsxs("div",{className:"search-results",children:[u&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"AranÄ±yor..."})]}),!u&&d.length===0&&r&&e.jsxs("div",{className:"empty-state",children:[e.jsx(m,{size:48}),e.jsx("h3",{children:"SonuÃ§ BulunamadÄ±"}),e.jsxs("p",{children:['"',r,'" iÃ§in mesaj bulunamadÄ±']})]}),!u&&d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"results-count",children:[d.length," sonuÃ§ bulundu"]}),e.jsx("div",{className:"results-list",children:d.map(a=>e.jsxs("div",{className:"result-item",onClick:t(()=>w(a),"onClick"),children:[e.jsxs("div",{className:"result-header",children:[e.jsx("img",{src:a.author.avatar||"/default-avatar.png",alt:a.author.username,className:"author-avatar"}),e.jsxs("div",{className:"author-info",children:[e.jsx("span",{className:"author-name",children:a.author.username}),e.jsx("span",{className:"message-date",children:T(a.created_at)})]}),a.channel&&e.jsx("span",{className:"channel-tag",children:a.channel.name})]}),e.jsx("div",{className:"message-content",children:S(a.content,r)}),a.attachments&&a.attachments.length>0&&e.jsxs("div",{className:"message-attachments",children:["ğŸ“ ",a.attachments.length," dosya"]})]},a.id))})]}),!u&&!r&&e.jsxs("div",{className:"empty-state",children:[e.jsx(m,{size:48}),e.jsx("h3",{children:"Mesaj Ara"}),e.jsx("p",{children:"Sunucudaki tÃ¼m mesajlarÄ± arayÄ±n"}),e.jsxs("ul",{className:"search-tips",children:[e.jsx("li",{children:"En az 3 karakter girin"}),e.jsx("li",{children:"Filtreleri kullanarak sonuÃ§larÄ± daraltÄ±n"}),e.jsx("li",{children:"KullanÄ±cÄ±ya gÃ¶re filtreleyin"}),e.jsx("li",{children:"Tarih aralÄ±ÄŸÄ± belirleyin"})]})]})]})]})})},"MessageSearchPanel");export{V as default};
