var q=Object.defineProperty;var c=(i,S)=>q(i,"name",{value:S,configurable:!0});import{a as X,r as n,j as t}from"./react-core-Djgtqrmb.js";import{aM as _,aN as G,a5 as J}from"./icons-vendor-BMXAt4pj.js";const K=c(({audioUrl:i,duration:S,onDownload:T,messageId:E,fetchWithAuth:P,apiBaseUrl:g})=>{const[h,R]=n.useState(!1),[M,k]=n.useState(0),[y,$]=n.useState(S||0),[L,B]=n.useState([]),[W,b]=n.useState(!1),[l,w]=n.useState(null),[x,z]=n.useState(!1),[o,F]=n.useState(i),[v,I]=n.useState(!1),p=n.useRef(null),j=n.useRef(null);n.useEffect(()=>{},[i,o,v,g]),n.useEffect(()=>{i&&i!==o&&!v&&(F(i),I(!1),b(!1))},[i]);const H=c(async()=>{if(!(x||l)){z(!0);try{const e=await P(`${g}/messages/${E}/transcribe/`,{method:"POST"});if(e.ok){const r=await e.json();w(r.transcription||"Ã‡eviri yapÄ±lamadÄ±")}else w("âŒ Ã‡eviri baÅŸarÄ±sÄ±z")}catch{w("âŒ Hata oluÅŸtu")}finally{z(!1)}}},"handleTranscribe");n.useEffect(()=>{const e=p.current;if(!e)return;const r=c(()=>{$(e.duration),N(),b(!1)},"handleLoadedMetadata"),a=c(d=>{const C=e.error;if(C&&C.code,C&&C.message,!v&&o){let m=null;if(o.includes(".r2.dev/"))m=o.split(".r2.dev/")[1];else if(o.includes("r2.dev/")){const u=o.split("r2.dev/");m=u[u.length-1]}else if(o.includes("/attachments/")){const u=o.split("/attachments/");m="attachments/"+u[u.length-1]}if(m){const u=`${g||window.location.origin}/api/voice-proxy/${m}`;F(u),I(!0),b(!1);return}}b(!0)},"handleError"),f=c(()=>{},"handleCanPlay");return e.addEventListener("loadedmetadata",r),e.addEventListener("error",a),e.addEventListener("canplay",f),()=>{e.removeEventListener("loadedmetadata",r),e.removeEventListener("error",a),e.removeEventListener("canplay",f)}},[o,v,g]);const N=n.useCallback(()=>{const r=[];for(let a=0;a<40;a++){const f=Math.random()*.5+.3,d=Math.sin(a/5)*.2;r.push(Math.max(.2,Math.min(1,f+d)))}B(r)},[]),O=n.useCallback(()=>{const e=p.current;e&&(h?(e.pause(),cancelAnimationFrame(j.current)):(e.play(),A()),R(!h))},[h]),A=n.useCallback(()=>{const e=p.current;e&&(k(e.currentTime),e.paused||(j.current=requestAnimationFrame(A)))},[]),V=n.useCallback(e=>{const r=p.current;if(!r)return;const a=e.currentTarget.getBoundingClientRect(),d=(e.clientX-a.left)/a.width;r.currentTime=d*y,k(r.currentTime)},[y]);n.useEffect(()=>{const e=p.current;if(!e)return;const r=c(()=>{R(!1),k(0),cancelAnimationFrame(j.current)},"handleEnded");return e.addEventListener("ended",r),()=>{e.removeEventListener("ended",r),cancelAnimationFrame(j.current)}},[]);const D=c(e=>{const r=Math.floor(e/60),a=Math.floor(e%60);return`${r}:${a.toString().padStart(2,"0")}`},"formatTime");return t.jsxs("div",{style:s.container,children:[W?t.jsxs("div",{style:s.errorContainer,children:[t.jsx("div",{style:s.errorIcon,children:"ðŸ”‡"}),t.jsx("div",{style:s.errorText,children:"Ses dosyasÄ± bulunamadÄ± (eski mesaj)"}),t.jsxs("div",{style:{fontSize:"10px",color:"#72767d",marginTop:"4px",wordBreak:"break-all"},children:[i?.substring(0,80),"..."]})]}):t.jsxs(t.Fragment,{children:[t.jsx("audio",{ref:p,src:o,preload:"metadata",crossOrigin:"anonymous"}),t.jsx("button",{onClick:O,style:s.playButton,children:h?t.jsx(_,{}):t.jsx(G,{style:{marginLeft:"2px"}})}),t.jsxs("div",{style:s.waveformContainer,onClick:V,children:[t.jsx("div",{style:s.waveform,children:L.map((e,r)=>{const a=M/y,d=r/L.length<=a;return t.jsx("div",{style:{...s.waveBar,height:`${e*100}%`,backgroundColor:d?"#5865f2":"#4f545c",opacity:d?1:.5}},r)})}),t.jsxs("div",{style:s.timeDisplay,children:[t.jsx("span",{children:D(M)}),t.jsxs("span",{style:{color:"#72767d"},children:[" / ",D(y)]})]})]}),T&&t.jsx("button",{onClick:T,style:s.downloadButton,title:"Ä°ndir",children:t.jsx(J,{})}),E&&P&&t.jsx("button",{onClick:H,disabled:x||!!l,style:{...s.downloadButton,backgroundColor:l?"rgba(67, 181, 129, 0.1)":"transparent",color:x?"#faa61a":l?"#43b581":"#b9bbbe",cursor:x||l?"default":"pointer"},title:l?"Ã‡evrildi":"Metne Ã‡evir",children:x?"â³":l?"âœ…":"ðŸ“"})]}),l&&t.jsx("div",{style:s.transcriptionText,children:l})]})},"VoiceMessagePlayer"),s={container:{display:"flex",alignItems:"center",gap:"12px",backgroundColor:"rgba(88, 101, 242, 0.08)",border:"1px solid rgba(88, 101, 242, 0.2)",borderRadius:"12px",padding:"12px 16px",maxWidth:"400px",transition:"all 0.2s"},playButton:{width:"36px",height:"36px",borderRadius:"50%",border:"none",backgroundColor:"#5865f2",color:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"all 0.2s",flexShrink:0},waveformContainer:{flex:1,display:"flex",flexDirection:"column",gap:"6px",cursor:"pointer",minWidth:0},waveform:{display:"flex",alignItems:"center",gap:"2px",height:"32px"},waveBar:{flex:1,minWidth:"2px",borderRadius:"2px",transition:"all 0.15s ease-out"},timeDisplay:{fontSize:"11px",color:"#dcddde",fontWeight:"500"},downloadButton:{width:"32px",height:"32px",borderRadius:"50%",border:"none",backgroundColor:"transparent",color:"#b9bbbe",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"all 0.2s",flexShrink:0},errorContainer:{display:"flex",alignItems:"center",gap:"10px",padding:"4px",width:"100%"},errorIcon:{fontSize:"20px",opacity:.5},errorText:{fontSize:"12px",color:"#72767d",fontStyle:"italic"},transcriptionText:{marginTop:"8px",padding:"8px 12px",backgroundColor:"rgba(79, 84, 92, 0.3)",borderRadius:"8px",fontSize:"13px",color:"#dcddde",lineHeight:"1.4",fontStyle:"italic"}},U=X.memo(K);export{U as default};
