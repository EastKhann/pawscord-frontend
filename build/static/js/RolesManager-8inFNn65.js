import{r as m,n as e}from"./react-core-zXIKm1Jm.js";import"./editor-vendor-DiU449Dh.js";const O=({serverId:d,onClose:j})=>{const[n,h]=m.useState([]),[y,b]=m.useState(!0),[k,x]=m.useState(!1),[s,t]=m.useState(null),[g,v]=m.useState(null),[r,u]=m.useState({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0}),f=[{name:"Purple",value:"#8b5cf6"},{name:"Blue",value:"#3b82f6"},{name:"Green",value:"#10b981"},{name:"Red",value:"#ef4444"},{name:"Yellow",value:"#f59e0b"},{name:"Pink",value:"#ec4899"},{name:"Indigo",value:"#6366f1"},{name:"Teal",value:"#14b8a6"},{name:"Orange",value:"#f97316"},{name:"Gray",value:"#6b7280"}];m.useEffect(()=>{N()},[d]);const N=async()=>{try{b(!0);const o=localStorage.getItem("access_token"),a=await fetch(`/api/roles/${d}/list/`,{headers:{Authorization:`Bearer ${o}`}});if(a.ok){const l=await a.json();h(l.roles||[])}else console.error("Failed to fetch roles")}catch(o){console.error("Error fetching roles:",o)}finally{b(!1)}},C=async()=>{if(!r.name.trim()){console.log("âš ï¸ Role name required");return}try{const o=localStorage.getItem("access_token"),a=await fetch(`/api/roles/${d}/create/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const l=await a.json();console.log("âœ… Role created successfully"),h([...n,l.role]),x(!1),u({name:"",color:"#8b5cf6",hoist:!1,mentionable:!0,permissions:0})}else console.error("âŒ Failed to create role")}catch(o){console.error("Error creating role:",o)}},R=async(o,a)=>{try{const l=localStorage.getItem("access_token"),c=await fetch(`/api/roles/${d}/${o}/update/`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(c.ok){const p=await c.json();console.log("âœ… Role updated"),h(n.map(i=>i.id===o?p.role:i)),t(null)}else console.error("âŒ Failed to update role")}catch(l){console.error("Error updating role:",l)}},w=async o=>{if(window.confirm("Are you sure you want to delete this role?"))try{const a=localStorage.getItem("access_token");(await fetch(`/api/roles/${d}/${o}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok?(console.log("âœ… Role deleted"),h(n.filter(c=>c.id!==o))):console.error("âŒ Failed to delete role")}catch(a){console.error("Error deleting role:",a)}},S=async o=>{try{const a=localStorage.getItem("access_token");(await fetch(`/api/roles/${d}/reorder/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({order:o})})).ok?(console.log("âœ… Roles reordered"),N()):console.error("âŒ Failed to reorder roles")}catch(a){console.error("Error reordering roles:",a)}},E=(o,a)=>{v(a),o.dataTransfer.effectAllowed="move"},$=o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},D=(o,a)=>{if(o.preventDefault(),!g||g.id===a.id)return;const l=n.findIndex(i=>i.id===g.id),c=n.findIndex(i=>i.id===a.id),p=[...n];p.splice(l,1),p.splice(c,0,g),h(p),S(p.map(i=>i.id)),v(null)},T=async o=>{try{const a=localStorage.getItem("access_token"),l=await fetch(`/api/roles/${d}/${o}/copy/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(l.ok){const c=await l.json();console.log("âœ… Role copied"),h([...n,c.role])}else console.error("âŒ Failed to copy role")}catch(a){console.error("Error copying role:",a)}};return y?e.jsx("div",{className:"roles-manager-overlay",children:e.jsx("div",{className:"roles-manager-modal",children:e.jsx("div",{className:"loading-spinner",children:"Loading roles..."})})}):e.jsx("div",{className:"roles-manager-overlay",onClick:j,children:e.jsxs("div",{className:"roles-manager-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"roles-manager-header",children:[e.jsx("h2",{children:"ğŸ­ Server Roles"}),e.jsx("button",{className:"close-btn",onClick:j,children:"âœ•"})]}),e.jsxs("div",{className:"roles-manager-content",children:[e.jsxs("div",{className:"roles-actions",children:[e.jsx("button",{className:"create-role-btn",onClick:()=>x(!0),children:"â• Create Role"}),e.jsxs("div",{className:"roles-info",children:[e.jsxs("span",{children:[n.length," roles"]}),e.jsx("span",{className:"info-tip",children:"ğŸ’¡ Drag to reorder hierarchy"})]})]}),e.jsx("div",{className:"roles-list",children:n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ğŸ­"}),e.jsx("h3",{children:"No Roles Yet"}),e.jsx("p",{children:"Create roles to organize your server members"})]}):n.map(o=>e.jsxs("div",{className:`role-card ${g?.id===o.id?"dragging":""}`,draggable:!0,onDragStart:a=>E(a,o),onDragOver:$,onDrop:a=>D(a,o),children:[e.jsx("div",{className:"role-drag-handle",children:"â˜°"}),e.jsx("div",{className:"role-color-badge",style:{backgroundColor:o.color}}),e.jsxs("div",{className:"role-info",children:[e.jsx("div",{className:"role-name",style:{color:o.color},children:o.name}),e.jsxs("div",{className:"role-meta",children:[e.jsxs("span",{className:"role-members",children:["ğŸ‘¥ ",o.member_count||0," members"]}),o.hoist&&e.jsx("span",{className:"role-badge",children:"ğŸ“Œ Hoisted"}),o.mentionable&&e.jsx("span",{className:"role-badge",children:"@ Mentionable"})]})]}),e.jsxs("div",{className:"role-actions",children:[e.jsx("button",{className:"role-action-btn edit",onClick:()=>t(o),title:"Edit",children:"âœï¸"}),e.jsx("button",{className:"role-action-btn copy",onClick:()=>T(o.id),title:"Copy",children:"ğŸ“‹"}),e.jsx("button",{className:"role-action-btn delete",onClick:()=>w(o.id),title:"Delete",children:"ğŸ—‘ï¸"})]})]},o.id))})]}),k&&e.jsx("div",{className:"role-modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"role-modal",onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{children:"Create New Role"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:r.name,onChange:o=>u({...r,name:o.target.value}),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[f.map(o=>e.jsx("button",{className:`color-preset ${r.color===o.value?"active":""}`,style:{backgroundColor:o.value},onClick:()=>u({...r,color:o.value}),title:o.name},o.value)),e.jsx("input",{type:"color",value:r.color,onChange:o=>u({...r,color:o.target.value}),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.hoist,onChange:o=>u({...r,hoist:o.target.checked})}),e.jsx("span",{children:"Display role members separately from online members"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.mentionable,onChange:o=>u({...r,mentionable:o.target.checked})}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"create-btn",onClick:C,children:"Create Role"})]})]})}),s&&e.jsx("div",{className:"role-modal-overlay",onClick:()=>t(null),children:e.jsxs("div",{className:"role-modal",onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{children:"Edit Role"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name"}),e.jsx("input",{type:"text",value:s.name,onChange:o=>t({...s,name:o.target.value}),placeholder:"Enter role name...",maxLength:32})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Color"}),e.jsxs("div",{className:"color-picker",children:[f.map(o=>e.jsx("button",{className:`color-preset ${s.color===o.value?"active":""}`,style:{backgroundColor:o.value},onClick:()=>t({...s,color:o.value}),title:o.name},o.value)),e.jsx("input",{type:"color",value:s.color,onChange:o=>t({...s,color:o.target.value}),className:"color-input"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.hoist,onChange:o=>t({...s,hoist:o.target.checked})}),e.jsx("span",{children:"Display role members separately"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.mentionable,onChange:o=>t({...s,mentionable:o.target.checked})}),e.jsx("span",{children:"Allow anyone to @mention this role"})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>t(null),children:"Cancel"}),e.jsx("button",{className:"save-btn",onClick:()=>R(s.id,s),children:"Save Changes"})]})]})})]})})};export{O as default};
