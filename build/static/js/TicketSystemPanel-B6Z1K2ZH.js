import{r as o,d as t,c9 as n}from"./react-core-DrOm_csO.js";import{g as I}from"./index-DmEhdEtw.js";const U=({serverId:m,onClose:E})=>{const r=I(),[h,S]=o.useState([]),[w,T]=o.useState(!0),[s,i]=o.useState({enabled:!1,category_id:"",support_role_id:"",max_tickets_per_user:3,auto_close_after:48,transcript_channel_id:"",welcome_message:"Merhaba! Destek ekibimiz en kÄ±sa sÃ¼rede size yardÄ±mcÄ± olacak."}),[$,C]=o.useState([]),[x,A]=o.useState([]),[B,z]=o.useState([]),[c,d]=o.useState(null),[u,f]=o.useState("");o.useEffect(()=>{j(),p(),O(),P(),K()},[m]);const j=async()=>{try{const e=await fetch(`${r}/tickets/server/${m}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();i(a)}}catch(e){console.error("Error fetching config:",e)}},p=async()=>{try{const e=await fetch(`${r}/tickets/server/${m}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();S(a)}}catch(e){console.error("Error fetching tickets:",e)}finally{T(!1)}},O=async()=>{try{const e=await fetch(`${r}/channels/server/${m}/categories/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();C(a)}}catch(e){console.error("Error fetching categories:",e)}},P=async()=>{try{const e=await fetch(`${r}/roles/server/${m}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();A(a)}}catch(e){console.error("Error fetching roles:",e)}},K=async()=>{try{const e=await fetch(`${r}/channels/server/${m}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(e.ok){const a=await e.json();z(a.filter(l=>l.type==="text"))}}catch(e){console.error("Error fetching channels:",e)}},D=async()=>{try{(await fetch(`${r}/tickets/server/${m}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(s)})).ok?n.success("âœ… Ayarlar gÃ¼ncellendi"):n.error("âŒ Ayarlar gÃ¼ncellenemedi")}catch(e){console.error("Error updating config:",e),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},y=async e=>{if(window.confirm("Ticket'Ä± kapatmak istediÄŸinize emin misiniz?"))try{(await fetch(`${r}/tickets/${e}/close/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok?(n.success("âœ… Ticket kapatÄ±ldÄ±"),p(),c?.id===e&&d(null)):n.error("âŒ Ticket kapatÄ±lamadÄ±")}catch(a){console.error("Error closing ticket:",a),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},M=async(e,a)=>{try{(await fetch(`${r}/tickets/${e}/priority/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({priority:a})})).ok?(n.success("âœ… Ã–ncelik gÃ¼ncellendi"),p()):n.error("âŒ Ã–ncelik gÃ¼ncellenemedi")}catch(l){console.error("Error setting priority:",l),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},N=async()=>{if(u.trim())try{const e=await fetch(`${r}/tickets/${c.id}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({message:u})});if(e.ok){const a=await e.json();d({...c,messages:[...c.messages||[],a.message]}),f(""),n.success("âœ… Mesaj gÃ¶nderildi")}else n.error("âŒ Mesaj gÃ¶nderilemedi")}catch(e){console.error("Error sending message:",e),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},R=async e=>{try{const a=await fetch(`${r}/tickets/${e}/transcript/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const l=await a.blob(),k=window.URL.createObjectURL(l),g=document.createElement("a");g.href=k,g.download=`ticket-${e}-transcript.txt`,g.click(),n.success("âœ… Transcript indirildi")}else n.error("âŒ Transcript indirilemedi")}catch(a){console.error("Error exporting transcript:",a),n.error("âŒ BaÄŸlantÄ± hatasÄ±")}},v=e=>{const a={open:{text:"AÃ§Ä±k",color:"#10b981"},assigned:{text:"AtandÄ±",color:"#f59e0b"},closed:{text:"KapalÄ±",color:"#6b7280"}};return a[e]||a.open},b=e=>{const a={low:{text:"DÃ¼ÅŸÃ¼k",color:"#10b981"},medium:{text:"Orta",color:"#f59e0b"},high:{text:"YÃ¼ksek",color:"#ef4444"},urgent:{text:"Acil",color:"#dc2626"}};return a[e]||a.medium},_=e=>{const a=new Date(e);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)};return t.createElement("div",{className:"ticket-panel-overlay",onClick:E},t.createElement("div",{className:"ticket-panel",onClick:e=>e.stopPropagation()},t.createElement("div",{className:"ticket-header"},t.createElement("h2",null,"ðŸŽ« Destek Sistemi"),t.createElement("button",{className:"close-btn",onClick:E},"Ã—")),t.createElement("div",{className:"ticket-content"},t.createElement("div",{className:"ticket-config-section"},t.createElement("h3",null,"âš™ï¸ Sistem AyarlarÄ±"),t.createElement("div",{className:"config-grid"},t.createElement("div",{className:"config-item"},t.createElement("label",{className:"toggle-label"},t.createElement("input",{type:"checkbox",checked:s.enabled,onChange:e=>i({...s,enabled:e.target.checked})}),t.createElement("span",{className:"toggle-switch"}),t.createElement("span",{className:"toggle-text"},"Ticket Sistemi Aktif"))),t.createElement("div",{className:"config-item"},t.createElement("label",null,"Ticket Kategorisi"),t.createElement("select",{value:s.category_id,onChange:e=>i({...s,category_id:e.target.value})},t.createElement("option",{value:""},"Kategori SeÃ§in"),$.map(e=>t.createElement("option",{key:e.id,value:e.id},e.name)))),t.createElement("div",{className:"config-item"},t.createElement("label",null,"Destek RolÃ¼"),t.createElement("select",{value:s.support_role_id,onChange:e=>i({...s,support_role_id:e.target.value})},t.createElement("option",{value:""},"Rol SeÃ§in"),x.map(e=>t.createElement("option",{key:e.id,value:e.id},e.name)))),t.createElement("div",{className:"config-item"},t.createElement("label",null,"KullanÄ±cÄ± BaÅŸÄ±na Max Ticket"),t.createElement("input",{type:"number",min:"1",max:"10",value:s.max_tickets_per_user,onChange:e=>i({...s,max_tickets_per_user:parseInt(e.target.value)})})),t.createElement("div",{className:"config-item"},t.createElement("label",null,"Otomatik Kapanma (Saat)"),t.createElement("input",{type:"number",min:"1",max:"168",value:s.auto_close_after,onChange:e=>i({...s,auto_close_after:parseInt(e.target.value)})})),t.createElement("div",{className:"config-item"},t.createElement("label",null,"Transcript KanalÄ±"),t.createElement("select",{value:s.transcript_channel_id,onChange:e=>i({...s,transcript_channel_id:e.target.value})},t.createElement("option",{value:""},"Kanal SeÃ§in (Opsiyonel)"),B.map(e=>t.createElement("option",{key:e.id,value:e.id},"# ",e.name)))),t.createElement("div",{className:"config-item full-width"},t.createElement("label",null,"HoÅŸ Geldin MesajÄ±"),t.createElement("textarea",{value:s.welcome_message,onChange:e=>i({...s,welcome_message:e.target.value}),rows:"3"}))),t.createElement("button",{className:"save-config-btn",onClick:D},"ðŸ’¾ AyarlarÄ± Kaydet")),t.createElement("div",{className:"tickets-section"},t.createElement("h3",null,"ðŸ“‹ Aktif Ticket'lar"),w?t.createElement("div",{className:"loading-state"},t.createElement("div",{className:"spinner"}),t.createElement("p",null,"Ticket'lar yÃ¼kleniyor...")):h.length===0?t.createElement("div",{className:"empty-state"},t.createElement("span",{className:"empty-icon"},"ðŸŽ«"),t.createElement("p",null,"HenÃ¼z ticket yok"),t.createElement("span",{className:"empty-hint"},"KullanÄ±cÄ±lar ticket oluÅŸturduÄŸunda burada gÃ¶rÃ¼necek")):t.createElement("div",{className:"tickets-grid"},h.map(e=>t.createElement("div",{key:e.id,className:"ticket-card",onClick:()=>d(e)},t.createElement("div",{className:"ticket-card-header"},t.createElement("div",{className:"ticket-info"},t.createElement("span",{className:"ticket-id"},"#",e.id),t.createElement("h4",null,e.subject||"Destek Talebi")),t.createElement("div",{className:"ticket-badges"},t.createElement("span",{className:"status-badge",style:{background:v(e.status).color}},v(e.status).text),t.createElement("span",{className:"priority-badge",style:{background:b(e.priority).color}},b(e.priority).text))),t.createElement("div",{className:"ticket-meta"},t.createElement("div",{className:"meta-item"},t.createElement("span",{className:"meta-label"},"OluÅŸturan:"),t.createElement("span",{className:"meta-value"},e.creator_username)),e.assigned_to&&t.createElement("div",{className:"meta-item"},t.createElement("span",{className:"meta-label"},"Atanan:"),t.createElement("span",{className:"meta-value"},e.assigned_to_username)),t.createElement("div",{className:"meta-item"},t.createElement("span",{className:"meta-label"},"OluÅŸturulma:"),t.createElement("span",{className:"meta-value"},_(e.created_at)))),t.createElement("div",{className:"ticket-actions-quick"},t.createElement("button",{className:"priority-btn",onClick:a=>{a.stopPropagation();const l=["low","medium","high","urgent"],k=l.indexOf(e.priority),g=l[(k+1)%l.length];M(e.id,g)}},"ðŸ·ï¸ Ã–ncelik"),t.createElement("button",{className:"close-ticket-btn",onClick:a=>{a.stopPropagation(),y(e.id)}},"âœ“ Kapat"))))))),c&&t.createElement("div",{className:"ticket-detail-modal",onClick:()=>d(null)},t.createElement("div",{className:"ticket-detail-panel",onClick:e=>e.stopPropagation()},t.createElement("div",{className:"detail-header"},t.createElement("div",null,t.createElement("span",{className:"ticket-id-large"},"#",c.id),t.createElement("h3",null,c.subject||"Destek Talebi")),t.createElement("button",{className:"close-btn",onClick:()=>d(null)},"Ã—")),t.createElement("div",{className:"detail-body"},t.createElement("div",{className:"messages-container"},c.messages?.map((e,a)=>t.createElement("div",{key:a,className:"message-item"},t.createElement("div",{className:"message-author"},t.createElement("span",{className:"author-name"},e.author),t.createElement("span",{className:"message-time"},_(e.created_at))),t.createElement("div",{className:"message-content"},e.content)))),t.createElement("div",{className:"message-input-container"},t.createElement("input",{type:"text",placeholder:"MesajÄ±nÄ±zÄ± yazÄ±n...",value:u,onChange:e=>f(e.target.value),onKeyPress:e=>e.key==="Enter"&&N()}),t.createElement("button",{className:"send-btn",onClick:N},"ðŸ“¤ GÃ¶nder"))),t.createElement("div",{className:"detail-footer"},t.createElement("button",{className:"export-btn",onClick:()=>R(c.id)},"ðŸ“„ Transcript Ä°ndir"),t.createElement("button",{className:"close-ticket-btn-large",onClick:()=>y(c.id)},"âœ“ Ticket'Ä± Kapat"))))))};export{U as default};
