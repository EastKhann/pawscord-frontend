import{r as c,bo as C,X as U,l as L,U as V,cn as S,aX as o,aD as w,ay as k,bV as y,D as b,K as z,a3 as X,o as _}from"./react-core-B6hadH-M.js";import{g as j,t as d}from"./index-D_6pZib5.js";const K=({serverId:i,serverName:m,onClose:p,onClone:g})=>{const[F,v]=c.useState(!0),[$,x]=c.useState(!1),[a,R]=c.useState(null),[s,E]=c.useState(""),[t,P]=c.useState({channels:!0,roles:!0,emojis:!0,settings:!0,permissions:!0,categories:!0}),[u,N]=c.useState(0),[T,h]=c.useState(""),f=localStorage.getItem("access_token");c.useEffect(()=>{A()},[i]);const A=async()=>{v(!0);try{const e=await fetch(`${j()}/api/servers/${i}/clone-data/`,{headers:{Authorization:`Bearer ${f}`}});if(e.ok){const n=await e.json();R(n),E(`${n.name||m} (Copy)`)}else R({id:i,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),E(`${m} (Copy)`)}catch(e){console.error("Error loading server data:",e),R({id:i,name:m,channels:[],categories:[],roles:[],emojis:[],settings:{}}),E(`${m} (Copy)`)}v(!1)},l=e=>{P(n=>({...n,[e]:!n[e]}))},O=async()=>{if(s.trim()){x(!0),N(0),h("Starting clone process...");try{const e=await fetch(`${j()}/api/servers/${i}/clone/`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({name:s,options:t})}),n=[{progress:20,status:"Creating server..."},{progress:40,status:"Setting up channels..."},{progress:60,status:"Configuring roles..."},{progress:80,status:"Applying settings..."},{progress:100,status:"Complete!"}];for(const r of n)await new Promise(B=>setTimeout(B,300)),N(r.progress),h(r.status);if(e.ok){const r=await e.json();d.success(`Server "${s}" created successfully!`),g&&g({name:s,...t,newServerId:r.server_id})}else{const r=await e.json();d.error(r.error||"Failed to clone server")}}catch(e){console.error("Error cloning server:",e),d.error("Failed to clone server")}p()}},D=()=>Object.values(t).filter(Boolean).length;return F?React.createElement("div",{className:"serverclone-overlay",onClick:p},React.createElement("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"loading"},"Loading server data..."))):React.createElement("div",{className:"serverclone-overlay",onClick:p},React.createElement("div",{className:"serverclone-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"panel-header"},React.createElement("div",{className:"header-info"},React.createElement("h2",null,React.createElement(C,null)," Clone Server"),React.createElement("span",{className:"source-server"},React.createElement(U,null)," ",a?.name)),React.createElement("button",{className:"close-btn",onClick:p},React.createElement(L,null))),$?React.createElement("div",{className:"cloning-progress"},React.createElement("div",{className:"progress-icon"},React.createElement(V,{className:"spinning"})),React.createElement("h3",null,"Cloning Server..."),React.createElement("div",{className:"progress-bar"},React.createElement("div",{className:"progress-fill",style:{width:`${u}%`}})),React.createElement("span",{className:"progress-status"},T),React.createElement("span",{className:"progress-percent"},u,"%")):React.createElement(React.Fragment,null,React.createElement("div",{className:"content"},React.createElement("div",{className:"section"},React.createElement("h3",null,"New Server Name"),React.createElement("input",{type:"text",value:s,onChange:e=>E(e.target.value),placeholder:"Enter server name",maxLength:100})),React.createElement("div",{className:"section"},React.createElement("h3",null,"What to Clone (",D(),"/6)"),React.createElement("div",{className:"options-grid"},React.createElement("div",{className:`option-card ${t.categories?"selected":""}`,onClick:()=>l("categories")},React.createElement("div",{className:"option-icon"},React.createElement(S,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Categories"),React.createElement("span",{className:"option-count"},a?.categories?.length||0," categories")),t.categories&&React.createElement(o,{className:"check"})),React.createElement("div",{className:`option-card ${t.channels?"selected":""}`,onClick:()=>l("channels")},React.createElement("div",{className:"option-icon"},React.createElement(w,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Channels"),React.createElement("span",{className:"option-count"},a?.channels?.length||0," channels")),t.channels&&React.createElement(o,{className:"check"})),React.createElement("div",{className:`option-card ${t.roles?"selected":""}`,onClick:()=>l("roles")},React.createElement("div",{className:"option-icon"},React.createElement(k,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Roles"),React.createElement("span",{className:"option-count"},a?.roles?.length||0," roles")),t.roles&&React.createElement(o,{className:"check"})),React.createElement("div",{className:`option-card ${t.permissions?"selected":""}`,onClick:()=>l("permissions")},React.createElement("div",{className:"option-icon"},React.createElement(y,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Permissions"),React.createElement("span",{className:"option-count"},"Channel overrides")),t.permissions&&React.createElement(o,{className:"check"})),React.createElement("div",{className:`option-card ${t.emojis?"selected":""}`,onClick:()=>l("emojis")},React.createElement("div",{className:"option-icon"},React.createElement(b,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Emojis"),React.createElement("span",{className:"option-count"},a?.emojis?.length||0," emojis")),t.emojis&&React.createElement(o,{className:"check"})),React.createElement("div",{className:`option-card ${t.settings?"selected":""}`,onClick:()=>l("settings")},React.createElement("div",{className:"option-icon"},React.createElement(y,null)),React.createElement("div",{className:"option-info"},React.createElement("span",{className:"option-name"},"Settings"),React.createElement("span",{className:"option-count"},"Server config")),t.settings&&React.createElement(o,{className:"check"})))),React.createElement("div",{className:"section"},React.createElement("h3",null,"Preview"),React.createElement("div",{className:"preview-card"},React.createElement("div",{className:"preview-header"},React.createElement("div",{className:"preview-icon"},s.charAt(0).toUpperCase()),React.createElement("div",{className:"preview-info"},React.createElement("span",{className:"preview-name"},s||"New Server"),React.createElement("span",{className:"preview-meta"},React.createElement(z,null)," 1 member"))),React.createElement("div",{className:"preview-items"},t.categories&&React.createElement("span",{className:"preview-item"},React.createElement(S,null)," ",a?.categories?.length," Categories"),t.channels&&React.createElement("span",{className:"preview-item"},React.createElement(w,null)," ",a?.channels?.filter(e=>e.type==="text").length," Text"),t.channels&&React.createElement("span",{className:"preview-item"},React.createElement(X,null)," ",a?.channels?.filter(e=>e.type==="voice").length," Voice"),t.roles&&React.createElement("span",{className:"preview-item"},React.createElement(k,null)," ",a?.roles?.length," Roles"),t.emojis&&React.createElement("span",{className:"preview-item"},React.createElement(b,null)," ",a?.emojis?.length," Emojis")))),React.createElement("div",{className:"warning-box"},React.createElement(_,null),React.createElement("div",null,React.createElement("strong",null,"Note:")," Members, messages, and message history will not be cloned. Only server structure and settings will be copied."))),React.createElement("div",{className:"panel-footer"},React.createElement("button",{className:"cancel-btn",onClick:p},"Cancel"),React.createElement("button",{className:"clone-btn",onClick:O,disabled:!s.trim()},React.createElement(C,null)," Clone Server")))))};export{K as default};
