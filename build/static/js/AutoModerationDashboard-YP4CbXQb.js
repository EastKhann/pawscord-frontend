import{r,n as e}from"./react-core-Cj7FUMmY.js";import{a5 as L,a as b,d as I,b5 as _,E as z,as as T,b1 as B,ad as F,S as A}from"./icons-vendor-DnRG7SaF.js";import{h as D}from"./index-BMfm-Nut.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BsD1gqUZ.js";import"./router-vendor-QeioVw-9.js";import"./state-vendor-MN-5i-Jz.js";import"./crypto-vendor-DK-7ILyQ.js";const Y=({serverId:s,fetchWithAuth:c,apiBaseUrl:x,onClose:g})=>{const[a,u]=r.useState([]),[d,m]=r.useState([]),[h,j]=r.useState({total_violations:0,auto_deleted:0,warnings_issued:0,users_banned:0}),[v,f]=r.useState(!1),[n,p]=r.useState({rule_type:"toxic",action:"warn",threshold:.8,keywords:[]}),[k,y]=r.useState(!0);r.useEffect(()=>{w()},[s]);const w=async()=>{y(!0);try{const o=await c(`${x}/moderation/rules/${s}/`);if(o.ok){const i=await o.json();u(i.rules||[])}const l=await c(`${x}/moderation/logs/${s}/`);if(l.ok){const i=await l.json();m(i.logs||i)}d.length>0&&j({total_violations:d.length,auto_deleted:d.filter(i=>i.action==="delete").length,warnings_issued:d.filter(i=>i.action==="warn").length,users_banned:d.filter(i=>i.action==="ban").length})}catch{}y(!1)},C=async()=>{try{const o=await c(`${x}/moderation/rules/${s}/create/`,{method:"POST",body:JSON.stringify(n)});if(o.ok){const l=await o.json();u([...a,l]),f(!1),p({rule_type:"toxic",action:"warn",threshold:.8,keywords:[]})}}catch{}},S=async o=>{try{await c(`${x}/moderation/rules/${o}/toggle/`,{method:"POST"}),u(a.map(l=>l.id===o?{...l,is_enabled:!l.is_enabled}:l))}catch{}},R=async o=>{if(await D("Bu kuralÄ± silmek istediÄŸine emin misin?"))try{await c(`${x}/moderation/rules/${o}/`,{method:"DELETE"}),u(a.filter(l=>l.id!==o))}catch{}};return e.jsx("div",{style:t.overlay,onClick:g,children:e.jsxs("div",{style:t.panel,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(L,{style:t.headerIcon}),e.jsx("h2",{style:t.title,children:"Auto-Moderation"})]}),e.jsx("button",{onClick:g,style:t.closeButton,children:e.jsx(b,{})})]}),e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:t.statCard,children:[e.jsx(I,{style:{...t.statIcon,color:"#f04747"}}),e.jsx("div",{style:t.statValue,children:h.total_violations}),e.jsx("div",{style:t.statLabel,children:"Total Violations"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(_,{style:{...t.statIcon,color:"#ed4245"}}),e.jsx("div",{style:t.statValue,children:h.auto_deleted}),e.jsx("div",{style:t.statLabel,children:"Auto-Deleted"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(z,{style:{...t.statIcon,color:"#f0b132"}}),e.jsx("div",{style:t.statValue,children:h.warnings_issued}),e.jsx("div",{style:t.statLabel,children:"Warnings"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(T,{style:{...t.statIcon,color:"#43b581"}}),e.jsx("div",{style:t.statValue,children:a.filter(o=>o.is_enabled).length}),e.jsx("div",{style:t.statLabel,children:"Active Rules"})]})]}),e.jsxs("div",{style:t.section,children:[e.jsxs("div",{style:t.sectionHeader,children:[e.jsxs("h3",{style:t.sectionTitle,children:[e.jsx(B,{})," Moderation Rules"]}),e.jsxs("button",{onClick:()=>f(!0),style:t.addButton,children:[e.jsx(F,{})," Add Rule"]})]}),k?e.jsx("div",{style:t.loading,children:"Loading..."}):a.length===0?e.jsx("div",{style:t.empty,children:"No moderation rules yet. Create one to get started!"}):e.jsx("div",{style:t.rulesList,children:a.map(o=>e.jsxs("div",{style:t.ruleCard,children:[e.jsxs("div",{style:t.ruleHeader,children:[e.jsxs("div",{style:t.ruleType,children:[E(o.rule_type),e.jsx("span",{children:V(o.rule_type)})]}),e.jsxs("div",{style:t.ruleActions,children:[e.jsxs("label",{style:t.switch,children:[e.jsx("input",{type:"checkbox",checked:o.is_enabled,onChange:()=>S(o.id)}),e.jsx("span",{style:t.slider})]}),e.jsx("button",{onClick:()=>R(o.id),style:t.deleteBtn,children:e.jsx(b,{})})]})]}),e.jsxs("div",{style:t.ruleDetails,children:[e.jsxs("div",{style:t.ruleInfo,children:[e.jsx("span",{style:t.ruleLabel,children:"Action:"}),e.jsx("span",{style:t.ruleValue,children:W(o.action)})]}),o.threshold&&e.jsxs("div",{style:t.ruleInfo,children:[e.jsx("span",{style:t.ruleLabel,children:"Threshold:"}),e.jsxs("span",{style:t.ruleValue,children:[(o.threshold*100).toFixed(0),"%"]})]}),o.keywords&&o.keywords.length>0&&e.jsxs("div",{style:t.ruleInfo,children:[e.jsx("span",{style:t.ruleLabel,children:"Keywords:"}),e.jsx("span",{style:t.ruleValue,children:o.keywords.join(", ")})]})]})]},o.id))})]}),e.jsxs("div",{style:t.section,children:[e.jsxs("h3",{style:t.sectionTitle,children:[e.jsx(A,{})," Recent Activity"]}),e.jsx("div",{style:t.logsList,children:d.slice(0,10).map((o,l)=>e.jsxs("div",{style:t.logItem,children:[e.jsx("div",{style:t.logIcon,children:$(o.action)}),e.jsxs("div",{style:t.logContent,children:[e.jsxs("div",{style:t.logText,children:[e.jsx("strong",{children:o.user||"Unknown"})," - ",o.violation_type]}),e.jsxs("div",{style:t.logMeta,children:[o.content?.substring(0,50),"... â€¢ ",new Date(o.created_at).toLocaleString()]})]}),e.jsx("div",{style:t.logAction,children:e.jsx("span",{style:G(o.action),children:o.action})})]},l))})]}),v&&e.jsx("div",{style:t.modalOverlay,onClick:()=>f(!1),children:e.jsxs("div",{style:t.modal,onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{style:t.modalTitle,children:"Create Moderation Rule"}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Rule Type"}),e.jsxs("select",{value:n.rule_type,onChange:o=>p({...n,rule_type:o.target.value}),style:t.select,children:[e.jsx("option",{value:"toxic",children:"Toxic Language"}),e.jsx("option",{value:"spam",children:"Spam Detection"}),e.jsx("option",{value:"keyword",children:"Keyword Filter"}),e.jsx("option",{value:"link",children:"Link Filter"}),e.jsx("option",{value:"caps",children:"Excessive Caps"})]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Action"}),e.jsxs("select",{value:n.action,onChange:o=>p({...n,action:o.target.value}),style:t.select,children:[e.jsx("option",{value:"warn",children:"Warn User"}),e.jsx("option",{value:"delete",children:"Delete Message"}),e.jsx("option",{value:"timeout",children:"Timeout User (5min)"}),e.jsx("option",{value:"kick",children:"Kick User"}),e.jsx("option",{value:"ban",children:"Ban User"})]})]}),n.rule_type!=="keyword"&&e.jsxs("div",{style:t.formGroup,children:[e.jsxs("label",{style:t.label,children:["AI Threshold (",(n.threshold*100).toFixed(0),"%)"]}),e.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:n.threshold,onChange:o=>p({...n,threshold:parseFloat(o.target.value)}),style:t.slider})]}),n.rule_type==="keyword"&&e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Keywords (comma separated)"}),e.jsx("input",{type:"text",placeholder:"word1, word2, word3",onChange:o=>p({...n,keywords:o.target.value.split(",").map(l=>l.trim())}),style:t.input})]}),e.jsxs("div",{style:t.modalButtons,children:[e.jsx("button",{onClick:()=>f(!1),style:t.cancelBtn,children:"Cancel"}),e.jsx("button",{onClick:C,style:t.createBtn,children:"Create Rule"})]})]})})]})})},E=s=>{switch(s){case"toxic":return"â˜ ï¸";case"spam":return"ðŸš«";case"keyword":return"ðŸ”¤";case"link":return"ðŸ”—";case"caps":return"ðŸ“¢";default:return"âš™ï¸"}},V=s=>{switch(s){case"toxic":return"Toxic Language";case"spam":return"Spam Detection";case"keyword":return"Keyword Filter";case"link":return"Link Filter";case"caps":return"Excessive Caps";default:return s}},W=s=>{switch(s){case"warn":return"âš ï¸ Warn";case"delete":return"ðŸ—‘ï¸ Delete";case"timeout":return"â±ï¸ Timeout";case"kick":return"ðŸ‘¢ Kick";case"ban":return"ðŸ”¨ Ban";default:return s}},$=s=>{switch(s){case"warn":return"âš ï¸";case"delete":return"ðŸ—‘ï¸";case"timeout":return"â±ï¸";case"ban":return"ðŸ”¨";default:return"â“"}},G=s=>({padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"600",backgroundColor:s==="ban"?"#ed4245":s==="timeout"?"#f0b132":"#5865f2",color:"#fff"}),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#5865f2"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px",borderRadius:"4px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"32px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"14px",color:"#b9bbbe"},section:{padding:"20px",borderBottom:"1px solid #1e1f22",overflowY:"auto"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},sectionTitle:{color:"#fff",fontSize:"18px",fontWeight:"600",margin:0,display:"flex",alignItems:"center",gap:"8px"},addButton:{backgroundColor:"#5865f2",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:"600"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},rulesList:{display:"flex",flexDirection:"column",gap:"12px"},ruleCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px"},ruleHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},ruleType:{display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontWeight:"600",color:"#fff"},ruleActions:{display:"flex",alignItems:"center",gap:"12px"},switch:{position:"relative",display:"inline-block",width:"44px",height:"24px"},slider:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:"#72767d",transition:"0.3s",borderRadius:"24px"},deleteBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"18px",padding:"4px"},ruleDetails:{display:"flex",flexDirection:"column",gap:"8px"},ruleInfo:{display:"flex",gap:"8px",fontSize:"14px"},ruleLabel:{color:"#b9bbbe",fontWeight:"500"},ruleValue:{color:"#fff"},logsList:{display:"flex",flexDirection:"column",gap:"8px"},logItem:{display:"flex",alignItems:"center",gap:"12px",backgroundColor:"#1e1f22",borderRadius:"6px",padding:"12px"},logIcon:{fontSize:"24px"},logContent:{flex:1},logText:{color:"#fff",fontSize:"14px",marginBottom:"4px"},logMeta:{color:"#72767d",fontSize:"12px"},logAction:{marginLeft:"auto"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"500px"},modalTitle:{color:"#fff",fontSize:"20px",marginBottom:"20px"},formGroup:{marginBottom:"16px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",marginBottom:"8px",fontWeight:"500"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #1e1f22",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #1e1f22",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},modalButtons:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"20px"},cancelBtn:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 20px",cursor:"pointer",fontSize:"14px"},createBtn:{backgroundColor:"#5865f2",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 20px",cursor:"pointer",fontSize:"14px",fontWeight:"600"}};export{Y as default};
