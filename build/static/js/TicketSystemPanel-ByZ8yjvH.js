import{r as h,n as e}from"./react-core-DA61mcWm.js";import{y as l}from"./ui-vendor-BrUQ4r0A.js";import{h as O,g as D}from"./index-1Alyfdkn.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-tDmQW26m.js";import"./router-vendor-2etVlp2q.js";import"./icons-vendor-DRtjID0N.js";import"./state-vendor-CjqIs3K2.js";import"./crypto-vendor-DiGIAuUm.js";const M=i=>{const c=D(),s=()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),[n,d]=h.useState([]),[m,t]=h.useState(!0),[g,o]=h.useState({enabled:!1,category_id:"",support_role_id:"",max_tickets_per_user:3,auto_close_after:48,transcript_channel_id:"",welcome_message:"Merhaba! Destek ekibimiz en kÄ±sa sÃ¼rede size yardÄ±mcÄ± olacak."}),[j,v]=h.useState([]),[b,T]=h.useState([]),[_,w]=h.useState([]),[p,k]=h.useState(null),[y,N]=h.useState(""),S=async()=>{try{const a=await fetch(`${c}/tickets/server/${i}/config/`,{headers:s()});a.ok&&o(await a.json())}catch{}},x=async()=>{try{const a=await fetch(`${c}/tickets/server/${i}/`,{headers:s()});a.ok&&d(await a.json())}catch{}finally{t(!1)}},C=async()=>{try{const a=await fetch(`${c}/channels/server/${i}/categories/`,{headers:s()});a.ok&&v(await a.json())}catch{}},$=async()=>{try{const a=await fetch(`${c}/roles/server/${i}/`,{headers:s()});a.ok&&T(await a.json())}catch{}},B=async()=>{try{const a=await fetch(`${c}/channels/server/${i}/`,{headers:s()});if(a.ok){const r=await a.json();w(r.filter(u=>u.type==="text"))}}catch{}};return h.useEffect(()=>{S(),x(),C(),$(),B()},[i]),{tickets:n,loading:m,config:g,setConfig:o,categories:j,roles:b,channels:_,selectedTicket:p,setSelectedTicket:k,newMessage:y,setNewMessage:N,updateConfig:async()=>{try{(await fetch(`${c}/tickets/server/${i}/config/update/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify(g)})).ok?l.success("âœ… Ayarlar gÃ¼ncellendi"):l.error("âŒ Ayarlar gÃ¼ncellenemedi")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},closeTicket:async a=>{if(await O("Ticket'Ä± kapatmak istediÄŸinize emin misiniz?"))try{(await fetch(`${c}/tickets/${a}/close/`,{method:"POST",headers:s()})).ok?(l.success("âœ… Ticket kapatÄ±ldÄ±"),x(),p?.id===a&&k(null)):l.error("âŒ Ticket kapatÄ±lamadÄ±")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},assignTicket:async(a,r)=>{try{(await fetch(`${c}/tickets/${a}/assign/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({user_id:r})})).ok?(l.success("âœ… Ticket atandÄ±"),x()):l.error("âŒ Ticket atanamadÄ±")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},setPriority:async(a,r)=>{try{(await fetch(`${c}/tickets/${a}/priority/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({priority:r})})).ok?(l.success("âœ… Ã–ncelik gÃ¼ncellendi"),x()):l.error("âŒ Ã–ncelik gÃ¼ncellenemedi")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},sendMessage:async()=>{if(y.trim())try{const a=await fetch(`${c}/tickets/${p.id}/reply/`,{method:"POST",headers:{...s(),"Content-Type":"application/json"},body:JSON.stringify({message:y})});if(a.ok){const r=await a.json();k({...p,messages:[...p.messages||[],r.message]}),N(""),l.success("âœ… Mesaj gÃ¶nderildi")}else l.error("âŒ Mesaj gÃ¶nderilemedi")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},exportTranscript:async a=>{try{const r=await fetch(`${c}/tickets/${a}/transcript/`,{headers:s()});if(r.ok){const u=await r.blob(),P=window.URL.createObjectURL(u),f=document.createElement("a");f.href=P,f.download=`ticket-${a}-transcript.txt`,f.click(),l.success("âœ… Transcript indirildi")}else l.error("âŒ Transcript indirilemedi")}catch{l.error("âŒ BaÄŸlantÄ± hatasÄ±")}},getStatusBadge:a=>{const r={open:{text:"AÃ§Ä±k",color:"#10b981"},assigned:{text:"AtandÄ±",color:"#f59e0b"},closed:{text:"KapalÄ±",color:"#6b7280"}};return r[a]||r.open},getPriorityBadge:a=>{const r={low:{text:"DÃ¼ÅŸÃ¼k",color:"#10b981"},medium:{text:"Orta",color:"#f59e0b"},high:{text:"YÃ¼ksek",color:"#ef4444"},urgent:{text:"Acil",color:"#dc2626"}};return r[a]||r.medium},formatDate:a=>{const r=new Date(a);return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)}}},A=({config:i,setConfig:c,categories:s,roles:n,channels:d,updateConfig:m})=>e.jsxs("div",{className:"ticket-config-section",children:[e.jsxs("h3",{children:["âš™ï¸"," Sistem Ayarlar\\u0131"]}),e.jsxs("div",{className:"config-grid",children:[e.jsx("div",{className:"config-item",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:i.enabled,onChange:t=>c({...i,enabled:t.target.checked})}),e.jsx("span",{className:"toggle-switch"}),e.jsx("span",{className:"toggle-text",children:"Ticket Sistemi Aktif"})]})}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Ticket Kategorisi"}),e.jsxs("select",{value:i.category_id,onChange:t=>c({...i,category_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Kategori Se\\u00e7in"}),s.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Destek Rol\\u00fc"}),e.jsxs("select",{value:i.support_role_id,onChange:t=>c({...i,support_role_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Rol Se\\u00e7in"}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Kullan\\u0131c\\u0131 Ba\\u015f\\u0131na Max Ticket"}),e.jsx("input",{type:"number",min:"1",max:"10",value:i.max_tickets_per_user,onChange:t=>c({...i,max_tickets_per_user:parseInt(t.target.value)})})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Otomatik Kapanma (Saat)"}),e.jsx("input",{type:"number",min:"1",max:"168",value:i.auto_close_after,onChange:t=>c({...i,auto_close_after:parseInt(t.target.value)})})]}),e.jsxs("div",{className:"config-item",children:[e.jsx("label",{children:"Transcript Kanal\\u0131"}),e.jsxs("select",{value:i.transcript_channel_id,onChange:t=>c({...i,transcript_channel_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Kanal Se\\u00e7in (Opsiyonel)"}),d.map(t=>e.jsxs("option",{value:t.id,children:["# ",t.name]},t.id))]})]}),e.jsxs("div",{className:"config-item full-width",children:[e.jsx("label",{children:"Ho\\u015f Geldin Mesaj\\u0131"}),e.jsx("textarea",{value:i.welcome_message,onChange:t=>c({...i,welcome_message:t.target.value}),rows:"3"})]})]}),e.jsxs("button",{className:"save-config-btn",onClick:m,children:["ðŸ’¾"," Ayarlar\\u0131 Kaydet"]})]}),K=({ticket:i,onClose:c,newMessage:s,setNewMessage:n,sendMessage:d,exportTranscript:m,closeTicket:t,formatDate:g})=>e.jsx("div",{className:"ticket-detail-modal",onClick:c,children:e.jsxs("div",{className:"ticket-detail-panel",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"ticket-id-large",children:["#",i.id]}),e.jsx("h3",{children:i.subject||"Destek Talebi"})]}),e.jsx("button",{className:"close-btn",onClick:c,children:"Ã—"})]}),e.jsxs("div",{className:"detail-body",children:[e.jsx("div",{className:"messages-container",children:i.messages?.map((o,j)=>e.jsxs("div",{className:"message-item",children:[e.jsxs("div",{className:"message-author",children:[e.jsx("span",{className:"author-name",children:o.author}),e.jsx("span",{className:"message-time",children:g(o.created_at)})]}),e.jsx("div",{className:"message-content",children:o.content})]},j))}),e.jsxs("div",{className:"message-input-container",children:[e.jsx("input",{type:"text",placeholder:"Mesaj\\u0131n\\u0131z\\u0131 yaz\\u0131n...",value:s,onChange:o=>n(o.target.value),onKeyPress:o=>o.key==="Enter"&&d()}),e.jsxs("button",{className:"send-btn",onClick:d,children:["ðŸ“¤"," G\\u00f6nder"]})]})]}),e.jsxs("div",{className:"detail-footer",children:[e.jsxs("button",{className:"export-btn",onClick:()=>m(i.id),children:["ðŸ“„"," Transcript \\u0130ndir"]}),e.jsxs("button",{className:"close-ticket-btn-large",onClick:()=>t(i.id),children:["âœ“"," Ticket'\\u0131 Kapat"]})]})]})}),se=({serverId:i,onClose:c})=>{const s=M(i);return e.jsx("div",{className:"ticket-panel-overlay",onClick:c,children:e.jsxs("div",{className:"ticket-panel",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"ticket-header",children:[e.jsxs("h2",{children:["ðŸŽ«"," Destek Sistemi"]}),e.jsx("button",{className:"close-btn",onClick:c,children:"Ã—"})]}),e.jsxs("div",{className:"ticket-content",children:[e.jsx(A,{config:s.config,setConfig:s.setConfig,categories:s.categories,roles:s.roles,channels:s.channels,updateConfig:s.updateConfig}),e.jsxs("div",{className:"tickets-section",children:[e.jsxs("h3",{children:["ðŸ“‹"," Aktif Ticket","â€™","lar"]}),s.loading?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Ticket","â€™","lar y\\u00fckleniyor..."]})]}):s.tickets.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ðŸŽ«"}),e.jsx("p",{children:"Hen\\u00fcz ticket yok"}),e.jsx("span",{className:"empty-hint",children:"Kullan\\u0131c\\u0131lar ticket olu\\u015fturdu\\u011funda burada g\\u00f6r\\u00fcnecek"})]}):e.jsx("div",{className:"tickets-grid",children:s.tickets.map(n=>e.jsxs("div",{className:"ticket-card",onClick:()=>s.setSelectedTicket(n),children:[e.jsxs("div",{className:"ticket-card-header",children:[e.jsxs("div",{className:"ticket-info",children:[e.jsxs("span",{className:"ticket-id",children:["#",n.id]}),e.jsx("h4",{children:n.subject||"Destek Talebi"})]}),e.jsxs("div",{className:"ticket-badges",children:[e.jsx("span",{className:"status-badge",style:{background:s.getStatusBadge(n.status).color},children:s.getStatusBadge(n.status).text}),e.jsx("span",{className:"priority-badge",style:{background:s.getPriorityBadge(n.priority).color},children:s.getPriorityBadge(n.priority).text})]})]}),e.jsxs("div",{className:"ticket-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Olu\\u015fturan:"}),e.jsx("span",{className:"meta-value",children:n.creator_username})]}),n.assigned_to&&e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Atanan:"}),e.jsx("span",{className:"meta-value",children:n.assigned_to_username})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"Olu\\u015fturulma:"}),e.jsx("span",{className:"meta-value",children:s.formatDate(n.created_at)})]})]}),e.jsxs("div",{className:"ticket-actions-quick",children:[e.jsxs("button",{className:"priority-btn",onClick:d=>{d.stopPropagation();const m=["low","medium","high","urgent"],t=m.indexOf(n.priority);s.setPriority(n.id,m[(t+1)%m.length])},children:["ðŸ·ï¸"," \\u00d6ncelik"]}),e.jsxs("button",{className:"close-ticket-btn",onClick:d=>{d.stopPropagation(),s.closeTicket(n.id)},children:["âœ“"," Kapat"]})]})]},n.id))})]})]}),s.selectedTicket&&e.jsx(K,{ticket:s.selectedTicket,onClose:()=>s.setSelectedTicket(null),newMessage:s.newMessage,setNewMessage:s.setNewMessage,sendMessage:s.sendMessage,exportTranscript:s.exportTranscript,closeTicket:s.closeTicket,formatDate:s.formatDate})]})})};export{se as default};
