import{r as d,a as L,j as e}from"./react-core-D6cE4lil.js";import{a as R,an as B,d as w,aB as W,ay as I,t as T,C as A,g as D}from"./icons-vendor-fClA8qVL.js";import{t as C,d as z}from"./index-DHLSv4f5.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const n={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},F=(i,l,r)=>{const[a,x]=d.useState([]),[b,o]=d.useState([]),[h,m]=d.useState(!0),[S,k]=d.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0}),p=d.useCallback(async()=>{m(!0);try{const t=await l(`${r}/moderation/warnings/${i}/`);if(t.ok){const s=await t.json();x(s.results||s)}}catch{}m(!1)},[i,l,r]),j=d.useCallback(async()=>{try{const t=await l(`${r}/servers/${i}/members/`);t.ok&&o(await t.json())}catch{}},[i,l,r]),f=d.useCallback(async()=>{try{const t=await l(`${r}/moderation/warnings/stats/${i}/`);t.ok&&k(await t.json())}catch{}},[i,l,r]);d.useEffect(()=>{p(),j(),f()},[p,j,f]);const y=d.useCallback(async(t,s)=>{try{(await l(`${r}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:i,user:t,reason:s})})).ok&&(C.success("âœ… User banned successfully"),p(),f())}catch{}},[i,l,r,p,f]),v=d.useCallback(async t=>{if(!t.user_id||!t.reason)return C.error("âŒ Please select a user and provide a reason"),!1;try{const s=await l(`${r}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:i,user:t.user_id,reason:t.reason,severity:t.severity,expires_at:new Date(Date.now()+t.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(s.ok){const u=await s.json();return u.total_warnings>=t.auto_ban_on&&await z(`User has ${u.total_warnings} warnings. Auto-ban now?`)&&await y(t.user_id,`Auto-ban: ${t.auto_ban_on} warnings reached`),p(),f(),!0}else C.error("âŒ Failed to add warning")}catch{}return!1},[i,l,r,y,p,f]),g=d.useCallback(async t=>{if(await z("Remove this warning?"))try{(await l(`${r}/moderation/warnings/${t}/`,{method:"DELETE"})).ok?(p(),f()):C.error("âŒ Failed to remove warning")}catch{}},[l,r,p,f]);return{warnings:a,users:b,loading:h,stats:S,addWarning:v,removeWarning:g,banUser:y}},$={user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3},E=({users:i,onAdd:l,onClose:r})=>{const[a,x]=d.useState($),b=async()=>{await l(a)&&r()};return e.jsx("div",{style:n.modalOverlay,onClick:r,children:e.jsxs("div",{style:n.modal,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:n.modalHeader,children:[e.jsx("h3",{style:n.modalTitle,children:"Add Warning"}),e.jsx("button",{onClick:r,style:n.modalClose,children:e.jsx(R,{})})]}),e.jsxs("div",{style:n.modalContent,children:[e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"User"}),e.jsxs("select",{value:a.user_id,onChange:o=>x({...a,user_id:o.target.value}),style:n.select,children:[e.jsx("option",{value:"",children:"Select user..."}),i.map(o=>e.jsx("option",{value:o.id,children:o.username},o.id))]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Reason"}),e.jsx("textarea",{value:a.reason,onChange:o=>x({...a,reason:o.target.value}),placeholder:"Why is this warning being issued?",style:n.textarea,rows:"3"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Severity"}),e.jsxs("select",{value:a.severity,onChange:o=>x({...a,severity:o.target.value}),style:n.select,children:[e.jsxs("option",{value:"low",children:["ðŸŸ¢"," Low"]}),e.jsxs("option",{value:"medium",children:["ðŸŸ¡"," Medium"]}),e.jsxs("option",{value:"high",children:["ðŸ”´"," High"]})]})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:a.expires_in_days,onChange:o=>x({...a,expires_in_days:parseInt(o.target.value)}),style:n.input,min:"1",max:"365"})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Auto-ban Threshold"}),e.jsx("input",{type:"number",value:a.auto_ban_on,onChange:o=>x({...a,auto_ban_on:parseInt(o.target.value)}),style:n.input,min:"2",max:"10"}),e.jsxs("div",{style:n.hint,children:["User will be auto-banned after reaching ",a.auto_ban_on," active warnings"]})]})]}),e.jsxs("div",{style:n.modalActions,children:[e.jsx("button",{onClick:r,style:n.cancelBtn,children:"Cancel"}),e.jsxs("button",{onClick:b,style:n.submitBtn,children:[e.jsx(B,{})," Add Warning"]})]})]})})},G=L.memo(E),N=i=>{switch(i){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},K=({serverId:i,fetchWithAuth:l,apiBaseUrl:r,onClose:a})=>{const[x,b]=d.useState(""),[o,h]=d.useState(!1),{warnings:m,users:S,loading:k,stats:p,addWarning:j,removeWarning:f,banUser:y}=F(i,l,r),v=d.useMemo(()=>m.filter(t=>!x||t.user_username?.toLowerCase().includes(x.toLowerCase())||t.reason?.toLowerCase().includes(x.toLowerCase())).reduce((t,s)=>(t[s.user]||(t[s.user]={user_id:s.user,username:s.user_username,warnings:[]}),t[s.user].warnings.push(s),t),{}),[m,x]);return e.jsx("div",{style:n.overlay,onClick:a,children:e.jsxs("div",{style:n.panel,onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{style:n.headerLeft,children:[e.jsx(w,{style:n.headerIcon}),e.jsx("h2",{style:n.title,children:"User Warnings"})]}),e.jsxs("div",{style:n.headerRight,children:[e.jsxs("button",{onClick:()=>h(!0),style:n.addBtn,children:[e.jsx(B,{})," Add Warning"]}),e.jsx("button",{onClick:a,style:n.closeButton,children:e.jsx(R,{})})]})]}),e.jsx("div",{style:n.statsGrid,children:[{icon:w,color:"#f0b132",value:p.total_warnings,label:"Total Warnings"},{icon:w,color:"#43b581",value:p.active_warnings,label:"Active"},{icon:W,color:"#72767d",value:p.expired_warnings,label:"Expired"},{icon:I,color:"#ed4245",value:p.auto_banned_users,label:"Auto-Banned"}].map(({icon:g,color:t,value:s,label:u})=>e.jsxs("div",{style:n.statCard,children:[e.jsx(g,{style:{...n.statIcon,color:t}}),e.jsx("div",{style:n.statValue,children:s}),e.jsx("div",{style:n.statLabel,children:u})]},u))}),e.jsxs("div",{style:n.searchBar,children:[e.jsx(T,{style:n.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by username or reason...",value:x,onChange:g=>b(g.target.value),style:n.searchInput})]}),e.jsx("div",{style:n.warningsList,children:k?e.jsx("div",{style:n.loading,children:"Loading warnings..."}):Object.keys(v).length===0?e.jsxs("div",{style:n.empty,children:[e.jsx(w,{style:n.emptyIcon}),e.jsx("p",{children:"No warnings found"})]}):Object.values(v).map(({user_id:g,username:t,warnings:s})=>{const u=s.filter(c=>c.is_active),_=u.length>=2;return e.jsxs("div",{style:n.userCard,children:[e.jsxs("div",{style:n.userHeader,children:[e.jsxs("div",{style:n.userInfo,children:[e.jsx(A,{style:n.userIcon}),e.jsx("div",{style:n.userName,children:t}),e.jsxs("span",{style:{...n.badge,backgroundColor:_?"#ed4245":"#f0b132"},children:[u.length," Active Warning",u.length!==1?"s":""]}),_&&e.jsxs("span",{style:n.riskBadge,children:["âš ï¸"," AT RISK"]})]}),u.length>=3&&e.jsxs("button",{onClick:()=>y(g,"Auto-ban: 3 warnings"),style:n.banBtn,children:[e.jsx(I,{})," Ban User"]})]}),e.jsx("div",{style:n.userWarnings,children:s.map(c=>e.jsxs("div",{style:{...n.warningItem,opacity:c.is_active?1:.5},children:[e.jsxs("div",{style:n.warningLeft,children:[e.jsx("div",{style:{...n.severityDot,backgroundColor:N(c.severity)}}),e.jsxs("div",{style:n.warningContent,children:[e.jsx("div",{style:n.warningReason,children:c.reason}),e.jsxs("div",{style:n.warningMeta,children:[e.jsx("span",{children:c.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(c.created_at).toLocaleString()}),c.expires_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Expires: ",new Date(c.expires_at).toLocaleDateString()]})]}),!c.is_active&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{style:{color:"#72767d"},children:"EXPIRED"})]})]})]})]}),c.is_active&&!c.is_auto&&e.jsx("button",{onClick:()=>f(c.id),style:n.removeBtn,title:"Remove warning",children:e.jsx(D,{})})]},c.id))})]},g)})}),o&&e.jsx(G,{users:S,onAdd:j,onClose:()=>h(!1)})]})})};export{K as default};
