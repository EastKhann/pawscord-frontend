import{r as a,n as e}from"./react-core-zXIKm1Jm.js";import{t as y}from"./index-BFxrV0cL.js";import{d as m,aa as _,a as k,b1 as O,b0 as I,f as U,H as G,s as P}from"./icons-vendor-BBdoVeJd.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-PJALNo1v.js";import"./crypto-vendor-D_AcF0lD.js";import"./state-vendor-8NbFPBhQ.js";const te=({serverId:i,fetchWithAuth:l,apiBaseUrl:d,onClose:j})=>{const[z,B]=a.useState([]),[W,R]=a.useState([]),[u,L]=a.useState(""),[N,V]=a.useState(null),[F,x]=a.useState(!1),[r,c]=a.useState({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3}),[T,v]=a.useState(!0),[g,A]=a.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0});a.useEffect(()=>{f(),D(),b()},[i]);const f=async()=>{v(!0);try{const s=await l(`${d}/moderation/warnings/${i}/`);if(s.ok){const n=await s.json();B(n.results||n)}}catch(s){console.error("Failed to load warnings:",s)}v(!1)},D=async()=>{try{const s=await l(`${d}/servers/${i}/members/`);if(s.ok){const n=await s.json();R(n)}}catch(s){console.error("Failed to load users:",s)}},b=async()=>{try{const s=await l(`${d}/moderation/warnings/stats/${i}/`);if(s.ok){const n=await s.json();A(n)}}catch(s){console.error("Failed to load stats:",s)}},E=async()=>{if(!r.user_id||!r.reason){y.error("âŒ Please select a user and provide a reason");return}try{const s=await l(`${d}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:i,user:r.user_id,reason:r.reason,severity:r.severity,expires_at:new Date(Date.now()+r.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(s.ok){const n=await s.json();n.total_warnings>=r.auto_ban_on&&window.confirm(`User has ${n.total_warnings} warnings. Auto-ban now?`)&&await w(r.user_id,`Auto-ban: ${r.auto_ban_on} warnings reached`),f(),b(),x(!1),c({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3})}else y.error("âŒ Failed to add warning")}catch(s){console.error("Failed to add warning:",s)}},$=async s=>{if(window.confirm("Remove this warning?"))try{(await l(`${d}/moderation/warnings/${s}/`,{method:"DELETE"})).ok?(f(),b()):y.error("âŒ Failed to remove warning")}catch(n){console.error("Failed to remove warning:",n)}},w=async(s,n)=>{try{(await l(`${d}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:i,user:s,reason:n})})).ok&&(y.success("âœ… User banned successfully"),f(),b())}catch(p){console.error("Failed to ban user:",p)}},H=s=>{switch(s){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},C=z.filter(s=>!u||s.user_username?.toLowerCase().includes(u.toLowerCase())||s.reason?.toLowerCase().includes(u.toLowerCase())).reduce((s,n)=>(s[n.user]||(s[n.user]={user_id:n.user,username:n.user_username,warnings:[]}),s[n.user].warnings.push(n),s),{});return e.jsx("div",{style:t.overlay,onClick:j,children:e.jsxs("div",{style:t.panel,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:t.header,children:[e.jsxs("div",{style:t.headerLeft,children:[e.jsx(m,{style:t.headerIcon}),e.jsx("h2",{style:t.title,children:"User Warnings"})]}),e.jsxs("div",{style:t.headerRight,children:[e.jsxs("button",{onClick:()=>x(!0),style:t.addBtn,children:[e.jsx(_,{})," Add Warning"]}),e.jsx("button",{onClick:j,style:t.closeButton,children:e.jsx(k,{})})]})]}),e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:t.statCard,children:[e.jsx(m,{style:{...t.statIcon,color:"#f0b132"}}),e.jsx("div",{style:t.statValue,children:g.total_warnings}),e.jsx("div",{style:t.statLabel,children:"Total Warnings"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(m,{style:{...t.statIcon,color:"#43b581"}}),e.jsx("div",{style:t.statValue,children:g.active_warnings}),e.jsx("div",{style:t.statLabel,children:"Active"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(O,{style:{...t.statIcon,color:"#72767d"}}),e.jsx("div",{style:t.statValue,children:g.expired_warnings}),e.jsx("div",{style:t.statLabel,children:"Expired"})]}),e.jsxs("div",{style:t.statCard,children:[e.jsx(I,{style:{...t.statIcon,color:"#ed4245"}}),e.jsx("div",{style:t.statValue,children:g.auto_banned_users}),e.jsx("div",{style:t.statLabel,children:"Auto-Banned"})]})]}),e.jsxs("div",{style:t.searchBar,children:[e.jsx(U,{style:t.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search by username or reason...",value:u,onChange:s=>L(s.target.value),style:t.searchInput})]}),e.jsx("div",{style:t.warningsList,children:T?e.jsx("div",{style:t.loading,children:"Loading warnings..."}):Object.keys(C).length===0?e.jsxs("div",{style:t.empty,children:[e.jsx(m,{style:t.emptyIcon}),e.jsx("p",{children:"No warnings found"})]}):Object.values(C).map(({user_id:s,username:n,warnings:p})=>{const h=p.filter(o=>o.is_active),S=h.length>=2;return e.jsxs("div",{style:t.userCard,children:[e.jsxs("div",{style:t.userHeader,children:[e.jsxs("div",{style:t.userInfo,children:[e.jsx(G,{style:t.userIcon}),e.jsx("div",{style:t.userName,children:n}),e.jsxs("span",{style:{...t.badge,backgroundColor:S?"#ed4245":"#f0b132"},children:[h.length," Active Warning",h.length!==1?"s":""]}),S&&e.jsx("span",{style:t.riskBadge,children:"âš ï¸ AT RISK"})]}),h.length>=3&&e.jsxs("button",{onClick:()=>w(s,"Auto-ban: 3 warnings"),style:t.banBtn,children:[e.jsx(I,{})," Ban User"]})]}),e.jsx("div",{style:t.userWarnings,children:p.map(o=>e.jsxs("div",{style:{...t.warningItem,opacity:o.is_active?1:.5},children:[e.jsxs("div",{style:t.warningLeft,children:[e.jsx("div",{style:{...t.severityDot,backgroundColor:H(o.severity)}}),e.jsxs("div",{style:t.warningContent,children:[e.jsx("div",{style:t.warningReason,children:o.reason}),e.jsxs("div",{style:t.warningMeta,children:[e.jsx("span",{children:o.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(o.created_at).toLocaleString()}),o.expires_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Expires: ",new Date(o.expires_at).toLocaleDateString()]})]}),!o.is_active&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{style:{color:"#72767d"},children:"EXPIRED"})]})]})]})]}),o.is_active&&!o.is_auto&&e.jsx("button",{onClick:()=>$(o.id),style:t.removeBtn,title:"Remove warning",children:e.jsx(P,{})})]},o.id))})]},s)})}),F&&e.jsx("div",{style:t.modalOverlay,onClick:()=>x(!1),children:e.jsxs("div",{style:t.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:t.modalHeader,children:[e.jsx("h3",{style:t.modalTitle,children:"Add Warning"}),e.jsx("button",{onClick:()=>x(!1),style:t.modalClose,children:e.jsx(k,{})})]}),e.jsxs("div",{style:t.modalContent,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"User"}),e.jsxs("select",{value:r.user_id,onChange:s=>c({...r,user_id:s.target.value}),style:t.select,children:[e.jsx("option",{value:"",children:"Select user..."}),W.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Reason"}),e.jsx("textarea",{value:r.reason,onChange:s=>c({...r,reason:s.target.value}),placeholder:"Why is this warning being issued?",style:t.textarea,rows:"3"})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Severity"}),e.jsxs("select",{value:r.severity,onChange:s=>c({...r,severity:s.target.value}),style:t.select,children:[e.jsx("option",{value:"low",children:"ðŸŸ¢ Low"}),e.jsx("option",{value:"medium",children:"ðŸŸ¡ Medium"}),e.jsx("option",{value:"high",children:"ðŸ”´ High"})]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:r.expires_in_days,onChange:s=>c({...r,expires_in_days:parseInt(s.target.value)}),style:t.input,min:"1",max:"365"})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Auto-ban Threshold"}),e.jsx("input",{type:"number",value:r.auto_ban_on,onChange:s=>c({...r,auto_ban_on:parseInt(s.target.value)}),style:t.input,min:"2",max:"10"}),e.jsxs("div",{style:t.hint,children:["User will be auto-banned after reaching ",r.auto_ban_on," active warnings"]})]})]}),e.jsxs("div",{style:t.modalActions,children:[e.jsx("button",{onClick:()=>x(!1),style:t.cancelBtn,children:"Cancel"}),e.jsxs("button",{onClick:E,style:t.submitBtn,children:[e.jsx(_,{})," Add Warning"]})]})]})})]})})},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}};export{te as default};
