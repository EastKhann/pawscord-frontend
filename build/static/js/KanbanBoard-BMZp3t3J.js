import{r as i,j as e,b as B}from"./react-vendor-D8Fi5F9E.js";import{D as G,C as F,P as H}from"./ui-vendor-KQ6Wr7TQ.js";import{a as M,aF as W,aG as Y,aH as q,aI as X,m as K,Z as J}from"./icons-vendor-CfNiWYc_.js";import"./chart-vendor-Bq6p6uOO.js";const Z=({card:h,onClose:d,onSave:a,onDelete:c,columnTitle:C})=>{const[D,I]=i.useState(h.content||""),[_,k]=i.useState(h.description||""),[w,E]=i.useState(h.due_date?h.due_date.substring(0,16):""),[f,v]=i.useState(h.labels||[]),[p,R]=i.useState(h.checklist||[]),[x,T]=i.useState(""),A=[{color:"#ef5350",name:"Red"},{color:"#ffa726",name:"Orange"},{color:"#ffee58",name:"Yellow"},{color:"#66bb6a",name:"Green"},{color:"#42a5f5",name:"Blue"},{color:"#ab47bc",name:"Purple"}],z=()=>{x.trim()&&(R([...p,{text:x,done:!1}]),T(""))},L=n=>{const l=[...p];l[n].done=!l[n].done,R(l)},$=n=>{const l=[...p];l.splice(n,1),R(l)},N=n=>{const l=f.find(o=>o.color===n);v(l?f.filter(o=>o.color!==n):[...f,{color:n,text:""}])};return e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7)",zIndex:1e3,display:"flex",justifyContent:"center",alignItems:"center"},onClick:d,children:e.jsxs("div",{style:{backgroundColor:"#313338",width:"600px",maxHeight:"90vh",borderRadius:"8px",overflowY:"auto",padding:"20px",color:"#dbdee1",display:"flex",flexDirection:"column",gap:"20px",position:"relative"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{value:D,onChange:n=>I(n.target.value),style:{backgroundColor:"transparent",border:"none",color:"white",fontSize:"1.5em",fontWeight:"bold",width:"100%",outline:"none"}}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#949ba4",marginTop:"5px"},children:["in list ",e.jsx("span",{style:{color:"#dbdee1",fontWeight:"bold"},children:C})]})]}),e.jsx("button",{onClick:d,style:{background:"transparent",border:"none",color:"#b5bac1",cursor:"pointer",fontSize:"1.2em"},children:e.jsx(M,{})})]}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsxs("div",{style:{flex:3,display:"flex",flexDirection:"column",gap:"20px"},children:[f.length>0&&e.jsxs("div",{children:[e.jsx("h4",{style:{fontSize:"0.8em",color:"#949ba4",marginBottom:"8px"},children:"LABELS"}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:f.map((n,l)=>e.jsx("div",{style:{backgroundColor:n.color,width:"40px",height:"20px",borderRadius:"4px"}},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(W,{})," ",e.jsx("h3",{style:{margin:0,fontSize:"1em"},children:"Description"})]}),e.jsx("textarea",{value:_,onChange:n=>k(n.target.value),placeholder:"Add a more detailed description...",style:{width:"100%",minHeight:"100px",backgroundColor:"#383a40",border:"none",borderRadius:"4px",color:"#dbdee1",padding:"10px",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(Y,{})," ",e.jsx("h3",{style:{margin:0,fontSize:"1em"},children:"Checklist"})]}),p.length>0&&e.jsxs("div",{style:{marginBottom:"10px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("span",{style:{fontSize:"0.8em",color:"#949ba4"},children:[Math.round(p.filter(n=>n.done).length/p.length*100),"%"]}),e.jsx("div",{style:{flex:1,height:"6px",backgroundColor:"#383a40",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",backgroundColor:"#5865f2",width:`${p.filter(n=>n.done).length/p.length*100}%`}})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[p.map((n,l)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:n.done,onChange:()=>L(l),style:{cursor:"pointer"}}),e.jsx("span",{style:{flex:1,textDecoration:n.done?"line-through":"none",color:n.done?"#949ba4":"#dbdee1"},children:n.text}),e.jsx("button",{onClick:()=>$(l),style:{background:"transparent",border:"none",color:"#fa777c",cursor:"pointer"},children:e.jsx(M,{})})]},l)),e.jsxs("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:[e.jsx("input",{type:"text",value:x,onChange:n=>T(n.target.value),placeholder:"Add an item",onKeyDown:n=>n.key==="Enter"&&z(),style:{backgroundColor:"#383a40",border:"none",borderRadius:"4px",color:"white",padding:"8px",flex:1}}),e.jsx("button",{onClick:z,style:{backgroundColor:"#4752c4",color:"white",border:"none",borderRadius:"4px",padding:"0 15px",cursor:"pointer"},children:"Add"})]})]})]})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx("h4",{style:{fontSize:"0.8em",color:"#949ba4",margin:"0 0 5px 0"},children:"ADD TO CARD"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#dbdee1",padding:"5px",backgroundColor:"#383a40",borderRadius:"3px"},children:[e.jsx(q,{})," Labels"]}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap",padding:"5px"},children:A.map(n=>e.jsx("div",{onClick:()=>N(n.color),style:{width:"30px",height:"20px",backgroundColor:n.color,borderRadius:"3px",cursor:"pointer",border:f.find(l=>l.color===n.color)?"2px solid white":"none"},title:n.name},n.color))})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#dbdee1",padding:"5px",backgroundColor:"#383a40",borderRadius:"3px"},children:[e.jsx(X,{})," Due Date"]}),e.jsx("input",{type:"datetime-local",value:w,onChange:n=>E(n.target.value),style:{backgroundColor:"#383a40",border:"none",borderRadius:"3px",color:"white",padding:"5px",width:"100%"}})]}),e.jsxs("div",{style:{marginTop:"auto"},children:[e.jsx("h4",{style:{fontSize:"0.8em",color:"#949ba4",margin:"0 0 5px 0"},children:"ACTIONS"}),e.jsxs("button",{onClick:c,style:{width:"100%",padding:"8px",backgroundColor:"#da373c",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(K,{})," Delete Card"]})]})]})]}),e.jsx("div",{style:{marginTop:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"},children:e.jsx("button",{onClick:a,style:{padding:"10px 20px",backgroundColor:"#23a559",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold"},children:"Save Changes"})})]})})},Q=({roomSlug:h,apiBaseUrl:d,fetchWithAuth:a})=>{const[c,C]=i.useState([]),[D,I]=i.useState(""),[_,k]=i.useState(null),[w,E]=i.useState(null),[f,v]=i.useState(!1),[p,R]=i.useState("");i.useEffect(()=>{x()},[h]);const x=async()=>{const o=await a(`${d}/kanban/${h}/`);if(o.ok){const t=await o.json();C(t.columns||[])}},T=async o=>{if(!D.trim()){k(null);return}(await a(`${d}/kanban/cards/create/`,{method:"POST",body:JSON.stringify({column_id:o,content:D})})).ok&&await x(),I(""),k(null)},A=async o=>{if(!o.destination)return;const{source:t,destination:g,draggableId:b,type:u}=o;if(u==="COLUMN"){const r=Array.from(c),[y]=r.splice(t.index,1);r.splice(g.index,0,y),C(r),await a(`${d}/kanban/columns/move/`,{method:"POST",body:JSON.stringify({column_id:b,new_index:g.index})});return}const O=c.findIndex(r=>r.id.toString()===t.droppableId),s=c.findIndex(r=>r.id.toString()===g.droppableId),P=c[O],m=c[s],j=Array.from(P.cards||[]),S=Array.from(m.cards||[]);if(t.droppableId===g.droppableId){const[r]=j.splice(t.index,1);j.splice(g.index,0,r);const y=[...c];y[O]={...P,cards:j},C(y)}else{const[r]=j.splice(t.index,1);S.splice(g.index,0,r);const y=[...c];y[O]={...P,cards:j},y[s]={...m,cards:S},C(y),await a(`${d}/kanban/cards/update/`,{method:"POST",body:JSON.stringify({card_id:b,column_id:m.id})})}},z=(o,t)=>{E(o),R(t),v(!0)},L=async o=>{const t=c.map(g=>({...g,cards:g.cards.map(b=>b.id===o.id?o:b)}));C(t),await a(`${d}/kanban/cards/update/`,{method:"POST",body:JSON.stringify({card_id:o.id,content:o.content,description:o.description,due_date:o.due_date,labels:o.labels,checklist:o.checklist})}),x()},$=async()=>{w&&window.confirm("Are you sure you want to delete this card?")&&(await a(`${d}/kanban/cards/${w.id}/delete/`,{method:"DELETE"}),v(!1),x())},N=async()=>{const o=prompt("New Column Title:");o&&(await a(`${d}/kanban/columns/create/`,{method:"POST",body:JSON.stringify({room_slug:h,title:o})}),x())},n=async o=>{window.confirm("Delete this column and all its cards?")&&(await a(`${d}/kanban/columns/${o}/delete/`,{method:"DELETE"}),x())},l=async o=>{const t=prompt("Rename Column:",o.title);t&&t!==o.title&&(await a(`${d}/kanban/columns/update/`,{method:"POST",body:JSON.stringify({column_id:o.id,title:t})}),x())};return e.jsxs("div",{style:{display:"flex",height:"100%",overflowX:"auto",padding:"20px",gap:"15px",backgroundColor:"#313338"},children:[e.jsx(G,{onDragEnd:A,children:e.jsx(F,{droppableId:"board",type:"COLUMN",direction:"horizontal",children:o=>e.jsxs("div",{ref:o.innerRef,...o.droppableProps,style:{display:"flex",gap:"15px"},children:[c.map((t,g)=>e.jsx(H,{draggableId:t.id.toString(),index:g,children:b=>e.jsx("div",{ref:b.innerRef,...b.draggableProps,style:{...b.draggableProps.style,display:"flex",flexDirection:"column",minWidth:"280px",maxWidth:"280px"},children:e.jsxs("div",{style:{backgroundColor:"#2b2d31",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",maxHeight:"80vh"},children:[e.jsxs("div",{...b.dragHandleProps,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px",padding:"0 5px",cursor:"grab"},children:[e.jsxs("h3",{onClick:()=>l(t),style:{margin:0,color:"#f2f3f5",fontSize:"1em",fontWeight:"bold",cursor:"text"},title:"Click to rename",children:[t.title," ",e.jsxs("span",{style:{color:"#949ba4",fontSize:"0.8em"},children:["(",(t.cards||[]).length,")"]})]}),e.jsx("button",{onClick:()=>n(t.id),style:{background:"transparent",border:"none",color:"#b5bac1",cursor:"pointer"},children:e.jsx(K,{size:12})})]}),e.jsx(F,{droppableId:t.id.toString(),type:"CARD",children:(u,O)=>e.jsxs("div",{ref:u.innerRef,...u.droppableProps,style:{flexGrow:1,minHeight:"50px",overflowY:"auto",backgroundColor:O.isDraggingOver?"rgba(255,255,255,0.05)":"transparent",transition:"background-color 0.2s",padding:"2px"},children:[(t.cards||[]).map((s,P)=>e.jsx(H,{draggableId:s.id.toString(),index:P,children:(m,j)=>e.jsxs("div",{ref:m.innerRef,...m.draggableProps,...m.dragHandleProps,onClick:()=>z(s,t.title),style:{userSelect:"none",padding:"10px",marginBottom:"8px",backgroundColor:j.isDragging?"#40444b":"#2f3136",borderRadius:"4px",color:"#dcddde",boxShadow:"0 1px 0 rgba(0,0,0,0.25)",border:"1px solid #202225",cursor:"pointer",...m.draggableProps.style},children:[s.labels&&s.labels.length>0&&e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"5px",flexWrap:"wrap"},children:s.labels.map((S,r)=>e.jsx("div",{style:{backgroundColor:S.color,width:"30px",height:"6px",borderRadius:"3px"}},r))}),e.jsx("div",{style:{wordWrap:"break-word"},children:s.content}),(s.description||s.checklist&&s.checklist.length>0||s.due_date)&&e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"8px",fontSize:"0.8em",color:"#949ba4"},children:[s.description&&e.jsx("span",{children:"ðŸ“"}),s.checklist&&s.checklist.length>0&&e.jsxs("span",{children:["â˜‘ï¸ ",s.checklist.filter(S=>S.done).length,"/",s.checklist.length]}),s.due_date&&e.jsx("span",{children:"ðŸ“…"})]})]})},s.id)),u.placeholder]})}),_===t.id?e.jsxs("div",{style:{marginTop:10},children:[e.jsx("textarea",{autoFocus:!0,placeholder:"Enter a title...",value:D,onChange:u=>I(u.target.value),onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),T(t.id))},style:{width:"100%",padding:"8px",borderRadius:"4px",border:"none",backgroundColor:"#202225",color:"white",resize:"none",boxSizing:"border-box"}}),e.jsxs("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:[e.jsx("button",{onClick:()=>T(t.id),style:{backgroundColor:"#5865f2",color:"white",border:"none",padding:"5px 10px",borderRadius:"3px",cursor:"pointer"},children:"Add"}),e.jsx("button",{onClick:()=>k(null),style:{background:"transparent",color:"#bbb",border:"none",cursor:"pointer"},children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>{k(t.id),I("")},style:{width:"100%",padding:"8px",background:"transparent",border:"none",color:"#949ba4",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"5px",marginTop:"5px",borderRadius:"4px",":hover":{backgroundColor:"#35373c"}},children:[e.jsx(J,{})," Add Card"]})]})})},t.id)),o.placeholder,e.jsx("div",{style:{minWidth:"280px"},children:e.jsxs("button",{onClick:N,style:{width:"100%",padding:"12px",backgroundColor:"#ffffff10",color:"#f2f3f5",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(J,{})," Add another list"]})})]})})}),f&&w&&e.jsx(Z,{card:w,columnTitle:p,onClose:()=>v(!1),onSave:L,onDelete:$})]})},oe=B.memo(Q);export{oe as default};
