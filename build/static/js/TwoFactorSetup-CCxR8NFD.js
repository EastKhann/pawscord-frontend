import{r as o,b as e}from"./react-core-9vc7GIjk.js";import{t as y}from"./index-CsMvRys8.js";import{Q}from"./media-vendor-B-uSUaIv.js";import"./editor-vendor-DiU449Dh.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./icons-vendor-BHKL7tCa.js";import"./state-vendor-0vlBuk0v.js";const O=({onClose:i,fetchWithAuth:w,apiBaseUrl:k})=>{const[l,m]=o.useState(1),[E,g]=o.useState(""),[d,h]=o.useState(""),[b,N]=o.useState([]),[n,v]=o.useState(""),[u,r]=o.useState(""),[f,c]=o.useState(!1);o.useEffect(()=>{l===1&&C()},[l]);const C=async()=>{c(!0);try{const t=await w(`${k}/auth/2fa/setup/`,{method:"POST"});if(t.ok){const a=await t.json();h(a.secret);const s=await Q.toDataURL(a.otpauth_url);g(s)}else{const a=await t.json();r(a.error||"QR kod oluÅŸturulamadÄ±")}}catch(t){console.error("QR Code generation error:",t),r("BaÄŸlantÄ± hatasÄ±")}finally{c(!1)}},R=async()=>{if(n.length!==6){r("6 haneli kod giriniz");return}c(!0),r("");try{const t=await w(`${k}/auth/2fa/verify/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,secret:d})});if(t.ok){const a=await t.json();N(a.backup_codes),m(3)}else{const a=await t.json();r(a.error||"GeÃ§ersiz kod")}}catch(t){console.error("Verification error:",t),r("DoÄŸrulama hatasÄ±")}finally{c(!1)}},S=()=>{const t=b.join(`
`),a=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(a),p=document.createElement("a");p.href=s,p.download="pawscord-backup-codes.txt",p.click(),URL.revokeObjectURL(s)},D=()=>{y.success("âœ… 2FA baÅŸarÄ±yla etkinleÅŸtirildi!"),i(),window.location.reload()};return e.createElement("div",{className:"twofa-modal-overlay",onClick:i},e.createElement("div",{className:"twofa-modal-content",onClick:t=>t.stopPropagation()},e.createElement("button",{className:"twofa-close-btn",onClick:i},"Ã—"),e.createElement("h2",null,"ðŸ” Ä°ki FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama"),l===1&&e.createElement("div",{className:"twofa-step"},e.createElement("h3",null,"AdÄ±m 1: QR Kodu Tara"),e.createElement("p",null,"Google Authenticator veya Authy uygulamasÄ±yla bu QR kodu tarayÄ±n:"),f?e.createElement("div",{className:"twofa-loading"},"QR kod oluÅŸturuluyor..."):E?e.createElement(e.Fragment,null,e.createElement("img",{src:E,alt:"QR Code",className:"twofa-qr-code"}),e.createElement("div",{className:"twofa-secret"},e.createElement("p",null,e.createElement("strong",null,"Manuel Kod:")),e.createElement("code",null,d),e.createElement("button",{onClick:()=>{navigator.clipboard.writeText(d),y.success("âœ… Kod kopyalandÄ±!")},className:"twofa-copy-btn"},"ðŸ“‹ Kopyala")),e.createElement("button",{onClick:()=>m(2),className:"twofa-next-btn"},"Ä°leri â†’")):e.createElement("div",{className:"twofa-error"},u)),l===2&&e.createElement("div",{className:"twofa-step"},e.createElement("h3",null,"AdÄ±m 2: DoÄŸrulama Kodu"),e.createElement("p",null,"Authenticator uygulamasÄ±ndaki 6 haneli kodu girin:"),e.createElement("input",{type:"text",maxLength:"6",value:n,onChange:t=>v(t.target.value.replace(/\D/g,"")),placeholder:"000000",className:"twofa-code-input",autoFocus:!0}),u&&e.createElement("div",{className:"twofa-error"},u),e.createElement("div",{className:"twofa-buttons"},e.createElement("button",{onClick:()=>m(1),className:"twofa-back-btn"},"â† Geri"),e.createElement("button",{onClick:R,disabled:f||n.length!==6,className:"twofa-verify-btn"},f?"DoÄŸrulanÄ±yor...":"DoÄŸrula"))),l===3&&e.createElement("div",{className:"twofa-step"},e.createElement("h3",null,"AdÄ±m 3: Yedek Kodlar"),e.createElement("p",{className:"twofa-warning"},"âš ï¸ Bu kodlarÄ± gÃ¼venli bir yerde saklayÄ±n! Telefonunuza eriÅŸemediÄŸinizde bu kodlarÄ± kullanabilirsiniz."),e.createElement("div",{className:"twofa-backup-codes"},b.map((t,a)=>e.createElement("div",{key:a,className:"twofa-backup-code"},t))),e.createElement("div",{className:"twofa-buttons"},e.createElement("button",{onClick:S,className:"twofa-download-btn"},"ðŸ’¾ Ä°ndir"),e.createElement("button",{onClick:D,className:"twofa-complete-btn"},"âœ… Tamamla")))))};export{O as default};
