import{r as o,o as z,n as x,l as g,w as L,ay as A,Y as T,aE as D,a1 as I,V as h,ax as B,x as O,am as G}from"./react-core-B6hadH-M.js";import{t as $}from"./index-D_6pZib5.js";const H=({serverId:t,apiBaseUrl:c,onClose:d})=>{const[i,m]=o.useState([]),[r,u]=o.useState(!0),[s,E]=o.useState("all"),[l,v]=o.useState(""),[y,p]=o.useState(null),[R,K]=o.useState({total:0,unresolved:0,critical:0,resolved_today:0}),f={critical:{label:"Kritik",color:"#ef4444",icon:React.createElement(G,null)},high:{label:"Yüksek",color:"#f97316",icon:React.createElement(z,null)},medium:{label:"Orta",color:"#f59e0b",icon:React.createElement(O,null)},low:{label:"Düşük",color:"#3b82f6",icon:React.createElement(A,null)}},S={brute_force:"Brute Force Saldırısı",suspicious_login:"Şüpheli Giriş",unusual_activity:"Olağandışı Aktivite",permission_abuse:"Yetki Suistimali",spam_detected:"Spam Algılandı",raid_attempt:"Raid Girişimi",api_abuse:"API Suistimali",unauthorized_access:"Yetkisiz Erişim Denemesi"};o.useEffect(()=>{N(),_();const e=setInterval(N,3e4);return()=>clearInterval(e)},[t]);const N=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/security/alerts/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();m(n.alerts||[])}}catch(e){console.error("Fetch alerts error:",e)}finally{u(!1)}},_=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${c}/security/alerts/stats/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();K(n)}}catch(e){console.error("Fetch stats error:",e)}},C=async(e,a)=>{try{const n=localStorage.getItem("access_token");(await fetch(`${c}/security/alerts/${e}/resolve/`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({resolution:a})})).ok&&($.success("✅ Uyarı çözümlendi"),m(k=>k.map(b=>b.id===e?{...b,resolved:!0,resolution:a}:b)),p(null),_())}catch(n){console.error("Resolve alert error:",n)}},P=async e=>{try{const a=localStorage.getItem("access_token");(await fetch(`${c}/security/alerts/${e}/dismiss/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&($.success("Uyarı yok sayıldı"),m(w=>w.filter(k=>k.id!==e)))}catch(a){console.error("Dismiss alert error:",a)}},F=i.filter(e=>{const a=e.message?.toLowerCase().includes(l.toLowerCase())||e.source_ip?.includes(l)||e.user_info?.username?.toLowerCase().includes(l.toLowerCase()),n=s==="all"||s==="unresolved"&&!e.resolved||s==="resolved"&&e.resolved||s==="critical"&&e.severity==="critical";return a&&n});return React.createElement("div",{className:"security-alerts-overlay",onClick:d},React.createElement("div",{className:"security-alerts-panel",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"panel-header"},React.createElement("h2",null,React.createElement(z,null)," Güvenlik Uyarıları"),React.createElement("div",{className:"header-actions"},React.createElement("button",{className:"refresh-btn",onClick:N},React.createElement(x,null)),React.createElement("button",{className:"close-btn",onClick:d},React.createElement(g,null)))),React.createElement("div",{className:"stats-bar"},React.createElement("div",{className:"stat-item"},React.createElement("span",{className:"stat-value"},R.total),React.createElement("span",{className:"stat-label"},"Toplam")),React.createElement("div",{className:"stat-item danger"},React.createElement("span",{className:"stat-value"},R.unresolved),React.createElement("span",{className:"stat-label"},"Bekleyen")),React.createElement("div",{className:"stat-item critical"},React.createElement("span",{className:"stat-value"},R.critical),React.createElement("span",{className:"stat-label"},"Kritik")),React.createElement("div",{className:"stat-item success"},React.createElement("span",{className:"stat-value"},R.resolved_today),React.createElement("span",{className:"stat-label"},"Bugün Çözülen"))),React.createElement("div",{className:"toolbar"},React.createElement("div",{className:"search-box"},React.createElement(L,null),React.createElement("input",{type:"text",placeholder:"Uyarı, IP veya kullanıcı ara...",value:l,onChange:e=>v(e.target.value)})),React.createElement("div",{className:"filter-buttons"},["all","unresolved","resolved","critical"].map(e=>React.createElement("button",{key:e,className:`filter-btn ${s===e?"active":""}`,onClick:()=>E(e)},e==="all"&&"Tümü",e==="unresolved"&&"Bekleyen",e==="resolved"&&"Çözülen",e==="critical"&&"Kritik")))),React.createElement("div",{className:"panel-content"},r?React.createElement("div",{className:"loading"},"Yükleniyor..."):F.length===0?React.createElement("div",{className:"empty-state"},React.createElement(A,null),React.createElement("p",null,"Güvenlik uyarısı bulunmuyor"),React.createElement("span",null,"Sisteminiz güvende görünüyor")):React.createElement("div",{className:"alerts-list"},F.map(e=>React.createElement(Y,{key:e.id,alert:e,severityLevels:f,alertTypes:S,onView:()=>p(e),onDismiss:()=>P(e.id),onResolve:a=>C(e.id,a)})))),y&&React.createElement(j,{alert:y,severityLevels:f,alertTypes:S,onClose:()=>p(null),onResolve:e=>C(y.id,e)})))},Y=({alert:t,severityLevels:c,alertTypes:d,onView:i,onDismiss:m,onResolve:r})=>{const u=c[t.severity]||c.low;return React.createElement("div",{className:`alert-card ${t.severity} ${t.resolved?"resolved":""}`},React.createElement("div",{className:"alert-severity",style:{background:u.color}},u.icon),React.createElement("div",{className:"alert-content"},React.createElement("div",{className:"alert-header"},React.createElement("span",{className:"alert-type"},d[t.type]||t.type),React.createElement("span",{className:"alert-time"},React.createElement(T,null)," ",new Date(t.created_at).toLocaleString("tr-TR"))),React.createElement("p",{className:"alert-message"},t.message),React.createElement("div",{className:"alert-meta"},t.source_ip&&React.createElement("span",null,React.createElement(D,null)," ",t.source_ip),t.user_info&&React.createElement("span",null,React.createElement(I,null)," ",t.user_info.username),t.resolved&&React.createElement("span",{className:"resolved-badge"},React.createElement(h,null)," Çözümlendi"))),React.createElement("div",{className:"alert-actions"},React.createElement("button",{className:"view-btn",onClick:i},React.createElement(B,null)),!t.resolved&&React.createElement(React.Fragment,null,React.createElement("button",{className:"resolve-btn",onClick:()=>r("Hızlı çözüm")},React.createElement(h,null)),React.createElement("button",{className:"dismiss-btn",onClick:m},React.createElement(g,null)))))},j=({alert:t,severityLevels:c,alertTypes:d,onClose:i,onResolve:m})=>{const[r,u]=o.useState(""),s=c[t.severity]||c.low,E=["False positive - Normal aktivite","Kullanıcı uyarıldı","IP engellendi","Hesap askıya alındı","İncelendi - Aksiyon gerekmiyor"];return React.createElement("div",{className:"modal-overlay",onClick:i},React.createElement("div",{className:"alert-detail-modal",onClick:l=>l.stopPropagation()},React.createElement("div",{className:"modal-header",style:{borderLeftColor:s.color}},React.createElement("div",{className:"severity-badge",style:{background:s.color}},s.icon," ",s.label),React.createElement("button",{className:"close-modal",onClick:i},React.createElement(g,null))),React.createElement("div",{className:"modal-content"},React.createElement("h3",null,d[t.type]||t.type),React.createElement("p",{className:"detail-message"},t.message),React.createElement("div",{className:"detail-section"},React.createElement("h4",null,"Detaylar"),React.createElement("div",{className:"detail-grid"},React.createElement("div",{className:"detail-item"},React.createElement("label",null,React.createElement(T,null)," Zaman"),React.createElement("span",null,new Date(t.created_at).toLocaleString("tr-TR"))),t.source_ip&&React.createElement("div",{className:"detail-item"},React.createElement("label",null,React.createElement(D,null)," Kaynak IP"),React.createElement("span",{className:"mono"},t.source_ip)),t.user_info&&React.createElement(React.Fragment,null,React.createElement("div",{className:"detail-item"},React.createElement("label",null,React.createElement(I,null)," Kullanıcı"),React.createElement("span",null,t.user_info.username)),React.createElement("div",{className:"detail-item"},React.createElement("label",null,"Kullanıcı ID"),React.createElement("span",{className:"mono"},t.user_info.id))),t.location&&React.createElement("div",{className:"detail-item"},React.createElement("label",null,"Konum"),React.createElement("span",null,t.location)))),t.additional_data&&React.createElement("div",{className:"detail-section"},React.createElement("h4",null,"Ek Veriler"),React.createElement("pre",{className:"json-data"},JSON.stringify(t.additional_data,null,2))),!t.resolved&&React.createElement("div",{className:"resolution-section"},React.createElement("h4",null,"Çözüm"),React.createElement("div",{className:"quick-resolutions"},E.map((l,v)=>React.createElement("button",{key:v,className:`quick-res-btn ${r===l?"active":""}`,onClick:()=>u(l)},l))),React.createElement("textarea",{value:r,onChange:l=>u(l.target.value),placeholder:"Veya özel bir çözüm notu yazın...",rows:"3"}))),React.createElement("div",{className:"modal-actions"},React.createElement("button",{className:"cancel-btn",onClick:i},"Kapat"),!t.resolved&&React.createElement("button",{className:"resolve-btn",onClick:()=>m(r||"Çözümlendi"),disabled:!r},React.createElement(h,null)," Çözümle"))))};export{H as default};
