var Q=Object.defineProperty;var t=(l,c)=>Q(l,"name",{value:c,configurable:!0});import{r as n,j as s}from"./react-core-Djgtqrmb.js";import{br as F,an as L,t as K,V,al as k,a as $,g as q}from"./icons-vendor-BMXAt4pj.js";function X({apiBaseUrl:l,fetchWithAuth:c}){const[u,N]=n.useState([]),[g,p]=n.useState([]),[i,v]=n.useState([]),[d,E]=n.useState(""),[_,m]=n.useState(!1),[h,f]=n.useState(""),[y,b]=n.useState("#5865f2"),[O,T]=n.useState(!1),[C,r]=n.useState(""),P=["#5865f2","#43b581","#f04747","#faa61a","#9b59b6","#3498db","#e91e63","#00bcd4","#ff9800","#4caf50"];n.useEffect(()=>{j(),J()},[]);const j=t(async()=>{T(!0);try{const e=await c(`${l}/messages/readlater/list/`);if(e.ok){const o=await e.json();N(o.bookmarks||[])}}catch(e){r("Failed to load bookmarks: "+e.message)}finally{T(!1)}},"loadBookmarks"),J=t(async()=>{try{const e=await c(`${l}/bookmarks/tags/list/`);if(e.ok){const o=await e.json();p(o.tags||[])}}catch{}},"loadTags"),w=t(async()=>{if(!h.trim()){r("Tag name cannot be empty");return}try{const e=await c(`${l}/bookmarks/tags/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h,color:y})});if(e.ok){const o=await e.json();p([...g,o.tag]),f(""),b("#5865f2"),m(!1),r("")}else{const o=await e.json();r(o.error||"Failed to create tag")}}catch(e){r("Network error: "+e.message)}},"createTag"),R=t(async e=>{try{(await c(`${l}/messages/readlater/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(N(u.filter(a=>a.message_id!==e)),r(""))}catch(o){r("Failed to remove bookmark: "+o.message)}},"removeBookmark"),D=t(async(e,o)=>{try{(await c(`${l}/bookmarks/tags/${o}/add/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(j(),r(""))}catch(a){r("Failed to add tag: "+a.message)}},"addTagToBookmark"),B=t(async(e,o)=>{try{(await c(`${l}/bookmarks/tags/${o}/remove/`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:e})})).ok&&(j(),r(""))}catch(a){r("Failed to remove tag: "+a.message)}},"removeTagFromBookmark"),M=t(e=>{i.includes(e)?v(i.filter(o=>o!==e)):v([...i,e])},"toggleTagFilter"),S=u.filter(e=>{const o=d===""||e.content.toLowerCase().includes(d.toLowerCase())||e.author.toLowerCase().includes(d.toLowerCase()),a=i.length===0||e.tags?.some(x=>i.includes(x.id));return o&&a});return s.jsxs("div",{className:"readlater-panel",children:[s.jsxs("div",{className:"readlater-header",children:[s.jsxs("h2",{children:[s.jsx(F,{})," Read Later"]}),s.jsxs("button",{className:"create-tag-btn",onClick:t(()=>m(!0),"onClick"),children:[s.jsx(L,{})," New Tag"]})]}),C&&s.jsx("div",{className:"rl-error",children:C}),s.jsxs("div",{className:"readlater-controls",children:[s.jsxs("div",{className:"search-box",children:[s.jsx(K,{className:"search-icon"}),s.jsx("input",{type:"text",placeholder:"Search bookmarks...",value:d,onChange:t(e=>E(e.target.value),"onChange"),className:"search-input"})]}),s.jsxs("div",{className:"tag-filters",children:[s.jsx(V,{className:"filter-icon"}),s.jsx("div",{className:"tag-filter-list",children:g.map(e=>s.jsxs("button",{className:`tag-filter ${i.includes(e.id)?"active":""}`,style:{borderColor:e.color},onClick:t(()=>M(e.id),"onClick"),children:[s.jsx(k,{style:{color:e.color}}),e.name]},e.id))})]})]}),s.jsx("div",{className:"bookmarks-list",children:O?s.jsx("div",{className:"rl-loading",children:"Loading bookmarks..."}):S.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx(F,{className:"empty-icon"}),s.jsx("p",{children:"No bookmarks found"}),s.jsx("span",{children:"Save messages with the bookmark button to read them later"})]}):S.map((e,o)=>s.jsxs("div",{className:"bookmark-item",children:[s.jsxs("div",{className:"bookmark-header",children:[s.jsxs("div",{className:"bookmark-author",children:[s.jsx("img",{src:e.author_avatar||"/default-avatar.png",alt:e.author,className:"author-avatar"}),s.jsx("span",{className:"author-name",children:e.author})]}),s.jsx("div",{className:"bookmark-date",children:new Date(e.saved_at).toLocaleDateString()})]}),s.jsx("div",{className:"bookmark-content",children:e.content}),s.jsxs("div",{className:"bookmark-footer",children:[s.jsxs("div",{className:"bookmark-tags",children:[e.tags?.map(a=>s.jsxs("span",{className:"bookmark-tag",style:{borderColor:a.color,color:a.color},children:[s.jsx(k,{}),a.name,s.jsx($,{className:"remove-tag-icon",onClick:t(()=>B(e.message_id,a.id),"onClick")})]},a.id)),s.jsxs("select",{className:"add-tag-select",onChange:t(a=>{a.target.value&&(D(e.message_id,parseInt(a.target.value)),a.target.value="")},"onChange"),children:[s.jsx("option",{value:"",children:"+ Add Tag"}),g.filter(a=>!e.tags?.find(x=>x.id===a.id)).map(a=>s.jsx("option",{value:a.id,children:a.name},a.id))]})]}),s.jsxs("button",{className:"remove-bookmark-btn",onClick:t(()=>R(e.message_id),"onClick"),children:[s.jsx(q,{})," Remove"]})]})]},o))}),_&&s.jsx("div",{className:"modal-overlay",onClick:t(()=>m(!1),"onClick"),children:s.jsxs("div",{className:"modal-content",onClick:t(e=>e.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h3",{children:[s.jsx(k,{})," Create New Tag"]}),s.jsx("button",{className:"modal-close",onClick:t(()=>m(!1),"onClick"),children:s.jsx($,{})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Tag Name"}),s.jsx("input",{type:"text",className:"tag-input",placeholder:"Enter tag name...",value:h,onChange:t(e=>f(e.target.value),"onChange"),onKeyPress:t(e=>e.key==="Enter"&&w(),"onKeyPress")})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Tag Color"}),s.jsx("div",{className:"color-picker",children:P.map(e=>s.jsx("button",{className:`color-option ${y===e?"selected":""}`,style:{backgroundColor:e},onClick:t(()=>b(e),"onClick")},e))})]}),s.jsxs("button",{className:"create-tag-submit",onClick:w,children:[s.jsx(L,{})," Create Tag"]})]})]})})]})}t(X,"ReadLaterPanel");export{X as default};
