import{r,j as t}from"./react-core-D6cE4lil.js";import{q as F,u as D,aV as I,a5 as J,aY as M,aN as P}from"./icons-vendor-fClA8qVL.js";import{t as R}from"./index-DHLSv4f5.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-Drccqhv1.js";import"./ui-vendor-CZOhtEfS.js";const U={javascript:"js",python:"py",typescript:"ts",html:"html",css:"css",java:"java",cpp:"cpp"},K=({roomId:f,userId:x,username:L,apiBaseUrl:p,fetchWithAuth:g,websocket:l})=>{const[d,C]=r.useState(`// Start coding...
`),[s,m]=r.useState("javascript"),[w,u]=r.useState(""),[j,y]=r.useState([]),[S,h]=r.useState(!1),[E,b]=r.useState(!1),c=r.useRef(null),k=r.useRef(null),v=r.useRef(new Map),_=e=>{e.user_id!==x&&window.monacoEditor&&window.monacoEditor.setValue(e.code)},N=e=>{if(e.user_id===x)return;const o=window.monacoEditor,i=k.current;if(!o||!i)return;const a=v.current.get(e.user_id);a&&o.deltaDecorations(a,[]);const z=o.deltaDecorations([],[{range:new i.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:`remote-cursor remote-cursor-${e.user_id}`,hoverMessage:{value:`**${e.username}**`}}}]);v.current.set(e.user_id,z)},B=e=>y(o=>[...o,{id:e.user_id,username:e.username,color:e.color||"#5865f2"}]),O=e=>{y(i=>i.filter(a=>a.id!==e.user_id));const o=v.current.get(e.user_id);o&&window.monacoEditor&&window.monacoEditor.deltaDecorations(o,[]),v.current.delete(e.user_id)},T=()=>{l&&l.addEventListener("message",e=>{const o=JSON.parse(e.data);o.type==="code_update"?_(o):o.type==="cursor_update"?N(o):o.type==="collaborator_joined"?B(o):o.type==="collaborator_left"&&O(o)})},$=async()=>{try{const e=await g(`${p}/code-editor/load/?room_id=${f}`);if(e.ok){const o=await e.json();o.code&&(C(o.code),m(o.language||"javascript"),window.monacoEditor&&(window.monacoEditor.setValue(o.code),window.monacoEditor.setLanguage(o.language||"javascript")))}}catch{}};return r.useEffect(()=>(T(),$(),()=>{window.monacoEditor&&(window.monacoEditor.dispose(),delete window.monacoEditor),l&&l.close()}),[]),{code:d,language:s,output:w,collaborators:j,saving:S,running:E,editorRef:c,saveCode:async()=>{h(!0);try{(await g(`${p}/code-editor/save/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:f,code:d,language:s})})).ok&&R.success("✅ Kod kaydedildi!")}catch{R.error("❌ Kaydetme başarısız")}finally{h(!1)}},runCode:async()=>{b(!0),u("Çalıştırılıyor...");try{const e=await g(`${p}/code-editor/run/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,language:s})});if(e.ok){const o=await e.json();u(o.output||"No output")}else{const o=await e.json();u(`Error: ${o.error||"Execution failed"}`)}}catch(e){u(`Error: ${e.message}`)}finally{b(!1)}},copyCode:()=>{navigator.clipboard.writeText(d),R.success("✅ Kod kopyalandı!")},downloadCode:()=>{const e=U[s]||"txt",o=new Blob([d],{type:"text/plain"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=`code.${e}`,a.click(),URL.revokeObjectURL(i)},changeLanguage:e=>{m(e),window.monacoEditor&&k.current&&k.current.editor.setModelLanguage(window.monacoEditor.getModel(),e)}}},n={container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#1e1e1e"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{color:"#5865f2",fontSize:"20px"},title:{margin:0,fontSize:"16px",fontWeight:"600",color:"#cccccc"},languageSelect:{backgroundColor:"#3c3c3c",border:"1px solid #3e3e42",borderRadius:"4px",color:"#cccccc",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},headerRight:{display:"flex",alignItems:"center",gap:"8px"},collaborators:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"6px 12px",borderRadius:"4px",fontSize:"13px",color:"#cccccc"},actionButton:{backgroundColor:"#3c3c3c",border:"none",borderRadius:"4px",color:"#cccccc",padding:"8px 12px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"},saveButton:{backgroundColor:"#5865f2",color:"#fff"},runButton:{backgroundColor:"#3ba55d",color:"#fff"},editorContainer:{flex:1,position:"relative",overflow:"hidden"},editor:{width:"100%",height:"100%"},outputPanel:{height:"200px",backgroundColor:"#1e1e1e",borderTop:"1px solid #3e3e42",display:"flex",flexDirection:"column"},outputHeader:{padding:"8px 16px",backgroundColor:"#2d2d30",borderBottom:"1px solid #3e3e42",fontSize:"13px",fontWeight:"600",color:"#cccccc"},outputContent:{flex:1,margin:0,padding:"12px 16px",color:"#d4d4d4",fontSize:"13px",fontFamily:'Consolas, Monaco, "Courier New", monospace',overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}},H=[{value:"javascript",label:"JavaScript"},{value:"typescript",label:"TypeScript"},{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"},{value:"html",label:"HTML"},{value:"css",label:"CSS"}],re=({roomId:f,userId:x,username:L,apiBaseUrl:p,fetchWithAuth:g,websocket:l,onClose:d})=>{const{language:C,output:s,collaborators:m,saving:w,running:u,editorRef:j,saveCode:y,runCode:S,copyCode:h,downloadCode:E,changeLanguage:b}=K({roomId:f,userId:x,username:L,apiBaseUrl:p,fetchWithAuth:g,websocket:l});return t.jsxs("div",{style:n.container,children:[t.jsxs("div",{style:n.header,children:[t.jsxs("div",{style:n.headerLeft,children:[t.jsx(F,{style:n.headerIcon}),t.jsx("h2",{style:n.title,children:"Code Editor"}),t.jsx("select",{value:C,onChange:c=>b(c.target.value),style:n.languageSelect,children:H.map(c=>t.jsx("option",{value:c.value,children:c.label},c.value))})]}),t.jsxs("div",{style:n.headerRight,children:[t.jsxs("div",{style:n.collaborators,children:[t.jsx(D,{style:{marginRight:"6px"}}),t.jsx("span",{children:m.length+1})]}),t.jsx("button",{onClick:h,style:n.actionButton,title:"Kopyala",children:t.jsx(I,{})}),t.jsx("button",{onClick:E,style:n.actionButton,title:"İndir",children:t.jsx(J,{})}),t.jsx("button",{onClick:y,disabled:w,style:{...n.actionButton,...n.saveButton},title:"Kaydet",children:t.jsx(M,{})}),t.jsx("button",{onClick:S,disabled:u,style:{...n.actionButton,...n.runButton},title:"Çalıştır",children:t.jsx(P,{})})]})]}),t.jsx("div",{style:n.editorContainer,children:t.jsx("div",{ref:j,style:n.editor})}),s&&t.jsxs("div",{style:n.outputPanel,children:[t.jsx("div",{style:n.outputHeader,children:t.jsx("span",{children:"Output"})}),t.jsx("pre",{style:n.outputContent,children:s})]})]})};export{re as default};
