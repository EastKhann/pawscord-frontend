import{r as c,n as s}from"./react-core-CvG1duuD.js";import{bT as h,as as l,b_ as w,aU as N,a$ as b,a_ as C}from"./icons-vendor-DhG1XKwU.js";import"./editor-vendor-D9c4a6XZ.js";function T({apiBaseUrl:n,fetchWithAuth:i}){const[d,y]=c.useState(!1),[e,x]=c.useState(null),[m,j]=c.useState(!0),[p,o]=c.useState(!1),[u,r]=c.useState("");c.useEffect(()=>{if(g(),d){f();const a=setInterval(f,3e4);return()=>clearInterval(a)}},[d]);const g=async()=>{try{const a=await i(`${n}/auth/spotify/status/`);if(a.ok){const t=await a.json();y(t.connected),j(t.show_activity)}}catch{}},v=async()=>{o(!0);try{const a=await i(`${n}/auth/spotify/start/`);if(a.ok){const t=await a.json();window.location.href=t.url||t.auth_url}}catch(a){r("Failed to connect: "+a.message)}finally{o(!1)}},k=async()=>{o(!0);try{(await i(`${n}/auth/spotify/disconnect/`,{method:"POST"})).ok&&(y(!1),x(null),r(""))}catch(a){r("Failed to disconnect: "+a.message)}finally{o(!1)}},f=async()=>{try{const a=await i(`${n}/spotify/current-track/`);if(a.ok){const t=await a.json();x(t.track)}}catch{}},S=async()=>{try{(await i(`${n}/spotify/toggle-activity/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({show_activity:!m})})).ok&&j(!m)}catch(a){r("Failed to toggle activity: "+a.message)}};return s.jsxs("div",{className:"spotify-panel",children:[s.jsx("div",{className:"spotify-header",children:s.jsxs("h2",{children:[s.jsx(h,{className:"spotify-icon"})," Spotify Integration"]})}),u&&s.jsx("div",{className:"spotify-error",children:u}),d?s.jsxs("div",{className:"spotify-connected",children:[s.jsxs("div",{className:"connection-status",children:[s.jsx(l,{className:"status-icon"}),s.jsx("span",{children:"Connected to Spotify"}),s.jsxs("button",{className:"disconnect-btn",onClick:k,disabled:p,children:[s.jsx(w,{})," Disconnect"]})]}),s.jsx("div",{className:"activity-toggle",children:s.jsxs("label",{className:"toggle-label",children:[s.jsx("input",{type:"checkbox",checked:m,onChange:S}),s.jsx("span",{className:"toggle-slider"}),s.jsx("span",{className:"toggle-text",children:"Show listening activity"})]})}),e?s.jsxs("div",{className:"current-track",children:[s.jsxs("div",{className:"track-header",children:[s.jsx(N,{className:"music-icon"}),s.jsx("h3",{children:"Now Playing"})]}),s.jsxs("div",{className:"track-info",children:[e.album_art&&s.jsx("img",{src:e.album_art,alt:"Album art",className:"album-art"}),s.jsxs("div",{className:"track-details",children:[s.jsx("div",{className:"track-name",children:e.name}),s.jsx("div",{className:"track-artist",children:e.artist}),s.jsx("div",{className:"track-album",children:e.album})]}),s.jsx("div",{className:"track-status",children:e.is_playing?s.jsx(b,{className:"playing-icon"}):s.jsx(C,{className:"paused-icon"})})]}),s.jsx("div",{className:"track-progress",children:s.jsx("div",{className:"progress-bar",style:{width:`${e.progress_percent||0}%`}})})]}):s.jsxs("div",{className:"no-track",children:[s.jsx(N,{className:"no-track-icon"}),s.jsx("p",{children:"Not playing anything right now"})]})]}):s.jsxs("div",{className:"spotify-connect",children:[s.jsx("div",{className:"spotify-logo-container",children:s.jsx(h,{className:"spotify-logo"})}),s.jsx("h3",{children:"Connect Your Spotify"}),s.jsx("p",{children:"Share what you're listening to with your friends!"}),s.jsxs("button",{className:"connect-btn",onClick:v,disabled:p,children:[s.jsx(h,{})," Connect Spotify"]}),s.jsxs("div",{className:"spotify-features",children:[s.jsxs("div",{className:"feature-item",children:[s.jsx(l,{className:"check-icon"}),s.jsx("span",{children:"Show currently playing track"})]}),s.jsxs("div",{className:"feature-item",children:[s.jsx(l,{className:"check-icon"}),s.jsx("span",{children:"Display in your status"})]}),s.jsxs("div",{className:"feature-item",children:[s.jsx(l,{className:"check-icon"}),s.jsx("span",{children:"Privacy controls"})]})]})]})]})}export{T as default};
