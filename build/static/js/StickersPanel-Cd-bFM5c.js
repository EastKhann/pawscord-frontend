import{r as c}from"./react-core-B6hadH-M.js";import{h as B}from"./index-D_6pZib5.js";const z=({serverId:l,onClose:d})=>{const[r,p]=c.useState([]),[u,w]=c.useState([]),[E,n]=c.useState(!0),[s,R]=c.useState("my-stickers"),[C,i]=c.useState(!1),[g,f]=c.useState(!1),[o,h]=c.useState(""),[m,N]=c.useState(null),[y,v]=c.useState("");c.useEffect(()=>{s==="my-stickers"?S():b()},[s,l]);const S=async()=>{try{n(!0);const e=localStorage.getItem("access_token"),t=await fetch(`/api/stickers/${l}/list/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const a=await t.json();p(a.stickers||[])}}catch(e){console.error("Error fetching stickers:",e)}finally{n(!1)}},b=async()=>{try{n(!0);const e=localStorage.getItem("access_token"),t=await fetch("/api/stickers/packs/",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const a=await t.json();w(a.packs||[])}}catch(e){console.error("Error fetching sticker packs:",e)}finally{n(!1)}},P=async()=>{if(!o.trim()||!m){console.error("âŒ Please provide sticker name and file");return}const e=new FormData;e.append("name",o),e.append("sticker",m);try{f(!0);const t=localStorage.getItem("access_token"),a=await fetch(`/api/stickers/${l}/upload/`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:e});if(a.ok)i(!1),h(""),N(null),v(""),S();else{const k=await a.json();console.error("âŒ",k.error||"Failed to upload sticker")}}catch(t){console.error("Error uploading sticker:",t)}finally{f(!1)}},$=async e=>{if(await B("Delete this sticker?"))try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?p(r.filter(k=>k.id!==e)):console.error("âŒ Failed to delete sticker")}catch(t){console.error("Error deleting sticker:",t)}},F=async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`/api/stickers/${l}/install-pack/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({pack_id:e})})).ok?b():console.error("âŒ Failed to install pack")}catch(t){console.error("Error installing pack:",t)}},U=e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/")){console.error("âŒ Please select an image file");return}if(t.size>512*1024){console.error("âŒ File size must be less than 512KB");return}N(t),v(URL.createObjectURL(t))}};return React.createElement("div",{className:"stickers-panel-overlay",onClick:d},React.createElement("div",{className:"stickers-panel-modal",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"stickers-panel-header"},React.createElement("h2",null,"ðŸŽ¨ Stickers"),React.createElement("button",{className:"close-btn",onClick:d},"âœ•")),React.createElement("div",{className:"stickers-tabs"},React.createElement("button",{className:`tab-btn ${s==="my-stickers"?"active":""}`,onClick:()=>R("my-stickers")},"ðŸ“ My Stickers"),React.createElement("button",{className:`tab-btn ${s==="packs"?"active":""}`,onClick:()=>R("packs")},"ðŸ“¦ Sticker Packs")),React.createElement("div",{className:"stickers-panel-content"},s==="my-stickers"&&React.createElement(React.Fragment,null,React.createElement("div",{className:"sticker-actions"},React.createElement("button",{className:"upload-sticker-btn",onClick:()=>i(!0)},"âž• Upload Sticker"),React.createElement("p",{className:"sticker-count"},r.length," stickers")),E?React.createElement("div",{className:"loading-spinner"},"Loading stickers..."):r.length===0?React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-icon"},"ðŸŽ¨"),React.createElement("h3",null,"No Stickers Yet"),React.createElement("p",null,"Upload your first custom sticker")):React.createElement("div",{className:"stickers-grid"},r.map(e=>React.createElement("div",{key:e.id,className:"sticker-card"},React.createElement("img",{src:e.url,alt:e.name,className:"sticker-image"}),React.createElement("div",{className:"sticker-name"},e.name),React.createElement("button",{className:"delete-sticker-btn",onClick:()=>$(e.id),title:"Delete"},"ðŸ—‘ï¸"))))),s==="packs"&&React.createElement(React.Fragment,null,E?React.createElement("div",{className:"loading-spinner"},"Loading packs..."):u.length===0?React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-icon"},"ðŸ“¦"),React.createElement("h3",null,"No Packs Available"),React.createElement("p",null,"Check back later for new sticker packs")):React.createElement("div",{className:"packs-grid"},u.map(e=>React.createElement("div",{key:e.id,className:"pack-card"},React.createElement("div",{className:"pack-preview"},e.preview_stickers?.slice(0,4).map((t,a)=>React.createElement("img",{key:a,src:t.url,alt:"",className:"pack-preview-img"}))),React.createElement("div",{className:"pack-info"},React.createElement("h3",null,e.name),React.createElement("p",null,e.sticker_count," stickers")),React.createElement("button",{className:`install-pack-btn ${e.installed?"installed":""}`,onClick:()=>!e.installed&&F(e.id),disabled:e.installed},e.installed?"âœ“ Installed":"âž• Install")))))),C&&React.createElement("div",{className:"upload-modal-overlay",onClick:()=>i(!1)},React.createElement("div",{className:"upload-modal",onClick:e=>e.stopPropagation()},React.createElement("h3",null,"âž• Upload Sticker"),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Sticker Name"),React.createElement("input",{type:"text",value:o,onChange:e=>h(e.target.value),placeholder:"My Sticker",maxLength:32,className:"sticker-name-input"})),React.createElement("div",{className:"form-group"},React.createElement("label",null,"Sticker Image"),React.createElement("div",{className:"file-upload-area",onClick:()=>document.getElementById("sticker-file").click()},y?React.createElement("img",{src:y,alt:"Preview",className:"upload-preview"}):React.createElement(React.Fragment,null,React.createElement("div",{className:"upload-icon"},"ðŸ“¤"),React.createElement("p",null,"Click to select image"),React.createElement("p",{className:"upload-hint"},"PNG, GIF â€¢ Max 512KB â€¢ 512x512px recommended"))),React.createElement("input",{id:"sticker-file",type:"file",accept:"image/*",onChange:U,style:{display:"none"}})),React.createElement("div",{className:"modal-actions"},React.createElement("button",{className:"cancel-btn",onClick:()=>i(!1)},"Cancel"),React.createElement("button",{className:"upload-btn",onClick:P,disabled:g||!o||!m},g?"Uploading...":"Upload"))))))};export{z as default};
