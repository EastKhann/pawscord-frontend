var z=Object.defineProperty;var a=(o,c)=>z(o,"name",{value:c,configurable:!0});import{r as i,j as s}from"./react-core-Djgtqrmb.js";import{B as w,a as H,cG as E,aF as k,z as f,av as m,v as A,aV as P,a5 as I,bv as O,aE as J}from"./icons-vendor-BMXAt4pj.js";import{p as K}from"./purify.es-CVaxJkcz.js";const X=a(({channelId:o,onClose:c,fetchWithAuth:d,apiBaseUrl:h})=>{const[_,y]=i.useState(!1),[n,u]=i.useState([]),[t,v]=i.useState(null),[N,S]=i.useState(!1),[x,F]=i.useState("24h"),[j,D]=i.useState(100),[g,L]=i.useState(o),[C,b]=i.useState([]);i.useEffect(()=>{$()},[o]);const $=a(async()=>{y(!0);try{const e=await d(`${h}/rooms/list/`);if(e.ok){const l=await e.json();b(l.rooms||l||[])}const r=await d(`${h}/messages/summaries/`);if(r.ok){const l=await r.json();u(l.summaries||l||[])}}catch{b([]),u([])}y(!1)},"loadData"),M=a(async()=>{S(!0);try{const e=await d(`${h}/messages/summarize/`,{method:"POST",body:JSON.stringify({channel_id:g,time_range:x,message_count:j})});if(e.ok){const r=await e.json(),l={id:r.id||Date.now(),channel:C.find(G=>G.id===g)?.name||"general",created_at:new Date().toISOString(),time_range:x,message_count:r.message_count||j,summary:r.summary||"Özet oluşturulamadı.",keywords:r.keywords||[],participants:r.participants||0};v(l),u([l,...n])}}catch{}S(!1)},"generateSummary"),p=a(e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),"formatDate"),R=a(e=>{navigator.clipboard.writeText(e)},"copyToClipboard"),T=a(e=>{`${e.channel}${p(e.created_at)}${e.message_count}${e.time_range}${e.summary}`},"exportSummary");return _?s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsx("div",{className:"summary-panel",onClick:a(e=>e.stopPropagation(),"onClick"),children:s.jsx("div",{className:"loading",children:"Loading message summary..."})})}):s.jsx("div",{className:"summary-overlay",onClick:c,children:s.jsxs("div",{className:"summary-panel",onClick:a(e=>e.stopPropagation(),"onClick"),children:[s.jsxs("div",{className:"panel-header",children:[s.jsxs("div",{className:"header-info",children:[s.jsxs("h2",{children:[s.jsx(w,{}),"AI Message Summary"]}),s.jsx("span",{className:"subtitle",children:"Summarize channel conversations with AI"})]}),s.jsx("button",{className:"close-btn",onClick:c,children:s.jsx(H,{})})]}),s.jsxs("div",{className:"summary-content",children:[s.jsxs("div",{className:"generator-section",children:[s.jsxs("h3",{children:[s.jsx(E,{})," Generate Summary"]}),s.jsxs("div",{className:"generator-controls",children:[s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(k,{})," Channel"]}),s.jsx("select",{value:g,onChange:a(e=>L(Number(e.target.value)),"onChange"),children:C.map(e=>s.jsxs("option",{value:e.id,children:["#",e.name]},e.id))})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(f,{})," Time Range"]}),s.jsxs("select",{value:x,onChange:a(e=>F(e.target.value),"onChange"),children:[s.jsx("option",{value:"1h",children:"Last Hour"}),s.jsx("option",{value:"6h",children:"Last 6 Hours"}),s.jsx("option",{value:"24h",children:"Last 24 Hours"}),s.jsx("option",{value:"7d",children:"Last 7 Days"}),s.jsx("option",{value:"30d",children:"Last 30 Days"})]})]}),s.jsxs("div",{className:"control-group",children:[s.jsxs("label",{children:[s.jsx(m,{})," Max Messages"]}),s.jsxs("select",{value:j,onChange:a(e=>D(Number(e.target.value)),"onChange"),children:[s.jsx("option",{value:50,children:"50 messages"}),s.jsx("option",{value:100,children:"100 messages"}),s.jsx("option",{value:250,children:"250 messages"}),s.jsx("option",{value:500,children:"500 messages"})]})]}),s.jsx("button",{className:"generate-btn",onClick:M,disabled:N,children:N?s.jsxs(s.Fragment,{children:[s.jsx(A,{className:"spinning"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(w,{}),"Generate Summary"]})})]})]}),(t||n.length>0)&&s.jsxs("div",{className:"summary-display",children:[s.jsxs("div",{className:"summary-header",children:[s.jsxs("h3",{children:[s.jsx(m,{}),t?"Generated Summary":"Latest Summary"]}),s.jsxs("div",{className:"summary-actions",children:[s.jsxs("button",{className:"action-btn",onClick:a(()=>R((t||n[0]).summary),"onClick"),children:[s.jsx(P,{})," Copy"]}),s.jsxs("button",{className:"action-btn",onClick:a(()=>T(t||n[0]),"onClick"),children:[s.jsx(I,{})," Export"]})]})]}),s.jsxs("div",{className:"summary-meta",children:[s.jsxs("span",{className:"meta-item",children:[s.jsx(k,{})," #",(t||n[0]).channel]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(f,{})," ",(t||n[0]).time_range]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(m,{})," ",(t||n[0]).message_count," messages"]}),s.jsxs("span",{className:"meta-item",children:[s.jsx(O,{})," ",p((t||n[0]).created_at)]})]}),s.jsx("div",{className:"summary-body",children:s.jsx("div",{className:"summary-text",dangerouslySetInnerHTML:{__html:K.sanitize((t||n[0]).summary.replace(/## /g,"<h4>").replace(/\n\n/g,`</h4>
`).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/- /g,"• ").replace(/\n/g,"<br/>"))}})}),s.jsxs("div",{className:"summary-keywords",children:[s.jsx("span",{className:"keywords-label",children:"Keywords:"}),(t||n[0]).keywords.map((e,r)=>s.jsx("span",{className:"keyword-chip",children:e},r))]})]}),s.jsxs("div",{className:"history-section",children:[s.jsxs("h3",{children:[s.jsx(J,{})," Summary History"]}),s.jsx("div",{className:"history-list",children:n.map(e=>s.jsxs("div",{className:`history-item ${t?.id===e.id?"active":""}`,onClick:a(()=>v(e),"onClick"),children:[s.jsx("div",{className:"history-icon",children:s.jsx(m,{})}),s.jsxs("div",{className:"history-info",children:[s.jsxs("span",{className:"history-channel",children:["#",e.channel]}),s.jsxs("span",{className:"history-meta",children:[e.message_count," messages • ",e.time_range]})]}),s.jsx("div",{className:"history-date",children:p(e.created_at)})]},e.id))})]})]})]})})},"MessageSummaryPanel");export{X as default};
