var D=Object.defineProperty;var t=(u,l)=>D(u,"name",{value:l,configurable:!0});import{r as c,j as e}from"./react-core-Djgtqrmb.js";import{t as r}from"./index-D0nbcjO7.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BMXAt4pj.js";import"./ui-vendor-IhB9Znpc.js";const q=t(({serverId:u,apiBaseUrl:l,onClose:x})=>{const[f,b]=c.useState([]),[m,C]=c.useState(null),[h,k]=c.useState([]),[n,p]=c.useState(null),[z,F]=c.useState(!0),[S,w]=c.useState(!1),[$,v]=c.useState(!1),[d,N]=c.useState({title:"",content:"",tags:[]}),[g,P]=c.useState("");c.useEffect(()=>{A()},[u]),c.useEffect(()=>{m&&T(m.id)},[m]);const A=t(async()=>{try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/servers/${u}/forums/`,{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const o=await a.json();b(Array.isArray(o)?o:o.forums||[])}}catch{}finally{F(!1)}},"fetchForums"),T=t(async s=>{try{const a=localStorage.getItem("access_token"),o=await fetch(`${l}/forums/${s}/posts/`,{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const i=await o.json();k(Array.isArray(i)?i:i.posts||[])}}catch{}},"fetchPosts"),_=t(async()=>{const s=prompt("Forum kanalÄ± adÄ±:");if(s)try{const a=localStorage.getItem("access_token"),o=await fetch(`${l}/servers/${u}/forums/create/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({name:s})});if(o.ok){const i=await o.json();b([...f,i.forum]),r.success("âœ… Forum oluÅŸturuldu!")}else r.error("âŒ Forum oluÅŸturulamadÄ±")}catch{r.error("âŒ Hata oluÅŸtu")}},"handleCreateForum"),O=t(async()=>{if(!d.title.trim()||!d.content.trim()){r.error("âš ï¸ BaÅŸlÄ±k ve iÃ§erik gerekli");return}w(!0);try{const s=localStorage.getItem("access_token"),a=await fetch(`${l}/forums/${m.id}/posts/create/`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(a.ok){const o=await a.json();k([o.post,...h]),N({title:"",content:"",tags:[]}),v(!1),r.success("âœ… GÃ¶nderi oluÅŸturuldu!")}else r.error("âŒ GÃ¶nderi oluÅŸturulamadÄ±")}catch{r.error("âŒ Hata oluÅŸtu")}finally{w(!1)}},"handleCreatePost"),Y=t(async s=>{if(!g.trim()){r.error("âš ï¸ YanÄ±t iÃ§eriÄŸi gerekli");return}try{const a=localStorage.getItem("access_token"),o=await fetch(`${l}/forums/posts/${s}/reply/`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({content:g})});if(o.ok){const i=await o.json();p({...n,replies:[...n.replies||[],i.reply]}),P(""),r.success("âœ… YanÄ±t gÃ¶nderildi!")}else r.error("âŒ YanÄ±t gÃ¶nderilemedi")}catch{r.error("âŒ Hata oluÅŸtu")}},"handleReply"),j=t(async(s,a)=>{try{const o=localStorage.getItem("access_token"),i=await fetch(`${l}/forums/posts/${s}/vote/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({vote_type:a})});if(i.ok){const R=await i.json();k(h.map(y=>y.id===s?{...y,votes:R.votes}:y)),r.success(a==="up"?"ğŸ‘ Upvote!":"ğŸ‘ Downvote!")}}catch{}},"handleVote"),G=t(async(s,a)=>{try{const o=localStorage.getItem("access_token");(await fetch(`${l}/forums/posts/${s}/solve/${a}/`,{method:"POST",headers:{Authorization:`Bearer ${o}`}})).ok&&(r.success("âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretlendi!"),p({...n,solution_id:a}))}catch{}},"handleMarkSolution");return z?e.jsx("div",{className:"forum-panel-overlay",onClick:x,children:e.jsx("div",{className:"forum-panel",onClick:t(s=>s.stopPropagation(),"onClick"),children:e.jsxs("div",{className:"forum-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]})})}):e.jsx("div",{className:"forum-panel-overlay",onClick:x,children:e.jsxs("div",{className:"forum-panel",onClick:t(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{className:"forum-header",children:[e.jsx("h2",{children:"ğŸ’¬ Forum"}),e.jsx("button",{className:"close-btn",onClick:x,children:"âœ•"})]}),m?n?e.jsxs("div",{className:"post-detail",children:[e.jsx("div",{className:"detail-header",children:e.jsx("button",{className:"back-btn",onClick:t(()=>p(null),"onClick"),children:"â† Geri"})}),e.jsxs("div",{className:"post-main",children:[e.jsxs("div",{className:"post-votes-vertical",children:[e.jsx("button",{onClick:t(()=>j(n.id,"up"),"onClick"),children:"ğŸ‘"}),e.jsx("span",{children:n.votes||0}),e.jsx("button",{onClick:t(()=>j(n.id,"down"),"onClick"),children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-body",children:[e.jsx("h2",{children:n.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",n.author," â€¢ â° ",new Date(n.created_at).toLocaleString("tr-TR")]}),e.jsx("div",{className:"post-text",children:n.content})]})]}),e.jsxs("div",{className:"replies-section",children:[e.jsxs("h3",{children:["ğŸ’¬ YanÄ±tlar (",n.replies?.length||0,")"]}),(n.replies||[]).map(s=>e.jsxs("div",{className:`reply-item ${s.id===n.solution_id?"solution":""}`,children:[e.jsxs("div",{className:"reply-header",children:[e.jsxs("span",{className:"reply-author",children:["ğŸ‘¤ ",s.author]}),e.jsx("span",{className:"reply-time",children:new Date(s.created_at).toLocaleString("tr-TR")}),s.id===n.solution_id&&e.jsx("span",{className:"solution-badge",children:"âœ… Ã‡Ã¶zÃ¼m"})]}),e.jsx("div",{className:"reply-content",children:s.content}),!n.solution_id&&e.jsx("button",{className:"mark-solution-btn",onClick:t(()=>G(n.id,s.id),"onClick"),children:"âœ… Ã‡Ã¶zÃ¼m olarak iÅŸaretle"})]},s.id)),e.jsxs("div",{className:"reply-form",children:[e.jsx("textarea",{placeholder:"YanÄ±tÄ±nÄ±zÄ± yazÄ±n...",value:g,onChange:t(s=>P(s.target.value),"onChange"),rows:4}),e.jsx("button",{className:"reply-submit-btn",onClick:t(()=>Y(n.id),"onClick"),children:"ğŸ“¤ YanÄ±tla"})]})]})]}):e.jsxs("div",{className:"posts-view",children:[e.jsxs("div",{className:"posts-header",children:[e.jsx("button",{className:"back-btn",onClick:t(()=>C(null),"onClick"),children:"â† Geri"}),e.jsx("h3",{children:m.name}),e.jsx("button",{className:"new-post-btn",onClick:t(()=>v(!$),"onClick"),children:"â• Yeni GÃ¶nderi"})]}),$&&e.jsxs("div",{className:"create-post-form",children:[e.jsx("input",{type:"text",placeholder:"GÃ¶nderi baÅŸlÄ±ÄŸÄ±...",value:d.title,onChange:t(s=>N({...d,title:s.target.value}),"onChange"),maxLength:200}),e.jsx("textarea",{placeholder:"Ä°Ã§erik...",value:d.content,onChange:t(s=>N({...d,content:s.target.value}),"onChange"),rows:6}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"submit-btn",onClick:O,disabled:S,children:S?"â³ GÃ¶nderiliyor...":"ğŸ“¤ GÃ¶nder"}),e.jsx("button",{className:"cancel-btn",onClick:t(()=>v(!1),"onClick"),children:"Ä°ptal"})]})]}),e.jsxs("div",{className:"posts-list",children:[h.map(s=>e.jsxs("div",{className:"post-item",onClick:t(()=>p(s),"onClick"),children:[e.jsxs("div",{className:"post-votes",children:[e.jsx("button",{onClick:t(a=>{a.stopPropagation(),j(s.id,"up")},"onClick"),children:"ğŸ‘"}),e.jsx("span",{children:s.votes||0}),e.jsx("button",{onClick:t(a=>{a.stopPropagation(),j(s.id,"down")},"onClick"),children:"ğŸ‘"})]}),e.jsxs("div",{className:"post-content",children:[e.jsx("h4",{children:s.title}),e.jsxs("p",{className:"post-meta",children:["ğŸ‘¤ ",s.author," â€¢ â° ",new Date(s.created_at).toLocaleDateString("tr-TR"),s.is_solved&&" â€¢ âœ… Ã‡Ã¶zÃ¼ldÃ¼"]}),e.jsxs("p",{className:"post-preview",children:[s.content?.substring(0,150),"..."]}),e.jsxs("div",{className:"post-stats",children:["ğŸ’¬ ",s.replies_count||0," yanÄ±t"]})]})]},s.id)),h.length===0&&e.jsx("div",{className:"no-posts",children:e.jsx("p",{children:"ğŸ“­ HenÃ¼z gÃ¶nderi yok"})})]})]}):e.jsxs("div",{className:"forum-list",children:[e.jsxs("div",{className:"forum-list-header",children:[e.jsx("h3",{children:"Forum KanallarÄ±"}),e.jsx("button",{className:"create-forum-btn",onClick:_,children:"â• Yeni Forum"})]}),f.length>0?e.jsx("div",{className:"forums-grid",children:f.map(s=>e.jsxs("div",{className:"forum-card",onClick:t(()=>C(s),"onClick"),children:[e.jsx("div",{className:"forum-icon",children:"ğŸ’¬"}),e.jsx("h4",{children:s.name}),e.jsxs("p",{className:"forum-stats",children:[s.posts_count||0," gÃ¶nderi â€¢ ",s.members_count||0," Ã¼ye"]})]},s.id))}):e.jsxs("div",{className:"no-forums",children:[e.jsx("p",{children:"ğŸ“‹ HenÃ¼z forum kanalÄ± yok"}),e.jsx("button",{onClick:_,children:"Ä°lk forumu oluÅŸtur"})]})]})]})})},"ForumPanel");export{q as default};
