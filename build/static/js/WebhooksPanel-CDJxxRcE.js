var S=Object.defineProperty;var o=(h,k)=>S(h,"name",{value:k,configurable:!0});import{r as i,j as e}from"./react-core-Djgtqrmb.js";import{y as l}from"./ui-vendor-IhB9Znpc.js";import{g as T,e as $}from"./index-BRQzOq3v.js";import"./media-vendor-CxFPycob.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-BRqaXHJQ.js";import"./crypto-vendor-D1XRGppi.js";import"./icons-vendor-BW7dxHkX.js";function B(h){const[k,a]=i.useState([]),[g,x]=i.useState(!1),[b,p]=i.useState({name:"",channel_id:"",avatar_url:""}),[v,N]=i.useState([]),[f,W]=i.useState(!0),[s,c]=i.useState(null),[w,_]=i.useState([]),[L,y]=i.useState(null),d=T();i.useEffect(()=>{if(!h)return;const r={Authorization:`Bearer ${localStorage.getItem("access_token")}`};Promise.all([fetch(`${d}/webhooks/server/${h}/`,{headers:r}).then(n=>n.ok?n.json():null),fetch(`${d}/servers/${h}/channels/`,{headers:r}).then(n=>n.ok?n.json():null)]).then(([n,m])=>{n&&a(n.webhooks||[]),m&&N(m.channels||[])}).catch(n=>{}).finally(()=>W(!1))},[h,d]);const u=o(()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}),"authHeaders");return{webhooks:k,creating:g,setCreating:x,newWebhook:b,setNewWebhook:p,channels:v,loading:f,editingWebhook:s,setEditingWebhook:c,logs:w,viewingLogs:L,setViewingLogs:y,apiBaseUrl:d,createWebhook:o(async()=>{if(!b.name||!b.channel_id){l.error("‚ùå Webhook adƒ± ve kanal se√ßimi zorunludur");return}try{const t=await fetch(`${d}/webhooks/create/`,{method:"POST",headers:u(),body:JSON.stringify({server_id:h,...b})});if(t.ok){const r=await t.json();a(n=>[...n,r.webhook]),p({name:"",channel_id:"",avatar_url:""}),x(!1),l.success("‚úÖ Webhook ba≈üarƒ±yla olu≈üturuldu")}else l.error("‚ùå Webhook olu≈üturulamadƒ±")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"createWebhook"),updateWebhook:o(async(t,r)=>{try{const n=await fetch(`${d}/webhooks/${t}/update/`,{method:"POST",headers:u(),body:JSON.stringify(r)});if(n.ok){const m=await n.json();a(j=>j.map(C=>C.id===t?m.webhook:C)),c(null),l.success("‚úÖ Webhook g√ºncellendi")}else l.error("‚ùå Webhook g√ºncellenemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"updateWebhook"),deleteWebhook:o(async t=>{if(await $("Bu webhook'u silmek istediƒüinizden emin misiniz?"))try{(await fetch(`${d}/webhooks/${t}/delete/`,{method:"DELETE",headers:u()})).ok?(a(n=>n.filter(m=>m.id!==t)),l.success("‚úÖ Webhook silindi")):l.error("‚ùå Webhook silinemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"deleteWebhook"),testWebhook:o(async t=>{try{(await fetch(`${d}/webhooks/${t}/test/`,{method:"POST",headers:u()})).ok?l.success("‚úÖ Test mesajƒ± g√∂nderildi"):l.error("‚ùå Test mesajƒ± g√∂nderilemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"testWebhook"),regenerateToken:o(async t=>{if(await $("Webhook tokenini yenilemek istediƒüinizden emin misiniz? Eski token ge√ßersiz hale gelecek."))try{const r=await fetch(`${d}/webhooks/${t}/regenerate-token/`,{method:"POST",headers:u()});if(r.ok){const n=await r.json();a(m=>m.map(j=>j.id===t?{...j,token:n.token}:j)),l.success("‚úÖ Token yenilendi")}else l.error("‚ùå Token yenilenemedi")}catch{l.error("‚ùå Baƒülantƒ± hatasƒ±")}},"regenerateToken"),fetchWebhookLogs:o(async t=>{try{const r=await fetch(`${d}/webhooks/${t}/logs/`,{headers:u()});if(r.ok){const n=await r.json();_(n.logs||[]),y(t)}}catch{l.error("‚ùå Loglar y√ºklenemedi")}},"fetchWebhookLogs"),copyWebhookUrl:o(t=>{navigator.clipboard.writeText(`${d}/webhooks/${t.id}/${t.token}`),l.success("‚úÖ Webhook URL kopyalandƒ±")},"copyWebhookUrl")}}o(B,"useWebhooks");const E=o(({serverId:h,onClose:k})=>{const a=B(h),g=i.useCallback(s=>s.stopPropagation(),[]),x=i.useCallback(()=>a.setCreating(!0),[a.setCreating]),b=i.useCallback(()=>a.setCreating(!1),[a.setCreating]),p=i.useCallback(()=>a.setEditingWebhook(null),[a.setEditingWebhook]),v=i.useCallback(()=>a.setViewingLogs(null),[a.setViewingLogs]),N=i.useCallback(s=>a.setNewWebhook(c=>({...c,name:s.target.value})),[a.setNewWebhook]),f=i.useCallback(s=>a.setNewWebhook(c=>({...c,channel_id:s.target.value})),[a.setNewWebhook]),W=i.useCallback(s=>a.setNewWebhook(c=>({...c,avatar_url:s.target.value})),[a.setNewWebhook]);return a.loading?e.jsx("div",{className:"webhooks-overlay",children:e.jsx("div",{className:"webhooks-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Webhooklar y√ºkleniyor..."})]})})}):e.jsx("div",{className:"webhooks-overlay",onClick:k,children:e.jsxs("div",{className:"webhooks-panel",onClick:g,children:[e.jsxs("div",{className:"webhooks-header",children:[e.jsxs("h2",{children:["üîó"," Webhook Y√∂netimi"]}),e.jsx("button",{className:"close-btn",onClick:k,children:"√ó"})]}),e.jsxs("div",{className:"webhooks-content",children:[!a.creating&&e.jsxs("button",{className:"create-webhook-btn",onClick:x,children:["‚ûï"," Yeni Webhook Olu≈ütur"]}),a.creating&&e.jsxs("div",{className:"create-webhook-form",children:[e.jsx("h3",{children:"Yeni Webhook"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ± *"}),e.jsx("input",{type:"text",placeholder:"√ñrn: GitHub Bot",value:a.newWebhook.name,onChange:N})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:a.newWebhook.channel_id,onChange:f,children:[e.jsx("option",{value:"",children:"Kanal se√ßin..."}),a.channels.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL (Opsiyonel)"}),e.jsx("input",{type:"text",placeholder:"https://example.com/avatar.png",value:a.newWebhook.avatar_url,onChange:W})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:b,children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:a.createWebhook,children:"Olu≈ütur"})]})]}),a.webhooks.length>0?e.jsx("div",{className:"webhooks-list",children:a.webhooks.map(s=>e.jsx("div",{className:"webhook-card",children:a.editingWebhook===s.id?e.jsxs("div",{className:"edit-webhook-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Webhook Adƒ±"}),e.jsx("input",{type:"text",defaultValue:s.name,id:`edit-name-${s.id}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal"}),e.jsx("select",{defaultValue:s.channel_id,id:`edit-channel-${s.id}`,children:a.channels.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Avatar URL"}),e.jsx("input",{type:"text",defaultValue:s.avatar_url||"",id:`edit-avatar-${s.id}`})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:p,children:"ƒ∞ptal"}),e.jsx("button",{className:"submit-btn",onClick:o(()=>a.updateWebhook(s.id,{name:document.getElementById(`edit-name-${s.id}`).value,channel_id:document.getElementById(`edit-channel-${s.id}`).value,avatar_url:document.getElementById(`edit-avatar-${s.id}`).value}),"onClick"),children:"Kaydet"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"webhook-info",children:[e.jsx("div",{className:"webhook-avatar",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name}):e.jsx("div",{className:"default-avatar",children:"üîó"})}),e.jsxs("div",{className:"webhook-details",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:a.channels.find(c=>c.id===s.channel_id)?.name||"Bilinmeyen Kanal"}),e.jsxs("span",{className:"webhook-id",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"webhook-url",children:[e.jsx("label",{children:"Webhook URL:"}),e.jsxs("div",{className:"url-display",children:[e.jsx("code",{children:`${a.apiBaseUrl}/webhooks/${s.id}/${s.token}`}),e.jsx("button",{className:"copy-btn",onClick:o(()=>a.copyWebhookUrl(s),"onClick"),title:"URL'yi kopyala",children:"üìã"})]})]}),e.jsxs("div",{className:"webhook-actions",children:[e.jsxs("button",{className:"action-btn test-btn",onClick:o(()=>a.testWebhook(s.id),"onClick"),title:"Test mesajƒ± g√∂nder",children:["üß™"," Test"]}),e.jsxs("button",{className:"action-btn logs-btn",onClick:o(()=>a.fetchWebhookLogs(s.id),"onClick"),title:"Loglarƒ± g√∂r√ºnt√ºle",children:["üìä"," Loglar"]}),e.jsx("button",{className:"action-btn edit-btn",onClick:o(()=>a.setEditingWebhook(s.id),"onClick"),title:"D√ºzenle",children:"‚úèÔ∏è"}),e.jsx("button",{className:"action-btn regenerate-btn",onClick:o(()=>a.regenerateToken(s.id),"onClick"),title:"Token yenile",children:"üîÑ"}),e.jsx("button",{className:"action-btn delete-btn",onClick:o(()=>a.deleteWebhook(s.id),"onClick"),title:"Sil",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"webhook-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Toplam √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.total_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±lƒ±:"}),e.jsx("span",{className:"stat-value success",children:s.successful_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Ba≈üarƒ±sƒ±z:"}),e.jsx("span",{className:"stat-value error",children:s.failed_calls||0})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Son √áaƒürƒ±:"}),e.jsx("span",{className:"stat-value",children:s.last_call?new Date(s.last_call).toLocaleString("tr-TR"):"Hi√ß"})]})]})]})},s.id))}):!a.creating&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîó"}),e.jsx("h3",{children:"Hen√ºz webhook yok"}),e.jsx("p",{children:"Dƒ±≈ü uygulamalardan mesaj g√∂ndermek i√ßin webhook olu≈üturun"})]}),a.viewingLogs&&e.jsx("div",{className:"logs-modal",onClick:v,children:e.jsxs("div",{className:"logs-content",onClick:g,children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h3",{children:["üìä"," Webhook Loglarƒ±"]}),e.jsx("button",{className:"close-btn",onClick:v,children:"√ó"})]}),e.jsx("div",{className:"logs-list",children:a.logs.length>0?a.logs.map((s,c)=>e.jsxs("div",{className:`log-item ${s.status}`,children:[e.jsx("div",{className:"log-time",children:new Date(s.timestamp).toLocaleString("tr-TR")}),e.jsxs("div",{className:"log-status",children:[s.status==="success"?"‚úÖ":"‚ùå"," ",s.status]}),e.jsx("div",{className:"log-message",children:s.message}),s.error&&e.jsxs("div",{className:"log-error",children:["Hata: ",s.error]})]},c)):e.jsx("p",{className:"empty-state",children:"Hen√ºz log kaydƒ± yok"})})]})})]})]})})},"WebhooksPanel"),Q=i.memo(E);export{Q as default};
