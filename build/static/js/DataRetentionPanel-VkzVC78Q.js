import{r as s,Y as h,l as C,bD as S,v as k}from"./react-core-B6hadH-M.js";import{t as a}from"./index-D_6pZib5.js";const _=({fetchWithAuth:n,apiBaseUrl:i,onClose:g,serverId:y})=>{const[d,u]=s.useState([]),[x,f]=s.useState(!1),[l,p]=s.useState({content_type:"messages",retention_days:30,enabled:!0}),m=[{value:"messages",label:"Messages"},{value:"media",label:"Media Files"},{value:"voice_recordings",label:"Voice Recordings"},{value:"audit_logs",label:"Audit Logs"},{value:"deleted_messages",label:"Deleted Messages"}],b=[{days:7,label:"7 Days"},{days:30,label:"30 Days"},{days:90,label:"90 Days"},{days:180,label:"6 Months"},{days:365,label:"1 Year"},{days:730,label:"2 Years"},{days:-1,label:"Forever"}];s.useEffect(()=>{r()},[]);const r=async()=>{f(!0);try{const o=await(await n(`${i}/servers/${y}/retention/`)).json();u(o.policies||[])}catch{a.error("Failed to load retention policies")}finally{f(!1)}},R=async()=>{try{await n(`${i}/retention/policies/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,server_id:y})}),a.success("Retention policy created"),p({content_type:"messages",retention_days:30,enabled:!0}),r()}catch{a.error("Failed to create policy")}},v=async(t,o)=>{try{await n(`${i}/retention/policies/${t}/toggle/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:o})}),a.success(o?"Policy enabled":"Policy disabled"),r()}catch{a.error("Failed to toggle policy")}},E=async t=>{if(confirm("Delete this retention policy?"))try{await n(`${i}/retention/policies/${t}/delete/`,{method:"DELETE"}),a.success("Policy deleted"),r()}catch{a.error("Failed to delete policy")}};return React.createElement("div",{style:e.overlay},React.createElement("div",{style:e.modal},React.createElement("div",{style:e.header},React.createElement("div",{style:e.headerLeft},React.createElement(h,{style:{marginRight:"10px",color:"#5865f2"}}),React.createElement("h2",{style:e.title},"Data Retention Policies")),React.createElement("button",{onClick:g,style:e.closeButton},React.createElement(C,null))),React.createElement("div",{style:e.content},React.createElement("div",{style:e.section},React.createElement("h3",{style:e.sectionTitle},"Create New Policy"),React.createElement("div",{style:e.form},React.createElement("div",{style:e.formRow},React.createElement("label",{style:e.label},"Content Type"),React.createElement("select",{value:l.content_type,onChange:t=>p({...l,content_type:t.target.value}),style:e.select},m.map(t=>React.createElement("option",{key:t.value,value:t.value},t.label)))),React.createElement("div",{style:e.formRow},React.createElement("label",{style:e.label},"Retention Period"),React.createElement("div",{style:e.presetButtons},b.map(t=>React.createElement("button",{key:t.days,onClick:()=>p({...l,retention_days:t.days}),style:{...e.presetButton,...l.retention_days===t.days&&e.presetButtonActive}},t.label)))),React.createElement("button",{onClick:R,style:e.saveButton},React.createElement(S,{style:{marginRight:"8px"}}),"Create Policy"))),React.createElement("div",{style:e.section},React.createElement("h3",{style:e.sectionTitle},"Active Policies (",d.length,")"),x?React.createElement("div",{style:e.loading},"Loading..."):d.length===0?React.createElement("div",{style:e.empty},"No retention policies configured"):React.createElement("div",{style:e.policiesList},d.map((t,o)=>React.createElement("div",{key:o,style:e.policyCard},React.createElement("div",{style:e.policyInfo},React.createElement("div",{style:e.policyType},m.find(c=>c.value===t.content_type)?.label||t.content_type),React.createElement("div",{style:e.policyRetention},t.retention_days===-1?"Forever":`${t.retention_days} days`),React.createElement("div",{style:e.policyMeta},"Last run: ",t.last_run?new Date(t.last_run).toLocaleString():"Never"),t.items_deleted>0&&React.createElement("div",{style:e.policyMeta},"Items deleted: ",t.items_deleted.toLocaleString())),React.createElement("div",{style:e.policyActions},React.createElement("label",{style:e.toggleSwitch},React.createElement("input",{type:"checkbox",checked:t.enabled,onChange:c=>v(t.id,c.target.checked)}),React.createElement("span",{style:e.toggleSlider})),React.createElement("button",{onClick:()=>E(t.id),style:e.deleteButton,title:"Delete Policy"},React.createElement(k,null))))))))))},e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"90%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #2c2f33"},headerLeft:{display:"flex",alignItems:"center"},title:{margin:0,fontSize:"20px",color:"#ffffff"},closeButton:{background:"none",border:"none",color:"#99aab5",cursor:"pointer",fontSize:"20px",padding:"5px"},content:{padding:"20px",overflowY:"auto",flex:1},section:{marginBottom:"30px"},sectionTitle:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"16px"},form:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px"},formRow:{marginBottom:"20px"},label:{display:"block",fontSize:"14px",fontWeight:"600",color:"#dcddde",marginBottom:"8px"},select:{width:"100%",padding:"10px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#ffffff",fontSize:"14px"},presetButtons:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"8px"},presetButton:{padding:"8px 12px",backgroundColor:"#1e1e1e",border:"1px solid #2c2f33",borderRadius:"4px",color:"#dcddde",cursor:"pointer",fontSize:"13px"},presetButtonActive:{backgroundColor:"#5865f2",borderColor:"#5865f2",color:"#ffffff"},saveButton:{padding:"10px 20px",backgroundColor:"#43b581",border:"none",borderRadius:"4px",color:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center"},loading:{textAlign:"center",color:"#99aab5",padding:"40px"},empty:{textAlign:"center",color:"#99aab5",padding:"40px"},policiesList:{display:"flex",flexDirection:"column",gap:"12px"},policyCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},policyInfo:{flex:1},policyType:{fontSize:"16px",fontWeight:"600",color:"#ffffff",marginBottom:"4px"},policyRetention:{fontSize:"14px",color:"#5865f2",marginBottom:"8px"},policyMeta:{fontSize:"12px",color:"#99aab5",marginTop:"4px"},policyActions:{display:"flex",gap:"12px",alignItems:"center"},toggleSwitch:{position:"relative",display:"inline-block",width:"44px",height:"24px"},toggleSlider:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:"#2c2f33",transition:"0.3s",borderRadius:"24px"},deleteButton:{background:"none",border:"none",color:"#f04747",cursor:"pointer",fontSize:"16px",padding:"8px"}};export{_ as default};
