import{r as l,d as e,bg as y,am as _,i as k,bG as O,bE as I,k as U,S as H,y as P}from"./react-core-DMT_QkRe.js";import{t as E}from"./index-CgWAyShr.js";const K=({serverId:s,fetchWithAuth:i,apiBaseUrl:d,onClose:v})=>{const[z,B]=l.useState([]),[W,R]=l.useState([]),[u,L]=l.useState(""),[N,V]=l.useState(null),[F,p]=l.useState(!1),[r,c]=l.useState({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3}),[T,h]=l.useState(!0),[g,A]=l.useState({total_warnings:0,active_warnings:0,expired_warnings:0,auto_banned_users:0});l.useEffect(()=>{f(),j(),x()},[s]);const f=async()=>{h(!0);try{const a=await i(`${d}/moderation/warnings/${s}/`);if(a.ok){const n=await a.json();B(n.results||n)}}catch(a){console.error("Failed to load warnings:",a)}h(!1)},j=async()=>{try{const a=await i(`${d}/servers/${s}/members/`);if(a.ok){const n=await a.json();R(n)}}catch(a){console.error("Failed to load users:",a)}},x=async()=>{try{const a=await i(`${d}/moderation/warnings/stats/${s}/`);if(a.ok){const n=await a.json();A(n)}}catch(a){console.error("Failed to load stats:",a)}},D=async()=>{if(!r.user_id||!r.reason){E.error("âŒ Please select a user and provide a reason");return}try{const a=await i(`${d}/moderation/warnings/create/`,{method:"POST",body:JSON.stringify({server:s,user:r.user_id,reason:r.reason,severity:r.severity,expires_at:new Date(Date.now()+r.expires_in_days*24*60*60*1e3).toISOString(),is_auto:!1})});if(a.ok){const n=await a.json();n.total_warnings>=r.auto_ban_on&&window.confirm(`User has ${n.total_warnings} warnings. Auto-ban now?`)&&await w(r.user_id,`Auto-ban: ${r.auto_ban_on} warnings reached`),f(),x(),p(!1),c({user_id:"",reason:"",severity:"medium",expires_in_days:30,auto_ban_on:3})}else E.error("âŒ Failed to add warning")}catch(a){console.error("Failed to add warning:",a)}},$=async a=>{if(window.confirm("Remove this warning?"))try{(await i(`${d}/moderation/warnings/${a}/`,{method:"DELETE"})).ok?(f(),x()):E.error("âŒ Failed to remove warning")}catch(n){console.error("Failed to remove warning:",n)}},w=async(a,n)=>{try{(await i(`${d}/moderation/ban/`,{method:"POST",body:JSON.stringify({server:s,user:a,reason:n})})).ok&&(E.success("âœ… User banned successfully"),f(),x())}catch(m){console.error("Failed to ban user:",m)}},G=a=>{switch(a){case"low":return"#43b581";case"medium":return"#f0b132";case"high":return"#ed4245";default:return"#72767d"}},C=z.filter(a=>!u||a.user_username?.toLowerCase().includes(u.toLowerCase())||a.reason?.toLowerCase().includes(u.toLowerCase())).reduce((a,n)=>(a[n.user]||(a[n.user]={user_id:n.user,username:n.user_username,warnings:[]}),a[n.user].warnings.push(n),a),{});return e.createElement("div",{style:t.overlay,onClick:v},e.createElement("div",{style:t.panel,onClick:a=>a.stopPropagation()},e.createElement("div",{style:t.header},e.createElement("div",{style:t.headerLeft},e.createElement(y,{style:t.headerIcon}),e.createElement("h2",{style:t.title},"User Warnings")),e.createElement("div",{style:t.headerRight},e.createElement("button",{onClick:()=>p(!0),style:t.addBtn},e.createElement(_,null)," Add Warning"),e.createElement("button",{onClick:v,style:t.closeButton},e.createElement(k,null)))),e.createElement("div",{style:t.statsGrid},e.createElement("div",{style:t.statCard},e.createElement(y,{style:{...t.statIcon,color:"#f0b132"}}),e.createElement("div",{style:t.statValue},g.total_warnings),e.createElement("div",{style:t.statLabel},"Total Warnings")),e.createElement("div",{style:t.statCard},e.createElement(y,{style:{...t.statIcon,color:"#43b581"}}),e.createElement("div",{style:t.statValue},g.active_warnings),e.createElement("div",{style:t.statLabel},"Active")),e.createElement("div",{style:t.statCard},e.createElement(O,{style:{...t.statIcon,color:"#72767d"}}),e.createElement("div",{style:t.statValue},g.expired_warnings),e.createElement("div",{style:t.statLabel},"Expired")),e.createElement("div",{style:t.statCard},e.createElement(I,{style:{...t.statIcon,color:"#ed4245"}}),e.createElement("div",{style:t.statValue},g.auto_banned_users),e.createElement("div",{style:t.statLabel},"Auto-Banned"))),e.createElement("div",{style:t.searchBar},e.createElement(U,{style:t.searchIcon}),e.createElement("input",{type:"text",placeholder:"Search by username or reason...",value:u,onChange:a=>L(a.target.value),style:t.searchInput})),e.createElement("div",{style:t.warningsList},T?e.createElement("div",{style:t.loading},"Loading warnings..."):Object.keys(C).length===0?e.createElement("div",{style:t.empty},e.createElement(y,{style:t.emptyIcon}),e.createElement("p",null,"No warnings found")):Object.values(C).map(({user_id:a,username:n,warnings:m})=>{const b=m.filter(o=>o.is_active),S=b.length>=2;return e.createElement("div",{key:a,style:t.userCard},e.createElement("div",{style:t.userHeader},e.createElement("div",{style:t.userInfo},e.createElement(H,{style:t.userIcon}),e.createElement("div",{style:t.userName},n),e.createElement("span",{style:{...t.badge,backgroundColor:S?"#ed4245":"#f0b132"}},b.length," Active Warning",b.length!==1?"s":""),S&&e.createElement("span",{style:t.riskBadge},"âš ï¸ AT RISK")),b.length>=3&&e.createElement("button",{onClick:()=>w(a,"Auto-ban: 3 warnings"),style:t.banBtn},e.createElement(I,null)," Ban User")),e.createElement("div",{style:t.userWarnings},m.map(o=>e.createElement("div",{key:o.id,style:{...t.warningItem,opacity:o.is_active?1:.5}},e.createElement("div",{style:t.warningLeft},e.createElement("div",{style:{...t.severityDot,backgroundColor:G(o.severity)}}),e.createElement("div",{style:t.warningContent},e.createElement("div",{style:t.warningReason},o.reason),e.createElement("div",{style:t.warningMeta},e.createElement("span",null,o.is_auto?"ðŸ¤– Auto":"ðŸ‘¤ Manual"),e.createElement("span",null,"â€¢"),e.createElement("span",null,new Date(o.created_at).toLocaleString()),o.expires_at&&e.createElement(e.Fragment,null,e.createElement("span",null,"â€¢"),e.createElement("span",null,"Expires: ",new Date(o.expires_at).toLocaleDateString())),!o.is_active&&e.createElement(e.Fragment,null,e.createElement("span",null,"â€¢"),e.createElement("span",{style:{color:"#72767d"}},"EXPIRED"))))),o.is_active&&!o.is_auto&&e.createElement("button",{onClick:()=>$(o.id),style:t.removeBtn,title:"Remove warning"},e.createElement(P,null))))))})),F&&e.createElement("div",{style:t.modalOverlay,onClick:()=>p(!1)},e.createElement("div",{style:t.modal,onClick:a=>a.stopPropagation()},e.createElement("div",{style:t.modalHeader},e.createElement("h3",{style:t.modalTitle},"Add Warning"),e.createElement("button",{onClick:()=>p(!1),style:t.modalClose},e.createElement(k,null))),e.createElement("div",{style:t.modalContent},e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"User"),e.createElement("select",{value:r.user_id,onChange:a=>c({...r,user_id:a.target.value}),style:t.select},e.createElement("option",{value:""},"Select user..."),W.map(a=>e.createElement("option",{key:a.id,value:a.id},a.username)))),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Reason"),e.createElement("textarea",{value:r.reason,onChange:a=>c({...r,reason:a.target.value}),placeholder:"Why is this warning being issued?",style:t.textarea,rows:"3"})),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Severity"),e.createElement("select",{value:r.severity,onChange:a=>c({...r,severity:a.target.value}),style:t.select},e.createElement("option",{value:"low"},"ðŸŸ¢ Low"),e.createElement("option",{value:"medium"},"ðŸŸ¡ Medium"),e.createElement("option",{value:"high"},"ðŸ”´ High"))),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Expires In (Days)"),e.createElement("input",{type:"number",value:r.expires_in_days,onChange:a=>c({...r,expires_in_days:parseInt(a.target.value)}),style:t.input,min:"1",max:"365"})),e.createElement("div",{style:t.formGroup},e.createElement("label",{style:t.label},"Auto-ban Threshold"),e.createElement("input",{type:"number",value:r.auto_ban_on,onChange:a=>c({...r,auto_ban_on:parseInt(a.target.value)}),style:t.input,min:"2",max:"10"}),e.createElement("div",{style:t.hint},"User will be auto-banned after reaching ",r.auto_ban_on," active warnings"))),e.createElement("div",{style:t.modalActions},e.createElement("button",{onClick:()=>p(!1),style:t.cancelBtn},"Cancel"),e.createElement("button",{onClick:D,style:t.submitBtn},e.createElement(_,null)," Add Warning"))))))},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,backdropFilter:"blur(5px)"},panel:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"1000px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px",color:"#f0b132"},title:{margin:0,color:"#fff",fontSize:"24px",fontWeight:"600"},headerRight:{display:"flex",gap:"12px"},addBtn:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"24px",padding:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",padding:"20px",borderBottom:"1px solid #1e1f22"},statCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",textAlign:"center"},statIcon:{fontSize:"32px",marginBottom:"8px"},statValue:{fontSize:"28px",fontWeight:"bold",color:"#fff",marginBottom:"4px"},statLabel:{fontSize:"13px",color:"#b9bbbe"},searchBar:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 20px",borderBottom:"1px solid #1e1f22",backgroundColor:"#1e1f22"},searchIcon:{color:"#b9bbbe",fontSize:"16px"},searchInput:{flex:1,backgroundColor:"#2b2d31",border:"1px solid #1e1f22",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"14px"},warningsList:{flex:1,overflowY:"auto",padding:"20px"},loading:{textAlign:"center",color:"#b9bbbe",padding:"40px",fontSize:"14px"},empty:{textAlign:"center",color:"#b9bbbe",padding:"60px"},emptyIcon:{fontSize:"48px",marginBottom:"16px",opacity:.5},userCard:{backgroundColor:"#1e1f22",borderRadius:"8px",padding:"16px",marginBottom:"16px"},userHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #2b2d31"},userInfo:{display:"flex",alignItems:"center",gap:"12px"},userIcon:{fontSize:"20px",color:"#5865f2"},userName:{color:"#fff",fontSize:"18px",fontWeight:"600"},badge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",color:"#fff",textTransform:"uppercase"},riskBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"700",color:"#fff",backgroundColor:"#ed4245",animation:"pulse 1.5s infinite"},banBtn:{backgroundColor:"#ed4245",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},userWarnings:{display:"flex",flexDirection:"column",gap:"8px"},warningItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#2b2d31",borderRadius:"6px"},warningLeft:{display:"flex",alignItems:"center",gap:"12px",flex:1},severityDot:{width:"12px",height:"12px",borderRadius:"50%",flexShrink:0},warningContent:{flex:1},warningReason:{color:"#fff",fontSize:"14px",marginBottom:"4px"},warningMeta:{color:"#72767d",fontSize:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},removeBtn:{background:"none",border:"none",color:"#ed4245",cursor:"pointer",fontSize:"14px",padding:"8px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},modal:{backgroundColor:"#2b2d31",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #1e1f22"},modalTitle:{margin:0,color:"#fff",fontSize:"20px",fontWeight:"600"},modalClose:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",fontSize:"20px"},modalContent:{flex:1,overflowY:"auto",padding:"20px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:"#b9bbbe",fontSize:"14px",fontWeight:"600",marginBottom:"8px"},select:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},input:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px"},textarea:{width:"100%",backgroundColor:"#1e1f22",border:"1px solid #2b2d31",borderRadius:"6px",padding:"10px",color:"#fff",fontSize:"14px",resize:"vertical",fontFamily:"inherit"},hint:{color:"#72767d",fontSize:"12px",marginTop:"4px"},modalActions:{display:"flex",gap:"12px",padding:"16px 20px",borderTop:"1px solid #1e1f22"},cancelBtn:{flex:1,backgroundColor:"#2b2d31",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600"},submitBtn:{flex:1,backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"6px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}};export{K as default};
