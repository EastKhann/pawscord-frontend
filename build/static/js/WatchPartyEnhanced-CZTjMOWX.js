import{r as a,n as e}from"./react-core-zXIKm1Jm.js";import{t as te,a as ne,cN as se,aW as ae,aX as re,K as ie,b0 as oe,J as le,c as ce,aZ as de,cn as pe,c9 as ue}from"./icons-vendor-DZdpmN99.js";import"./editor-vendor-DiU449Dh.js";const me=({roomId:c,currentUser:o,websocket:i,onClose:W,initialVideoUrl:E="",participants:N=[]})=>{const s=a.useRef(null),[I,xe]=a.useState(E),[S,u]=a.useState(!1),[g,b]=a.useState(0),[f,k]=a.useState(0),[D,m]=a.useState(1),[j,R]=a.useState(!1),[J,T]=a.useState(!1),[L,B]=a.useState(1),[d,ge]=a.useState(!1),[q,z]=a.useState([]),[y,_]=a.useState(""),[H,V]=a.useState("auto"),[F,K]=a.useState(!1),[fe,v]=a.useState("synced"),[Q,h]=a.useState({}),p=a.useRef(null),$=a.useCallback(()=>{s.current&&(s.current.play(),u(!0),d&&i&&i.send(JSON.stringify({type:"watch_party_control",action:"play",roomId:c,currentTime:s.current.currentTime,sender:o})))},[d,i,c,o]),A=a.useCallback(()=>{s.current&&(s.current.pause(),u(!1),d&&i&&i.send(JSON.stringify({type:"watch_party_control",action:"pause",roomId:c,currentTime:s.current.currentTime,sender:o})))},[d,i,c,o]),C=a.useCallback(t=>{s.current&&(s.current.currentTime=t,b(t),d&&i&&i.send(JSON.stringify({type:"watch_party_control",action:"seek",roomId:c,currentTime:t,sender:o})))},[d,i,c,o]),M=a.useCallback(t=>{if(!s.current)return;const l=Math.max(0,Math.min(f,g+t));C(l)},[g,f,C]),X=a.useCallback(t=>{s.current&&(s.current.volume=t,m(t),R(t===0))},[]),Y=a.useCallback(()=>{if(!s.current)return;const t=!j;s.current.muted=t,R(t),m(t?0:s.current.volume||.5)},[j]),Z=a.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen?.(),T(!1)):(s.current?.requestFullscreen?.(),T(!0))},[]),G=a.useCallback(t=>{s.current&&(s.current.playbackRate=t,B(t),d&&i&&i.send(JSON.stringify({type:"watch_party_control",action:"playback_rate",roomId:c,playbackRate:t,sender:o})))},[d,i,c,o]),w=a.useCallback(()=>{if(!y.trim()||!i)return;const t={type:"watch_party_chat",roomId:c,sender:o,message:y,timestamp:Date.now()};i.send(JSON.stringify(t)),z(l=>[...l,{...t,isOwn:!0}]),_(""),setTimeout(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},100)},[y,i,c,o]),U=a.useCallback(t=>{i&&(i.send(JSON.stringify({type:"watch_party_reaction",roomId:c,sender:o,emoji:t,timestamp:Date.now()})),h(l=>({...l,[o]:{emoji:t,timestamp:Date.now()}})),setTimeout(()=>{h(l=>{const r={...l};return delete r[o],r})},3e3))},[i,c,o]),ee=a.useCallback(()=>{i&&(v("syncing"),i.send(JSON.stringify({type:"watch_party_sync_request",roomId:c,sender:o})))},[i,c,o]);a.useEffect(()=>{if(!i)return;const t=l=>{try{const r=JSON.parse(l.data);if(r.type==="watch_party_control"&&r.sender!==o){switch(r.action){case"play":s.current.currentTime=r.currentTime,s.current.play(),u(!0);break;case"pause":s.current.currentTime=r.currentTime,s.current.pause(),u(!1);break;case"seek":s.current.currentTime=r.currentTime,b(r.currentTime);break;case"playback_rate":s.current.playbackRate=r.playbackRate,B(r.playbackRate);break}v("synced")}r.type==="watch_party_chat"&&r.sender!==o&&(z(x=>[...x,{...r,isOwn:!1}]),p.current&&(p.current.scrollTop=p.current.scrollHeight)),r.type==="watch_party_reaction"&&r.sender!==o&&(h(x=>({...x,[r.sender]:{emoji:r.emoji,timestamp:r.timestamp}})),setTimeout(()=>{h(x=>{const P={...x};return delete P[r.sender],P})},3e3)),r.type==="watch_party_sync_response"&&r.sender!==o&&(s.current.currentTime=r.currentTime,r.isPlaying?(s.current.play(),u(!0)):(s.current.pause(),u(!1)),v("synced"))}catch(r){console.error("Watch Party WS error:",r)}};return i.addEventListener("message",t),()=>i.removeEventListener("message",t)},[i,o]),a.useEffect(()=>{if(!s.current)return;const t=setInterval(()=>{s.current&&(b(s.current.currentTime),k(s.current.duration||0))},100);return()=>clearInterval(t)},[]);const O=t=>{if(!t||isNaN(t))return"0:00";const l=Math.floor(t/60),r=Math.floor(t%60);return`${l}:${r.toString().padStart(2,"0")}`};return e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsxs("div",{style:n.headerLeft,children:[e.jsx(te,{size:18,color:"#5865f2"}),e.jsx("span",{style:n.title,children:"Watch Party"}),e.jsxs("span",{style:n.participantCount,children:[N.length," watching"]})]}),e.jsx("button",{onClick:W,style:n.closeButton,children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{style:n.mainContent,children:[e.jsxs("div",{style:n.videoSection,children:[e.jsxs("div",{style:n.videoContainer,children:[e.jsx("video",{ref:s,src:I,style:n.video,onLoadedMetadata:()=>k(s.current.duration)}),e.jsx("div",{style:n.reactionsOverlay,children:Object.entries(Q).map(([t,{emoji:l}])=>e.jsxs("div",{style:n.reaction,children:[e.jsx("span",{style:n.reactionEmoji,children:l}),e.jsx("span",{style:n.reactionUser,children:t})]},t))}),e.jsxs("div",{style:n.controlsOverlay,children:[e.jsxs("div",{style:n.progressBarContainer,children:[e.jsx("input",{type:"range",min:"0",max:f||100,value:g,onChange:t=>C(parseFloat(t.target.value)),style:n.progressBar,disabled:!d}),e.jsxs("div",{style:n.timeDisplay,children:[e.jsx("span",{children:O(g)}),e.jsx("span",{children:O(f)})]})]}),e.jsxs("div",{style:n.controls,children:[e.jsxs("div",{style:n.controlsLeft,children:[d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(-10),style:n.controlButton,children:e.jsx(se,{size:16})}),e.jsx("button",{onClick:S?A:$,style:n.controlButton,children:S?e.jsx(ae,{size:20}):e.jsx(re,{size:20})}),e.jsx("button",{onClick:()=>M(10),style:n.controlButton,children:e.jsx(ie,{size:16})})]}),e.jsx("button",{onClick:Y,style:n.controlButton,children:j?e.jsx(oe,{size:18}):e.jsx(le,{size:18})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:D,onChange:t=>X(parseFloat(t.target.value)),style:n.volumeSlider})]}),e.jsxs("div",{style:n.controlsRight,children:[!d&&e.jsxs("button",{onClick:ee,style:n.syncButton,children:[e.jsx(ce,{size:16}),e.jsx("span",{children:"Sync"})]}),e.jsx("button",{onClick:()=>K(!F),style:n.controlButton,children:e.jsx(de,{size:18})}),e.jsx("button",{onClick:Z,style:n.controlButton,children:J?e.jsx(pe,{size:18}):e.jsx(ue,{size:18})})]})]})]})]}),e.jsx("div",{style:n.quickReactions,children:["ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ”¥","ðŸ˜®","ðŸ˜¢"].map(t=>e.jsx("button",{onClick:()=>U(t),style:n.reactionButton,children:t},t))})]}),e.jsxs("div",{style:n.chatSection,children:[e.jsx("div",{style:n.chatHeader,children:e.jsx("span",{children:"Live Chat"})}),e.jsx("div",{ref:p,style:n.chatMessages,children:q.map((t,l)=>e.jsxs("div",{style:t.isOwn?n.ownMessage:n.otherMessage,children:[e.jsxs("span",{style:n.messageSender,children:[t.sender,":"]}),e.jsx("span",{style:n.messageText,children:t.message})]},l))}),e.jsxs("div",{style:n.chatInput,children:[e.jsx("input",{type:"text",value:y,onChange:t=>_(t.target.value),onKeyPress:t=>t.key==="Enter"&&w(),placeholder:"Type a message...",style:n.chatInputField}),e.jsx("button",{onClick:w,style:n.sendButton,children:"Send"})]})]})]}),F&&e.jsxs("div",{style:n.settingsPanel,children:[e.jsx("h3",{style:n.settingsTitle,children:"Settings"}),e.jsxs("div",{style:n.settingItem,children:[e.jsx("label",{children:"Playback Speed"}),e.jsxs("select",{value:L,onChange:t=>G(parseFloat(t.target.value)),style:n.select,disabled:!d,children:[e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"0.75",children:"0.75x"}),e.jsx("option",{value:"1",children:"1x"}),e.jsx("option",{value:"1.25",children:"1.25x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2x"})]})]}),e.jsxs("div",{style:n.settingItem,children:[e.jsx("label",{children:"Quality"}),e.jsxs("select",{value:H,onChange:t=>V(t.target.value),style:n.select,children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"}),e.jsx("option",{value:"360p",children:"360p"})]})]})]})]})},n={container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#1e1f22",zIndex:9999,display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",backgroundColor:"#2b2d31",borderBottom:"1px solid rgba(255,255,255,0.1)"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},title:{fontSize:"18px",fontWeight:"bold",color:"#ffffff"},participantCount:{fontSize:"13px",color:"#b9bbbe",backgroundColor:"rgba(88, 101, 242, 0.15)",padding:"4px 8px",borderRadius:"12px"},closeButton:{background:"none",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"8px",borderRadius:"4px",transition:"all 0.2s"},mainContent:{display:"flex",flex:1,overflow:"hidden"},videoSection:{flex:1,display:"flex",flexDirection:"column",backgroundColor:"#000"},videoContainer:{position:"relative",flex:1,display:"flex",alignItems:"center",justifyContent:"center"},video:{width:"100%",height:"100%",objectFit:"contain"},reactionsOverlay:{position:"absolute",top:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"8px",pointerEvents:"none"},reaction:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"rgba(0,0,0,0.7)",padding:"8px 12px",borderRadius:"20px",animation:"slideIn 0.3s ease-out"},reactionEmoji:{fontSize:"24px"},reactionUser:{color:"#fff",fontSize:"12px"},controlsOverlay:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.8))",padding:"20px",opacity:1,transition:"opacity 0.3s"},progressBarContainer:{marginBottom:"16px"},progressBar:{width:"100%",height:"4px",borderRadius:"2px",appearance:"none",backgroundColor:"rgba(255,255,255,0.2)",outline:"none",cursor:"pointer"},timeDisplay:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"12px",color:"#fff"},controls:{display:"flex",alignItems:"center",justifyContent:"space-between"},controlsLeft:{display:"flex",alignItems:"center",gap:"12px"},controlsRight:{display:"flex",alignItems:"center",gap:"12px"},controlButton:{background:"none",border:"none",color:"#fff",cursor:"pointer",padding:"8px",borderRadius:"4px",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},syncButton:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(88, 101, 242, 0.8)",border:"none",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"12px",fontWeight:"500"},volumeSlider:{width:"80px",height:"4px"},quickReactions:{display:"flex",gap:"8px",padding:"12px 20px",backgroundColor:"#2b2d31",borderTop:"1px solid rgba(255,255,255,0.1)",justifyContent:"center"},reactionButton:{background:"rgba(255,255,255,0.05)",border:"none",fontSize:"24px",padding:"8px 16px",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},chatSection:{width:"350px",backgroundColor:"#2b2d31",borderLeft:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",fontWeight:"bold",color:"#fff"},chatMessages:{flex:1,overflowY:"auto",padding:"12px"},ownMessage:{backgroundColor:"rgba(88, 101, 242, 0.15)",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",wordWrap:"break-word"},otherMessage:{backgroundColor:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",wordWrap:"break-word"},messageSender:{fontWeight:"bold",color:"#5865f2",marginRight:"6px",fontSize:"13px"},messageText:{color:"#dcddde",fontSize:"13px"},chatInput:{display:"flex",gap:"8px",padding:"12px",borderTop:"1px solid rgba(255,255,255,0.1)"},chatInputField:{flex:1,backgroundColor:"#383a40",border:"none",borderRadius:"4px",padding:"10px 12px",color:"#fff",fontSize:"14px",outline:"none"},sendButton:{backgroundColor:"#5865f2",border:"none",color:"#fff",padding:"10px 20px",borderRadius:"4px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},settingsPanel:{position:"absolute",bottom:"80px",right:"20px",backgroundColor:"#2b2d31",borderRadius:"8px",padding:"16px",minWidth:"200px",boxShadow:"0 8px 16px rgba(0,0,0,0.3)"},settingsTitle:{color:"#fff",fontSize:"14px",fontWeight:"bold",marginBottom:"12px"},settingItem:{marginBottom:"12px"},select:{width:"100%",backgroundColor:"#383a40",border:"none",color:"#fff",padding:"8px",borderRadius:"4px",fontSize:"13px",marginTop:"4px"}};export{me as default};
