import{r as n,d as e,o,i as L,ak as x,Y as j,ci as b}from"./react-core-DrOm_csO.js";import{t as u}from"./index-BYhWpPLp.js";const B=({serverId:g,channelId:f,onClose:h,onSelectMessage:v})=>{const[l,N]=n.useState(""),[m,F]=n.useState([]),[i,k]=n.useState(!1),[t,s]=n.useState({author:"",dateFrom:"",dateTo:"",hasAttachment:!1,hasLink:!1}),[d,C]=n.useState(!1),c=n.useRef(null);n.useEffect(()=>(l.length>=3&&(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{y()},500)),()=>{c.current&&clearTimeout(c.current)}),[l,t]);const y=async()=>{if(!l.trim()){u.error("âŒ Arama terimi girin");return}k(!0);try{const a=new URLSearchParams({q:l,...g&&{server:g},...f&&{channel:f},...t.author&&{author:t.author},...t.dateFrom&&{date_from:t.dateFrom},...t.dateTo&&{date_to:t.dateTo},...t.hasAttachment&&{has_attachment:!0},...t.hasLink&&{has_link:!0}}),r=await fetch(`/api/messages/search/?${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(r.ok){const E=await r.json();F(E.results),E.results.length===0&&u.info("â„¹ï¸ SonuÃ§ bulunamadÄ±")}else u.error("âŒ Arama hatasÄ±")}catch(a){console.error("Search error:",a),u.error("âŒ BaÄŸlantÄ± hatasÄ±")}finally{k(!1)}},S=(a,r)=>r?a.split(new RegExp(`(${r})`,"gi")).map((p,A)=>p.toLowerCase()===r.toLowerCase()?e.createElement("mark",{key:A},p):p):a,T=a=>new Date(a).toLocaleString("tr-TR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),w=a=>{v&&v(a),h()};return e.createElement("div",{className:"message-search-panel-overlay",onClick:h},e.createElement("div",{className:"message-search-panel",onClick:a=>a.stopPropagation()},e.createElement("div",{className:"search-header"},e.createElement(o,{className:"header-icon"}),e.createElement("h2",null,"Mesaj Ara"),e.createElement("button",{className:"close-btn",onClick:h},"Ã—")),e.createElement("div",{className:"search-input-container"},e.createElement(o,{className:"search-icon"}),e.createElement("input",{type:"text",className:"search-input",placeholder:"Mesaj ara...",value:l,onChange:a=>N(a.target.value),onKeyPress:a=>a.key==="Enter"&&y(),autoFocus:!0}),l&&e.createElement("button",{className:"clear-btn",onClick:()=>N("")},e.createElement(L,null)),e.createElement("button",{className:`filter-toggle-btn ${d?"active":""}`,onClick:()=>C(!d),title:"Filtreler"},e.createElement(x,null))),d&&e.createElement("div",{className:"filters-section"},e.createElement("div",{className:"filter-row"},e.createElement("div",{className:"filter-group"},e.createElement("label",null,e.createElement(j,null)," KullanÄ±cÄ±"),e.createElement("input",{type:"text",placeholder:"@kullanÄ±cÄ±adÄ±",value:t.author,onChange:a=>s({...t,author:a.target.value})}))),e.createElement("div",{className:"filter-row"},e.createElement("div",{className:"filter-group"},e.createElement("label",null,e.createElement(b,null)," BaÅŸlangÄ±Ã§"),e.createElement("input",{type:"date",value:t.dateFrom,onChange:a=>s({...t,dateFrom:a.target.value})})),e.createElement("div",{className:"filter-group"},e.createElement("label",null,e.createElement(b,null)," BitiÅŸ"),e.createElement("input",{type:"date",value:t.dateTo,onChange:a=>s({...t,dateTo:a.target.value})}))),e.createElement("div",{className:"filter-row"},e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:t.hasAttachment,onChange:a=>s({...t,hasAttachment:a.target.checked})}),e.createElement("span",null,"Ekli dosya iÃ§eren")),e.createElement("label",{className:"checkbox-label"},e.createElement("input",{type:"checkbox",checked:t.hasLink,onChange:a=>s({...t,hasLink:a.target.checked})}),e.createElement("span",null,"Link iÃ§eren")))),e.createElement("div",{className:"search-results"},i&&e.createElement("div",{className:"loading-state"},e.createElement("div",{className:"spinner"}),e.createElement("p",null,"AranÄ±yor...")),!i&&m.length===0&&l&&e.createElement("div",{className:"empty-state"},e.createElement(o,{size:48}),e.createElement("h3",null,"SonuÃ§ BulunamadÄ±"),e.createElement("p",null,'"',l,'" iÃ§in mesaj bulunamadÄ±')),!i&&m.length>0&&e.createElement(e.Fragment,null,e.createElement("div",{className:"results-count"},m.length," sonuÃ§ bulundu"),e.createElement("div",{className:"results-list"},m.map(a=>e.createElement("div",{key:a.id,className:"result-item",onClick:()=>w(a)},e.createElement("div",{className:"result-header"},e.createElement("img",{src:a.author.avatar||"/default-avatar.png",alt:a.author.username,className:"author-avatar"}),e.createElement("div",{className:"author-info"},e.createElement("span",{className:"author-name"},a.author.username),e.createElement("span",{className:"message-date"},T(a.created_at))),a.channel&&e.createElement("span",{className:"channel-tag"},"#",a.channel.name)),e.createElement("div",{className:"message-content"},S(a.content,l)),a.attachments&&a.attachments.length>0&&e.createElement("div",{className:"message-attachments"},"ğŸ“ ",a.attachments.length," dosya"))))),!i&&!l&&e.createElement("div",{className:"empty-state"},e.createElement(o,{size:48}),e.createElement("h3",null,"Mesaj Ara"),e.createElement("p",null,"Sunucudaki tÃ¼m mesajlarÄ± arayÄ±n"),e.createElement("ul",{className:"search-tips"},e.createElement("li",null,"En az 3 karakter girin"),e.createElement("li",null,"Filtreleri kullanarak sonuÃ§larÄ± daraltÄ±n"),e.createElement("li",null,"KullanÄ±cÄ±ya gÃ¶re filtreleyin"),e.createElement("li",null,"Tarih aralÄ±ÄŸÄ± belirleyin"))))))};export{B as default};
