import{r as l,d as e,bU as S,T as D,i as L,O as z,cf as w,aR as i,ax as k,as as y,bM as $,y as b,G as M,$ as V,m as _}from"./react-core-DrOm_csO.js";import{g as j}from"./index-DmEhdEtw.js";const J=({serverId:m,serverName:p,onClose:E,onClone:v})=>{const[F,u]=l.useState(!0),[x,P]=l.useState(!1),[s,g]=l.useState(null),[n,d]=l.useState(""),[a,T]=l.useState({channels:!0,roles:!0,emojis:!0,settings:!0,permissions:!0,categories:!0}),[N,h]=l.useState(0),[O,f]=l.useState(""),C=localStorage.getItem("access_token");l.useEffect(()=>{A()},[m]);const A=async()=>{u(!0);try{const t=await fetch(`${j()}/api/servers/${m}/clone-data/`,{headers:{Authorization:`Bearer ${C}`}});if(t.ok){const r=await t.json();g(r),d(`${r.name||p} (Copy)`)}else g({id:m,name:p,channels:[],categories:[],roles:[],emojis:[],settings:{}}),d(`${p} (Copy)`)}catch(t){console.error("Error loading server data:",t),g({id:m,name:p,channels:[],categories:[],roles:[],emojis:[],settings:{}}),d(`${p} (Copy)`)}u(!1)},c=t=>{T(r=>({...r,[t]:!r[t]}))},B=async()=>{if(n.trim()){P(!0),h(0),f("Starting clone process...");try{const t=await fetch(`${j()}/api/servers/${m}/clone/`,{method:"POST",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"},body:JSON.stringify({name:n,options:a})}),r=[{progress:20,status:"Creating server..."},{progress:40,status:"Setting up channels..."},{progress:60,status:"Configuring roles..."},{progress:80,status:"Applying settings..."},{progress:100,status:"Complete!"}];for(const o of r)await new Promise(U=>setTimeout(U,300)),h(o.progress),f(o.status);if(t.ok){const o=await t.json();alert(`Server "${n}" created successfully!`),v&&v({name:n,...a,newServerId:o.server_id})}else{const o=await t.json();alert(o.error||"Failed to clone server")}}catch(t){console.error("Error cloning server:",t),alert("Failed to clone server")}E()}},R=()=>Object.values(a).filter(Boolean).length;return F?e.createElement("div",{className:"serverclone-overlay",onClick:E},e.createElement("div",{className:"serverclone-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"loading"},"Loading server data..."))):e.createElement("div",{className:"serverclone-overlay",onClick:E},e.createElement("div",{className:"serverclone-panel",onClick:t=>t.stopPropagation()},e.createElement("div",{className:"panel-header"},e.createElement("div",{className:"header-info"},e.createElement("h2",null,e.createElement(S,null)," Clone Server"),e.createElement("span",{className:"source-server"},e.createElement(D,null)," ",s?.name)),e.createElement("button",{className:"close-btn",onClick:E},e.createElement(L,null))),x?e.createElement("div",{className:"cloning-progress"},e.createElement("div",{className:"progress-icon"},e.createElement(z,{className:"spinning"})),e.createElement("h3",null,"Cloning Server..."),e.createElement("div",{className:"progress-bar"},e.createElement("div",{className:"progress-fill",style:{width:`${N}%`}})),e.createElement("span",{className:"progress-status"},O),e.createElement("span",{className:"progress-percent"},N,"%")):e.createElement(e.Fragment,null,e.createElement("div",{className:"content"},e.createElement("div",{className:"section"},e.createElement("h3",null,"New Server Name"),e.createElement("input",{type:"text",value:n,onChange:t=>d(t.target.value),placeholder:"Enter server name",maxLength:100})),e.createElement("div",{className:"section"},e.createElement("h3",null,"What to Clone (",R(),"/6)"),e.createElement("div",{className:"options-grid"},e.createElement("div",{className:`option-card ${a.categories?"selected":""}`,onClick:()=>c("categories")},e.createElement("div",{className:"option-icon"},e.createElement(w,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Categories"),e.createElement("span",{className:"option-count"},s?.categories?.length||0," categories")),a.categories&&e.createElement(i,{className:"check"})),e.createElement("div",{className:`option-card ${a.channels?"selected":""}`,onClick:()=>c("channels")},e.createElement("div",{className:"option-icon"},e.createElement(k,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Channels"),e.createElement("span",{className:"option-count"},s?.channels?.length||0," channels")),a.channels&&e.createElement(i,{className:"check"})),e.createElement("div",{className:`option-card ${a.roles?"selected":""}`,onClick:()=>c("roles")},e.createElement("div",{className:"option-icon"},e.createElement(y,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Roles"),e.createElement("span",{className:"option-count"},s?.roles?.length||0," roles")),a.roles&&e.createElement(i,{className:"check"})),e.createElement("div",{className:`option-card ${a.permissions?"selected":""}`,onClick:()=>c("permissions")},e.createElement("div",{className:"option-icon"},e.createElement($,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Permissions"),e.createElement("span",{className:"option-count"},"Channel overrides")),a.permissions&&e.createElement(i,{className:"check"})),e.createElement("div",{className:`option-card ${a.emojis?"selected":""}`,onClick:()=>c("emojis")},e.createElement("div",{className:"option-icon"},e.createElement(b,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Emojis"),e.createElement("span",{className:"option-count"},s?.emojis?.length||0," emojis")),a.emojis&&e.createElement(i,{className:"check"})),e.createElement("div",{className:`option-card ${a.settings?"selected":""}`,onClick:()=>c("settings")},e.createElement("div",{className:"option-icon"},e.createElement($,null)),e.createElement("div",{className:"option-info"},e.createElement("span",{className:"option-name"},"Settings"),e.createElement("span",{className:"option-count"},"Server config")),a.settings&&e.createElement(i,{className:"check"})))),e.createElement("div",{className:"section"},e.createElement("h3",null,"Preview"),e.createElement("div",{className:"preview-card"},e.createElement("div",{className:"preview-header"},e.createElement("div",{className:"preview-icon"},n.charAt(0).toUpperCase()),e.createElement("div",{className:"preview-info"},e.createElement("span",{className:"preview-name"},n||"New Server"),e.createElement("span",{className:"preview-meta"},e.createElement(M,null)," 1 member"))),e.createElement("div",{className:"preview-items"},a.categories&&e.createElement("span",{className:"preview-item"},e.createElement(w,null)," ",s?.categories?.length," Categories"),a.channels&&e.createElement("span",{className:"preview-item"},e.createElement(k,null)," ",s?.channels?.filter(t=>t.type==="text").length," Text"),a.channels&&e.createElement("span",{className:"preview-item"},e.createElement(V,null)," ",s?.channels?.filter(t=>t.type==="voice").length," Voice"),a.roles&&e.createElement("span",{className:"preview-item"},e.createElement(y,null)," ",s?.roles?.length," Roles"),a.emojis&&e.createElement("span",{className:"preview-item"},e.createElement(b,null)," ",s?.emojis?.length," Emojis")))),e.createElement("div",{className:"warning-box"},e.createElement(_,null),e.createElement("div",null,e.createElement("strong",null,"Note:")," Members, messages, and message history will not be cloned. Only server structure and settings will be copied."))),e.createElement("div",{className:"panel-footer"},e.createElement("button",{className:"cancel-btn",onClick:E},"Cancel"),e.createElement("button",{className:"clone-btn",onClick:B,disabled:!n.trim()},e.createElement(S,null)," Clone Server")))))};export{J as default};
