import{r as i,n as s}from"./react-core-zXIKm1Jm.js";import{y as o}from"./ui-vendor-BGw4w3Ed.js";import{g as K}from"./index-tS2FZNgN.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-BSOZ7IB3.js";import"./router-vendor-ltdGXAv4.js";import"./crypto-vendor-D_AcF0lD.js";import"./icons-vendor-BBdoVeJd.js";import"./state-vendor-8NbFPBhQ.js";const G=({serverId:n,onClose:x})=>{const[r,c]=i.useState({enabled:!1,xp_per_message:15,xp_cooldown:60,level_up_message:"Tebrikler {user}! {level} seviyeye ulaÅŸtÄ±n! ğŸ‰",announce_channel_id:"",stack_roles:!1,reset_on_leave:!1}),[m,v]=i.useState([]),[d,g]=i.useState({level:1,role_id:""}),[b,y]=i.useState([]),[k,N]=i.useState([]),[u,_]=i.useState([]),[S,$]=i.useState(!0),t=K();i.useEffect(()=>{n&&(w(),C(),z(),P(),j())},[n]);const w=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/leveling/server/${n}/config/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();c(l.config||r)}}catch(e){console.error("Error fetching config:",e)}finally{$(!1)}},C=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/leveling/server/${n}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();v(l.level_roles||[])}}catch(e){console.error("Error fetching level roles:",e)}},z=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/servers/${n}/roles/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();y(l.roles||[])}}catch(e){console.error("Error fetching roles:",e)}},P=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/servers/${n}/channels/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();N(l.channels||[])}}catch(e){console.error("Error fetching channels:",e)}},j=async()=>{try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/leveling/server/${n}/leaderboard/`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const l=await a.json();_(l.leaderboard||[])}}catch(e){console.error("Error fetching leaderboard:",e)}},E=async()=>{try{const e=localStorage.getItem("access_token");(await fetch(`${t}/leveling/server/${n}/config/update/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).ok?o.success("âœ… Ayarlar kaydedildi"):o.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch(e){console.error("Error saving config:",e),o.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}},R=async()=>{if(!d.role_id||d.level<1){o.error("âŒ Rol ve seviye zorunludur");return}try{const e=localStorage.getItem("access_token"),a=await fetch(`${t}/leveling/server/${n}/roles/add/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(a.ok){const l=await a.json();v([...m,l.level_role]),g({level:1,role_id:""}),o.success("âœ… Seviye rolÃ¼ eklendi")}}catch(e){console.error("Error adding level role:",e),o.error("âŒ Ekleme baÅŸarÄ±sÄ±z")}},A=async e=>{try{const a=localStorage.getItem("access_token");(await fetch(`${t}/leveling/server/${n}/roles/${e}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok&&(v(m.filter(h=>h.id!==e)),o.success("âœ… Seviye rolÃ¼ kaldÄ±rÄ±ldÄ±"))}catch(a){console.error("Error removing level role:",a),o.error("âŒ KaldÄ±rma baÅŸarÄ±sÄ±z")}},L=async e=>{if(window.confirm("Bu kullanÄ±cÄ±nÄ±n XP'sini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?"))try{const a=localStorage.getItem("access_token");(await fetch(`${t}/leveling/server/${n}/user/${e}/reset/`,{method:"POST",headers:{Authorization:`Bearer ${a}`}})).ok&&(o.success("âœ… XP sÄ±fÄ±rlandÄ±"),j())}catch(a){console.error("Error resetting XP:",a),o.error("âŒ SÄ±fÄ±rlama baÅŸarÄ±sÄ±z")}},B=e=>e===1?"#fbbf24":e===2?"#c0c0c0":e===3?"#cd7f32":"#6366f1",X=e=>{const h=100-e,p=Math.floor((-50+Math.sqrt(2500-20*h))/10);return Math.max(1,p)},f=e=>5*e**2+50*e+100;return S?s.jsx("div",{className:"leveling-overlay",children:s.jsx("div",{className:"leveling-panel",children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Seviye sistemi yÃ¼kleniyor..."})]})})}):s.jsx("div",{className:"leveling-overlay",onClick:x,children:s.jsxs("div",{className:"leveling-panel",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"leveling-header",children:[s.jsx("h2",{children:"â­ Seviye Sistemi"}),s.jsx("button",{className:"close-btn",onClick:x,children:"Ã—"})]}),s.jsxs("div",{className:"leveling-content",children:[s.jsxs("div",{className:"config-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsx("h3",{children:"âš™ï¸ Genel Ayarlar"}),s.jsxs("label",{className:"toggle-switch",children:[s.jsx("input",{type:"checkbox",checked:r.enabled,onChange:e=>c({...r,enabled:e.target.checked})}),s.jsx("span",{className:"slider"}),s.jsx("span",{className:"toggle-label",children:r.enabled?"Aktif":"Pasif"})]})]}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Mesaj BaÅŸÄ±na XP"}),s.jsx("input",{type:"number",min:"1",max:"100",value:r.xp_per_message,onChange:e=>c({...r,xp_per_message:parseInt(e.target.value)}),disabled:!r.enabled})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"XP Cooldown (saniye)"}),s.jsx("input",{type:"number",min:"0",max:"300",value:r.xp_cooldown,onChange:e=>c({...r,xp_cooldown:parseInt(e.target.value)}),disabled:!r.enabled})]}),s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Duyuru KanalÄ±"}),s.jsxs("select",{value:r.announce_channel_id,onChange:e=>c({...r,announce_channel_id:e.target.value}),disabled:!r.enabled,children:[s.jsx("option",{value:"",children:"SeÃ§iniz (opsiyonel)"}),k.map(e=>s.jsxs("option",{value:e.id,children:["#",e.name]},e.id))]})]}),s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Seviye Atlama MesajÄ±"}),s.jsx("textarea",{value:r.level_up_message,onChange:e=>c({...r,level_up_message:e.target.value}),disabled:!r.enabled,rows:"2"}),s.jsxs("span",{className:"hint",children:["KullanÄ±labilir: ","{user}",", ","{level}"]})]}),s.jsx("div",{className:"form-group",children:s.jsxs("label",{className:"checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:r.stack_roles,onChange:e=>c({...r,stack_roles:e.target.checked}),disabled:!r.enabled}),s.jsx("span",{children:"Rolleri biriktir (Ã¶nceki seviye rollerini kaldÄ±rma)"})]})}),s.jsx("div",{className:"form-group",children:s.jsxs("label",{className:"checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:r.reset_on_leave,onChange:e=>c({...r,reset_on_leave:e.target.checked}),disabled:!r.enabled}),s.jsx("span",{children:"Sunucudan ayrÄ±lÄ±nca XP'yi sÄ±fÄ±rla"})]})})]}),s.jsx("button",{className:"save-btn",onClick:E,children:"ğŸ’¾ AyarlarÄ± Kaydet"})]}),s.jsxs("div",{className:"level-roles-section",children:[s.jsx("h3",{children:"ğŸ­ Seviye Rolleri"}),s.jsxs("div",{className:"add-role-form",children:[s.jsx("input",{type:"number",placeholder:"Seviye",min:"1",value:d.level,onChange:e=>g({...d,level:parseInt(e.target.value)})}),s.jsxs("select",{value:d.role_id,onChange:e=>g({...d,role_id:e.target.value}),children:[s.jsx("option",{value:"",children:"Rol seÃ§in"}),b.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("button",{className:"add-btn",onClick:R,children:"â• Ekle"})]}),s.jsx("div",{className:"level-roles-list",children:m.length===0?s.jsx("div",{className:"empty-state",children:s.jsx("span",{children:"HenÃ¼z seviye rolÃ¼ eklenmedi"})}):m.sort((e,a)=>e.level-a.level).map(e=>s.jsxs("div",{className:"level-role-item",children:[s.jsxs("div",{className:"level-badge",children:["Lv ",e.level]}),s.jsx("span",{className:"role-name",children:e.role_name||`Role #${e.role_id}`}),s.jsx("button",{className:"remove-btn",onClick:()=>A(e.id),children:"Ã—"})]},e.id))})]}),s.jsxs("div",{className:"leaderboard-section",children:[s.jsx("h3",{children:"ğŸ† SÄ±ralama"}),s.jsx("div",{className:"leaderboard-list",children:u.length===0?s.jsx("div",{className:"empty-state",children:s.jsx("span",{children:"HenÃ¼z seviye kazanan Ã¼ye yok"})}):u.map((e,a)=>{const l=X(e.xp),h=f(l),p=f(l+1),T=(e.xp-h)/(p-h)*100;return s.jsxs("div",{className:"leaderboard-item",children:[s.jsxs("div",{className:"rank-badge",style:{background:B(a+1)},children:["#",a+1]}),s.jsx("div",{className:"user-avatar",children:e.avatar?s.jsx("img",{src:e.avatar,alt:e.username}):s.jsx("span",{children:e.username[0]})}),s.jsxs("div",{className:"user-info",children:[s.jsx("div",{className:"user-name",children:e.username}),s.jsxs("div",{className:"level-progress",children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${T}%`}})}),s.jsxs("span",{className:"level-text",children:["Level ",l," â€¢ ",e.xp," XP"]})]})]}),s.jsx("button",{className:"reset-btn",onClick:()=>L(e.user_id),children:"ğŸ”„"})]},e.user_id)})})]})]})]})})};export{G as default};
