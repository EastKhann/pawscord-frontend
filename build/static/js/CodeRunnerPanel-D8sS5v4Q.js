import{r as n,n as e}from"./react-core-zXIKm1Jm.js";import{p as c,cn as X,c9 as Q,a as z,b2 as K,aK as S,s as E,af as U,D as P,b4 as V,aX as Y,I as Z,bq as ee,A as se,d as ae,cH as ne,cI as te,cJ as ie}from"./icons-vendor-DZdpmN99.js";import{y as i}from"./ui-vendor-BGw4w3Ed.js";import"./editor-vendor-DiU449Dh.js";const he=({serverId:j,channelId:d,onClose:m})=>{const[t,h]=n.useState(""),[r,p]=n.useState("python"),[u,l]=n.useState(""),[A,y]=n.useState(!1),[g,k]=n.useState(null),[C,J]=n.useState([]),[F,v]=n.useState(!1),[w,O]=n.useState([]),[B,N]=n.useState(!1),[b,D]=n.useState(!1),o=localStorage.getItem("access_token"),H=[{id:"python",name:"Python",icon:e.jsx(ne,{}),template:`# Python Code
print("Hello, World!")`},{id:"javascript",name:"JavaScript",icon:e.jsx(te,{}),template:`// JavaScript Code
console.log("Hello, World!");`},{id:"java",name:"Java",icon:e.jsx(ie,{}),template:`public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`},{id:"cpp",name:"C++",icon:e.jsx(c,{}),template:`#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`},{id:"c",name:"C",icon:e.jsx(c,{}),template:`#include <stdio.h>

int main() {
    printf("Hello, World!\\n");
    return 0;
}`},{id:"ruby",name:"Ruby",icon:e.jsx(c,{}),template:`# Ruby Code
puts "Hello, World!"`},{id:"go",name:"Go",icon:e.jsx(c,{}),template:`package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}`},{id:"rust",name:"Rust",icon:e.jsx(c,{}),template:`fn main() {
    println!("Hello, World!");
}`}];n.useEffect(()=>{T(),f()},[]),n.useEffect(()=>{const s=H.find(a=>a.id===r);s&&!t&&h(s.template)},[r]);const T=async()=>{try{const s=await fetch("/api/code-runner/history/",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const a=await s.json();J(a.history||[])}}catch(s){console.error("Error fetching history:",s)}},f=async()=>{try{const s=await fetch("/api/code-runner/snippets/",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const a=await s.json();O(a.snippets||[])}}catch(s){console.error("Error fetching snippets:",s)}},R=async()=>{if(!t.trim()){i.warning("Kod boş olamaz");return}y(!0),l("Çalıştırılıyor...");const s=Date.now();try{const a=await fetch("/api/code-runner/execute/",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({code:t,language:r,channel_id:d})}),x=await a.json(),q=Date.now();k(q-s),a.ok?(l(x.output||"Çıktı yok"),x.error&&l(`Hata:
${x.error}`)):l(`Hata: ${x.message||"Kod çalıştırılamadı"}`),T()}catch{l("Bağlantı hatası")}y(!1)},W=async()=>{try{await fetch("/api/code-runner/stop/",{method:"POST",headers:{Authorization:`Bearer ${o}`}}),y(!1),l("Çalıştırma durduruldu")}catch{i.error("Durdurma başarısız")}},G=async s=>{try{(await fetch("/api/code-runner/snippets/",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({name:s,code:t,language:r})})).ok&&(i.success("Snippet kaydedildi"),f(),N(!1))}catch{i.error("Kaydetme başarısız")}},$=s=>{h(s.code),p(s.language),v(!1)},M=async s=>{try{await fetch(`/api/code-runner/snippets/${s}/`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),i.success("Snippet silindi"),f()}catch{i.error("Silme başarısız")}},I=()=>{navigator.clipboard.writeText(u),i.success("Çıktı kopyalandı")},L=()=>{h(""),l(""),k(null)},_=async()=>{if(!d){i.warning("Paylaşım için kanal gerekli");return}try{(await fetch(`/api/channels/${d}/messages/`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({content:`\`\`\`${r}
${t}
\`\`\`
**Çıktı:**
\`\`\`
${u}
\`\`\``})})).ok&&i.success("Kanala paylaşıldı")}catch{i.error("Paylaşım başarısız")}};return e.jsx("div",{className:`code-runner-overlay ${b?"fullscreen":""}`,onClick:s=>s.target.className.includes("code-runner-overlay")&&m(),children:e.jsxs("div",{className:"code-runner-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h2",{children:[e.jsx(c,{})," Kod Çalıştırıcı"]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"fullscreen-btn",onClick:()=>D(!b),children:b?e.jsx(X,{}):e.jsx(Q,{})}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(z,{})})]})]}),e.jsxs("div",{className:"toolbar",children:[e.jsx("div",{className:"language-selector",children:H.map(s=>e.jsxs("button",{className:`lang-btn ${r===s.id?"active":""}`,onClick:()=>p(s.id),title:s.name,children:[s.icon,e.jsx("span",{children:s.name})]},s.id))}),e.jsxs("div",{className:"toolbar-actions",children:[e.jsxs("button",{className:"action-btn",onClick:()=>v(!F),children:[e.jsx(K,{})," Geçmiş"]}),e.jsxs("button",{className:"action-btn",onClick:()=>N(!0),children:[e.jsx(S,{})," Kaydet"]}),e.jsxs("button",{className:"action-btn clear",onClick:L,children:[e.jsx(E,{})," Temizle"]})]})]}),e.jsxs("div",{className:"editor-container",children:[e.jsxs("div",{className:"code-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("span",{children:[e.jsx(c,{})," Kod"]}),e.jsxs("span",{className:"line-count",children:[t.split(`
`).length," satır"]})]}),e.jsx("textarea",{className:"code-editor",value:t,onChange:s=>h(s.target.value),placeholder:"Kodunuzu buraya yazın...",spellCheck:"false"})]}),e.jsxs("div",{className:"output-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("span",{children:[e.jsx(U,{})," Çıktı"]}),e.jsxs("div",{className:"output-actions",children:[g&&e.jsxs("span",{className:"exec-time",children:[e.jsx(P,{})," ",g,"ms"]}),e.jsx("button",{onClick:I,title:"Kopyala",children:e.jsx(V,{})})]})]}),e.jsx("pre",{className:`output-display ${u.includes("Hata")?"error":""}`,children:u||"Çıktı burada görünecek..."})]})]}),e.jsxs("div",{className:"run-bar",children:[A?e.jsxs("button",{className:"stop-btn",onClick:W,children:[e.jsx(Z,{})," Durdur"]}):e.jsxs("button",{className:"run-btn",onClick:R,children:[e.jsx(Y,{})," Çalıştır"]}),d&&e.jsxs("button",{className:"share-btn",onClick:_,children:[e.jsx(c,{})," Kanala Paylaş"]})]}),F&&e.jsxs("div",{className:"history-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("h3",{children:[e.jsx(K,{})," Geçmiş & Snippets"]}),e.jsx("button",{onClick:()=>v(!1),children:e.jsx(z,{})})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("h4",{children:[e.jsx(ee,{})," Kaydedilen Snippets"]}),w.length===0?e.jsx("p",{className:"empty-msg",children:"Henüz snippet yok"}):e.jsx("div",{className:"snippets-list",children:w.map(s=>e.jsxs("div",{className:"snippet-item",children:[e.jsxs("div",{className:"snippet-info",onClick:()=>$(s),children:[e.jsx("span",{className:"snippet-name",children:s.name}),e.jsx("span",{className:"snippet-lang",children:s.language})]}),e.jsx("button",{className:"delete-snippet",onClick:()=>M(s.id),children:e.jsx(E,{})})]},s.id))})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("h4",{children:[e.jsx(P,{})," Son Çalıştırmalar"]}),C.length===0?e.jsx("p",{className:"empty-msg",children:"Geçmiş yok"}):e.jsx("div",{className:"history-list",children:C.slice(0,10).map((s,a)=>e.jsxs("div",{className:"history-item",onClick:()=>$(s),children:[e.jsxs("div",{className:"history-info",children:[e.jsx("span",{className:"history-lang",children:s.language}),e.jsx("span",{className:`history-status ${s.success?"success":"error"}`,children:s.success?e.jsx(se,{}):e.jsx(ae,{})})]}),e.jsxs("code",{className:"history-preview",children:[s.code?.substring(0,50),"..."]}),e.jsxs("span",{className:"history-time",children:[s.exec_time,"ms"]})]},a))})]})]}),B&&e.jsx(re,{onClose:()=>N(!1),onSave:G,language:r})]})})},re=({onClose:j,onSave:d,language:m})=>{const[t,h]=n.useState(""),r=()=>{if(!t.trim()){i.warning("Snippet adı gerekli");return}d(t)};return e.jsx("div",{className:"modal-overlay",onClick:p=>p.target.className==="modal-overlay"&&j(),children:e.jsxs("div",{className:"save-modal",children:[e.jsxs("h3",{children:[e.jsx(S,{})," Snippet Kaydet"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Snippet Adı"}),e.jsx("input",{type:"text",value:t,onChange:p=>h(p.target.value),placeholder:"örn: Fibonacci Hesaplama"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dil"}),e.jsx("input",{type:"text",value:m,disabled:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:j,children:"İptal"}),e.jsxs("button",{className:"save-submit-btn",onClick:r,children:[e.jsx(S,{})," Kaydet"]})]})]})})};export{he as default};
