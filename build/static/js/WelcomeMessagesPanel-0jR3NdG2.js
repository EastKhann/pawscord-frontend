import{r as _,j as e}from"./react-core-D6cE4lil.js";import{y as p}from"./ui-vendor-CZOhtEfS.js";import{g as y}from"./index-BvqjkDq7.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./icons-vendor-DT2gd7vx.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-BYnay7oC.js";const N={welcome_enabled:!1,welcome_channel_id:"",welcome_message:"HoÅŸ geldin {user}! {server} sunucusuna katÄ±ldÄ±n!",welcome_embed:!1,welcome_embed_color:"#5865f2",welcome_embed_title:"HoÅŸ Geldin!",welcome_embed_description:"{user} sunucuya katÄ±ldÄ±!",welcome_dm:!1,welcome_dm_message:"Merhaba {user}! {server} sunucusuna hoÅŸ geldin!",goodbye_enabled:!1,goodbye_channel_id:"",goodbye_message:"{user} sunucudan ayrÄ±ldÄ±. HoÅŸÃ§a kal!",goodbye_embed:!1,goodbye_embed_color:"#ed4245",auto_role_enabled:!1,auto_role_ids:[]},f=[{code:"{user}",desc:"KullanÄ±cÄ± adÄ±"},{code:"{user_mention}",desc:"KullanÄ±cÄ± mention"},{code:"{server}",desc:"Sunucu adÄ±"},{code:"{member_count}",desc:"Ãœye sayÄ±sÄ±"},{code:"{user_id}",desc:"KullanÄ±cÄ± ID"}],C=n=>{const[r,s]=_.useState(N),[t,m]=_.useState([]),[u,j]=_.useState([]),[b,x]=_.useState(null),[g,h]=_.useState(!0),l=y(),d=()=>({Authorization:`Bearer ${localStorage.getItem("access_token")}`}),o=async()=>{try{const c=await fetch(`${l}/welcome-messages/server/${n}/`,{headers:d()});if(c.ok){const i=await c.json();i.config&&s(i.config)}}catch{}finally{h(!1)}},w=async()=>{try{const c=await fetch(`${l}/servers/${n}/channels/`,{headers:d()});if(c.ok){const i=await c.json();m(i.channels||[])}}catch{}},v=async()=>{try{const c=await fetch(`${l}/servers/${n}/roles/`,{headers:d()});if(c.ok){const i=await c.json();j(i.roles||[])}}catch{}},a=async()=>{try{const c=await fetch(`${l}/welcome-messages/server/${n}/stats/`,{headers:d()});c.ok&&x(await c.json())}catch{}};return _.useEffect(()=>{n&&(o(),w(),v(),a())},[n]),{welcomeConfig:r,updateConfig:(c,i)=>s({...r,[c]:i}),insertVariable:(c,i)=>s({...r,[c]:r[c]+` ${i}`}),channels:t,roles:u,stats:b,loading:g,saveConfig:async()=>{try{(await fetch(`${l}/welcome-messages/server/${n}/update/`,{method:"POST",headers:{...d(),"Content-Type":"application/json"},body:JSON.stringify(r)})).ok?(p.success("âœ… KarÅŸÄ±lama ayarlarÄ± kaydedildi"),a()):p.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}catch{p.error("âŒ Kaydetme baÅŸarÄ±sÄ±z")}},testWelcomeMessage:async()=>{try{(await fetch(`${l}/welcome-messages/server/${n}/test/`,{method:"POST",headers:{...d(),"Content-Type":"application/json"},body:JSON.stringify({type:"welcome"})})).ok?p.success("âœ… Test mesajÄ± gÃ¶nderildi"):p.error("âŒ Test mesajÄ± gÃ¶nderilemedi")}catch{p.error("âŒ Test baÅŸarÄ±sÄ±z")}}}},k=({title:n,icon:r,config:s,enabledKey:t,channelKey:m,messageKey:u,embedKey:j,embedColorKey:b,embedTitleKey:x,embedDescKey:g,dmKey:h,dmMessageKey:l,channels:d,updateConfig:o,insertVariable:w,onTest:v})=>e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[r," ",n]}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:s[t],onChange:a=>o(t,a.target.checked)}),e.jsx("span",{className:"slider"}),e.jsx("span",{className:"toggle-label",children:s[t]?"âœ“ Aktif":"âœ— Pasif"})]})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:m.includes("goodbye")?"Veda KanalÄ±":"KarÅŸÄ±lama KanalÄ±"}),e.jsxs("select",{value:s[m],onChange:a=>o(m,a.target.value),disabled:!s[t],children:[e.jsxs("option",{value:"",children:["Kanal se","Ã§","in"]}),d.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:m.includes("goodbye")?"Veda MesajÄ±":"HoÅŸ Geldin MesajÄ±"}),e.jsx("textarea",{value:s[u],onChange:a=>o(u,a.target.value),disabled:!s[t],rows:"3"}),e.jsx("div",{className:"variables-bar",children:f.map(a=>e.jsx("button",{className:"variable-btn",onClick:()=>w(u,a.code),disabled:!s[t],title:a.desc,children:a.code},a.code))})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s[j],onChange:a=>o(j,a.target.checked),disabled:!s[t]}),e.jsxs("span",{children:["Embed olarak g","Ã¶","nder"]})]})}),s[j]&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Embed Rengi"}),e.jsx("input",{type:"color",value:s[b],onChange:a=>o(b,a.target.value),disabled:!s[t]})]}),x&&e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:["Embed Ba","ÅŸ","l","Ä±","k"]}),e.jsx("input",{type:"text",value:s[x],onChange:a=>o(x,a.target.value),disabled:!s[t]})]}),g&&e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:["Embed A","Ã§Ä±","klama"]}),e.jsx("textarea",{value:s[g],onChange:a=>o(g,a.target.value),disabled:!s[t],rows:"3"})]})]}),h&&e.jsx("div",{className:"form-group full-width",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s[h],onChange:a=>o(h,a.target.checked),disabled:!s[t]}),e.jsxs("span",{children:["Kullan","Ä±","c","Ä±","ya DM g","Ã¶","nder"]})]})}),h&&s[h]&&l&&e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:["DM Mesaj","Ä±"]}),e.jsx("textarea",{value:s[l],onChange:a=>o(l,a.target.value),disabled:!s[t],rows:"3"})]})]}),v&&e.jsxs("button",{className:"test-btn",onClick:v,disabled:!s[t],children:["ðŸ§ª"," Test Et"]})]}),S=[{icon:"ðŸ‘‹",key:"total_welcomes",label:"Toplam KarÅŸÄ±lama"},{icon:"ðŸ˜¢",key:"total_goodbyes",label:"Toplam Veda"},{icon:"ðŸ“…",key:"welcomes_today",label:"BugÃ¼n KatÄ±lan"}],H=({serverId:n,onClose:r})=>{const{welcomeConfig:s,updateConfig:t,insertVariable:m,channels:u,roles:j,stats:b,loading:x,saveConfig:g,testWelcomeMessage:h}=C(n);return x?e.jsx("div",{className:"welcome-messages-overlay",children:e.jsx("div",{className:"welcome-messages-panel",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Kar","ÅŸÄ±","lama mesajlar","Ä±"," y","Ã¼","kleniyor..."]})]})})}):e.jsx("div",{className:"welcome-messages-overlay",onClick:r,children:e.jsxs("div",{className:"welcome-messages-panel",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"welcome-header",children:[e.jsxs("h2",{children:["ðŸ‘‹"," Kar","ÅŸÄ±","lama & Veda Mesajlar","Ä±"]}),e.jsx("button",{className:"close-btn",onClick:r,children:"Ã—"})]}),b&&e.jsx("div",{className:"stats-overview",children:S.map(l=>e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-icon",children:l.icon}),e.jsx("span",{className:"stat-value",children:b[l.key]||0}),e.jsx("span",{className:"stat-label",children:l.label})]},l.key))}),e.jsxs("div",{className:"config-content",children:[e.jsx(k,{title:"Ho\\u015F Geldin Mesajlar\\u0131",icon:"\\uD83D\\uDC4B",config:s,enabledKey:"welcome_enabled",channelKey:"welcome_channel_id",messageKey:"welcome_message",embedKey:"welcome_embed",embedColorKey:"welcome_embed_color",embedTitleKey:"welcome_embed_title",embedDescKey:"welcome_embed_description",dmKey:"welcome_dm",dmMessageKey:"welcome_dm_message",channels:u,updateConfig:t,insertVariable:m,onTest:h}),e.jsx(k,{title:"Veda Mesajlar\\u0131",icon:"\\uD83D\\uDE22",config:s,enabledKey:"goodbye_enabled",channelKey:"goodbye_channel_id",messageKey:"goodbye_message",embedKey:"goodbye_embed",embedColorKey:"goodbye_embed_color",channels:u,updateConfig:t,insertVariable:m}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:["â­"," Otomatik Rol"]}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:s.auto_role_enabled,onChange:l=>t("auto_role_enabled",l.target.checked)}),e.jsx("span",{className:"slider"}),e.jsx("span",{className:"toggle-label",children:s.auto_role_enabled?"âœ“ Aktif":"âœ— Pasif"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Otomatik verilecek roller"}),e.jsx("div",{className:"roles-selector",children:j.map(l=>e.jsxs("label",{className:"role-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.auto_role_ids.includes(l.id),onChange:d=>{const o=d.target.checked?[...s.auto_role_ids,l.id]:s.auto_role_ids.filter(w=>w!==l.id);t("auto_role_ids",o)},disabled:!s.auto_role_enabled}),e.jsx("span",{children:l.name})]},l.id))})]})]}),e.jsxs("button",{className:"save-btn",onClick:g,children:["ðŸ’¾"," Ayarlar","Ä±"," Kaydet"]})]})]})})};export{H as default};
