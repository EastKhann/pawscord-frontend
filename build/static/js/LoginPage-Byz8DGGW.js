import{r as u,d as o,ax as C,S as z,ad as D,m as O}from"./react-core-4ecKhyvC.js";import{C as v,G as I,i as p,j as k,t as M,A as S}from"./index-GWPtu2Un.js";import{u as P}from"./recaptcha-CyMohKh4.js";const W=({onLogin:L,onRegister:x,error:b,setAuthError:a})=>{const[m,G]=u.useState(!0),[d,y]=u.useState({username:"",email:"",password:""}),[E,T]=u.useState(!1),{getToken:_}=P();u.useEffect(()=>{if(v.isNativePlatform()){console.log("ğŸ“± [Google] Initializing Google Auth for mobile...");try{I.initialize({clientId:"774757987258-poa0elqqapnab8eud3tol3h2pilcqe71.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}),console.log("âœ… [Google] Initialized successfully")}catch(e){console.error("âŒ [Google] Initialization failed:",e)}}},[]),u.useEffect(()=>{if(p&&window.require){const{ipcRenderer:e}=window.require("electron"),s=(f,l)=>{console.log("âœ… [Electron] Google auth success received");try{const{access:r,refresh:c}=l;if(r&&c){const g=k(r);console.log("ğŸ‘¤ [Electron] User:",g.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",g.username),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] Token error:",r),a("Token iÅŸleme hatasÄ±.")}},t=(f,l)=>{console.error("âŒ [Electron] Auth error:",l),a(l.error||"Google giriÅŸi baÅŸarÄ±sÄ±z.")},i=(f,l)=>{console.log("ğŸ”— [Electron] OAuth tokens received from main process");try{const{access:r,refresh:c}=l;if(r&&c){const g=k(r);console.log("ğŸ‘¤ [Electron] User from deep link:",g.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",c),localStorage.setItem("chat_username",g.username),console.log("âœ… [Electron] Tokens saved, reloading..."),setTimeout(()=>window.location.reload(),500)}}catch(r){console.error("âŒ [Electron] OAuth token error:",r),a("Token iÅŸleme hatasÄ±.")}},n=(f,l)=>{console.log("ğŸš€ [DeepLink] URL YakalandÄ±:",l);try{const r=new URL(l),c=new URLSearchParams(r.search),g=c.get("access"),h=c.get("refresh");if(g&&h){console.log("âœ… [DeepLink] GiriÅŸ BaÅŸarÄ±lÄ±!");const w=k(g);console.log("ğŸ‘¤ [Electron] Decoded user from token:",w.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",h),localStorage.setItem("chat_username",w.username),window.location.reload()}}catch(r){console.error("Deep link hatasÄ±:",r);try{if(l.includes("access=")&&l.includes("refresh=")){const c=l.split("access=");if(c.length>1){const g=c[1].split("&")[0],h=l.split("refresh=");if(h.length>1){const w=h[1],R=k(g);localStorage.removeItem("chat_username"),localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",w),localStorage.setItem("chat_username",R.username),window.location.reload()}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}else a("GiriÅŸ verisi okunamadÄ±.")}catch(c){console.error("Manual parsing error:",c),a("GiriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z.")}}};return e.on("google-auth-success",s),e.on("google-auth-error",t),e.on("deep-link-auth",n),e.on("oauth-tokens",i),()=>{e.removeListener("google-auth-success",s),e.removeListener("google-auth-error",t),e.removeListener("deep-link-auth",n),e.removeListener("oauth-tokens",i)}}},[a]),u.useEffect(()=>{if(!p){const e=new URLSearchParams(window.location.search),s=e.get("access"),t=e.get("refresh"),i=e.get("error");if(i){console.error("âŒ [Web] OAuth error from URL:",i),a(decodeURIComponent(i)),window.history.replaceState({},document.title,"/");return}if(s&&t){console.log("ğŸŒ [Web] Tokenlar URL'den alÄ±ndÄ± (OAuth success)");try{const n=k(s);console.log("ğŸ‘¤ [Web] Decoded user from token:",n.username),localStorage.removeItem("chat_username"),localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",t),localStorage.setItem("chat_username",n.username),console.log("âœ… [Web] Tokens and username saved to localStorage"),window.history.replaceState({},document.title,"/"),window.location.reload()}catch(n){console.error("âŒ [Web] LocalStorage error:",n),a("TarayÄ±cÄ± depolama hatasÄ±. LÃ¼tfen gizli modda deÄŸilseniz kontrol edin.")}}}},[]);const N=async()=>{try{if(console.log("ğŸ”µ [Google] Login baÅŸlatÄ±lÄ±yor...",{isNative:v.isNativePlatform(),isElectron:p,apiUrl:S}),v.isNativePlatform()){console.log("ğŸ“± [Google] Mobile auth flow");const e=await I.signIn();console.log("âœ… [Google] User signed in:",e.email),console.log("ğŸ”‘ [Google] ID Token:",e.authentication.idToken);const s=`${S}/auth/google/native/`;console.log("ğŸ“¡ [Google] Sending to:",s);const t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:e.authentication.idToken})});console.log("ğŸ” [Google] Response status:",t.status),console.log("ğŸ” [Google] Response headers:",t.headers);const i=t.headers.get("content-type");if(console.log("ğŸ” [Google] Content-Type:",i),!i||!i.includes("application/json")){const f=await t.text();console.error("âŒ [Google] Backend HTML dÃ¶ndÃ¼:",f.substring(0,500)),a("Backend hatasÄ±: JSON yerine HTML yanÄ±tÄ± alÄ±ndÄ±. Sunucu ayarlarÄ±nÄ± kontrol edin.");return}const n=await t.json();console.log("ğŸ“¦ [Google] Backend response data:",n),t.ok?(console.log("âœ… [Google] Login successful"),n.access&&n.refresh?(localStorage.setItem("access_token",n.access),localStorage.setItem("refresh_token",n.refresh),window.location.reload()):(console.error("âŒ [Google] Tokens eksik:",n),a("Token bilgileri eksik."))):(console.error("âŒ [Google] Login failed:",n),a(n.error||"Google giriÅŸi baÅŸarÄ±sÄ±z."))}else{console.log("ğŸŒ [Google] Web/Electron redirect flow");const t=`${p?"https://api.pawscord.com/api":S}/auth/google/start/?source=${p?"electron":"web"}`;if(console.log("ğŸ”€ [Google] Redirecting to:",t),p&&window.require){const{ipcRenderer:i}=window.require("electron");console.log("âœ… [Google] Opening in Electron popup:",t),i.send("start-google-login",t)}else window.location.href=t}}catch(e){console.error("âŒ [Google] Unexpected error:",e),a("Google giriÅŸi sÄ±rasÄ±nda bir hata oluÅŸtu: "+e.message)}},U=async e=>{e.preventDefault(),T(!0),a("");try{const s=await _(m?"login":"register");m?await L(d.username,d.password,s):await x(d.username,d.email,d.password,s)&&(M.success("KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ± kontrol et.",4e3),G(!0))}catch(s){console.error("âŒ [Login] Beklenmeyen hata:",s),a("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{T(!1)}};return o.createElement("div",{className:"login-container"},o.createElement("div",{className:"background-animate"}),o.createElement("div",{className:"login-card"},o.createElement("div",{className:"logo-header"},o.createElement("div",{className:"logo-circle"},o.createElement(C,{size:40,color:"white"})),o.createElement("h1",null,"Pawscord"),o.createElement("p",null,m?"Tekrar hoÅŸgeldin!":"AramÄ±za katÄ±l!")),b&&o.createElement("div",{className:"error-message"},b),o.createElement("form",{onSubmit:U},o.createElement("div",{className:"input-group"},o.createElement(z,{className:"input-icon"}),o.createElement("input",{type:"text",placeholder:"KullanÄ±cÄ± AdÄ±",value:d.username,onChange:e=>y({...d,username:e.target.value}),required:!0})),!m&&o.createElement("div",{className:"input-group slide-down"},o.createElement(D,{className:"input-icon"}),o.createElement("input",{type:"email",placeholder:"E-posta Adresi",value:d.email,onChange:e=>y({...d,email:e.target.value}),required:!0})),o.createElement("div",{className:"input-group"},o.createElement(O,{className:"input-icon"}),o.createElement("input",{type:"password",placeholder:"Åifre",value:d.password,onChange:e=>y({...d,password:e.target.value}),required:!0})),o.createElement("button",{type:"submit",className:"submit-btn",disabled:E},E?o.createElement("div",{className:"spinner"}):m?"GiriÅŸ Yap":"KayÄ±t Ol")),m&&o.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},o.createElement("a",{href:"#/forgot-password",style:{color:"#5865f2",textDecoration:"none",fontSize:"14px",transition:"opacity 0.2s"},onMouseEnter:e=>e.target.style.opacity="0.8",onMouseLeave:e=>e.target.style.opacity="1"},"Åifremi Unuttum?")),o.createElement("div",{className:"divider"},o.createElement("span",null,"veya")),o.createElement("div",{className:"google-btn-wrapper"},o.createElement("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"11px",borderRadius:"20px",border:"1px solid #dadce0",backgroundColor:"#ffffff",color:"#3c4043",fontWeight:"500",cursor:"pointer",fontSize:"14px",gap:"10px",fontFamily:'"Google Sans", arial, sans-serif',transition:"background-color .2s, box-shadow .2s",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f7f8f8",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px rgba(0,0,0,0.1)"},onMouseDown:e=>e.currentTarget.style.backgroundColor="#eff2f5"},o.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"G",style:{width:"18px",height:"18px"}}),o.createElement("span",null,"Google ile GiriÅŸ Yap"))),o.createElement("div",{className:"toggle-mode"},m?"HesabÄ±n yok mu? ":"Zaten Ã¼ye misin? ",o.createElement("span",{onClick:()=>{G(!m),a("")}},m?"KayÄ±t Ol":"GiriÅŸ Yap"))))};export{W as default};
