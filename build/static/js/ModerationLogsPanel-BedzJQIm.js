import{r as c,ay as w,l as Y,b_ as S,c0 as F,Y as N,o as A,aq as H,dx as C,p as K,aT as P,aN as L,aH as G,aD as Z,ax as q,ch as E,bX as V,a0 as X,v as J,bZ as Q}from"./react-core-B6hadH-M.js";import{h as W}from"./index-D_6pZib5.js";const te=({serverId:m,onClose:b})=>{const[f,o]=c.useState([]),[R,y]=c.useState(!0),[t,i]=c.useState({action_type:"all",moderator:"",target_user:"",date_from:"",date_to:""}),[p,$]=c.useState(!1),[v,x]=c.useState(null),[s,g]=c.useState(null),[u,r]=c.useState(1),[M,T]=c.useState(!0),d=localStorage.getItem("access_token");c.useEffect(()=>{k(),D()},[m,t,u]);const k=async()=>{y(!0);try{const e=new URLSearchParams({page:u,...Object.fromEntries(Object.entries(t).filter(([a,n])=>n&&n!=="all"))}),l=await fetch(`/api/servers/${m}/moderation/logs/?${e}`,{headers:{Authorization:`Bearer ${d}`}});if(l.ok){const a=await l.json();o(u===1?a.logs||[]:n=>[...n,...a.logs||[]]),T(a.has_more??!0)}else o([])}catch(e){console.error("Error fetching moderation logs:",e),o([])}y(!1)},D=async()=>{try{const e=await fetch(`/api/servers/${m}/moderation/stats/`,{headers:{Authorization:`Bearer ${d}`}});e.ok?g(await e.json()||h):g(h)}catch{g(h)}},h={total_actions:0,this_week:0,bans:0,kicks:0,timeouts:0,warns:0,mutes:0,deletes:0,automod_actions:0,top_moderators:[]},j=e=>({ban:React.createElement(S,{className:"action-ban"}),kick:React.createElement(F,{className:"action-kick"}),timeout:React.createElement(N,{className:"action-timeout"}),mute:React.createElement(Q,{className:"action-mute"}),warn:React.createElement(A,{className:"action-warn"}),delete_messages:React.createElement(J,{className:"action-delete"}),automod:React.createElement(X,{className:"action-automod"})})[e]||React.createElement(V,null),B=e=>({ban:"Yasaklama",kick:"Sunucudan Atma",timeout:"Zaman Aşımı",mute:"Susturma",warn:"Uyarı",delete_messages:"Mesaj Silme",automod:"AutoMod"})[e]||e,U=async e=>{if(await W("Bu moderasyon eylemini geri almak istediğinizden emin misiniz?"))try{(await fetch(`/api/servers/${m}/moderation/logs/${e}/revert/`,{method:"POST",headers:{Authorization:`Bearer ${d}`}})).ok&&(E.success("Eylem geri alındı"),k())}catch{o(f.map(a=>a.id===e?{...a,reverted:!0}:a)),E.success("Eylem geri alındı")}},z=async()=>{try{const e=await fetch(`/api/servers/${m}/moderation/logs/export/`,{headers:{Authorization:`Bearer ${d}`}});if(e.ok){const l=await e.blob(),a=window.URL.createObjectURL(l),n=document.createElement("a");n.href=a,n.download=`moderation-logs-${new Date().toISOString().split("T")[0]}.csv`,n.click(),E.success("Loglar indirildi")}}catch{E.error("Dışa aktarma başarısız")}},O=e=>new Date(e).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),_=f;return React.createElement("div",{className:"moderation-logs-overlay",onClick:e=>e.target.className==="moderation-logs-overlay"&&b()},React.createElement("div",{className:"moderation-logs-panel"},React.createElement("div",{className:"panel-header"},React.createElement("h2",null,React.createElement(w,null)," Moderasyon Logları"),React.createElement("button",{className:"close-btn",onClick:b},React.createElement(Y,null))),s&&React.createElement("div",{className:"stats-bar"},React.createElement("div",{className:"stat-item"},React.createElement("span",{className:"stat-value"},s.total_actions),React.createElement("span",{className:"stat-label"},"Toplam")),React.createElement("div",{className:"stat-item"},React.createElement("span",{className:"stat-value"},s.this_week),React.createElement("span",{className:"stat-label"},"Bu Hafta")),React.createElement("div",{className:"stat-item ban"},React.createElement(S,null),React.createElement("span",null,s.bans)),React.createElement("div",{className:"stat-item kick"},React.createElement(F,null),React.createElement("span",null,s.kicks)),React.createElement("div",{className:"stat-item timeout"},React.createElement(N,null),React.createElement("span",null,s.timeouts)),React.createElement("div",{className:"stat-item warn"},React.createElement(A,null),React.createElement("span",null,s.warns))),React.createElement("div",{className:"filters-section"},React.createElement("div",{className:"filters-header"},React.createElement("button",{className:"filter-toggle",onClick:()=>$(!p)},React.createElement(H,null)," Filtreler",p?React.createElement(C,null):React.createElement(K,null)),React.createElement("button",{className:"export-btn",onClick:z},React.createElement(P,null)," Dışa Aktar")),p&&React.createElement("div",{className:"filters-content"},React.createElement("div",{className:"filter-group"},React.createElement("label",null,"Eylem Türü"),React.createElement("select",{value:t.action_type,onChange:e=>{i({...t,action_type:e.target.value}),r(1)}},React.createElement("option",{value:"all"},"Tümü"),React.createElement("option",{value:"ban"},"Yasaklama"),React.createElement("option",{value:"kick"},"Atma"),React.createElement("option",{value:"timeout"},"Zaman Aşımı"),React.createElement("option",{value:"mute"},"Susturma"),React.createElement("option",{value:"warn"},"Uyarı"),React.createElement("option",{value:"delete_messages"},"Mesaj Silme"),React.createElement("option",{value:"automod"},"AutoMod"))),React.createElement("div",{className:"filter-group"},React.createElement("label",null,"Moderatör"),React.createElement("input",{type:"text",placeholder:"Kullanıcı adı",value:t.moderator,onChange:e=>{i({...t,moderator:e.target.value}),r(1)}})),React.createElement("div",{className:"filter-group"},React.createElement("label",null,"Hedef Kullanıcı"),React.createElement("input",{type:"text",placeholder:"Kullanıcı adı",value:t.target_user,onChange:e=>{i({...t,target_user:e.target.value}),r(1)}})),React.createElement("div",{className:"filter-group"},React.createElement("label",null,"Başlangıç"),React.createElement("input",{type:"date",value:t.date_from,onChange:e=>{i({...t,date_from:e.target.value}),r(1)}})),React.createElement("div",{className:"filter-group"},React.createElement("label",null,"Bitiş"),React.createElement("input",{type:"date",value:t.date_to,onChange:e=>{i({...t,date_to:e.target.value}),r(1)}})))),React.createElement("div",{className:"panel-content"},R&&u===1?React.createElement("div",{className:"loading"},"Yükleniyor..."):_.length===0?React.createElement("div",{className:"empty-state"},React.createElement(w,null),React.createElement("p",null,"Moderasyon logu bulunamadı")):React.createElement("div",{className:"logs-list"},_.map(e=>React.createElement("div",{key:e.id,className:`log-item ${e.reverted?"reverted":""}`},React.createElement("div",{className:"log-icon"},j(e.action_type)),React.createElement("div",{className:"log-main"},React.createElement("div",{className:"log-header"},React.createElement("span",{className:`action-badge ${e.action_type}`},B(e.action_type)),e.reverted&&React.createElement("span",{className:"reverted-badge"},React.createElement(L,null)," Geri Alındı"),React.createElement("span",{className:"log-time"},React.createElement(N,null)," ",O(e.created_at))),React.createElement("div",{className:"log-users"},React.createElement("div",{className:"user-info"},React.createElement("img",{src:e.moderator.avatar||"/default-avatar.png",alt:""}),React.createElement("span",null,e.moderator.username)),React.createElement("span",{className:"arrow"},"→"),React.createElement("div",{className:"user-info target"},React.createElement("img",{src:e.target_user.avatar||"/default-avatar.png",alt:""}),React.createElement("span",null,e.target_user.username))),React.createElement("div",{className:"log-reason"},React.createElement(G,null)," ",e.reason),e.channel&&React.createElement("div",{className:"log-channel"},React.createElement(Z,null)," ",e.channel.name),v===e.id&&e.details&&Object.keys(e.details).length>0&&React.createElement("div",{className:"log-details"},e.details.duration&&React.createElement("span",null,React.createElement("strong",null,"Süre:")," ",e.details.duration),e.details.message_count&&React.createElement("span",null,React.createElement("strong",null,"Silinen Mesaj:")," ",e.details.message_count),e.details.warning_count&&React.createElement("span",null,React.createElement("strong",null,"Toplam Uyarı:")," ",e.details.warning_count),e.details.trigger&&React.createElement("span",null,React.createElement("strong",null,"Tetikleyici:")," ",e.details.trigger),e.details.evidence&&React.createElement("div",{className:"evidence"},React.createElement("strong",null,"Kanıtlar:"),React.createElement("ul",null,e.details.evidence.map((l,a)=>React.createElement("li",{key:a},l)))))),React.createElement("div",{className:"log-actions"},Object.keys(e.details||{}).length>0&&React.createElement("button",{className:"detail-btn",onClick:()=>x(v===e.id?null:e.id),title:"Detaylar"},v===e.id?React.createElement(C,null):React.createElement(q,null)),!e.reverted&&["ban","mute","timeout"].includes(e.action_type)&&React.createElement("button",{className:"revert-btn",onClick:()=>U(e.id),title:"Geri Al"},React.createElement(L,null))))),M&&React.createElement("button",{className:"load-more-btn",onClick:()=>r(e=>e+1),disabled:R},R?"Yükleniyor...":"Daha Fazla Yükle")))))};export{te as default};
