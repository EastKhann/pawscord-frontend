import{r as i,b as e}from"./react-core-9vc7GIjk.js";import{L as R,a as k,j as _,u as y,x as z,ay as E}from"./icons-vendor-BHKL7tCa.js";import{t as w}from"./index-BeAegwkv.js";import"./editor-vendor-DiU449Dh.js";import"./media-vendor-B-uSUaIv.js";import"./router-vendor-u6fxj6P4.js";import"./crypto-vendor-C1qXRpJv.js";import"./state-vendor-0vlBuk0v.js";const j=({fetchWithAuth:m,apiBaseUrl:d,onClose:p,username:o})=>{const[r,s]=i.useState(null),[g,h]=i.useState([]),[u,v]=i.useState([]),[b,x]=i.useState(!0),[f,S]=i.useState("24h"),[B,C]=i.useState(null);i.useEffect(()=>{L()},[f]);const L=async()=>{x(!0);try{const l=await(await m(`${d}/api/analytics/usage/?range=${f}`)).json();s(l.stats||{}),h(l.endpoints||[]),v(l.timeline||[])}catch(a){console.error("Failed to load API usage:",a),w.error("Failed to load analytics")}finally{x(!1)}},I=()=>{if(!r||!r.rate_limit)return{color:"#43b581",text:"Normal"};const l=(r.requests_made||0)/r.rate_limit*100;return l>=90?{color:"#f04747",text:"Critical"}:l>=70?{color:"#faa61a",text:"Warning"}:{color:"#43b581",text:"Normal"}},n=r||{requests_made:0,rate_limit:1e4,success_rate:0,avg_response_time:0,errors:0},c=I();return e.createElement("div",{style:t.overlay,onClick:p},e.createElement("div",{style:t.modal,onClick:a=>a.stopPropagation()},e.createElement("div",{style:t.header},e.createElement("div",{style:t.headerLeft},e.createElement(R,{style:{fontSize:"24px",color:"#5865f2"}}),e.createElement("h2",{style:{margin:0,fontSize:"20px"}},"API Usage Analytics")),e.createElement("div",{style:t.headerRight},e.createElement("select",{value:f,onChange:a=>S(a.target.value),style:t.timeRangeSelect},e.createElement("option",{value:"24h"},"Last 24 Hours"),e.createElement("option",{value:"7d"},"Last 7 Days"),e.createElement("option",{value:"30d"},"Last 30 Days")),e.createElement("button",{onClick:p,style:t.closeBtn},e.createElement(k,null)))),e.createElement("div",{style:t.content},b?e.createElement("div",{style:t.loading},"Loading analytics..."):e.createElement(e.Fragment,null,e.createElement("div",{style:t.statsGrid},e.createElement("div",{style:t.statCard},e.createElement("div",{style:t.statIcon},e.createElement(_,{style:{color:"#5865f2"}})),e.createElement("div",{style:t.statInfo},e.createElement("div",{style:t.statValue},(n.requests_made||0).toLocaleString()),e.createElement("div",{style:t.statLabel},"Total Requests"))),e.createElement("div",{style:t.statCard},e.createElement("div",{style:t.statIcon},e.createElement(y,{style:{color:"#43b581"}})),e.createElement("div",{style:t.statInfo},e.createElement("div",{style:t.statValue},n.success_rate?`${n.success_rate.toFixed(1)}%`:"0%"),e.createElement("div",{style:t.statLabel},"Success Rate"))),e.createElement("div",{style:t.statCard},e.createElement("div",{style:t.statIcon},e.createElement(z,{style:{color:"#faa61a"}})),e.createElement("div",{style:t.statInfo},e.createElement("div",{style:t.statValue},n.avg_response_time?`${n.avg_response_time}ms`:"0ms"),e.createElement("div",{style:t.statLabel},"Avg Response Time"))),e.createElement("div",{style:t.statCard},e.createElement("div",{style:t.statIcon},e.createElement(E,{style:{color:"#f04747"}})),e.createElement("div",{style:t.statInfo},e.createElement("div",{style:t.statValue},n.errors||0),e.createElement("div",{style:t.statLabel},"Errors")))),e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Rate Limit Status"),e.createElement("div",{style:{...t.rateLimitCard,borderLeftColor:c.color}},e.createElement("div",{style:t.rateLimitInfo},e.createElement("div",{style:t.rateLimitText},n.requests_made||0," / ",n.rate_limit||1e4," requests used"),e.createElement("div",{style:{...t.rateLimitStatus,color:c.color}},c.text)),e.createElement("div",{style:t.rateLimitBar},e.createElement("div",{style:{...t.rateLimitProgress,width:`${Math.min((n.requests_made||0)/(n.rate_limit||1e4)*100,100)}%`,backgroundColor:c.color}})),n.reset_at&&e.createElement("div",{style:t.rateLimitReset},"Resets in: ",T(n.reset_at)))),e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Top Endpoints"),e.createElement("div",{style:t.endpointsList},g.length===0?e.createElement("div",{style:t.empty},"No endpoint data"):g.slice(0,10).map((a,l)=>e.createElement("div",{key:l,style:t.endpointItem,onClick:()=>C(a)},e.createElement("div",{style:t.endpointRank},"#",l+1),e.createElement("div",{style:t.endpointDetails},e.createElement("div",{style:t.endpointPath},e.createElement("span",{style:t.endpointMethod},a.method),a.path),e.createElement("div",{style:t.endpointStats},e.createElement("span",null,a.count," requests"),e.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),e.createElement("span",null,a.avg_time,"ms avg"),a.error_rate>0&&e.createElement(e.Fragment,null,e.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),e.createElement("span",{style:{color:"#f04747"}},a.error_rate,"% errors")))),e.createElement("div",{style:t.endpointBar},e.createElement("div",{style:{...t.endpointBarFill,width:`${a.count/g[0].count*100}%`,backgroundColor:a.error_rate>5?"#f04747":"#5865f2"}})))))),e.createElement("div",{style:t.section},e.createElement("h3",{style:t.sectionTitle},"Recent Activity"),e.createElement("div",{style:t.timeline},u.length===0?e.createElement("div",{style:t.empty},"No recent activity"):u.slice(0,20).map((a,l)=>e.createElement("div",{key:l,style:t.timelineItem},e.createElement("div",{style:{...t.timelineIcon,backgroundColor:a.status>=400?"#f04747":"#43b581"}},a.status>=400?e.createElement(E,null):e.createElement(y,null)),e.createElement("div",{style:t.timelineContent},e.createElement("div",{style:t.timelinePath},e.createElement("span",{style:t.timelineMethod},a.method),a.path),e.createElement("div",{style:t.timelineMeta},e.createElement("span",{style:{color:a.status>=400?"#f04747":"#43b581"}},a.status),e.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),e.createElement("span",null,a.response_time,"ms"),e.createElement("span",{style:{margin:"0 8px",color:"#444"}},"•"),e.createElement("span",null,new Date(a.timestamp).toLocaleTimeString())))))))))))},T=m=>{const d=new Date,o=new Date(m)-d;if(o<=0)return"Soon";const r=Math.floor(o/(1e3*60*60)),s=Math.floor(o%(1e3*60*60)/(1e3*60));return r>0?`${r}h ${s}m`:`${s}m`},t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},modal:{backgroundColor:"#1e1e1e",borderRadius:"8px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",display:"flex",flexDirection:"column",color:"#fff"},header:{padding:"20px",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"},headerLeft:{display:"flex",alignItems:"center",gap:"12px"},headerRight:{display:"flex",alignItems:"center",gap:"12px"},timeRangeSelect:{padding:"8px 12px",backgroundColor:"#2c2f33",border:"1px solid #444",borderRadius:"6px",color:"#fff",fontSize:"14px",cursor:"pointer"},closeBtn:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"8px"},content:{padding:"20px",overflowY:"auto",flex:1},loading:{textAlign:"center",padding:"40px",color:"#99aab5"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},statCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",display:"flex",alignItems:"center",gap:"16px"},statIcon:{fontSize:"32px",display:"flex",alignItems:"center",justifyContent:"center"},statInfo:{flex:1},statValue:{fontSize:"28px",fontWeight:"bold",marginBottom:"4px"},statLabel:{fontSize:"12px",color:"#99aab5",textTransform:"uppercase",letterSpacing:"1px"},section:{marginBottom:"32px"},sectionTitle:{fontSize:"16px",fontWeight:"600",marginBottom:"16px"},rateLimitCard:{backgroundColor:"#2c2f33",borderRadius:"8px",padding:"20px",borderLeft:"4px solid"},rateLimitInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},rateLimitText:{fontSize:"14px",fontWeight:"600"},rateLimitStatus:{fontSize:"14px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px"},rateLimitBar:{height:"8px",backgroundColor:"#202225",borderRadius:"4px",overflow:"hidden",marginBottom:"8px"},rateLimitProgress:{height:"100%",transition:"width 0.3s ease"},rateLimitReset:{fontSize:"12px",color:"#99aab5"},endpointsList:{display:"flex",flexDirection:"column",gap:"8px"},endpointItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"16px",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},endpointRank:{fontSize:"20px",fontWeight:"bold",color:"#5865f2",minWidth:"40px"},endpointDetails:{flex:1},endpointPath:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",fontFamily:"monospace"},endpointMethod:{display:"inline-block",padding:"2px 8px",backgroundColor:"#5865f2",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",marginRight:"8px"},endpointStats:{fontSize:"12px",color:"#99aab5"},endpointBar:{width:"100px",height:"6px",backgroundColor:"#202225",borderRadius:"3px",overflow:"hidden"},endpointBarFill:{height:"100%",transition:"width 0.3s ease"},timeline:{display:"flex",flexDirection:"column",gap:"8px"},timelineItem:{backgroundColor:"#2c2f33",borderRadius:"6px",padding:"12px",display:"flex",alignItems:"center",gap:"12px"},timelineIcon:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},timelineContent:{flex:1},timelinePath:{fontSize:"14px",fontWeight:"600",fontFamily:"monospace",marginBottom:"4px"},timelineMethod:{display:"inline-block",padding:"2px 6px",backgroundColor:"#5865f2",borderRadius:"3px",fontSize:"10px",fontWeight:"bold",marginRight:"8px"},timelineMeta:{fontSize:"12px",color:"#99aab5"},empty:{textAlign:"center",padding:"40px",color:"#99aab5"}};export{j as default};
