{"version":3,"file":"TwoFactorSetup-BoCr7WMC.js","sources":["../../../src/components/TwoFactorSetup.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport toast from '../utils/toast';\r\nimport QRCode from 'qrcode';\r\nimport './TwoFactorSetup.css';\r\n\r\nconst TwoFactorSetup = ({ onClose, fetchWithAuth, apiBaseUrl }) => {\r\n    const [step, setStep] = useState(1); // 1: QR, 2: Verify, 3: Backup Codes\r\n    const [qrCode, setQrCode] = useState('');\r\n    const [secret, setSecret] = useState('');\r\n    const [backupCodes, setBackupCodes] = useState([]);\r\n    const [verifyCode, setVerifyCode] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Step 1: Generate QR Code\r\n    useEffect(() => {\r\n        if (step === 1) {\r\n            generateQRCode();\r\n        }\r\n    }, [step]);\r\n\r\n    const generateQRCode = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetchWithAuth(`${apiBaseUrl}/auth/2fa/setup/`, {\r\n                method: 'POST'\r\n            });\r\n\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setSecret(data.secret);\r\n\r\n                // Generate QR code\r\n                const qrDataUrl = await QRCode.toDataURL(data.otpauth_url);\r\n                setQrCode(qrDataUrl);\r\n            } else {\r\n                const errorData = await res.json();\r\n                setError(errorData.error || 'QR kod olu≈üturulamadƒ±');\r\n            }\r\n        } catch (err) {\r\n            console.error('QR Code generation error:', err);\r\n            setError('Baƒülantƒ± hatasƒ±');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Step 2: Verify TOTP code\r\n    const handleVerify = async () => {\r\n        if (verifyCode.length !== 6) {\r\n            setError('6 haneli kod giriniz');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const res = await fetchWithAuth(`${apiBaseUrl}/auth/2fa/verify/`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    code: verifyCode,\r\n                    secret: secret\r\n                })\r\n            });\r\n\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setBackupCodes(data.backup_codes);\r\n                setStep(3);\r\n            } else {\r\n                const errorData = await res.json();\r\n                setError(errorData.error || 'Ge√ßersiz kod');\r\n            }\r\n        } catch (err) {\r\n            console.error('Verification error:', err);\r\n            setError('Doƒürulama hatasƒ±');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Step 3: Download backup codes\r\n    const downloadBackupCodes = () => {\r\n        const text = backupCodes.join('\\n');\r\n        const blob = new Blob([text], { type: 'text/plain' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'pawscord-backup-codes.txt';\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n    };\r\n\r\n    const handleComplete = () => {\r\n        toast.success('‚úÖ 2FA ba≈üarƒ±yla etkinle≈ütirildi!');\r\n        onClose();\r\n        window.location.reload(); // Refresh to update UI\r\n    };\r\n\r\n    return (\r\n        <div className=\"twofa-modal-overlay\" onClick={onClose}>\r\n            <div className=\"twofa-modal-content\" onClick={(e) => e.stopPropagation()}>\r\n                <button className=\"twofa-close-btn\" onClick={onClose}>√ó</button>\r\n\r\n                <h2>üîê ƒ∞ki Fakt√∂rl√º Kimlik Doƒürulama</h2>\r\n\r\n                {/* Step 1: QR Code */}\r\n                {step === 1 && (\r\n                    <div className=\"twofa-step\">\r\n                        <h3>Adƒ±m 1: QR Kodu Tara</h3>\r\n                        <p>Google Authenticator veya Authy uygulamasƒ±yla bu QR kodu tarayƒ±n:</p>\r\n\r\n                        {loading ? (\r\n                            <div className=\"twofa-loading\">QR kod olu≈üturuluyor...</div>\r\n                        ) : qrCode ? (\r\n                            <>\r\n                                <img src={qrCode} alt=\"QR Code\" className=\"twofa-qr-code\" />\r\n                                <div className=\"twofa-secret\">\r\n                                    <p><strong>Manuel Kod:</strong></p>\r\n                                    <code>{secret}</code>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            navigator.clipboard.writeText(secret);\r\n                                            toast.success('‚úÖ Kod kopyalandƒ±!');\r\n                                        }}\r\n                                        className=\"twofa-copy-btn\"\r\n                                    >\r\n                                        üìã Kopyala\r\n                                    </button>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setStep(2)}\r\n                                    className=\"twofa-next-btn\"\r\n                                >\r\n                                    ƒ∞leri ‚Üí\r\n                                </button>\r\n                            </>\r\n                        ) : (\r\n                            <div className=\"twofa-error\">{error}</div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step 2: Verify Code */}\r\n                {step === 2 && (\r\n                    <div className=\"twofa-step\">\r\n                        <h3>Adƒ±m 2: Doƒürulama Kodu</h3>\r\n                        <p>Authenticator uygulamasƒ±ndaki 6 haneli kodu girin:</p>\r\n\r\n                        <input\r\n                            type=\"text\"\r\n                            maxLength=\"6\"\r\n                            value={verifyCode}\r\n                            onChange={(e) => setVerifyCode(e.target.value.replace(/\\D/g, ''))}\r\n                            placeholder=\"000000\"\r\n                            className=\"twofa-code-input\"\r\n                            autoFocus\r\n                        />\r\n\r\n                        {error && <div className=\"twofa-error\">{error}</div>}\r\n\r\n                        <div className=\"twofa-buttons\">\r\n                            <button\r\n                                onClick={() => setStep(1)}\r\n                                className=\"twofa-back-btn\"\r\n                            >\r\n                                ‚Üê Geri\r\n                            </button>\r\n                            <button\r\n                                onClick={handleVerify}\r\n                                disabled={loading || verifyCode.length !== 6}\r\n                                className=\"twofa-verify-btn\"\r\n                            >\r\n                                {loading ? 'Doƒürulanƒ±yor...' : 'Doƒürula'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step 3: Backup Codes */}\r\n                {step === 3 && (\r\n                    <div className=\"twofa-step\">\r\n                        <h3>Adƒ±m 3: Yedek Kodlar</h3>\r\n                        <p className=\"twofa-warning\">\r\n                            ‚ö†Ô∏è Bu kodlarƒ± g√ºvenli bir yerde saklayƒ±n! Telefonunuza eri≈üemediƒüinizde bu kodlarƒ± kullanabilirsiniz.\r\n                        </p>\r\n\r\n                        <div className=\"twofa-backup-codes\">\r\n                            {backupCodes.map((code, index) => (\r\n                                <div key={index} className=\"twofa-backup-code\">\r\n                                    {code}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"twofa-buttons\">\r\n                            <button\r\n                                onClick={downloadBackupCodes}\r\n                                className=\"twofa-download-btn\"\r\n                            >\r\n                                üíæ ƒ∞ndir\r\n                            </button>\r\n                            <button\r\n                                onClick={handleComplete}\r\n                                className=\"twofa-complete-btn\"\r\n                            >\r\n                                ‚úÖ Tamamla\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TwoFactorSetup;\r\n\r\n\r\n"],"names":["useState","useEffect","jsx","jsxs","Fragment"],"mappings":"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"}