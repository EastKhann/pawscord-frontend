import{r as i,n as e}from"./react-core-BMiyQWF6.js";import{t as W}from"./index-CAB0Mj32.js";import{w as f,a as B,a3 as T,x as z,bJ as N,u as L,I as P,t as H}from"./icons-vendor-GUGjkvMm.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const K=({onClose:x,roomSlug:h,ws:a,token:J,isMobile:n})=>{const[g,y]=i.useState(!1),[l,v]=i.useState(!1),[u,S]=i.useState("camera"),[k,w]=i.useState(0),[C,E]=i.useState([]),[m,j]=i.useState(""),p=i.useRef(null),c=i.useRef(null),b=i.useRef({}),R={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};i.useEffect(()=>{if(!a.current)return;const t=s=>{try{const o=JSON.parse(s.data);o.type==="stream_viewer_count"?w(o.count):o.type==="stream_chat"?E(d=>[...d,{id:Date.now(),user:o.username,message:o.message,timestamp:new Date().toLocaleTimeString()}]):o.type==="stream_viewer_join"&&O(o.viewerId)}catch{}};return a.current.addEventListener("message",t),()=>a.current?.removeEventListener("message",t)},[a]),i.useEffect(()=>{const t=s=>{s.key==="Escape"&&x()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[x]);const I=async()=>{try{let t;u==="camera"?t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}):t=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0}),c.current=t,p.current&&(p.current.srcObject=t),y(!0),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_start",room_slug:h,stream_type:u}))}catch{W.error("âŒ Failed to start stream. Please check permissions.")}},D=()=>{c.current&&(c.current.getTracks().forEach(t=>t.stop()),c.current=null),Object.values(b.current).forEach(t=>t.close()),b.current={},p.current&&(p.current.srcObject=null),y(!1),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_stop",room_slug:h}))},F=()=>{c.current&&(c.current.getAudioTracks().forEach(t=>{t.enabled=l}),v(!l))},_=t=>{t.preventDefault(),m.trim()&&(a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_chat",room_slug:h,message:m})),j(""))},O=async t=>{if(!c.current)return;const s=new RTCPeerConnection(R);b.current[t]=s,c.current.getTracks().forEach(d=>{s.addTrack(d,c.current)}),s.onicecandidate=d=>{d.candidate&&a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"ice_candidate",candidate:d.candidate,viewer_id:t}))};const o=await s.createOffer();await s.setLocalDescription(o),a.current?.readyState===WebSocket.OPEN&&a.current.send(JSON.stringify({type:"stream_offer",sdp:s.localDescription,viewer_id:t}))},r={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:n?"0":"20px"},modal:{width:"100%",maxWidth:n?"100%":"1400px",height:n?"100%":"auto",maxHeight:"90vh",background:"linear-gradient(135deg, rgba(30, 31, 34, 0.98), rgba(35, 36, 40, 0.98))",borderRadius:n?"0":"16px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(218, 55, 60, 0.3)",border:n?"none":"1px solid rgba(218, 55, 60, 0.4)"},header:{padding:n?"12px 16px":"16px 24px",background:"linear-gradient(135deg, rgba(218, 55, 60, 0.15), rgba(240, 71, 71, 0.15))",borderBottom:"1px solid rgba(218, 55, 60, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontSize:n?"18px":"22px",fontWeight:"700",color:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",gap:"10px"},liveIndicator:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",background:"rgba(218, 55, 60, 0.3)",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"#da373c",border:"1px solid rgba(218, 55, 60, 0.5)"},liveD:{width:"8px",height:"8px",background:"#da373c",borderRadius:"50%",animation:"pulse 1.5s ease-in-out infinite"},closeBtn:{background:"rgba(218, 55, 60, 0.2)",border:"1px solid rgba(218, 55, 60, 0.4)",borderRadius:"8px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#da373c",fontSize:"18px"},content:{flex:1,display:"flex",flexDirection:n?"column":"row",overflow:"hidden"},streamSection:{flex:1,display:"flex",flexDirection:"column",background:"#000",position:"relative"},videoContainer:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",position:"relative"},video:{width:"100%",height:"100%",objectFit:"contain"},placeholder:{textAlign:"center",color:"rgba(255, 255, 255, 0.5)"},viewerCount:{position:"absolute",top:"16px",right:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",borderRadius:"20px",fontSize:"14px",fontWeight:"600",color:"white"},controls:{padding:"16px",background:"rgba(0, 0, 0, 0.8)",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},controlBtn:t=>({padding:"12px 24px",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",minHeight:"44px",background:t?"rgba(218, 55, 60, 0.3)":"rgba(88, 101, 242, 0.2)",color:t?"#da373c":"rgba(255, 255, 255, 0.9)",border:`1px solid ${t?"rgba(218, 55, 60, 0.5)":"rgba(88, 101, 242, 0.4)"}`}),startBtn:{padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"linear-gradient(135deg, #da373c, #f04747)",color:"white",transition:"all 0.2s ease",minHeight:"48px"},chatSection:{width:n?"100%":"350px",maxHeight:n?"300px":"auto",background:"rgba(0, 0, 0, 0.3)",borderLeft:n?"none":"1px solid rgba(218, 55, 60, 0.2)",display:"flex",flexDirection:"column"},chatHeader:{padding:"16px",borderBottom:"1px solid rgba(218, 55, 60, 0.2)",fontSize:"16px",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)"},chatMessages:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px"},chatMessage:{padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"14px"},chatUsername:{fontWeight:"600",color:"#5865f2",marginBottom:"4px"},chatText:{color:"rgba(255, 255, 255, 0.8)"},chatInput:{padding:"12px",borderTop:"1px solid rgba(218, 55, 60, 0.2)",display:"flex",gap:"8px"},input:{flex:1,padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(218, 55, 60, 0.3)",borderRadius:"8px",color:"rgba(255, 255, 255, 0.95)",fontSize:"14px",outline:"none"},sendBtn:{padding:"12px 20px",background:"linear-gradient(135deg, #da373c, #f04747)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:"pointer",minHeight:"44px"}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
            `}),e.jsx("div",{style:r.overlay,onClick:x,children:e.jsxs("div",{style:r.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:r.header,children:[e.jsxs("h2",{style:r.title,children:[e.jsx(f,{}),"Live Stream",g&&e.jsxs("span",{style:r.liveIndicator,children:[e.jsx("span",{style:r.liveDot}),"LIVE"]})]}),e.jsx("button",{onClick:x,style:r.closeBtn,children:e.jsx(B,{})})]}),e.jsxs("div",{style:r.content,children:[e.jsxs("div",{style:r.streamSection,children:[e.jsx("div",{style:r.videoContainer,children:g?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:p,autoPlay:!0,muted:!0,style:r.video}),e.jsxs("div",{style:r.viewerCount,children:[e.jsx(T,{}),k," viewers"]})]}):e.jsxs("div",{style:r.placeholder,children:[e.jsx(f,{size:64}),e.jsx("p",{style:{marginTop:"16px",fontSize:"18px"},children:'Click "Start Stream" to begin'})]})}),e.jsx("div",{style:r.controls,children:g?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:F,style:r.controlBtn(l),children:[l?e.jsx(N,{}):e.jsx(L,{}),l?"Unmute":"Mute"]}),e.jsxs("button",{onClick:D,style:{...r.startBtn,background:"linear-gradient(135deg, #da373c, #b83030)"},children:[e.jsx(P,{}),"Stop Stream"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S("camera"),style:r.controlBtn(u==="camera"),children:[e.jsx(f,{}),"Camera"]}),e.jsxs("button",{onClick:()=>S("screen"),style:r.controlBtn(u==="screen"),children:[e.jsx(z,{}),"Screen"]}),e.jsxs("button",{onClick:I,style:r.startBtn,children:[e.jsx(f,{}),"Start Stream"]})]})})]}),g&&e.jsxs("div",{style:r.chatSection,children:[e.jsxs("div",{style:r.chatHeader,children:[e.jsx(H,{})," Stream Chat"]}),e.jsx("div",{style:r.chatMessages,children:C.map(t=>e.jsxs("div",{style:r.chatMessage,children:[e.jsx("div",{style:r.chatUsername,children:t.user}),e.jsx("div",{style:r.chatText,children:t.message})]},t.id))}),e.jsxs("form",{onSubmit:_,style:r.chatInput,children:[e.jsx("input",{type:"text",value:m,onChange:t=>j(t.target.value),placeholder:"Send a message...",style:r.input}),e.jsx("button",{type:"submit",style:r.sendBtn,children:"Send"})]})]})]})]})})]})};export{K as default};
