import{r as i,n as e}from"./react-core-BMiyQWF6.js";import{y as o}from"./ui-vendor-6RMGJYFH.js";import{g as C}from"./index-6woDk0p4.js";import"./editor-vendor-D9c4a6XZ.js";import"./media-vendor-BuSyE8vR.js";import"./router-vendor-B86Z1mIL.js";import"./icons-vendor-T72gfvdf.js";import"./state-vendor-CAyNnPM4.js";import"./crypto-vendor-1Q6e4ZD-.js";const P=({serverId:r,onClose:d})=>{const c=C(),[t,n]=i.useState({enabled:!1,announcement_channel_id:"",birthday_role_id:"",message_template:"ðŸŽ‰ BugÃ¼n @{user}'un doÄŸum gÃ¼nÃ¼! Mutlu yÄ±llar! ðŸŽ‚",give_role:!0,remove_role_after_day:!0}),[h,g]=i.useState([]),[m,x]=i.useState([]),[y,j]=i.useState([]),[p,f]=i.useState([]),[v,b]=i.useState(!0);i.useEffect(()=>{_(),N(),k(),S()},[r]);const _=async()=>{try{const s=await fetch(`${c}/birthday-system/server/${r}/config/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();n(a)}}catch{}finally{b(!1)}},N=async()=>{try{const s=await fetch(`${c}/birthday-system/server/${r}/birthdays/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();g(a.all_birthdays),x(a.upcoming)}}catch{}},k=async()=>{try{const s=await fetch(`${c}/channels/server/${r}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();j(a.filter(l=>l.type==="text"))}}catch{}},S=async()=>{try{const s=await fetch(`${c}/roles/server/${r}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(s.ok){const a=await s.json();f(a)}}catch{}},$=async()=>{try{(await fetch(`${c}/birthday-system/server/${r}/config/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?o.success("âœ… Ayarlar kaydedildi"):o.error("âŒ Kaydetme hatasÄ±")}catch{o.error("âŒ BaÄŸlantÄ± hatasÄ±")}},w=async()=>{try{(await fetch(`${c}/birthday-system/server/${r}/test/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&o.success("âœ… Test mesajÄ± gÃ¶nderildi")}catch{o.error("âŒ GÃ¶nderim hatasÄ±")}},u=s=>new Date(s).toLocaleDateString("tr-TR",{day:"numeric",month:"long"}),B=s=>{const a=new Date,l=new Date(s);return l.setFullYear(a.getFullYear()),l<a&&l.setFullYear(a.getFullYear()+1),Math.ceil((l-a)/(1e3*60*60*24))};return e.jsx("div",{className:"birthday-overlay",onClick:d,children:e.jsxs("div",{className:"birthday-panel",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"birthday-header",children:[e.jsx("h2",{children:"ðŸŽ‚ DoÄŸum GÃ¼nÃ¼ Sistemi"}),e.jsx("button",{className:"close-btn",onClick:d,children:"Ã—"})]}),e.jsx("div",{className:"birthday-content",children:v?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"âš™ï¸ Ayarlar"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:t.enabled,onChange:s=>n({...t,enabled:s.target.checked})}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ“¢ Duyuru KanalÄ±"}),e.jsxs("select",{value:t.announcement_channel_id,onChange:s=>n({...t,announcement_channel_id:s.target.value}),children:[e.jsx("option",{value:"",children:"SeÃ§in"}),y.map(s=>e.jsxs("option",{value:s.id,children:["# ",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸŽ­ DoÄŸum GÃ¼nÃ¼ RolÃ¼"}),e.jsxs("select",{value:t.birthday_role_id,onChange:s=>n({...t,birthday_role_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Yok"}),p.map(s=>e.jsxs("option",{value:s.id,children:["@",s.name]},s.id))]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"ðŸ’¬ Mesaj Åžablonu"}),e.jsx("textarea",{value:t.message_template,onChange:s=>n({...t,message_template:s.target.value}),rows:"2"}),e.jsxs("small",{children:["KullanÄ±labilir: ","{user}",", ","{age}",", ","{server}"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.give_role,onChange:s=>n({...t,give_role:s.target.checked})}),e.jsx("span",{children:"DoÄŸum gÃ¼nÃ¼ rolÃ¼ ver"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.remove_role_after_day,onChange:s=>n({...t,remove_role_after_day:s.target.checked})}),e.jsx("span",{children:"Bir gÃ¼n sonra rolÃ¼ kaldÄ±r"})]})})]}),e.jsxs("div",{className:"config-actions",children:[e.jsx("button",{className:"save-btn",onClick:$,children:"ðŸ’¾ Kaydet"}),e.jsx("button",{className:"test-btn",onClick:w,children:"âœ‰ï¸ Test MesajÄ±"})]})]}),e.jsxs("div",{className:"upcoming-section",children:[e.jsx("h3",{children:"ðŸ“… YaklaÅŸan DoÄŸum GÃ¼nleri"}),m.length===0?e.jsx("div",{className:"empty-state-small",children:e.jsx("p",{children:"YaklaÅŸan doÄŸum gÃ¼nÃ¼ yok"})}):e.jsx("div",{className:"upcoming-list",children:m.map(s=>e.jsxs("div",{className:"upcoming-card",children:[e.jsx("div",{className:"upcoming-avatar",children:s.user_avatar?e.jsx("img",{src:s.user_avatar,alt:""}):e.jsx("div",{className:"default-avatar",children:"ðŸ‘¤"})}),e.jsxs("div",{className:"upcoming-info",children:[e.jsx("h4",{children:s.user_name}),e.jsx("p",{children:u(s.birthday)})]}),e.jsx("div",{className:"upcoming-days",children:e.jsxs("span",{className:"days-badge",children:[B(s.birthday)," gÃ¼n"]})})]},s.user_id))})]}),e.jsxs("div",{className:"all-birthdays-section",children:[e.jsxs("h3",{children:["ðŸ“‹ TÃ¼m DoÄŸum GÃ¼nleri (",h.length,")"]}),e.jsx("div",{className:"birthdays-grid",children:h.map(s=>e.jsxs("div",{className:"birthday-item",children:[e.jsx("span",{className:"user-name",children:s.user_name}),e.jsx("span",{className:"birthday-date",children:u(s.birthday)})]},s.user_id))})]})]})})]})})};export{P as default};
