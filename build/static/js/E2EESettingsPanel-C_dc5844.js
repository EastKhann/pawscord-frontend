var W=Object.defineProperty;var a=(c,i)=>W(c,"name",{value:i,configurable:!0});import{a as q,_ as Q}from"./media-vendor-CxFPycob.js";import{r,j as e}from"./react-core-Djgtqrmb.js";import{t as d,d as _}from"./index-D09YXCFH.js";import{a1 as M,a as T,cp as J,a9 as B,h as A,d as F,w as X,z as Z,c as N,g as U}from"./icons-vendor-BMXAt4pj.js";import"./router-vendor-gmJ9Mn-1.js";import"./state-vendor-CbW2fAN9.js";import"./crypto-vendor-D1XRGppi.js";import"./ui-vendor-IhB9Znpc.js";const ee=a(({username:c,targetUser:i,apiBaseUrl:m,fetchWithAuth:h,onClose:y})=>{const[f,z]=r.useState(null),[u,b]=r.useState(!1),[g,p]=r.useState(!1),[K,C]=r.useState(!0),[E,j]=r.useState(!1);r.useEffect(()=>{w()},[i]);const w=a(async()=>{try{const o=await(await h(`${m}/e2ee/safety-number/${i}/`)).json();z(o.safetyNumber),b(o.verified),p(o.verifiedByMe),C(!1)}catch{C(!1)}},"fetchSafetyNumber"),D=a(async()=>{try{const o=await(await h(`${m}/e2ee/verify-safety-number/${i}/`,{method:"POST"})).json();p(!0),b(o.bothVerified),d.success(`âœ… Safety number doÄŸrulandÄ±!${o.bothVerified?`

Her iki taraf da doÄŸruladÄ±! ðŸŽ‰`:""}`)}catch{d.error("âŒ DoÄŸrulama baÅŸarÄ±sÄ±z!")}},"handleVerify");return K?e.jsx("div",{style:t.overlay,onClick:y,children:e.jsx("div",{style:t.modal,onClick:a(s=>s.stopPropagation(),"onClick"),children:e.jsx("p",{style:t.loading,children:"YÃ¼kleniyor..."})})}):e.jsx("div",{style:t.overlay,onClick:y,children:e.jsxs("div",{style:t.modal,onClick:a(s=>s.stopPropagation(),"onClick"),children:[e.jsxs("div",{style:t.header,children:[e.jsx(M,{size:32,color:u?"#43b581":"#faa61a"}),e.jsx("h2",{style:t.title,children:"Safety Number"}),e.jsx("button",{onClick:y,style:t.closeButton,children:e.jsx(T,{})})]}),e.jsx("div",{style:t.user,children:i}),E?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.qrContainer,children:e.jsx(q,{value:f||"",size:200})}),e.jsx("button",{onClick:a(()=>j(!1),"onClick"),style:t.qrButton,children:"NumarayÄ± GÃ¶ster"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:t.numberContainer,children:f?.split(" ").map((s,o)=>e.jsx("div",{style:t.numberGroup,children:s},o))}),e.jsxs("button",{onClick:a(()=>j(!0),"onClick"),style:t.qrButton,children:[e.jsx(J,{})," QR Kodu GÃ¶ster"]})]}),e.jsx("div",{style:t.statusContainer,children:u?e.jsxs("div",{style:t.statusVerified,children:[e.jsx(B,{size:20}),e.jsx("span",{children:"Her iki taraf da doÄŸruladÄ±! âœ…"})]}):g?e.jsxs("div",{style:t.statusPartial,children:[e.jsx(B,{size:20}),e.jsxs("span",{children:["Siz doÄŸruladÄ±nÄ±z. ",i," henÃ¼z doÄŸrulamadÄ±."]})]}):e.jsxs("div",{style:t.statusUnverified,children:[e.jsx(T,{size:20}),e.jsx("span",{children:"HenÃ¼z doÄŸrulanmadÄ±"})]})}),e.jsxs("div",{style:t.info,children:[e.jsx("h3",{children:"Safety Number Nedir?"}),e.jsxs("p",{children:["Safety number, sizin ve ",i,"'in ÅŸifreleme anahtarlarÄ±nÄ±n parmak izidir (fingerprint). Bu numarayÄ± karÅŸÄ±laÅŸtÄ±rarak identity key'lerini doÄŸrulayabilirsiniz."]}),e.jsx("h3",{children:"NasÄ±l DoÄŸrulanÄ±r?"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[i," ile yÃ¼z yÃ¼ze gÃ¶rÃ¼ÅŸÃ¼n veya gÃ¼venilir bir kanal kullanÄ±n"]}),e.jsx("li",{children:"Her ikiniz de safety number'Ä± aÃ§Ä±n"}),e.jsx("li",{children:"NumaralarÄ± karÅŸÄ±laÅŸtÄ±rÄ±n (aynÄ± olmalÄ±!)"}),e.jsx("li",{children:'EÅŸleÅŸiyorsa "DoÄŸrula" butonuna basÄ±n'})]})]}),!g&&e.jsxs("button",{onClick:D,style:t.verifyButton,children:[e.jsx(B,{})," Bu NumarayÄ± DoÄŸrula"]})]})})},"SafetyNumberModal"),t={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e5},modal:{backgroundColor:"#2b2d31",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",position:"relative"},title:{color:"#fff",fontSize:"20px",fontWeight:"600",flex:1},closeButton:{backgroundColor:"transparent",border:"none",color:"#b9bbbe",cursor:"pointer",padding:"4px",fontSize:"20px"},user:{color:"#5865f2",fontSize:"18px",fontWeight:"500",marginBottom:"24px",textAlign:"center"},numberContainer:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},numberGroup:{backgroundColor:"#1e1f22",color:"#fff",padding:"12px",borderRadius:"4px",textAlign:"center",fontSize:"18px",fontFamily:"monospace",letterSpacing:"2px"},qrContainer:{display:"flex",justifyContent:"center",marginBottom:"24px",padding:"16px",backgroundColor:"#fff",borderRadius:"8px"},qrButton:{backgroundColor:"#4e5058",color:"#fff",border:"none",borderRadius:"4px",padding:"10px 16px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto 24px"},statusContainer:{marginBottom:"24px"},statusVerified:{backgroundColor:"#43b581",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusPartial:{backgroundColor:"#faa61a",color:"#000",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},statusUnverified:{backgroundColor:"#ed4245",color:"#fff",padding:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},info:{backgroundColor:"#1e1f22",padding:"16px",borderRadius:"8px",marginBottom:"24px",color:"#b9bbbe",fontSize:"14px"},verifyButton:{backgroundColor:"#43b581",color:"#fff",border:"none",borderRadius:"4px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},loading:{color:"#b9bbbe",textAlign:"center",padding:"32px"}},pe=a(({username:c,apiBaseUrl:i,fetchWithAuth:m})=>{const[h,y]=r.useState(!1),[f,z]=r.useState(null),[u,b]=r.useState(null),[g,p]=r.useState(!1),[K,C]=r.useState({encryptedMessagesCount:0,trustedContacts:0,lastKeyRotation:null}),[E,j]=r.useState(!1),[w,D]=r.useState(null);r.useEffect(()=>{s()},[]);const s=a(()=>{const l=localStorage.getItem("e2ee_enabled")==="true",k=localStorage.getItem("e2ee_setup_date"),S=localStorage.getItem("e2ee_last_rotation");y(l),z(k?new Date(k):null),b(S?new Date(S):null)},"loadE2EEStatus"),o=a(async()=>{if(await _(`ðŸ”‘ AnahtarlarÄ± yenilemek istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ Yeni kimlik anahtarlarÄ± oluÅŸturur
â€¢ Eski ÅŸifreli mesajlar okunamaz hale gelir
â€¢ TÃ¼m kiÅŸilerle yeniden gÃ¼venlik doÄŸrulamasÄ± gerekir`)){p(!0);try{const{generateIdentityKeyPair:l,generateSignedPreKeyPair:k,generateOneTimePreKeys:S,storePrivateKeys:$}=await Q(async()=>{const{generateIdentityKeyPair:x,generateSignedPreKeyPair:Y,generateOneTimePreKeys:G,storePrivateKeys:O}=await import("./e2ee-BrsGVOed.js");return{generateIdentityKeyPair:x,generateSignedPreKeyPair:Y,generateOneTimePreKeys:G,storePrivateKeys:O}},[]);d.info("ðŸ” Yeni anahtarlar oluÅŸturuluyor...");const R=await l(),v=await k(Date.now(),R.privateKey),L=await S(100);if(await $(c,R.privateKey,v.privateKey),d.info("â˜ï¸ Sunucuya yÃ¼kleniyor..."),(await m(`${i}/e2ee/rotate-keys/`,{method:"POST",body:JSON.stringify({identityPublicKey:R.publicKey,signedPreKeyId:v.keyId,signedPreKeyPublic:v.publicKey,signedPreKeySignature:v.signature,oneTimePreKeys:L.map(x=>({keyId:x.keyId,publicKey:x.publicKey}))})})).ok){const x=new Date().toISOString();localStorage.setItem("e2ee_last_rotation",x),b(new Date(x)),d.success("âœ… Anahtarlar baÅŸarÄ±yla yenilendi!")}else throw new Error("Key rotation failed")}catch{d.error("âŒ Anahtar yenileme baÅŸarÄ±sÄ±z!")}finally{p(!1)}}},"handleRotateKeys"),H=a(async()=>{if(await _(`âš ï¸ E2EE'yi devre dÄ±ÅŸÄ± bÄ±rakmak istediÄŸinizden emin misiniz?

Bu iÅŸlem:
â€¢ TÃ¼m ÅŸifreli mesajlarÄ±nÄ±zÄ± siler
â€¢ AnahtarlarÄ±nÄ±zÄ± kaldÄ±rÄ±r
â€¢ Geri alÄ±namaz!`)){p(!0);try{localStorage.removeItem("e2ee_enabled"),localStorage.removeItem("e2ee_setup_date"),localStorage.removeItem("e2ee_last_rotation"),localStorage.removeItem(`e2ee_identity_private_${c}`),localStorage.removeItem(`e2ee_signed_pre_key_private_${c}`),y(!1),d.success("âœ… E2EE devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±")}catch{d.error("âŒ Ä°ÅŸlem baÅŸarÄ±sÄ±z!")}finally{p(!1)}}},"handleDisableE2EE"),P=a(l=>l?l.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"HiÃ§","formatDate"),I=a(()=>u?Math.floor((new Date-u)/(1e3*60*60*24)):f?Math.floor((new Date-f)/(1e3*60*60*24)):null,"getDaysSinceRotation")(),V=I&&I>90;return h?e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsx(A,{size:24}),e.jsx("h3",{style:n.title,children:"E2EE AyarlarÄ±"})]}),e.jsxs("div",{style:n.statusCard,children:[e.jsxs("div",{style:n.statusHeader,children:[e.jsx(X,{size:32,color:"#43b581"}),e.jsx("span",{style:n.statusText,children:"E2EE Aktif"})]}),e.jsxs("div",{style:n.statusInfo,children:[e.jsxs("div",{style:n.infoRow,children:[e.jsx(Z,{}),e.jsxs("span",{children:["Kurulum: ",P(f)]})]}),u&&e.jsxs("div",{style:n.infoRow,children:[e.jsx(N,{}),e.jsxs("span",{children:["Son Yenileme: ",P(u)]})]})]})]}),V&&e.jsxs("div",{style:n.warningCard,children:[e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Anahtar Yenileme Ã–nerilir"}),e.jsxs("p",{children:["Son anahtar yenilemeden ",I," gÃ¼n geÃ§ti. GÃ¼venlik iÃ§in anahtarlarÄ±nÄ±zÄ± yenileyin."]})]})]}),e.jsxs("div",{style:n.actions,children:[e.jsxs("button",{onClick:o,disabled:g,style:n.rotateButton,children:[e.jsx(N,{}),g?"Yenileniyor...":"AnahtarlarÄ± Yenile"]}),e.jsxs("button",{onClick:H,disabled:g,style:n.disableButton,children:[e.jsx(U,{}),"E2EE\\'yi Devre DÄ±ÅŸÄ± BÄ±rak"]})]}),e.jsxs("div",{style:n.infoSection,children:[e.jsxs("h4",{style:n.infoTitle,children:[e.jsx(M,{}),"E2EE HakkÄ±nda"]}),e.jsxs("ul",{style:n.infoList,children:[e.jsx("li",{children:"âœ… MesajlarÄ±nÄ±z uÃ§tan uca ÅŸifrelenir"}),e.jsx("li",{children:"âœ… Sadece siz ve karÅŸÄ±nÄ±zdaki kiÅŸi okuyabilir"}),e.jsx("li",{children:"âœ… Sunucu bile mesajlarÄ± gÃ¶remez"}),e.jsx("li",{children:"âš ï¸ AnahtarlarÄ±nÄ±zÄ± kaybederseniz mesajlar okunamaz"}),e.jsx("li",{children:"ðŸ”‘ 90 gÃ¼nde bir anahtar yenileme Ã¶nerilir"})]})]}),E&&e.jsx(ee,{username:c,targetUser:w,apiBaseUrl:i,fetchWithAuth:m,onClose:a(()=>j(!1),"onClose")})]}):e.jsxs("div",{style:n.container,children:[e.jsxs("div",{style:n.header,children:[e.jsx(A,{size:24}),e.jsx("h3",{style:n.title,children:"End-to-End Encryption"})]}),e.jsxs("div",{style:n.disabledState,children:[e.jsx(F,{size:48,color:"#faa61a"}),e.jsx("h4",{children:"E2EE Devre DÄ±ÅŸÄ±"}),e.jsx("p",{children:"Åžu anda E2EE kullanmÄ±yorsunuz. MesajlarÄ±nÄ±zÄ± ÅŸifrelemek iÃ§in ayarlardan etkinleÅŸtirin."})]})]})},"E2EESettingsPanel"),n={container:{padding:"20px",backgroundColor:"#2f3136",borderRadius:"8px",color:"#dcddde"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",paddingBottom:"16px",borderBottom:"2px solid #40444b"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},statusCard:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px",marginBottom:"16px",border:"2px solid #43b581"},statusHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},statusText:{fontSize:"18px",fontWeight:"bold",color:"#43b581"},statusInfo:{display:"flex",flexDirection:"column",gap:"8px"},infoRow:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#b9bbbe"},warningCard:{backgroundColor:"#faa61a20",border:"2px solid #faa61a",borderRadius:"8px",padding:"16px",marginBottom:"16px",display:"flex",gap:"12px",alignItems:"flex-start",color:"#faa61a"},actions:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},rotateButton:{padding:"12px 20px",backgroundColor:"#5865f2",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disableButton:{padding:"12px 20px",backgroundColor:"#ed4245",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background-color 0.2s"},disabledState:{textAlign:"center",padding:"40px 20px",color:"#b9bbbe"},infoSection:{backgroundColor:"#202225",borderRadius:"8px",padding:"20px"},infoTitle:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"16px"},infoList:{margin:0,paddingLeft:"20px",color:"#b9bbbe",fontSize:"14px",lineHeight:"1.8"}};export{pe as default};
