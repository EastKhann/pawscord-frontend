import{r as i,j as e}from"./react-core-D6cE4lil.js";import{y as r}from"./ui-vendor-CZOhtEfS.js";import{g as w,h as S}from"./index-BvqjkDq7.js";import"./media-vendor-Du00QUHb.js";import"./router-vendor-wrB4dqw3.js";import"./icons-vendor-DT2gd7vx.js";import"./state-vendor-DnurjGY_.js";import"./crypto-vendor-BYnay7oC.js";const O=({serverId:o,onClose:h})=>{const l=w(),[m,x]=i.useState([]),[j,c]=i.useState(!1),[t,n]=i.useState({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""}),[p,g]=i.useState([]),[f,k]=i.useState(!0);i.useEffect(()=>{d(),v()},[o]);const d=async()=>{try{const a=await fetch(`${l}/reminders/server/${o}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const s=await a.json();x(s)}}catch{}finally{k(!1)}},v=async()=>{try{const a=await fetch(`${l}/channels/server/${o}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(a.ok){const s=await a.json();g(s.filter(C=>C.type==="text"))}}catch{}},N=async()=>{if(!t.title||!t.remind_at||!t.channel_id){r.error("âŒ LÃ¼tfen gerekli alanlarÄ± doldurun");return}try{(await fetch(`${l}/reminders/create/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"},body:JSON.stringify({server_id:o,...t})})).ok?(r.success("âœ… HatÄ±rlatÄ±cÄ± oluÅŸturuldu"),c(!1),d(),n({title:"",description:"",remind_at:"",repeat:"once",channel_id:"",mention_user_id:""})):r.error("âŒ OluÅŸturma hatasÄ±")}catch{r.error("âŒ BaÄŸlantÄ± hatasÄ±")}},y=async a=>{if(await S("HatÄ±rlatÄ±cÄ±yÄ± silmek istediÄŸinize emin misiniz?"))try{(await fetch(`${l}/reminders/${a}/delete/`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&(r.success("âœ… HatÄ±rlatÄ±cÄ± silindi"),d())}catch{r.error("âŒ Silme hatasÄ±")}},b=async a=>{try{(await fetch(`${l}/reminders/${a}/trigger/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok&&r.success("âœ… HatÄ±rlatÄ±cÄ± tetiklendi")}catch{r.error("âŒ Tetikleme hatasÄ±")}},_=a=>new Date(a).toLocaleString("tr-TR"),u=a=>{const s={once:{text:"Bir kez",color:"#6b7280"},daily:{text:"GÃ¼nlÃ¼k",color:"#3b82f6"},weekly:{text:"HaftalÄ±k",color:"#8b5cf6"},monthly:{text:"AylÄ±k",color:"#ec4899"}};return s[a]||s.once};return e.jsx("div",{className:"reminder-overlay",onClick:h,children:e.jsxs("div",{className:"reminder-panel",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"reminder-header",children:[e.jsx("h2",{children:"â° HatÄ±rlatÄ±cÄ±lar"}),e.jsx("button",{className:"close-btn",onClick:h,children:"Ã—"})]}),e.jsxs("div",{className:"reminder-content",children:[e.jsx("button",{className:"create-reminder-btn",onClick:()=>c(!0),children:"+ Yeni HatÄ±rlatÄ±cÄ±"}),f?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"YÃ¼kleniyor..."})]}):m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"â°"}),e.jsx("p",{children:"HenÃ¼z hatÄ±rlatÄ±cÄ± yok"})]}):e.jsx("div",{className:"reminders-list",children:m.map(a=>e.jsxs("div",{className:"reminder-card",children:[e.jsxs("div",{className:"reminder-main",children:[e.jsx("h3",{children:a.title}),a.description&&e.jsx("p",{children:a.description}),e.jsxs("div",{className:"reminder-meta",children:[e.jsxs("span",{children:["â° ",_(a.remind_at)]}),e.jsxs("span",{children:["ğŸ“ # ",p.find(s=>s.id===a.channel_id)?.name]}),e.jsxs("span",{className:"repeat-badge",style:{background:u(a.repeat).color},children:["ğŸ”„ ",u(a.repeat).text]})]})]}),e.jsxs("div",{className:"reminder-actions",children:[e.jsx("button",{className:"trigger-btn",onClick:()=>b(a.id),children:"â–¶ï¸ Tetikle"}),e.jsx("button",{className:"delete-btn",onClick:()=>y(a.id),children:"ğŸ—‘ï¸"})]})]},a.id))})]}),j&&e.jsx("div",{className:"create-modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"create-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Yeni HatÄ±rlatÄ±cÄ±"}),e.jsx("button",{className:"close-btn",onClick:()=>c(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"BaÅŸlÄ±k *"}),e.jsx("input",{value:t.title,onChange:a=>n({...t,title:a.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"AÃ§Ä±klama"}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),rows:"3"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tarih/Saat *"}),e.jsx("input",{type:"datetime-local",value:t.remind_at,onChange:a=>n({...t,remind_at:a.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tekrar"}),e.jsxs("select",{value:t.repeat,onChange:a=>n({...t,repeat:a.target.value}),children:[e.jsx("option",{value:"once",children:"Bir kez"}),e.jsx("option",{value:"daily",children:"GÃ¼nlÃ¼k"}),e.jsx("option",{value:"weekly",children:"HaftalÄ±k"}),e.jsx("option",{value:"monthly",children:"AylÄ±k"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kanal *"}),e.jsxs("select",{value:t.channel_id,onChange:a=>n({...t,channel_id:a.target.value}),children:[e.jsx("option",{value:"",children:"SeÃ§in"}),p.map(a=>e.jsxs("option",{value:a.id,children:["# ",a.name]},a.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>c(!1),children:"Ä°ptal"}),e.jsx("button",{className:"submit-btn",onClick:N,children:"â° OluÅŸtur"})]})]})})]})})};export{O as default};
